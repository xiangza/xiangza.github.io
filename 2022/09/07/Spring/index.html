<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ç¿”ä»”"><meta name="copyright" content="ç¿”ä»”"><meta name="generator" content="Hexo 5.4.2"><meta name="theme" content="hexo-theme-yun"><title>Spring | ç¿”ä»”çš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"ç¿”ä»”çš„å°ç«™","version":"1.8.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="springç®€ä»‹SpringIOCä»€ä¹ˆæ˜¯iocspring beanï¼šå®šä¹‰çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„ä½œç”¨æ˜¯å®ç°æŸä¸ªåŠŸèƒ½ã€‚ iocï¼šæ§åˆ¶åè½¬ï¼Œä¸€ç§è®¾è®¡æ€æƒ³ã€‚ å°†å¯¹è±¡çš„åˆ›å»ºå·¥ä½œäº¤ç»™springæ¥å¤„ç†ï¼Œå¹¶å°†åˆ›å»ºå¥½çš„beanæ”¾åˆ°iocå®¹å™¨ä¸­ç®¡ç†æ•´ä¸ªå£°æ˜å‘¨æœŸ DIï¼šä¾èµ–æ³¨å…¥ï¼Œå®ç°æ–¹å¼ï¼Œå°†å®¹å™¨ä¸­çš„beanæ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ ä½¿ç”¨iocä¹‹å‰ï¼š    ä½¿ç”¨iocä¹‹åï¼š     åº”ç”¨ç¨‹åºä¾èµ–äºiocå®¹å™¨ç®¡ç†çš„beanç»„">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://example.com/2022/09/07/Spring/index.html">
<meta property="og:site_name" content="ç¿”ä»”çš„åšå®¢">
<meta property="og:description" content="springç®€ä»‹SpringIOCä»€ä¹ˆæ˜¯iocspring beanï¼šå®šä¹‰çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„ä½œç”¨æ˜¯å®ç°æŸä¸ªåŠŸèƒ½ã€‚ iocï¼šæ§åˆ¶åè½¬ï¼Œä¸€ç§è®¾è®¡æ€æƒ³ã€‚ å°†å¯¹è±¡çš„åˆ›å»ºå·¥ä½œäº¤ç»™springæ¥å¤„ç†ï¼Œå¹¶å°†åˆ›å»ºå¥½çš„beanæ”¾åˆ°iocå®¹å™¨ä¸­ç®¡ç†æ•´ä¸ªå£°æ˜å‘¨æœŸ DIï¼šä¾èµ–æ³¨å…¥ï¼Œå®ç°æ–¹å¼ï¼Œå°†å®¹å™¨ä¸­çš„beanæ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ ä½¿ç”¨iocä¹‹å‰ï¼š    ä½¿ç”¨iocä¹‹åï¼š     åº”ç”¨ç¨‹åºä¾èµ–äºiocå®¹å™¨ç®¡ç†çš„beanç»„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-1.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-2.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-source-9.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/16ab581d21947171_tplv-t2oaga2asx-zoom-in-crop-mark_3024_0_0_0.awebp">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-source-100.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662987362760.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662987004411.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662987193290.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662990953859.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662779610485.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-source-102.png">
<meta property="og:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/1662950526009.png">
<meta property="article:published_time" content="2022-09-07T14:44:21.000Z">
<meta property="article:modified_time" content="2022-09-12T15:49:41.444Z">
<meta property="article:author" content="ç¿”ä»”">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/09/07/Spring/study/blog/blog/source_posts/Spring/spring-framework-ioc-1.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ç¿”ä»”"><img width="96" loading="lazy" src="/images/tx.jpg" alt="ç¿”ä»”"><span class="site-author-status" title="ä¸æƒ³ä¸Šå­¦">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">ç¿”ä»”</a></div><span class="site-name">ç¿”ä»”çš„åšå®¢</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="æˆ‘çš„ä¸»é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">28</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=910426929&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="985391895@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#spring%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">springç®€ä»‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringIOC"><span class="toc-number">2.</span> <span class="toc-text">SpringIOC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFioc"><span class="toc-number">2.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯ioc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC%E9%85%8D%E7%BD%AE%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">IOCé…ç½®ä¸‰ç§æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">XMLé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">javaé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.3.</span> <span class="toc-text">æ³¨è§£é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">ä¾èµ–æ³¨å…¥ä¸‰ç§æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setter%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.1.</span> <span class="toc-text">setteræ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.2.</span> <span class="toc-text">æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5"><span class="toc-number">2.3.3.</span> <span class="toc-text">æ³¨è§£æ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC%E4%B8%8EDI%E5%B0%8F%E7%BB%93"><span class="toc-number">2.4.</span> <span class="toc-text">IOCä¸DIå°ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8E%A8%E8%8D%90%E9%80%82%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%96%B9%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆæ¨èé€‚ç”¨æ„é€ å™¨æ–¹å¼æ³¨å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Autowired%E5%92%8C-Resource%E4%BB%A5%E5%8F%8A-Inject%E7%AD%89%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5%E6%9C%89%E4%BD%95%E5%8C%BA%E5%88%AB"><span class="toc-number">2.4.2.</span> <span class="toc-text">@Autowiredå’Œ@Resourceä»¥åŠ@Injectç­‰æ³¨è§£æ³¨å…¥æœ‰ä½•åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ioc%E4%B9%8BbeanFactory%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.5.</span> <span class="toc-text">iocä¹‹beanFactoryåˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ioc%E4%B9%8Bbean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">2.6.</span> <span class="toc-text">iocä¹‹beançš„å®ä¾‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory"><span class="toc-number">2.6.1.</span> <span class="toc-text">BeanFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory%E4%B8%AD%E7%9A%84getBean%E7%9A%84%E4%B8%BB%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="toc-number">2.6.2.</span> <span class="toc-text">BeanFactoryä¸­çš„getBeançš„ä¸»ä½“æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">ä¸»ä½“æ€è·¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-number">2.6.3.</span> <span class="toc-text">å¾ªç¯ä¾èµ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">ä¸‰çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.6.4.</span> <span class="toc-text">Beançš„ç”Ÿå‘½å‘¨æœŸ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringAop"><span class="toc-number">3.</span> <span class="toc-text">SpringAop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">å¸¸è§é¢è¯•é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%B0%88%E8%B0%88spring%E7%90%86%E8%A7%A3%EF%BC%8C%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E7%8E%B0%EF%BC%9F"><span class="toc-number">4.1.</span> <span class="toc-text">1ã€è°ˆè°ˆspringç†è§£ï¼ŒåŸç†å’Œå®ç°ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%B0%88%E8%B0%88springioc%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">2ã€è°ˆè°ˆspringiocçš„åº•å±‚å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%8F%8F%E8%BF%B0%E4%BB%A5%E4%B8%8BBean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">4.3.</span> <span class="toc-text">3ã€æè¿°ä»¥ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Spring%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98"><span class="toc-number">4.4.</span> <span class="toc-text">4ã€Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E7%BC%93%E5%AD%98%E6%94%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E5%92%8C%E5%88%A0%E9%99%A4%E6%97%B6%E9%97%B4"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.1ç¼“å­˜æ”¾ç½®æ—¶é—´å’Œåˆ é™¤æ—¶é—´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81BeanFactory%E4%B8%8EFactoryBean"><span class="toc-number">4.5.</span> <span class="toc-text">5ã€BeanFactoryä¸FactoryBean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81spring%E4%B8%AD%E7%94%A8%E5%88%B0%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.6.</span> <span class="toc-text">6ã€springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81spring%E7%9A%84aop%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">4.7.</span> <span class="toc-text">7ã€springçš„aopåº•å±‚åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81spring%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E5%9B%9E%E6%BB%9A"><span class="toc-number">4.8.</span> <span class="toc-text">8ã€springäº‹åŠ¡å¦‚ä½•å›æ»š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E8%B0%88%E4%B8%80%E4%B8%8Bspring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD"><span class="toc-number">4.9.</span> <span class="toc-text">9ã€è°ˆä¸€ä¸‹springäº‹åŠ¡ä¼ æ’­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81spring%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.10.</span> <span class="toc-text">10ã€springäº‹åŠ¡éš”ç¦»çº§åˆ«</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2022/09/07/Spring/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ç¿”ä»”"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ç¿”ä»”çš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Spring</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-07 22:44:21" itemprop="dateCreated datePublished" datetime="2022-09-07T22:44:21+08:00">2022-09-07</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-12 23:49:41" itemprop="dateModified" datetime="2022-09-12T23:49:41+08:00">2022-09-12</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%A1%86%E6%9E%B6/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æ¡†æ¶</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/spring/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">spring</span></a></span></div><div class="post-author"><span class="author-name">ç¿”ä»”</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="springç®€ä»‹"><a href="#springç®€ä»‹" class="headerlink" title="springç®€ä»‹"></a>springç®€ä»‹</h1><h1 id="SpringIOC"><a href="#SpringIOC" class="headerlink" title="SpringIOC"></a>SpringIOC</h1><h2 id="ä»€ä¹ˆæ˜¯ioc"><a href="#ä»€ä¹ˆæ˜¯ioc" class="headerlink" title="ä»€ä¹ˆæ˜¯ioc"></a>ä»€ä¹ˆæ˜¯ioc</h2><p><strong>spring beanï¼š</strong>å®šä¹‰çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„ä½œç”¨æ˜¯å®ç°æŸä¸ªåŠŸèƒ½ã€‚</p>
<p><strong>iocï¼šæ§åˆ¶åè½¬</strong>ï¼Œä¸€ç§è®¾è®¡æ€æƒ³ã€‚</p>
<p>å°†å¯¹è±¡çš„åˆ›å»ºå·¥ä½œäº¤ç»™springæ¥å¤„ç†ï¼Œå¹¶å°†åˆ›å»ºå¥½çš„beanæ”¾åˆ°iocå®¹å™¨ä¸­ç®¡ç†æ•´ä¸ªå£°æ˜å‘¨æœŸ</p>
<p><strong>DIï¼šä¾èµ–æ³¨å…¥</strong>ï¼Œå®ç°æ–¹å¼ï¼Œå°†å®¹å™¨ä¸­çš„beanæ³¨å…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</p>
<p>ä½¿ç”¨iocä¹‹å‰ï¼š</p>
<p> <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\spring-framework-ioc-1.png" alt="img" loading="lazy"> </p>
<p>ä½¿ç”¨iocä¹‹åï¼š</p>
<p> <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\spring-framework-ioc-2.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>åº”ç”¨ç¨‹åºä¾èµ–äºiocå®¹å™¨ç®¡ç†çš„beanç»„ä»¶ï¼ˆå³å¯¹è±¡èµ„æºï¼‰ï¼Œiocå®¹å™¨æ³¨å…¥åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„å¯¹è±¡èµ„æº</p>
</blockquote>
<h2 id="IOCé…ç½®ä¸‰ç§æ–¹å¼"><a href="#IOCé…ç½®ä¸‰ç§æ–¹å¼" class="headerlink" title="IOCé…ç½®ä¸‰ç§æ–¹å¼"></a>IOCé…ç½®ä¸‰ç§æ–¹å¼</h2><h3 id="XMLé…ç½®"><a href="#XMLé…ç½®" class="headerlink" title="XMLé…ç½®"></a>XMLé…ç½®</h3><p>å°†beanä¿¡æ¯é…ç½®åˆ°xmlæ–‡ä»¶ä¸­ï¼Œé€šè¿‡springåŠ è½½æ–‡ä»¶æ¥åˆ›å»ºbeanã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥é€‚ç”¨ä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œé€šä¿—æ˜“æ‡‚</li>
<li>ç¼ºç‚¹ï¼Œé…ç½®ç¹çï¼Œä¸å®œç»´æŠ¤ï¼Œæ‰©å±•æ€§å·®</li>
</ul>
<p><strong>ä¾‹</strong></p>
<p>1ã€é…ç½®xxx.xmlé…ç½®æ–‡ä»¶</p>
<p>2ã€å£°æ˜å‘½åç©ºé—´å’Œé…ç½®bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- services --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions for services go here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="javaé…ç½®"><a href="#javaé…ç½®" class="headerlink" title="javaé…ç½®"></a>javaé…ç½®</h3><p>å°†ç±»çš„åˆ›å»ºäº¤ç»™é…ç½®çš„javaConfigç±»æ¥å®Œæˆï¼ŒSpringåªè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ï¼Œé‡‡ç”¨çº¯javaåˆ›å»ºæ–¹å¼ã€‚å…¶æœ¬è´¨å°±æ˜¯æŠŠåœ¨xmlä¸Šçš„é…ç½®å£°æ˜è½¬ç§»åˆ°javaé…ç½®ç±»ä¸­ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š é€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œé…ç½®æ–¹ä¾¿ï¼Œå› ä¸ºæ˜¯çº¯Javaä»£ç ï¼Œæ‰©å±•æ€§é«˜ï¼Œååˆ†çµæ´» </li>
<li>ç¼ºç‚¹ ç”±äºæ˜¯é‡‡ç”¨Javaç±»çš„æ–¹å¼ï¼Œå£°æ˜ä¸æ˜æ˜¾ï¼Œå¦‚æœå¤§é‡é…ç½®ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·® </li>
</ul>
<p><strong>ä¾‹</strong></p>
<p>åˆ›å»ºä¸€ä¸ªç±»å£°æ˜ä¸ºé…ç½®ç±»ï¼Œ@Configuration</p>
<p>åˆ›å»ºä¸€ä¸ªæ–¹æ³•åŠ ä¸Š@Beanï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›ï¼Œäº¤ç»™springç®¡ç†ï¼Œæ–¹æ³•åå»ºè®®ä¸å®ä¾‹åç›¸åŒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userDao&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDaoImpl <span class="title function_">userDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user service</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserServiceImpl <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        userService.setUserDao(userDao());</span><br><span class="line">        <span class="keyword">return</span> userService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h3><p>é€šè¿‡åœ¨ç±»ä¸ŠåŠ æ³¨è§£æ–¹å¼ï¼Œæ¥å£°æ˜ä¸€ä¸ªç±»äº¤ç»™springç®¡ç†ï¼Œspringä¼šè‡ªåŠ¨æ‰«æå¸¦æœ‰@Componentï¼Œ@Controllerï¼Œ@Sericeï¼Œ@Repositoryè¿™å››ä¸ªæ³¨è§£çš„ç±»ï¼Œç„¶ååŒºåˆ›å»ºå¹¶ç®¡ç†ï¼Œå‰ææ˜¯éœ€è¦å…ˆé…ç½®springæ³¨è§£æ‰«æå™¨</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ–¹ä¾¿ç»´æŠ¤</li>
<li>ç¼ºç‚¹ï¼šå±€é™æ€§ï¼Œå¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºåªèƒ½ç”¨å‰ä¸¤ç§æ–¹å¼åŠ è½½</li>
</ul>
<p><strong>ä¾‹</strong></p>
<p>å¯¹ç±»æ·»åŠ @Componentç›¸å…³çš„æ³¨è§£ï¼Œ</p>
<p>è®¾ç½®ComponentScançš„basePackage, æ¯”å¦‚``, æˆ–è€…<code>@ComponentScan(&quot;tech.pdai.springframework&quot;)</code>æ³¨è§£ï¼Œæˆ–è€… <code>new AnnotationConfigApplicationContext(&quot;tech.pdai.springframework&quot;)</code>æŒ‡å®šæ‰«æçš„basePackage.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¾èµ–æ³¨å…¥ä¸‰ç§æ–¹å¼"><a href="#ä¾èµ–æ³¨å…¥ä¸‰ç§æ–¹å¼" class="headerlink" title="ä¾èµ–æ³¨å…¥ä¸‰ç§æ–¹å¼"></a>ä¾èµ–æ³¨å…¥ä¸‰ç§æ–¹å¼</h2><blockquote>
<p>å¸¸ç”¨ä¸‰ç§ï¼šsetteræ³¨å…¥ã€æ„é€ å™¨æ³¨å…¥ã€åŸºäºæ³¨è§£çš„æ³¨å…¥</p>
</blockquote>
<h3 id="setteræ–¹å¼"><a href="#setteræ–¹å¼" class="headerlink" title="setteræ–¹å¼"></a>setteræ–¹å¼</h3><p>åœ¨xmlé…ç½®æ–¹å¼ä¸­ï¼Œpropertyéƒ½æ˜¯setteræ–¹å¼æ³¨å…¥ï¼Œæ¯”å¦‚ä¸‹é¢çš„xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- services --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions for services go here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬è´¨ä¸ŠåŒ…å«ä¸¤æ­¥ï¼š1ã€new UserServiceImpl()åˆ›å»ºå¯¹è±¡ï¼Œéœ€è¦é»˜è®¤æ„é€ å™¨  2ã€é€šè¿‡setUserDao()æ³¨å…¥userDaoçš„å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set dao.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDao user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDaoImpl userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨æœ‰å‚æ„é€ å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDaoImpl user dao impl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserDaoImpl userDaoImpl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDaoImpl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨è§£æ³¨å…¥"><a href="#æ³¨è§£æ³¨å…¥" class="headerlink" title="æ³¨è§£æ³¨å…¥"></a>æ³¨è§£æ³¨å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IOCä¸DIå°ç»“"><a href="#IOCä¸DIå°ç»“" class="headerlink" title="IOCä¸DIå°ç»“"></a>IOCä¸DIå°ç»“</h2><h3 id="ä¸ºä»€ä¹ˆæ¨èé€‚ç”¨æ„é€ å™¨æ–¹å¼æ³¨å…¥"><a href="#ä¸ºä»€ä¹ˆæ¨èé€‚ç”¨æ„é€ å™¨æ–¹å¼æ³¨å…¥" class="headerlink" title="ä¸ºä»€ä¹ˆæ¨èé€‚ç”¨æ„é€ å™¨æ–¹å¼æ³¨å…¥"></a>ä¸ºä»€ä¹ˆæ¨èé€‚ç”¨æ„é€ å™¨æ–¹å¼æ³¨å…¥</h3><p><code>è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ³¨å…¥çš„ç»„ä»¶ä¸å¯å˜ï¼Œä¸”ç¡®ä¿éœ€è¦çš„ä¾èµ–ä¸ä¸ºç©ºï¼Œæ­¤å¤–æ„é€ å™¨æ³¨å…¥çš„ä¾èµ–æ€»æ˜¯èƒ½å¤Ÿåœ¨è¿”å›å®¢æˆ·ç«¯(ç»„ä»¶)ä»£ç çš„æ—¶å€™ä¿è¯å®Œå…¨åˆå§‹åŒ–çš„çŠ¶æ€</code></p>
<ul>
<li><strong>ä¾èµ–ä¸å¯å˜ï¼š</strong>è¿™æ˜¯finalä¿®é¥°</li>
<li><strong>éœ€è¦çš„ä¾èµ–ä¸ä¸ºç©ºï¼š</strong>å½“è¦å®ä¾‹åŒ–UserServiceImplçš„æ—¶å€™ï¼Œç”±äºè‡ªå·±å®ç°äº†æœ‰å‚æ„é€ ï¼Œä¸ä¼šè°ƒç”¨æ— å‚æ„é€ ï¼Œé‚£ä¹ˆå°±éœ€è¦springå®¹å™¨ä¼ å…¥éœ€è¦çš„å‚æ•°ï¼Œæ‰€ä»¥æœ‰ä¸¤ç§æƒ…å†µï¼š1ã€æœ‰è¯¥ç±»å‹å‚æ•°-&gt;ä¼ å…¥ 2ã€æ²¡æœ‰è¯¥ç±»å‹å‚æ•°-&gt;æŠ¥é”™</li>
<li><strong>å®Œå…¨åˆå§‹åŒ–çŠ¶æ€ï¼š</strong>å‘æ„é€ å™¨ä¼ å‚ä¹‹å‰ï¼Œè¦ç¡®ä¿æ³¨å…¥çš„å†…å®¹ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè‚¯å®šè¦è°ƒç”¨ä¾èµ–ç»„ä»¶çš„æ„é€ æ–¹æ³•å®Œæˆå®ä¾‹åŒ–ã€‚è€Œåœ¨Javaç±»åŠ è½½å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ„é€ æ–¹æ³•æ˜¯æœ€åä¸€æ­¥ï¼ˆä¹‹å‰å¦‚æœæœ‰çˆ¶ç±»å…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼Œç„¶åè‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œæœ€åæ‰æ˜¯æ„é€ æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥è¿”å›æ¥çš„éƒ½æ˜¯åˆå§‹åŒ–ä¹‹åçš„çŠ¶æ€ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDaoImpl user dao impl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(<span class="keyword">final</span> UserDaoImpl userDaoImpl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDaoImpl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé€‚ç”¨setteræ³¨å…¥ï¼Œå¯¹äºiocæ„å¤–ç¯å¢ƒï¼Œé™¤äº†ä½¿ç”¨åå°„æ¥æé«˜éœ€è¦çš„ä¾èµ–å¤–ï¼Œæ— æ³•å¤ç”¨è¯¥å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œæ­£å¸¸æ¥è¯´æˆ‘ä»¬åªä¼šæš´éœ²æ¥å£ç»™å®¢æˆ·ç«¯ï¼Œä¸ä¼šæš´éœ²å®ç°ã€‚</span></span><br><span class="line"><span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">userService.findUserList(); <span class="comment">// -&gt; NullPointerException, æ½œåœ¨çš„éšæ‚£</span></span><br></pre></td></tr></table></figure>

<p><strong>å¾ªç¯ä¾èµ–é—®é¢˜ï¼š</strong>ä½¿ç”¨fieldæ³¨å…¥å¯èƒ½ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–ï¼Œå³Aé‡Œé¢æ³¨å…¥Bï¼ŒBé‡Œé¢æ³¨å…¥A</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> B b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> A a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œåœ¨springé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºï¼šBeanCurrentlyInCreationExceptionï¼šRequested bean is currently in creation: Is there an unresolvable circular referenceï¼Ÿä»è€Œæé†’ä½ é¿å…å¾ªç¯ä¾èµ–ï¼Œå¦‚æœæ˜¯fieldæ³¨å…¥çš„è¯ï¼Œå¯åŠ¨çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ï¼Œåœ¨ä½¿ç”¨é‚£ä¸ªbeançš„æ—¶å€™æ‰ä¼šæŠ¥é”™ã€‚</p>
<h3 id="Autowiredå’Œ-Resourceä»¥åŠ-Injectç­‰æ³¨è§£æ³¨å…¥æœ‰ä½•åŒºåˆ«"><a href="#Autowiredå’Œ-Resourceä»¥åŠ-Injectç­‰æ³¨è§£æ³¨å…¥æœ‰ä½•åŒºåˆ«" class="headerlink" title="@Autowiredå’Œ@Resourceä»¥åŠ@Injectç­‰æ³¨è§£æ³¨å…¥æœ‰ä½•åŒºåˆ«"></a>@Autowiredå’Œ@Resourceä»¥åŠ@Injectç­‰æ³¨è§£æ³¨å…¥æœ‰ä½•åŒºåˆ«</h3><p><strong>@Autowired</strong></p>
<ul>
<li><p>æ³¨è§£æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">  <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¯ä»¥ä½¿ç”¨åœ¨ä»¥ä¸‹åœ°æ–¹ï¼š</span></span><br><span class="line"><span class="comment">	@Target(ElementType.CONSTRUCTOR) #æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">	@Target(ElementType.METHOD) #æ–¹æ³•</span></span><br><span class="line"><span class="comment">	@Target(ElementType.PARAMETER) #æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment">	@Target(ElementType.FIELD) #å­—æ®µã€æšä¸¾çš„å¸¸é‡</span></span><br><span class="line"><span class="comment">	@Target(ElementType.ANNOTATION_TYPE) #æ³¨è§£</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	è¿˜æœ‰ä¸€ä¸ªvalueå±æ€§ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“</p>
<ul>
<li>@Autowiredæ˜¯springè‡ªå¸¦æ³¨è§£ï¼Œé€šè¿‡ AutowiredAnnotationBeanPostProcessor  ç±»å®ç°ä¾èµ–æ³¨å…¥</li>
<li>å¯ä»¥ä½œç”¨åœ¨æ„é€ å‡½æ•°ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ã€å­—æ®µã€æ³¨è§£</li>
<li>é»˜è®¤æ ¹æ®ç±»å‹è£…é…</li>
<li>å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„beanå€™é€‰è€…ï¼Œéœ€è¦æŒ‡å®šæŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œé…åˆ@Qualifierã€‚æŒ‡å®šåç§°åå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”beanä¼šæŠ›å‡º NoSuchBeanDefinitionException ï¼Œä¹Ÿå¯ä»¥å°†requiredè®¾ä¸ºfalseï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¹Ÿä¸ä¼šæŠ›å¼‚å¸¸</li>
</ul>
</li>
<li><p>ç®€å•ä½¿ç”¨</p>
<p>å­—æ®µå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æ„é€ æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="keyword">public</span> HelloDao <span class="title function_">getHelloDao</span><span class="params">()</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> helloDao;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloDao</span><span class="params">(HelloDao helloDao)</span> &#123;</span><br><span class="line"> <span class="built_in">this</span>.helloDao = helloDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="comment">//@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HelloServiceImpl</span><span class="params">(<span class="meta">@Autowired</span> HelloDao helloDao)</span> &#123;</span><br><span class="line"> <span class="built_in">this</span>.helloDao = helloDao;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ„é€ å™¨æ³¨å…¥ä¹Ÿå¯ä¸å†™@Autowiredï¼Œä¹Ÿå¯ä»¥æ³¨å…¥æˆåŠŸã€‚</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰å¤šä¸ªå€™é€‰è€…ï¼Œä¼šæ ¹æ®åç§°è£…é…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;helloWorldDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é˜²æ­¢è£…é…ä¸æˆåŠŸæ—¶æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;xxxxyyyy&quot;)</span></span><br><span class="line"><span class="meta">@Autowired(required = false)</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>@Resource</strong></p>
<ul>
<li><p>æ³¨è§£æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;TYPE, FIELD, METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Resource &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// å…¶ä»–çœç•¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">@Target(ElementType.TYPE) #æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£</span></span><br><span class="line"><span class="comment">@Target(ElementType.FIELD) #å­—æ®µã€æšä¸¾çš„å¸¸é‡</span></span><br><span class="line"><span class="comment">@Target(ElementType.METHOD) #æ–¹æ³•</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">nameæŒ‡å®šæ³¨å…¥æŒ‡å®šåç§°çš„ç»„ä»¶</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“</p>
<ul>
<li>åœ¨javax.annotationåŒ…ä¸‹</li>
<li>ä½œç”¨åœ¨æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£ã€å­—æ®µã€æ–¹æ³•</li>
<li>æ ¹æ®å±æ€§åç§°è‡ªåŠ¨è£…é…</li>
<li>é»˜è®¤æ ¹æ®åç§°è£…é…ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„beanå€™é€‰ï¼Œå¯ä»¥é€šè¿‡nameæŒ‡å®šæ³¨å…¥</li>
</ul>
</li>
<li><p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‰ç…§å±æ€§åç§° car æ³¨å…¥å®¹å™¨ä¸­çš„ç»„ä»¶ã€‚å¦‚æœå®¹å™¨ä¸­BMWè¿˜æœ‰BYDä¸¤ç§ç±»å‹ç»„ä»¶ã€‚æŒ‡å®šåŠ å…¥BMWã€‚</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;BMW&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nameçš„ä½œç”¨ç±»ä¼¼äº@Qualifier</p>
</li>
</ul>
<p><strong>@Inject</strong></p>
<ul>
<li><p>æ³¨è§£æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123; METHOD, CONSTRUCTOR, FIELD &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Inject &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">@Target(ElementType.CONSTRUCTOR) #æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">@Target(ElementType.METHOD) #æ–¹æ³•</span></span><br><span class="line"><span class="comment">@Target(ElementType.FIELD) #å­—æ®µã€æšä¸¾çš„å¸¸é‡</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“</p>
<ul>
<li>å¯¼å…¥javax.inject.Inject.jaråŒ…</li>
<li>å¯ä»¥ä½œç”¨åœ¨æ„é€ å™¨ã€æ–¹æ³•ã€å­—æ®µã€æšä¸¾çš„å¸¸é‡</li>
<li>é»˜è®¤æ ¹æ®ç±»å‹è‡ªåŠ¨iè£…é…ï¼Œå¦‚æœéœ€è¦æŒ‰ç…§åç§°è£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named</li>
</ul>
</li>
<li><p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šåŠ å…¥BMWç»„ä»¶</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Named(&quot;BMW&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“</p>
<ul>
<li>@Autowiredå’Œ@Injectç”¨æ³•åŸºæœ¬ä¸€æ ·ï¼Œåè€…æ²¡æœ‰@Requiredå±æ€§</li>
<li>@Autowiredå’Œ@Injectæ˜¯é»˜è®¤æŒ‰ç…§ç±»å‹åŒ¹é…ï¼Œ@ResourceæŒ‰ç…§åç§°åŒ¹é…</li>
<li> @Autowiredå¦‚æœéœ€è¦æŒ‰ç…§åç§°åŒ¹é…éœ€è¦å’Œ@Qualifierä¸€èµ·ä½¿ç”¨ï¼Œ@Injectå’Œ@Namedä¸€èµ·ä½¿ç”¨ï¼Œ@Resourceåˆ™é€šè¿‡nameè¿›è¡ŒæŒ‡å®š </li>
</ul>
</li>
</ul>
<h2 id="iocä¹‹beanFactoryåˆå§‹åŒ–"><a href="#iocä¹‹beanFactoryåˆå§‹åŒ–" class="headerlink" title="iocä¹‹beanFactoryåˆå§‹åŒ–"></a>iocä¹‹beanFactoryåˆå§‹åŒ–</h2><p><a target="_blank" rel="noopener" href="https://javadoop.com/post/spring-ioc">https://javadoop.com/post/spring-ioc</a></p>
<blockquote>
<p>beanFactoryçš„åˆå§‹åŒ–ä¸»è¦åŒ…æ‹¬ï¼Œåˆ›å»ºå®¹å™¨å¹¶ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½ã€è§£æï¼Œç”Ÿæˆbeançš„å®šä¹‰å¯¹è±¡beanDefinitionå®ä¾‹æ³¨å†Œåˆ°å®¹å™¨</p>
</blockquote>
<p>iocå®¹å™¨å¯ä»¥ç®€å•ç†è§£ä¸ºçº¿ç¨‹å®‰å…¨çš„mapç»“æ„ï¼Œspringå¯ä»¥é€šè¿‡è¯»å–xmlé…ç½®æ–‡ä»¶æˆ–ä½¿ç”¨æ³¨è§£é…ç½®ç±»ç”Ÿæˆä¸€ä¸ªBeanDefinitionæ”¾å…¥åˆ°å®¹å™¨ä¸­ï¼Œè·å–æ—¶é€šè¿‡åå°„æŠ€æœ¯å°†BeanDefinitionå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªbeanå®ä¾‹ä»¥åŠå®Œæˆåˆå§‹åŒ–ã€‚</p>
<p>IOCå®¹å™¨çš„åˆå§‹åŒ–ï¼Œ<strong>å¯ä»¥æ¦‚æ‹¬ä¸ºbeanFactoryçš„åˆ›å»ºå’ŒBeanDefinitionçš„å»ºç«‹å’Œæ³¨å†Œåˆ°å®¹å™¨</strong></p>
<p>SpringIOCå®¹å™¨å¯¹å®šä¹‰èµ„æºçš„è½½å…¥æ˜¯ä»refresh()å‡½æ•°å¼€å§‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">   <span class="comment">// æ¥ä¸ªé”ï¼Œä¸ç„¶ refresh() è¿˜æ²¡ç»“æŸï¼Œä½ åˆæ¥ä¸ªå¯åŠ¨æˆ–é”€æ¯å®¹å™¨çš„æ“ä½œï¼Œé‚£ä¸å°±ä¹±å¥—äº†å˜›</span></span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‡†å¤‡å·¥ä½œï¼Œè®°å½•ä¸‹å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€æ ‡è®°â€œå·²å¯åŠ¨â€çŠ¶æ€ã€å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿™æ­¥æ¯”è¾ƒå…³é”®ï¼Œè¿™æ­¥å®Œæˆåï¼Œé…ç½®æ–‡ä»¶å°±ä¼šè§£ææˆä¸€ä¸ªä¸ª Bean å®šä¹‰ï¼Œæ³¨å†Œåˆ° BeanFactory ä¸­ï¼Œ</span></span><br><span class="line">      <span class="comment">// å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ Bean è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œåªæ˜¯é…ç½®ä¿¡æ¯éƒ½æå–å‡ºæ¥äº†ï¼Œ</span></span><br><span class="line">      <span class="comment">// æ³¨å†Œä¹Ÿåªæ˜¯å°†è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åˆ°äº†æ³¨å†Œä¸­å¿ƒ(è¯´åˆ°åº•æ ¸å¿ƒæ˜¯ä¸€ä¸ª beanName-&gt; beanDefinition çš„ map)</span></span><br><span class="line">      <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è®¾ç½® BeanFactory çš„ç±»åŠ è½½å™¨ï¼Œæ·»åŠ å‡ ä¸ª BeanPostProcessorï¼Œæ‰‹åŠ¨æ³¨å†Œå‡ ä¸ªç‰¹æ®Šçš„ bean</span></span><br><span class="line">      <span class="comment">// è¿™å—å¾…ä¼šä¼šå±•å¼€è¯´</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// ã€è¿™é‡Œéœ€è¦çŸ¥é“ BeanFactoryPostProcessor è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼ŒBean å¦‚æœå®ç°äº†æ­¤æ¥å£ï¼Œ</span></span><br><span class="line">         <span class="comment">// é‚£ä¹ˆåœ¨å®¹å™¨åˆå§‹åŒ–ä»¥åï¼ŒSpring ä¼šè´Ÿè´£è°ƒç”¨é‡Œé¢çš„ postProcessBeanFactory æ–¹æ³•ã€‚ã€‘</span></span><br><span class="line"></span><br><span class="line">         <span class="comment">// è¿™é‡Œæ˜¯æä¾›ç»™å­ç±»çš„æ‰©å±•ç‚¹ï¼Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Bean éƒ½åŠ è½½ã€æ³¨å†Œå®Œæˆäº†ï¼Œä½†æ˜¯éƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–</span></span><br><span class="line">         <span class="comment">// å…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™æ­¥çš„æ—¶å€™æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„ BeanFactoryPostProcessor çš„å®ç°ç±»æˆ–åšç‚¹ä»€ä¹ˆäº‹</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line">         <span class="comment">// è°ƒç”¨ BeanFactoryPostProcessor å„ä¸ªå®ç°ç±»çš„ postProcessBeanFactory(factory) æ–¹æ³•</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ³¨å†Œ BeanPostProcessor çš„å®ç°ç±»ï¼Œæ³¨æ„çœ‹å’Œ BeanFactoryPostProcessor çš„åŒºåˆ«</span></span><br><span class="line">         <span class="comment">// æ­¤æ¥å£ä¸¤ä¸ªæ–¹æ³•: postProcessBeforeInitialization å’Œ postProcessAfterInitialization</span></span><br><span class="line">         <span class="comment">// ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åœ¨ Bean åˆå§‹åŒ–ä¹‹å‰å’Œåˆå§‹åŒ–ä¹‹åå¾—åˆ°æ‰§è¡Œã€‚æ³¨æ„ï¼Œåˆ°è¿™é‡Œ Bean è¿˜æ²¡åˆå§‹åŒ–</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åˆå§‹åŒ–å½“å‰ ApplicationContext çš„ MessageSourceï¼Œå›½é™…åŒ–è¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ï¼Œä¸ç„¶æ²¡å®Œæ²¡äº†äº†</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åˆå§‹åŒ–å½“å‰ ApplicationContext çš„äº‹ä»¶å¹¿æ’­å™¨ï¼Œè¿™é‡Œä¹Ÿä¸å±•å¼€äº†</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// ä»æ–¹æ³•åå°±å¯ä»¥çŸ¥é“ï¼Œå…¸å‹çš„æ¨¡æ¿æ–¹æ³•(é’©å­æ–¹æ³•)ï¼Œ</span></span><br><span class="line">         <span class="comment">// å…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ–ä¸€äº›ç‰¹æ®Šçš„ Beanï¼ˆåœ¨åˆå§‹åŒ– singleton beans ä¹‹å‰ï¼‰</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬å™¨éœ€è¦å®ç° ApplicationListener æ¥å£ã€‚è¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œè¿‡</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// é‡ç‚¹ï¼Œé‡ç‚¹ï¼Œé‡ç‚¹</span></span><br><span class="line">         <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beans</span></span><br><span class="line">         <span class="comment">//ï¼ˆlazy-init çš„é™¤å¤–ï¼‰</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æœ€åï¼Œå¹¿æ’­äº‹ä»¶ï¼ŒApplicationContext åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         <span class="comment">// é”€æ¯å·²ç»åˆå§‹åŒ–çš„ singleton çš„ Beansï¼Œä»¥å…æœ‰äº› bean ä¼šä¸€ç›´å ç”¨èµ„æº</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// æŠŠå¼‚å¸¸å¾€å¤–æŠ›</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>obtainFreshBeanFactoryï¼šAbstractApplicationContextçš„obtainFreshBeanFactory()æ–¹æ³•è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•ï¼Œå¯åŠ¨å®¹å™¨è½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„è¿‡ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ConfigurableListableBeanFactory <span class="title function_">obtainFreshBeanFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä½¿ç”¨äº†å§”æ´¾è®¾è®¡æ¨¡å¼ï¼Œçˆ¶ç±»å®šä¹‰äº†æŠ½è±¡çš„refreshBeanFactory()æ–¹æ³•ï¼Œå…·ä½“å®ç°è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•</span></span><br><span class="line">    refreshBeanFactory();</span><br><span class="line">    <span class="keyword">return</span> getBeanFactory();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AbstractApplicationContextç±»ä¸­åªæŠ½è±¡å®šä¹‰äº†refreshBeanFactory()æ–¹æ³•ï¼Œå®¹å™¨çœŸæ­£è°ƒç”¨çš„æ˜¯å…¶å­ç±»AbstractRefreshableApplicationContextå®ç°çš„refreshBeanFactory()æ–¹æ³•; åœ¨åˆ›å»ºIoCå®¹å™¨å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">refreshBeanFactory</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (hasBeanFactory()) &#123;</span><br><span class="line">        destroyBeans();</span><br><span class="line">        closeBeanFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºDefaultListableBeanFactoryï¼Œå¹¶è°ƒç”¨loadBeanDefinitions(beanFactory)è£…è½½beanå®šä¹‰</span></span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> createBeanFactory();</span><br><span class="line">        beanFactory.setSerializationId(getId());</span><br><span class="line">        customizeBeanFactory(beanFactory); <span class="comment">// å¯¹IoCå®¹å™¨è¿›è¡Œå®šåˆ¶åŒ–ï¼Œå¦‚è®¾ç½®å¯åŠ¨å‚æ•°ï¼Œå¼€å¯æ³¨è§£çš„è‡ªåŠ¨è£…é…ç­‰ </span></span><br><span class="line">        loadBeanDefinitions(beanFactory); <span class="comment">// è°ƒç”¨è½½å…¥Beanå®šä¹‰çš„æ–¹æ³•ï¼Œä¸»è¦è¿™é‡Œåˆä½¿ç”¨äº†ä¸€ä¸ªå§”æ´¾æ¨¡å¼ï¼Œåœ¨å½“å‰ç±»ä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå…·ä½“çš„å®ç°è°ƒç”¨å­ç±»å®¹å™¨  </span></span><br><span class="line">        <span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextException</span>(<span class="string">&quot;I/O error parsing bean definition source for &quot;</span> + getDisplayName(), ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>BeanDefinitionä»åŠ è½½åˆ°æ³¨å†Œï¼š</strong></p>
<p><strong>1ã€loadBeanDefinitions(DefaultListableBeanFactory beanFactory),å®ä¾‹åŒ–ä¸€ä¸ªxmlBeanDefinitionReaderæ¥åŠ è½½Bean</strong></p>
<p>â€‹    è¯»å–é…ç½®çš„æ“ä½œæ˜¯é€šè¿‡BeanDefinitionReaderæ¥å£å®šä¹‰çš„æ–¹æ³•å®ç°ï¼Œå› ä¸ºé…ç½®æ–‡ä»¶çš„ç±»å‹æœ‰å¤šä¸ªï¼Œå› æ­¤é€šè¿‡å£°æ˜ä¸€ä¸ªæ¥å£çš„æ–¹å¼æ¥é€šè¿‡å…·ä½“å®ç°ç±»è¯»å–æŒ‡å®šé…ç½®æ–‡ä»¶ä¿¡æ¯</p>
<p><strong>2ã€</strong>xmlBeanè¯»å–å™¨é€šè¿‡çˆ¶ç±»çš„ AbstractBeanDefinitionReader çš„<strong>loadBeanDefinitions(XmlBeanDefinitionReader reader)<strong>åŠ è½½xmlé…ç½®æ–¹å¼é‡Œçš„Beanå®šä¹‰çš„èµ„æº</strong>ï¼ˆAï¼‰</strong>å’Œæ„é€ å‡½æ•°é‡Œé…ç½®çš„Beané…ç½®æ–‡ä»¶<strong>ï¼ˆBï¼‰</strong>ï¼ˆè™½ç„¶ä¸¤ä¸ªåˆ†æ”¯ï¼Œä½†ç¬¬äºŒä¸ªåˆ†æ”¯ä¹Ÿä¼šè§£æè·¯å¾„è½¬æ¢ä¸ºResourcesè¿›å…¥4ä¸­ï¼‰</p>
<p><strong>3ã€Bï¼š</strong>åŠ è½½è°ƒç”¨çˆ¶ç±» AbstractBeanDefinitionReader çš„**loadBeanDefinitions(Stringâ€¦ locations)<strong>è¿›è€Œè°ƒç”¨</strong>loadBeanDefinitions(String location, @Nullable Set<Resource> actualResources)**æ–¹æ³•</Resource></p>
<p>â€‹    æ­¤æ–¹æ³•åšäº†ä¸¤ä»¶äº‹ï¼š1ã€è°ƒç”¨èµ„æºåŠ è½½å™¨çš„è·å–èµ„æºæ–¹æ³•resourceLoader.getResource(location)ï¼Œè·å–åˆ°è¦åŠ è½½çš„èµ„æºã€‚ 2ã€çœŸæ­£æ‰§è¡ŒåŠ è½½åŠŸèƒ½çš„æ˜¯å…¶å­ç±» XmlBeanDefinitionReaderçš„loadBeanDefinitions(resources)æ–¹æ³•ã€‚ æœ€ç»ˆä¹Ÿä¼šè¿›å…¥åˆ°**loadBeanDefinitions(Resourceâ€¦ resources)**ä¸­</p>
<p><strong>4ã€A/Bï¼šxmlBeanDefinitionReaderåŠ è½½Beanå®šä¹‰èµ„æº</strong></p>
<p>â€‹    æ‰§è¡Œ**loadBeanDefinitions(Resourceâ€¦ resources)**æ–¹æ³•ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæ¯ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªresourceï¼Œå†…éƒ¨è°ƒç”¨loadBeanDefinitions(resource)æ–¹æ³•ï¼Œæœ€åè¿”å›ä¸€ä¸ªåŠ è½½äº†å¤šå°‘ä¸ªBeanDefinition</p>
<p>â€‹    (1)loadBeanDefinitions(resource) â€”&gt; (2)loadBeanDefinitions(EncodedResource encodedResource) â€”&gt; (3)doLoadBeanDefinitions(InputSource inputSource, Resource resource)</p>
<p>â€‹    doLoadBeanDefinitionsæ–¹æ³•è¿›è¡Œä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯å°†beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼›å¦ä¸€ä¸ªæ“ä½œæ˜¯registerBeanDefinitions(Document doc, Resource resource)è§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶</p>
<p><strong>5ã€XmlBeanDefinitionReaderè§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶</strong></p>
<p>â€‹    XmlBeanDefinitionReaderç±»ä¸­çš„doLoadBeanDefinitionsæ–¹æ³•æ˜¯ä»ç‰¹å®šXMLæ–‡ä»¶ä¸­å®é™…è½½å…¥Beanå®šä¹‰èµ„æºçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è½½å…¥Beanå®šä¹‰èµ„æºä¹‹åå°†å…¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼Œæ¥ä¸‹æ¥è°ƒç”¨registerBeanDefinitionså¯åŠ¨Spring IoCå®¹å™¨å¯¹Beanå®šä¹‰çš„è§£æè¿‡ç¨‹ï¼Œå³registerBeanDefinitions()æ–¹æ³•</p>
<blockquote>
<p>Beanå®šä¹‰èµ„æºçš„è½½å…¥å’Œè§£æåˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š1ã€é€šè¿‡XMLè§£æå™¨å°†Beanå®šä¹‰èµ„æºæ–‡ä»¶è½¬æ¢å¾—åˆ°documentå¯¹è±¡ã€‚2ã€æŒ‰ç…§Springçš„Beanè§„åˆ™å¯¹doxumentå¯¹è±¡è§£æ</p>
<p>è§£æçš„è¿‡ç¨‹æ˜¯åœ¨BeanDefinitionDocumentReaderçš„å®ç°ç±» DefaultBeanDefinitionDocumentReaderä¸­å®ç°çš„ã€‚ </p>
</blockquote>
<p>â€‹    é€šè¿‡è°ƒç”¨BeanDefinitionDocumentReaderçš„å®ç°ç±»<strong>DefaultBeanDefinitionDocumentReader</strong>ä¸­çš„**registerBeanDefinitions(Document doc, XmlReaderContext readerContext)**æ–¹æ³•è¿›è¡Œè§£ædocumentå¯¹è±¡ã€‚</p>
<p>â€‹    æ­¤æ–¹æ³•å†…éƒ¨ç”±è°ƒç”¨**doRegisterBeanDefinitions(Element root)<strong>ï¼Œæ­¤æ–¹æ³•ä¸ºregisterBeanDefinitions()æ–¹æ³•çš„çœŸæ­£å®ç°ã€‚å…¶ä¸­çš„æ ¸å¿ƒæ–¹æ³•ä¸º</strong>parseBeanDefinitions(root, this.delegate)**ä»documentæ ¹èŠ‚ç‚¹å¼€å§‹è§£ææ­¤å¯¹è±¡</p>
<p>â€‹    parseBeanDefinitions()æ–¹æ³•çš„å†…éƒ¨å®ç°ï¼Œæ ¹æ®ä¸åŒçš„é…ç½®æœ‰ä¸¤ä¸ªæ–¹æ³•èµ°å‘ï¼š1ã€default namespaceæ¶‰åŠçš„æ ‡ç­¾èµ°å‘parseDefaultElement(ele, delegate)ï¼›2ã€å…¶ä»–namespaceçš„å…ƒç´ èµ°å‘parseCustomElement(ele)ã€‚</p>
<p>â€‹    parseDefaultElement(ele, delegate)æ–¹æ³•ä¸­å¯¹äºbeanæ ‡ç­¾çš„è§£æå¯¹åº”è°ƒç”¨<strong>processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate)<strong>æ–¹æ³•ï¼Œå†…éƒ¨å…ˆæ˜¯ç”Ÿæˆäº†ä¸€</strong>BeanDefinitionHolder</strong>å®ä¾‹ï¼›æ¥ç€é€šè¿‡<strong>BeanDefinitionReaderUtils.registerBeanDefinition()<strong>æ–¹æ³•å®ç°å¯¹è§£æåçš„BeanDefinitionåœ¨iocå®¹å™¨çš„</strong>æ³¨å†Œ</strong></p>
<blockquote>
<p>default namespace æ¶‰åŠåˆ°çš„å°±å››ä¸ªæ ‡ç­¾ <import>ã€<alias>ã€<bean> å’Œ <beans></beans></bean></alias></import></p>
<p><strong>BeanDefinitionHolder</strong>é‡Œé¢æ˜¯ä¸€ä¸ªBeanDefinitionå’Œå®ƒçš„beanNameã€aliasesä¸‰ä¸ªä¿¡æ¯</p>
</blockquote>
<p><strong>6ã€è§£æè¿‡åçš„BeanDefinitionåœ¨IOCå®¹å™¨çš„æ³¨å†Œ</strong></p>
<p>â€‹    Documentå¯¹è±¡ç»è¿‡è§£æåå¾—åˆ°å°è£…BeanDefinitionçš„ <strong>BeanDefinitionHold</strong> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<strong>BeanDefinitionReaderUtils.registerBeanDefinition()<strong>æ–¹æ³•å‘IOCå®¹å™¨æ³¨å†Œè§£æçš„Beanã€‚å†…éƒ¨é€šè¿‡è°ƒç”¨</strong>BeanDefinitionReaderUtils.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition())<strong>æ–¹æ³•å®ŒæˆçœŸæ­£çš„æ³¨å†Œï¼›</strong>åŒæ—¶</strong>å¦‚æœæœ‰åˆ«åçš„è¯ï¼Œä¹Ÿè¦æ ¹æ®åˆ«åæ³¨å†Œä¸€éï¼Œä»¥mapç»“æ„å­˜å‚¨ï¼šalias-&gt;beanName</p>
<p>â€‹    **BeanDefinitionReaderUtils.registerBeanDefinition()**æ˜¯ç”± IOC å®ç° BeanDefinitionRegistry æ¥å£æ¥å®ç° å³DafultListableBeanFactoryã€‚</p>
<p>â€‹    DafultListableBeanFactoryè°ƒç”¨<strong>registerBeanDefinition()<strong>æ–¹æ³•å®ŒæˆçœŸæ­£çš„æ³¨å†Œã€‚IOCå®¹å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªbeanDefinitionMapï¼Œæ³¨å†Œå³å°†beanDefinition putåˆ°ä¸€ä¸ª</strong>ConcurrentHashMap</strong>ä¸­ã€‚å†…éƒ¨çš„å®ç°ä¸­å¦‚æœå·²ç»æ³¨å†Œï¼Œé‚£ä¹ˆä¼šæ£€æŸ¥æ˜¯å¦å…è®¸è¦†ç›–(ä¸€å¼€å§‹åˆ›å»ºbeanFactoryæ—¶ä¼šè®¾ç½®å‚æ•°)ã€‚å¦‚æœæ²¡æœ‰æ³¨å†Œï¼Œåˆ™putåˆ°beanDefinitionMapä¸­åŒæ—¶ä¼šå°†æ¯ä¸€ä¸ªæ³¨å†Œçš„beanNameä¿å­˜åˆ°ArrayListä¸­ã€‚</p>
<p>7ã€è‡³æ­¤ï¼ŒBeanå®šä¹‰èµ„æºæ–‡ä»¶ä¸­é…ç½®çš„Beanè¢«è§£æè¿‡åï¼Œå·²ç»æ³¨å†Œåˆ°IoCå®¹å™¨ä¸­ï¼Œè¢«å®¹å™¨ç®¡ç†èµ·æ¥ï¼ŒçœŸæ­£å®Œæˆäº†IoCå®¹å™¨åˆå§‹åŒ–æ‰€åšçš„å…¨éƒ¨å·¥ä½œã€‚ç°  åœ¨IoCå®¹å™¨ä¸­å·²ç»å»ºç«‹äº†æ•´ä¸ªBeançš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›BeanDefinitionä¿¡æ¯å·²ç»å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è¢«æ£€ç´¢ï¼ŒIoCå®¹å™¨çš„ä½œç”¨å°±æ˜¯å¯¹è¿™äº›æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯è¿›è¡Œå¤„ç†å’Œç»´æŠ¤ã€‚è¿™äº›çš„æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯æ˜¯IoCå®¹å™¨æ§åˆ¶åè½¬çš„åŸºç¡€ï¼Œæ­£æ˜¯æœ‰äº†è¿™äº›æ³¨å†Œçš„æ•°æ®ï¼Œå®¹å™¨æ‰å¯ä»¥è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</p>
<p> <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\spring-framework-ioc-source-9.png" alt="img" loading="lazy"> </p>
<h2 id="iocä¹‹beançš„å®ä¾‹åŒ–"><a href="#iocä¹‹beançš„å®ä¾‹åŒ–" class="headerlink" title="iocä¹‹beançš„å®ä¾‹åŒ–"></a>iocä¹‹beançš„å®ä¾‹åŒ–</h2><blockquote>
<p>springä¸»è¦é€šè¿‡å°†èµ„æºé…ç½®åŠ è½½ã€è§£æï¼Œç”ŸæˆBeanDefinitionå¹¶æ³¨å†Œåˆ°iocå®¹å™¨ä¸­ï¼Œå®¹å™¨ä¸­å­˜æ”¾çš„æ˜¯Beançš„å®šä¹‰å³BeanDefinitionæ”¾åˆ°BeanDefinitionMapä¸­ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª ConcurrentHashMap&lt;String, Object&gt; ã€‚æ¥ç€ä¾¿æ˜¯ä»BeanDefinitionä¸­å®ä¾‹åŒ–Beanå®ä¾‹</p>
</blockquote>
<h3 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h3><p>BeanFactoryæ˜¯springæä¾›çš„ç”¨äºè·å–beanå®ä¾‹çš„æ¥å£ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼ŒgetBean()ï¼Œé€šè¿‡è¯¥æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ªbeanå®ä¾‹ã€‚åœ¨springä¸­è¯¥æ¥å£ç”±DefaultListableBeanFactoryå®ç°ï¼ŒçœŸæ­£çš„ä¸šåŠ¡å¤„ç†åœ¨AbstractBeanFactoryç±»ã€‚é€šè¿‡å¦‚ä¸‹</p>
<p> <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\16ab581d21947171_tplv-t2oaga2asx-zoom-in-crop-mark_3024_0_0_0.awebp" alt="img" loading="lazy"> </p>
<p>getBeançš„å…¥å£åœ¨<strong>DefaultListableFactory</strong>ï¼Œ å‡†ç¡®æ¥è¯´æ˜¯åœ¨<code>AbstractBeanFactory</code>è¿™ä¸ªç±»é‡Œé¢ï¼Œå› ä¸ºgetBean()çš„å¾ˆå¤šå®ç°éƒ½æ˜¯åœ¨<code>AbstractBeanFactory</code>è¿™ä¸ªæŠ½è±¡ç±»é‡Œé¢ã€‚ </p>
<h3 id="BeanFactoryä¸­çš„getBeançš„ä¸»ä½“æ€è·¯"><a href="#BeanFactoryä¸­çš„getBeançš„ä¸»ä½“æ€è·¯" class="headerlink" title="BeanFactoryä¸­çš„getBeançš„ä¸»ä½“æ€è·¯"></a>BeanFactoryä¸­çš„getBeançš„ä¸»ä½“æ€è·¯</h3><blockquote>
<p>BeanFactoryå®šä¹‰äº†Beanå®¹å™¨çš„è§„èŒƒã€‚é€šè¿‡beançš„åå­—ï¼ŒClassç±»å‹å’Œæ„é€ å‡½æ•°å‚æ•°æ¥å¾—åˆ°beanå®ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®beançš„åå­—å’ŒClassç±»å‹å’Œæ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ç­‰æ¥å¾—åˆ°beanå®ä¾‹    </span></span><br><span class="line">Object <span class="title function_">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException;    </span><br><span class="line">Object <span class="title function_">getBean</span><span class="params">(String name, Class requiredType)</span> <span class="keyword">throws</span> BeansException;    </span><br><span class="line">Object <span class="title function_">getBean</span><span class="params">(String name, Object... args)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; requiredType, Object... args)</span> <span class="keyword">throws</span> BeansException;</span><br></pre></td></tr></table></figure>

<p>BeanDefinitionä¸­åŒ…å«äº†è¿™ä¸ªç±»çš„Classä¿¡æ¯ä»¥åŠæ˜¯å¦å•ä¾‹ç­‰ <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\spring-framework-ioc-source-100.png" alt="img" loading="lazy"> </p>
<p>ç®€å•çš„å®ç°Object getBean(String name)æ€è·¯ï¼š</p>
<ul>
<li><p>ä»beanDefeinitionMapä¸­é€šè¿‡beanNameè·å¾—BeanDefinition</p>
</li>
<li><p>ä»BeanDefinitionä¸­è·å¾—beanClasName</p>
</li>
<li><p>é€šè¿‡åå°„åˆå§‹åŒ–BeanClassNameçš„å®ä¾‹instance</p>
<ul>
<li>æ„é€ å¥½å¿µä¹¦ä»BeanDefinitionçš„getConstructorArgumentValues()æ–¹æ³•è·å–</li>
<li>å±æ€§å€¼ä»BeanDefinitionçš„getPropertyValues()æ–¹æ³•è·å–</li>
</ul>
</li>
<li><p>è¿”å›beanNameçš„å®ä¾‹instance</p>
</li>
</ul>
<h4 id="ä¸»ä½“æ€è·¯"><a href="#ä¸»ä½“æ€è·¯" class="headerlink" title="ä¸»ä½“æ€è·¯"></a>ä¸»ä½“æ€è·¯</h4><p>BeanFactoryå®ç°getBean()æ–¹æ³•åœ¨AbstractBeanFactoryä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨åˆåœ¨è°ƒç”¨doGetBeanæ–¹æ³•è¿›è¡Œå®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  <span class="keyword">return</span> doGetBean(name, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String name, Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  <span class="keyword">return</span> doGetBean(name, requiredType, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name, Object... args)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  <span class="keyword">return</span> doGetBean(name, <span class="literal">null</span>, args, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String name, <span class="meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="meta">@Nullable</span> Object... args)</span></span><br><span class="line">    <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  <span class="keyword">return</span> doGetBean(name, requiredType, args, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€ŒdoGetBeançš„æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> Class&lt;T&gt; requiredType, <span class="keyword">final</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span>&#123;</span><br><span class="line"><span class="comment">//è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &amp;ï¼Œéœ€è¦å»æ‰</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line"><span class="comment">//æ ¸å¿ƒ1ï¼šä»å•ä¾‹å®¹å™¨ä¸­è·å–ç¼“å­˜çš„bean</span></span><br><span class="line"> <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line"> <span class="comment">//å¦‚æœä»å•ä¾‹å®¹å™¨ä¸­åˆ°ç¼“å­˜çš„beanè€Œä¸”æ„é€ å‡½æ•°å‚æ•°åˆ—è¡¨ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) </span><br><span class="line">&#123;   </span><br><span class="line">    <span class="comment">//æ ¸å¿ƒ2ï¼šç›´æ¥è·å–å®ä¾‹</span></span><br><span class="line">    bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//éªŒè¯å½“å‰beanå®ä¾‹æ˜¯å¦æ­£åœ¨åˆ›å»ºä¸­ï¼Œå¦‚æœæ˜¯ ç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName);</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//ä¸­é—´çœç•¥äº†é€šè¿‡å·¥å‚æ–¹å¼åˆ›å»ºbeançš„ä»£ç </span></span><br><span class="line">    .............</span><br><span class="line"><span class="keyword">if</span> (!typeCheckOnly)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//æ ¸å¿ƒ3ï¼šå°†å½“å‰beanå®ä¾‹æ”¾å…¥alreadyCreatedé›†åˆé‡Œï¼Œæ ‡è¯†è¿™ä¸ªbeanå‡†å¤‡åˆ›å»ºäº†</span></span><br><span class="line">    markBeanAsCreated(beanName);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//ä»BeanDefinitionsä¸­è·å–è¯¥å®ä¾‹çš„BeanDefinition</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">        <span class="comment">//æ£€æŸ¥è¦åˆ›å»ºçš„å®ä¾‹beançš„ä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å…è®¸è¢«å®ä¾‹åŒ–</span></span><br><span class="line">	    checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line">        <span class="comment">//çœç•¥äº†å®ä¾‹åŒ–beançš„æ‰€æœ‰ä¾èµ–beançš„è¿‡ç¨‹,åˆ›å»ºè¿‡ç¨‹æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">         .............</span><br><span class="line">             <span class="comment">// Create bean instance.</span></span><br><span class="line">		<span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">         <span class="comment">//æ ¸å¿ƒ4ï¼šåˆ›å»ºå•ä¾‹bean</span></span><br><span class="line">		sharedInstance = getSingleton(beanName, <span class="keyword">new</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;() &#123;</span><br><span class="line">         <span class="comment">//ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–ï¼Œspringå°†ä½¿ç”¨ObjectFactoryè¡¨ç¤ºbeanï¼Œæå‰æš´éœ²bean</span></span><br><span class="line">         <span class="comment">//å½“çœŸæ­£å±æ€§æ³¨å…¥çš„æ—¶å€™ï¼Œè°ƒç”¨ObjectFactoryçš„getObject()æ–¹æ³•è·å–beanå®ä¾‹</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//æ ¸å¿ƒ5ï¼šçœŸæ­£åˆ›å»ºbeançš„æ–¹æ³•ï¼Œé‡ç‚¹è¦çœ‹çš„æ–¹æ³•   </span></span><br><span class="line">		<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="comment">//å¦‚æœåˆ›å»ºbeanå¼‚å¸¸ åšä¸€äº›æ¸…é™¤å·¥ä½œ</span></span><br><span class="line">         <span class="comment">//åŒ…æ‹¬å°†beanä»alreadyCreatedï¼ŒsingletonsCurrentlyInCreationç­‰å®¹å™¨ä¸­æ¸…é™¤</span></span><br><span class="line">		destroySingleton(beanName);</span><br><span class="line">		<span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;&#125;&#125;);</span><br><span class="line">        <span class="comment">//è·å–çœŸæ­£çš„beanï¼Œç”±äºbeanå¯ä»¥é€šè¿‡FactortBeanæˆ–è€…å·¥å‚beançš„æ–¹å¼åˆ›å»º</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ç”¨äºä»Factorybeanæˆ–è€…å·¥å‚beanè·å–è¦åˆ›å»ºçš„çœŸæ­£çš„bean</span></span><br><span class="line">	    bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">		  &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">          <span class="comment">//çœç•¥  åŸå‹æ¨¡å¼çš„åˆ›å»º</span></span><br><span class="line">            .............</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//çœç•¥scopeä½œç”¨äºçš„åˆ›å»º</span></span><br><span class="line">             .............</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(BeansException ex)&#123;</span><br><span class="line">        cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">		<span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//å¦‚æœrequiredTypeä¸ä¸ºç©ºï¼Œå°è¯•å°†è·å–çš„beanè½¬æ¢æˆrequiredType</span></span><br><span class="line">        .............</span><br><span class="line">&#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸»è¦å†…å®¹ï¼š</strong></p>
<ul>
<li>è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å…±äº§ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &amp;ï¼Œéœ€è¦å»æ‰</li>
<li>æ— å‚å•ä¾‹å…ˆä»ç¼“å­˜ä¸­å°è¯•è·å–</li>
<li>å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li>
<li>å¦‚æœbean definitionå­˜åœ¨äºçˆ¶çš„beanå·¥å‚ä¸­ï¼Œå§”æ‰˜ç»™çˆ¶beanå·¥å‚è·å–</li>
<li>æ ‡è®°è¿™ä¸ªbeanNameçš„å®ä¾‹æ­£åœ¨åˆ›å»º</li>
<li>ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–</li>
<li>çœŸæ­£åˆ›å»º<ul>
<li>å•ä¾‹æ—¶</li>
<li>åŸå‹æ—¶</li>
<li>æ ¹æ®beançš„scopeåˆ›å»º</li>
</ul>
</li>
</ul>
<p><strong>è¯¦ç»†æµç¨‹</strong>ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903843596107790#heading-9">https://juejin.cn/post/6844903843596107790#heading-9</a></p>
<h3 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h3><p>Aä¾èµ–Bï¼ŒBä¾èµ–Aï¼Œåœ¨å±æ€§èµ‹å€¼æ—¶å½¢æˆä¸€ä¸ªé—­ç¯ï¼Œå‘ç”Ÿå¾ªç¯ä¾èµ–ã€‚</p>
<p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662987362760.png" alt="1662987362760" loading="lazy"></p>
<p>springä¸­beanéƒ½æ˜¯å•ä¾‹çš„ï¼Œæ•´ä¸ªå®¹å™¨åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰“ç ´å½“å‰é—­ç¯ï¼Œè§£å†³å¾ªç¯ä¾èµ–ï¼šå®ä¾‹åŒ–ã€åˆå§‹åŒ–åˆ†å¼€</p>
<p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662987004411.png" alt="1662987004411" loading="lazy"></p>
<p>è€Œå±æ€§çš„èµ‹å€¼æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ä½æ„é€ å™¨æ–¹å¼å±æ€§èµ‹å€¼ï¼Œè¿™ç§å¾ªç¯ä¾èµ–æ— æ³•è§£å†³ï¼›å¦ä¸€ç§é€šè¿‡setæ–¹å¼å±æ€§èµ‹å€¼ï¼Œå¯ä»¥é€šè¿‡ä¸‰çº§ç¼“å­˜ï¼Œæå‰æš´éœ²å¯¹è±¡æ¥è§£å†³å¾ªç¯ä¾èµ–ã€‚</p>
<p>beanå¯¹è±¡åˆ›å»ºçš„æ ¸å¿ƒï¼š</p>
<p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662987193290.png" alt="1662987193290" loading="lazy"></p>
<p>å®¹å™¨ä¸­çš„å¯¹è±¡çš„çŠ¶æ€æœ‰ä¸¤ç§ï¼šå®Œæ•´çš„ã€ä¸å®Œæ•´çš„ã€‚å¦‚æœå¯ä»¥å°†ä¸å®Œæ•´çš„å¯¹è±¡æå‰å­˜å‚¨åˆ°å®¹å™¨ä¸­ï¼Œå³å¯è§£å†³å¾ªç¯ä¾èµ–ï¼Œå³ä¸€çº§ç¼“å­˜å­˜å‚¨å®Œæ•´å¯¹è±¡ï¼ŒäºŒçº§ç¼“å­˜å­˜å‚¨æå‰æš´éœ²çš„åŠæˆå“å¯¹è±¡</p>
<h4 id="ä¸‰çº§ç¼“å­˜"><a href="#ä¸‰çº§ç¼“å­˜" class="headerlink" title="ä¸‰çº§ç¼“å­˜"></a>ä¸‰çº§ç¼“å­˜</h4><blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜</p>
</blockquote>
<p>1ã€ä¸‰çº§ç¼“å­˜åˆ†åˆ«å­˜æ”¾ä»€ä¹ˆå¯¹è±¡ï¼Ÿ</p>
<p>â€‹    1ã€å®Œæ•´å¯¹è±¡ï¼›2ã€ä¸å®Œæ•´å¯¹è±¡ï¼›3ã€lamdaè¡¨è¾¾å¼(è®¿é—®æ—¶ï¼Œè¿”å›ä¸€ä¸ªä¸å®Œæ•´å¯¹è±¡å­˜å…¥äºŒçº§ç¼“å­˜)</p>
<p>2ã€åªæœ‰ä¸€çº§ç¼“å­˜å¯ä»¥å—ï¼Ÿ</p>
<p>â€‹    ä¸è¡Œï¼Œè¿™æ ·çš„è¯ï¼Œå®Œæ•´å’Œä¸å®Œæ•´å¯¹è±¡å­˜æ”¾åˆ°ä¸€èµ·ï¼Œè¿›è¡Œå¯¹è±¡è·å–æ—¶æœ‰å¯èƒ½è·å–åˆ°ä¸å®Œæ•´å¯¹è±¡ï¼Œæ— æ³•ä½¿ç”¨</p>
<p>3ã€åªæœ‰äºŒçº§ç¼“å­˜å¯ä»¥å—ï¼Ÿ</p>
<p>â€‹    ä¸‰çº§ç¼“å­˜ä½¿ç”¨åˆ°çš„åœ°æ–¹ï¼š1ã€getSingletonï¼›2ã€doCreateBean</p>
<p>â€‹    åªæœ‰äºŒçº§ç¼“å­˜ä¹Ÿå¯ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</p>
<p>4ã€äºŒçº§ç¼“å­˜ä¹Ÿå¯ä»¥ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</p>
<p>â€‹    1ã€äºŒçº§ç¼“å­˜åŸºç¡€ä¸Šæ·»åŠ aopï¼ŒæŠ¥é”™ This means that said other beans do not use the final version of the beanã€‚æ²¡æœ‰ä½¿ç”¨æœ€ç»ˆçŠ¶æ€çš„bean</p>
<p>â€‹    2ã€å¦‚æœä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«ä»£ç†ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡éœ€è¦é¢„å…ˆç”Ÿæˆéä»£ç†å¯¹è±¡ã€‚</p>
<p>â€‹    3ã€lamdaè¡¨è¾¾å¼ getEarlyBeanReferenceçš„é€»è¾‘ï¼šå¦‚æœæ²¡æœ‰ä»£ç†å¯¹è±¡ç›´æ¥è¿”å›beanï¼Œå¦åˆ™ç”¨ä»£ç†å¯¹è±¡æ›¿æ¢å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰ä¸‰çº§ç¼“å­˜ï¼Œå°±æ— æ³•å¾—åˆ°ä»£ç†å¯¹è±¡ï¼Œå³æ•´ä¸ªå®¹å™¨ä¸­åŒ…å«äº†ä»£ç†å¯¹è±¡å’Œéä»£ç†å¯¹è±¡ã€‚<strong>ä½†æ˜¯</strong>ï¼Œå®¹å™¨ä¸­å¯¹è±¡é»˜è®¤å•ä¾‹ï¼Œæ„å‘³ç€æ ¹æ®åç§°åªèƒ½è·å–ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œæ­¤æ—¶å®¹å™¨<strong>åŒæ—¶å­˜åœ¨</strong>ä¸¤ä¸ªå¯¹è±¡çš„è¯ï¼Œä½¿ç”¨çš„æ—¶å€™æ— æ³•ç¡®å®š<strong>ä½¿ç”¨å“ªä¸€ä¸ª</strong>ä»¥åŠæ— æ³•ç¡®è®¤<strong>ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨</strong>å½“å‰å¯¹è±¡ï¼Œæ˜¯åœ¨å…¶ä»–å¯¹è±¡çš„æ‰§è¡Œä¸­è°ƒç”¨ï¼Œæ— æ³•äººä¸ºæ§åˆ¶ï¼Œå› æ­¤å¿…é¡»<strong>ä¿è¯å®¹å™¨ä¸­ä»»ä½•æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªå¯¹è±¡ä¾›å¤–éƒ¨è°ƒç”¨</strong>ã€‚æ‰€ä»¥åœ¨ä¸‰çº§ç¼“å­˜ä¸­ï¼Œå®Œæˆäº†ä¸€ä»¶ä»£ç†å¯¹è±¡æ›¿æ¢éä»£ç†å¯¹è±¡çš„å·¥ä½œ(å¦‚æœæœ‰ä»£ç†å¯¹è±¡)ï¼Œç¡®å®šè¿”å›çš„å”¯ä¸€å¯¹è±¡ </p>
<p>â€‹    4ã€<code>ä¸‰çº§ç¼“å­˜æ˜¯ä¸ºäº†è§£å†³åœ¨aopä»£ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰aopçš„è¯ï¼ŒäºŒçº§è¶³ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</code></p>
<p>ç›¸å½“äºä¸€ä¸ªå›è°ƒæœºåˆ¶ï¼Œå½“éœ€è¦ä½¿ç”¨å½“å‰å¯¹è±¡æ—¶ï¼Œä¼šåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦éœ€è¦è¢«ä»£ç†å¯¹è±¡å®ç°ï¼Œå¦‚æœéœ€è¦ç›´æ¥æ›¿æ¢ï¼Œä¸éœ€è¦ç›´æ¥è¿”å›ä»£ç†å¯¹è±¡å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Object&gt;(<span class="number">256</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/** Cache of early singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of singleton factories: bean name --&gt; ObjectFactory */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ObjectFactory&lt;?&gt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€å±‚ç¼“å­˜(singletonObjects)ï¼šå•ä¾‹å¯¹è±¡æ± ï¼Œå·²ç»å®ä¾‹åŒ–å¹¶ä¸”å±æ€§èµ‹å€¼ï¼Œå®Œæ•´å¯¹è±¡</li>
<li>ç¬¬äºŒå±‚ç¼“å­˜(earlySingletonObjects)ï¼šå•ä¾‹å¯¹è±¡ç¼“å­˜æ± ï¼Œå·²ç»å®ä¾‹åŒ–ä½†æœªå±æ€§èµ‹å€¼</li>
<li>ç¬¬ä¸‰å±‚ç¼“å­˜(singletonFactories)ï¼šå•ä¾‹å·¥å‚çš„ç¼“å­˜</li>
</ul>
<p><code>getSingleton(beanName):</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, <span class="type">boolean</span> allowEarlyReference)</span> &#123;</span><br><span class="line">         <span class="comment">//ä»singletonObjectsï¼ˆä¸€çº§ç¼“å­˜ï¼‰ä¸­å°è¯•è·å–</span></span><br><span class="line">		<span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">         <span class="comment">//å¦‚æœç¼“å­˜ä¸å­˜åœ¨&amp;&amp;å¯¹è±¡åœ¨å»ºç«‹ä¸­ï¼Œåˆ™å°è¯•ä»earlySingletonObjectsï¼ˆäºŒçº§ç¼“å­˜ï¼‰ä¸­è·å–</span></span><br><span class="line">		<span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">            <span class="comment">//ä¸ºäº†çº¿ç¨‹å®‰å…¨å°†å•ä¾‹çš„IOCå®¹å™¨é”èµ·æ¥</span></span><br><span class="line">			<span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">                 <span class="comment">//ä»äºŒçº§ç¼“å­˜(æå‰æš´éœ²å®¹å™¨)ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ObjectFactory</span></span><br><span class="line">				singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">				<span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                     <span class="comment">//å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°å°±ä»beanå·¥å‚ç±»çš„ç¼“å­˜ä¸­æŸ¥æ‰¾</span></span><br><span class="line">					ObjectFactory&lt;?&gt; singletonFactory = <span class="built_in">this</span>.singletonFactories.get(beanName);</span><br><span class="line">					<span class="keyword">if</span> (singletonFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">                          <span class="comment">//ä»singletonFactoriesç»è¿‡getObectè·å–ï¼Œç»è¿‡ä¸‰çº§ç¼“å­˜è·å–</span></span><br><span class="line">						singletonObject = singletonFactory.getObject();</span><br><span class="line">                          <span class="comment">//å°†åˆ›å»ºçš„beanæ”¾å…¥åˆ°æå‰æš´éœ²å®¹å™¨é›†åˆé‡Œ</span></span><br><span class="line">						<span class="built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                          <span class="comment">//å› ä¸ºå·²ç»å­˜åœ¨äº†å®ä¾‹æ— éœ€å†é€šè¿‡å·¥å‚åˆ›å»ºï¼Œ</span></span><br><span class="line">                          <span class="comment">//å°†åˆ›å»ºè¯¥å®ä¾‹çš„å·¥å‚ä»å·¥å‚è®©å…¶ä¸­åˆ é™¤</span></span><br><span class="line">						<span class="built_in">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//è¿”å›ä»ç¼“å­˜ä¸­è·å–ç»“æœ</span></span><br><span class="line">		<span class="keyword">return</span> (singletonObject != hNULL_OBJECT ? singletonObject : <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><code>isSingletonCurrentlyInCreation()</code>ï¼šåˆ¤æ–­å½“å‰å•ä¾‹beanæ˜¯å¦æ­£åœ¨å»ºç«‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ(å¥½æ¯”Açš„æ„é€ å™¨ä¾èµ–äº†Bå¯¹è±¡å› æ­¤å¾—å…ˆå»å»ºç«‹Bå¯¹è±¡ï¼Œ æˆ–åˆ™åœ¨Açš„populateBeanè¿‡ç¨‹å½“ä¸­ä¾èµ–äº†Bå¯¹è±¡ï¼Œå¾—å…ˆå»å»ºç«‹Bå¯¹è±¡ï¼Œè¿™æ—¶çš„Aå°±æ˜¯å¤„äºå»ºç«‹ä¸­çš„çŠ¶æ€ã€‚)</p>
<p><code>allowEarlyReference</code> ï¼šæ˜¯å¦å®¹è®¸ä»singletonFactoriesä¸­ç»è¿‡getObjectæ‹¿åˆ°å¯¹è±¡</p>
<p>Springé¦–å…ˆä»ä¸€çº§ç¼“å­˜singletonObjectsä¸­è·å–ã€‚è‹¥æ˜¯è·å–ä¸åˆ°ï¼Œè€Œä¸”å¯¹è±¡æ­£åœ¨å»ºç«‹ä¸­ï¼Œå°±å†ä»äºŒçº§ç¼“å­˜earlySingletonObjectsä¸­è·å–ã€‚è‹¥æ˜¯ä»æ˜¯è·å–ä¸åˆ°ä¸”å®¹è®¸singletonFactoriesç»è¿‡getObject()è·å–ï¼Œå°±ä»ä¸‰çº§ç¼“å­˜singletonFactory.getObject()(ä¸‰çº§ç¼“å­˜)è·å–ï¼Œè‹¥æ˜¯è·å–åˆ°äº†åˆ™ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜ã€‚</p>
<p>ä»ä¸Šè¿°åˆ†æå¯çŸ¥ï¼Œå¾ªç¯ä¾èµ–çš„è§£å†³ä¾èµ–äºsingletonFactoriesè¿™ä¸ªä¸‰çº§cacheã€‚è¿™ä¸ªcacheçš„ç±»å‹æ˜¯ObjectFactoryã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ObjectFactory</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨beanå»ºç«‹è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤å¤„åŒ¿åå†…éƒ¨ç±»å®ç°äº†è¯¥æ¥å£ï¼Œ<strong>ä¸€å¤„æ˜¯</strong>springåˆ›å»ºbeançš„æ—¶å€™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sharedInstance = getSingleton(beanName, <span class="keyword">new</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;() &#123;</span><br><span class="line">         <span class="comment">//ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–ï¼Œspringå°†ä½¿ç”¨ObjectFactoryè¡¨ç¤ºbeanï¼Œæå‰æš´éœ²bean</span></span><br><span class="line">         <span class="comment">//å½“çœŸæ­£å±æ€§æ³¨å…¥çš„æ—¶å€™ï¼Œè°ƒç”¨ObjectFactoryçš„getObject()æ–¹æ³•è·å–beanå®ä¾‹</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//æ ¸å¿ƒ5ï¼šçœŸæ­£åˆ›å»ºbeançš„æ–¹æ³•ï¼Œé‡ç‚¹è¦çœ‹çš„æ–¹æ³•   </span></span><br><span class="line">		<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="comment">//å¦‚æœåˆ›å»ºbeanå¼‚å¸¸ åšä¸€äº›æ¸…é™¤å·¥ä½œ</span></span><br><span class="line">         <span class="comment">//åŒ…æ‹¬å°†beanä»alreadyCreatedï¼ŒsingletonsCurrentlyInCreationç­‰å®¹å™¨ä¸­æ¸…é™¤</span></span><br><span class="line">		destroySingleton(beanName);</span><br><span class="line">		<span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>å¦ä¸€å¤„æ˜¯</strong>é€šè¿‡ObjectFacstoryæš´éœ²beançš„æ—¶å€™ï¼šåœ¨createBenaInstanceæ–¹æ³•æ‰§è¡Œåã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†beanå¯¹åº”çš„objectFactoryçš„lamdaè¡¨è¾¾å¼æ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜</span></span><br><span class="line">addSingletonFactory(beanName,() -&gt; getEarlyBeanRefrence(beanName,mbd,bean));</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„æ˜¯è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ï¼Œæ‰§è¡Œæ­¤æ®µä»£ç æ—¶å•ä¾‹å¯¹è±¡å·²ç»è¢«å»ºç«‹åªæ˜¯æœªè¢«å®Œå…¨åˆå§‹åŒ–å®Œæˆã€‚<strong>getEarlyBeanReference</strong>ä¼šå°†beanå®ä¾‹è¿”å›æš´éœ²å‡ºæ¥ã€‚å­˜åˆ°äºŒçº§ç¼“å­˜ã€‚</p>
<p>ä¸‰çº§ç¼“å­˜å­˜æ”¾çš„æ˜¯ObjectFactoryçš„lamdaè¡¨è¾¾å¼ç”¨æ¥åœ¨getæ—¶æš´éœ²åŠæˆå“å¯¹è±¡</p>
<p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662990953859.png" alt="1662990953859" loading="lazy"></p>
<blockquote>
<p>ä¸¾ä¾‹</p>
</blockquote>
<p>â€œAä¾èµ–Bï¼ŒBä¾èµ–Aâ€ã€‚Aå…ˆè¿›è¡Œåˆå§‹åŒ–å¹¶å°†è‡ªèº«é€šè¿‡objectFactoryæš´éœ²å‡ºæ¥ï¼Œå‘ç°ä¾èµ–Bï¼Œæ­¤æ—¶å°è¯•get(B)ï¼Œå‘ç°æœªè¢«åˆ›å»ºå°±å»åˆ›å»ºBï¼Œæ­¤æ—¶å‘ç°Båˆä¾èµ–äºAï¼Œå°±å»get(A)ã€‚é€šè¿‡ä¸‰å±‚ç¼“å­˜æŸ¥è¯¢ï¼Œå› ä¸ºAç»è¿‡objectFactoryæš´éœ²ï¼Œå› æ­¤é€šè¿‡objectFactory.getObjectè·å–Aå¯¹è±¡(åŠæˆå“)ï¼Œå¹¶å°†Aä»ä¸‰çº§ç¼“å­˜æ”¾å…¥äºŒçº§ç¼“å­˜ã€‚æ‰€ä»¥Bå¯ä»¥å®Œæˆå®Œæ•´åˆå§‹åŒ–è¢«å­˜æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚å†è¿”å›Aï¼Œæ­¤æ—¶Aèƒ½æ‹¿åˆ°Bå¯¹è±¡é¡ºåˆ©åˆå§‹åŒ–å®Œæˆã€‚è§£å†³å¾ªç¯ä¾èµ–ã€‚</p>
<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p><code>springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–?</code></p>
<p>æ„é€ å™¨æ³¨å…¥å½¢æˆçš„å¾ªç¯ä¾èµ–ï¼šBeanBéœ€è¦åœ¨BeanAçš„æ„é€ å™¨å®Œæˆåˆå§‹åŒ–ï¼ŒBeanAä¹Ÿéœ€è¦åœ¨BeanBæ„é€ å™¨å®Œæˆåˆå§‹åŒ–ã€‚è¿™ç§æƒ…å†µéƒ½ä¸èƒ½å®Œæˆ</p>
<p>è€ŒSpringè§£å†³å¾ªç¯ä¾èµ–ä¸»è¦ä¾èµ–çš„æ˜¯<strong>ä¸‰çº§ç¼“å­˜</strong>ï¼Œ<strong>ä½†åœ¨è°ƒç”¨æ„é€ æ–¹æ³•ä¹‹å‰è¿˜æœªå°†å…¶æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸­</strong>ã€‚å› æ­¤åç»­çš„ä¾èµ–è°ƒç”¨æ„é€ æ–¹æ³•çš„æ—¶å€™å¹¶ä¸èƒ½ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–åˆ°ä¾èµ–çš„Beanï¼Œå› æ­¤ä¸èƒ½è§£å†³</p>
<p><code>Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸçš„å¾ªç¯ä¾èµ–ï¼Ÿ</code></p>
<p>Springä¸ä¼šç¼“å­˜prototypeä½œç”¨åŸŸçš„beanï¼Œè€Œspringçš„å¾ªç¯ä¾èµ–çš„è§£å†³æ­£æ˜¯é ç€ç¼“å­˜å®ç°çš„</p>
<p><code>springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–ï¼Ÿ</code></p>
<p> å¤šå®ä¾‹Beanæ˜¯æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡getBeanéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æ„é€ æ–¹æ³•å¹¶ä¸”ç»™å±æ€§èµ‹å€¼ï¼Œæ ¹æœ¬æ²¡æœ‰ä¸‰çº§ç¼“å­˜ï¼Œå› æ­¤ä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ã€‚ </p>
<h3 id="Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662779610485.png" alt="1662779610485" loading="lazy"></p>
<blockquote>
<p>Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„<strong>å®Œæ•´</strong>ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº prototype çš„ bean ï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹ååˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚ </p>
</blockquote>
<p><strong>Springå®¹å™¨ä¸­Beançš„å£°æ˜æµç¨‹</strong></p>
<p> <img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\spring-framework-ioc-source-102.png" alt="img" loading="lazy"> </p>
<ul>
<li><p>å¦‚æœBeanFactoryPostProcesserå’ŒBeanå…³è”ï¼Œåˆ™è°ƒç”¨postProcessBeanFactoryæ–¹æ³•ï¼ˆå³é¦–å…ˆå°è¯•ä»Beanå·¥å‚è·å–Beanï¼‰</p>
</li>
<li><p>å¦‚æœInstantiationAwareBeanPostProcessorå’ŒBeanå…³è”ã€‚åˆ™è°ƒç”¨postProcessBeforeInstantiationæ–¹æ³•</p>
</li>
<li><p>æ ¹æ®é…ç½®<strong>å®ä¾‹åŒ–Bean</strong></p>
</li>
<li><p>åˆ©ç”¨ä¾èµ–æ³¨å…¥å®Œæˆ<strong>å±æ€§èµ‹å€¼</strong></p>
</li>
<li><p>å¦‚æœInstantiationAwareBeanPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™è°ƒç”¨postProcessAfterInstantiationæ–¹æ³•å’ŒpostProcessPropertiesæ–¹æ³•</p>
</li>
<li><p><strong>è°ƒç”¨xxxAwareæ¥å£</strong></p>
<p><strong>ç¬¬ä¸€ç±»Awareæ¥å£</strong></p>
<ul>
<li>å¦‚æœ Bean å®ç°äº† BeanNameAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ Bean çš„ setBeanName() æ–¹æ³•ä¼ å…¥å½“å‰ Bean çš„ id å€¼ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† BeanClassLoaderAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ setBeanClassLoader() æ–¹æ³•ä¼ å…¥classLoaderçš„å¼•ç”¨ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† BeanFactoryAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ setBeanFactory() æ–¹æ³•ä¼ å…¥å½“å‰å·¥å‚å®ä¾‹çš„å¼•ç”¨ã€‚</li>
</ul>
<p><strong>ç¬¬äºŒç±»Awareæ¥å£</strong></p>
<ul>
<li>å¦‚æœ Bean å®ç°äº† EnvironmentAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ setEnvironment() æ–¹æ³•ä¼ å…¥å½“å‰ Environment å®ä¾‹çš„å¼•ç”¨ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† EmbeddedValueResolverAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ setEmbeddedValueResolver() æ–¹æ³•ä¼ å…¥å½“å‰ StringValueResolver å®ä¾‹çš„å¼•ç”¨ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† ApplicationContextAware æ¥å£ï¼Œåˆ™ Spring è°ƒç”¨ setApplicationContext() æ–¹æ³•ä¼ å…¥å½“å‰ ApplicationContext å®ä¾‹çš„å¼•ç”¨ã€‚</li>
<li>â€¦</li>
</ul>
</li>
<li><p>å¦‚æœ BeanPostProcessor å’Œ Bean å…³è”ï¼Œåˆ™ Spring å°†è°ƒç”¨è¯¥æ¥å£çš„é¢„åˆå§‹åŒ–æ–¹æ³• postProcessBeforeInitialzation() å¯¹ Bean è¿›è¡ŒåŠ å·¥æ“ä½œï¼Œæ­¤å¤„éå¸¸é‡è¦ï¼ŒSpring çš„ AOP å°±æ˜¯åˆ©ç”¨å®ƒå®ç°çš„ã€‚</p>
</li>
<li><p>å¦‚æœ Bean å®ç°äº† InitializingBean æ¥å£ï¼Œåˆ™ Spring å°†è°ƒç”¨ afterPropertiesSet() æ–¹æ³•ã€‚(æˆ–è€…æœ‰æ‰§è¡Œ@PostConstructæ³¨è§£çš„æ–¹æ³•)</p>
</li>
<li><p>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ <strong>init-method</strong> å±æ€§æŒ‡å®šäº†åˆå§‹åŒ–æ–¹æ³•ï¼Œåˆ™è°ƒç”¨è¯¥åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
</li>
<li><p>å¦‚æœ BeanPostProcessor å’Œ Bean å…³è”ï¼Œåˆ™ Spring å°†è°ƒç”¨è¯¥æ¥å£çš„åˆå§‹åŒ–æ–¹æ³• postProcessAfterInitialization()ã€‚æ­¤æ—¶ï¼ŒBean å·²ç»å¯ä»¥è¢«åº”ç”¨ç³»ç»Ÿä½¿ç”¨äº†ã€‚</p>
</li>
<li><p>å¦‚æœåœ¨ <code>ä¸­æŒ‡å®šäº†è¯¥ Bean çš„ä½œç”¨èŒƒå›´ä¸º scope=&quot;singleton&quot;ï¼Œåˆ™å°†è¯¥ Bean æ”¾å…¥ Spring IoC çš„ç¼“å­˜æ± ä¸­ï¼Œå°†è§¦å‘ Spring å¯¹è¯¥ Bean çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›å¦‚æœåœ¨</code> ä¸­æŒ‡å®šäº†è¯¥ Bean çš„ä½œç”¨èŒƒå›´ä¸º scope=â€prototypeâ€ï¼Œåˆ™å°†è¯¥ Bean äº¤ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…ç®¡ç†è¯¥ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼ŒSpring ä¸å†ç®¡ç†è¯¥ Beanã€‚</p>
</li>
<li><p>å¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£ï¼Œåˆ™ Spring ä¼šè°ƒç”¨ destory() æ–¹æ³•å°† Spring ä¸­çš„ Bean é”€æ¯ï¼›(æˆ–è€…æœ‰æ‰§è¡Œ@PreDestroyæ³¨è§£çš„æ–¹æ³•)</p>
</li>
<li><p>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ <strong>destory-method</strong> å±æ€§æŒ‡å®šäº† Bean çš„é”€æ¯æ–¹æ³•ï¼Œåˆ™ Spring å°†è°ƒç”¨è¯¥æ–¹æ³•å¯¹ Bean è¿›è¡Œé”€æ¯ã€‚</p>
</li>
</ul>
<p>Beanç”Ÿå‘½å‘¨æœŸå®Œæ•´çš„æ–¹æ³•å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li><p><strong>Beanè‡ªèº«çš„æ–¹æ³•</strong>ï¼š è¿™ä¸ªåŒ…æ‹¬äº†Beanæœ¬èº«è°ƒç”¨çš„æ–¹æ³•å’Œé€šè¿‡é…ç½®æ–‡ä»¶ä¸­``çš„init-methodå’Œdestroy-methodæŒ‡å®šçš„æ–¹æ³•</p>
</li>
<li><p><strong>Beançº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</strong>ï¼š è¿™ä¸ªåŒ…æ‹¬äº†BeanNameAwareã€BeanFactoryAwareã€ApplicationContextAwareï¼›å½“ç„¶ä¹ŸåŒ…æ‹¬InitializingBeanå’ŒDiposableBeanè¿™äº›æ¥å£çš„æ–¹æ³•ï¼ˆå¯ä»¥è¢«@PostConstructå’Œ@PreDestroyæ³¨è§£æ›¿ä»£)</p>
</li>
<li><p><strong>å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</strong>ï¼š è¿™ä¸ªåŒ…æ‹¬äº†InstantiationAwareBeanPostProcessor å’Œ BeanPostProcessor è¿™ä¸¤ä¸ªæ¥å£å®ç°ï¼Œä¸€èˆ¬ç§°å®ƒä»¬çš„å®ç°ç±»ä¸ºâ€œåå¤„ç†å™¨â€ã€‚</p>
</li>
<li><p><strong>å·¥å‚åå¤„ç†å™¨æ¥å£æ–¹æ³•</strong>ï¼š è¿™ä¸ªåŒ…æ‹¬äº†AspectJWeavingEnabler, ConfigurationClassPostProcessor, CustomAutowireConfigurerç­‰ç­‰éå¸¸æœ‰ç”¨çš„å·¥å‚åå¤„ç†å™¨æ¥å£çš„æ–¹æ³•ã€‚å·¥å‚åå¤„ç†å™¨ä¹Ÿæ˜¯å®¹å™¨çº§çš„ã€‚åœ¨åº”ç”¨ä¸Šä¸‹æ–‡è£…é…é…ç½®æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨ã€‚</p>
</li>
</ul>
<p><code>ä¸¾ä¾‹</code></p>
<p>å®šä¹‰Beanï¼ˆè¿™é‡Œæ˜¯Userï¼‰, å¹¶è®©å®ƒå®ç°BeanNameAware,BeanFactoryAware,ApplicationContextAwareæ¥å£å’ŒInitializingBean,DisposableBeanæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tech.pdai.springframework.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanFactoryAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.BeanNameAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryAware</span>, BeanNameAware, ApplicationContextAware,</span><br><span class="line">        InitializingBean, DisposableBean &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user&#x27;s name.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user&#x27;s age.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bean factory.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * application context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bean name.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute User#new User()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute User#setName(&#123;&#125;)&quot;</span>, name);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute User#setAge(&#123;&#125;)&quot;</span>, age);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute BeanFactoryAware#setBeanFactory&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute BeanNameAware#setBeanName&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.beanName = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute ApplicationContextAware#setApplicationContext&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute DisposableBean#destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute InitializingBean#afterPropertiesSet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doInit</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute User#doInit&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute User#doDestroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰BeanFactoryPostProcessorå®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute BeanFactoryPostProcessor#postProcessBeanFactory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰Inâ€™stantiationAwareBeanPostProcessorå®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInstantiationAwareBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">InstantiationAwareBeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation for &#123;&#125;&quot;</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> InstantiationAwareBeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInstantiation(beanClass, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">postProcessAfterInstantiation</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation for &#123;&#125;&quot;</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> InstantiationAwareBeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInstantiation(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PropertyValues <span class="title function_">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute InstantiationAwareBeanPostProcessor#postProcessProperties for &#123;&#125;&quot;</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> InstantiationAwareBeanPostProcessor.<span class="built_in">super</span>.postProcessProperties(pvs, bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰BeanPostProcessorå®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute BeanPostProcessor#postProcessBeforeInitialization for &#123;&#125;&quot;</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;execute BeanPostProcessor#postProcessAfterInitialization for &#123;&#125;&quot;</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆå§‹åŒ–Bean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;user&quot;, initMethod = &quot;doInit&quot;, destroyMethod = &quot;doDestroy&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;pdai&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cglib proxy demo.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pdai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * main interface.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Init application context&quot;</span>);</span><br><span class="line">        <span class="comment">// create and configure beans</span></span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(</span><br><span class="line">                <span class="string">&quot;tech.pdai.springframework&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// retrieve configured instance</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// print info from beans</span></span><br><span class="line">        log.info(user.toString());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Shutdown application context&quot;</span>);</span><br><span class="line">        context.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»“æœ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">42.547</span> [main] INFO tech.pdai.springframework.App - Init application context</span><br><span class="line">...</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.134</span> [main] INFO tech.pdai.springframework.processor.MyBeanFactoryPostProcessor - execute BeanFactoryPostProcessor#postProcessBeanFactory</span><br><span class="line">...</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.216</span> [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean <span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.216</span> [main] INFO tech.pdai.springframework.processor.MyInstantiationAwareBeanPostProcessor - execute InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation <span class="keyword">for</span> user</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.236</span> [main] INFO tech.pdai.springframework.entity.User - execute User#<span class="keyword">new</span> <span class="title class_">User</span>()</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.237</span> [main] INFO tech.pdai.springframework.entity.User - execute User#setName(pdai)</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.237</span> [main] INFO tech.pdai.springframework.entity.User - execute User#setAge(<span class="number">18</span>)</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.237</span> [main] INFO tech.pdai.springframework.processor.MyInstantiationAwareBeanPostProcessor - execute InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation <span class="keyword">for</span> user</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.237</span> [main] INFO tech.pdai.springframework.processor.MyInstantiationAwareBeanPostProcessor - execute InstantiationAwareBeanPostProcessor#postProcessProperties <span class="keyword">for</span> user</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.242</span> [main] INFO tech.pdai.springframework.entity.User - execute BeanNameAware#setBeanName</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.242</span> [main] INFO tech.pdai.springframework.entity.User - execute BeanFactoryAware#setBeanFactory</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.242</span> [main] INFO tech.pdai.springframework.entity.User - execute ApplicationContextAware#setApplicationContext</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.242</span> [main] INFO tech.pdai.springframework.processor.MyBeanPostProcessor - execute BeanPostProcessor#postProcessBeforeInitialization <span class="keyword">for</span> user</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.242</span> [main] INFO tech.pdai.springframework.entity.User - execute InitializingBean#afterPropertiesSet</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.243</span> [main] INFO tech.pdai.springframework.entity.User - execute User#doInit</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.243</span> [main] INFO tech.pdai.springframework.processor.MyBeanPostProcessor - execute BeanPostProcessor#postProcessAfterInitialization <span class="keyword">for</span> user</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.270</span> [main] INFO tech.pdai.springframework.App - User(name=pdai, age=<span class="number">18</span>)</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.270</span> [main] INFO tech.pdai.springframework.App - Shutdown application context</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.276</span> [SpringContextShutdownHook] INFO tech.pdai.springframework.entity.User - execute DisposableBean#destroy</span><br><span class="line"><span class="number">12</span>:<span class="number">44</span>:<span class="number">43.276</span> [SpringContextShutdownHook] INFO tech.pdai.springframework.entity.User - execute User#doDestroy</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="SpringAop"><a href="#SpringAop" class="headerlink" title="SpringAop"></a>SpringAop</h1><h1 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h1><h2 id="1ã€è°ˆè°ˆspringç†è§£ï¼ŒåŸç†å’Œå®ç°ï¼Ÿ"><a href="#1ã€è°ˆè°ˆspringç†è§£ï¼ŒåŸç†å’Œå®ç°ï¼Ÿ" class="headerlink" title="1ã€è°ˆè°ˆspringç†è§£ï¼ŒåŸç†å’Œå®ç°ï¼Ÿ"></a>1ã€è°ˆè°ˆspringç†è§£ï¼ŒåŸç†å’Œå®ç°ï¼Ÿ</h2><p>æ€»ï¼š</p>
<p>æ§åˆ¶åè½¬ï¼šç†è®ºæ€æƒ³ï¼Œç”±åŸæ¥çš„å¯¹è±¡ç”±ä½¿ç”¨è€…æ¥æ§åˆ¶è½¬æ¢ä¸ºæŠŠå¯¹è±¡äº¤ç»™springæ¥è¿›è¡Œç®¡ç†</p>
<p>â€‹            DIï¼šä¾èµ–æ³¨å…¥ï¼ŒæŠŠå¯¹åº”å±æ€§çš„å€¼æ³¨å…¥åˆ°å…·ä½“å¯¹è±¡ä¸­ã€‚@Autowiredï¼ŒpopulateBeanå®Œæˆå±æ€§æ³¨å…¥</p>
<p>å®¹å™¨ï¼šå­˜å‚¨å¯¹è±¡ï¼Œmapç»“æ„å­˜å‚¨ï¼Œåœ¨springå­˜åœ¨ä¸‰çº§ç¼“å­˜ï¼ŒsingletonObjectå­˜æ”¾å®Œæ•´å¯¹è±¡ï¼ŒearlySingletonObjectså­˜æ”¾ä¸å®Œæ•´æå‰æš´éœ²å‡ºæ¥çš„å¯¹è±¡ï¼ŒsingletonFactorieså­˜æ”¾objectFactoryå°†beanæš´éœ²ã€‚</p>
<p>â€‹            æ•´ä¸ªbeançš„å£°æ˜å‘¨æœŸï¼Œä»åˆ›å»ºåˆ°ä½¿ç”¨åˆ°é”€æ¯çš„è¿‡ç¨‹å…¨éƒ¨éƒ½æ˜¯ç”±å®¹å™¨æ¥ç®¡ç†</p>
<p>åˆ†ï¼š</p>
<ol>
<li>è¦è®¾è®¡åˆ°å®¹å™¨çš„åˆ›å»ºè¿‡ç¨‹(beanFactoryã€DefaultListableBeanFactory)ï¼Œå‘beanå·¥å‚è®¾ç½®ä¸€äº›å‚æ•°(æ˜¯å¦å¯è¦†ç›–ã€æ˜¯å¦å…è®¸å¾ªç¯ä¾èµ–ã€beanPostProcessorã€Awareæ¥å£çš„å­ç±»ç­‰)</li>
<li>åŠ è½½è§£æBeanï¼Œå‡†å¤‡åˆ›å»ºbeançš„å®šä¹‰å¯¹è±¡beanDefinition</li>
<li>beanFactoryPostProcessorçš„å¤„ç†ï¼Œ<strong>æ­¤å¤„æ˜¯æ‰©å±•ç‚¹</strong>ï¼Œå¦‚PlaceHolderConfigurSupportã€ConfigurationClassPostProcessor</li>
<li>BeanPostProcessorçš„æ³¨å†ŒåŠŸèƒ½ï¼Œæ–¹ä¾¿åç»­å¯¹beanå¯¹è±¡å®Œæˆå…·ä½“çš„æ‰©å±•åŠŸèƒ½</li>
<li>é€šè¿‡åå°„çš„æ–¹å¼å°†BeanDefinitionå¯¹è±¡å®ä¾‹åŒ–æˆå…·ä½“çš„beanå¯¹è±¡</li>
<li>beanå¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼ˆå¡«å……å±æ€§ã€ è°ƒç”¨awareå­ç±»çš„æ–¹æ³•ã€è°ƒç”¨BeanPostProcessorçš„å‰ç½®å¤„ç†æ–¹æ³•ï¼Œè°ƒç”¨init-methodï¼Œè°ƒç”¨BeanPostProcessorçš„åç½®å¤„ç†æ–¹æ³•ï¼‰</li>
<li>ç”Ÿæˆå®Œæ•´çš„beanå¯¹è±¡ï¼Œé€šè¿‡getBean()å¯ä»¥ç›´æ¥è·å–</li>
<li>é”€æ¯è¿‡ç¨‹</li>
</ol>
<blockquote>
<p>springä¸­çš„beanéƒ½æ˜¯ç”¨è¿‡åå°„æœºåˆ¶å®ç°çš„ï¼ŒåŒæ—¶å…¶ä¸­åŒ…å«äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œæ¯”å¦‚æœ€å¸¸ç”¨çš„benaFactoryçš„æ‰©å±•ï¼ˆæ¯”å¦‚å ä½ç¬¦ï¼‰å’Œbeançš„æ‰©å±•.</p>
<p>iocæœ€æ ¸å¿ƒçš„å°±æ˜¯å¡«å……å…·ä½“beançš„å±æ€§ï¼Œbeançš„å£°æ˜å‘¨æœŸ</p>
</blockquote>
<h2 id="2ã€è°ˆè°ˆspringiocçš„åº•å±‚å®ç°"><a href="#2ã€è°ˆè°ˆspringiocçš„åº•å±‚å®ç°" class="headerlink" title="2ã€è°ˆè°ˆspringiocçš„åº•å±‚å®ç°"></a>2ã€è°ˆè°ˆspringiocçš„åº•å±‚å®ç°</h2><p>å¯¹ä»–çš„ç†è§£å’Œäº†è§£è¿‡çš„å®ç°è¿‡ç¨‹ï¼š</p>
<p>åå°„ã€å·¥å‚ã€è®¾è®¡æ¨¡å¼(å¦‚æœä¼š)ï¼Œå…³é”®çš„å‡ ä¸ªæ–¹æ³•å¦‚ï¼šcreateBeanFactoryã€getBeanã€doGetBeanã€createBeanã€doCreateBeanã€createBeanInstanceã€populateBeanã€InitializingBean</p>
<ol>
<li>å…ˆé€šè¿‡createBeanFactoryåˆ›å»ºä¸€ä¸ªBeanå·¥å‚ï¼ˆDefaultListableBeanFactoryï¼‰</li>
<li>å¼€å§‹å¾ªç¯åˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºå®¹å™¨ä¸­beané»˜è®¤ä¸ºå•ä¾‹ï¼Œå› æ­¤ä¼˜å…ˆé€šè¿‡getBeanã€doGetBeanä»å®¹å™¨ä¸­æŸ¥æ‰¾</li>
<li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™é€šè¿‡createBeanã€doCreateBeanæ–¹æ³•ï¼Œä»¥åå°„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯æ— å‚æ„é€ æ–¹æ³•ï¼ˆgetDeclaredConstructorï¼ŒnewInstanceï¼‰</li>
<li>è¿›è¡Œå¯¹è±¡çš„å±æ€§å¡«å……populateBean</li>
<li>è¿›è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œï¼ˆInitializingBeanï¼‰</li>
</ol>
<h2 id="3ã€æè¿°ä»¥ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#3ã€æè¿°ä»¥ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3ã€æè¿°ä»¥ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>3ã€æè¿°ä»¥ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><ol>
<li>å®ä¾‹åŒ–beanï¼šåå°„æ–¹å¼ç”Ÿæˆå¯¹è±¡</li>
<li>å¡«å……å±æ€§ï¼špopulateBeanï¼Œå¾ªç¯ä¾èµ–é—®é¢˜ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰</li>
<li>è°ƒç”¨awareæ¥å£çš„æ–¹æ³•ï¼šInvokeAwareMethodï¼ˆå®ŒæˆBeanNameã€BeanFactoryã€BeanClassLoaderç­‰å¯¹è±¡çš„å±æ€§è®¾ç½®ï¼‰</li>
<li>è°ƒç”¨BeanPostProcessorçš„å‰ç½®å¤„ç†æ–¹æ³•</li>
<li>è°ƒç”¨init-methodæ–¹æ³•ï¼šåœ¨è¿™ä¹‹å‰åˆ¤æ–­æ˜¯å¦å®ç°äº†initializingBeanæ¥å£ï¼Œå¦‚æœæœ‰ï¼Œè°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œå¦åˆ™ä¸è°ƒç”¨</li>
<li>è°ƒç”¨BeanPostProcessorçš„åç½®å¤„ç†æ–¹æ³•ï¼šspringçš„aopåœ¨æ­¤å®ç°ï¼ŒAbstractAutoProxyCreateræ³¨å†ŒDeftuctionç›¸å…³å›è°ƒæ¥å£ï¼šé’©å­æ–¹æ³•</li>
<li>è·å–å®Œæ•´å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡getBeançš„æ–¹å¼æ¥è¿›è¡Œå¯¹è±¡çš„è·å–</li>
<li>é”€æ¯æµç¨‹ï¼Œ1ã€åˆ¤æ–­æ˜¯å¦å®ç°äº†DispoableBeanæ¥å£ã€‚2ã€è°ƒç”¨destroyMethodæ–¹æ³•</li>
</ol>
<h2 id="4ã€Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜"><a href="#4ã€Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜" class="headerlink" title="4ã€Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜"></a>4ã€Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</h2><p>ä¸‰çº§ç¼“å­˜  æå‰æš´éœ²å¯¹è±¡  aop</p>
<p>æ€»ï¼šä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–é—®é¢˜ï¼ŒAä¾èµ–Bï¼ŒBä¾èµ–A</p>
<p><img src="/2022/09/07/Spring/study\blog\blog\source_posts\Spring\1662950526009.png" alt="1662950526009" loading="lazy"></p>
<p>åˆ†ï¼šå…ˆè¯´æ˜beançš„åˆ›å»ºè¿‡ç¨‹ï¼šå®ä¾‹åŒ–ã€åˆå§‹åŒ–ï¼ˆå¡«å……å±æ€§ï¼‰</p>
<ol>
<li>åˆ›å»ºAå¯¹è±¡ï¼Œå®ä¾‹åŒ–Aï¼Œæ­¤æ—¶å±æ€§bä¸ºç©ºï¼Œå¡«å……å±æ€§b</li>
<li>ä»å®¹å™¨ä¸­æŸ¥æ‰¾bï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œç›´æ¥èµ‹å€¼ä¸å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œæ‰¾ä¸åˆ°åˆ›å»ºBå¯¹è±¡</li>
<li>åˆ›å»ºBå¯¹è±¡ï¼Œå®ä¾‹åŒ–Bï¼Œæ­¤æ—¶å±æ€§aä¸ºç©ºï¼Œå¡«å……å±æ€§a</li>
<li>ä»å®¹å™¨ä¸­æŸ¥æ‰¾aï¼Œæ‰¾ä¸åˆ°ï¼Œç›´æ¥åˆ›å»º</li>
</ol>
<p>å½¢æˆé—­ç¯çš„åŸå› </p>
<p>äº‹å®ä¸Šï¼Œæ­¤æ—¶aå¯¹è±¡å­˜åœ¨ï¼Œä½†æ­¤æ—¶æ˜¯ä¸€ä¸ªä¸å®Œæ•´å¯¹è±¡ï¼Œåªå®Œæˆå®ä¾‹åŒ–ï¼Œè€Œæ²¡æœ‰åˆå§‹åŒ–ã€‚</p>
<p>å› æ­¤å¯ä»¥ä¼˜å…ˆæŠŠéå®Œæ•´çŠ¶æ€çš„å¯¹è±¡èµ‹å€¼ï¼Œç­‰å¾…åç»­æ“ä½œæ¥å®Œæˆèµ‹å€¼ï¼Œç›¸å½“äºæå‰æš´éœ²äº†æŸä¸ªä¸å®Œæ•´å¯¹è±¡</p>
<p>å½“æ‰€æœ‰çš„å¯¹è±¡éƒ½å®Œæˆå®ä¾‹åŒ–å’Œåˆå§‹åŒ–æ“ä½œåï¼Œè¿˜è¦æŠŠå®Œæ•´å¯¹è±¡å­˜å…¥å®¹å™¨ï¼Œæ­¤æ—¶å®¹å™¨ä¸­å¯¹è±¡å­˜åœ¨ä¸¤ä¸ªçŠ¶æ€ï¼Œå®Œæ•´å’Œä¸å®Œæ•´ å› æ­¤è¦ä½¿ç”¨ä¸¤ä¸ªmapç»“æ„å­˜å‚¨ï¼Œå³ä¸€çº§ç¼“å­˜ã€äºŒçº§ç¼“å­˜</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜</strong></p>
<p>ä¸‰çº§ç¼“å­˜çš„valueç±»å‹æ˜¯ObjectFactoryï¼Œä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå­˜åœ¨çš„æ„ä¹‰æ˜¯ä¿è¯åœ¨æ•´ä¸ªå®¹å™¨çš„è¿è¡Œè¿‡ç¨‹ä¸­åŒåçš„beanå¯¹è±¡åªæœ‰ä¸€ä¸ª</p>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«ä»£ç†ï¼Œæˆ–è€…éœ€è¦ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè¦ä¼˜å…ˆç”Ÿæˆä¸€ä¸ªæ™®é€šå¯¹è±¡ã€‚</p>
<p>æ™®é€šå¯¹è±¡å’Œä»£ç†å¯¹è±¡æ˜¯ä¸èƒ½åŒæ—¶å‡ºç°åœ¨å®¹å™¨ä¸­ï¼Œå› æ­¤å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«ä»£ç†çš„æ—¶å€™ï¼Œå°±è¦ä½¿ç”¨ä»£ç†å¯¹è±¡è¦†ç›–æ‰ä¹‹å‰çš„æ™®é€šå¯¹è±¡ï¼Œåœ¨å®é™…è°ƒç”¨ä¸­ï¼Œæ˜¯æ²¡æœ‰åŠæ³•ç¡®è®¤ä»€ä¹ˆæ—¶å€™å¯¹è±¡è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥å°±è¦æ±‚å½“æŸä¸ªå¯¹è±¡è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼˜å…ˆåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦éœ€è¦è¢«è¦†ç›–ï¼Œç±»ä¼¼äºä¸€ç§å›è°ƒæœºåˆ¶çš„å®ç°ï¼Œå› æ­¤ä¼ å…¥lamabdaè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡lambdaè¡¨è¾¾å¼æ¥æ‰§è¡Œå¯¹è±¡çš„è¦†ç›–è¿‡ç¨‹ï¼ŒgetEarlyBeanReference() </p>
<p>å› æ­¤ï¼Œæ‰€æœ‰çš„beanå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½è¦ä¼˜å…ˆæ”¾åˆ°ä¸‰çº§ç¼“å­˜ï¼Œåœ¨åç»­çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦è¢«ä»£ç†åˆ™è¿”å›ä»£ç†å¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦è¢«ä»£ç†ï¼Œåˆ™ç›´æ¥è¿”å›æ™®é€šå¯¹è±¡</p>
<h3 id="4-1ç¼“å­˜æ”¾ç½®æ—¶é—´å’Œåˆ é™¤æ—¶é—´"><a href="#4-1ç¼“å­˜æ”¾ç½®æ—¶é—´å’Œåˆ é™¤æ—¶é—´" class="headerlink" title="4.1ç¼“å­˜æ”¾ç½®æ—¶é—´å’Œåˆ é™¤æ—¶é—´"></a>4.1ç¼“å­˜æ”¾ç½®æ—¶é—´å’Œåˆ é™¤æ—¶é—´</h3><p>ä¸‰çº§ç¼“å­˜ï¼šcreateBeanInstanceä¹‹åï¼šaddSingletonFactory</p>
<p>äºŒçº§ç¼“å­˜ï¼šç¬¬ä¸€æ¬¡ä»ä¸‰çº§ç¼“å­˜ç¡®å®šå¯¹è±¡æ˜¯ä»£ç†å¯¹è±¡è¿˜æ˜¯æ™®é€šå¯¹è±¡çš„æ—¶å€™ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ getSingleton</p>
<p>ä¸€çº§ç¼“å­˜ï¼šç”Ÿæˆå®Œæ•´å¯¹è±¡ä¹‹åæ”¾åˆ°ä¸€çº§ç¼“å­˜ï¼Œåˆ é™¤äºŒä¸‰çº§ç¼“å­˜ addSingleton</p>
<h2 id="5ã€BeanFactoryä¸FactoryBean"><a href="#5ã€BeanFactoryä¸FactoryBean" class="headerlink" title="5ã€BeanFactoryä¸FactoryBean"></a>5ã€BeanFactoryä¸FactoryBean</h2><p>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡</p>
<p>ä¸åŒç‚¹ï¼šä½¿ç”¨BeanFactoryåˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦éµå¾ªä¸¥æ ¼çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼Œè¿‡äºå¤æ‚ã€‚å¦‚æœæƒ³è¦ç®€å•çš„è‡ªå®šä¹‰æŸä¸ªå¯¹è±¡çš„åˆ›å»ºï¼ŒåŒæ—¶åˆ›å»ºå®Œæˆåäº¤ç»™springç®¡ç†ï¼Œå°±éœ€è¦å®ç°FactoryBeanæ¥å£</p>
<p>â€‹    isSingletonï¼šæ˜¯å¦æ˜¯å•ä¾‹å¯¹è±¡</p>
<p>â€‹    getObjectTypeï¼šè·å–è¿”å›å¯¹è±¡çš„ç±»å‹</p>
<p>â€‹    getObjectï¼šè‡ªå®šä¹‰åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹(newã€åå°„ã€åŠ¨æ€ä»£ç†)</p>
<h2 id="6ã€springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼"><a href="#6ã€springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="6ã€springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼"></a>6ã€springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ï¼šbeané»˜è®¤éƒ½æ˜¯å•ä¾‹</p>
<p>åŸå‹æ¨¡å¼ï¼šæŒ‡å®šä½œç”¨åŸŸprototype</p>
<p>å·¥å‚æ¨¡å¼ï¼šbeanFactory</p>
<p>æ¨¡æ¿æ–¹æ³•ï¼špostProcessorBeanFactoryã€onRefreshã€initPropertyVale</p>
<p>ç­–ç•¥æ¨¡å¼ï¼šXmlBeanDfinitionReaderã€PropertiesBeanDefinitionReader</p>
<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼šlistenerã€eventã€multicast</p>
<p>é€‚é…å™¨æ¨¡å¼ï¼šAdapter</p>
<p>è£…é¥°è€…æ¨¡å¼ï¼šBeanWrapper</p>
<p>è´£ä»»é“¾æ¨¡å¼ï¼šä½¿ç”¨aopçš„æ—¶å€™ä¼šå…ˆç”Ÿæˆä¸€ä¸ªæ‹¦æˆªå™¨é“¾</p>
<p>ä»£ç†æ¨¡å¼ï¼šåŠ¨æ€ä»£ç†ï¼Œjdkã€cglib</p>
<p>å§”æ‰˜è€…æ¨¡å¼ï¼šdelegate</p>
<p>ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="7ã€springçš„aopåº•å±‚åŸç†"><a href="#7ã€springçš„aopåº•å±‚åŸç†" class="headerlink" title="7ã€springçš„aopåº•å±‚åŸç†"></a>7ã€springçš„aopåº•å±‚åŸç†</h2><p>aopæ˜¯iocçš„ä¸€ä¸ªæ‰©å±•åŠŸèƒ½ï¼Œå…ˆæœ‰çš„iocï¼Œåœ¨æœ‰çš„aopã€‚åªæ˜¯åœ¨iocæ•´ä¸ªæµç¨‹ä¸­æ–°å¢çš„ä¸€ä¸ªæ‰©å±•ç‚¹è€Œå·²ï¼š<strong>BeanPostProcessor</strong></p>
<p>æ€»ï¼šaopæ¦‚å¿µï¼Œåº”ç”¨åœºæ™¯ï¼ŒåŠ¨æ€ä»£ç†</p>
<p>åˆ†ï¼šbeançš„åˆ›å»ºè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å¯ä»¥å¯¹beanè¿›è¡Œæ‰©å±•å®ç°ï¼Œaopæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ‰©å±•åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨BeanPostProcessorçš„åç½®å¤„ç†æ–¹æ³•ä¸­æ¥è¿›è¡Œå®ç°ã€‚</p>
<p>â€‹    1ã€ä»£ç†å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼ˆadviceã€åˆ‡é¢ã€åˆ‡ç‚¹ï¼‰</p>
<p>â€‹    2ã€é€šè¿‡jckæˆ–cglibçš„æ–¹å¼ç”Ÿæˆä»£ç†å¯¹è±¡</p>
<p>â€‹    3ã€åœ¨æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„shiâ€™houï¼Œä¼šè°ƒç”¨åˆ°ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œç›´æ¥å›æ‰¾åˆ°DynamicAdvisoredInterceptorç±»ä¸­çš„inteceptæ–¹æ³•ï¼Œä»æ­¤æ–¹æ³•æ‰§è¡Œ</p>
<p>â€‹    4ã€æ ¹æ®ä¹‹å‰å®šä¹‰å¥½çš„é€šçŸ¥æ¥ç”Ÿæˆæ‹¦æˆªå™¨é“¾</p>
<p>â€‹    5ã€ä»æ‹¦æˆªå™¨é“¾ä¸­ä¾æ¬¡è·å–æ¯ä¸€ä¸ªé€šçŸ¥å¼€å§‹æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿æ‰¾åˆ°ä¸‹ä¸€ä¸ªé€šçŸ¥æ˜¯å“ªä¸ªï¼Œä¼šæœ‰ä¸€ä¸ªCglibMethodInvocationçš„å¯¹è±¡ï¼Œä»-1çš„ä½ç½®ä¾æ¬¡æŸ¥æ‰¾å¹¶ä¸”æ‰§è¡Œ</p>
<h2 id="8ã€springäº‹åŠ¡å¦‚ä½•å›æ»š"><a href="#8ã€springäº‹åŠ¡å¦‚ä½•å›æ»š" class="headerlink" title="8ã€springäº‹åŠ¡å¦‚ä½•å›æ»š"></a>8ã€springäº‹åŠ¡å¦‚ä½•å›æ»š</h2><p>springäº‹åŠ¡å¦‚ä½•å®ç°ï¼Ÿ</p>
<p>æ€»ï¼šspringäº‹åŠ¡æ˜¯ç”±aopå®ç°çš„ï¼Œé¦–å…ˆè¦ç”Ÿæˆä»£ç†ä»£ç†å¯¹è±¡ï¼Œç„¶åæŒ‰ç…§aopçš„æ•´å¥—æµç¨‹æ¥æ‰§è¡Œå…·ä½“çš„æ“ä½œé€»è¾‘ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¦é€šè¿‡é€šçŸ¥æ¥å®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼Œä½†äº‹åŠ¡ä¸æ˜¯ç”¨è¿‡é€šçŸ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ª<strong>TransactionInterceptor</strong>æ¥å®ç°çš„ï¼Œç„¶åè°ƒç”¨invokeæ¥å®ç°å…·ä½“çš„é€»è¾‘</p>
<p>åˆ†ï¼š1ã€å…ˆåšå‡†å¤‡å·¥ä½œï¼Œè§£æå„ä¸ªæ–¹æ³•ä¸Šç›¸å…³çš„äº‹åŠ¡å±æ€§ï¼Œæ ¹æ®å…·ä½“çš„å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¼€å§‹æ–°äº‹ç‰©</p>
<p>â€‹       2ã€å½“éœ€è¦å¼€å¯çš„æ—¶å€™ï¼Œè·å–æ•°æ®åº“è¿æ¥ï¼Œå…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼Œå¼€å¯äº‹åŠ¡</p>
<p>â€‹       3ã€æ‰§è¡Œå…·ä½“çš„sqlæ“ä½œ</p>
<p>â€‹       4ã€åœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰§è¡Œå¤±è´¥äº†ï¼Œä¼šé€šè¿‡completeTransactionAfterThrowingæ¥å®Œæˆäº‹åŠ¡å›æ»šæ“ä½œï¼Œå›æ»šçš„å…·ä½“é€»è¾‘æ˜¯é€šè¿‡doRollBackæ–¹æ³•æ¥å®ç°çš„ï¼Œå®ç°çš„æ—¶å€™ä¹Ÿæ˜¯å…ˆè·å–è¿æ¥å¯¹è±¡ï¼Œé€šè¿‡è¿æ¥å¯¹è±¡æ¥å›æ»š</p>
<p>â€‹       5ã€å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰æ„å¤–æƒ…å†µå‘ç”Ÿï¼Œé€šè¿‡commitTransactionAfterReturningæ¥å®Œæˆäº‹åŠ¡çš„æäº¤æ“ä½œï¼Œæäº¤çš„å…·ä½“é€»è¾‘æ˜¯é€šè¿‡doCommitæ–¹æ³•æ¥å®Œæˆçš„ï¼Œå®ç°çš„æ—¶å€™ä¹Ÿæ˜¯å…ˆè·å–è¿æ¥ï¼Œé€šè¿‡è¿æ¥å¯¹è±¡æ¥æäº¤</p>
<p>â€‹       6ã€å½“äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œéœ€è¦æ¸…é™¤ç›¸å…³çš„äº‹åŠ¡ä¿¡æ¯cleanupTransactionInfo</p>
<h2 id="9ã€è°ˆä¸€ä¸‹springäº‹åŠ¡ä¼ æ’­"><a href="#9ã€è°ˆä¸€ä¸‹springäº‹åŠ¡ä¼ æ’­" class="headerlink" title="9ã€è°ˆä¸€ä¸‹springäº‹åŠ¡ä¼ æ’­"></a>9ã€è°ˆä¸€ä¸‹springäº‹åŠ¡ä¼ æ’­</h2><p>ä¼ æ’­ç‰¹æ€§æœ‰å‡ ç§ï¼Ÿ<strong>7ç§</strong></p>
<p>Requiredã€Requires_newã€nestedã€Supportã€Not_Supportã€Neverã€Mandatory</p>
<p>é—®ï¼šæŸä¸€ä¸ªäº‹åŠ¡åµŒå¥—å¦ä¸€ä¸ªäº‹åŠ¡æ€ä¹ˆåŠ</p>
<p>Aæ–¹æ³•è°ƒç”¨Bæ–¹æ³•ï¼ŒABæ–¹æ³•éƒ½æœ‰äº‹åŠ¡ï¼Œå¹¶ä¸”ä¼ æ’­ç‰¹æ€§ä¸åŒï¼Œé‚£ä¹ˆAå¦‚æœæœ‰å¼‚å¸¸ï¼ŒBæ€ä¹ˆåŠï¼Ÿæˆ–è€…Bå¦‚æœæœ‰å¼‚å¸¸Aæ€ä¹ˆåŠï¼Ÿ</p>
<p>æ€»ï¼šäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§æŒ‡çš„æ˜¯ä¸åŒæ–¹æ³•çš„åµŒå¥—è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡åº”è¯¥å¦‚ä½•å¤„ç†ï¼Œæ˜¯ç”¨åŒä¸€ä¸ªäº‹åŠ¡è¿˜æ˜¯ä¸åŒçš„äº‹åŠ¡ï¼Œå½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™ä¼šå›æ»šè¿˜æ˜¯æäº¤ï¼Œä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ã€‚ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯requiredã€requires_newã€nested</p>
<p>åˆ†ï¼š1ã€äº‹åŠ¡çš„ä¸åŒåˆ†ç±»ï¼šåˆ†ä¸ºä¸‰ç±»ï¼š<code>æ”¯æŒå½“å‰äº‹åŠ¡ã€ä¸æ”¯æŒå½“å‰äº‹åŠ¡ã€åµŒå¥—äº‹åŠ¡</code></p>
<p>â€‹            ä¸æ”¯æŒå½“å‰äº‹åŠ¡(ä¸‰ç§ï¼Œå¯¹äº‹åŠ¡çš„æŠµåˆ¶ç”±å¼ºåˆ°å¼±)ï¼šneverï¼šå­˜åœ¨å½“å‰äº‹åŠ¡å°±æŠ¥å¼‚å¸¸ï¼›not_supportï¼šå­˜åœ¨å½“å‰äº‹åŠ¡å°±æŒ‚èµ·ï¼›requires_newï¼šå­˜åœ¨å½“å‰äº‹åŠ¡æŒ‚èµ·å¹¶æ–°å»ºäº‹åŠ¡</p>
<p>â€‹            æ”¯æŒå½“å‰äº‹åŠ¡(ä¸‰ç§ï¼Œå¯¹äº‹åŠ¡çš„ä¾èµ–ä»å¼ºåˆ°å¼±)ï¼šmandatoryï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰åˆ™æŠ¥å¼‚å¸¸ï¼›requiredï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰åˆ™æ–°å»ºï¼›supportsï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰åˆ™ä¸ç”¨äº‹åŠ¡</p>
<p>â€‹            åµŒå¥—äº‹åŠ¡ï¼šnestedï¼šå¦‚æœå­˜åœ¨å½“å‰äº‹åŠ¡åˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼Œå¦‚æœå½“å‰äº‹åŠ¡ä¸èƒ½å­˜åœ¨ï¼Œåˆ™ç­‰ä»·äºrequired(æ–°å»º)</p>
<p>â€‹       2ã€å¦‚æœå¤–å±‚æ–¹æ³•æ˜¯requiredï¼Œå†…å±‚æ–¹æ³•æ˜¯ requiredï¼Œrequires_newï¼Œnested</p>
<p>â€‹       3ã€å¦‚æœå¤–å±‚æ–¹æ³•æ˜¯requires_new,å†…å±‚æ–¹æ³•æ˜¯ requiredï¼Œrequires_newï¼Œnested </p>
<p>â€‹       4ã€å¦‚æœå¤–å±‚æ–¹æ³•æ˜¯nestedï¼Œå†…å±‚æ–¹æ³•æ˜¯ requiredï¼Œrequires_newï¼Œnested</p>
<p>æ ¸å¿ƒå¤„ç†é€»è¾‘ï¼š</p>
<p>1ã€åˆ¤æ–­å†…å¤–æ–¹æ³•æ˜¯å¦æ˜¯åŒä¸€ä¸ªäº‹åŠ¡</p>
<p>â€‹    æ˜¯ï¼šå¼‚å¸¸ç»Ÿä¸€åœ¨å¤–å±‚æ–¹æ³•å¤„ç†</p>
<p>â€‹    å¦ï¼šå†…å±‚æ–¹æ³•æœ‰å¯èƒ½å½±å“åˆ°å¤–å±‚æ–¹æ³•ï¼Œä½†æ˜¯å¤–å±‚æ–¹æ³•æ˜¯ä¸ä¼šå½±å“åˆ°å†…å±‚æ–¹æ³•çš„</p>
<h2 id="10ã€springäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#10ã€springäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="10ã€springäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>10ã€springäº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p>ä½¿ç”¨çš„æ˜¯æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼š</p>
<ul>
<li>read uncommitted</li>
<li>read committed</li>
<li>repeatable read</li>
<li>serializable</li>
</ul>
<p>è¿›è¡Œé…ç½®æ—¶ï¼Œå¦‚æœæ•°æ®åº“å’Œspringä»£ç ä¸­çš„éš”ç¦»çº§åˆ«ä¸åŒï¼Œä»¥springçš„é…ç½®ä¸ºä¸»</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.jpg"><img loading="lazy" src="/images/alipay.jpg" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wechatpay.png"><img loading="lazy" src="/images/wechatpay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ç¿”ä»”</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://example.com/2022/09/07/Spring/" title="Spring">http://example.com/2022/09/07/Spring/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/09/04/shiro/" rel="next" title="shiro"><span class="post-nav-text">shiro</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2022 </span><span class="with-love" id="animate" title="äº‘æ¸¸å›çš„èµåŠ©è€…ä»¬"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ç¿”ä»”</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.2</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.8.11</span></div><div class="live-time"><span>æœ¬åšå®¢å·²è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2022-04-10T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>