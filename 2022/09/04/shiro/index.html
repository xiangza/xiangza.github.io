<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ç¿”ä»”"><meta name="copyright" content="ç¿”ä»”"><meta name="generator" content="Hexo 5.4.2"><meta name="theme" content="hexo-theme-yun"><title>shiro | ç¿”ä»”çš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"ç¿”ä»”çš„å°ç«™","version":"1.8.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="ä¸€ã€æƒé™æ¦‚è¿°1ã€ä»€ä¹ˆæ˜¯æƒé™æƒé™ç®¡ç†ï¼šæ ¹æ®ç³»ç»ŸæŒ‡å®šçš„å®‰å…¨è§„åˆ™ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®ä¸”åªèƒ½è®¿é—®è‡ªå·±è¢«æˆæƒçš„èµ„æºã€‚ æƒé™ç®¡ç†ä¸€èˆ¬åˆ†ä¸ºï¼š  è®¿é—®æƒé™ ä¸åŒçš„èº«ä»½è§’è‰²ï¼Œå…è®¸æ‰§è¡Œçš„æ“ä½œä¸åŒï¼Œå¦‚æ·˜å®å–å®¶ã€ä¹°å®¶  æ•°æ®æƒé™ ä¸€ä¸ªè§’è‰²èº«ä»½ï¼Œå¯ä»¥è®¿é—®åˆ°çš„æ•°æ®å†…å®¹ä¸åŒï¼Œå¦‚åº—é“ºä¸»ç®¡å¯ä»¥çœ‹åˆ°æ‰‹ä¸‹å®¢æˆ·äººå‘˜æ‰€æœ‰æœåŠ¡çš„ä¹°å®¶è®¢å•ä¿¡æ¯ï¼Œè€Œå¥¹çš„æ‰‹ä¸‹åªèƒ½çœ‹åˆ°è‡ªå·±è´Ÿè´£çš„è®¢å•ä¿¡æ¯   2ã€è®¤è¯æ¦‚å¿µ1ã€ä»€ä¹ˆæ˜¯è®¤è¯èº«ä»½è®¤è¯ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨">
<meta property="og:type" content="article">
<meta property="og:title" content="shiro">
<meta property="og:url" content="http://example.com/2022/09/04/shiro/index.html">
<meta property="og:site_name" content="ç¿”ä»”çš„åšå®¢">
<meta property="og:description" content="ä¸€ã€æƒé™æ¦‚è¿°1ã€ä»€ä¹ˆæ˜¯æƒé™æƒé™ç®¡ç†ï¼šæ ¹æ®ç³»ç»ŸæŒ‡å®šçš„å®‰å…¨è§„åˆ™ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®ä¸”åªèƒ½è®¿é—®è‡ªå·±è¢«æˆæƒçš„èµ„æºã€‚ æƒé™ç®¡ç†ä¸€èˆ¬åˆ†ä¸ºï¼š  è®¿é—®æƒé™ ä¸åŒçš„èº«ä»½è§’è‰²ï¼Œå…è®¸æ‰§è¡Œçš„æ“ä½œä¸åŒï¼Œå¦‚æ·˜å®å–å®¶ã€ä¹°å®¶  æ•°æ®æƒé™ ä¸€ä¸ªè§’è‰²èº«ä»½ï¼Œå¯ä»¥è®¿é—®åˆ°çš„æ•°æ®å†…å®¹ä¸åŒï¼Œå¦‚åº—é“ºä¸»ç®¡å¯ä»¥çœ‹åˆ°æ‰‹ä¸‹å®¢æˆ·äººå‘˜æ‰€æœ‰æœåŠ¡çš„ä¹°å®¶è®¢å•ä¿¡æ¯ï¼Œè€Œå¥¹çš„æ‰‹ä¸‹åªèƒ½çœ‹åˆ°è‡ªå·±è´Ÿè´£çš„è®¢å•ä¿¡æ¯   2ã€è®¤è¯æ¦‚å¿µ1ã€ä»€ä¹ˆæ˜¯è®¤è¯èº«ä»½è®¤è¯ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662280696442.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662283257864.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662284278493.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662303041272.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662308983705.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662309048850.png">
<meta property="og:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662432172952.png">
<meta property="article:published_time" content="2022-09-04T08:25:51.000Z">
<meta property="article:modified_time" content="2022-09-06T13:25:36.904Z">
<meta property="article:author" content="ç¿”ä»”">
<meta property="article:tag" content="shiro">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/09/04/shiro/study/blog/blog/source_posts/shiro/1662280696442.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ç¿”ä»”"><img width="96" loading="lazy" src="/images/tx.jpg" alt="ç¿”ä»”"><span class="site-author-status" title="ä¸æƒ³ä¸Šå­¦">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">ç¿”ä»”</a></div><span class="site-name">ç¿”ä»”çš„åšå®¢</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="æˆ‘çš„ä¸»é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">28</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=910426929&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="985391895@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%9D%83%E9%99%90%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€æƒé™æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%9D%83%E9%99%90"><span class="toc-number">1.1.</span> <span class="toc-text">1ã€ä»€ä¹ˆæ˜¯æƒé™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%AE%A4%E8%AF%81%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">2ã€è®¤è¯æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%A4%E8%AF%81"><span class="toc-number">1.2.1.</span> <span class="toc-text">1ã€ä»€ä¹ˆæ˜¯è®¤è¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2ã€è®¤è¯æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%85%B3%E9%94%AE%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">3ã€å…³é”®å¯¹è±¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8E%88%E6%9D%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.</span> <span class="toc-text">3ã€æˆæƒæ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%8E%88%E6%9D%83"><span class="toc-number">1.3.1.</span> <span class="toc-text">1ã€ä»€ä¹ˆæ˜¯æˆæƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">2ã€æˆæƒæµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%85%B3%E9%94%AE%E5%AF%B9%E8%B1%A1-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">3ã€å…³é”®å¯¹è±¡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81shiro%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€shiroæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">1ã€ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2ã€æ ¸å¿ƒç»„ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81shiro%E5%85%A5%E9%97%A8"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€shiroå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">3.1.</span> <span class="toc-text">1ã€èº«ä»½è®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">1ã€åŸºæœ¬æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">3.1.2.</span> <span class="toc-text">2ã€æ¡ˆä¾‹æ¼”ç¤º</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">2.1åˆ›å»ºé¡¹ç›®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">2.2å¯¼å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3%E7%BC%96%E5%86%99shiro-ini"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">2.3ç¼–å†™shiro.ini</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">2.4ç¼–å†™ä»£ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Realm"><span class="toc-number">3.2.</span> <span class="toc-text">2ã€Realm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81Realm%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.2.1.</span> <span class="toc-text">1ã€Realmæ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89Realm"><span class="toc-number">3.2.2.</span> <span class="toc-text">2ã€è‡ªå®šä¹‰Realm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%8A%A0%E5%AF%86"><span class="toc-number">3.2.3.</span> <span class="toc-text">3ã€åŠ å¯†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%BA%AB%E4%BB%BD%E6%8E%88%E6%9D%83"><span class="toc-number">3.3.</span> <span class="toc-text">3ã€èº«ä»½æˆæƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">1ã€åŸºæœ¬æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">2ã€æˆæƒæ–¹å¼</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2022/09/04/shiro/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ç¿”ä»”"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ç¿”ä»”çš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">shiro</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-04 16:25:51" itemprop="dateCreated datePublished" datetime="2022-09-04T16:25:51+08:00">2022-09-04</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-06 21:25:36" itemprop="dateModified" datetime="2022-09-06T21:25:36+08:00">2022-09-06</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%A1%86%E6%9E%B6/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æ¡†æ¶</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/shiro/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">shiro</span></a></span></div><div class="post-author"><span class="author-name">ç¿”ä»”</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="ä¸€ã€æƒé™æ¦‚è¿°"><a href="#ä¸€ã€æƒé™æ¦‚è¿°" class="headerlink" title="ä¸€ã€æƒé™æ¦‚è¿°"></a>ä¸€ã€æƒé™æ¦‚è¿°</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯æƒé™"><a href="#1ã€ä»€ä¹ˆæ˜¯æƒé™" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯æƒé™"></a>1ã€ä»€ä¹ˆæ˜¯æƒé™</h3><p><strong>æƒé™ç®¡ç†ï¼š</strong>æ ¹æ®ç³»ç»ŸæŒ‡å®šçš„å®‰å…¨è§„åˆ™ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®ä¸”åªèƒ½è®¿é—®è‡ªå·±è¢«æˆæƒçš„èµ„æºã€‚</p>
<p>æƒé™ç®¡ç†ä¸€èˆ¬åˆ†ä¸ºï¼š</p>
<ul>
<li><p>è®¿é—®æƒé™</p>
<p>ä¸åŒçš„èº«ä»½è§’è‰²ï¼Œå…è®¸æ‰§è¡Œçš„æ“ä½œä¸åŒï¼Œ<strong>å¦‚æ·˜å®å–å®¶ã€ä¹°å®¶</strong></p>
</li>
<li><p>æ•°æ®æƒé™</p>
<p>ä¸€ä¸ªè§’è‰²èº«ä»½ï¼Œå¯ä»¥è®¿é—®åˆ°çš„æ•°æ®å†…å®¹ä¸åŒï¼Œ<strong>å¦‚åº—é“ºä¸»ç®¡å¯ä»¥çœ‹åˆ°æ‰‹ä¸‹å®¢æˆ·äººå‘˜æ‰€æœ‰æœåŠ¡çš„ä¹°å®¶è®¢å•ä¿¡æ¯ï¼Œè€Œå¥¹çš„æ‰‹ä¸‹åªèƒ½çœ‹åˆ°è‡ªå·±è´Ÿè´£çš„è®¢å•ä¿¡æ¯</strong></p>
</li>
</ul>
<h3 id="2ã€è®¤è¯æ¦‚å¿µ"><a href="#2ã€è®¤è¯æ¦‚å¿µ" class="headerlink" title="2ã€è®¤è¯æ¦‚å¿µ"></a>2ã€è®¤è¯æ¦‚å¿µ</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯è®¤è¯"><a href="#1ã€ä»€ä¹ˆæ˜¯è®¤è¯" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯è®¤è¯"></a>1ã€ä»€ä¹ˆæ˜¯è®¤è¯</h4><p>èº«ä»½è®¤è¯ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ€å¸¸ç”¨çš„ç®€å•èº«ä»½è®¤è¯æ–¹å¼å°±æ˜¯ï¼Œç³»ç»Ÿé€šè¿‡æ ¸å¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå£ä»¤ï¼Œçœ‹å…¶æ˜¯å¦ä¸ç³»ç»Ÿå­˜å‚¨çš„ç”¨æˆ·åå’Œå£ä»¤ä¸€è‡´ï¼Œæ¥åˆ¤æ–­èº«ä»½æ˜¯å¦æ­£ç¡®ï¼Œ<strong>å¦‚çŸ­ä¿¡éªŒè¯ã€å¯†ç éªŒè¯</strong></p>
<h4 id="2ã€è®¤è¯æµç¨‹"><a href="#2ã€è®¤è¯æµç¨‹" class="headerlink" title="2ã€è®¤è¯æµç¨‹"></a>2ã€è®¤è¯æµç¨‹</h4><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662280696442.png" alt="1662280696442" loading="lazy"></p>
<h4 id="3ã€å…³é”®å¯¹è±¡"><a href="#3ã€å…³é”®å¯¹è±¡" class="headerlink" title="3ã€å…³é”®å¯¹è±¡"></a>3ã€å…³é”®å¯¹è±¡</h4><p><code>Subjectï¼š</code>ä¸»ä½“ï¼Œè®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œä¸»ä½“å¯ä»¥æ˜¯ç”¨æˆ·ã€ç¨‹åºç­‰</p>
<p><code>Principalï¼š</code>èº«ä»½ä¿¡æ¯æ˜¯ä¸»ä½“è¿›è¡Œèº«ä»½è®¤è¯çš„æ ‡è¯†ï¼Œå…·æœ‰å”¯ä¸€æ€§ï¼Œå¦‚ç”¨æˆ·åã€æ‰‹æœºå·ã€é‚®ç®±åœ°å€ï¼Œä¸€ä¸ªä¸»ä½“å¯ä»¥æœ‰å¤šä¸ªèº«ä»½ï¼Œä½†å¿…é¡»æœ‰ä¸€ä¸ªä¸»èº«ä»½</p>
<p><code>credentialï¼š</code>å‡­è¯ä¿¡æ¯ï¼šæ˜¯åªæœ‰ä¸»ä½“è‡ªå·±æ‰çŸ¥é“çš„å®‰å…¨ä¿¡æ¯ï¼Œå¦‚å¯†ç ã€è¯ä¹¦ç­‰</p>
<h3 id="3ã€æˆæƒæ¦‚å¿µ"><a href="#3ã€æˆæƒæ¦‚å¿µ" class="headerlink" title="3ã€æˆæƒæ¦‚å¿µ"></a>3ã€æˆæƒæ¦‚å¿µ</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯æˆæƒ"><a href="#1ã€ä»€ä¹ˆæ˜¯æˆæƒ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯æˆæƒ"></a>1ã€ä»€ä¹ˆæ˜¯æˆæƒ</h4><p>æˆæƒã€å³è®¿é—®æ§åˆ¶ï¼Œæ§åˆ¶å“ªäº›èº«ä»½çš„ç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›èµ„æºï¼Œä¸»ä½“è¿›è¡Œèº«ä»½è®¤è¯åï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ†é…å¯¹åº”çš„æƒé™ï¼Œå½“è®¿é—®èµ„æºæ—¶ï¼Œç³»ç»Ÿä¼šæ ¡éªŒå¯¹åº”ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®èµ„æºçš„æƒé™ã€‚</p>
<p><strong>ç”¨æˆ·å¯¹è±¡userï¼š</strong>å½“å‰æ“ä½œçš„ç”¨æˆ·ã€ç¨‹åº</p>
<p><strong>èµ„æºå¯¹è±¡resourceï¼š</strong>å½“å‰è¢«è®¿é—®çš„å¯¹è±¡</p>
<p><strong>è§’è‰²å¯¹è±¡roleï¼š</strong>ä¸€ç»„æˆæƒæ“ä½œè®¸å¯æƒçš„é›†åˆ</p>
<p><strong>æƒé™å¯¹è±¡permissionï¼š</strong>æƒé™æ“ä½œè®¸å¯æƒ</p>
<h4 id="2ã€æˆæƒæµç¨‹"><a href="#2ã€æˆæƒæµç¨‹" class="headerlink" title="2ã€æˆæƒæµç¨‹"></a>2ã€æˆæƒæµç¨‹</h4><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662283257864.png" alt="1662283257864" loading="lazy"></p>
<h4 id="3ã€å…³é”®å¯¹è±¡-1"><a href="#3ã€å…³é”®å¯¹è±¡-1" class="headerlink" title="3ã€å…³é”®å¯¹è±¡"></a>3ã€å…³é”®å¯¹è±¡</h4><p><strong>æˆæƒç®€å•ç†è§£ä¸ºwhoå¯¹whatè¿›è¡Œhowæ“ä½œ</strong></p>
<p><strong>whoï¼š</strong>ä¸»ä½“ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·æˆ–ç¨‹åº</p>
<p><strong>whatï¼š</strong>èµ„æºï¼Œå¦‚ç³»ç»Ÿèœå•ã€é¡µé¢ã€æŒ‰é’®ã€æ–¹æ³•ã€ç³»ç»Ÿå•†å“ä¿¡æ¯</p>
<ul>
<li>è®¿é—®ç±»å‹ï¼šå•†å“èœå•ã€è®¢å•èœå•</li>
<li>æ•°æ®ç±»å‹ï¼šæˆ‘çš„å•†å“ã€æˆ‘çš„è®¢å•</li>
</ul>
<p><strong>howï¼š</strong>æƒé™è®¸å¯</p>
<ul>
<li>æˆ‘çš„å•†å“  è®¿é—®æˆ‘çš„å•†å“è®¸å¯</li>
<li>åˆ†é”€å•†èœå•  è®¿é—®åˆ†é”€å•†èœå•è®¸å¯</li>
</ul>
<h2 id="äºŒã€shiroæ¦‚è¿°"><a href="#äºŒã€shiroæ¦‚è¿°" class="headerlink" title="äºŒã€shiroæ¦‚è¿°"></a>äºŒã€shiroæ¦‚è¿°</h2><h3 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h3><p><code>ä»€ä¹ˆæ˜¯shiroï¼š</code></p>
<p>ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå°†è½¯ä»¶ç³»ç»Ÿçš„å®‰å…¨è®¤è¯ç›¸å…³åŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå®ç°ç”¨æˆ·èº«ä»½è®¤è¯ï¼Œæƒé™æ ¡éªŒã€åŠ å¯†ã€ä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç»„æˆçš„ä¸€ä¸ªå®‰å…¨è®¤è¯æ¡†æ¶</p>
<p><code>ç‰¹ç‚¹ï¼š</code></p>
<ul>
<li>æ˜“äºç†è§£çš„java security API</li>
<li>ç®€å•çš„èº«ä»½è®¤è¯ï¼Œæ”¯æŒå¤šç§æ•°æ®æºï¼ˆjdbcï¼‰</li>
<li>å¯¹è§’è‰²çš„çš„ç®€å•çš„é‰´æƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰ï¼Œä¹Ÿæ”¯æŒç»†ç²’åº¦çš„é‰´æƒ</li>
<li>æ”¯æŒä¸€çº§ç¼“å­˜</li>
<li>å†…ç½®çš„åŸºäºpojoä¼ä¸šçº§ä¼šè¯ç®¡ç†ï¼Œé€‚ç”¨äºwebåŠéweb</li>
<li>å¼‚æ„å®¢æˆ·ç«¯ä¼šè¯è®¿é—®</li>
<li>ç®€å•çš„åŠ å¯†API</li>
<li>ä¸ä¸ä»»ä½•æ¡†æ¶æ†ç»‘ï¼Œå¯ç‹¬ç«‹è¿è¡Œ</li>
</ul>
<h3 id="2ã€æ ¸å¿ƒç»„ä»¶"><a href="#2ã€æ ¸å¿ƒç»„ä»¶" class="headerlink" title="2ã€æ ¸å¿ƒç»„ä»¶"></a>2ã€æ ¸å¿ƒç»„ä»¶</h3><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662284278493.png" alt="1662284278493" loading="lazy"></p>
<ul>
<li><p>Subject</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subjectä¸»ä½“ï¼Œå¤–éƒ¨åº”ç”¨äºsubkectè¿›è¡Œäº¤äº’ï¼Œsubjectå°†ç”¨æˆ·ä½œä¸ºå½“å‰æ“ä½œçš„ä¸»ä½“ã€‚è¿™ä¸ªä¸»ä½“å¯ä»¥æ˜¯ä¸€ä¸ªé€šè¿‡æµè§ˆå™¨è¯·æ±‚çš„ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºã€‚subjectåœ¨shiroä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†è®¸å¤šè®¤è¯æˆæƒç›¸å…³çš„æ–¹æ³•ï¼Œå¤–éƒ¨ç¨‹åºé€šè¿‡subjectè¿›è¡Œè®¤è¯æˆæƒï¼Œè€Œsubjectæ˜¯é€šè¿‡securityManagerå®‰å…¨ç®¡ç†å™¨è¿›è¡Œè®¤è¯æˆæƒ</span><br></pre></td></tr></table></figure></li>
<li><p>SecurityManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">securityManageræƒé™ç®¡ç†å™¨ï¼Œæ˜¯shiroçš„æ ¸å¿ƒï¼Œè´Ÿè´£å¯¹æ‰€æœ‰çš„subjectè¿›è¡Œå®‰å…¨ç®¡ç†ã€‚é€šè¿‡securityManagerå¯ä»¥å®Œæˆsubjectçš„è®¤è¯ã€æˆæƒç­‰ï¼ŒsecurityManageræ˜¯é€šè¿‡Authenticatiorè¿›è¡Œè®¤è¯ï¼Œé€šè¿‡Authorizerè¿›è¡Œæˆæƒï¼Œé€šè¿‡sessionManagerè¿›è¡Œä¼šè¯ç®¡ç†ç­‰ã€‚Securityæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿äº†Authorticatorï¼ŒAuthorizerï¼ŒSessionManagerä¸‰ä¸ªæ¥å£</span><br></pre></td></tr></table></figure></li>
<li><p>Authenticator</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authenticatorå³è®¤è¯å™¨ï¼Œå¯¹ç”¨æˆ·ç™»é™†æ—¶è¿›è¡Œèº«ä»½è®¤è¯</span><br></pre></td></tr></table></figure></li>
<li><p>Authorizer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorizeræˆæƒå™¨ï¼Œç”¨æˆ·é€šè¿‡è®¤è¯å™¨è®¤è¯åï¼Œåœ¨è®¿é—®èµ„æºæ—¶éœ€è¦é€šè¿‡æˆæƒå™¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”èµ„æºçš„æƒé™</span><br></pre></td></tr></table></figure></li>
<li><p>Realmï¼ˆæ•°æ®åº“è¯»å–+è®¤è¯åŠŸèƒ½+æˆæƒåŠŸèƒ½å®ç°ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Realmé¢†åŸŸï¼Œç›¸å½“äºdataSourceæ•°æ®æºï¼ŒsecuirtyManagerè¿›è¡Œå®‰å…¨è®¤è¯éœ€è¦é€šè¿‡Realmè·å–ç”¨æˆ·æƒé™æ•°æ®</span><br><span class="line">æ¯”å¦‚ï¼š</span><br><span class="line">	å¦‚æœç”¨æˆ·çš„èº«ä»½æ•°æ®åœ¨æ•°æ®åº“é‚£ä¹ˆrealmå°±éœ€è¦ä»æ•°æ®åº“è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯</span><br><span class="line">æ³¨æ„ï¼š</span><br><span class="line">	ä¸è¦æŠŠrealmåªç†è§£ä¸ºåªæ˜¯ä»æ•°æ®æºè·å–æ•°æ®ï¼Œåœ¨realmä¸­è¿˜æœ‰è®¤è¯æˆæƒçš„ç›¸å…³ä»£ç </span><br></pre></td></tr></table></figure></li>
<li><p>SessionManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SessionManagerä¼šè¯ç®¡ç†ï¼Œshiroæ¡†æ¶å®šä¹‰äº†ä¸€å¥—ä¼šè¯ç®¡ç†ï¼Œä¸ä¾èµ–webå®¹å™¨çš„sessionï¼Œæ‰€ä»¥shiroå¯ä»¥ä½¿ç”¨åœ¨webåº”ç”¨ä¸Šï¼Œä¹Ÿå¯ä»¥å°†åˆ†å¸ƒå¼åº”ç”¨çš„ä¼šè¯é›†ä¸­åœ¨ä¸€ç‚¹ç®¡ç†ï¼Œä»¥æ­¤æ¥å®ç°å•ç‚¹ç™»å½•</span><br></pre></td></tr></table></figure></li>
<li><p>SessionDao</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SessionDaoå³ä¼šè¯daoï¼Œæ˜¯å¯¹sessionä¼šè¯æ“ä½œçš„ä¸€å¥—æ¥å£</span><br><span class="line">æ¯”å¦‚	</span><br><span class="line">	é€šè¿‡jdbcå°†ä¼šè¯å­˜å‚¨åˆ°æ•°æ®åº“</span><br><span class="line">	ä¹Ÿå¯ä»¥æŠŠsessionå­˜å‚¨åˆ°ç¼“å­˜æœåŠ¡å™¨</span><br></pre></td></tr></table></figure></li>
<li><p>CacheManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CacheManagerç¼“å­˜ç®¡ç†ï¼Œå°†ç”¨æˆ·æˆæƒæ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ï¼Œæé«˜æ€§èƒ½</span><br></pre></td></tr></table></figure></li>
<li><p>Cryptography</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cryptographyå¯†ç ç®¡ç†ï¼Œshiroæä¾›äº†ä¸€å¥—åŠ å¯†/è§£å¯†çš„ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘ã€‚æä¾›å¸¸ç”¨çš„æ•£åˆ—ã€åŠ è§£å¯†åŠŸèƒ½</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä¸‰ã€shiroå…¥é—¨"><a href="#ä¸‰ã€shiroå…¥é—¨" class="headerlink" title="ä¸‰ã€shiroå…¥é—¨"></a>ä¸‰ã€shiroå…¥é—¨</h2><h3 id="1ã€èº«ä»½è®¤è¯"><a href="#1ã€èº«ä»½è®¤è¯" class="headerlink" title="1ã€èº«ä»½è®¤è¯"></a>1ã€èº«ä»½è®¤è¯</h3><h4 id="1ã€åŸºæœ¬æµç¨‹"><a href="#1ã€åŸºæœ¬æµç¨‹" class="headerlink" title="1ã€åŸºæœ¬æµç¨‹"></a>1ã€åŸºæœ¬æµç¨‹</h4><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662303041272.png" alt="1662303041272" loading="lazy"></p>
<p><strong>æµç¨‹ï¼š</strong></p>
<ol>
<li>ShiroæŠŠç”¨æˆ·çš„æ•°æ®å°è£…æˆæ ‡è¯†tokenï¼Œtokenä¸€èˆ¬å°è£…ç€ç”¨æˆ·åï¼Œå¯†ç ç­‰ä¿¡æ¯</li>
<li>ä½¿ç”¨subjectè·å–åˆ°å°è£…ç€ç”¨æˆ·çš„token</li>
<li>subjectå°†tokenäº¤ç»™SecurityManagerï¼Œåœ¨SecurityManagerå®‰å…¨ä¸­å¿ƒï¼ŒSecurityManageræŠŠæ ‡è¯†tokenå§”æ‰˜ç»™è®¤è¯å™¨Authenticatorè¿›è¡Œèº«ä»½éªŒè¯ã€‚è®¤è¯å™¨çš„ä½œç”¨ä¸€èˆ¬æ˜¯ç”¨æ¥æŒ‡å®šå¦‚ä½•éªŒè¯ï¼Œå®ƒè§„å®šæœ¬æ¬¡è®¤è¯ç”¨åˆ°å“ªäº›Realm</li>
<li>è®¤è¯å™¨Authenticatorå°†ä¼ å…¥çš„æ ‡è¯†tokenï¼Œä¸æ•°æ®Realmå¯¹åˆ«ï¼ŒéªŒè¯tokenæ˜¯å¦åˆæ³•</li>
</ol>
<h4 id="2ã€æ¡ˆä¾‹æ¼”ç¤º"><a href="#2ã€æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="2ã€æ¡ˆä¾‹æ¼”ç¤º"></a>2ã€æ¡ˆä¾‹æ¼”ç¤º</h4><p><code>å®ç°ä¸€ä¸ªshiroå®Œæˆç”¨æˆ·ç™»å½•</code></p>
<h5 id="2-1åˆ›å»ºé¡¹ç›®"><a href="#2-1åˆ›å»ºé¡¹ç›®" class="headerlink" title="2.1åˆ›å»ºé¡¹ç›®"></a>2.1åˆ›å»ºé¡¹ç›®</h5><h5 id="2-2å¯¼å…¥ä¾èµ–"><a href="#2-2å¯¼å…¥ä¾èµ–" class="headerlink" title="2.2å¯¼å…¥ä¾èµ–"></a>2.2å¯¼å…¥ä¾èµ–</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;dependency&gt;</span></span><br><span class="line">  <span class="attr">&lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span></span><br><span class="line">  <span class="attr">&lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</span></span><br><span class="line">  <span class="attr">&lt;version&gt;1.5.3&lt;/version&gt;</span></span><br><span class="line"><span class="attr">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-3ç¼–å†™shiro-ini"><a href="#2-3ç¼–å†™shiro-ini" class="headerlink" title="2.3ç¼–å†™shiro.ini"></a>2.3ç¼–å†™shiro.ini</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#å£°æ˜ç”¨æˆ·è´¦å·</span><br><span class="line">[users]</span><br><span class="line">wyx=123</span><br></pre></td></tr></table></figure>

<h5 id="2-4ç¼–å†™ä»£ç "><a href="#2-4ç¼–å†™ä»£ç " class="headerlink" title="2.4ç¼–å†™ä»£ç "></a>2.4ç¼–å†™ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shiroLogin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">        <span class="type">DefaultSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultSecurityManager</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨çš„realm</span></span><br><span class="line">        securityManager.setRealm(<span class="keyword">new</span> <span class="title class_">IniRealm</span>(<span class="string">&quot;classpath:shiro.ini&quot;</span>));</span><br><span class="line">        <span class="comment">//é€šè¿‡å·¥å…·ç±»ç”Ÿæ•ˆåˆ›å»ºçš„å®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">        SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//é€šè¿‡å·¥å…·ç±»è·å–subjectä¸»ä½“</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="comment">//æ„å»ºä»¤ç‰Œ</span></span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(<span class="string">&quot;wyx&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¤è¯çŠ¶æ€: &quot;</span>+ subject.isAuthenticated());</span><br><span class="line">            <span class="comment">//ç”¨æˆ·è®¤è¯</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¤è¯çŠ¶æ€: &quot;</span>+ subject.isAuthenticated());</span><br><span class="line">        &#125;<span class="keyword">catch</span> (UnknownAccountException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¤è¯å¤±è´¥: ç”¨æˆ·åä¸å­˜åœ¨~&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IncorrectCredentialsException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¤è¯å¤±è´¥: å¯†ç é”™è¯¯~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»“æœ</strong></p>
<p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662308983705.png" alt="1662308983705" loading="lazy"></p>
<h3 id="2ã€Realm"><a href="#2ã€Realm" class="headerlink" title="2ã€Realm"></a>2ã€Realm</h3><blockquote>
<p>ä¸Šé¢æµ‹è¯•ä½¿ç”¨çš„æ˜¯iniRealmï¼Œä»inié…ç½®ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéœ€è¦ä»æ•°æ®åº“ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šRealm</p>
</blockquote>
<h4 id="1ã€Realmæ¥å£"><a href="#1ã€Realmæ¥å£" class="headerlink" title="1ã€Realmæ¥å£"></a>1ã€Realmæ¥å£</h4><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662309048850.png" alt="1662309048850" loading="lazy"></p>
<p><code>ä¸€èˆ¬åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œä¸ä¼šç›´æ¥åŒºå®ç°Realmæ¥å£ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿AuthorizingRealmï¼Œèƒ½å¤Ÿç»§æ‰¿åˆ°è®¤è¯ä¸æˆæƒåŠŸèƒ½ã€‚éœ€è¦é‡å†™ä¸¤ä¸ªæ–¹æ³•</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefinitionRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> é‰´æƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2ã€è‡ªå®šä¹‰Realm"><a href="#2ã€è‡ªå®šä¹‰Realm" class="headerlink" title="2ã€è‡ªå®šä¹‰Realm"></a>2ã€è‡ªå®šä¹‰Realm</h4><p><code>å®šä¹‰SecurityService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿæ•°æ®åº“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SecurityService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ç”¨æˆ·åè·å–å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">findPwdByName</span><span class="params">(String loginName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>å®šä¹‰DefinitionRealm</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefinitionRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=============&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> (String) authenticationToken.getPrincipal();</span><br><span class="line">        <span class="type">SecurityService</span> <span class="variable">securityService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityServiceImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> securityService.findPwdByName(loginName);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;123&quot;</span>.equals(pwd))&#123;</span><br><span class="line">            <span class="comment">//å‚æ•°1:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®çš„ç”¨æˆ·å   //å‚æ•°2:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®å¯†ç   //å‚æ•°3:æä¾›å½“å‰realmçš„åå­— this.getName();</span></span><br><span class="line">            <span class="type">SimpleAuthenticationInfo</span> <span class="variable">simpleAuthenticationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(loginName,<span class="string">&quot;123&quot;</span>,<span class="built_in">this</span>.getName());</span><br><span class="line">            <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefinitionRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SecurityService securityService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> (String) authenticationToken.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> securityService.findPwdByName(loginName);</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;&quot;</span>.equals(pwd)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnknownAccountException</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(loginName,pwd,getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>æµ‹è¯•</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloShiro</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">        <span class="type">DefaultSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultSecurityManager</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨çš„realm</span></span><br><span class="line">        securityManager.setRealm(<span class="keyword">new</span> <span class="title class_">DefinitionRealm</span>());</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨ç”Ÿæ•ˆ</span></span><br><span class="line">        SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//è·å–subject</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(<span class="string">&quot;wyx&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        subject.login(token);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.login(token);</span><br><span class="line">            System.out.println(subject.isAuthenticated());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·åé”™è¯¯&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3ã€åŠ å¯†"><a href="#3ã€åŠ å¯†" class="headerlink" title="3ã€åŠ å¯†"></a>3ã€åŠ å¯†</h4><blockquote>
<p>å®é™…åº”ç”¨æ˜¯å°†ç›å’Œæ•£åˆ—åçš„å€¼å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè‡ªåŠ¨realmä»æ•°æ®åº“å–<br>å‡ºç›å’ŒåŠ å¯†åçš„å€¼ç”±shiroå®Œæˆå¯†ç æ ¡éªŒã€‚</p>
</blockquote>
<p>æµç¨‹ï¼šè®¤è¯å™¨é€šè¿‡tokenä¸­çš„å¯†ç é…åˆåŠ å¯†è§„åˆ™ç”Ÿæˆå¯†æ–‡ä¸æ•°æ®åº“å­˜å‚¨çš„å¯†æ–‡æ¯”å¯¹</p>
<p><strong>æ•°æ®åº“æ“ä½œ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SecurityService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ•°æ®åº“è·å–å¯†ç çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findPwdByName</span><span class="params">(String loginName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="comment">//        Md5Hash md5Hash = new Md5Hash(pwd,loginName,1024);</span></span><br><span class="line">        <span class="type">SimpleHash</span> <span class="variable">hash</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(<span class="string">&quot;md5&quot;</span>, pwd, loginName, <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">return</span> hash.toHex();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰Realm</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefinitionRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¯†ç åŒ¹é…å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefinitionRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HashedCredentialsMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯†ç åŒ¹é…æ–¹å¼</span></span><br><span class="line">        matcher.setHashAlgorithmName(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯†ç æ•£åˆ—æ¬¡æ•°</span></span><br><span class="line">        matcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//åœ¨å½“å‰realmå®ä¾‹ä¸­è®¾ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">        <span class="built_in">this</span>.setCredentialsMatcher(matcher);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> (String) authenticationToken.getPrincipal();</span><br><span class="line">        <span class="type">SecurityService</span> <span class="variable">securityService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityServiceImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> securityService.findPwdByName(loginName);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">&quot;&quot;</span>.equals(loginName))&#123;</span><br><span class="line">            System.out.println(pwd);</span><br><span class="line">            <span class="comment">//å‚æ•°1:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®çš„ç”¨æˆ·å   //å‚æ•°2:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®å¯†ç (åŠ å¯†åçš„) //å‚æ•°3ï¼šç›  //å‚æ•°4:æä¾›å½“å‰realmçš„åå­— this.getName();</span></span><br><span class="line">            <span class="type">SimpleAuthenticationInfo</span> <span class="variable">simpleAuthenticationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(loginName,pwd,ByteSource.Util.bytes(loginName),<span class="built_in">this</span>.getName());</span><br><span class="line">            <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloShiro</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">        <span class="type">DefaultSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultSecurityManager</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨çš„realm</span></span><br><span class="line">        <span class="type">DefinitionRealm</span> <span class="variable">realm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefinitionRealm</span>();</span><br><span class="line"></span><br><span class="line">        securityManager.setRealm(realm);</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨ç”Ÿæ•ˆ</span></span><br><span class="line">        SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//è·å–subject</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(<span class="string">&quot;wyx&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.login(token);</span><br><span class="line">            System.out.println(subject.isAuthenticated());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·åé”™è¯¯&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3ã€èº«ä»½æˆæƒ"><a href="#3ã€èº«ä»½æˆæƒ" class="headerlink" title="3ã€èº«ä»½æˆæƒ"></a>3ã€èº«ä»½æˆæƒ</h3><p>shiroæä¾›äº†base64å’Œ16è¿›åˆ¶çš„å­—ç¬¦ä¸²ç¼–ç ã€è§£ç çš„apiæ”¯æŒï¼Œæ–¹ä¾¿ä¸€äº›ç¼–ç è§£ç æ“ä½œ</p>
<p>shiroå†…éƒ¨çš„ä¸€äº›æ•°æ®ã€å­˜å‚¨/è¡¨ç¤ºã€‘éƒ½æ˜¯ç”¨äº†base16å’Œ16è¿›åˆ¶å­—ç¬¦ä¸²</p>
<h4 id="1ã€åŸºæœ¬æµç¨‹-1"><a href="#1ã€åŸºæœ¬æµç¨‹-1" class="headerlink" title="1ã€åŸºæœ¬æµç¨‹"></a>1ã€åŸºæœ¬æµç¨‹</h4><p><img src="/2022/09/04/shiro/study\blog\blog\source_posts\shiro\1662432172952.png" alt="1662432172952" loading="lazy"></p>
<ol>
<li>é¦–å…ˆè°ƒç”¨subject.isPermitted/hashRoleæ¥å£ï¼Œä¼šå§”æ‰˜ç»™SecurityManager</li>
<li>SecurityManageræ¥ç€ä¼šå§”æ‰˜ç»™å†…éƒ¨ç»„ä»¶Authorizer</li>
<li>authorizeråœ¨å°†è¯·æ±‚å§”æ‰˜ç»™è®¾ç½®çš„realmå»åšï¼Œrealmæ˜¯çœŸæ­£çš„æ ¸å¿ƒ</li>
<li>Realmå°†ç”¨æˆ·ä¼ å…¥çš„è¯·æ±‚å‚æ•°å°è£…æˆæƒé™å¯¹è±¡ï¼Œåœ¨ä»æ•°æ®åº“è·å–æŸ¥è¯¢åˆ°çš„æƒé™é›†åˆ</li>
<li>Realmå°†ç”¨æˆ·ä¼ å…¥çš„æƒé™å¯¹è±¡ï¼Œä¸ä»æ•°æ®åº“ä¸­æŸ¥å‡ºæ¥çš„æƒé™å¯¹è±¡ï¼Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœç”¨æˆ·ä¼ å…¥çš„æƒé™å¯¹è±¡åœ¨é‡æ•°æ®åº“æŸ¥å‡ºæ¥çš„é›†åˆä¸­ï¼Œè¿”å›trueã€‚</li>
</ol>
<p><strong>è¿›è¡Œæƒé™æ“ä½œçš„å‰æï¼šèº«ä»½è®¤è¯æˆåŠŸ</strong></p>
<h4 id="2ã€æˆæƒæ–¹å¼"><a href="#2ã€æˆæƒæ–¹å¼" class="headerlink" title="2ã€æˆæƒæ–¹å¼"></a>2ã€æˆæƒæ–¹å¼</h4><p>ï¼ˆ1ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(subject.hashRole(<span class="string">&quot;admin&quot;</span>)) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åŸºäºèµ„æºè®¿çš„è®¿é—®æ§åˆ¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èµ„æºæ ‡è¯†ç¬¦ï¼šæ“ä½œï¼šèµ„æºå®ä¾‹æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">if</span>(subject.isPermission(<span class="string">&quot;user:update:01&quot;</span>)) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>æƒé™å­—ç¬¦ä¸²</code>ï¼šè§„åˆ™ï¼šèµ„æºæ ‡è¯†ç¬¦ï¼šæ“ä½œï¼šèµ„æºå®ä¾‹æ ‡è¯†ç¬¦</p>
<p><strong>ç¼–ç¨‹å®ç°æ–¹å¼</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼–ç¨‹å¼</span></span><br><span class="line"><span class="type">Subject</span> <span class="variable">s</span> <span class="operator">=</span> SecurityUtil.getSubject();</span><br><span class="line"><span class="keyword">if</span>(s.hashRole(<span class="string">&quot;admin&quot;</span>)) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ³¨è§£å¼</span></span><br><span class="line"><span class="meta">@RequiresRoles(&quot;admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//æœ‰æƒé™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ç¼–ç å®ç°</code></p>
<p><strong>æ“ä½œæ•°æ®åº“</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SecurityService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ•°æ®åº“è·å–å¯†ç çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findPwdByName</span><span class="params">(String loginName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="comment">//        Md5Hash md5Hash = new Md5Hash(pwd,loginName,1024);</span></span><br><span class="line">        <span class="type">SimpleHash</span> <span class="variable">hash</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(<span class="string">&quot;md5&quot;</span>, pwd, loginName, <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">return</span> hash.toHex();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾è§’è‰²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findRoleByLoginName</span><span class="params">(String loginName)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾å¯¹åº”èµ„æº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findPermissionByLogName</span><span class="params">(String loginName)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;order:add&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;order:list&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;order:del&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰Realm</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefinitionRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¯†ç åŒ¹é…å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefinitionRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HashedCredentialsMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯†ç åŒ¹é…æ–¹å¼</span></span><br><span class="line">        matcher.setHashAlgorithmName(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯†ç æ•£åˆ—æ¬¡æ•°</span></span><br><span class="line">        matcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//åœ¨å½“å‰realmå®ä¾‹ä¸­è®¾ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">        <span class="built_in">this</span>.setCredentialsMatcher(matcher);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">primaryPrincipal</span> <span class="operator">=</span> (String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        System.out.println(<span class="string">&quot;èº«ä»½ä¿¡æ¯ï¼š&quot;</span>+primaryPrincipal);</span><br><span class="line">        <span class="type">SecurityServiceImpl</span> <span class="variable">securityService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityServiceImpl</span>();</span><br><span class="line">        <span class="comment">//ä»æ•°æ®åº“æŸ¥çœ‹èµ„æºå’Œè§’è‰²</span></span><br><span class="line">        List&lt;String&gt; roles = securityService.findRoleByLoginName(primaryPrincipal);</span><br><span class="line">        List&lt;String&gt; permissions = securityService.findPermissionByLogName(primaryPrincipal);</span><br><span class="line">        <span class="comment">//æ„å»ºèµ„æºæ ¡éªŒ</span></span><br><span class="line">        <span class="type">SimpleAuthorizationInfo</span> <span class="variable">simpleAuthorizationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>();</span><br><span class="line">        simpleAuthorizationInfo.addRoles(roles);</span><br><span class="line">        simpleAuthorizationInfo.addStringPermissions(permissions);</span><br><span class="line">        <span class="keyword">return</span> simpleAuthorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> (String) authenticationToken.getPrincipal();</span><br><span class="line">        <span class="type">SecurityService</span> <span class="variable">securityService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityServiceImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> securityService.findPwdByName(loginName);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">&quot;&quot;</span>.equals(loginName))&#123;</span><br><span class="line">            System.out.println(pwd);</span><br><span class="line">            <span class="comment">//å‚æ•°1:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®çš„ç”¨æˆ·å   //å‚æ•°2:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®å¯†ç (åŠ å¯†åçš„) //å‚æ•°3ï¼šç›  //å‚æ•°4:æä¾›å½“å‰realmçš„åå­— this.getName();</span></span><br><span class="line">            <span class="type">SimpleAuthenticationInfo</span> <span class="variable">simpleAuthenticationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(loginName,pwd,ByteSource.Util.bytes(loginName),<span class="built_in">this</span>.getName());</span><br><span class="line">            <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloShiro</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testPermissionRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPermissionRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> login(<span class="string">&quot;wyx&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦ç™»å½•æˆåŠŸï¼š&quot;</span>+subject.isAuthenticated());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æœ‰ç®¡ç†å‘˜è§’è‰²ï¼š&quot;</span>+subject.hasRole(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.checkRole(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æœ‰userè§’è‰²&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ²¡æœ‰userè§’è‰²&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·æ˜¯å¦æœ‰æŸ¥çœ‹è®¢å•èµ„æºçš„æƒé™:&quot;</span>+subject.isPermitted(<span class="string">&quot;order:list&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.checkPermissions(<span class="string">&quot;order:add&quot;</span>,<span class="string">&quot;order:del&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æœ‰æ·»åŠ å’Œåˆ é™¤è®¢å•èµ„æºçš„æƒé™&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthorizationException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ²¡æœ‰æ·»åŠ å’Œåˆ é™¤è®¢å•èµ„æºçš„æƒé™&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Subject <span class="title function_">login</span><span class="params">(String username,String password)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">        <span class="type">DefaultSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultSecurityManager</span>();</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨çš„realm</span></span><br><span class="line">        <span class="type">DefinitionRealm</span> <span class="variable">realm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefinitionRealm</span>();</span><br><span class="line"></span><br><span class="line">        securityManager.setRealm(realm);</span><br><span class="line">        <span class="comment">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨ç”Ÿæ•ˆ</span></span><br><span class="line">        SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//è·å–subject</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(username, password);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.login(token);</span><br><span class="line">            System.out.println(subject.isAuthenticated());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·åé”™è¯¯&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.jpg"><img loading="lazy" src="/images/alipay.jpg" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wechatpay.png"><img loading="lazy" src="/images/wechatpay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ç¿”ä»”</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://example.com/2022/09/04/shiro/" title="shiro">http://example.com/2022/09/04/shiro/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2022/09/07/Spring/" rel="prev" title="Spring"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Spring</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/08/21/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/" rel="next" title="SpringBootè‡ªåŠ¨è£…é…"><span class="post-nav-text">SpringBootè‡ªåŠ¨è£…é…</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2022 </span><span class="with-love" id="animate" title="äº‘æ¸¸å›çš„èµåŠ©è€…ä»¬"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ç¿”ä»”</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.2</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.8.11</span></div><div class="live-time"><span>æœ¬åšå®¢å·²è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2022-04-10T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>