<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ç¿”ä»”"><meta name="copyright" content="ç¿”ä»”"><meta name="generator" content="Hexo 5.4.2"><meta name="theme" content="hexo-theme-yun"><title>JVM | ç¿”ä»”çš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"ç¿”ä»”çš„å°ç«™","version":"1.8.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„1ï¼Œå‰è¨€ä½œä¸ºJavaå·¥ç¨‹å¸ˆçš„ä½ æ›¾è¢«ä¼¤å®³è¿‡å—ï¼Ÿä½ æ˜¯å¦ä¹Ÿé‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Ÿ  è¿è¡Œç€çš„çº¿ä¸Šç³»ç»Ÿçªç„¶å¡æ­»ï¼Œç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œç”šè‡³ç›´æ¥OOM  æƒ³è§£å†³çº¿ä¸ŠJVM GCé—®é¢˜ï¼Œä½†å´æ— ä»ä¸‹æ‰‹  æ–°é¡¹ç›®ä¸Šçº¿ï¼Œå¯¹å„ç§JVMå‚æ•°è®¾ç½®ä¸€è„¸èŒ«ç„¶ï¼Œç›´æ¥é»˜è®¤å§ç„¶åå°±JJäº†  æ¯æ¬¡é¢è¯•ä¹‹å‰éƒ½è¦é‡æ–°èƒŒä¸€éJVMçš„ä¸€äº›åŸç†æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œç„¶è€Œé¢è¯•å®˜å´ç»å¸¸é—®ä½ åœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•è°ƒä¼˜VMå‚æ•°ï¼Œå¦‚">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM">
<meta property="og:url" content="http://example.com/2022/04/18/JVM/index.html">
<meta property="og:site_name" content="ç¿”ä»”çš„åšå®¢">
<meta property="og:description" content="JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„1ï¼Œå‰è¨€ä½œä¸ºJavaå·¥ç¨‹å¸ˆçš„ä½ æ›¾è¢«ä¼¤å®³è¿‡å—ï¼Ÿä½ æ˜¯å¦ä¹Ÿé‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Ÿ  è¿è¡Œç€çš„çº¿ä¸Šç³»ç»Ÿçªç„¶å¡æ­»ï¼Œç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œç”šè‡³ç›´æ¥OOM  æƒ³è§£å†³çº¿ä¸ŠJVM GCé—®é¢˜ï¼Œä½†å´æ— ä»ä¸‹æ‰‹  æ–°é¡¹ç›®ä¸Šçº¿ï¼Œå¯¹å„ç§JVMå‚æ•°è®¾ç½®ä¸€è„¸èŒ«ç„¶ï¼Œç›´æ¥é»˜è®¤å§ç„¶åå°±JJäº†  æ¯æ¬¡é¢è¯•ä¹‹å‰éƒ½è¦é‡æ–°èƒŒä¸€éJVMçš„ä¸€äº›åŸç†æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œç„¶è€Œé¢è¯•å®˜å´ç»å¸¸é—®ä½ åœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•è°ƒä¼˜VMå‚æ•°ï¼Œå¦‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220126175404886.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220126175758829.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220126175910101.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127100548653.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127101027131.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127101050057.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127103725657.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127105615233.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127105657968.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127110357430.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127110457051.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220127163853401.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130092631309.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130092645074.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130093257767.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130094714257.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130095235833.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130100539779.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130162152331.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130171229529.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130171251333.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130213724290.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220130213807607.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201195559400.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201195709773.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201200201823.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201200252799.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201200533082.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201201036022.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201210314375.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201210345997.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201210529604.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220201210828684.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204151934771.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204152951666.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204163407269.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204163611141.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204163640763.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204172832778.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220204173333709.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210174118277.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210180325399.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210180347832.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210180932868.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210180954394.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210181114790.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210181133707.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210181245545.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220210181338525.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212161354202.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212161555599.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212153722403.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212171409817.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212171430262.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220212174346118.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213161258695.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213162144270.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213171939622.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213172136795.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213172303028.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213172344082.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213172820874.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213172840518.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213173044012.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213173519053.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213173643549.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213174051585.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213174355950.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213174423912.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213174738090.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220213174824666.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216161544710.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216162126770.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216162317597.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216162437723.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216162615326.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216163305809.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216163359461.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216163444608.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216164422722.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216164703741.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216165227944.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216165501664.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216170021555.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216170139807.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216170903651.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216170944359.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171016642.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171056031.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171108517.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171129443.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171146350.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171156533.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171223328.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171302523.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171330285.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171354428.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171413472.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171430158.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171444357.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171512383.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171630156.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171715566.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171734535.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171747085.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216171821904.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216172305117.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216172346952.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220216172843525.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226155623663.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226161701981.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226164508878.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226164929452.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226164959223.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226170028641.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226170051298.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226170122435.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226170216430.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226175754421.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226175831564.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226180024852.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226221916202.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226222144879.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226222401034.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226222832734.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226223702803.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226223708998.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226223751470.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226223929703.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226224926291.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226225040562.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226225256399.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226230240034.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226231505643.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226232315860.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220226232538297.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227110715676.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227110726282.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227112610240.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227173925125.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227174625236.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227174829865.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227175004981.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227175041494.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227180351245.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227180404664.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227180430783.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227220434449.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227221547755.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227222506390.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227224405811.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227224816404.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227225328342.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227225640216.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227233127065.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227233826020.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227233856253.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220227234910721.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228162822227.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228163241674.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228164104180.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228164220211.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228171749275.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228213106235.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228215125493.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228215600498.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228215815821.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228215856361.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228222137617.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220228222738557.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301165120165.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301165231582.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301165434632.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301165517402.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301170130168.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301170148723.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301170214941.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301170333707.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301172000362.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301172302536.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301173249130.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301173325731.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301173744780.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301174614376.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301175708359.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301175738102.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301181009227.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301181156136.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301181228985.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301182341838.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301182500380.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301183839838.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301184528969.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301184646575.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301191450969.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301191516341.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301192456647.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301192505603.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301194830071.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301194925202.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200112971.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200417114.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200554429.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200609378.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200709311.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220301200822654.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302163951552.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164026485.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164500434.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164601099.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164622006.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164709921.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164805126.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164854504.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302164920967.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302165336859.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302165144646.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302221033300.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302222857815.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302223218131.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302223555141.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302223614982.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302225733705.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302225749163.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302225911488.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302230227770.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302230306358.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302230402547.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220302231430870.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180218379.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180233047.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180250150.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180326273.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180740047.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303180839141.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181140311.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181259139.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181358101.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181438036.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181631528.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303181721600.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303214639412.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303214752109.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303214852394.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303214930951.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303215033196.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303220126447.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303220445502.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303220636921.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303220842449.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221252892.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221342168.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221422860.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221524796.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221605722.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303221736001.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303222824437.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303222915971.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303222940232.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303222956252.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303223028670.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303230226588.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303234527734.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303234605681.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303234639240.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303234736375.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220303234856790.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304000530101.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304000553819.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304000629451.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164452098.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164505559.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164618072.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164635558.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164716007.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164755507.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164811000.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220304164839304.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305155427446.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305155456880.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305155838124.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305160958219.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305161106655.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305163900589.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305163921502.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305163953764.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305164053384.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305165344870.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305165408798.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305171456453.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220305220610873.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306180351305.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306184115840.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306190055540.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306190156726.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306190234681.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306190300948.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/19dd9595afeb6543593ef14161fc1bb8.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306204441546.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306213800101.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306213917640.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306215023595.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306215035243.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306221419020.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306222130901.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306223124134.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306223330913.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306223352568.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306223509597.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306225506006.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306225650298.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220306230336464.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220309174131120.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310152722836.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310152734479.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154212495.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154233987.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154300163.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154313555.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154455916.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154832855.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310154847531.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310161532424.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310161906341.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310161604595.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162056547.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162129023.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162239498.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162255366.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162354591.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162313378.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/image-20220310162327955.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/QQ%E6%88%AA%E5%9B%BE20220310162733.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647071253080.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647072036736.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647095960051.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647096897591.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647097094692.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647098707541.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647163199435.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/QQ%E6%88%AA%E5%9B%BE20220313172057.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647166459779.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647166518246.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647166583084.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647166617778.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506127278.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506185868.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506359883.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506408862.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506488619.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506515702.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506905752.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647506927155.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507011648.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507172690.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507204683.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507361880.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507471781.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507594805.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507612016.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507959227.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647507984156.png">
<meta property="og:image" content="http://example.com/2022/04/18/JVM/1647508012108.png">
<meta property="article:published_time" content="2022-04-18T09:24:33.000Z">
<meta property="article:modified_time" content="2022-04-18T09:25:48.294Z">
<meta property="article:author" content="ç¿”ä»”">
<meta property="article:tag" content="Jvm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/04/18/JVM/image-20220126175404886.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ç¿”ä»”"><img width="96" loading="lazy" src="/images/tx.jpg" alt="ç¿”ä»”"><span class="site-author-status" title="ä¸æƒ³ä¸Šå­¦">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">ç¿”ä»”</a></div><span class="site-name">ç¿”ä»”çš„åšå®¢</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="æˆ‘çš„ä¸»é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">15</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=910426929&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="985391895@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM%E5%86%85%E5%AD%98%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8CJVM%E4%B8%8EJava%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.1.</span> <span class="toc-text">1ï¼Œå‰è¨€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CJava%E5%8F%8AJVM%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">2ï¼ŒJavaåŠJVMç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C-Java%E5%8F%91%E5%B1%95%E7%9A%84%E9%87%8D%E5%A4%A7%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.1.3.</span> <span class="toc-text">3ï¼Œ Javaå‘å±•çš„é‡å¤§äº‹ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8EJava%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.1.4.</span> <span class="toc-text">4ï¼Œè™šæ‹Ÿæœºä¸Javaè™šæ‹Ÿæœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8CJVM%E7%9A%84%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.5.</span> <span class="toc-text">5ï¼ŒJVMçš„æ•´ä½“ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C-Java%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.6.</span> <span class="toc-text">6ï¼Œ Javaä»£ç æ‰§è¡Œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8CJVM%E7%9A%84%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.7.</span> <span class="toc-text">7ï¼ŒJVMçš„æ¶æ„æ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8CJVM%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.1.8.</span> <span class="toc-text">8ï¼ŒJVMçš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C-JVM%E7%9A%84%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-number">1.1.9.</span> <span class="toc-text">9ï¼Œ JVMçš„å‘å±•å†ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sun-Classic-VM"><span class="toc-number">1.1.9.1.</span> <span class="toc-text">Sun Classic VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exact-VM"><span class="toc-number">1.1.9.2.</span> <span class="toc-text">Exact VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HotSpot-VM"><span class="toc-number">1.1.9.3.</span> <span class="toc-text">HotSpot VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JRockit"><span class="toc-number">1.1.9.4.</span> <span class="toc-text">JRockit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IBM%E7%9A%84J9"><span class="toc-number">1.1.9.5.</span> <span class="toc-text">IBMçš„J9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVM%E5%92%8CCDC-CLDC-Hotspot"><span class="toc-number">1.1.9.6.</span> <span class="toc-text">KVMå’ŒCDC &#x2F; CLDC Hotspot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Azul-VM"><span class="toc-number">1.1.9.7.</span> <span class="toc-text">Azul VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Liquid-VM"><span class="toc-number">1.1.9.8.</span> <span class="toc-text">Liquid VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache-Harmony"><span class="toc-number">1.1.9.9.</span> <span class="toc-text">Apache Harmony</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Micorsoft-JVM"><span class="toc-number">1.1.9.10.</span> <span class="toc-text">Micorsoft JVM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Taobao-JVM"><span class="toc-number">1.1.9.11.</span> <span class="toc-text">Taobao JVM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dalvik-VM"><span class="toc-number">1.1.9.12.</span> <span class="toc-text">Dalvik VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Graal-VM"><span class="toc-number">1.1.9.13.</span> <span class="toc-text">Graal VM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.9.14.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.</span> <span class="toc-text">äºŒï¼Œç±»åŠ è½½å­ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1ï¼Œå†…å­˜ç»“æ„æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E4%B8%8E%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2ï¼Œç±»åŠ è½½å™¨ä¸ç±»çš„åŠ è½½è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">åŠ è½½é˜¶æ®µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">é“¾æ¥é˜¶æ®µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">åˆå§‹åŒ–é˜¶æ®µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.3.</span> <span class="toc-text">3ï¼Œç±»åŠ è½½å™¨åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%87%AA%E5%B8%A6%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">3.1ï¼Œè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">3.2ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8CClassLoader%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.4.</span> <span class="toc-text">4ï¼ŒClassLoaderçš„ä½¿ç”¨è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.5.</span> <span class="toc-text">5ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E5%85%B6%E4%BB%96"><span class="toc-number">1.2.6.</span> <span class="toc-text">6ï¼Œå…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%8F%8A%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">ä¸‰ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA"><span class="toc-number">1.3.1.</span> <span class="toc-text">1ï¼Œè¿è¡Œæ—¶æ•°æ®åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.1ï¼Œæ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">1.2ï¼Œçº¿ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8CJVM%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">1.3ï¼ŒJVMç³»ç»Ÿçº¿ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8-PC%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">2ï¼Œç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88"><span class="toc-number">1.4.</span> <span class="toc-text">å››ï¼Œè™šæ‹Ÿæœºæ ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E6%A6%82%E8%BF%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text">1ï¼Œ è™šæ‹Ÿæœºæ ˆæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%87%BA%E7%8E%B0%E7%9A%84%E8%83%8C%E6%99%AF"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1.1ï¼Œè™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E5%88%9D%E6%AD%A5%E5%8D%B0%E8%B1%A1"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">1.2ï¼Œåˆæ­¥å°è±¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C-%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E6%A0%88%E4%B8%8E%E5%A0%86"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">1.3ï¼Œ å†…å­˜ä¸­çš„æ ˆä¸å †</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">1.4ï¼Œè™šæ‹Ÿæœºæ ˆçš„åŸºæœ¬å†…å®¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E6%A0%88%E7%9A%84%E5%AD%98%E5%82%A8%E5%8D%95%E4%BD%8D"><span class="toc-number">1.4.2.</span> <span class="toc-text">2ï¼Œæ ˆçš„å­˜å‚¨å•ä½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E6%A0%88%E4%B8%AD%E5%AD%98%E5%82%A8%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">2.1ï¼Œæ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E6%A0%88%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.3ï¼Œæ ˆè¿è¡ŒåŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8C-%E6%A0%88%E5%B8%A7%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">2.4ï¼Œ æ ˆå¸§çš„å†…éƒ¨ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8-Local-Variables"><span class="toc-number">1.4.3.</span> <span class="toc-text">3ï¼Œå±€éƒ¨å˜é‡è¡¨(Local Variables)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E5%85%B3%E4%BA%8ESlot%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">3.1ï¼Œå…³äºSlotçš„ç†è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8CSlot%E7%9A%84%E9%87%8D%E5%A4%8D%E5%88%A9%E7%94%A8"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">3.2ï¼ŒSlotçš„é‡å¤åˆ©ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%EF%BC%8C%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">3.3ï¼Œé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%EF%BC%8C%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">3.4ï¼Œè¡¥å……è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%EF%BC%88Operand-Stack%EF%BC%89"><span class="toc-number">1.4.4.</span> <span class="toc-text">4ï¼Œæ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E4%BB%A3%E7%A0%81%E8%BF%BD%E8%B8%AA"><span class="toc-number">1.4.5.</span> <span class="toc-text">5ï¼Œä»£ç è¿½è¸ª</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E6%A0%88%E9%A1%B6%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%EF%BC%88Top-Of-Stack-Cashing%EF%BC%89%E6%8A%80%E6%9C%AF"><span class="toc-number">1.4.6.</span> <span class="toc-text">6ï¼Œæ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼ˆTop Of Stack Cashingï¼‰æŠ€æœ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%EF%BC%88Dynamic-Linking%EF%BC%89"><span class="toc-number">1.4.7.</span> <span class="toc-text">7ï¼ŒåŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%9A%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%88%86%E9%85%8D"><span class="toc-number">1.4.8.</span> <span class="toc-text">8ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè§£æä¸åˆ†é…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">8.1ï¼Œé™æ€é“¾æ¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">8.2ï¼ŒåŠ¨æ€é“¾æ¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3%EF%BC%8C%E6%97%A9%E6%9C%9F%E7%BB%91%E5%AE%9A"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">8.3ï¼Œæ—©æœŸç»‘å®š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4%EF%BC%8C%E6%99%9A%E6%9C%9F%E7%BB%91%E5%AE%9A"><span class="toc-number">1.4.8.4.</span> <span class="toc-text">8.4ï¼Œæ™šæœŸç»‘å®š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5%EF%BC%8C%E8%99%9A%E6%96%B9%E6%B3%95%E5%92%8C%E9%9D%9E%E8%99%9A%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.8.5.</span> <span class="toc-text">8.5ï¼Œè™šæ–¹æ³•å’Œéè™šæ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6%EF%BC%8C%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">1.4.8.6.</span> <span class="toc-text">8.6ï¼Œæ–¹æ³•é‡å†™çš„æœ¬è´¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7%EF%BC%8C%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%9A%E8%99%9A%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">1.4.8.7.</span> <span class="toc-text">8.7ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%EF%BC%88return-address%EF%BC%89"><span class="toc-number">1.4.9.</span> <span class="toc-text">9ï¼Œæ–¹æ³•è¿”å›åœ°å€ï¼ˆreturn addressï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E4%B8%80%E4%BA%9B%E9%99%84%E5%8A%A0%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.10.</span> <span class="toc-text">10ï¼Œä¸€äº›é™„åŠ ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%EF%BC%8C%E6%A0%88%E7%9A%84%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.4.11.</span> <span class="toc-text">11ï¼Œæ ˆçš„ç›¸å…³é¢è¯•é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88"><span class="toc-number">1.5.</span> <span class="toc-text">äº”ï¼Œæœ¬åœ°æ–¹æ³•æ¥å£å’Œæœ¬åœ°æ–¹æ³•æ ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">1.5.1.</span> <span class="toc-text">1ï¼Œä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Native-Method%EF%BC%9F"><span class="toc-number">1.5.2.</span> <span class="toc-text">2ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Native Methodï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88"><span class="toc-number">1.5.3.</span> <span class="toc-text">3ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%EF%BC%8C-%E5%A0%86"><span class="toc-number">1.6.</span> <span class="toc-text">å…­ï¼Œ å †</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%A0%86%EF%BC%88Heap%EF%BC%89%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E8%BF%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">1ï¼Œå †ï¼ˆHeapï¼‰çš„æ ¸å¿ƒæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%86%E5%88%86"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1.1ï¼Œå †å†…å­˜ç»†åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E5%A0%86%E7%A9%BA%E9%97%B4%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%EF%BC%88JDK7%EF%BC%89"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">1.2ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK7ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E5%A0%86%E7%A9%BA%E9%97%B4%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%EF%BC%88JDK8%EF%BC%89"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">1.3ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK8ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E8%AE%BE%E7%BD%AE%E5%A0%86%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E4%B8%8EOOM"><span class="toc-number">1.6.2.</span> <span class="toc-text">2ï¼Œè®¾ç½®å †å†…å­˜å¤§å°ä¸OOM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E5%A0%86%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">2.1ï¼Œå †ç©ºé—´å¤§å°çš„è®¾ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8COutOfMemory%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2.2ï¼ŒOutOfMemoryä¸¾ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E5%B9%B4%E8%BD%BB%E4%BB%A3%E4%B8%8E%E8%80%81%E5%B9%B4%E4%BB%A3"><span class="toc-number">1.6.3.</span> <span class="toc-text">3ï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E5%9B%BE%E8%A7%A3%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text">4ï¼Œå›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8CMinor-GC%EF%BC%8CMajorGC%E3%80%81Full-GC"><span class="toc-number">1.6.5.</span> <span class="toc-text">5ï¼ŒMinor GCï¼ŒMajorGCã€Full GC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8C%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%88%86%E4%BB%A3%E5%BC%8FGC%E7%AD%96%E7%95%A5%E7%9A%84%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">5.1ï¼Œæœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E5%A0%86%E7%A9%BA%E9%97%B4%E5%88%86%E4%BB%A3%E6%80%9D%E6%83%B3"><span class="toc-number">1.6.6.</span> <span class="toc-text">6ï¼Œå †ç©ºé—´åˆ†ä»£æ€æƒ³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.7.</span> <span class="toc-text">7ï¼Œå†…å­˜åˆ†é…ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E4%B8%BA%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98%EF%BC%9ATLAB"><span class="toc-number">1.6.8.</span> <span class="toc-text">8ï¼Œä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89TLAB%EF%BC%88Thread-Local-Allocation-Buffer%EF%BC%89%EF%BC%9F"><span class="toc-number">1.6.8.1.</span> <span class="toc-text">8.1ï¼Œä¸ºä»€ä¹ˆæœ‰TLABï¼ˆThread Local Allocation Bufferï¼‰ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFTLAB%EF%BC%9F"><span class="toc-number">1.6.8.2.</span> <span class="toc-text">8.2ï¼Œä»€ä¹ˆæ˜¯TLABï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3%EF%BC%8CTLAB%E7%9A%84%E5%86%8D%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.8.3.</span> <span class="toc-text">8.3ï¼ŒTLABçš„å†è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E5%B0%8F%E7%BB%93%EF%BC%9A%E5%A0%86%E7%A9%BA%E9%97%B4%E7%9A%84%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.6.9.</span> <span class="toc-text">9ï¼Œå°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E5%A0%86%E6%98%AF%E5%88%86%E9%85%8D%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%94%AF%E4%B8%80%E9%80%89%E6%8B%A9%E4%B9%88%EF%BC%9F"><span class="toc-number">1.6.10.</span> <span class="toc-text">10ï¼Œå †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1%EF%BC%8C%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%E6%A6%82%E8%BF%B0"><span class="toc-number">1.6.10.1.</span> <span class="toc-text">10.1ï¼Œé€ƒé€¸åˆ†ææ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2%EF%BC%8C%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%EF%BC%9A%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">1.6.10.2.</span> <span class="toc-text">10.2ï¼Œé€ƒé€¸åˆ†æï¼šä»£ç ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%88%E4%B8%8A%E5%88%86%E9%85%8D"><span class="toc-number">1.6.10.2.1.</span> <span class="toc-text">æ ˆä¸Šåˆ†é…</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E7%9C%81%E7%95%A5"><span class="toc-number">1.6.10.2.2.</span> <span class="toc-text">åŒæ­¥çœç•¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.6.10.2.3.</span> <span class="toc-text">æ ‡é‡æ›¿æ¢</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3%EF%BC%8C%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%E5%B0%8F%E7%BB%93%EF%BC%9A%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%E5%B9%B6%E4%B8%8D%E6%88%90%E7%86%9F"><span class="toc-number">1.6.10.3.</span> <span class="toc-text">10.3ï¼Œé€ƒé€¸åˆ†æå°ç»“ï¼šé€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%BB%93"><span class="toc-number">1.6.11.</span> <span class="toc-text">æœ¬ç« å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">1.7.</span> <span class="toc-text">ä¸ƒï¼Œæ–¹æ³•åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%A0%88%E3%80%81%E5%A0%86%E3%80%81%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB"><span class="toc-number">1.7.1.</span> <span class="toc-text">1ï¼Œæ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.7.2.</span> <span class="toc-text">2ï¼Œæ–¹æ³•åŒºçš„ç†è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">2.1ï¼Œæ–¹æ³•åŒºåœ¨å“ªé‡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%90%86%E8%A7%A3"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">2.2ï¼Œæ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8CHotSpot%E4%B8%AD%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E6%BC%94%E8%BF%9B"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">2.3ï¼ŒHotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95%E5%8C%BA%E5%A4%A7%E5%B0%8F%E4%B8%8EOOM"><span class="toc-number">1.7.3.</span> <span class="toc-text">3ï¼Œè®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95%E5%8C%BA%E5%86%85%E5%AD%98%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">3.1ï¼Œè®¾ç½®æ–¹æ³•åŒºå†…å­˜çš„å¤§å°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%BF%99%E4%BA%9BOOM"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">3.2ï¼Œå¦‚ä½•è§£å†³è¿™äº›OOM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.4.</span> <span class="toc-text">4ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%EF%BC%88Method-Area%EF%BC%89%E5%AD%98%E5%82%A8%E4%BB%80%E4%B9%88"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">4.1ï¼Œæ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">4.2ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.4.2.1.</span> <span class="toc-text">ç±»å‹ä¿¡æ¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%EF%BC%88Field%EF%BC%89%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.4.2.2.</span> <span class="toc-text">åŸŸï¼ˆFieldï¼‰ä¿¡æ¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%EF%BC%88Method%EF%BC%89%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.4.2.3.</span> <span class="toc-text">æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#non-final%E7%9A%84%E7%B1%BB%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.4.2.4.</span> <span class="toc-text">non-finalçš„ç±»å˜é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E%EF%BC%9A%E5%85%A8%E5%B1%80%E5%B8%B8%E9%87%8F%EF%BC%88static-final%EF%BC%89"><span class="toc-number">1.7.4.2.5.</span> <span class="toc-text">è¡¥å……è¯´æ˜ï¼šå…¨å±€å¸¸é‡ï¼ˆstatic finalï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%8C%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0-VS-%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">4.3ï¼Œè¿è¡Œæ—¶å¸¸é‡æ±  VS å¸¸é‡æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B8%B8%E9%87%8F%E6%B1%A0%EF%BC%9F"><span class="toc-number">1.7.4.3.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E4%B8%AD%E6%9C%89%E4%BB%80%E4%B9%88"><span class="toc-number">1.7.4.3.2.</span> <span class="toc-text">å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.7.4.3.3.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4%EF%BC%8C-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.7.4.4.</span> <span class="toc-text">4.4ï¼Œ è¿è¡Œæ—¶å¸¸é‡æ± </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.7.5.</span> <span class="toc-text">5ï¼Œæ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E6%BC%94%E8%BF%9B%E7%BB%86%E8%8A%82"><span class="toc-number">1.7.6.</span> <span class="toc-text">6ï¼Œæ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B0%B8%E4%B9%85%E4%BB%A3%E8%A6%81%E8%A2%AB%E5%85%83%E7%A9%BA%E9%97%B4%E6%9B%BF%E4%BB%A3%EF%BC%9F"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">6.1ï¼Œä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%8CStringTable%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%B0%83%E6%95%B4%E4%BD%8D%E7%BD%AE%EF%BC%9F"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">6.2ï¼ŒStringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%EF%BC%8C%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%AD%98%E6%94%BE%E5%9C%A8%E9%82%A3%E9%87%8C%EF%BC%9F"><span class="toc-number">1.7.6.3.</span> <span class="toc-text">6.3ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨é‚£é‡Œï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.7.7.</span> <span class="toc-text">7ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.8.</span> <span class="toc-text">8ï¼Œæ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.7.8.1.</span> <span class="toc-text">å¸¸è§é¢è¯•é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%EF%BC%8C%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%8F%8A%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98"><span class="toc-number">1.8.</span> <span class="toc-text">å…«ï¼Œå¯¹è±¡å®ä¾‹åŒ–åŠç›´æ¥å†…å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">1.8.1.</span> <span class="toc-text">1ï¼Œå¯¹è±¡å®ä¾‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">1.1ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">1.2ï¼Œåˆ›å»ºå¯¹è±¡çš„æ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E5%AF%B9%E5%BA%94%E7%9A%84%E7%B1%BB%E6%98%AF%E5%90%A6%E5%8A%A0%E8%BD%BD%E3%80%81%E9%93%BE%E6%8E%A5%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.8.1.2.1.</span> <span class="toc-text">1. åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%BA%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98"><span class="toc-number">1.8.1.2.2.</span> <span class="toc-text">2. ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%A4%84%E7%90%86%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.1.2.3.</span> <span class="toc-text">3. å¤„ç†å¹¶å‘é—®é¢˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%86%E9%85%8D%E5%88%B0%E7%9A%84%E5%86%85%E5%AD%98"><span class="toc-number">1.8.1.2.4.</span> <span class="toc-text">4. åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%A4%B4"><span class="toc-number">1.8.1.2.5.</span> <span class="toc-text">5. è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%89%A7%E8%A1%8Cinit%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.8.1.2.6.</span> <span class="toc-text">6. æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">1.8.2.</span> <span class="toc-text">2ï¼Œå¯¹è±¡å†…å­˜å¸ƒå±€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E5%AF%B9%E8%B1%A1%E5%A4%B4%EF%BC%88Header%EF%BC%89"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">2.1ï¼Œå¯¹è±¡å¤´ï¼ˆHeaderï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E5%AE%9E%E4%BE%8B%E6%95%B0%E6%8D%AE%EF%BC%88Instance-Data%EF%BC%89"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">2.2ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E5%AF%B9%E9%BD%90%E5%A1%AB%E5%85%85%EF%BC%88Padding%EF%BC%89"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">2.3ï¼Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.8.3.</span> <span class="toc-text">3ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E5%8F%A5%E6%9F%84%E8%AE%BF%E9%97%AE"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">3.1ï¼Œå¥æŸ„è®¿é—®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8C%87%E9%92%88%EF%BC%88HotSpot%E9%87%87%E7%94%A8%EF%BC%89"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">3.2ï¼Œç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%EF%BC%88Direct-Memory%EF%BC%89"><span class="toc-number">1.8.4.</span> <span class="toc-text">4ï¼Œç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">4.1ï¼Œç›´æ¥å†…å­˜æ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%8C%E9%9D%9E%E7%9B%B4%E6%8E%A5%E7%BC%93%E5%AD%98%E5%8C%BA"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">4.2ï¼Œéç›´æ¥ç¼“å­˜åŒº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%BC%93%E5%AD%98%E5%8C%BA"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">4.3ï¼Œç›´æ¥ç¼“å­˜åŒº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E"><span class="toc-number">1.9.</span> <span class="toc-text">ä¹ï¼Œæ‰§è¡Œå¼•æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">1ï¼Œæ‰§è¡Œå¼•æ“æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">9.1ï¼Œæ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CJava%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.2.</span> <span class="toc-text">2ï¼ŒJavaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C-%E4%BB%80%E4%B9%88%E6%98%AF%E8%A7%A3%E9%87%8A%E5%99%A8%EF%BC%88Interpreter%EF%BC%89%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AFJIT%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%9F"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">2.1ï¼Œ ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88Java%E6%98%AF%E5%8D%8A%E7%BC%96%E8%AF%91%E5%8D%8A%E8%A7%A3%E9%87%8A%E5%9E%8B%E8%AF%AD%E8%A8%80%EF%BC%9F"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">2.2ï¼Œä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%A0%81%E3%80%81%E6%8C%87%E4%BB%A4%E3%80%81%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80"><span class="toc-number">1.9.3.</span> <span class="toc-text">3ï¼Œæœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%A0%81"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">3.1ï¼Œæœºå™¨ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E6%8C%87%E4%BB%A4"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">3.2ï¼ŒæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%EF%BC%8C%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">3.3ï¼ŒæŒ‡ä»¤é›†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%EF%BC%8C%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80"><span class="toc-number">1.9.3.4.</span> <span class="toc-text">3.4ï¼Œæ±‡ç¼–è¯­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%EF%BC%8C%E9%AB%98%E7%BA%A7%E8%AF%AD%E8%A8%80"><span class="toc-number">1.9.3.5.</span> <span class="toc-text">3.5ï¼Œé«˜çº§è¯­è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#C%E3%80%81C-%E6%BA%90%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.3.5.1.</span> <span class="toc-text">Cã€C++æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%EF%BC%8C%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">1.9.3.6.</span> <span class="toc-text">3.6ï¼Œå­—èŠ‚ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E8%A7%A3%E9%87%8A%E5%99%A8"><span class="toc-number">1.9.4.</span> <span class="toc-text">4ï¼Œè§£é‡Šå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8C%E8%A7%A3%E9%87%8A%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">4.1ï¼Œè§£é‡Šå™¨å·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%8C%E8%A7%A3%E9%87%8A%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">4.2ï¼Œè§£é‡Šå™¨åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%8C%E7%8E%B0%E7%8A%B6"><span class="toc-number">1.9.4.3.</span> <span class="toc-text">4.3ï¼Œç°çŠ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8CJIT%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.9.5.</span> <span class="toc-text">5ï¼ŒJITç¼–è¯‘å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8CJava%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">5.1ï¼ŒJavaä»£ç çš„æ‰§è¡Œåˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%8CHotSpot-JVM%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">5.2ï¼ŒHotSpot JVMæ‰§è¡Œæ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%EF%BC%8C%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">5.3ï¼Œæ¦‚å¿µè§£é‡Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4%EF%BC%8C%E7%83%AD%E7%82%B9%E4%BB%A3%E7%A0%81%E5%8F%8A%E6%8E%A2%E6%B5%8B%E6%8A%80%E6%9C%AF"><span class="toc-number">1.9.5.4.</span> <span class="toc-text">5.4ï¼Œçƒ­ç‚¹ä»£ç åŠæ¢æµ‹æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.9.5.4.1.</span> <span class="toc-text">æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%83%AD%E7%82%B9%E8%A1%B0%E5%87%8F"><span class="toc-number">1.9.5.4.2.</span> <span class="toc-text">çƒ­ç‚¹è¡°å‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9E%E8%BE%B9%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.9.5.4.3.</span> <span class="toc-text">å›è¾¹è®¡æ•°å™¨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5%EF%BC%8CHotSpotVM-%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.5.5.</span> <span class="toc-text">5.5ï¼ŒHotSpotVM å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6%EF%BC%8CHotSpotVM%E4%B8%AD-JIT-%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.5.6.</span> <span class="toc-text">5.6ï¼ŒHotSpotVMä¸­ JIT åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#C1-%E5%92%8C-C2%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.9.5.6.1.</span> <span class="toc-text">C1 å’Œ C2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.9.5.7.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOT%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.9.5.8.</span> <span class="toc-text">AOTç¼–è¯‘å™¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%EF%BC%8CStringTable"><span class="toc-number">1.10.</span> <span class="toc-text">åï¼ŒStringTable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CString%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-number">1.10.1.</span> <span class="toc-text">1ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8CString%E5%9C%A8jdk9%E4%B8%AD%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%98%E6%9B%B4"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">1.1ï¼ŒStringåœ¨jdk9ä¸­å­˜å‚¨ç»“æ„å˜æ›´</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Motivation"><span class="toc-number">1.11.</span> <span class="toc-text">Motivation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Description"><span class="toc-number">1.12.</span> <span class="toc-text">Description</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8CString%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-number">1.12.0.1.</span> <span class="toc-text">1.2ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CString%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D"><span class="toc-number">1.12.1.</span> <span class="toc-text">2ï¼ŒStringçš„å†…å­˜åˆ†é…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CString%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.12.2.</span> <span class="toc-text">3ï¼ŒStringçš„åŸºæœ¬æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.12.3.</span> <span class="toc-text">4ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8Cintern-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.12.4.</span> <span class="toc-text">5ï¼Œintern()çš„ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8C%E5%85%B3%E4%BA%8Eintern-%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">5.1ï¼Œå…³äºintern()çš„é¢è¯•é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">1.12.4.1.1.</span> <span class="toc-text">æ‰©å±•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">1.12.4.1.2.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%8Cintern%E7%9A%84%E6%95%88%E7%8E%87%E6%B5%8B%E8%AF%95%EF%BC%9A%E7%A9%BA%E9%97%B4%E8%A7%92%E5%BA%A6"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">5.2ï¼Œinternçš„æ•ˆç‡æµ‹è¯•ï¼šç©ºé—´è§’åº¦</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8CStringTable%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.12.5.</span> <span class="toc-text">6ï¼ŒStringTableçš„åƒåœ¾å›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8CG1%E4%B8%AD%E7%9A%84String%E5%8E%BB%E9%87%8D%E6%93%8D%E4%BD%9C"><span class="toc-number">1.12.6.</span> <span class="toc-text">7ï¼ŒG1ä¸­çš„Stringå»é‡æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.</span> <span class="toc-text">åä¸€ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°åŠç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.13.1.</span> <span class="toc-text">1ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AF%E5%9E%83%E5%9C%BE%EF%BC%9F"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">1.1ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9E%83%E5%9C%BE%EF%BC%9F"><span class="toc-number">1.13.1.1.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81GC"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">1.2ï¼Œä¸ºä»€ä¹ˆéœ€è¦GC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E6%97%A9%E6%9C%9F%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.13.1.3.</span> <span class="toc-text">1.3ï¼Œæ—©æœŸåƒåœ¾å›æ”¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%EF%BC%8CJava%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">1.13.1.4.</span> <span class="toc-text">1.4ï¼ŒJavaåƒåœ¾å›æ”¶æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%85%E5%BF%A7"><span class="toc-number">1.13.1.4.1.</span> <span class="toc-text">æ‹…å¿§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#GC%E4%B8%BB%E8%A6%81%E5%85%B3%E6%B3%A8%E7%9A%84%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.13.1.4.2.</span> <span class="toc-text">GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.</span> <span class="toc-text">2ï¼Œåƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">2.1ï¼Œæ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.1.1.</span> <span class="toc-text">æ–¹å¼ä¸€ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-number">1.13.2.1.2.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.2.</span> <span class="toc-text">2.2ï¼Œæ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95%EF%BC%88%E6%A0%B9%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E3%80%81%E8%BF%BD%E8%B8%AA%E6%80%A7%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%EF%BC%89"><span class="toc-number">1.13.2.2.1.</span> <span class="toc-text">å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF"><span class="toc-number">1.13.2.2.2.</span> <span class="toc-text">åŸºæœ¬æ€è·¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84finalization%E6%9C%BA%E5%88%B6"><span class="toc-number">1.13.2.3.</span> <span class="toc-text">2.3ï¼Œå¯¹è±¡çš„finalizationæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E5%AD%98%E8%BF%98%E6%98%AF%E6%AD%BB%E4%BA%A1%EF%BC%9F"><span class="toc-number">1.13.2.3.1.</span> <span class="toc-text">ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E8%BF%87%E7%A8%8B"><span class="toc-number">1.13.2.3.2.</span> <span class="toc-text">å…·ä½“è¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8CMAT%E4%B8%8EJProfiler%E7%9A%84GC-Roots%E6%BA%AF%E6%BA%90"><span class="toc-number">1.13.2.4.</span> <span class="toc-text">2.4ï¼ŒMATä¸JProfilerçš„GC Rootsæº¯æº</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MAT%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.13.2.4.1.</span> <span class="toc-text">MATæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96dump%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.4.2.</span> <span class="toc-text">è·å–dumpæ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8-jmap"><span class="toc-number">1.13.2.4.2.1.</span> <span class="toc-text">æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨ jmap</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8JVisualVM%E5%AF%BC%E5%87%BA"><span class="toc-number">1.13.2.4.2.2.</span> <span class="toc-text">æ–¹å¼äºŒï¼šä½¿ç”¨JVisualVMå¯¼å‡º</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E4%BD%BF%E7%94%A8MAT%E6%89%93%E5%BC%80Dump%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.4.2.3.</span> <span class="toc-text">æ–¹å¼ä¸‰ï¼šä½¿ç”¨MATæ‰“å¼€Dumpæ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JProfiler%E7%9A%84GC-Roots%E6%BA%AF%E6%BA%90"><span class="toc-number">1.13.2.4.3.</span> <span class="toc-text">JProfilerçš„GC Rootsæº¯æº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%EF%BC%8C%E6%B8%85%E9%99%A4%E9%98%B6%E6%AE%B5%EF%BC%9A%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.5.</span> <span class="toc-text">2.5ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95%EF%BC%88Mark-Sweep%EF%BC%89"><span class="toc-number">1.13.2.5.1.</span> <span class="toc-text">æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.13.2.5.2.</span> <span class="toc-text">æ‰§è¡Œè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">1.13.2.5.3.</span> <span class="toc-text">ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%95%E4%B8%BA%E6%B8%85%E9%99%A4%EF%BC%9F"><span class="toc-number">1.13.2.5.4.</span> <span class="toc-text">ä½•ä¸ºæ¸…é™¤ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%EF%BC%8C%E6%B8%85%E9%99%A4%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.6.</span> <span class="toc-text">2.6ï¼Œæ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%EF%BC%88Copying%EF%BC%89%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.6.1.</span> <span class="toc-text">å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="toc-number">1.13.2.6.2.</span> <span class="toc-text">æ ¸å¿ƒæ€æƒ³</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7%EF%BC%8C%E6%B8%85%E9%99%A4%E9%98%B6%E6%AE%B5%EF%BC%9A%E6%A0%87%E8%AE%B0-%E5%8E%8B%E7%BC%A9%EF%BC%88%E6%95%B4%E7%90%86%EF%BC%89%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.7.</span> <span class="toc-text">2.7ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8%EF%BC%8C%E5%B0%8F%E7%BB%93"><span class="toc-number">1.13.2.8.</span> <span class="toc-text">2.8ï¼Œå°ç»“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-9%EF%BC%8C%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.9.</span> <span class="toc-text">2.9ï¼Œåˆ†ä»£æ”¶é›†ç®—æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10%EF%BC%8C%E5%A2%9E%E9%87%8F%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95%E3%80%81%E5%88%86%E5%8C%BA%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.10.</span> <span class="toc-text">2.10ï¼Œå¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E9%87%8F%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.10.1.</span> <span class="toc-text">å¢é‡æ”¶é›†ç®—æ³•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E7%AE%97%E6%B3%95"><span class="toc-number">1.13.2.10.2.</span> <span class="toc-text">åˆ†åŒºç®—æ³•</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.14.</span> <span class="toc-text">åäºŒï¼Œåƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CSystem-gc-%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.14.1.</span> <span class="toc-text">1ï¼ŒSystem.gc()çš„ç†è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">1.14.2.</span> <span class="toc-text">2ï¼Œå†…å­˜æº¢å‡ºä¸å†…å­˜æ³„éœ²</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%88OOM%EF%BC%89"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%88Memory-Leak%EF%BC%89"><span class="toc-number">1.14.2.2.</span> <span class="toc-text">å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CStop-The-World"><span class="toc-number">1.14.3.</span> <span class="toc-text">3ï¼ŒStop The World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E5%B9%B6%E8%A1%8C%E4%B8%8E%E5%B9%B6%E5%8F%91"><span class="toc-number">1.14.4.</span> <span class="toc-text">4ï¼Œåƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%EF%BC%88Concurrent%EF%BC%89"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">å¹¶å‘ï¼ˆConcurrentï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%EF%BC%88Parallel%EF%BC%89"><span class="toc-number">1.14.4.2.</span> <span class="toc-text">å¹¶è¡Œï¼ˆParallelï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91-vs-%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.14.4.3.</span> <span class="toc-text">å¹¶å‘ vs å¹¶è¡Œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.14.4.4.</span> <span class="toc-text">åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E5%AE%89%E5%85%A8%E7%82%B9%E4%B8%8E%E5%AE%89%E5%85%A8%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.14.5.</span> <span class="toc-text">5ï¼Œå®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%82%B9"><span class="toc-number">1.14.5.1.</span> <span class="toc-text">å®‰å…¨ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%8C%BA%E5%9F%9F%EF%BC%88Safe-Resion%EF%BC%89"><span class="toc-number">1.14.5.2.</span> <span class="toc-text">å®‰å…¨åŒºåŸŸï¼ˆSafe Resionï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E5%86%8D%E8%B0%88%E5%BC%95%E7%94%A8%EF%BC%9A%E5%BC%BA%E5%BC%95%E7%94%A8"><span class="toc-number">1.14.6.</span> <span class="toc-text">6ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%BC%95%E7%94%A8%EF%BC%88Strong-Reference%EF%BC%89%E2%80%94%E2%80%94%E4%B8%8D%E5%9B%9E%E6%94%B6"><span class="toc-number">1.14.6.1.</span> <span class="toc-text">å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰â€”â€”ä¸å›æ”¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E5%86%8D%E8%B0%88%E5%BC%95%E7%94%A8%EF%BC%9A-%E8%BD%AF%E5%BC%95%E7%94%A8"><span class="toc-number">1.14.7.</span> <span class="toc-text">7ï¼Œå†è°ˆå¼•ç”¨ï¼š è½¯å¼•ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E5%BC%95%E7%94%A8%EF%BC%88Soft-Reference%EF%BC%89%E2%80%94%E2%80%94%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E5%8D%B3%E5%9B%9E%E6%94%B6"><span class="toc-number">1.14.7.1.</span> <span class="toc-text">è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E5%86%8D%E8%B0%88%E5%BC%95%E7%94%A8%EF%BC%9A%E5%BC%B1%E5%BC%95%E7%94%A8"><span class="toc-number">1.14.8.</span> <span class="toc-text">8ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%BC%95%E7%94%A8%EF%BC%88Weak-Reference%EF%BC%89%E2%80%94%E2%80%94%E5%8F%91%E7%8E%B0%E5%8D%B3%E5%9B%9E%E6%94%B6"><span class="toc-number">1.14.8.1.</span> <span class="toc-text">å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E5%86%8D%E8%B0%88%E5%BC%95%E7%94%A8%EF%BC%9A%E8%99%9A%E5%BC%95%E7%94%A8"><span class="toc-number">1.14.9.</span> <span class="toc-text">9ï¼Œå†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E5%BC%95%E7%94%A8%EF%BC%88Phantom-Reference%EF%BC%89%E2%80%94%E2%80%94%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E8%B7%9F%E8%B8%AA"><span class="toc-number">1.14.9.1.</span> <span class="toc-text">è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E7%BB%88%E7%BB%93%E5%99%A8%E5%BC%95%E7%94%A8"><span class="toc-number">1.14.10.</span> <span class="toc-text">10ï¼Œç»ˆç»“å™¨å¼•ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-number">1.15.</span> <span class="toc-text">åä¸‰ï¼Œåƒåœ¾å›æ”¶å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CGC%E5%88%86%E7%B1%BB%E4%B8%8E%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">1.15.1.</span> <span class="toc-text">1ï¼ŒGCåˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">1.15.1.1.</span> <span class="toc-text">1.1ï¼Œåƒåœ¾å›æ”¶å™¨æ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">1.15.1.2.</span> <span class="toc-text">1.2ï¼Œåƒåœ¾æ”¶é›†å™¨åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E8%AF%84%E4%BC%B0GC%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">1.15.1.3.</span> <span class="toc-text">1.3ï¼Œè¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">1.15.2.</span> <span class="toc-text">2ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%8F%91%E5%B1%95%E5%8F%B2"><span class="toc-number">1.15.2.1.</span> <span class="toc-text">2.1ï¼Œåƒåœ¾å›æ”¶å™¨å‘å±•å²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C7%E7%A7%8D%E7%BB%8F%E5%85%B8%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">1.15.2.2.</span> <span class="toc-text">2.2ï¼Œ7ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C7%E6%AC%BE%E7%BB%8F%E5%85%B8%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%88%86%E4%BB%A3%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.15.2.3.</span> <span class="toc-text">2.3ï¼Œ7æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E7%BB%84%E5%90%88%E5%85%B3%E7%B3%BB"><span class="toc-number">1.15.2.4.</span> <span class="toc-text">2.4ï¼Œåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">1.15.2.5.</span> <span class="toc-text">2.5ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%EF%BC%8C%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E9%BB%98%E8%AE%A4%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">1.15.2.6.</span> <span class="toc-text">2.6ï¼Œå¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CSerial%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9A%E4%B8%B2%E8%A1%8C%E5%9B%9E%E6%94%B6"><span class="toc-number">1.15.3.</span> <span class="toc-text">3ï¼ŒSerialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8CParNew%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9A%E5%B9%B6%E8%A1%8C%E5%9B%9E%E6%94%B6"><span class="toc-number">1.15.4.</span> <span class="toc-text">4ï¼ŒParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8CParallel%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9A%E5%90%9E%E5%90%90%E9%87%8F%E4%BC%98%E5%85%88"><span class="toc-number">1.15.5.</span> <span class="toc-text">5ï¼ŒParallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8CCMS%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9A%E4%BD%8E%E5%BB%B6%E8%BF%9F"><span class="toc-number">1.15.6.</span> <span class="toc-text">6ï¼ŒCMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%8CCMS%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.15.6.1.</span> <span class="toc-text">6.1ï¼ŒCMSçš„ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%8CCMS%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-number">1.15.6.2.</span> <span class="toc-text">6.2ï¼ŒCMSçš„å¼Šç«¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%EF%BC%8C%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.15.6.3.</span> <span class="toc-text">6.3ï¼Œè®¾ç½®çš„å‚æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="toc-number">1.15.6.4.</span> <span class="toc-text">å°ç»“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4%EF%BC%8CJDK%E5%90%8E%E7%BB%AD%E7%89%88%E6%9C%AC%E4%B8%ADCMS%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.15.6.5.</span> <span class="toc-text">6.4ï¼ŒJDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9A%E5%8C%BA%E5%9F%9F%E5%8C%96%E5%88%86%E4%BB%A3%E5%BC%8F"><span class="toc-number">1.15.7.</span> <span class="toc-text">7ï¼ŒG1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E7%89%B9%E7%82%B9%EF%BC%88%E4%BC%98%E5%8A%BF%EF%BC%89"><span class="toc-number">1.15.7.1.</span> <span class="toc-text">7.1ï¼ŒG1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E4%B8%8E%E5%B9%B6%E5%8F%91"><span class="toc-number">1.15.7.1.1.</span> <span class="toc-text">å¹¶è¡Œä¸å¹¶å‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86"><span class="toc-number">1.15.7.1.2.</span> <span class="toc-text">åˆ†ä»£æ”¶é›†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E6%95%B4%E5%90%88"><span class="toc-number">1.15.7.1.3.</span> <span class="toc-text">ç©ºé—´æ•´åˆ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E5%81%9C%E9%A1%BF%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9E%8B%EF%BC%88%E5%8D%B3%EF%BC%9A%E8%BD%AF%E5%AE%9E%E6%97%B6soft-real-time%EF%BC%89"><span class="toc-number">1.15.7.1.4.</span> <span class="toc-text">å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft real-timeï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2%EF%BC%8CG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.15.7.2.</span> <span class="toc-text">7.2ï¼ŒG1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.15.7.3.</span> <span class="toc-text">7.3ï¼ŒG1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4%EF%BC%8CG1%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.15.7.4.</span> <span class="toc-text">7.4ï¼ŒG1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5%EF%BC%8CG1%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.15.7.5.</span> <span class="toc-text">7.5ï¼ŒG1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6%EF%BC%8C%E5%88%86%E5%8C%BARegion%EF%BC%9A%E5%8C%96%E6%95%B4%E4%B8%BA%E9%9B%B6"><span class="toc-number">1.15.7.6.</span> <span class="toc-text">7.6ï¼Œåˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7%EF%BC%8CG1%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B"><span class="toc-number">1.15.7.7.</span> <span class="toc-text">7.7ï¼ŒG1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8%EF%BC%8CRemembered-Set"><span class="toc-number">1.15.7.8.</span> <span class="toc-text">7.8ï¼ŒRemembered Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-9%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%E4%B8%80%EF%BC%9A%E5%B9%B4%E8%BD%BB%E4%BB%A3GC"><span class="toc-number">1.15.7.9.</span> <span class="toc-text">7.9ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£GC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-10%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%E4%BA%8C%EF%BC%9A%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">1.15.7.10.</span> <span class="toc-text">7.10ï¼ŒG1å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-11%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%E4%B8%89%EF%BC%9A%E6%B7%B7%E5%90%88%E5%9B%9E%E6%94%B6"><span class="toc-number">1.15.7.11.</span> <span class="toc-text">7.11ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-12%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E5%8F%AF%E9%80%89%E7%9A%84%E8%BF%87%E7%A8%8B%E5%9B%9B%EF%BC%9AFull-GC"><span class="toc-number">1.15.7.12.</span> <span class="toc-text">7.12ï¼ŒG1å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull GC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-13%EF%BC%8C%E8%A1%A5%E5%85%85"><span class="toc-number">1.15.7.13.</span> <span class="toc-text">7.13ï¼Œè¡¥å……</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-14%EF%BC%8CG1%E5%9B%9E%E6%94%B6%E5%99%A8%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.15.7.14.</span> <span class="toc-text">7.14ï¼ŒG1å›æ”¶å™¨ä¼˜åŒ–å»ºè®®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%80%BB%E7%BB%93"><span class="toc-number">1.15.8.</span> <span class="toc-text">8ï¼Œåƒåœ¾å›æ”¶å™¨æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C7%E7%A7%8D%E7%BB%8F%E5%85%B8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%80%BB%E7%BB%93"><span class="toc-number">1.15.8.1.</span> <span class="toc-text">8.1ï¼Œ7ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%BB%84%E5%90%88"><span class="toc-number">1.15.8.2.</span> <span class="toc-text">8.2ï¼Œåƒåœ¾å›æ”¶å™¨ç»„åˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3%EF%BC%8C%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-number">1.15.8.3.</span> <span class="toc-text">8.3ï¼Œæ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8CGC%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">1.15.9.</span> <span class="toc-text">9ï¼ŒGCæ—¥å¿—åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Minor-GC%E6%97%A5%E5%BF%97"><span class="toc-number">1.15.9.1.</span> <span class="toc-text">Minor GCæ—¥å¿—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Full-GC%E6%97%A5%E5%BF%97"><span class="toc-number">1.15.9.2.</span> <span class="toc-text">Full GCæ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E6%96%B0%E5%8F%91%E5%B1%95"><span class="toc-number">1.15.10.</span> <span class="toc-text">10ï¼Œåƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1%EF%BC%8CJDK11%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.15.10.1.</span> <span class="toc-text">10.1ï¼ŒJDK11æ–°ç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2%EF%BC%8COpen-JDK12%E7%9A%84Shenandoash-GC"><span class="toc-number">1.15.10.2.</span> <span class="toc-text">10.2ï¼ŒOpen JDK12çš„Shenandoash GC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3%EF%BC%8C%E4%BB%A4%E4%BA%BA%E9%9C%87%E6%83%8A%E3%80%81%E9%9D%A9%E5%91%BD%E6%80%A7%E7%9A%84ZGC"><span class="toc-number">1.15.10.3.</span> <span class="toc-text">10.3ï¼Œä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ZGC</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9AAliGC"><span class="toc-number">1.15.11.</span> <span class="toc-text">10.4ï¼Œå…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81%E4%B8%8E%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E7%AF%87"><span class="toc-number">2.</span> <span class="toc-text">å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8CClass%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">ä¸€ï¼ŒClassæ–‡ä»¶ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CClass%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">1ï¼ŒClasså­—èŠ‚ç æ–‡ä»¶ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CClass%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">2ï¼ŒClassæ–‡ä»¶æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E9%AD%94%E6%95%B0"><span class="toc-number">2.1.3.</span> <span class="toc-text">3ï¼Œé­”æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E6%96%87%E4%BB%B6%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">2.1.4.</span> <span class="toc-text">4ï¼Œæ–‡ä»¶ç‰ˆæœ¬å·</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8CClass%E6%96%87%E4%BB%B6%E7%89%88%E6%9C%AC%E5%8F%B7%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">4.1ï¼ŒClassæ–‡ä»¶ç‰ˆæœ¬å·å¯¹åº”å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E5%B8%B8%E9%87%8F%E6%B1%A0%E9%9B%86%E5%90%88"><span class="toc-number">2.1.5.</span> <span class="toc-text">5ï¼Œå¸¸é‡æ± é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8C%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">5.1ï¼Œå¸¸é‡æ± è®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%8C%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%A1%A8"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">5.2ï¼Œå¸¸é‡æ± è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A0-%E5%AD%97%E9%9D%A2%E9%87%8F%E5%92%8C%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.5.2.1.</span> <span class="toc-text">â… . å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A1-%E5%B8%B8%E9%87%8F%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.5.2.2.</span> <span class="toc-text">â…¡. å¸¸é‡ç±»å‹å’Œç»“æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E8%AE%BF%E9%97%AE%E6%A0%87%E5%BF%97"><span class="toc-number">2.1.6.</span> <span class="toc-text">6ï¼Œè®¿é—®æ ‡å¿—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E7%88%B6%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E6%8E%A5%E5%8F%A3%E7%B4%A2%E5%BC%95"><span class="toc-number">2.1.7.</span> <span class="toc-text">7ï¼Œç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1%EF%BC%8Cthis-class%EF%BC%88%E7%B1%BB%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">2.1.7.1.</span> <span class="toc-text">7.1ï¼Œthis_classï¼ˆç±»ç´¢å¼•ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2%EF%BC%8Csuper-class%EF%BC%88%E7%88%B6%E7%B1%BB%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">2.1.7.2.</span> <span class="toc-text">7.2ï¼Œsuper_classï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3%EF%BC%8Cinterfaces"><span class="toc-number">2.1.7.3.</span> <span class="toc-text">7.3ï¼Œinterfaces</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A0-interfaces-count%EF%BC%88%E6%8E%A5%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%89"><span class="toc-number">2.1.7.3.1.</span> <span class="toc-text">â… . interfaces_countï¼ˆæ¥å£è®¡æ•°å™¨ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A1-interfaces-%EF%BC%88%E6%8E%A5%E5%8F%A3%E7%B4%A2%E5%BC%95%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">2.1.7.3.2.</span> <span class="toc-text">â…¡. interfaces[]ï¼ˆæ¥å£ç´¢å¼•é›†åˆï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E5%AD%97%E6%AE%B5%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">2.1.8.</span> <span class="toc-text">8ï¼Œå­—æ®µè¡¨é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C%E5%AD%97%E6%AE%B5%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.1.8.1.</span> <span class="toc-text">8.1ï¼Œå­—æ®µè®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E5%AD%97%E6%AE%B5%E8%A1%A8"><span class="toc-number">2.1.8.2.</span> <span class="toc-text">8.2ï¼Œå­—æ®µè¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A0-%E5%AD%97%E6%AE%B5%E8%A1%A8%E8%AE%BF%E9%97%AE%E6%A0%87%E8%AF%86"><span class="toc-number">2.1.8.2.1.</span> <span class="toc-text">â… . å­—æ®µè¡¨è®¿é—®æ ‡è¯†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A1-%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%B4%A2%E5%BC%95"><span class="toc-number">2.1.8.2.2.</span> <span class="toc-text">â…¡. æè¿°ç¬¦ç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A2-%E5%B1%9E%E6%80%A7%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">2.1.8.2.3.</span> <span class="toc-text">â…¢. å±æ€§è¡¨é›†åˆ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">2.1.9.</span> <span class="toc-text">9ï¼Œæ–¹æ³•è¡¨é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1%EF%BC%8C%E6%96%B9%E6%B3%95%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">9.1ï¼Œæ–¹æ³•è®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2%EF%BC%8C%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">2.1.9.2.</span> <span class="toc-text">9.2ï¼Œæ–¹æ³•è¡¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E5%B1%9E%E6%80%A7%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">2.1.10.</span> <span class="toc-text">10ï¼Œå±æ€§è¡¨é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1%EF%BC%8C%E5%B1%9E%E6%80%A7%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.1.10.1.</span> <span class="toc-text">10.1ï¼Œå±æ€§è®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2%EF%BC%8C%E5%B1%9E%E6%80%A7%E8%A1%A8"><span class="toc-number">2.1.10.2.</span> <span class="toc-text">10.2ï¼Œå±æ€§è¡¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="toc-number">2.2.</span> <span class="toc-text">äºŒï¼Œå­—èŠ‚ç æŒ‡ä»¤é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%A6%82%E8%BF%B0"><span class="toc-number">2.2.1.</span> <span class="toc-text">1ï¼Œæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">1.1ï¼Œæ‰§è¡Œæ¨¡å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E5%AD%97%E8%8A%82%E7%A0%81%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">1.2ï¼Œå­—èŠ‚ç ä¸æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E6%8C%87%E4%BB%A4%E5%88%86%E6%9E%90"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">1.3ï¼ŒæŒ‡ä»¤åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%98%E5%82%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.2.</span> <span class="toc-text">2ï¼ŒåŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E4%BD%9C%E7%94%A8"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">2.1ï¼Œä½œç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">2.2ï¼Œå¸¸ç”¨æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E5%86%8D%E8%B0%88%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">2.3ï¼Œå†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8C%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E5%8E%8B%E6%A0%88%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">2.4ï¼Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%EF%BC%8C%E5%B8%B8%E9%87%8F%E5%85%A5%E6%A0%88%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">2.5ï¼Œå¸¸é‡å…¥æ ˆæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%EF%BC%8C%E5%87%BA%E6%A0%88%E8%A3%85%E5%85%A5%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">2.6ï¼Œå‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E7%AE%97%E6%9C%AF%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.3.</span> <span class="toc-text">3ï¼Œç®—æœ¯æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E4%BD%9C%E7%94%A8"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">3.1ï¼Œä½œç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">3.2ï¼Œåˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%EF%BC%8Cbyte%E3%80%81short%E3%80%81char%E5%92%8Cboolean%E7%B1%BB%E5%9E%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">3.3ï¼Œbyteã€shortã€charå’Œbooleanç±»å‹è¯´æ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%EF%BC%8C%E8%BF%90%E7%AE%97%E6%97%B6%E7%9A%84%E6%BA%A2%E5%87%BA"><span class="toc-number">2.2.3.4.</span> <span class="toc-text">3.4ï¼Œè¿ç®—æ—¶çš„æº¢å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%EF%BC%8C%E8%BF%90%E7%AE%97%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.3.5.</span> <span class="toc-text">3.5ï¼Œè¿ç®—æ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%EF%BC%8CNaN%E5%80%BC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.3.6.</span> <span class="toc-text">3.6ï¼ŒNaNå€¼ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7%EF%BC%8C%E6%89%80%E6%9C%89%E7%AE%97%E6%9C%AF%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.3.7.</span> <span class="toc-text">3.7ï¼Œæ‰€æœ‰ç®—æœ¯æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8%EF%BC%8C%E5%BD%BB%E5%BA%95%E6%90%9E%E5%AE%9A-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.3.8.</span> <span class="toc-text">3.8ï¼Œå½»åº•æå®š++è¿ç®—ç¬¦</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.4.</span> <span class="toc-text">4ï¼Œç±»å‹è½¬æ¢æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8C%E5%AE%BD%E5%8C%96%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">4.1ï¼Œå®½åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8C%E7%AA%84%E5%8C%96%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">4.1ï¼Œçª„åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.5.</span> <span class="toc-text">5ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">5.1ï¼Œåˆ›å»ºæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%8C%E5%AD%97%E6%AE%B5%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">5.2ï¼Œå­—æ®µè®¿é—®æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%EF%BC%8C%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">5.3ï¼Œæ•°ç»„æ“ä½œæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4%EF%BC%8C%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.5.4.</span> <span class="toc-text">5.4ï¼Œç±»å‹æ£€æŸ¥æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E4%B8%8E%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.6.</span> <span class="toc-text">6ï¼Œæ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%8C%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">6.1ï¼Œæ–¹æ³•è°ƒç”¨æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%8C%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">6.2ï¼Œæ–¹æ³•è¿”å›æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E7%AE%A1%E7%90%86%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.7.</span> <span class="toc-text">7ï¼Œæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E6%8E%A7%E5%88%B6%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.</span> <span class="toc-text">8ï¼Œæ§åˆ¶è½¬ç§»æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.1.</span> <span class="toc-text">8.1ï¼Œæ¯”è¾ƒæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.2.</span> <span class="toc-text">8.2ï¼Œæ¡ä»¶è·³è½¬æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3%EF%BC%8C%E6%AF%94%E8%BE%83%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.3.</span> <span class="toc-text">8.3ï¼Œæ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4%EF%BC%8C%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.4.</span> <span class="toc-text">8.4ï¼Œå¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5%EF%BC%8C%E6%97%A0%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.8.5.</span> <span class="toc-text">8.5ï¼Œæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.9.</span> <span class="toc-text">9ï¼Œå¼‚å¸¸å¤„ç†æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%8C%E5%90%8C%E6%AD%A5%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.10.</span> <span class="toc-text">10ï¼ŒåŒæ­¥æ§åˆ¶æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1%EF%BC%8C%E6%96%B9%E6%B3%95%E7%BA%A7%E7%9A%84%E5%90%8C%E6%AD%A5"><span class="toc-number">2.2.10.1.</span> <span class="toc-text">10.1ï¼Œæ–¹æ³•çº§çš„åŒæ­¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2%EF%BC%8C%E6%96%B9%E6%B3%95%E5%86%85%E6%8C%87%E4%BB%A4%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97%E7%9A%84%E5%90%8C%E6%AD%A5"><span class="toc-number">2.2.10.2.</span> <span class="toc-text">10.2ï¼Œæ–¹æ³•å†…æŒ‡ä»¤æŒ‡ä»¤åºåˆ—çš„åŒæ­¥</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%EF%BC%88%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%89%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.3.</span> <span class="toc-text">ä¸‰ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹ï¼ˆç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">1ï¼Œæ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E8%BF%87%E7%A8%8B%E4%B8%80%EF%BC%9ALoading%EF%BC%88%E5%8A%A0%E8%BD%BD%EF%BC%89%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.2.</span> <span class="toc-text">2ï¼Œè¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.1ï¼ŒåŠ è½½å®Œæˆçš„æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%B5%81%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.2ï¼ŒäºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E7%B1%BB%E6%A8%A1%E5%9E%8B%E4%B8%8EClass%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">2.3ï¼Œç±»æ¨¡å‹ä¸Classå®ä¾‹çš„ä½ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8C%E6%95%B0%E7%BB%84%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">2.4ï¼Œæ•°ç»„ç±»çš„åŠ è½½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E8%BF%87%E7%A8%8B%E4%BA%8C%EF%BC%9ALinking%EF%BC%88%E9%93%BE%E6%8E%A5%EF%BC%89%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.3.</span> <span class="toc-text">3ï¼Œè¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E7%8E%AF%E8%8A%821%EF%BC%9A%E9%93%BE%E6%8E%A5%E9%98%B6%E6%AE%B5%E4%B9%8BVerification%EF%BC%88%E9%AA%8C%E8%AF%81%EF%BC%89"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">3.1ï¼Œç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E7%8E%AF%E8%8A%822%EF%BC%9A%E9%93%BE%E6%8E%A5%E9%98%B6%E6%AE%B5%E4%B9%8BPreparation%EF%BC%88%E5%87%86%E5%A4%87%EF%BC%89"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">3.2ï¼Œç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%EF%BC%8C%E7%8E%AF%E8%8A%823%EF%BC%9A%E9%93%BE%E6%8E%A5%E9%98%B6%E6%AE%B5%E4%B9%8BResolution%EF%BC%88%E8%A7%A3%E6%9E%90%EF%BC%89"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">3.3ï¼Œç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E8%BF%87%E7%A8%8B%E4%B8%89%EF%BC%9AInitialization%EF%BC%88%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%89%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.4.</span> <span class="toc-text">4ï¼Œè¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8Cstatic%E4%B8%8Efinal%E7%9A%84%E6%90%AD%E9%85%8D%E9%97%AE%E9%A2%98"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">4.1ï¼Œstaticä¸finalçš„æ­é…é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%8C-%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">4.2ï¼Œ()çš„çº¿ç¨‹å®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%8C%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%83%85%E5%86%B5%EF%BC%9A%E4%B8%BB%E5%8A%A8%E4%BD%BF%E7%94%A8vs%E8%A2%AB%E5%8A%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">4.3ï¼Œç±»çš„åˆå§‹åŒ–æƒ…å†µï¼šä¸»åŠ¨ä½¿ç”¨vsè¢«åŠ¨ä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E8%BF%87%E7%A8%8B%E5%9B%9B%EF%BC%9A%E7%B1%BB%E7%9A%84Using%EF%BC%88%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-number">2.3.5.</span> <span class="toc-text">5ï¼Œè¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E8%BF%87%E7%A8%8B%E4%BA%94%EF%BC%9A%E7%B1%BB%E7%9A%84Unloading%EF%BC%88%E5%8D%B8%E8%BD%BD%EF%BC%89"><span class="toc-number">2.3.6.</span> <span class="toc-text">6ï¼Œè¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%8C%E7%B1%BB%E3%80%81%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8%E3%80%81%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%BC%95%E7%94%A8%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">6.1ï¼Œç±»ã€ç±»çš„åŠ è½½å™¨ã€ç±»çš„å®ä¾‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%8C%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">6.2ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%EF%BC%8C%E5%85%B7%E4%BD%93%E4%BE%8B%E5%AD%90"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">6.3ï¼Œå…·ä½“ä¾‹å­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4%EF%BC%8C%E7%B1%BB%E7%9A%84%E5%8D%B8%E8%BD%BD"><span class="toc-number">2.3.6.4.</span> <span class="toc-text">6.4ï¼Œç±»çš„å¸è½½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BE%EF%BC%9A%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">2.3.7.</span> <span class="toc-text">å›é¡¾ï¼šæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E5%86%8D%E8%B0%88%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text">å››ï¼Œå†è°ˆç±»çš„åŠ è½½å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%A6%82%E8%BF%B0-2"><span class="toc-number">2.4.1.</span> <span class="toc-text">1ï¼Œæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">1.1ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">1.2ï¼Œç±»åŠ è½½å™¨çš„å¿…è¦æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">1.3ï¼Œå‘½åç©ºé—´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E5%BE%81"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">1.4ï¼Œç±»åŠ è½½æœºåˆ¶çš„åŸºæœ¬ç‰¹å¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5%EF%BC%8C%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.4.1.5.</span> <span class="toc-text">1.5ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB"><span class="toc-number">2.4.2.</span> <span class="toc-text">2ï¼Œç±»çš„åŠ è½½å™¨åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%8C%E5%BC%95%E5%AF%BC%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">2.1ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%8C%E6%89%A9%E5%B1%95%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">2.2ï¼Œæ‰©å±•ç±»åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%8C%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">2.3ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%8C%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.2.4.</span> <span class="toc-text">2.4ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E6%B5%8B%E8%AF%95%E4%B8%8D%E5%90%8C%E7%9A%84%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.3.</span> <span class="toc-text">3ï¼Œæµ‹è¯•ä¸åŒçš„ç±»çš„åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8CClassLoader%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">2.4.4.</span> <span class="toc-text">4ï¼ŒClassLoaderæºç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%8CClassLoader%E7%9A%84%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">4.1ï¼ŒClassLoaderçš„ä¸»è¦æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%8CSecureClassLoader%E4%B8%8EURLClassLoader"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">4.2ï¼ŒSecureClassLoaderä¸URLClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%8CExtClassLoader%E4%B8%8EAppClassLoader"><span class="toc-number">2.4.4.3.</span> <span class="toc-text">4.3ï¼ŒExtClassLoaderä¸AppClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4%EF%BC%8CClass-forName-%E4%B8%8EClassLoader-loadClass"><span class="toc-number">2.4.4.4.</span> <span class="toc-text">4.4ï¼ŒClass.forName()ä¸ClassLoader.loadClass()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.4.5.</span> <span class="toc-text">5ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%8E%E6%9C%AC%E8%B4%A8"><span class="toc-number">2.4.5.1.</span> <span class="toc-text">5.1ï¼Œå®šä¹‰ä¸æœ¬è´¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%8C%E4%BC%98%E5%8A%BF%E4%B8%8E%E5%8A%A3%E5%8A%BF"><span class="toc-number">2.4.5.2.</span> <span class="toc-text">5.2ï¼Œä¼˜åŠ¿ä¸åŠ£åŠ¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%EF%BC%8C%E7%A0%B4%E5%9D%8F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">2.4.5.3.</span> <span class="toc-text">5.3ï¼Œç ´ååŒäº²å§”æ´¾æœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4%EF%BC%8C%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.4.5.4.</span> <span class="toc-text">5.4ï¼Œçƒ­æ›¿æ¢çš„å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E6%B2%99%E7%AE%B1%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">2.4.6.</span> <span class="toc-text">6ï¼Œæ²™ç®±å®‰å…¨æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%8CJDK1-0%E6%97%B6%E6%9C%9F"><span class="toc-number">2.4.6.1.</span> <span class="toc-text">6.1ï¼ŒJDK1.0æ—¶æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%8CJDK1-1%E6%97%B6%E6%9C%9F"><span class="toc-number">2.4.6.2.</span> <span class="toc-text">6.2ï¼ŒJDK1.1æ—¶æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%EF%BC%8CJDK1-2%E6%97%B6%E6%9C%9F"><span class="toc-number">2.4.6.3.</span> <span class="toc-text">6.3ï¼ŒJDK1.2æ—¶æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4%EF%BC%8CJDK1-6%E6%97%B6%E6%9C%9F"><span class="toc-number">2.4.6.4.</span> <span class="toc-text">6.4ï¼ŒJDK1.6æ—¶æœŸ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.4.7.</span> <span class="toc-text">7ï¼Œè‡ªå®šä¹‰ç±»çš„åŠ è½½å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%9F"><span class="toc-number">2.4.7.1.</span> <span class="toc-text">7.1ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">2.4.7.2.</span> <span class="toc-text">7.2ï¼Œå®ç°æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8CJava9%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">2.4.8.</span> <span class="toc-text">8ï¼ŒJava9æ–°ç‰¹æ€§</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E4%BC%98"><span class="toc-number">3.</span> <span class="toc-text">æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8C%E6%A6%82%E8%BF%B0%E7%AF%87"><span class="toc-number">3.1.</span> <span class="toc-text">ä¸€ï¼Œæ¦‚è¿°ç¯‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">3.1.1.</span> <span class="toc-text">1ï¼Œå¤§å‚é¢è¯•é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">3.1.2.</span> <span class="toc-text">2ï¼ŒèƒŒæ™¯è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E8%B0%83%E4%BC%98%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.3.</span> <span class="toc-text">3ï¼Œè°ƒä¼˜æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-number">3.1.4.</span> <span class="toc-text">4ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E6%80%A7%E8%83%BD%E8%AF%84%E4%BB%B7-%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87"><span class="toc-number">3.1.5.</span> <span class="toc-text">5ï¼Œæ€§èƒ½è¯„ä»·&#x2F;æµ‹è¯•æŒ‡æ ‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8CJVM%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7-%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AF%87"><span class="toc-number">3.2.</span> <span class="toc-text">äºŒï¼ŒJVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E6%A6%82%E8%BF%B0-3"><span class="toc-number">3.2.1.</span> <span class="toc-text">1ï¼Œæ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8Cjps%EF%BC%9A%E6%9F%A5%E7%9C%8B%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84Java%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">2ï¼Œjpsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8Cjstat%EF%BC%9A%E6%9F%A5%E7%9C%8BJVM%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.3.</span> <span class="toc-text">3ï¼Œjstatï¼šæŸ¥çœ‹JVMç»Ÿè®¡ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8Cjinfo%EF%BC%9A%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E5%92%8C%E4%BF%AE%E6%94%B9JVM%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.4.</span> <span class="toc-text">4ï¼Œjinfoï¼šå®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹JVMé…ç½®å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8Cjmap%EF%BC%9A%E5%AF%BC%E5%87%BA%E5%86%85%E5%AD%98%E6%98%A0%E5%83%8F%E6%96%87%E4%BB%B6-amp-%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-number">3.2.5.</span> <span class="toc-text">5ï¼Œjmapï¼šå¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶&amp;å†…å­˜ä½¿ç”¨æƒ…å†µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8Cjhat%EF%BC%9AJDK%E8%87%AA%E5%B8%A6%E5%A0%86%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">3.2.6.</span> <span class="toc-text">6ï¼Œjhatï¼šJDKè‡ªå¸¦å †åˆ†æå·¥å…·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8Cjstack%EF%BC%9A%E6%89%93%E5%8D%B0JVM%E4%B8%AD%E7%BA%BF%E7%A8%8B%E5%BF%AB%E7%85%A7"><span class="toc-number">3.2.7.</span> <span class="toc-text">7ï¼Œjstackï¼šæ‰“å°JVMä¸­çº¿ç¨‹å¿«ç…§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8Cjcmd%EF%BC%9A%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">3.2.8.</span> <span class="toc-text">8ï¼Œjcmdï¼šå¤šåŠŸèƒ½å‘½ä»¤è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8Cjstatd%EF%BC%9A%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.2.9.</span> <span class="toc-text">9ï¼Œjstatdï¼šè¿œç¨‹ä¸»æœºä¿¡æ¯æ”¶é›†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C-JVM%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7-GUI%E7%AF%87"><span class="toc-number">3.3.</span> <span class="toc-text">ä¸‰ï¼Œ JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E5%B7%A5%E5%85%B7%E6%A6%82%E8%BF%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">1ï¼Œå·¥å…·æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CJConsole"><span class="toc-number">3.3.2.</span> <span class="toc-text">2ï¼ŒJConsole</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CVisual-VM"><span class="toc-number">3.3.3.</span> <span class="toc-text">3ï¼ŒVisual VM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8CEclipse-MAT"><span class="toc-number">3.3.4.</span> <span class="toc-text">4ï¼ŒEclipse MAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8CJProfiler"><span class="toc-number">3.3.5.</span> <span class="toc-text">5ï¼ŒJProfiler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8CArthas"><span class="toc-number">3.3.6.</span> <span class="toc-text">6ï¼ŒArthas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8CJava-Misssion-Control"><span class="toc-number">3.3.7.</span> <span class="toc-text">7ï¼ŒJava Misssion Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8C%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"><span class="toc-number">3.3.8.</span> <span class="toc-text">8ï¼Œå…¶ä»–å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C-JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">å››ï¼Œ JVMè¿è¡Œæ—¶å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C-JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.1.</span> <span class="toc-text">1ï¼Œ JVMè¿è¡Œæ—¶å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%8C%E7%B1%BB%E5%9E%8B%E4%B8%80%EF%BC%9A%E6%A0%87%E5%87%86%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">1.1ï¼Œç±»å‹ä¸€ï¼šæ ‡å‡†å‚æ•°é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%8C%E7%B1%BB%E5%9E%8B%E4%BA%8C%EF%BC%9A-X%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">1.2ï¼Œç±»å‹äºŒï¼š-Xå‚æ•°é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%8C%E7%B1%BB%E5%9E%8B%E4%B8%89%EF%BC%9A-XX%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.1.3.</span> <span class="toc-text">1.3ï¼Œç±»å‹ä¸‰ï¼š-XXå‚æ•°é€‰é¡¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E6%B7%BB%E5%8A%A0JVM%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.2.</span> <span class="toc-text">2ï¼Œæ·»åŠ JVMå‚æ•°é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E5%B8%B8%E7%94%A8%E7%9A%84JVM%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.3.</span> <span class="toc-text">3ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%EF%BC%8C%E5%B8%B8%E7%94%A8%E7%9A%84JVM%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">3.1ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%EF%BC%8C%E5%A0%86%E3%80%81%E6%A0%88%E3%80%81%E6%96%B9%E6%B3%95%E5%8C%BA%E7%AD%89%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">3.2ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%EF%BC%8COutOfMemory%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.3.3.</span> <span class="toc-text">3.3ï¼ŒOutOfMemoryç›¸å…³çš„é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%EF%BC%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.3.4.</span> <span class="toc-text">3.4ï¼Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%EF%BC%8CGC%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.3.5.</span> <span class="toc-text">3.5ï¼ŒGCæ—¥å¿—ç›¸å…³é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%EF%BC%8C%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.3.6.</span> <span class="toc-text">3.6ï¼Œå…¶ä»–å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E9%80%9A%E8%BF%87Java%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%8F%96JVM%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.4.</span> <span class="toc-text">4ï¼Œé€šè¿‡Javaä»£ç è·å–JVMå‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C-%E5%88%86%E6%9E%90GC%E6%97%A5%E5%BF%97"><span class="toc-number">3.5.</span> <span class="toc-text">äº”ï¼Œ åˆ†æGCæ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CGC%E5%88%86%E7%B1%BB"><span class="toc-number">3.5.1.</span> <span class="toc-text">1ï¼ŒGCåˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CGC%E6%97%A5%E5%BF%97%E5%88%86%E7%B1%BB"><span class="toc-number">3.5.2.</span> <span class="toc-text">2ï¼ŒGCæ—¥å¿—åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CGC%E6%97%A5%E5%BF%97%E7%BB%93%E6%9E%84%E5%89%96%E6%9E%90"><span class="toc-number">3.5.3.</span> <span class="toc-text">3ï¼ŒGCæ—¥å¿—ç»“æ„å‰–æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C-GC%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">3.5.4.</span> <span class="toc-text">4ï¼Œ GCæ—¥å¿—åˆ†æå·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9A%E6%B5%85%E5%A0%86%E6%B7%B1%E5%A0%86%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">3.6.</span> <span class="toc-text">è¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8C%E8%A1%A5%E5%85%85%EF%BC%9A%E6%B5%85%E5%A0%86%E6%B7%B1%E5%A0%86%E4%B8%8E%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">3.6.1.</span> <span class="toc-text">1ï¼Œè¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8C%E4%BF%9D%E7%95%99%E9%9B%86%EF%BC%88Retained-Set%EF%BC%89"><span class="toc-number">3.6.2.</span> <span class="toc-text">2ï¼Œä¿ç•™é›†ï¼ˆRetained Setï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8C%E6%B7%B1%E5%A0%86%EF%BC%88Retained-Heap%EF%BC%89"><span class="toc-number">3.6.3.</span> <span class="toc-text">3ï¼Œæ·±å †ï¼ˆRetained Heapï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E9%99%85%E5%A4%A7%E5%B0%8F"><span class="toc-number">3.6.4.</span> <span class="toc-text">4ï¼Œå¯¹è±¡çš„å®é™…å¤§å°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%8C%E6%94%AF%E9%85%8D%E6%A0%91%EF%BC%88Dominator-Tree%EF%BC%89"><span class="toc-number">3.6.5.</span> <span class="toc-text">5ï¼Œæ”¯é…æ ‘ï¼ˆDominator Treeï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%8C%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%88memory-leak%EF%BC%89"><span class="toc-number">3.6.6.</span> <span class="toc-text">6ï¼Œå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%8C%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%88out-of-memory%EF%BC%89"><span class="toc-number">3.6.7.</span> <span class="toc-text">7ï¼Œå†…å­˜æº¢å‡ºï¼ˆout of memoryï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%8CJava%E4%B8%AD%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E7%9A%848%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">3.6.8.</span> <span class="toc-text">8ï¼ŒJavaä¸­å†…å­˜æ³„éœ²çš„8ç§æƒ…å†µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%8C%E9%9D%99%E6%80%81%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-number">3.6.8.1.</span> <span class="toc-text">8.1ï¼Œé™æ€é›†åˆç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%8C%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.6.8.2.</span> <span class="toc-text">8.2ï¼Œå•ä¾‹æ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3%EF%BC%8C%E5%86%85%E9%83%A8%E7%B1%BB%E6%8C%81%E6%9C%89%E5%A4%96%E9%83%A8%E7%B1%BB"><span class="toc-number">3.6.8.3.</span> <span class="toc-text">8.3ï¼Œå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4%EF%BC%8C%E5%90%84%E7%A7%8D%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%A6%82%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E3%80%81%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E5%92%8CIO%E8%BF%9E%E6%8E%A5%E7%AD%89"><span class="toc-number">3.6.8.4.</span> <span class="toc-text">8.4ï¼Œå„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5%EF%BC%8C%E5%8F%98%E9%87%8F%E4%B8%8D%E5%90%88%E7%90%86%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">3.6.8.5.</span> <span class="toc-text">8.5ï¼Œå˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6%EF%BC%8C%E6%94%B9%E5%8F%98%E5%93%88%E5%B8%8C%E5%80%BC"><span class="toc-number">3.6.8.6.</span> <span class="toc-text">8.6ï¼Œæ”¹å˜å“ˆå¸Œå€¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7%EF%BC%8C%E7%BC%93%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-number">3.6.8.7.</span> <span class="toc-text">8.7ï¼Œç¼“å­˜æ³„éœ²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%99%A8%E5%92%8C%E5%85%B6%E4%BB%96%E5%9B%9E%E8%B0%83"><span class="toc-number">3.6.8.8.</span> <span class="toc-text">8.8ï¼Œç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%8C%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">3.6.9.</span> <span class="toc-text">9ï¼Œå†…å­˜æ³„éœ²æ¡ˆä¾‹åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9A%E4%BD%BF%E7%94%A8OQL%E8%AF%AD%E8%A8%80%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">3.7.</span> <span class="toc-text">è¡¥å……ï¼šä½¿ç”¨OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8CSELECT%E5%AD%90%E5%8F%A5"><span class="toc-number">3.7.1.</span> <span class="toc-text">1ï¼ŒSELECTå­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8CFROM%E5%AD%90%E5%8F%A5"><span class="toc-number">3.7.2.</span> <span class="toc-text">2ï¼ŒFROMå­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8CWHERE%E5%AD%90%E5%8F%A5"><span class="toc-number">3.7.3.</span> <span class="toc-text">3ï¼ŒWHEREå­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%8C%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">3.7.4.</span> <span class="toc-text">4ï¼Œå†…ç½®å¯¹è±¡ä¸æ–¹æ³•</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2022/04/18/JVM/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ç¿”ä»”"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ç¿”ä»”çš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">JVM</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-18 17:24:33" itemprop="dateCreated datePublished" datetime="2022-04-18T17:24:33+08:00">2022-04-18</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%90%8E%E7%AB%AF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">åç«¯</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Jvm/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Jvm</span></a></span></div><div class="post-author"><span class="author-name">ç¿”ä»”</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡"><a href="#JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡" class="headerlink" title="JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡"></a>JVMå†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡</h1><h2 id="ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„"><a href="#ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„" class="headerlink" title="ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„"></a>ä¸€ï¼ŒJVMä¸Javaä½“ç³»ç»“æ„</h2><h3 id="1ï¼Œå‰è¨€"><a href="#1ï¼Œå‰è¨€" class="headerlink" title="1ï¼Œå‰è¨€"></a>1ï¼Œå‰è¨€</h3><p>ä½œä¸ºJavaå·¥ç¨‹å¸ˆçš„ä½ æ›¾è¢«ä¼¤å®³è¿‡å—ï¼Ÿä½ æ˜¯å¦ä¹Ÿé‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Ÿ</p>
<ul>
<li><p>è¿è¡Œç€çš„çº¿ä¸Šç³»ç»Ÿçªç„¶å¡æ­»ï¼Œç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œç”šè‡³ç›´æ¥OOM</p>
</li>
<li><p>æƒ³è§£å†³çº¿ä¸ŠJVM GCé—®é¢˜ï¼Œä½†å´æ— ä»ä¸‹æ‰‹</p>
</li>
<li><p>æ–°é¡¹ç›®ä¸Šçº¿ï¼Œå¯¹å„ç§JVMå‚æ•°è®¾ç½®ä¸€è„¸èŒ«ç„¶ï¼Œç›´æ¥é»˜è®¤å§ç„¶åå°±JJäº†</p>
</li>
<li><p>æ¯æ¬¡é¢è¯•ä¹‹å‰éƒ½è¦é‡æ–°èƒŒä¸€éJVMçš„ä¸€äº›åŸç†æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œç„¶è€Œé¢è¯•å®˜å´ç»å¸¸é—®ä½ åœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•è°ƒä¼˜VMå‚æ•°ï¼Œå¦‚ä½•è§£å†³GCã€OOMç­‰é—®é¢˜ï¼Œä¸€è„¸æ‡µé€¼</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220126175404886.png" alt="image-20220126175404886" loading="lazy"></p>
<p>æˆ‘ä»¬å¤§éƒ¨åˆ†çš„ç¨‹åºå‘˜éƒ½åªç”¨ä¸Šå±‚çš„ä¸€äº›æŠ€æœ¯ï¼Œå¯ä»¥ç†Ÿç»ƒçš„ä½¿ç”¨å„ç§æ¡†æ¶ï¼Œä½†æ˜¯å¯¹äºJavaçš„æ ¸å¿ƒJavaè™šæ‹Ÿæœºäº†è§£ç”šå°‘ã€‚å› ä¸ºå¾ˆå¤šäººè®¤ä¸ºåªæœ‰ä¸Šå±‚çš„æŠ€æœ¯æ‰æ˜¯æˆ‘ä»¬åº”è¯¥ç ”ç©¶å’Œé’»ç ”çš„ï¼Œå¯¹äºåº•å±‚çš„å®ç°å¹¶ä¸åœ¨ä¹ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§å¿«èŠ‚å¥ç¤¾ä¼šçš„ä¸€ç§ç—…æ€ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠæ ¸å¿ƒç±»åº“çš„APIæ¯”åšæ•°å­¦å…¬å¼çš„è¯ï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºçš„çŸ¥è¯†å°±å¥½æ¯”å…¬å¼çš„æ¨å¯¼è¿‡ç¨‹ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220126175758829.png" alt="image-20220126175758829" loading="lazy"></p>
<p>è®¡ç®—æœºç³»ç»Ÿä½“ç³»å¯¹æˆ‘ä»¬æ¥è¯´è¶Šæ¥è¶Šè¿œï¼Œåœ¨ä¸äº†è§£åº•å±‚å®ç°æ–¹å¼çš„å‰æä¸‹ï¼Œé€šè¿‡é«˜çº§è¯­è¨€å¾ˆå®¹æ˜“ç¼–å†™ç¨‹åºä»£ç ã€‚ä½†äº‹å®ä¸Šè®¡ç®—æœºå¹¶ä¸è®¤è¯†é«˜çº§è¯­è¨€ã€‚</p>
<p><strong>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ JVMï¼Ÿ</strong></p>
<ul>
<li><p>é¢è¯•çš„éœ€è¦ï¼ˆBATJã€TMDï¼ŒPKQç­‰é¢è¯•éƒ½çˆ±é—®ï¼‰</p>
</li>
<li><p>ä¸­é«˜çº§ç¨‹åºå‘˜å¿…å¤‡æŠ€èƒ½</p>
<ul>
<li>é¡¹ç›®ç®¡ç†ã€è°ƒä¼˜çš„éœ€æ±‚</li>
</ul>
</li>
<li><p>è¿½æ±‚æå®¢çš„ç²¾ç¥</p>
<ul>
<li>æ¯”å¦‚ï¼šåƒåœ¾å›æ”¶ç®—æ³•ã€JITã€åº•å±‚åŸç†</li>
</ul>
</li>
</ul>
<p><strong>Java vs C++</strong></p>
<p><img src="/2022/04/18/JVM/image-20220126175910101.png" alt="image-20220126175910101" loading="lazy"></p>
<p>å®ƒä»¬éƒ½æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå…¶æœ€å¤§çš„ä¸åŒåœ¨äºJavaæ˜¯å› ä¸ºæœ‰è™šæ‹Ÿæœºçš„ç¼˜æ•…ï¼Œä»–æ˜¯åŠ¨<strong>æ€çš„åˆ†é…å†…å­˜ï¼Œæœ‰ç€åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºå’Œåˆ é™¤å†…å­˜ã€‚æå¤§çš„èŠ‚çº¦äº†æˆ‘ä»¬å¼€å‘çš„æ•ˆç‡ã€‚</strong>ä½†æ˜¯ç”±äºåƒåœ¾å›æ”¶æœºåˆ¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€äº›å¤§å‹é¡¹ç›®ä¸­ï¼Œå¿…é¡»è¦äº†è§£JVMå†…éƒ¨çš„ç»“æ„ï¼Œå·¥ä½œæœºåˆ¶ï¼Œæ‰èƒ½è®¾è®¡å‡ºé«˜æ‰©å±•æ€§åº”ç”¨ä»¥åŠå‡ºç°é—®é¢˜æ˜¯å¯ä»¥åŠæ—¶è§£å†³ã€‚</p>
<h3 id="2ï¼ŒJavaåŠJVMç®€ä»‹"><a href="#2ï¼ŒJavaåŠJVMç®€ä»‹" class="headerlink" title="2ï¼ŒJavaåŠJVMç®€ä»‹"></a>2ï¼ŒJavaåŠJVMç®€ä»‹</h3><p><strong>TIOBEè¯­è¨€çƒ­åº¦æ’è¡Œæ¦œï¼š</strong><a target="_blank" rel="noopener" href="https://tiobe.com/tiobe-index/"><strong>index | TIOBE - The Software Quality Company</strong></a></p>
<p><img src="/2022/04/18/JVM/image-20220127100548653.png" alt="image-20220127100548653" loading="lazy"></p>
<hr>
<p><strong>JVMï¼šè·¨è¯­è¨€çš„å¹³å°</strong></p>
<p>Javaæ˜¯ç›®å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„è½¯ä»¶å¼€å‘å¹³å°ä¹‹ä¸€ã€‚éšç€Javaä»¥åŠJavaç¤¾åŒºçš„ä¸æ–­å£®å¤§Java ä¹Ÿæ—©å·²ä¸å†æ˜¯ç®€ç®€å•å•çš„ä¸€é—¨è®¡ç®—æœºè¯­è¨€äº†ï¼Œå®ƒæ›´æ˜¯ä¸€ä¸ªå¹³å°ã€ä¸€ç§æ–‡åŒ–ã€ä¸€ä¸ªç¤¾åŒºã€‚</p>
<ul>
<li><p>ä½œä¸ºä¸€ä¸ªå¹³å°ï¼ŒJavaè™šæ‹Ÿæœºæ‰®æ¼”ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨</p>
<ul>
<li>Groovyã€Scalaã€JRubyã€Kotlinç­‰éƒ½æ˜¯Javaå¹³å°çš„ä¸€éƒ¨åˆ†</li>
</ul>
</li>
<li><p>ä½œä¸ºç¯ç§æ–‡åŒ–ï¼ŒJavaå‡ ä¹æˆä¸ºäº†â€œå¼€æºâ€çš„ä»£åè¯ã€‚</p>
<ul>
<li><p>ç¬¬ä¸‰æ–¹å¼€æºè½¯ä»¶å’Œæ¡†æ¶ã€‚å¦‚Tomcatã€Strutsï¼ŒMyBatisï¼ŒSpringç­‰ã€‚</p>
</li>
<li><p>å°±è¿JDKå’ŒJVMè‡ªèº«ä¹Ÿæœ‰ä¸å°‘å¼€æºçš„å®ç°ï¼Œå¦‚openJDKã€Harmonyã€‚</p>
</li>
</ul>
</li>
<li><p>ä½œä¸ºä¸€ä¸ªç¤¾åŒºï¼ŒJavaæ‹¥æœ‰å…¨ä¸–ç•Œæœ€å¤šçš„æŠ€æœ¯æ‹¥æŠ¤è€…å’Œå¼€æºç¤¾åŒºæ”¯æŒï¼Œæœ‰æ•°ä¸æ¸…çš„è®ºå›å’Œèµ„æ–™ã€‚ä»æ¡Œé¢åº”ç”¨è½¯ä»¶ã€åµŒå…¥å¼å¼€å‘åˆ°ä¼ä¸šçº§åº”ç”¨ã€åå°æœåŠ¡å™¨ã€ä¸­é—´ä»¶ï¼Œéƒ½å¯ä»¥çœ‹åˆ°Javaçš„èº«å½±ã€‚å…¶åº”ç”¨å½¢å¼ä¹‹å¤æ‚ã€å‚ä¸äººæ•°ä¹‹ä¼—å¤šä¹Ÿä»¤äººå’‹èˆŒã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220127101027131.png" alt="image-20220127101027131" loading="lazy"></p>
<p>æ¯ä¸ªè¯­è¨€éƒ½éœ€è¦è½¬æ¢æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œæœ€åè½¬æ¢çš„å­—èŠ‚ç æ–‡ä»¶éƒ½èƒ½é€šè¿‡Javaè™šæ‹Ÿæœºè¿›è¡Œè¿è¡Œå’Œå¤„ç†</p>
<p><img src="/2022/04/18/JVM/image-20220127101050057.png" alt="image-20220127101050057" loading="lazy"></p>
<ul>
<li><p>éšç€Java7çš„æ­£å¼å‘å¸ƒï¼ŒJavaè™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬<strong>é€šè¿‡JSR-292è§„èŒƒåŸºæœ¬å®ç°åœ¨Javaè™šæ‹Ÿæœºå¹³å°ä¸Šè¿è¡ŒéJavaè¯­è¨€ç¼–å†™çš„ç¨‹åºã€‚</strong></p>
</li>
<li><p><strong>Javaè™šæ‹Ÿæœºæ ¹æœ¬ä¸å…³å¿ƒè¿è¡Œåœ¨å…¶å†…éƒ¨çš„ç¨‹åºåˆ°åº•æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå®ƒåªå…³å¿ƒâ€œå­—èŠ‚ç â€æ–‡ä»¶ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´Javaè™šæ‹Ÿæœºæ‹¥æœ‰è¯­è¨€æ— å…³æ€§ï¼Œå¹¶ä¸ä¼šå•çº¯åœ°ä¸Javaè¯­è¨€â€œç»ˆèº«ç»‘å®šâ€ï¼Œåªè¦å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘ç»“æœæ»¡è¶³å¹¶åŒ…å«Javaè™šæ‹Ÿæœºçš„å†…éƒ¨æŒ‡ä»¤é›†ã€ç¬¦å·è¡¨ä»¥åŠå…¶ä»–çš„è¾…åŠ©ä¿¡æ¯ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå°±èƒ½å¤Ÿè¢«è™šæ‹Ÿæœºæ‰€è¯†åˆ«å¹¶è£…è½½è¿è¡Œã€‚</p>
</li>
<li><p>å› æ­¤Javaè™šæ‹Ÿæœºè¢«ç§°ä¸ºæœ€å¼ºå¤§çš„è™šæ‹Ÿæœºã€‚</p>
</li>
</ul>
<hr>
<p><strong>å­—èŠ‚ç </strong></p>
<ul>
<li><p>æˆ‘ä»¬å¹³æ—¶è¯´çš„<strong>javaå­—èŠ‚ç </strong>ï¼ŒæŒ‡çš„æ˜¯ç”¨<strong>javaè¯­è¨€ç¼–è¯‘æˆçš„å­—èŠ‚ç </strong>ã€‚å‡†ç¡®çš„è¯´ä»»ä½•èƒ½åœ¨jvmå¹³å°ä¸Šæ‰§è¡Œçš„å­—èŠ‚ç æ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥åº”è¯¥ç»Ÿç§°ä¸ºï¼š<strong>jvmå­—èŠ‚ç </strong>ã€‚</p>
</li>
<li><p>ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥ç¼–è¯‘å‡ºç›¸åŒçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå­—èŠ‚ç æ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„JVMä¸Šè¿è¡Œã€‚</p>
</li>
<li><p>Javaè™šæ‹Ÿæœºä¸Javaè¯­è¨€å¹¶æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œå®ƒåªä¸ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼â€”Classæ–‡ä»¶æ ¼å¼æ‰€å…³è”ï¼ŒClassæ–‡ä»¶ä¸­åŒ…å«äº†Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†ï¼ˆæˆ–è€…ç§°ä¸ºå­—èŠ‚ç ã€Bytecodesï¼‰å’Œç¬¦å·è¡¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p>
</li>
</ul>
<hr>
<p><strong>å¤šè¯­è¨€æ··åˆç¼–ç¨‹</strong></p>
<ul>
<li><p>Javaå¹³å°ä¸Šçš„å¤šè¯­è¨€æ··åˆç¼–ç¨‹æ­£æˆä¸ºä¸»æµï¼Œé€šè¿‡ç‰¹å®šé¢†åŸŸçš„è¯­è¨€å»è§£å†³ç‰¹å®šé¢†åŸŸçš„é—®é¢˜æ˜¯å½“å‰è½¯ä»¶å¼€å‘åº”å¯¹æ—¥è¶‹å¤æ‚çš„é¡¹ç›®éœ€æ±‚çš„ä¸€ä¸ªæ–¹å‘ã€‚</p>
</li>
<li><p>è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¹‹ä¸­ï¼Œå¹¶è¡Œå¤„ç†ç”¨Clojureè¯­è¨€ç¼–å†™ï¼Œå±•ç¤ºå±‚ä½¿ç”¨JRuby/Railsï¼Œä¸­é—´å±‚åˆ™æ˜¯Javaï¼Œæ¯ä¸ªåº”ç”¨å±‚éƒ½å°†ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥å®Œæˆï¼Œè€Œä¸”ï¼Œæ¥å£å¯¹æ¯ä¸€å±‚çš„å¼€å‘è€…éƒ½æ˜¯é€æ˜çš„ï¼Œå„ç§è¯­è¨€ä¹‹é—´çš„äº¤äº’ä¸å­˜åœ¨ä»»ä½•å›°éš¾ï¼Œå°±åƒä½¿ç”¨è‡ªå·±è¯­è¨€çš„åŸç”ŸAPIä¸€æ ·æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä»¬æœ€ç»ˆéƒ½è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¹‹ä¸Šã€‚</p>
</li>
<li><p>å¯¹è¿™äº›è¿è¡ŒäºJavaè™šæ‹Ÿæœºä¹‹ä¸Šã€Javaä¹‹å¤–çš„è¯­è¨€ï¼Œæ¥è‡ªç³»ç»Ÿçº§çš„ã€åº•å±‚çš„æ”¯æŒæ­£åœ¨è¿…é€Ÿå¢å¼ºï¼Œä»¥JSR-292ä¸ºæ ¸å¿ƒçš„ä¸€ç³»åˆ—é¡¹ç›®å’ŒåŠŸèƒ½æ”¹è¿›ï¼ˆå¦‚Da Vinci Machineé¡¹ç›®ã€Nashornå¼•æ“ã€InvokeDynamicæŒ‡ä»¤ã€java.lang.invokeåŒ…ç­‰ï¼‰ï¼Œæ¨åŠ¨Javaè™šæ‹Ÿæœºä»â€œJavaè¯­è¨€çš„è™šæ‹Ÿæœºâ€å‘ â€œå¤šè¯­è¨€è™šæ‹Ÿæœºâ€çš„æ–¹å‘å‘å±•ã€‚</p>
</li>
<li><p>è¿™ä¹Ÿå°±æ˜¯Javaæ¯”è¾ƒç«çš„åŸå› ä¹‹ä¸€ï¼Œç°åœ¨å¾ˆå¤šé¡¹ç›®éƒ½æ˜¯å¾®æœåŠ¡ï¼ŒSpringCloudå°†è¿™ç§å¤šè¯­è¨€ç¼–ç¨‹çš„æ€ç»´å‘æŒ¥åˆ°äº†æè‡´ã€‚</p>
</li>
</ul>
<hr>
<h3 id="3ï¼Œ-Javaå‘å±•çš„é‡å¤§äº‹ä»¶"><a href="#3ï¼Œ-Javaå‘å±•çš„é‡å¤§äº‹ä»¶" class="headerlink" title="3ï¼Œ Javaå‘å±•çš„é‡å¤§äº‹ä»¶"></a>3ï¼Œ Javaå‘å±•çš„é‡å¤§äº‹ä»¶</h3><ul>
<li><p>1990å¹´ï¼Œåœ¨Sunè®¡ç®—æœºå…¬å¸ä¸­ï¼Œç”±Patrick Naughtonã€MikeSheridanåŠJames Goslingé¢†å¯¼çš„å°ç»„Green Teamï¼Œå¼€å‘å‡ºçš„æ–°çš„ç¨‹åºè¯­è¨€ï¼Œå‘½åä¸ºoakï¼ŒåæœŸå‘½åä¸ºJava</p>
</li>
<li><p>1995å¹´ï¼ŒSunæ­£å¼å‘å¸ƒJavaå’ŒHotJavaäº§å“ï¼ŒJavaé¦–æ¬¡å…¬å¼€äº®ç›¸ã€‚</p>
</li>
<li><p>1996å¹´1æœˆ23æ—¥ï¼ŒSun Microsystemså‘å¸ƒäº†JDK 1.0ã€‚</p>
</li>
<li><p>1998å¹´ï¼ŒJDK1.2ç‰ˆæœ¬å‘å¸ƒã€‚åŒæ—¶ï¼Œsunå‘å¸ƒäº†JSP/Servletã€EJBè§„èŒƒï¼Œä»¥åŠå°†Javaåˆ†æˆäº†J2EEã€J2SEå’ŒJ2MEã€‚è¿™è¡¨æ˜äº†Javaå¼€å§‹å‘ä¼ä¸šã€æ¡Œé¢åº”ç”¨å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨3å¤§é¢†åŸŸæŒºè¿›ã€‚</p>
</li>
<li><p>2000å¹´ï¼ŒJDK1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaçš„é»˜è®¤è™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2002å¹´ï¼ŒJDK1.4å‘å¸ƒï¼Œå¤è€çš„Classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚</p>
</li>
<li><p>2003å¹´å¹´åº•ï¼ŒJavaå¹³å°çš„Scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº†Javaé˜µè¥ã€‚</p>
</li>
<li><p>2004å¹´ï¼ŒJDK1.5å‘å¸ƒã€‚åŒæ—¶JDK1.5æ”¹åä¸ºJavaSE5.0ã€‚</p>
</li>
<li><p>2006å¹´ï¼ŒJDK6å‘å¸ƒã€‚åŒå¹´ï¼ŒJavaå¼€æºå¹¶å»ºç«‹äº†OpenJDKã€‚é¡ºç†æˆç« ï¼ŒHotspotè™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº†openJDKä¸­çš„é»˜è®¤è™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2007å¹´ï¼ŒJavaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚</p>
</li>
<li><p>2008å¹´ï¼ŒOracleæ”¶è´­äº†BEAï¼Œå¾—åˆ°äº†JRockitè™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2009å¹´ï¼ŒTwitterå®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä»Rubyè¿ç§»åˆ°Scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚</p>
</li>
<li><p>2010å¹´ï¼ŒOracleæ”¶è´­äº†Sunï¼Œè·å¾—Javaå•†æ ‡å’Œæœ€çœŸä»·å€¼çš„HotSpotè™šæ‹Ÿæœºã€‚æ­¤æ—¶ï¼ŒOracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpotå’ŒJRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼šHotRockit</p>
</li>
<li><p>2011å¹´ï¼ŒJDK7å‘å¸ƒã€‚åœ¨JDK1.7u4ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1ã€‚</p>
</li>
<li><p>2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚å°†G1è®¾ç½®ä¸ºé»˜è®¤Gcï¼Œæ›¿ä»£CMS</p>
</li>
<li><p>åŒå¹´ï¼ŒIBMçš„J9å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„Open J9ç¤¾åŒº</p>
</li>
<li><p>2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleèµ”å¿Oracleè®¡88äº¿ç¾å…ƒ</p>
</li>
<li><p>åŒå¹´ï¼ŒOracleå®£å‘ŠJavaEEæˆä¸ºå†å²åè¯JDBCã€JMSã€Servletèµ äºˆEclipseåŸºé‡‘ä¼š</p>
</li>
<li><p>åŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDKï¼Œå‘å¸ƒé©å‘½æ€§çš„ZGCï¼Œè°ƒæ•´JDKæˆæƒè®¸å¯</p>
</li>
<li><p>2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„shenandoah GC</p>
</li>
<li><p>1990å¹´ï¼Œåœ¨Sunè®¡ç®—æœºå…¬å¸ä¸­ï¼Œç”±Patrick Naughtonã€MikeSheridanåŠJames Goslingé¢†å¯¼çš„å°ç»„Green Teamï¼Œå¼€å‘å‡ºçš„æ–°çš„ç¨‹åºè¯­è¨€ï¼Œå‘½åä¸ºoakï¼ŒåæœŸå‘½åä¸ºJava</p>
</li>
<li><p>1995å¹´ï¼ŒSunæ­£å¼å‘å¸ƒJavaå’ŒHotJavaäº§å“ï¼ŒJavaé¦–æ¬¡å…¬å¼€äº®ç›¸ã€‚</p>
</li>
<li><p>1996å¹´1æœˆ23æ—¥ï¼ŒSun Microsystemså‘å¸ƒäº†JDK 1.0ã€‚</p>
</li>
<li><p>1998å¹´ï¼ŒJDK1.2ç‰ˆæœ¬å‘å¸ƒã€‚åŒæ—¶ï¼Œsunå‘å¸ƒäº†JSP/Servletã€EJBè§„èŒƒï¼Œä»¥åŠå°†Javaåˆ†æˆäº†J2EEã€J2SEå’ŒJ2MEã€‚è¿™è¡¨æ˜äº†Javaå¼€å§‹å‘ä¼ä¸šã€æ¡Œé¢åº”ç”¨å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨3å¤§é¢†åŸŸæŒºè¿›ã€‚</p>
</li>
<li><p>2000å¹´ï¼ŒJDK1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaçš„é»˜è®¤è™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2002å¹´ï¼ŒJDK1.4å‘å¸ƒï¼Œå¤è€çš„Classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚</p>
</li>
<li><p>2003å¹´å¹´åº•ï¼ŒJavaå¹³å°çš„Scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº†Javaé˜µè¥ã€‚</p>
</li>
<li><p>2004å¹´ï¼ŒJDK1.5å‘å¸ƒã€‚åŒæ—¶JDK1.5æ”¹åä¸ºJavaSE5.0ã€‚</p>
</li>
<li><p>2006å¹´ï¼ŒJDK6å‘å¸ƒã€‚åŒå¹´ï¼ŒJavaå¼€æºå¹¶å»ºç«‹äº†OpenJDKã€‚é¡ºç†æˆç« ï¼ŒHotspotè™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº†openJDKä¸­çš„é»˜è®¤è™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2007å¹´ï¼ŒJavaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚</p>
</li>
<li><p>2008å¹´ï¼ŒOracleæ”¶è´­äº†BEAï¼Œå¾—åˆ°äº†JRockitè™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2009å¹´ï¼ŒTwitterå®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä»Rubyè¿ç§»åˆ°Scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚</p>
</li>
<li><p>2010å¹´ï¼ŒOracleæ”¶è´­äº†Sunï¼Œè·å¾—Javaå•†æ ‡å’Œæœ€çœŸä»·å€¼çš„HotSpotè™šæ‹Ÿæœºã€‚æ­¤æ—¶ï¼ŒOracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpotå’ŒJRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼šHotRockit</p>
</li>
<li><p>2011å¹´ï¼ŒJDK7å‘å¸ƒã€‚åœ¨JDK1.7u4ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1ã€‚</p>
</li>
<li><p>2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚å°†G1è®¾ç½®ä¸ºé»˜è®¤Gcï¼Œæ›¿ä»£CMS</p>
</li>
<li><p>åŒå¹´ï¼ŒIBMçš„J9å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„Open J9ç¤¾åŒº</p>
</li>
<li><p>2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleèµ”å¿Oracleè®¡88äº¿ç¾å…ƒ</p>
</li>
<li><p>åŒå¹´ï¼ŒOracleå®£å‘ŠJavaEEæˆä¸ºå†å²åè¯JDBCã€JMSã€Servletèµ äºˆEclipseåŸºé‡‘ä¼š</p>
</li>
<li><p>åŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDKï¼Œå‘å¸ƒé©å‘½æ€§çš„ZGCï¼Œè°ƒæ•´JDKæˆæƒè®¸å¯</p>
</li>
<li><p>2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„shenandoah GC</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220127103725657.png" alt="image-20220127103725657" loading="lazy"></p>
<p>åœ¨JDK11ä¹‹å‰ï¼ŒOracleJDKä¸­è¿˜ä¼šå­˜åœ¨ä¸€äº›OpenJDKä¸­æ²¡æœ‰çš„ã€é—­æºçš„åŠŸèƒ½ã€‚ä½†åœ¨JDK11ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºOpenJDKå’ŒOracleJDKä»£ç å®è´¨ä¸Šå·²ç»å®Œå…¨ä¸€è‡´çš„ç¨‹åº¦ã€‚</p>
<p>ä¸è¿‡ï¼Œä¸»æµçš„ JDK 8 åœ¨2019å¹´01æœˆä¹‹åå°±è¢«å®£å¸ƒåœæ­¢æ›´æ–°äº†ã€‚å¦å¤–ï¼Œ JDK 11 åŠä»¥åçš„ç‰ˆæœ¬ä¹Ÿä¸å†æä¾›å…è´¹çš„é•¿æœŸæ”¯æŒï¼ˆLTSï¼‰ï¼Œè€Œä¸” JDK 15 å’Œ JDK 16 ä¹Ÿä¸æ˜¯ä¸€ä¸ªé•¿æœŸæ”¯æŒçš„ç‰ˆæœ¬ï¼Œæœ€æ–°çš„ JDK 15 åªæ”¯æŒ 6 ä¸ªæœˆæ—¶é—´ï¼Œåˆ° 2021 å¹´ 3 æœˆï¼Œæ‰€ä»¥åƒä¸‡ä¸è¦æŠŠ JDK 15 ç­‰éé•¿æœŸæ”¯æŒç‰ˆæœ¬ç”¨åœ¨ç”Ÿäº§ã€‚</p>
<p>å•†ç”¨ç‰ˆå’Œå¼€æºç‰ˆæœ¬çš„åŒºåˆ«åœ¨äºï¼Œå•†ç”¨ç‰ˆæ²¡æœ‰ä¸€ä¸ªé•¿æœŸæ”¯æŒçš„ç‰ˆæœ¬ï¼Œä»–åªè¦æœ‰æ–°çš„ç‰ˆæœ¬ä½ å°±å¿…é¡»å»æ›´æ–°ï¼Œä½†æ˜¯è¿™æ ·ä»–ä¼šæœ‰å¾ˆå¤šæ–°çš„åŠŸèƒ½ï¼Œå…¶å®‰å…¨æ€§ä¹Ÿæ›´é«˜ï¼Œå¯èƒ½ä½ åœ¨å¼€æºç‰ˆæœ¬ä¸ŠæŠ¥é”™ï¼Œå•†ç”¨ç‰ˆæœ¬ä¸Šä¸æŠ¥é”™ã€‚</p>
<h3 id="4ï¼Œè™šæ‹Ÿæœºä¸Javaè™šæ‹Ÿæœº"><a href="#4ï¼Œè™šæ‹Ÿæœºä¸Javaè™šæ‹Ÿæœº" class="headerlink" title="4ï¼Œè™šæ‹Ÿæœºä¸Javaè™šæ‹Ÿæœº"></a>4ï¼Œè™šæ‹Ÿæœºä¸Javaè™šæ‹Ÿæœº</h3><p><strong>è™šæ‹Ÿæœº</strong></p>
<p>æ‰€è°“è™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰ï¼Œå°±æ˜¯ä¸€å°è™šæ‹Ÿçš„è®¡ç®—æœºã€‚å®ƒæ˜¯ä¸€æ¬¾è½¯ä»¶ï¼Œç”¨æ¥æ‰§è¡Œä¸€ç³»åˆ—è™šæ‹Ÿè®¡ç®—æœºæŒ‡ä»¤ã€‚å¤§ä½“ä¸Šï¼Œè™šæ‹Ÿæœºå¯ä»¥åˆ†ä¸ºç³»ç»Ÿè™šæ‹Ÿæœºå’Œç¨‹åºè™šæ‹Ÿæœºã€‚</p>
<ul>
<li><p>å¤§åé¼é¼çš„Visual Boxï¼ŒMwareå°±å±äº<strong>ç³»ç»Ÿè™šæ‹Ÿæœº</strong>ï¼Œå®ƒä»¬å®Œå…¨æ˜¯å¯¹ç‰©ç†è®¡ç®—æœºçš„ä»¿çœŸï¼Œ<strong>æä¾›äº†ä¸€ä¸ªå¯è¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿçš„è½¯ä»¶å¹³å°</strong>ã€‚</p>
</li>
<li><p><strong>ç¨‹åºè™šæ‹Ÿæœº</strong>çš„å…¸å‹ä»£è¡¨å°±æ˜¯Javaè™šæ‹Ÿæœºï¼Œ<strong>å®ƒä¸“é—¨ä¸ºæ‰§è¡Œå•ä¸ªè®¡ç®—æœºç¨‹åºè€Œè®¾è®¡</strong>ï¼Œåœ¨Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„æŒ‡ä»¤æˆ‘ä»¬ç§°ä¸ºJavaå­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
</li>
</ul>
<p>æ— è®ºæ˜¯ç³»ç»Ÿè™šæ‹Ÿæœºè¿˜æ˜¯ç¨‹åºè™šæ‹Ÿæœºï¼Œåœ¨ä¸Šé¢è¿è¡Œçš„è½¯ä»¶éƒ½è¢«é™åˆ¶äºè™šæ‹Ÿæœºæä¾›çš„èµ„æºä¸­ã€‚</p>
<hr>
<p><strong>Javaè™šæ‹Ÿæœº</strong></p>
<ul>
<li><p>Javaè™šæ‹Ÿæœºæ˜¯ä¸€å°æ‰§è¡ŒJavaå­—èŠ‚ç çš„è™šæ‹Ÿè®¡ç®—æœºï¼Œå®ƒæ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæœºåˆ¶ï¼Œå…¶è¿è¡Œçš„Javaå­—èŠ‚ç ä¹Ÿæœªå¿…ç”±Javaè¯­è¨€ç¼–è¯‘è€Œæˆã€‚</p>
</li>
<li><p>JVMå¹³å°çš„å„ç§è¯­è¨€å¯ä»¥å…±äº«Javaè™šæ‹Ÿæœºå¸¦æ¥çš„è·¨å¹³å°æ€§ã€ä¼˜ç§€çš„åƒåœ¾å›å™¨ï¼Œä»¥åŠå¯é çš„å³æ—¶ç¼–è¯‘å™¨ã€‚</p>
</li>
<li><p>JavaæŠ€æœ¯çš„æ ¸å¿ƒå°±æ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼ŒJava Virtual Machineï¼‰ï¼Œå› ä¸ºæ‰€æœ‰çš„Javaç¨‹åºéƒ½è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºå†…éƒ¨ã€‚</p>
</li>
</ul>
<p>ä½œç”¨</p>
<ul>
<li>Javaè™šæ‹Ÿæœºå°±æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼Œè´Ÿè´£è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨ï¼Œè§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚æ¯ä¸€æ¡JavaæŒ‡ä»¤ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒä¸­éƒ½æœ‰è¯¦ç»†å®šä¹‰ï¼Œå¦‚æ€ä¹ˆæ“ä½œæ•°ï¼Œæ€ä¹ˆå¤„ç†ä½œæ•°ï¼Œå¤„ç†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚</li>
</ul>
<p>ç‰¹ç‚¹</p>
<ul>
<li><p>ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œ</p>
</li>
<li><p>è‡ªåŠ¨å†…å­˜ç®¡ç†</p>
</li>
<li><p>è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆæ‹…å¿§ï¼Œå› ä¸ºä¸éœ€è¦å»è€ƒè™‘å›æ”¶çš„åŸç†ï¼Œé•¿æœŸçš„è‡ªåŠ¨åŒ–ä¼šå¯¼è‡´å¦‚æœå‡ºç°å†…å­˜æº¢å‡ºæ˜¯Javaç¨‹åºå‘˜æ— æ³•è§£å†³ï¼‰</p>
<hr>
</li>
</ul>
<p><strong>JVMçš„ä½ç½®</strong></p>
<p><img src="/2022/04/18/JVM/image-20220127105615233.png" alt="image-20220127105615233" loading="lazy"></p>
<p>JVMæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„ï¼Œå®ƒä¸ç¡¬ä»¶æ²¡æœ‰ç›´æ¥çš„äº¤äº’ï¼ˆJVMæ˜¯æœ‰ä¸åŒç³»ç»ŸåŒºåˆ«çš„ï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220127105657968.png" alt="image-20220127105657968" loading="lazy"></p>
<h3 id="5ï¼ŒJVMçš„æ•´ä½“ç»“æ„"><a href="#5ï¼ŒJVMçš„æ•´ä½“ç»“æ„" class="headerlink" title="5ï¼ŒJVMçš„æ•´ä½“ç»“æ„"></a>5ï¼ŒJVMçš„æ•´ä½“ç»“æ„</h3><p><img src="/2022/04/18/JVM/image-20220127110357430.png" alt="image-20220127110357430" loading="lazy"></p>
<ul>
<li><p>HotSpot VMæ˜¯ç›®å‰å¸‚é¢ä¸Šé«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚</p>
</li>
<li><p>å®ƒé‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ã€‚</p>
</li>
<li><p>åœ¨ä»Šå¤©ï¼ŒJavaç¨‹åºçš„è¿è¡Œæ€§èƒ½æ—©å·²è„±èƒæ¢éª¨ï¼Œå·²ç»è¾¾åˆ°äº†å¯ä»¥å’ŒC/C++ç¨‹åºä¸€è¾ƒé«˜ä¸‹çš„åœ°æ­¥ã€‚</p>
</li>
</ul>
<h3 id="6ï¼Œ-Javaä»£ç æ‰§è¡Œæµç¨‹"><a href="#6ï¼Œ-Javaä»£ç æ‰§è¡Œæµç¨‹" class="headerlink" title="6ï¼Œ Javaä»£ç æ‰§è¡Œæµç¨‹"></a>6ï¼Œ Javaä»£ç æ‰§è¡Œæµç¨‹</h3><p><img src="/2022/04/18/JVM/image-20220127110457051.png" alt="image-20220127110457051" loading="lazy"></p>
<ol>
<li>Javaçš„ä»£ç è¿›è¿‡Javaç¼–è¯‘å™¨å˜æˆäº†Javaè™šæ‹Ÿæœºå¯ä»¥è¯†åˆ«å­—èŠ‚ç æ–‡ä»¶ã€‚</li>
<li>å­—èŠ‚ç æ–‡ä»¶å†è¿›è¿‡Javaè™šæ‹Ÿæœºå˜æˆäº†æ“ä½œç³»ç»Ÿå¯ä»¥è¯†åˆ«çš„æœºå™¨æŒ‡ä»¤ã€‚</li>
<li>æ“ä½œç³»ç»Ÿå†æ ¹æ®ç›¸å…³çš„æœºå™¨æŒ‡ä»¤åšå‡ºå¯¹åº”çš„æ“ä½œã€‚</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ç°åœ¨å¾ˆå¤šçš„è™šæ‹Ÿæœºéƒ½æ˜¯è§£é‡Šå’Œç¼–è¯‘å¹¶è¡Œçš„ï¼Œåœ¨ä»¥å‰åªæœ‰è§£é‡Šå™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°å…¶æ•ˆç‡ä¸å¤ªé«˜ï¼Œè¿™ä¹Ÿæ˜¯æ—©èµ·Javaçš„ç¼ºé™·ï¼Œä½†æ˜¯äººä»¬å‘ç°å¾ˆå¤šçš„ä»£ç éƒ½æ˜¯é‡å¤çš„ï¼Œæ‰€ä»¥å°±å¤šäº†ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå»å°†ä¸€äº›çƒ­ç‚¹ä»£ç ä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ ·å­éœ€è¦çš„æ—¶å€™ç›´æ¥å»æ‹¿ä¸ç”¨å†é€šè¿‡è§£é‡Šå™¨å¤§å¤§æé«˜äº†æ•ˆç‡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´Javaæ˜¯ä¸€é—¨è§£é‡Šå’Œç¼–è¯‘å¹¶å­˜çš„è¯­è¨€çš„åŸå› æ‰€åœ¨ã€‚</li>
</ul>
<h3 id="7ï¼ŒJVMçš„æ¶æ„æ¨¡å‹"><a href="#7ï¼ŒJVMçš„æ¶æ„æ¨¡å‹" class="headerlink" title="7ï¼ŒJVMçš„æ¶æ„æ¨¡å‹"></a>7ï¼ŒJVMçš„æ¶æ„æ¨¡å‹</h3><p>Javaç¼–è¯‘å™¨è¾“å…¥çš„æŒ‡ä»¤æµåŸºæœ¬ä¸Šæ˜¯ä¸€ç§<strong>åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„</strong>ï¼Œå¦å¤–ä¸€ç§æŒ‡ä»¤é›†æ¶æ„åˆ™æ˜¯<strong>åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†æ¶æ„</strong>ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼šè¿™ä¸¤ç§æ¶æ„ä¹‹é—´çš„åŒºåˆ«ï¼š</p>
<p><strong>åŸºäºæ ˆå¼æ¶æ„çš„ç‰¹ç‚¹</strong></p>
<ul>
<li><p>è®¾è®¡å’Œå®ç°æ›´ç®€å•ï¼Œé€‚ç”¨äºèµ„æºå—é™çš„ç³»ç»Ÿ</p>
</li>
<li><p>é¿å¼€äº†å¯„å­˜å™¨çš„åˆ†é…éš¾é¢˜ï¼šä½¿ç”¨é›¶åœ°å€æŒ‡ä»¤æ–¹å¼åˆ†é…</p>
</li>
<li><p>æŒ‡ä»¤æµä¸­çš„æŒ‡ä»¤å¤§éƒ¨åˆ†æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹ä¾èµ–äºæ“ä½œæ ˆã€‚æŒ‡ä»¤é›†æ›´å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°</p>
</li>
<li><p>ä¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå¯ç§»æ¤æ€§æ›´å¥½ï¼Œæ›´å¥½å®ç°è·¨å¹³å°</p>
</li>
</ul>
<p><strong>åŸºäºå¯„å­˜å™¨æ¶æ„çš„ç‰¹ç‚¹</strong></p>
<ul>
<li><p>å…¸å‹çš„åº”ç”¨æ˜¯x86çš„äºŒè¿›åˆ¶æŒ‡ä»¤é›†ï¼šæ¯”å¦‚ä¼ ç»Ÿçš„PCä»¥åŠAndroidçš„Davlikè™šæ‹Ÿæœº</p>
</li>
<li><p>æŒ‡ä»¤é›†æ¶æ„åˆ™å®Œå…¨ä¾èµ–ç¡¬ä»¶ï¼Œå¯ç§»æ¤æ€§å·®</p>
</li>
<li><p>æ€§èƒ½ä¼˜ç§€å’Œæ‰§è¡Œæ›´é«˜æ•ˆ</p>
</li>
<li><p>èŠ±è´¹æ›´å°‘çš„æŒ‡ä»¤å»å®Œæˆä¸€é¡¹æ“ä½œ</p>
</li>
<li><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒåŸºäºå¯„å­˜å™¨æ¶æ„çš„æŒ‡ä»¤é›†å¾€å¾€éƒ½ä»¥ä¸€åœ°å€æŒ‡ä»¤ã€äºŒåœ°å€æŒ‡ä»¤å’Œä¸‰åœ°å€æŒ‡ä»¤ä¸ºä¸»ï¼Œè€ŒåŸºäºæ ˆå¼æ¶æ„çš„æŒ‡ä»¤é›†å´æ˜¯ä»¥åœ°å€æŒ‡ä»¤ä¸ºä¸»</p>
</li>
</ul>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: JVMä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: Test</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ ˆæ“ä½œçš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: èµµå…ˆç”Ÿ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/1/27 16:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> a=<span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> b=<span class="number">200</span>;</span><br><span class="line">        <span class="type">int</span> c=<span class="number">300</span>;</span><br><span class="line">        <span class="type">int</span> d=(a + b) * c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šè¿°ä»£ç è€Œè¨€ï¼Œä½¿ç”¨æ ˆæ“ä½œçš„è¯ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼ˆæ‰¾åˆ°å­—èŠ‚ç æ–‡ä»¶ï¼Œç”¨javap -c æ–‡ä»¶åï¼‰ï¼š</p>
<p>â€‹    <img src="/2022/04/18/JVM/image-20220127163853401.png" alt="image-20220127163853401" loading="lazy"></p>
<p>è€Œç”¨å¯„å­˜å™¨çš„å‡ æ­¥å°±å¯ä»¥å®Œæˆã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>ç”±äºè·¨å¹³å°æ€§çš„è®¾è®¡ï¼ŒJavaçš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ã€‚ä¸åŒå¹³å°CPUæ¶æ„ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡ä¸ºåŸºäºå¯„å­˜å™¨çš„ã€‚ä¼˜ç‚¹æ˜¯è·¨å¹³å°ï¼ŒæŒ‡ä»¤é›†å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½ä¸‹é™ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½éœ€è¦æ›´å¤šçš„æŒ‡ä»¤ã€‚</p>
<h3 id="8ï¼ŒJVMçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#8ï¼ŒJVMçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="8ï¼ŒJVMçš„ç”Ÿå‘½å‘¨æœŸ"></a>8ï¼ŒJVMçš„ç”Ÿå‘½å‘¨æœŸ</h3><p><strong>è™šæ‹Ÿæœºçš„å¯åŠ¨</strong></p>
<p>Javaè™šæ‹Ÿæœºçš„å¯åŠ¨æ˜¯é€šè¿‡<strong>å¼•å¯¼ç±»åŠ è½½å™¨</strong>ï¼ˆbootstrap class loaderï¼‰åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»ï¼ˆinitial classï¼‰æ¥å®Œæˆçš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±è™šæ‹Ÿæœºçš„å…·ä½“ç°æŒ‡å®šçš„ã€‚</p>
<p><strong>è™šæ‹Ÿæœºçš„æ‰§è¡Œ</strong></p>
<ul>
<li><p>ä¸€ä¸ªè¿è¡Œä¸­çš„Javaè™šæ‹Ÿæœºæœ‰ç€ä¸€ä¸ªæ¸…æ™°çš„ä»»åŠ¡ï¼šæ‰§è¡ŒJavaç¨‹åºã€‚</p>
</li>
<li><p>ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ä»–æ‰è¿è¡Œï¼Œç¨‹åºç»“æŸæ—¶ä»–å°±åœæ­¢ã€‚</p>
</li>
<li><p>æ‰§è¡Œä¸€ä¸ªæ‰€è°“çš„Javaç¨‹åºçš„æ—¶å€™ï¼ŒçœŸçœŸæ­£æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªå«åšJavaè™šæ‹Ÿæœºçš„è¿›ç¨‹</p>
</li>
</ul>
<p><strong>è™šæ‹Ÿæœºçš„é€€å‡º</strong></p>
<p>æœ‰å¦‚ä¸‹çš„å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li><p>ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</p>
</li>
<li><p>ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</p>
</li>
<li><p>ç”±äºæ“ä½œç³»ç»Ÿç”¨ç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</p>
</li>
<li><p>æŸçº¿ç¨‹è°ƒç”¨Runtimeç±»æˆ–systemç±»çš„exitæ–¹æ³•ï¼Œæˆ–Runtimeç±»çš„haltæ–¹æ³•ï¼Œå¹¶ä¸”Javaå®‰å…¨ç®¡ç†å™¨ä¹Ÿå…è®¸è¿™æ¬¡exitæˆ–haltæ“ä½œã€‚</p>
</li>
<li><p>é™¤æ­¤ä¹‹å¤–ï¼ŒJNIï¼ˆJava Native Interfaceï¼‰è§„èŒƒæè¿°äº†ç”¨JNI Invocation APIæ¥åŠ è½½æˆ–å¸è½½ Javaè™šæ‹Ÿæœºæ—¶ï¼ŒJavaè™šæ‹Ÿæœºçš„é€€å‡ºæƒ…å†µã€‚</p>
</li>
</ul>
<h3 id="9ï¼Œ-JVMçš„å‘å±•å†ç¨‹"><a href="#9ï¼Œ-JVMçš„å‘å±•å†ç¨‹" class="headerlink" title="9ï¼Œ JVMçš„å‘å±•å†ç¨‹"></a>9ï¼Œ JVMçš„å‘å±•å†ç¨‹</h3><h4 id="Sun-Classic-VM"><a href="#Sun-Classic-VM" class="headerlink" title="Sun Classic VM"></a>Sun Classic VM</h4><ul>
<li><p>æ—©åœ¨1996å¹´Java1.0ç‰ˆæœ¬çš„æ—¶å€™ï¼ŒSunå…¬å¸å‘å¸ƒäº†ä¸€æ¬¾åä¸ºsun classic VMçš„Javaè™šæ‹Ÿæœºï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨Javaè™šæ‹Ÿæœºï¼ŒJDK1.4æ—¶å®Œå…¨è¢«æ·˜æ±°ã€‚</p>
</li>
<li><p>è¿™æ¬¾è™šæ‹Ÿæœºå†…éƒ¨åªæä¾›è§£é‡Šå™¨ã€‚ç°åœ¨è¿˜æœ‰åŠæ—¶ç¼–è¯‘å™¨ï¼Œå› æ­¤æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€ŒåŠæ—¶ç¼–è¯‘å™¨ä¼šæŠŠçƒ­ç‚¹ä»£ç ç¼“å­˜èµ·æ¥ï¼Œé‚£ä¹ˆä»¥åä½¿ç”¨çƒ­ç‚¹ä»£ç çš„æ—¶å€™ï¼Œæ•ˆç‡å°±æ¯”è¾ƒé«˜ã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨JITç¼–è¯‘å™¨ï¼Œå°±éœ€è¦è¿›è¡Œå¤–æŒ‚ã€‚ä½†æ˜¯ä¸€æ—¦ä½¿ç”¨äº†JITç¼–è¯‘å™¨ï¼ŒJITå°±ä¼šæ¥ç®¡è™šæ‹Ÿæœºçš„æ‰§è¡Œç³»ç»Ÿã€‚è§£é‡Šå™¨å°±ä¸å†å·¥ä½œã€‚è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ä¸èƒ½é…åˆå·¥ä½œã€‚</p>
</li>
<li><p>ç°åœ¨hotspotå†…ç½®äº†æ­¤è™šæ‹Ÿæœºã€‚</p>
</li>
</ul>
<h4 id="Exact-VM"><a href="#Exact-VM" class="headerlink" title="Exact VM"></a>Exact VM</h4><ul>
<li><p>ä¸ºäº†è§£å†³ä¸Šä¸€ä¸ªè™šæ‹Ÿæœºé—®é¢˜ï¼Œjdk1.2æ—¶ï¼ŒSunæä¾›äº†æ­¤è™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>Exact Memory Managementï¼šå‡†ç¡®å¼å†…å­˜ç®¡ç†</p>
</li>
<li><ul>
<li>ä¹Ÿå¯ä»¥å«Non-Conservative/Accurate Memory Management</li>
</ul>
</li>
<li><ul>
<li>è™šæ‹Ÿæœºå¯ä»¥çŸ¥é“å†…å­˜ä¸­æŸä¸ªä½ç½®çš„æ•°æ®å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ã€‚</li>
</ul>
</li>
<li><p>å…·å¤‡ç°ä»£é«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ç»´å½¢</p>
</li>
<li><ul>
<li>çƒ­ç‚¹æ¢æµ‹</li>
</ul>
</li>
<li><ul>
<li>ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨æ··åˆå·¥ä½œæ¨¡å¼</li>
</ul>
</li>
<li><p>åªåœ¨solariså¹³å°çŸ­æš‚ä½¿ç”¨ï¼Œå…¶ä»–å¹³å°ä¸Šè¿˜æ˜¯classic vm</p>
</li>
<li><ul>
<li>è‹±é›„æ°”çŸ­ï¼Œç»ˆè¢«Hotspotè™šæ‹Ÿæœºæ›¿æ¢</li>
</ul>
</li>
</ul>
<h4 id="HotSpot-VM"><a href="#HotSpot-VM" class="headerlink" title="HotSpot VM"></a>HotSpot VM</h4><ul>
<li><p>HotSpotå†å²</p>
</li>
<li><ul>
<li>æœ€åˆç”±ä¸€å®¶åä¸ºâ€œLongview Technologiesâ€çš„å°å…¬å¸è®¾è®¡</li>
</ul>
</li>
<li><ul>
<li>1997å¹´ï¼Œæ­¤å…¬å¸è¢«sunæ”¶è´­ï¼›2009å¹´ï¼ŒSunå…¬å¸è¢«ç”²éª¨æ–‡æ”¶è´­ã€‚</li>
</ul>
</li>
<li><ul>
<li>JDK1.3æ—¶ï¼ŒHotSpot VMæˆä¸ºé»˜è®¤è™šæ‹Ÿæœº</li>
</ul>
</li>
<li><p>ç›®å‰Hotspotå æœ‰ç»å¯¹çš„å¸‚åœºåœ°ä½ï¼Œç§°éœ¸æ­¦æ—ã€‚</p>
</li>
<li><ul>
<li>ä¸ç®¡æ˜¯ç°åœ¨ä»åœ¨å¹¿æ³›ä½¿ç”¨çš„JDK6ï¼Œè¿˜æ˜¯ä½¿ç”¨æ¯”ä¾‹è¾ƒå¤šçš„JDK8ä¸­ï¼Œé»˜è®¤çš„è™šæ‹Ÿæœºéƒ½æ˜¯HotSpot</li>
</ul>
</li>
<li><ul>
<li>Sun / Oracle JDK å’Œ OpenJDK çš„é»˜è®¤è™šæ‹Ÿæœº</li>
</ul>
</li>
<li><ul>
<li>å› æ­¤æœ¬è¯¾ç¨‹ä¸­é»˜è®¤ä»‹ç»çš„è™šæ‹Ÿæœºéƒ½æ˜¯HotSpotï¼Œç›¸å…³æœºåˆ¶ä¹Ÿä¸»è¦æ˜¯æŒ‡HotSpotçš„Gcæœºåˆ¶ã€‚ï¼ˆæ¯”å¦‚å…¶ä»–ä¸¤ä¸ªå•†ç”¨è™šæœºéƒ½æ²¡æœ‰æ–¹æ³•åŒºçš„æ¦‚å¿µï¼‰</li>
</ul>
</li>
<li><p>ä»æœåŠ¡å™¨ã€æ¡Œé¢åˆ°ç§»åŠ¨ç«¯ã€åµŒå…¥å¼éƒ½æœ‰åº”ç”¨ã€‚</p>
</li>
<li><p>åç§°ä¸­çš„HotSpotæŒ‡çš„å°±æ˜¯å®ƒçš„çƒ­ç‚¹ä»£ç æ¢æµ‹æŠ€æœ¯ã€‚</p>
</li>
<li><ul>
<li>é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢</li>
</ul>
</li>
<li><ul>
<li>é€šè¿‡ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨ååŒå·¥ä½œï¼Œåœ¨æœ€ä¼˜åŒ–çš„ç¨‹åºå“åº”æ—¶é—´ä¸æœ€ä½³æ‰§è¡Œæ€§èƒ½ä¸­å–å¾—å¹³è¡¡</li>
</ul>
</li>
</ul>
<h4 id="JRockit"><a href="#JRockit" class="headerlink" title="JRockit"></a>JRockit</h4><ul>
<li><p>ä¸“æ³¨äºæœåŠ¡å™¨ç«¯åº”ç”¨</p>
</li>
<li><ul>
<li>å®ƒå¯ä»¥ä¸å¤ªå…³æ³¨ç¨‹åºå¯åŠ¨é€Ÿåº¦ï¼Œå› æ­¤JRockitå†…éƒ¨ä¸åŒ…å«è§£æå™¨å®ç°ï¼Œå…¨éƒ¨ä»£ç éƒ½é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</li>
</ul>
</li>
<li><p>å¤§é‡çš„è¡Œä¸šåŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼ŒJRockit JVMæ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„JVMã€‚</p>
</li>
<li><ul>
<li>ä½¿ç”¨JRockitäº§å“ï¼Œå®¢æˆ·å·²ç»ä½“éªŒåˆ°äº†æ˜¾è‘—çš„æ€§èƒ½æé«˜ï¼ˆä¸€äº›è¶…è¿‡äº†70%ï¼‰å’Œç¡¬ä»¶æˆæœ¬çš„å‡å°‘ï¼ˆè¾¾50%ï¼‰ã€‚</li>
</ul>
</li>
<li><p>ä¼˜åŠ¿ï¼šå…¨é¢çš„Javaè¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ</p>
</li>
<li><ul>
<li>JRockité¢å‘å»¶è¿Ÿæ•æ„Ÿå‹åº”ç”¨çš„è§£å†³æ–¹æ¡ˆJRockit Real Timeæä¾›ä»¥æ¯«ç§’æˆ–å¾®ç§’çº§çš„JVMå“åº”æ—¶é—´ï¼Œé€‚åˆè´¢åŠ¡ã€å†›äº‹æŒ‡æŒ¥ã€ç”µä¿¡ç½‘ç»œçš„éœ€è¦</li>
</ul>
</li>
<li><ul>
<li>MissionControlæœåŠ¡å¥—ä»¶ï¼Œå®ƒæ˜¯ä¸€ç»„ä»¥æä½çš„å¼€é”€æ¥ç›‘æ§ã€ç®¡ç†å’Œåˆ†æç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚</li>
</ul>
</li>
<li><p>2008å¹´ï¼ŒJRockitè¢«oracleæ”¶è´­ã€‚</p>
</li>
<li><p>Oracleè¡¨è¾¾äº†æ•´åˆä¸¤å¤§ä¼˜ç§€è™šæ‹Ÿæœºçš„å·¥ä½œï¼Œå¤§è‡´åœ¨JDK8ä¸­å®Œæˆã€‚æ•´åˆçš„æ–¹å¼æ˜¯åœ¨HotSpotçš„åŸºç¡€ä¸Šï¼Œç§»æ¤JRockitçš„ä¼˜ç§€ç‰¹æ€§ã€‚</p>
</li>
<li><p>é«˜æ–¯æ—ï¼šç›®å‰å°±èŒäºè°·æ­Œï¼Œç ”ç©¶äººå·¥æ™ºèƒ½å’Œæ°´ä¸‹æœºå™¨äºº</p>
</li>
</ul>
<h4 id="IBMçš„J9"><a href="#IBMçš„J9" class="headerlink" title="IBMçš„J9"></a>IBMçš„J9</h4><ul>
<li><p>å…¨ç§°ï¼šIBM Technology for Java Virtual Machineï¼Œç®€ç§°IT4Jï¼Œå†…éƒ¨ä»£å·ï¼šJ9</p>
</li>
<li><p>å¸‚åœºå®šä½ä¸HotSpotæ¥è¿‘ï¼ŒæœåŠ¡å™¨ç«¯ã€æ¡Œé¢åº”ç”¨ã€åµŒå…¥å¼ç­‰å¤šç”¨é€”VM</p>
</li>
<li><p>å¹¿æ³›ç”¨äºIBMçš„å„ç§Javaäº§å“ã€‚</p>
</li>
<li><p>ç›®å‰ï¼Œæœ‰å½±å“åŠ›çš„ä¸‰å¤§å•†ç”¨è™šæ‹Ÿæœºä¹‹ä¸€ï¼Œä¹Ÿå·ç§°æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„Javaè™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>2017å¹´å·¦å³ï¼ŒIBMå‘å¸ƒäº†å¼€æºJ9VMï¼Œå‘½åä¸ºopenJ9ï¼Œäº¤ç»™EClipseåŸºé‡‘ä¼šç®¡ç†ï¼Œä¹Ÿç§°ä¸ºEclipse OpenJ9</p>
</li>
</ul>
<h4 id="KVMå’ŒCDC-CLDC-Hotspot"><a href="#KVMå’ŒCDC-CLDC-Hotspot" class="headerlink" title="KVMå’ŒCDC / CLDC Hotspot"></a>KVMå’ŒCDC / CLDC Hotspot</h4><ul>
<li><p>Oracleåœ¨Java MEäº§å“çº¿ä¸Šçš„ä¸¤æ¬¾è™šæ‹Ÿæœºä¸ºï¼šCDC/CLDC HotSpot Implementation VM</p>
</li>
<li><p>KVMï¼ˆKilobyteï¼‰æ˜¯CLDC-HIæ—©æœŸäº§å“</p>
</li>
<li><p>ç›®å‰ç§»åŠ¨é¢†åŸŸåœ°ä½å°´å°¬ï¼Œæ™ºèƒ½æœºè¢«Androidå’ŒiOSäºŒåˆ†å¤©ä¸‹ã€‚</p>
</li>
<li><p>KVMç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œé¢å‘æ›´ä½ç«¯çš„è®¾å¤‡ä¸Šè¿˜ç»´æŒè‡ªå·±çš„ä¸€ç‰‡å¸‚åœº</p>
</li>
<li><ul>
<li>æ™ºèƒ½æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨</li>
</ul>
</li>
<li><ul>
<li>è€äººæ‰‹æœºã€ç»æµæ¬ å‘è¾¾åœ°åŒºçš„åŠŸèƒ½æ‰‹æœº</li>
</ul>
</li>
<li><p>æ‰€æœ‰çš„è™šæ‹Ÿæœºçš„åŸåˆ™ï¼šä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œã€‚</p>
</li>
</ul>
<h4 id="Azul-VM"><a href="#Azul-VM" class="headerlink" title="Azul VM"></a>Azul VM</h4><ul>
<li><p>å‰é¢ä¸‰å¤§â€œé«˜æ€§èƒ½Javaè™šæ‹Ÿæœºâ€ä½¿ç”¨åœ¨é€šç”¨ç¡¬ä»¶å¹³å°ä¸Šè¿™é‡ŒAzul VWå’ŒBEA Liquid VMæ˜¯ä¸ç‰¹å®šç¡¬ä»¶å¹³å°ç»‘å®šã€è½¯ç¡¬ä»¶é…åˆçš„ä¸“æœ‰è™šæ‹Ÿæœº</p>
</li>
<li><ul>
<li>é«˜æ€§èƒ½Javaè™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºã€‚</li>
</ul>
</li>
<li><p>Azul VMæ˜¯Azul Systemså…¬å¸åœ¨HotSpotåŸºç¡€ä¸Šè¿›è¡Œå¤§é‡æ”¹è¿›ï¼Œè¿è¡ŒäºAzul Systemså…¬å¸çš„ä¸“æœ‰ç¡¬ä»¶Vegaç³»ç»Ÿä¸Šçš„Javaè™šæ‹Ÿæœºã€‚</p>
</li>
<li><p>æ¯ä¸ªAzul VMå®ä¾‹éƒ½å¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ªCPUå’Œæ•°ç™¾GBå†…å­˜çš„ç¡¬ä»¶èµ„æºï¼Œå¹¶æä¾›åœ¨å·¨å¤§å†…å­˜èŒƒå›´å†…å®ç°å¯æ§çš„GCæ—¶é—´çš„åƒåœ¾æ”¶é›†å™¨ã€ä¸“æœ‰ç¡¬ä»¶ä¼˜åŒ–çš„çº¿ç¨‹è°ƒåº¦ç­‰ä¼˜ç§€ç‰¹æ€§ã€‚</p>
</li>
<li><p>2010å¹´ï¼ŒAzulSystemså…¬å¸å¼€å§‹ä»ç¡¬ä»¶è½¬å‘è½¯ä»¶ï¼Œå‘å¸ƒäº†è‡ªå·±çš„Zing JVMï¼Œå¯ä»¥åœ¨é€šç”¨x86å¹³å°ä¸Šæä¾›æ¥è¿‘äºVegaç³»ç»Ÿçš„ç‰¹æ€§ã€‚</p>
</li>
</ul>
<h4 id="Liquid-VM"><a href="#Liquid-VM" class="headerlink" title="Liquid VM"></a>Liquid VM</h4><ul>
<li><p>é«˜æ€§èƒ½Javaè™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºã€‚</p>
</li>
<li><p>BEAå…¬å¸å¼€å‘çš„ï¼Œç›´æ¥è¿è¡Œåœ¨è‡ªå®¶Hypervisorç³»ç»Ÿä¸Š</p>
</li>
<li><p>Liquid VMå³æ˜¯ç°åœ¨çš„JRockit VEï¼ˆVirtual Editionï¼‰ï¼ŒLiquid VMä¸éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œæˆ–è€…è¯´å®ƒè‡ªå·±æœ¬èº«å®ç°äº†ä¸€ä¸ªä¸“ç”¨æ“ä½œç³»ç»Ÿçš„å¿…è¦åŠŸèƒ½ï¼Œå¦‚çº¿ç¨‹è°ƒåº¦ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæ”¯æŒç­‰ã€‚</p>
</li>
<li><p>éšç€JRockitè™šæ‹Ÿæœºç»ˆæ­¢å¼€å‘ï¼ŒLiquid vMé¡¹ç›®ä¹Ÿåœæ­¢äº†ã€‚</p>
</li>
</ul>
<h4 id="Apache-Harmony"><a href="#Apache-Harmony" class="headerlink" title="Apache Harmony"></a>Apache Harmony</h4><ul>
<li><p>Apacheä¹Ÿæ›¾ç»æ¨å‡ºè¿‡ä¸JDK1.5å’ŒJDK1.6å…¼å®¹çš„Javaè¿è¡Œå¹³å°Apache Harmonyã€‚</p>
</li>
<li><p>å®ƒæ˜¯IBMå’ŒIntelè”åˆå¼€å‘çš„å¼€æºJVMï¼Œå—åˆ°åŒæ ·å¼€æºçš„OpenJDKçš„å‹åˆ¶ï¼ŒSunåšå†³ä¸è®©Harmonyè·å¾—JCPè®¤è¯ï¼Œæœ€ç»ˆäº2011å¹´é€€å½¹ï¼ŒIBMè½¬è€Œå‚ä¸OpenJDK</p>
</li>
<li><p>è™½ç„¶ç›®å‰å¹¶æ²¡æœ‰Apache Harmonyè¢«å¤§è§„æ¨¡å•†ç”¨çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯å®ƒçš„Javaç±»åº“ä»£ç å¸çº³è¿›äº†Android SDKã€‚</p>
</li>
</ul>
<h4 id="Micorsoft-JVM"><a href="#Micorsoft-JVM" class="headerlink" title="Micorsoft JVM"></a>Micorsoft JVM</h4><ul>
<li><p>å¾®è½¯ä¸ºäº†åœ¨IE3æµè§ˆå™¨ä¸­æ”¯æŒJava Appletsï¼Œå¼€å‘äº†Microsoft JVMã€‚</p>
</li>
<li><p>åªèƒ½åœ¨Windowså¹³å°ä¸‹è¿è¡Œã€‚ä½†ç¡®æ˜¯å½“æ—¶Windowsä¸‹æ€§èƒ½æœ€å¥½çš„Java VMã€‚</p>
</li>
<li><p>1997å¹´ï¼ŒSunä»¥ä¾µçŠ¯å•†æ ‡ã€ä¸æ­£å½“ç«äº‰ç½ªåæŒ‡æ§å¾®è½¯æˆåŠŸï¼Œèµ”äº†Sunå¾ˆå¤šé’±ã€‚å¾®è½¯WindowsXP SP3ä¸­æŠ¹æ‰äº†å…¶VMã€‚ç°åœ¨Windowsä¸Šå®‰è£…çš„jdkéƒ½æ˜¯HotSpotã€‚</p>
</li>
</ul>
<h4 id="Taobao-JVM"><a href="#Taobao-JVM" class="headerlink" title="Taobao JVM"></a>Taobao JVM</h4><ul>
<li><p>ç”±AliJVMå›¢é˜Ÿå‘å¸ƒã€‚é˜¿é‡Œï¼Œå›½å†…ä½¿ç”¨Javaæœ€å¼ºå¤§çš„å…¬å¸ï¼Œè¦†ç›–äº‘è®¡ç®—ã€é‡‘èã€ç‰©æµã€ç”µå•†ç­‰ä¼—å¤šé¢†åŸŸï¼Œéœ€è¦è§£å†³é«˜å¹¶å‘ã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼çš„å¤åˆé—®é¢˜ã€‚æœ‰å¤§é‡çš„å¼€æºäº§å“ã€‚</p>
</li>
<li><p>åŸºäºOpenJDK å¼€å‘äº†è‡ªå·±çš„å®šåˆ¶ç‰ˆæœ¬AlibabaJDKï¼Œç®€ç§°AJDKã€‚æ˜¯æ•´ä¸ªé˜¿é‡ŒJavaä½“ç³»çš„åŸºçŸ³ã€‚</p>
</li>
<li><p>åŸºäºOpenJDK Hotspot VMå‘å¸ƒçš„å›½å†…ç¬¬ä¸€ä¸ªä¼˜åŒ–ã€æ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ç‰ˆJavaè™šæ‹Ÿæœºã€‚</p>
</li>
<li><ul>
<li>åˆ›æ–°çš„GCIHï¼ˆGC invisible heapï¼‰æŠ€æœ¯å®ç°äº†off-heapï¼Œå³å°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä»heapä¸­ç§»åˆ°heapä¹‹å¤–ï¼Œå¹¶ä¸”GCä¸èƒ½ç®¡ç†GCIHå†…éƒ¨çš„Javaå¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½GCçš„å›æ”¶é¢‘ç‡å’Œæå‡GCçš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</li>
</ul>
</li>
<li><ul>
<li>GCIHä¸­çš„å¯¹è±¡è¿˜èƒ½å¤Ÿåœ¨å¤šä¸ªJavaè™šæ‹Ÿæœºè¿›ç¨‹ä¸­å®ç°å…±äº«</li>
</ul>
</li>
<li><ul>
<li>ä½¿ç”¨crc32æŒ‡ä»¤å®ç°JVM intrinsic é™ä½JNI çš„è°ƒç”¨å¼€é”€</li>
</ul>
</li>
<li><ul>
<li>PMU hardware çš„Java profiling tool å’Œè¯Šæ–­ååŠ©åŠŸèƒ½</li>
</ul>
</li>
<li><ul>
<li>é’ˆå¯¹å¤§æ•°æ®åœºæ™¯çš„ZenGc</li>
</ul>
</li>
<li><p>taobao vmåº”ç”¨åœ¨é˜¿é‡Œäº§å“ä¸Šæ€§èƒ½é«˜ï¼Œç¡¬ä»¶ä¸¥é‡ä¾èµ–intelçš„cpuï¼ŒæŸå¤±äº†å…¼å®¹æ€§ï¼Œä½†æé«˜äº†æ€§èƒ½</p>
</li>
<li><ul>
<li>ç›®å‰å·²ç»åœ¨æ·˜å®ã€å¤©çŒ«ä¸Šçº¿ï¼ŒæŠŠoracleå®˜æ–¹JvMç‰ˆæœ¬å…¨éƒ¨æ›¿æ¢äº†ã€‚</li>
</ul>
</li>
</ul>
<h4 id="Dalvik-VM"><a href="#Dalvik-VM" class="headerlink" title="Dalvik VM"></a>Dalvik VM</h4><ul>
<li><p>è°·æ­Œå¼€å‘çš„ï¼Œåº”ç”¨äºAndroidç³»ç»Ÿï¼Œå¹¶åœ¨Android2.2ä¸­æä¾›äº†JITï¼Œå‘å±•è¿…çŒ›ã€‚</p>
</li>
<li><p>Dalvik VMåªèƒ½ç§°ä½œè™šæ‹Ÿæœºï¼Œè€Œä¸èƒ½ç§°ä½œâ€œJavaè™šæ‹Ÿæœºâ€ï¼Œå®ƒæ²¡æœ‰éµå¾ª Javaè™šæ‹Ÿæœºè§„èŒƒï¼Œä¸èƒ½ç›´æ¥æ‰§è¡ŒJavaçš„Classæ–‡ä»¶</p>
</li>
<li><p>åŸºäºå¯„å­˜å™¨æ¶æ„ï¼Œä¸æ˜¯jvmçš„æ ˆæ¶æ„ã€‚</p>
</li>
<li><p>æ‰§è¡Œçš„æ˜¯ç¼–è¯‘ä»¥åçš„dexï¼ˆDalvik Executableï¼‰æ–‡ä»¶ã€‚æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p>
</li>
<li><ul>
<li>å®ƒæ‰§è¡Œçš„dexï¼ˆDalvik Executableï¼‰æ–‡ä»¶å¯ä»¥é€šè¿‡classæ–‡ä»¶è½¬åŒ–è€Œæ¥ï¼Œä½¿ç”¨Javaè¯­æ³•ç¼–å†™åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¤§éƒ¨åˆ†çš„Java APIç­‰ã€‚</li>
</ul>
</li>
<li><p>Android 5.0ä½¿ç”¨æ”¯æŒæå‰ç¼–è¯‘ï¼ˆAhead of Time Compilationï¼ŒAoTï¼‰çš„ART VMæ›¿æ¢Dalvik VMã€‚</p>
</li>
</ul>
<h4 id="Graal-VM"><a href="#Graal-VM" class="headerlink" title="Graal VM"></a>Graal VM</h4><ul>
<li><p>2018å¹´4æœˆï¼Œoracle Labså…¬å¼€äº†Graal VMï¼Œå·ç§° â€œRun Programs Faster Anywhereâ€ï¼Œé‡å¿ƒå‹ƒå‹ƒã€‚ä¸1995å¹´javaçš„â€write onceï¼Œrun anywhereâ€é¥ç›¸å‘¼åº”ã€‚</p>
</li>
<li><p>Graal VMåœ¨HotSpot VMåŸºç¡€ä¸Šå¢å¼ºè€Œæˆçš„è·¨è¯­è¨€å…¨æ ˆè™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸ºâ€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å°ä½¿ç”¨ã€‚è¯­è¨€åŒ…æ‹¬ï¼šJavaã€Scalaã€Groovyã€Kotlinï¼›Cã€C++ã€Javascriptã€Rubyã€Pythonã€Rç­‰</p>
</li>
<li><p>æ”¯æŒä¸åŒè¯­è¨€ä¸­æ··ç”¨å¯¹æ–¹çš„æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€ä½¿ç”¨å·²ç»ç¼–å†™å¥½çš„æœ¬åœ°åº“æ–‡ä»¶</p>
</li>
<li><p>å·¥ä½œåŸç†æ˜¯å°†è¿™äº›è¯­è¨€çš„æºä»£ç æˆ–æºä»£ç ç¼–è¯‘åçš„ä¸­é—´æ ¼å¼ï¼Œé€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½è¢«Graal VMæ¥å—çš„ä¸­é—´è¡¨ç¤ºã€‚Graal VMæä¾›Truffleå·¥å…·é›†å¿«é€Ÿæ„å»ºé¢å‘ä¸€ç§æ–°è¯­è¨€çš„è§£é‡Šå™¨ã€‚åœ¨è¿è¡Œæ—¶è¿˜èƒ½è¿›è¡Œå³æ—¶ç¼–è¯‘ä¼˜åŒ–ï¼Œè·å¾—æ¯”åŸç”Ÿç¼–è¯‘å™¨æ›´ä¼˜ç§€çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
</li>
<li><p>å¦‚æœè¯´HotSpotæœ‰ä¸€å¤©çœŸçš„è¢«å–ä»£ï¼ŒGraal VMå¸Œæœ›æœ€å¤§ã€‚ä½†æ˜¯Javaçš„è½¯ä»¶ç”Ÿæ€æ²¡æœ‰ä¸æ¯«å˜åŒ–ã€‚</p>
</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å…·ä½“JVMçš„å†…å­˜ç»“æ„ï¼Œå…¶å®å–å†³äºå…¶å®ç°ï¼Œä¸åŒå‚å•†çš„JVMï¼Œæˆ–è€…åŒä¸€å‚å•†å‘å¸ƒçš„ä¸åŒç‰ˆæœ¬ï¼Œéƒ½æœ‰å¯èƒ½å­˜åœ¨ä¸€å®šå·®å¼‚ã€‚ä¸»è¦ä»¥Oracle HotSpot VMä¸ºé»˜è®¤è™šæ‹Ÿæœºã€‚</p>
<h2 id="äºŒï¼Œç±»åŠ è½½å­ç³»ç»Ÿ"><a href="#äºŒï¼Œç±»åŠ è½½å­ç³»ç»Ÿ" class="headerlink" title="äºŒï¼Œç±»åŠ è½½å­ç³»ç»Ÿ"></a>äºŒï¼Œç±»åŠ è½½å­ç³»ç»Ÿ</h2><h3 id="1ï¼Œå†…å­˜ç»“æ„æ¦‚è¿°"><a href="#1ï¼Œå†…å­˜ç»“æ„æ¦‚è¿°" class="headerlink" title="1ï¼Œå†…å­˜ç»“æ„æ¦‚è¿°"></a>1ï¼Œå†…å­˜ç»“æ„æ¦‚è¿°</h3><ul>
<li><p>Classæ–‡ä»¶</p>
</li>
<li><p>ç±»åŠ è½½å­ç³»ç»Ÿ</p>
</li>
<li><p>è¿è¡Œæ—¶æ•°æ®åŒº </p>
</li>
<li><ul>
<li>æ–¹æ³•åŒº</li>
</ul>
</li>
<li><ul>
<li>å †</li>
</ul>
</li>
<li><ul>
<li>ç¨‹åºè®¡æ•°å™¨</li>
</ul>
</li>
<li><ul>
<li>è™šæ‹Ÿæœºæ ˆ</li>
</ul>
</li>
<li><ul>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
</li>
<li><p>æ‰§è¡Œå¼•æ“</p>
</li>
<li><p>æœ¬åœ°æ–¹æ³•æ¥å£</p>
</li>
<li><p>æœ¬åœ°æ–¹æ³•åº“</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220130092631309.png" alt="image-20220130092631309" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220130092645074.png" alt="image-20220130092645074" loading="lazy"></p>
<p>å¦‚æœè‡ªå·±æƒ³æ‰‹å†™ä¸€ä¸ªJavaè™šæ‹Ÿæœºçš„è¯ï¼Œä¸»è¦è€ƒè™‘å“ªäº›ç»“æ„å‘¢ï¼Ÿ</p>
<ul>
<li><p>ç±»åŠ è½½å™¨ï¼ˆè½¬åŒ–ä¸ºè™šæ‹Ÿæœºå¯ä»¥è¯†åˆ«çš„å­—èŠ‚ç æ–‡ä»¶ï¼‰</p>
</li>
<li><p>æ‰§è¡Œå¼•æ“</p>
</li>
</ul>
<h3 id="2ï¼Œç±»åŠ è½½å™¨ä¸ç±»çš„åŠ è½½è¿‡ç¨‹"><a href="#2ï¼Œç±»åŠ è½½å™¨ä¸ç±»çš„åŠ è½½è¿‡ç¨‹" class="headerlink" title="2ï¼Œç±»åŠ è½½å™¨ä¸ç±»çš„åŠ è½½è¿‡ç¨‹"></a>2ï¼Œç±»åŠ è½½å™¨ä¸ç±»çš„åŠ è½½è¿‡ç¨‹</h3><p><strong>ç±»åŠ è½½å™¨å­ç³»ç»Ÿä½œç”¨</strong></p>
<p><img src="/2022/04/18/JVM/image-20220130093257767.png" alt="image-20220130093257767" loading="lazy"></p>
<ul>
<li>ç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´éƒ½æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚</li>
<li>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºä»–æ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™æ˜¯ç”±Execution Engineå†³å®šã€‚</li>
<li>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´ã€‚é™¤äº†ç±»ä¿¡æ¯å¤–ï¼Œæ–¹æ³•åŒºä¸­è¿˜ä¼šæœ‰å­˜æ”¾è¿è¡Œæ—¶å¸¸é‡ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…å«å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡ï¼ˆè¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ï¼‰</li>
<li>æˆ‘è‡ªå·±çš„ç†è§£ï¼šç±»åŠ è½½å™¨æ˜¯ä»ç¡¬ç›˜ä¸­æ‰¾åˆ°.classæ–‡ä»¶ï¼ˆæ˜¯é€šè¿‡ç‰¹å®šæ–‡ä»¶æ ‡è¯†æ‰¾ï¼‰ï¼Œç„¶åä»¥äºŒè¿›åˆ¶æµçš„å½¢å¼åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå½“ä¸€ä¸ªç±»è¢«åŠ è½½åï¼Œä»–æ˜¯å¦èƒ½å¤Ÿè¿è¡Œæ˜¯æœ‰æ‰§è¡Œå¼•æ“å»è´Ÿè´£çš„ï¼Œå’Œç±»åŠ è½½å™¨æ²¡æœ‰å…³ç³»ã€‚ä¸”æˆ‘ä»¬åŠ è½½è¿›å»çš„ç±»çš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ï¼ŒåŒæ—¶æ–¹æ³•åŒºä¸­è¿˜æœ‰è¿è¡Œæ—¶å¸¸é‡ä¿¡æ¯ç­‰ä¿¡æ¯ã€‚å¦‚æœå®ä¾‹åŒ–å¯¹è±¡äº†ï¼Œä»–ä»¬è¿™ä¸ªå¯¹è±¡å­˜æ”¾åˆ°å †ä¸­ï¼Œä½†æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ¨æ ˆé‡Œé¢ã€‚</li>
</ul>
<p><strong>ç±»åŠ è½½å™¨ClasLoaderè§’è‰²</strong></p>
<p><img src="/2022/04/18/JVM/image-20220130094714257.png" alt="image-20220130094714257" loading="lazy"></p>
<ul>
<li>class fileå­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºè®¾è®¡å¸ˆç”»åœ¨çº¸ä¸Šçš„æ¨¡æ¿ï¼Œè€Œæœ€ç»ˆè¿™ä¸ªæ¨¡æ¿åœ¨æ‰§è¡Œçš„æ—¶å€™æ˜¯è¦åŠ è½½åˆ°JVMå½“ä¸­æ¥æ ¹æ®è¿™ä¸ªæ–‡ä»¶å®ä¾‹åŒ–å‡ºnä¸ªä¸€æ¨¡ä¸€æ ·çš„å®ä¾‹ã€‚</li>
<li>class fileåŠ è½½åˆ°JVMä¸­ï¼Œè¢«ç§°ä¸ºDNAå…ƒæ•°æ®æ¨¡æ¿ï¼Œå­˜æ”¾åœ¨æ–¹æ³•åŒºï¼Œ</li>
<li>åœ¨.classæ–‡ä»¶-&gt; JVM-&gt;æœ€ç»ˆæˆä¸ºå…ƒæ•°æ®æ¨¡æ¿ï¼Œæ­¤è¿‡ç¨‹éœ€è¦ä¸€ä¸ªè¿è¾“æ ¹æ®ï¼ˆç±»åŠ è½½å™¨Class Loaderï¼‰ï¼Œæ‰®æ¼”ä¸€ä¸ªå¿«é€’å‘˜çš„è§’è‰²ã€‚</li>
</ul>
<p><strong>ç±»çš„åŠ è½½è¿‡ç¨‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æµç¨‹å›¾è¡¨ç¤ºä¸Šè¿°ç¤ºä¾‹ä»£ç ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220130095235833.png" alt="image-20220130095235833" loading="lazy"></p>
<h4 id="åŠ è½½é˜¶æ®µ"><a href="#åŠ è½½é˜¶æ®µ" class="headerlink" title="åŠ è½½é˜¶æ®µ"></a>åŠ è½½é˜¶æ®µ</h4><p><img src="/2022/04/18/JVM/image-20220130100539779.png" alt="image-20220130100539779" loading="lazy"></p>
<ul>
<li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šæ˜è·å–å®šä¹‰æ¬¡æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li>
<li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</li>
<li>åœ¨å†…å­˜ä¸­å­˜æ”¾ä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒClasså¯¹è±¡æ˜¯åœ¨åŠ è½½é˜¶æ®µå°±ç”Ÿæˆçš„ï¼‰</li>
</ul>
<p><strong>è¡¥å……ï¼šåŠ è½½classæ–‡ä»¶çš„æ–¹å¼</strong></p>
<ul>
<li><p>ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</p>
</li>
<li><p>é€šè¿‡ç½‘ç»œè·å–ï¼Œå…¸å‹åœºæ™¯ï¼šWeb Applet</p>
</li>
<li><p>ä»zipå‹ç¼©åŒ…ä¸­è¯»å–ï¼Œæˆä¸ºæ—¥åjarã€waræ ¼å¼çš„åŸºç¡€</p>
</li>
<li><p>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ï¼šåŠ¨æ€ä»£ç†æŠ€æœ¯</p>
</li>
<li><p>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯ï¼šJSPåº”ç”¨</p>
</li>
<li><p>ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶ï¼Œæ¯”è¾ƒå°‘è§</p>
</li>
<li><p>ä»åŠ å¯†æ–‡ä»¶ä¸­è·å–ï¼Œå…¸å‹çš„é˜²Classæ–‡ä»¶è¢«åç¼–è¯‘çš„ä¿æŠ¤æªæ–½</p>
</li>
</ul>
<h4 id="é“¾æ¥é˜¶æ®µ"><a href="#é“¾æ¥é˜¶æ®µ" class="headerlink" title="é“¾æ¥é˜¶æ®µ"></a>é“¾æ¥é˜¶æ®µ</h4><ul>
<li><strong>éªŒè¯ï¼ˆVerifyï¼‰</strong>ï¼š <ul>
<li>ç›®çš„åœ¨å­ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµæ–‡ä»¶åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚</li>
<li>ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</li>
</ul>
</li>
<li><strong>å‡†å¤‡ï¼ˆPrepareï¼‰</strong>ï¼š <ul>
<li>ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®è¯¥å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼Œä¾‹å¦‚ï¼šintç±»å‹ä¸º0ã€‚</li>
<li>è¿™é‡Œæ˜¯æŒ‡çš„æ˜¯å˜é‡ï¼Œå¦‚æœæ˜¯å¸¸é‡å°±ç›´æ¥èµ‹å€¼ï¼Œå³æ˜¾ç¤ºåˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼šç”¨finalä¿®é¥°çš„staticå€¼ã€‚</li>
<li>è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåœ¨åˆ†é…æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°å †ä¸­ã€‚</li>
</ul>
</li>
<li><strong>è§£æï¼ˆResolveï¼‰</strong><ul>
<li>å°†å¸¸é‡æ± æçš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</li>
<li>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹ååœ¨æ‰§è¡Œã€‚</li>
<li>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚ç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€Šjavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</li>
<li>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ç­‰ã€‚å¯¹åº”å¸¸é‡æ± ä¸­çš„CONSTANT_Class_infoï¼ŒCONSTANT_Fieldref_infoã€CONSTANT_Methodref_infoç­‰ã€‚</li>
</ul>
</li>
</ul>
<h4 id="åˆå§‹åŒ–é˜¶æ®µ"><a href="#åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µ"></a>åˆå§‹åŒ–é˜¶æ®µ</h4><ul>
<li>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ æ–¹æ³•<clinit>()çš„è¿‡ç¨‹</clinit></li>
<li>æ­¤æ–¹æ³•ä¸éœ€è¦å®šä¹‰ï¼Œï¼Œæ˜¯javacç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥çš„ã€‚ï¼ˆå¦‚æœæ²¡æœ‰é™æ€ä»£ç å°±æ²¡æœ‰<clinit>ï¼ˆï¼‰æ–¹æ³•ï¼‰</clinit></li>
<li>æ„é€ å™¨æ–¹æ³•ä¸­æŒ‡ä»¤æŒ‰ç…§è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œã€‚</li>
<li><clinit>()ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚ï¼ˆå…³è”ï¼šæ„é€ å™¨æ˜¯è™šæ‹Ÿæœºè§†è§’ä¸‹çš„<init>()ï¼‰</init></clinit></li>
<li>è‹¥è¯¥ç±»æœ‰çˆ¶ç±»ï¼ŒJVMä¼šä¿è¯å­ç±»çš„<clinit>()æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<clinit>()å·²ç»æ‰§è¡Œå®Œæ¯•</clinit></clinit></li>
<li>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<clinit>()æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”ã€‚</clinit></li>
</ul>
<h3 id="3ï¼Œç±»åŠ è½½å™¨åˆ†ç±»"><a href="#3ï¼Œç±»åŠ è½½å™¨åˆ†ç±»" class="headerlink" title="3ï¼Œç±»åŠ è½½å™¨åˆ†ç±»"></a>3ï¼Œç±»åŠ è½½å™¨åˆ†ç±»</h3><p>JVMæ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ã€‚åˆ†åˆ«ä¸º<strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰ã€‚</strong></p>
<p>ä»æ¦‚å¿µä¸Šè®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æ˜¯æŒ‡ç¨‹åºå‘˜ä¸­æœ‰å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯<strong>å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</strong></p>
<p>æ— è®ºç±»åŠ è½½å™¨å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨åªæœ‰ä¸‰ç§ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220130162152331.png" alt="image-20220130162152331" loading="lazy"></p>
<ul>
<li>Bootstrap ClassLoaderï¼šå¼•å¯¼ç±»åŠ è½½å™¨</li>
<li>Extension ClassLoaderï¼šæ‰©å±•ç±»åŠ è½½å™¨</li>
<li>System ClassLoaderï¼šç³»ç»Ÿç±»åŠ è½½å™¨</li>
<li>User Defined ClassLoaderï¼šç”¨æˆ·è‡ªå®šä¹‰åŠ è½½å™¨</li>
<li>è¿™é‡Œçš„å››è€…ä¹‹é—´çš„å…³ç³»æ˜¯åŒ…å«å…³ç³»ã€‚ä¸æ˜¯ä¸Šå±‚ä¸‹å±‚ï¼Œä¹Ÿ<strong>ä¸æ˜¯å­çˆ¶ç±»çš„ç»§æ‰¿å…³ç³»</strong>ã€‚</li>
</ul>
<h4 id="3-1ï¼Œè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨"><a href="#3-1ï¼Œè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨" class="headerlink" title="3.1ï¼Œè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨"></a>3.1ï¼Œè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨</h4><p><strong>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBootstrap ClassLoaderï¼‰</strong></p>
<ul>
<li><p>è¿™ä¸ªç±»åŠ è½½<strong>ä½¿ç”¨C/C++è¯­è¨€å®ç°çš„</strong>ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨ã€‚</p>
</li>
<li><p>å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆJAVA_HOME/jre/lib/rt.jarã€resources.jaræˆ–sun.boot.class.pathè·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»</p>
</li>
<li><p>å¹¶ä¸ç»§æ‰¿è‡ªJava.lang.ClassLoaderï¼Œ<strong>æ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚ï¼ˆå› ä¸ºä»–æ˜¯cå†™çš„æ‰€ä»¥ä¸å­˜åœ¨è¿™äº›ï¼‰</strong></p>
</li>
<li><p><strong>åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</strong>ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
</li>
<li><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€javaxã€sunç­‰å¼€å¤´çš„ç±»</p>
</li>
</ul>
<p><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></p>
<ul>
<li><p>Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚</p>
</li>
<li><p>æ´¾ç”ŸäºClassLoaderç±»</p>
</li>
<li><p>çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨</p>
</li>
<li><p>ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„jre/1ib/extå­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„JARæ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
</li>
</ul>
<p><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰</strong></p>
<ul>
<li><p>javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.LaunchersAppClassLoaderå®ç°</p>
</li>
<li><p>æ´¾ç”ŸäºClassLoaderç±»</p>
</li>
<li><p>çˆ¶ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨</p>
</li>
<li><p>å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡classpathæˆ–ç³»ç»Ÿå±æ€§java.class.pathæŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“</p>
</li>
<li><p>è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒJavaåº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½</p>
</li>
<li><p>é€šè¿‡ClassLoader#getSystemclassLoader() æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.tracing.Provider;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Launcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: JVMä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: ClassLoaderTest1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¯åŠ¨ç±»åŠ è½½å™¨å’Œæ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: èµµå…ˆç”Ÿ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/1/30 16:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*********å¯åŠ¨ç±»åŠ è½½å™¨***********&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å¯åŠ¨ç±»åŠ è½½å™¨èƒ½å¤ŸåŠ è½½çš„è·¯å¾„</span></span><br><span class="line">        URL[] urLs = Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">        <span class="keyword">for</span> (URL urL : urLs) &#123;</span><br><span class="line">            <span class="comment">//åˆ°å¤–éƒ¨å½¢å¼file:/C:/Program%20Files/Java/jdk1.8.0_281/jre/lib/rt.jar</span></span><br><span class="line">            System.out.println(urL.toExternalForm());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä»ä¸Šé¢çš„è·¯å¾„ä¸­éšæ„é€‰æ‹©ä¸€ä¸ªç±»ï¼Œçœ‹å®ƒçš„åŠ è½½å™¨æ˜¯ä»€ä¹ˆã€‚è‹¥æ˜¯ä¸ºç©ºåˆ™æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Provider.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;*********æ‰©å±•ç±»åŠ è½½å™¨**************&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å±æ€§</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">extDirs</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.ext.dirs&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String path : extDirs.split(<span class="string">&quot;;&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//å¾—åˆ°çš„å€¼æ˜¯æ‰©å±•ç±»åŠ è½½å™¨èƒ½å¤ŸåŠ è½½çš„è·¯å¾„</span></span><br><span class="line">            System.out.println(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#3-2ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="3.2ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>3.2ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ï¼Œåœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚ ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</p>
<ul>
<li><p>éš”ç¦»åŠ è½½ç±»</p>
</li>
<li><p>ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼</p>
</li>
<li><p>æ‰©å±•åŠ è½½æº</p>
</li>
<li><p>é˜²æ­¢æºç æ³„æ¼</p>
</li>
</ul>
<p>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤ï¼š</p>
<ol>
<li>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±»ava.lang.ClassLoaderç±»çš„æ–¹å¼ï¼Œå®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚</li>
<li>åœ¨JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ClassLoaderç±»å¹¶é‡å†™loadClass() æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ï¼Œä½†æ˜¯åœ¨JDK1.2ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›–loadclass() æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨findClass()æ–¹æ³•ä¸­</li>
<li>åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿URLClassLoaderç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™findClass()  æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œä½¿è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´åŠ ç®€æ´ã€‚</li>
</ol>
<p><strong>ä»£ç æ¼”ç¤ºï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: JVMä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: CustomClassLoader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: èµµå…ˆç”Ÿ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/1/30 16:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] result = getClassFromCustomPath(name);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileNotFoundException</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> defineClass(name,result,<span class="number">0</span>,result.length);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getClassFromCustomPath(String name) &#123;</span><br><span class="line">        <span class="comment">//ä»è‡ªå®šä¹‰è·¯å¾„ä¸­åŠ è½½æŒ‡å®šç±»ï¼šç»†èŠ‚å¿½ç•¥</span></span><br><span class="line">        <span class="comment">//å¦‚æœæŒ‡å®šè·¯å¾„çš„å­—èŠ‚ç è¿›è¡Œäº†åŠ å¯†ï¼Œåˆ™éœ€è¦å†æ¬¡æ–¹æ³•è¿›è¡Œè§£ç æ“ä½œã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">CustomClassLoader</span> <span class="variable">customClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomClassLoader</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;one&quot;</span>, <span class="literal">true</span>, customClassLoader);</span><br><span class="line">            <span class="comment">//é€šè¿‡ç±»åˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">            System.out.println(obj.getClass().getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4ï¼ŒClassLoaderçš„ä½¿ç”¨è¯´æ˜"><a href="#4ï¼ŒClassLoaderçš„ä½¿ç”¨è¯´æ˜" class="headerlink" title="4ï¼ŒClassLoaderçš„ä½¿ç”¨è¯´æ˜"></a>4ï¼ŒClassLoaderçš„ä½¿ç”¨è¯´æ˜</h3><p>ClassLoaderç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶å<strong>æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoader</strong>ï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¯´åŠ è½½å™¨åˆ†ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åŸå› ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220130171229529.png" alt="image-20220130171229529" loading="lazy"></p>
<p>sun.misc.Launcher å®ƒæ˜¯ä¸€ä¸ªjavaè™šæ‹Ÿæœºçš„å…¥å£åº”ç”¨<img src="/2022/04/18/JVM/image-20220130171251333.png" alt="image-20220130171251333" loading="lazy"></p>
<p>è·å–ClassLoaderçš„é€”å¾„</p>
<p>â— æ–¹å¼ä¸€ï¼šè·å–å½“å‰ClassLoader  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clazz.getClassLoader()</span><br></pre></td></tr></table></figure>

<p>â— æ–¹å¼äºŒï¼šè·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ClassLoader  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.currentThread().getContextClassLoader()</span><br></pre></td></tr></table></figure>

<p>â— æ–¹å¼ä¸‰ï¼šè·å–ç³»ç»Ÿçš„ClassLoader  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader.getSystemClassLoader()</span><br></pre></td></tr></table></figure>

<p>â— æ–¹å¼å››ï¼šè·å–è°ƒç”¨è€…çš„ClassLoader  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.getCallerClassLoader()</span><br></pre></td></tr></table></figure>



<h3 id="5ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶"><a href="#5ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="5ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶"></a>5ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶</h3><p>Javaè™šæ‹Ÿæœºå¯¹classæ–‡ä»¶é‡‡ç”¨çš„æ˜¯<strong>æŒ‰éœ€åŠ è½½</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆclasså¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼ŒJavaè™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯<strong>åŒäº²å§”æ´¾æ¨¡å¼</strong>ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong></p>
<ul>
<li>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼›</li>
<li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼›</li>
<li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220130213724290.png" alt="image-20220130213724290" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹</strong></p>
<p>å½“æˆ‘ä»¬åŠ è½½jdbc.jar ç”¨äºå®ç°æ•°æ®åº“è¿æ¥çš„æ—¶å€™ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ jdbc.jaræ˜¯åŸºäºSPIæ¥å£è¿›è¡Œå®ç°çš„ï¼Œæ‰€ä»¥åœ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šè¿›è¡ŒåŒäº²å§”æ´¾ï¼Œæœ€ç»ˆä»æ ¹åŠ è½½å™¨ä¸­åŠ è½½ SPIæ ¸å¿ƒç±»ï¼Œç„¶ååœ¨åŠ è½½SPIæ¥å£ç±»ï¼Œæ¥ç€åœ¨è¿›è¡Œåå‘å§”æ´¾ï¼Œé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¿›è¡Œå®ç°jdbc.jarçš„åŠ è½½ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220130213807607.png" alt="image-20220130213807607" loading="lazy"></p>
<p><strong>ä¼˜åŠ¿</strong></p>
<ul>
<li><p>é¿å…ç±»çš„é‡å¤åŠ è½½</p>
<ul>
<li>æ¯”å¦‚è¯´ä¸€ä¸ªç±»ä½ è¦åŠ è½½ï¼Œä»–é¦–å…ˆåˆ°äº†é¡¶å±‚ï¼Œå¦‚æœé¡¶å±‚å¯ä»¥åŠ è½½å°±è¿›è¡ŒåŠ è½½ï¼Œä¸èƒ½åŠ è½½å°±å¾€ä¸‹æ¨ï¼Œè¿™æ ·ä¿è¯åªåŠ è½½ä¸€æ¬¡</li>
</ul>
</li>
<li><p>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ </p>
</li>
<li><ul>
<li>è‡ªå®šä¹‰ç±»ï¼šjava.lang.String<ul>
<li>æ”¾ç¯¡æ”¹ï¼Œå°±æ˜¯è¯´å¦‚æœä½ è‡ªå®šä¹‰äº†ä¸€ä¸ªStringç±»ï¼Œé‚£ä¹ˆåœ¨åŠ è½½çš„æ—¶å€™ï¼Œå› ä¸ºåŒäº²å§”æ´¾æœºåˆ¶çš„å­˜åœ¨ï¼Œä»–ä¼šå…ˆäº¤ç»™å¼•ç”¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·å­å°±è·³è¿‡äº†ä½ è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>è‡ªå®šä¹‰ç±»ï¼šjava.lang.ShkStartï¼ˆæŠ¥é”™ï¼šé˜»æ­¢åˆ›å»º java.langå¼€å¤´çš„ç±»ï¼‰<ul>
<li>è¿™æ ·å­å°±ä¿è¯æ²¡æœ‰å¤–éƒ¨ç¨‹åºå¨èƒåˆ°Javaè™šæ‹Ÿæœºçš„å®‰å…¨è¿è¡Œï¼Œèµ·åˆ°äº†ä¿æŠ¤ä½œç”¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>æ²™ç®±å®‰å…¨æœºåˆ¶</strong></p>
<p>è‡ªå®šä¹‰Stringç±»ï¼Œä½†æ˜¯åœ¨åŠ è½½è‡ªå®šä¹‰Stringç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½jdkè‡ªå¸¦çš„æ–‡ä»¶ï¼ˆrt.jaråŒ…ä¸­java\lang\String.classï¼‰ï¼ŒæŠ¥é”™ä¿¡æ¯è¯´æ²¡æœ‰mainæ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºåŠ è½½çš„æ˜¯rt.jaråŒ…ä¸­çš„stringç±»ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¯¹javaæ ¸å¿ƒæºä»£ç çš„ä¿æŠ¤ï¼Œè¿™å°±æ˜¯æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚</p>
<p>å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠæœ€é‡è¦çš„ä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªç›’å­é‡Œï¼Œåˆ«çš„æ¶æ„ä»£ç æ— æ³•è¿›å…¥ï¼Œè¿™æ ·å­å°±ä¿è¯ä»–çš„å®‰å…¨æ€§ã€‚</p>
<h3 id="6ï¼Œå…¶ä»–"><a href="#6ï¼Œå…¶ä»–" class="headerlink" title="6ï¼Œå…¶ä»–"></a>6ï¼Œå…¶ä»–</h3><p><strong>å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦ç›¸åŒ</strong></p>
<p>åœ¨JVMä¸­è¡¨ç¤ºä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼š</p>
<ul>
<li><p>ç±»çš„å®Œæ•´ç±»åå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬åŒ…åã€‚</p>
</li>
<li><p>åŠ è½½è¿™ä¸ªç±»çš„ClassLoaderï¼ˆæŒ‡ClassLoaderå®ä¾‹å¯¹è±¡ï¼‰å¿…é¡»ç›¸åŒã€‚</p>
</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼Œåœ¨JVMä¸­ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»å¯¹è±¡ï¼ˆclasså¯¹è±¡ï¼‰æ¥æºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹Ÿæœºæ‰€åŠ è½½ï¼Œä½†åªè¦åŠ è½½å®ƒä»¬çš„ClassLoaderå®ä¾‹å¯¹è±¡ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p>
<p><strong>å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨</strong></p>
<p>JVMå¿…é¡»çŸ¥é“ä¸€ä¸ªç±»å‹æ˜¯ç”±å¯åŠ¨åŠ è½½å™¨åŠ è½½çš„è¿˜æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚<u>å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œé‚£ä¹ˆJVMä¼šå°†è¿™ä¸ªç±»åŠ è½½å™¨çš„ä¸€ä¸ªå¼•ç”¨ä½œä¸ºç±»å‹ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ä¿å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚</u>å½“è§£æä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨çš„æ—¶å€™ï¼ŒJVMéœ€è¦ä¿è¯è¿™ä¸¤ä¸ªç±»å‹çš„ç±»åŠ è½½å™¨æ˜¯ç›¸åŒçš„ã€‚</p>
<p><strong>ç±»çš„ä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨</strong></p>
<p>Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼åˆ†ä¸ºï¼šä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨ã€‚</p>
<p>ä¸»åŠ¨ä½¿ç”¨ï¼Œåˆåˆ†ä¸ºä¸ƒç§æƒ…å†µï¼š</p>
<ul>
<li><p> åˆ›å»ºç±»çš„å®ä¾‹ </p>
</li>
<li><p> è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼ </p>
</li>
<li><p> è°ƒç”¨ç±»çš„é™æ€æ–¹æ³• </p>
</li>
<li><p> åå°„ï¼ˆæ¯”å¦‚ï¼šClass.forNameï¼ˆâ€com.atguigu.Testâ€ï¼‰ï¼‰ </p>
</li>
<li><p> åˆå§‹åŒ–ä¸€ä¸ªç±»çš„å­ç±» </p>
</li>
<li><p> Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±» </p>
</li>
<li><p>JDK 7 å¼€å§‹æä¾›çš„åŠ¨æ€è¯­è¨€æ”¯æŒï¼š<br> java.lang.invoke.MethodHandleå®ä¾‹çš„è§£æç»“æœ<br> REF_getStaticã€REF_putStaticã€REF_invokeStaticå¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ– </p>
</li>
</ul>
<p>é™¤äº†ä»¥ä¸Šä¸ƒç§æƒ…å†µï¼Œå…¶ä»–ä½¿ç”¨Javaç±»çš„æ–¹å¼éƒ½è¢«çœ‹ä½œæ˜¯å¯¹ç±»çš„è¢«åŠ¨ä½¿ç”¨ï¼Œéƒ½<u>ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ã€‚</u></p>
<h2 id="ä¸‰ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨"><a href="#ä¸‰ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ä¸‰ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨"></a>ä¸‰ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŠç¨‹åºè®¡æ•°å™¨</h2><h3 id="1ï¼Œè¿è¡Œæ—¶æ•°æ®åŒº"><a href="#1ï¼Œè¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="1ï¼Œè¿è¡Œæ—¶æ•°æ®åŒº"></a>1ï¼Œè¿è¡Œæ—¶æ•°æ®åŒº</h3><h4 id="1-1ï¼Œæ¦‚è¿°"><a href="#1-1ï¼Œæ¦‚è¿°" class="headerlink" title="1.1ï¼Œæ¦‚è¿°"></a>1.1ï¼Œæ¦‚è¿°</h4><p><img src="/2022/04/18/JVM/image-20220201195559400.png" alt="image-20220201195559400" loading="lazy"></p>
<p>å½“æˆ‘ä»¬é€šè¿‡å‰é¢çš„ï¼šç±»çš„åŠ è½½-&gt; éªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ -&gt; åˆå§‹åŒ– è¿™å‡ ä¸ªé˜¶æ®µå®Œæˆåï¼ˆç±»åŠ è½½å™¨ï¼‰ï¼Œå°±ä¼šç”¨åˆ°æ‰§è¡Œå¼•æ“å¯¹æˆ‘ä»¬çš„ç±»è¿›è¡Œä½¿ç”¨ï¼ŒåŒæ—¶æ‰§è¡Œå¼•æ“å°†ä¼šä½¿ç”¨åˆ°æˆ‘ä»¬è¿è¡Œæ—¶æ•°æ®åŒºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201195709773.png" alt="image-20220201195709773" loading="lazy"></p>
<p>å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’ŒCPUçš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡Œï¼ŒJVMå†…å­˜å¸ƒå±€è§„å®šäº†Javaåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ï¼Œåˆ†é…ï¼Œç®¡ç†çš„æ”¿ç­–ï¼Œä¿è¯äº†JVMçš„é«˜æ•ˆç¨³å®šçš„è¿è¡Œã€‚ä¸åŒçš„JVMå¯¹äºå†…å­˜çš„åˆ’åˆ†æ–¹å¼å’Œç®¡ç†æœºåˆ¶å­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚ã€‚ç»“åˆJVMè™šæ‹Ÿæœºè§„èŒƒï¼Œæ¥æ¢è®¨ä¸€ä¸‹ç»å…¸çš„JVMå†…å­˜å¸ƒå±€ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201200201823.png" alt="image-20220201200201823" loading="lazy"></p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå¤§å¨æ¯”ä½œæ‰§è¡Œå¼•æ“ï¼Œè€Œåé¢çš„ä¸œè¥¿å°±æ˜¯æˆ‘ä»¬çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§å¨è¦ç‚’èœï¼Œä»–å¿…é¡»è¦æŠŠé£Ÿæå‡†å¤‡å¥½ï¼Œè¿™æ ·å­å°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡Œå³æ—¶çš„è°ƒæ•´å’Œä½¿ç”¨ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201200252799.png" alt="image-20220201200252799" loading="lazy"></p>
<p>æˆ‘ä»¬é€šè¿‡ç£ç›˜æˆ–è€…ç½‘ç»œIOå¾—åˆ°çš„æ•°æ®ï¼Œéƒ½éœ€è¦å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åCPUä»å†…å­˜ä¸­è·å–æ•°æ®è¿›è¡Œè¯»å–ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜å……å½“äº†CPUå’Œç£ç›˜ä¹‹é—´çš„æ¡¥æ¢</p>
<p><img src="/2022/04/18/JVM/image-20220201200533082.png" alt="image-20220201200533082" loading="lazy"></p>
<p>Javaè™šæ‹Ÿæœºå®šä¹‰äº†è‹¥å¹²ç§ç¨‹åºè¿è¡ŒæœŸé—´ä¼šä½¿ç”¨åˆ°çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¼šéšç€è™šæ‹Ÿæœºçš„å¯åŠ¨è€Œåˆ›å»ºï¼Œéšç€è™šæ‹Ÿæœºçš„é”€æ¯è€Œé”€æ¯ï¼Œæœ‰äº›åˆ™æ˜¯ä¸çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿™äº›ä¸çº¿ç¨‹å¯¹åº”çš„æ•°æ®åŒºåŸŸä¼šéšç€çº¿ç¨‹çš„å¼€å§‹å’Œç»“æŸè€Œåˆ›å»ºå’Œé”€æ¯ã€‚</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹å•ç‹¬æ‹¥æœ‰çš„æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Œæ ˆï¼Œæœ¬åœ°æ ˆã€‚</li>
<li>çº¿ç¨‹å…±äº«ï¼šå †ï¼Œå †å¤–å†…å­˜ï¼ˆæ°¸ä¹…ä»£æˆ–è€…å…ƒç©ºé—´ï¼Œä»£ç ç¼“å­˜ï¼‰</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220201201036022.png" alt="image-20220201201036022" loading="lazy"></p>
<p>æ¯ä¸ªJVMåªæœ‰ä¸€ä¸ªRuntimeå®ä¾‹ã€‚å³ä¸ºè¿è¡Œæ—¶ç¯å¢ƒï¼Œç›¸å½“äºå†…å­˜ç»“æ„çš„ä¸­é—´çš„é‚£ä¸ªæ¡†æ¡†ï¼šè¿è¡Œæ—¶ç¯å¢ƒã€‚</p>
<h4 id="1-2ï¼Œçº¿ç¨‹"><a href="#1-2ï¼Œçº¿ç¨‹" class="headerlink" title="1.2ï¼Œçº¿ç¨‹"></a>1.2ï¼Œçº¿ç¨‹</h4><p>çº¿ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºé‡Œçš„è¿è¡Œå•å…ƒã€‚JVMå…è®¸ä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„æ‰§è¡Œã€‚ åœ¨Hotspot JVMé‡Œï¼Œ<u>æ¯ä¸ªçº¿ç¨‹éƒ½ä¸æ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ç›´æ¥æ˜ å°„ã€‚</u></p>
<p>å½“ä¸€ä¸ªJavaçº¿ç¨‹å‡†å¤‡å¥½æ‰§è¡Œä»¥åï¼Œæ­¤æ—¶ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ä¹ŸåŒæ—¶åˆ›å»ºã€‚Javaçº¿ç¨‹æ‰§è¡Œç»ˆæ­¢åï¼Œæœ¬åœ°çº¿ç¨‹ä¹Ÿä¼šå›æ”¶ã€‚</p>
<p>æ“ä½œç³»ç»Ÿè´Ÿè´£æ‰€æœ‰çº¿ç¨‹çš„å®‰æ’è°ƒåº¦åˆ°ä»»ä½•ä¸€ä¸ªå¯ç”¨çš„CPUä¸Šã€‚ä¸€æ—¦æœ¬åœ°çº¿ç¨‹åˆå§‹åŒ–æˆåŠŸï¼Œå®ƒå°±ä¼šè°ƒç”¨Javaçº¿ç¨‹ä¸­çš„run()æ–¹æ³•ã€‚</p>
<h4 id="1-3ï¼ŒJVMç³»ç»Ÿçº¿ç¨‹"><a href="#1-3ï¼ŒJVMç³»ç»Ÿçº¿ç¨‹" class="headerlink" title="1.3ï¼ŒJVMç³»ç»Ÿçº¿ç¨‹"></a>1.3ï¼ŒJVMç³»ç»Ÿçº¿ç¨‹</h4><p>å¦‚æœä½ ä½¿ç”¨consoleæˆ–è€…æ˜¯ä»»ä½•ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œéƒ½èƒ½çœ‹åˆ°åœ¨åå°æœ‰è®¸å¤šçº¿ç¨‹åœ¨è¿è¡Œã€‚è¿™äº›åå°çº¿ç¨‹ä¸åŒ…æ‹¬è°ƒç”¨<code>public static void main(String[] args)</code>çš„mainçº¿ç¨‹ä»¥åŠæ‰€æœ‰è¿™ä¸ªmainçº¿ç¨‹è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ã€‚</p>
<p>è¿™äº›ä¸»è¦çš„åå°ç³»ç»Ÿçº¿ç¨‹åœ¨Hotspot JVMé‡Œä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li><p>è™šæ‹Ÿæœºçº¿ç¨‹ï¼šè¿™ç§çº¿ç¨‹çš„æ“ä½œæ˜¯éœ€è¦JVMè¾¾åˆ°å®‰å…¨ç‚¹æ‰ä¼šå‡ºç°ã€‚è¿™äº›æ“ä½œå¿…é¡»åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å‘ç”Ÿçš„åŸå› æ˜¯ä»–ä»¬éƒ½éœ€è¦JVMè¾¾åˆ°å®‰å…¨ç‚¹ï¼Œè¿™æ ·å †æ‰ä¸ä¼šå˜åŒ–ã€‚è¿™ç§çº¿ç¨‹çš„æ‰§è¡Œç±»å‹åŒ…æ‹¬â€stop-the-worldâ€çš„åƒåœ¾æ”¶é›†ï¼Œçº¿ç¨‹æ ˆæ”¶é›†ï¼Œçº¿ç¨‹æŒ‚èµ·ä»¥åŠåå‘é”æ’¤é”€ã€‚</p>
</li>
<li><p>å‘¨æœŸä»»åŠ¡çº¿ç¨‹ï¼šè¿™ç§çº¿ç¨‹æ˜¯æ—¶é—´å‘¨æœŸäº‹ä»¶çš„ä½“ç°ï¼ˆæ¯”å¦‚ä¸­æ–­ï¼‰ï¼Œä»–ä»¬ä¸€èˆ¬ç”¨äºå‘¨æœŸæ€§æ“ä½œçš„è°ƒåº¦æ‰§è¡Œã€‚</p>
</li>
<li><p>GCçº¿ç¨‹ï¼šè¿™ç§çº¿ç¨‹å¯¹åœ¨JVMé‡Œä¸åŒç§ç±»çš„åƒåœ¾æ”¶é›†è¡Œä¸ºæä¾›äº†æ”¯æŒã€‚</p>
</li>
<li><p>ç¼–è¯‘çº¿ç¨‹ï¼šè¿™ç§çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå°†å­—èŠ‚ç ç¼–è¯‘æˆåˆ°æœ¬åœ°ä»£ç ã€‚</p>
</li>
<li><p>ä¿¡å·è°ƒåº¦çº¿ç¨‹ï¼šè¿™ç§çº¿ç¨‹æ¥æ”¶ä¿¡å·å¹¶å‘é€ç»™JVMï¼Œåœ¨å®ƒå†…éƒ¨é€šè¿‡è°ƒç”¨é€‚å½“çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="2ï¼Œç¨‹åºè®¡æ•°å™¨-PCå¯„å­˜å™¨"><a href="#2ï¼Œç¨‹åºè®¡æ•°å™¨-PCå¯„å­˜å™¨" class="headerlink" title="2ï¼Œç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)"></a>2ï¼Œç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)</h3><p>JVMä¸­çš„ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆProgram Counter Registerï¼‰ä¸­ï¼ŒRegisterçš„å‘½åæºäºCPUçš„å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„ç°åœºä¿¡æ¯ã€‚CPUåªæœ‰æŠŠæ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ä¸­æ‰èƒ½å¤Ÿè¿è¡Œã€‚è¿™é‡Œï¼Œå¹¶ä¸æ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œæˆ–è®¸å°†å…¶ç¿»è¯‘ä¸ºPCè®¡æ•°å™¨ï¼ˆæˆ–æŒ‡ä»¤è®¡æ•°å™¨ï¼‰æ›´ä¸ºè´´åˆ‡ï¼ˆä¹Ÿç§°ä¸ºç¨‹åºé’©å­ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·ä¸€äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚JVMä¸­çš„PCå¯„å­˜å™¨æ˜¯å¯¹ç‰©ç†PCå¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿï¼ˆè½¯ä»¶å±‚æ¬¡ï¼‰ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201210314375.png" alt="image-20220201210314375" loading="lazy"></p>
<p><strong>ä½œç”¨</strong></p>
<p>PCå¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201210345997.png" alt="image-20220201210345997" loading="lazy"></p>
<p>å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®°ã€‚ä¹Ÿæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸã€‚</p>
<p>åœ¨JVMè§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</p>
<p>ä»»ä½•æ—¶é—´ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å½“å‰æ–¹æ³•ã€‚ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„Javaæ–¹æ³•çš„JVMæŒ‡ä»¤åœ°å€ï¼›æˆ–è€…ï¼Œå¦‚æœæ˜¯åœ¨æ‰§è¡Œnativeæ–¹æ³•ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ï¼ˆundefinedï¼‰ã€‚</p>
<p>å®ƒæ˜¯ç¨‹åºæ§åˆ¶æµçš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p>
<p>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<p>å®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutofMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</p>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minus</span><span class="params">()</span>&#123;</span><br><span class="line">    intc = <span class="number">3</span>;</span><br><span class="line">    intd = <span class="number">4</span>; </span><br><span class="line">    <span class="keyword">return</span> c - d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å­—èŠ‚ç æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: iconst_3</span><br><span class="line"><span class="number">1</span>: istore_1</span><br><span class="line"><span class="number">2</span>: iconst_4</span><br><span class="line"><span class="number">3</span>: istore_2</span><br><span class="line"><span class="number">4</span>: iload_1</span><br><span class="line"><span class="number">5</span>: iload_2</span><br><span class="line"><span class="number">6</span>: isub</span><br><span class="line"><span class="number">7</span>: ireturn</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨PCå¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨PCå¯„å­˜å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œåœ°å€å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºCPUéœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªå¼€å§‹ç»§ç»­æ‰§è¡Œã€‚</p>
<p>JVMçš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜PCå¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201210529604.png" alt="image-20220201210529604" loading="lazy"></p>
<p><strong>PCå¯„å­˜å™¨ä¸ºä»€ä¹ˆè¢«è®¾å®šä¸ºç§æœ‰çš„ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“æ‰€è°“çš„å¤šçº¿ç¨‹åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µå†…åªä¼šæ‰§è¡Œå…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•ï¼ŒCPUä¼šä¸åœåœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿä¸ºäº†èƒ½å¤Ÿå‡†ç¡®åœ°è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæœ€å¥½çš„åŠæ³•è‡ªç„¶æ˜¯ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªPCå¯„å­˜å™¨ï¼Œè¿™æ ·ä¸€æ¥å„ä¸ªçº¿ç¨‹ä¹‹é—´ä¾¿å¯ä»¥è¿›è¡Œç‹¬ç«‹è®¡ç®—ï¼Œä»è€Œä¸ä¼šå‡ºç°ç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚</p>
<p>ç”±äºCPUæ—¶é—´ç‰‡è½®é™åˆ¶ï¼Œä¼—å¤šçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªå†…æ ¸ï¼Œåªä¼šæ‰§è¡ŒæŸä¸ªçº¿ç¨‹ä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p>è¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºåï¼Œéƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå¸§ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚</p>
<p><strong>PUæ—¶é—´ç‰‡</strong></p>
<p>CPUæ—¶é—´ç‰‡å³CPUåˆ†é…ç»™å„ä¸ªç¨‹åºçš„æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚</p>
<p>åœ¨å®è§‚ä¸Šï¼šä¿„ä»¬å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºå¹¶è¡Œä¸æ‚–ï¼ŒåŒæ—¶è¿è¡Œã€‚</p>
<p>ä½†åœ¨å¾®è§‚ä¸Šï¼šç”±äºåªæœ‰ä¸€ä¸ªCPUï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ç¨‹åºè¦æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä½•å¤„ç†å…¬å¹³ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¼•å…¥æ—¶é—´ç‰‡ï¼Œæ¯ä¸ªç¨‹åºè½®æµæ‰§è¡Œã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220201210828684.png" alt="image-20220201210828684" loading="lazy"></p>
<h2 id="å››ï¼Œè™šæ‹Ÿæœºæ ˆ"><a href="#å››ï¼Œè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="å››ï¼Œè™šæ‹Ÿæœºæ ˆ"></a>å››ï¼Œè™šæ‹Ÿæœºæ ˆ</h2><h3 id="1ï¼Œ-è™šæ‹Ÿæœºæ ˆæ¦‚è¿°"><a href="#1ï¼Œ-è™šæ‹Ÿæœºæ ˆæ¦‚è¿°" class="headerlink" title="1ï¼Œ è™šæ‹Ÿæœºæ ˆæ¦‚è¿°"></a>1ï¼Œ è™šæ‹Ÿæœºæ ˆæ¦‚è¿°</h3><h4 id="1-1ï¼Œè™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯"><a href="#1-1ï¼Œè™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯" class="headerlink" title="1.1ï¼Œè™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯"></a>1.1ï¼Œè™šæ‹Ÿæœºæ ˆå‡ºç°çš„èƒŒæ™¯</h4><p>ç”±äºè·¨å¹³å°æ€§çš„è®¾è®¡ï¼ŒJavaçš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ã€‚ä¸åŒå¹³å°çš„cpuæ¶æ„ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡æˆåŸºäºå¯„å­˜å™¨çš„ã€‚</p>
<p>ä¼˜ç‚¹æ˜¯è·¨å¹³å°ï¼ŒæŒ‡ä»¤é›†å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ã€‚</p>
<p>ç¼ºç‚¹æ˜¯æ€§èƒ½ä¸‹é™ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½éœ€è¦æ›´å¤šåœ°æŒ‡ä»¤ã€‚</p>
<h4 id="1-2ï¼Œåˆæ­¥å°è±¡"><a href="#1-2ï¼Œåˆæ­¥å°è±¡" class="headerlink" title="1.2ï¼Œåˆæ­¥å°è±¡"></a>1.2ï¼Œåˆæ­¥å°è±¡</h4><p>æœ‰ä¸å°‘Javaå¼€å‘äººå‘˜ä¸€æåˆ°Javaå†…å­˜ç»“æ„ï¼Œå°±ä¼šéå¸¸ç²—ç²’åº¦åœ°å°†JVMä¸­çš„å†…å­˜åŒºç†è§£ä¸ºä»…æœ‰Javaå †ï¼ˆheapï¼‰å’ŒJavaæ ˆï¼ˆstackï¼‰ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<h4 id="1-3ï¼Œ-å†…å­˜ä¸­çš„æ ˆä¸å †"><a href="#1-3ï¼Œ-å†…å­˜ä¸­çš„æ ˆä¸å †" class="headerlink" title="1.3ï¼Œ å†…å­˜ä¸­çš„æ ˆä¸å †"></a>1.3ï¼Œ å†…å­˜ä¸­çš„æ ˆä¸å †</h4><p>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œä¸æ˜¯å­˜å‚¨çš„å•ä½ã€‚</p>
<ul>
<li>æ ˆè§£å†³çš„æ˜¯è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œ æˆ–è€…è¯´æ˜¯å¦‚ä½•å¤„ç†æ•°æ®ã€‚</li>
<li>å¯¹è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ï¼Œæ”¾åœ¨å“ªé‡Œã€‚</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220204151934771.png" alt="image-20220204151934771" loading="lazy"></p>
<h4 id="1-4ï¼Œè™šæ‹Ÿæœºæ ˆçš„åŸºæœ¬å†…å®¹"><a href="#1-4ï¼Œè™šæ‹Ÿæœºæ ˆçš„åŸºæœ¬å†…å®¹" class="headerlink" title="1.4ï¼Œè™šæ‹Ÿæœºæ ˆçš„åŸºæœ¬å†…å®¹"></a>1.4ï¼Œè™šæ‹Ÿæœºæ ˆçš„åŸºæœ¬å†…å®¹</h4><p><strong>Javaè™šæ‹Ÿæœºæ ˆæ˜¯ä»€ä¹ˆ</strong></p>
<p>Javaè™šæ‹Ÿæœºæ ˆï¼Œæ—©æœŸä¹Ÿå«ä½œJavaæ ˆã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå…¶å†…éƒ¨ä¿å­˜ä¸€ä¸ªä¸ªçš„æ ˆå¸§ï¼Œå¯¹åº”ç€ä¸€æ¬¡æ¬¡çš„Javaæ–¹æ³•è°ƒç”¨ã€‚</p>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong></p>
<p>ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ã€‚</p>
<p><strong>ä½œç”¨</strong></p>
<p>ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œä»–ä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼Œéƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚</p>
<p><strong>æ ˆçš„ç‰¹ç‚¹</strong></p>
<p>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨ã€‚</p>
<p>JVMç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>æ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€è¿›æ ˆï¼ˆå…¥æ ˆï¼Œå‹æ ˆï¼‰</li>
<li>æ‰§è¡Œç»“æŸåçš„å‡ºæ ˆå·¥ä½œã€‚</li>
</ul>
<p>å¯¹äºæ ˆæ¥è¯´ä¸å­˜åœ¨åƒåœ¾å›æ”¶çš„é—®é¢˜ï¼ˆä½†æ˜¯å¯èƒ½ä¼šå‡ºç°æ ˆæº¢å‡ºçš„æƒ…å†µï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220204152951666.png" alt="image-20220204152951666" loading="lazy"></p>
<p><strong>é¢è¯•é¢˜ï¼šå¼€å‘ä¸­é‡åˆ°å“ªäº›å¼‚å¸¸ï¼Ÿ</strong></p>
<p>æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</p>
<ul>
<li><p>Javaè™šæ‹Ÿæœºæ ˆè§„èŒƒå…è®¸Javaæ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„ã€‚</p>
<ul>
<li>å¦‚æœé‡‡ç”¨å›ºå®šçš„å¤§å°ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªçº¿ç¨‹çš„Javaè™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡Javaè™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJavaè™šæ‹Ÿæœºæ ˆå°†ä¼šæŠ›å‡ºä¸€ä¸ªStack Overflow Errorçš„å¼‚å¸¸ã€‚</li>
<li>å¦‚æœé‡‡ç”¨çš„åŠ¨æ€æ‰©å±•ï¼Œå¹¶å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°åšè¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªOutOfMemoryErrorçš„å¼‚å¸¸ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    test();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    test();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸ï¼šException in thread&quot;main&quot;java.lang.StackoverflowError</span></span><br><span class="line"><span class="comment">//ç¨‹åºä¸æ–­çš„è¿›è¡Œé€’å½’è°ƒç”¨ï¼Œè€Œä¸”æ²¡æœ‰é€€å‡ºæ¡ä»¶ï¼Œå°±ä¼šå¯¼è‡´ä¸æ–­åœ°è¿›è¡Œå‹æ ˆã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>è®¾ç½®æ ˆå†…å­˜å¤§å°</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•° -Xssé€‰é¡¹æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackDeepTest</span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count=<span class="number">0</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">()</span>&#123;</span><br><span class="line">        count++; </span><br><span class="line">        recursion(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            recursion();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;deep of calling=&quot;</span>+count); </span><br><span class="line">            e.printstackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2ï¼Œæ ˆçš„å­˜å‚¨å•ä½"><a href="#2ï¼Œæ ˆçš„å­˜å‚¨å•ä½" class="headerlink" title="2ï¼Œæ ˆçš„å­˜å‚¨å•ä½"></a>2ï¼Œæ ˆçš„å­˜å‚¨å•ä½</h3><h4 id="2-1ï¼Œæ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ"><a href="#2-1ï¼Œæ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.1ï¼Œæ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ"></a>2.1ï¼Œæ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ</h4><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥æ ˆå¸§ï¼ˆStack Frameï¼‰çš„æ ¼å¼å­˜åœ¨çš„ã€‚</p>
<p>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªæ ˆå¸§ï¼ˆä¸€ä¸€å¯¹åº”ï¼‰ã€‚</p>
<p>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯ã€‚</p>
<h4 id="2-3ï¼Œæ ˆè¿è¡ŒåŸç†"><a href="#2-3ï¼Œæ ˆè¿è¡ŒåŸç†" class="headerlink" title="2.3ï¼Œæ ˆè¿è¡ŒåŸç†"></a>2.3ï¼Œæ ˆè¿è¡ŒåŸç†</h4><p>JVMç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å¯¹æ ˆå¸§çš„å‹æ ˆå’Œå‡ºæ ˆï¼Œéµå¾ªâ€œå…ˆè¿›åå‡ºâ€/â€œåè¿›å…ˆå‡ºâ€åŸåˆ™ã€‚</p>
<p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆæ ˆé¡¶æ ˆå¸§ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸ºå½“å‰æ ˆå¸§ï¼ˆCurrent Frameï¼‰ï¼Œä¸å½“å‰æ ˆå¸§ç›¸å¯¹åº”çš„æ–¹æ³•å°±æ˜¯å½“å‰æ–¹æ³•ï¼ˆCurrent Methodï¼‰ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯å½“å‰ç±»ï¼ˆCurrent Classï¼‰ã€‚</p>
<p><u>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œã€‚</u></p>
<p>æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œæˆä¸ºæ–°çš„å½“å‰å¸§ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220204163407269.png" alt="image-20220204163407269" loading="lazy"></p>
<p>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨çš„ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¹‹ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§ã€‚</p>
<p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§ã€‚</p>
<p>Javaæ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨returnæŒ‡ä»¤ï¼›å¦å¤–ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚ä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CurrentFrameTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>&#123;</span><br><span class="line">        system.out.printlnï¼ˆ<span class="string">&quot;å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•-&gt;methodA&quot;</span>);</span><br><span class="line">        methodB();</span><br><span class="line">        system.out.printlnï¼ˆ<span class="string">&quot;å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•-&gt;methodA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.printlnï¼ˆ<span class="string">&quot;å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•-&gt;methodB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4ï¼Œ-æ ˆå¸§çš„å†…éƒ¨ç»“æ„"><a href="#2-4ï¼Œ-æ ˆå¸§çš„å†…éƒ¨ç»“æ„" class="headerlink" title="2.4ï¼Œ æ ˆå¸§çš„å†…éƒ¨ç»“æ„"></a>2.4ï¼Œ æ ˆå¸§çš„å†…éƒ¨ç»“æ„</h4><p>æ¯ä¸ªæ ˆå¸§ä¸­å­˜å‚¨ç€ï¼š</p>
<ul>
<li><p><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼ˆLocal Variablesï¼‰</p>
</li>
<li><p><strong>æ“ä½œæ•°æ ˆ</strong>ï¼ˆoperand Stackï¼‰ï¼ˆæˆ–è¡¨è¾¾å¼æ ˆï¼‰</p>
</li>
<li><p>åŠ¨æ€é“¾æ¥ï¼ˆDynamicLinkingï¼‰ï¼ˆæˆ–æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰</p>
</li>
<li><p>æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ï¼ˆæˆ–æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–è€…å¼‚å¸¸é€€å‡ºçš„å®šä¹‰ï¼‰</p>
</li>
<li><p>ä¸€äº›é™„åŠ ä¿¡æ¯</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220204163611141.png" alt="image-20220204163611141" loading="lazy"></p>
<p>å¹¶è¡Œæ¯ä¸ªçº¿ç¨‹ä¸‹çš„æ ˆéƒ½æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±å„è‡ªçš„æ ˆï¼Œå¹¶ä¸”æ¯ä¸ªæ ˆé‡Œé¢éƒ½æœ‰å¾ˆå¤šæ ˆå¸§ï¼Œæ ˆå¸§çš„å¤§å°ä¸»è¦ç”±å±€éƒ¨å˜é‡è¡¨ å’Œ æ“ä½œæ•°æ ˆå†³å®šçš„ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220204163640763.png" alt="image-20220204163640763" loading="lazy"></p>
<h3 id="3ï¼Œå±€éƒ¨å˜é‡è¡¨-Local-Variables"><a href="#3ï¼Œå±€éƒ¨å˜é‡è¡¨-Local-Variables" class="headerlink" title="3ï¼Œå±€éƒ¨å˜é‡è¡¨(Local Variables)"></a>3ï¼Œå±€éƒ¨å˜é‡è¡¨(Local Variables)</h3><p>å±€éƒ¨å˜é‡è¡¨ä¹Ÿè¢«ç§°ä¸ºå±€éƒ¨å˜é‡æ•°ç»„æˆ–è€…æœ¬åœ°å˜é‡è¡¨</p>
<ul>
<li><strong>åº”ä»¥ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</strong>ï¼Œè¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»çš„åŸºæœ¬æ•°æ®ç±»å‹æ²¡å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œä»¥åŠreturnAddressç±»å‹ã€‚</li>
<li>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œå› æ­¤<strong>ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ã€‚</strong></li>
<li><strong>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€è¦çš„å®¹é‡çš„å¤§å°æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸç¡®å®šä¸‹æ¥çš„</strong>ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§çš„maximun local variableæ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</li>
<li><strong>æ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°ç”±æ ˆçš„å¤§å°å†³å®šçš„ã€‚</strong>ä¸€èˆ¬æ¥è¯´ï¼Œæ ˆè¶Šå¤§ï¼Œæ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°è¶Šå¤šã€‚å¯¹äºä¸€ä¸ªå‡½æ•°è€Œè¨€ï¼Œä»–çš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¶Šå¤šï¼Œä½¿å¾—å±€éƒ¨å˜é‡è¡¨è†¨èƒ€ï¼Œä»–çš„æ ˆå¸§å°±è¶Šå¤§ï¼Œä»¥æ»¡è¶³æ–¹æ³•è°ƒç”¨é”éœ€ä¼ é€’çš„ä¿¡æ¯å¢å¤§çš„éœ€æ±‚ã€‚è¿›è€Œå‡½æ•°è°ƒç”¨å°±ä¼šå æœ‰æ›´å¤šçš„æ ˆç©ºé—´ï¼Œå¯¼è‡´å…¶åµŒå¥—è°ƒç”¨æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</li>
<li><strong>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡åªåœ¨å½“å‰æ–¹æ³•è°ƒç”¨ä¸­æœ‰æ•ˆã€‚</strong>åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºé€šè¿‡ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ã€‚å½“æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéšç€æ–¹æ³•æ ˆå¸§çš„é”€æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</li>
</ul>
<h4 id="3-1ï¼Œå…³äºSlotçš„ç†è§£"><a href="#3-1ï¼Œå…³äºSlotçš„ç†è§£" class="headerlink" title="3.1ï¼Œå…³äºSlotçš„ç†è§£"></a>3.1ï¼Œå…³äºSlotçš„ç†è§£</h4><ul>
<li><p>å±€éƒ¨å˜é‡è¡¨ï¼Œæœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯<strong>Slotï¼ˆå˜é‡æ§½ï¼‰</strong> </p>
</li>
<li><p>å‚æ•°å€¼çš„å­˜æ”¾æ€»æ˜¯åœ¨å±€éƒ¨å˜é‡æ•°ç»„çš„index0å¼€å§‹ï¼Œåˆ°æ•°ç»„é•¿åº¦-1çš„ç´¢å¼•ç»“æŸã€‚ </p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ8ç§ï¼‰ï¼Œå¼•ç”¨ç±»å‹ï¼ˆreferenceï¼‰ï¼ŒreturnAddressç±»å‹çš„å˜é‡ã€‚ </p>
</li>
<li><p>åœ¨å±€éƒ¨å˜é‡è¡¨é‡Œï¼Œ32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslotï¼ˆåŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹ï¼ˆlongå’Œdoubleï¼‰å ç”¨ä¸¤ä¸ªslotã€‚ </p>
</li>
<li><p>byteã€shortã€char åœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸ºintï¼Œbooleanä¹Ÿè¢«è½¬æ¢ä¸ºintï¼Œ0è¡¨ç¤ºfalseï¼Œé0è¡¨ç¤ºtrueã€‚ </p>
</li>
<li><p>JVMä¼šä¸ºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªSlotéƒ½åˆ†é…ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å³å¯æˆåŠŸè®¿é—®åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å®šçš„å±€éƒ¨å˜é‡å€¼ </p>
</li>
<li><p>å½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡å°†ä¼š<strong>æŒ‰ç…§é¡ºåº</strong>è¢«å¤åˆ¶åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotä¸Š </p>
</li>
<li><p>å¦‚æœéœ€è¦è®¿é—®å±€éƒ¨å˜é‡è¡¨ä¸­ä¸€ä¸ª64bitçš„å±€éƒ¨å˜é‡å€¼æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªç´¢å¼•å³å¯ã€‚ï¼ˆæ¯”å¦‚ï¼šè®¿é—®longæˆ–doub1eç±»å‹å˜é‡ï¼‰ </p>
</li>
<li><p>å¦‚æœå½“å‰å¸§æ˜¯ç”±<strong>æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•åˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨thiså°†ä¼šå­˜æ”¾åœ¨indexä¸º0çš„slotå¤„</strong>ï¼Œå…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ã€‚ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220204172832778.png" alt="image-20220204172832778" loading="lazy"></p>
<h4 id="3-2ï¼ŒSlotçš„é‡å¤åˆ©ç”¨"><a href="#3-2ï¼ŒSlotçš„é‡å¤åˆ©ç”¨" class="headerlink" title="3.2ï¼ŒSlotçš„é‡å¤åˆ©ç”¨"></a>3.2ï¼ŒSlotçš„é‡å¤åˆ©ç”¨</h4><p>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜çš„æ–°çš„å±€éƒ¨å˜å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œè¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlotTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localVarl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localVar2</span><span class="params">()</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            System.out.println(a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ­¤æ—¶çš„å°±ä¼šå¤ç”¨açš„æ§½ä½</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220204173333709.png" alt="image-20220204173333709" loading="lazy"></p>
<h4 id="3-3ï¼Œé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"><a href="#3-3ï¼Œé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”" class="headerlink" title="3.3ï¼Œé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"></a>3.3ï¼Œé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”</h4><p>å‚æ•°è¡¨åˆ†é…å®Œæ¯•åï¼Œåœ¨æ ¹æ®æ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å˜é‡çš„é¡ºåºå’Œä½œç”¨åŸŸåˆ†é…ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ç±»å˜é‡æœ‰ä¸¤æ¬¡åˆå§‹åŒ–æœºä¼šï¼Œä¸€æ¬¡æ˜¯åœ¨å‡†å¤‡é˜¶æ®µï¼Œåœ¨æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–ï¼Œå¯¹ç±»å˜é‡è®¾ç½®ä¸ºé›¶ï¼Œå¦å¤–ä¸€æ¬¡åˆ™æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œèµ‹äºˆç¨‹åºå‘˜åœ¨ä»£ç ä¸­å®šä¹‰çš„åˆå§‹å€¼ã€‚</p>
<p>å’Œç±»å˜é‡åˆå§‹åŒ–ä¸åŒçš„æ˜¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸å­˜åœ¨ç³»ç»Ÿåˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œè¿™å°±æ„å‘³ç€ä¸€æ—¦å®šä¹‰äº†å±€éƒ¨å˜é‡ï¼Œå¿…é¡»è¦äººä¸ºçš„åˆå§‹åŒ–ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    System. out. println(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å°±ä¼šæŠ¥é”™ï¼Œæ˜¾ç¤ºæ— æ³•ä½¿ç”¨å˜é‡iï¼Œéœ€è¦ä¸ºä»–èµ‹å€¼ã€‚</p>
<h4 id="3-4ï¼Œè¡¥å……è¯´æ˜"><a href="#3-4ï¼Œè¡¥å……è¯´æ˜" class="headerlink" title="3.4ï¼Œè¡¥å……è¯´æ˜"></a>3.4ï¼Œè¡¥å……è¯´æ˜</h4><p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p>
<p>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h3 id="4ï¼Œæ“ä½œæ•°æ ˆï¼ˆOperand-Stackï¼‰"><a href="#4ï¼Œæ“ä½œæ•°æ ˆï¼ˆOperand-Stackï¼‰" class="headerlink" title="4ï¼Œæ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰"></a>4ï¼Œæ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</h3><p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§å¤„ç†åŒ…å«å±€éƒ¨å˜é‡è¡¨ä»¥å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€ä¸ªåè¿›å…ˆå‡ºçš„æ“ä½œæ•°æ ˆï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºè¡¨è¾¾å¼æ ˆï¼ˆExpression Stackï¼‰</p>
<p>æ“ä½œæ•°æ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ ˆä¸­å†™å…¥æ•°æ®æˆ–è€…æå–æ•°æ®ï¼Œå³å…¥æ ˆæ“ä½œï¼ˆpushï¼‰å’Œå‡ºæ ˆï¼ˆpopï¼‰</p>
<ul>
<li><p>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œå…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆã€‚ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆ</p>
</li>
<li><p>æ¯”å¦‚ï¼šæ‰§è¡Œå¤åˆ¶ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œ</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220210174118277.png" alt="image-20220210174118277" loading="lazy"></p>
<p>ä»£ç ä¸¾ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAddOperation</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">15</span>; </span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">8</span>; </span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å­—èŠ‚ç æŒ‡ä»¤ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAddOperation</span><span class="params">()</span>; </span><br><span class="line">    Code:</span><br><span class="line">    <span class="number">0</span>: bipush <span class="number">15</span></span><br><span class="line">    <span class="number">2</span>: istore_1 </span><br><span class="line">    <span class="number">3</span>: bipush <span class="number">8</span></span><br><span class="line">    <span class="number">5</span>: istore_2 </span><br><span class="line">    <span class="number">6</span>:iload_1 </span><br><span class="line">    <span class="number">7</span>:iload_2 </span><br><span class="line">    <span class="number">8</span>:iadd</span><br><span class="line">    <span class="number">9</span>:istore_3 </span><br><span class="line">    <span class="number">10</span>:<span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ“ä½œæ•°æ ˆï¼Œä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—å‡ºè¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>æ“ä½œæ•°æ ˆå°±æ˜¯JVMæ‰§è¡Œå¼•æ“çš„ä¸€ä¸ªå·¥ä½œåŒºï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¹Ÿä¼šéšä¹‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ã€‚</p>
<p>æ¯ä¸€ä¸ªæ“ä½œæ•°æ ˆéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ˆæ·±åº¦ç”¨äºå­˜å‚¨æ•°å€¼ï¼Œå…¶æ‰€éœ€çš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘æœŸå°±å®šä¹‰å¥½äº†ï¼Œä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§ä¸­ï¼Œä¸ºmax_stackçš„å€¼ã€‚</p>
<p>æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å¯ä»¥ä»»æ„çš„Javaæ•°æ®ç±»å‹</p>
<ul>
<li><p>32bitçš„ç±»å‹å ç”¨ä¸€ä¸ªæ ˆå•ä½æ·±åº¦</p>
</li>
<li><p>64bitçš„ç±»å‹å ç”¨ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦</p>
</li>
</ul>
<p>æ“ä½œæ•°æ ˆå¹¶éé‡‡ç”¨è®¿é—®ç´¢å¼•çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®è®¿é—®çš„ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡æ ‡å‡†çš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œæ¥å®Œæˆä¸€æ¬¡æ•°æ®è®¿é—®ã€‚</p>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰è¿”å›å€¼çš„è¯ï¼Œå…¶è¿”å›å€¼å°†ä¼šè¢«å‹å…¥å½“å‰æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œå¹¶æ›´æ–°PCå¯„å­˜å™¨ä¸­ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<p>æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ï¼Œè¿™ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å™¨æœŸé—´è¿›è¡ŒéªŒè¯ï¼ŒåŒæ—¶åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„ç±»æ£€æµ‹é˜¶æ®µçš„æ•°æ®æµåˆ†æé˜¶æ®µè¦å†æ¬¡éªŒè¯ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¯´<strong>Javaè™šæ‹Ÿæœºçš„è§£é‡Šå¼•æ“æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“</strong>ï¼Œå…¶ä¸­çš„æ ˆæŒ‡çš„å°±æ˜¯æ“ä½œæ•°æ ˆã€‚</p>
<h3 id="5ï¼Œä»£ç è¿½è¸ª"><a href="#5ï¼Œä»£ç è¿½è¸ª" class="headerlink" title="5ï¼Œä»£ç è¿½è¸ª"></a>5ï¼Œä»£ç è¿½è¸ª</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package chapter5;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @version v1.0</span><br><span class="line"> * @ProjectName: JVMä»£ç </span><br><span class="line"> * @ClassName: Stack</span><br><span class="line"> * @Description: æ“ä½œæ•°æ ˆ</span><br><span class="line"> * @Author: èµµå…ˆç”Ÿ</span><br><span class="line"> * @Date: 2022/2/10 17:51</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Stack &#123;</span><br><span class="line">    public void testAddOperation() &#123;</span><br><span class="line">        byte i = 15;</span><br><span class="line">        int j = 8;</span><br><span class="line">        int k = i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨javap å‘½ä»¤åç¼–è¯‘classæ–‡ä»¶ï¼š<code>javap -v ç±»å.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAddoperation</span><span class="params">()</span>; </span><br><span class="line">		Code:</span><br><span class="line">	<span class="number">0</span>: bipush <span class="number">15</span> </span><br><span class="line">	<span class="number">2</span>: istore_1 </span><br><span class="line">	<span class="number">3</span>: bipush <span class="number">8</span></span><br><span class="line">	<span class="number">5</span>: istore_2</span><br><span class="line">	<span class="number">6</span>: iload_1</span><br><span class="line">	<span class="number">7</span>: iload_2</span><br><span class="line">	<span class="number">8</span>: iadd</span><br><span class="line">	<span class="number">9</span>: istore_3</span><br><span class="line">    <span class="number">10</span>: <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>ç°å°† byte i = 15çš„15å…¥æ ˆæ“ä½œ</p>
<p><img src="/2022/04/18/JVM/image-20220210180325399.png" alt="image-20220210180325399" loading="lazy"></p>
</li>
<li><p>åœ¨å°†è¿™ä¸ªå€¼å­˜å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ï¼ŒåŒæ—¶å‡ºæ ˆã€‚ï¼ˆä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡è¡¨çš„0ä½ç½®ä¸å­˜æ”¾15å‘¢ï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬0çš„ä½ç½®å­˜æ”¾çš„thisï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220210180347832.png" alt="image-20220210180347832" loading="lazy"></p>
</li>
<li><p>å°†j=8ï¼Œå­˜æ”¾å¦‚æ“ä½œæ•°æ ˆä¸­</p>
<p><img src="/2022/04/18/JVM/image-20220210180932868.png" alt="image-20220210180932868" loading="lazy"></p>
</li>
<li><p>å†å°†8è¿™ä¸ªå€¼å­˜å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ï¼ŒåŒæ—¶å°†å…¶è¿›è¡Œå‡ºæ ˆæ“ä½œã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220210180954394.png" alt="image-20220210180954394" loading="lazy"></p>
</li>
<li><p>å°†15å…¥æ ˆï¼Œä¸ºäº†åé¢çš„åŠ è¿ç®—ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220210181114790.png" alt="image-20220210181114790" loading="lazy"></p>
</li>
<li><p>å°†8ä¹Ÿå…¥æ ˆã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220210181133707.png" alt="image-20220210181133707" loading="lazy"></p>
</li>
<li><p>æœ€åJavaçš„æ‰§è¡Œå¼•æ“å°†å…¶è¿›è¡Œè§£é‡Šå‡ºæ ˆæ“ä½œï¼Œè¿›è¡Œç›¸åŠ ï¼Œè®¡ç®—å‡ºçš„ç»“æœå­˜æ”¾å¦‚æ ˆä¸­ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220210181245545.png" alt="image-20220210181245545" loading="lazy"></p>
</li>
<li><p>åœ¨å°†è¿™ä¸ªå€¼èµ‹äºˆkï¼ŒåŒæ—¶å‡ºæ ˆã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220210181338525.png" alt="image-20220210181338525" loading="lazy"></p>
</li>
</ol>
<h3 id="6ï¼Œæ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼ˆTop-Of-Stack-Cashingï¼‰æŠ€æœ¯"><a href="#6ï¼Œæ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼ˆTop-Of-Stack-Cashingï¼‰æŠ€æœ¯" class="headerlink" title="6ï¼Œæ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼ˆTop Of Stack Cashingï¼‰æŠ€æœ¯"></a>6ï¼Œæ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼ˆTop Of Stack Cashingï¼‰æŠ€æœ¯</h3><p>å‰é¢æè¿‡ï¼ŒåŸºäºæ ˆå¼æ¶æ„çš„è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„é›¶åœ°å€æŒ‡ä»¤æ›´åŠ ç´§å‡‘ï¼Œä½†å®Œæˆä¸€é¡¹æ“ä½œçš„æ—¶å€™å¿…ç„¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„å…¥æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ï¼Œè¿™åŒæ—¶ä¹Ÿå°±æ„å‘³ç€å°†éœ€è¦æ›´å¤šçš„æŒ‡ä»¤åˆ†æ´¾ï¼ˆinstruction dispatchï¼‰æ¬¡æ•°å’Œå†…å­˜è¯»/å†™æ¬¡æ•°ã€‚</p>
<p>ç”±äºæ“ä½œæ•°æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜è¯»/å†™æ“ä½œå¿…ç„¶ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotSpot JVMçš„è®¾è®¡è€…ä»¬æå‡ºäº†æ ˆé¡¶ç¼“å­˜ï¼ˆTosï¼ŒTop-of-Stack Cashingï¼‰æŠ€æœ¯ï¼Œ<u>å°†æ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç†CPUçš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»/å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ã€‚</u></p>
<h3 id="7ï¼ŒåŠ¨æ€é“¾æ¥ï¼ˆDynamic-Linkingï¼‰"><a href="#7ï¼ŒåŠ¨æ€é“¾æ¥ï¼ˆDynamic-Linkingï¼‰" class="headerlink" title="7ï¼ŒåŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰"></a>7ï¼ŒåŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</h3><p>åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€é™„åŠ ä¿¡æ¯ ï¼š æœ‰äº›åœ°æ–¹è¢«ç§°ä¸ºå¸§æ•°æ®åŒº</p>
<p>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«äº†ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ã€‚åŒ…å«è¿™ä¸ªå¼•ç”¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°åŠ¨æ€é“¾æ¥ã€‚æ¯”å¦‚ï¼šinvokedynamicæŒ‡ä»¤ã€‚</p>
<p>åœ¨javaæºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ä¿å­˜åœ¨classæ–‡ä»¶çš„å¸¸é‡æ± é‡Œé¢ã€‚æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆåŠ¨æ€è¿æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span>: JVMä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: DynamicLinking</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åŠ¨æ€é“¾æ¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: èµµå…ˆç”Ÿ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/2/12 15:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicLinking</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodA...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodB...&quot;</span>);</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220212161354202.png" alt="image-20220212161354202" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220212161555599.png" alt="image-20220212161555599" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220212153722403.png" alt="image-20220212153722403" loading="lazy"></p>
<p>åŠ¨æ€é“¾æ¥æŒ‡å‘çš„æ˜¯æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œäº§ç”Ÿè¿™ç§å¼•ç”¨çš„åŸå› æ˜¯èŠ‚çœäº†å†…å­˜ï¼Œå°±åƒæˆ‘ä»¬è¦åœ¨æ–¹æ³•ä¸­ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±ç›´æ¥é€šè¿‡å¯¹è±¡åæ‰¾ï¼Œè€Œä¸ç”¨æ¯æ¬¡å°†è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§å†æ¬¡å£°æ˜ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦è¿è¡Œæ—¶å¸¸é‡æ± å‘¢ï¼Ÿ</p>
<p>å¸¸é‡æ± çš„ä½œç”¨ï¼šå°±æ˜¯ä¸ºäº†æä¾›ä¸€äº›ç¬¦å·å’Œå¸¸é‡ï¼Œä¾¿äºæŒ‡ä»¤çš„è¯†åˆ«</p>
<h3 id="8ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè§£æä¸åˆ†é…"><a href="#8ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè§£æä¸åˆ†é…" class="headerlink" title="8ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè§£æä¸åˆ†é…"></a>8ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè§£æä¸åˆ†é…</h3><p>åœ¨JVMä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ç›¸å…³</p>
<h4 id="8-1ï¼Œé™æ€é“¾æ¥"><a href="#8-1ï¼Œé™æ€é“¾æ¥" class="headerlink" title="8.1ï¼Œé™æ€é“¾æ¥"></a>8.1ï¼Œé™æ€é“¾æ¥</h4><p>å½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿›JVMå†…éƒ¨æ—¶ï¼Œå¦‚æœ<strong>è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸå¯çŸ¥</strong>ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹é™è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥ã€‚</p>
<h4 id="8-2ï¼ŒåŠ¨æ€é“¾æ¥"><a href="#8-2ï¼ŒåŠ¨æ€é“¾æ¥" class="headerlink" title="8.2ï¼ŒåŠ¨æ€é“¾æ¥"></a>8.2ï¼ŒåŠ¨æ€é“¾æ¥</h4><p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œ<strong>åªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨çš„æ–¹æ³•çš„ç¬¦å·è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</strong>ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥ã€‚</p>
<p>é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ä¸æ˜¯åè¯ï¼Œè€Œæ˜¯åŠ¨è¯ï¼Œè¿™æ˜¯ç†è§£çš„å…³é”®ã€‚</p>
<hr>
<p>å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©æœŸç»‘å®šï¼ˆEarly Bindingï¼‰å’Œæ™šæœŸç»‘å®šï¼ˆLate Bindingï¼‰ã€‚ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡ã€‚</p>
<h4 id="8-3ï¼Œæ—©æœŸç»‘å®š"><a href="#8-3ï¼Œæ—©æœŸç»‘å®š" class="headerlink" title="8.3ï¼Œæ—©æœŸç»‘å®š"></a>8.3ï¼Œæ—©æœŸç»‘å®š</h4><p>æ—©æœŸç»‘å®šå°±æ˜¯æŒ‡<strong>è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶</strong>ï¼Œå³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºæ˜ç¡®äº†è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ç©¶ç«Ÿæ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<h4 id="8-4ï¼Œæ™šæœŸç»‘å®š"><a href="#8-4ï¼Œæ™šæœŸç»‘å®š" class="headerlink" title="8.4ï¼Œæ™šæœŸç»‘å®š"></a>8.4ï¼Œæ™šæœŸç»‘å®š</h4><p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ç±»å‹ç»‘å®šç›¸å…³çš„æ–¹æ³•ï¼Œè¿™ç§ç»‘å®šæ–¹å¼ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºæ™šæœŸç»‘å®šã€‚</p>
<hr>
<p>éšç€é«˜çº§è¯­è¨€çš„æ¨ªç©ºå‡ºä¸–ï¼Œç±»ä¼¼äºJavaä¸€æ ·çš„åŸºäºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å¦‚ä»Šè¶Šæ¥è¶Šå¤šï¼Œå°½ç®¡è¿™ç±»ç¼–ç¨‹è¯­è¨€åœ¨è¯­æ³•é£æ ¼ä¸Šå­˜åœ¨ä¸€å®šçš„å·®åˆ«ï¼Œä½†æ˜¯å®ƒä»¬å½¼æ­¤ä¹‹é—´å§‹ç»ˆä¿æŒç€ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯éƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œæ—¢ç„¶è¿™ä¸€ç±»çš„ç¼–ç¨‹è¯­è¨€å…·å¤‡å¤šæ€ç‰¹æ‚„ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±å…·å¤‡æ—©æœŸç»‘å®šå’Œæ™šæœŸç»‘å®šä¸¤ç§ç»‘å®šæ–¹å¼ã€‚</p>
<p>Javaä¸­ä»»ä½•ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•å…¶å®éƒ½å…·å¤‡è™šå‡½æ•°çš„ç‰¹å¾ï¼Œå®ƒä»¬ç›¸å½“äºCè¯­è¨€ä¸­çš„è™šå‡½æ•°ï¼ˆCä¸­åˆ™éœ€è¦ä½¿ç”¨å…³é”®å­—virtualæ¥æ˜¾å¼å®šä¹‰ï¼‰ã€‚å¦‚æœåœ¨Javaç¨‹åºä¸­ä¸å¸Œæœ›æŸä¸ªæ–¹æ³•æ‹¥æœ‰è™šå‡½æ•°çš„ç‰¹å¾æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­—finalæ¥æ ‡è®°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="8-5ï¼Œè™šæ–¹æ³•å’Œéè™šæ–¹æ³•"><a href="#8-5ï¼Œè™šæ–¹æ³•å’Œéè™šæ–¹æ³•" class="headerlink" title="8.5ï¼Œè™šæ–¹æ³•å’Œéè™šæ–¹æ³•"></a>8.5ï¼Œè™šæ–¹æ³•å’Œéè™šæ–¹æ³•</h4><p>å¦‚æœ<strong>æ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ˜¯ä¸å¯å˜çš„</strong>ã€‚è¿™æ ·çš„æ–¹æ³•ç§°ä¸º<strong>éè™šæ–¹æ³•</strong>ã€‚</p>
<p><strong>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€finalæ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ã€‚å…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</strong></p>
<p>åœ¨ç±»åŠ è½½çš„è§£æé˜¶æ®µå°±å¯ä»¥è¿›è¡Œè§£æï¼Œå¦‚ä¸‹æ˜¯éè™šæ–¹æ³•ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        System. out. println(<span class="string">&quot;father &quot;</span>+str); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        System. out. println(<span class="string">&quot;father&quot;</span>+str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VirtualMethodTest</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">            Son.print(<span class="string">&quot;coder&quot;</span>);</span><br><span class="line">            <span class="comment">//Father fa=new Father();</span></span><br><span class="line">            <span class="comment">//fa.show(&quot;atguigu.com&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è™šæ‹Ÿæœºä¸­æä¾›äº†ä»¥ä¸‹å‡ æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</p>
<blockquote>
<p>æ™®é€šè°ƒç”¨æŒ‡ä»¤ï¼š</p>
</blockquote>
<ul>
<li><p>invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</p>
</li>
<li><p>invokespecialï¼šè°ƒç”¨æ–¹æ³•ã€ç§æœ‰åŠçˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</p>
</li>
<li><p>invokevirtualï¼šè°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•</p>
</li>
<li><p>invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•</p>
</li>
</ul>
<blockquote>
<p>åŠ¨æ€è°ƒç”¨æŒ‡ä»¤ï¼š</p>
</blockquote>
<ul>
<li>invokedynamicï¼šåŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ</li>
</ul>
<p>å‰å››æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯äººä¸ºå¹²é¢„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚å…¶ä¸­invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„ï¼ˆfina1ä¿®é¥°çš„é™¤å¤–ï¼‰ç§°ä¸ºè™šæ–¹æ³•ã€‚</p>
<p><strong>å…³äºinvokednamicæŒ‡ä»¤</strong></p>
<ul>
<li><p> JVMå­—èŠ‚ç æŒ‡ä»¤é›†ä¸€ç›´æ¯”è¾ƒç¨³å®šï¼Œä¸€ç›´åˆ°Java7ä¸­æ‰å¢åŠ äº†ä¸€ä¸ªinvokedynamicæŒ‡ä»¤ï¼Œè¿™æ˜¯Javaä¸ºäº†å®ç°ã€ŒåŠ¨æ€ç±»å‹è¯­è¨€ã€æ”¯æŒè€Œåšçš„ä¸€ç§æ”¹è¿›ã€‚ </p>
</li>
<li><p> ä½†æ˜¯åœ¨Java7ä¸­å¹¶æ²¡æœ‰æä¾›ç›´æ¥ç”ŸæˆinvokedynamicæŒ‡ä»¤çš„æ–¹æ³•ï¼Œéœ€è¦å€ŸåŠ©ASMè¿™ç§åº•å±‚å­—èŠ‚ç å·¥å…·æ¥äº§ç”ŸinvokedynamicæŒ‡ä»¤ã€‚ç›´åˆ°Java8çš„Lambdaè¡¨è¾¾å¼çš„å‡ºç°ï¼ŒinvokedynamicæŒ‡ä»¤çš„ç”Ÿæˆï¼Œåœ¨Javaä¸­æ‰æœ‰äº†ç›´æ¥çš„ç”Ÿæˆæ–¹å¼ã€‚ </p>
</li>
<li><p> Java7ä¸­å¢åŠ çš„åŠ¨æ€è¯­è¨€ç±»å‹æ”¯æŒçš„æœ¬è´¨æ˜¯å¯¹Javaè™šæ‹Ÿæœºè§„èŒƒçš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¯¹Javaè¯­è¨€è§„åˆ™çš„ä¿®æ”¹ï¼Œè¿™ä¸€å—ç›¸å¯¹æ¥è®²æ¯”è¾ƒå¤æ‚ï¼Œå¢åŠ äº†è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€ç›´æ¥çš„å—ç›Šè€…å°±æ˜¯è¿è¡Œåœ¨Javaå¹³å°çš„åŠ¨æ€è¯­è¨€çš„ç¼–è¯‘å™¨ã€‚ </p>
</li>
</ul>
<blockquote>
<p>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€</p>
</blockquote>
<p>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºå¯¹ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸè¿˜æ˜¯åœ¨è¿è¡ŒæœŸï¼Œæ»¡è¶³å‰è€…å°±æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåä¹‹æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ã€‚</p>
<p>è¯´çš„å†ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼Œé™æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡è‡ªèº«çš„ç±»å‹ä¿¡æ¯ï¼›åŠ¨æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡å€¼çš„ç±»å‹ä¿¡æ¯ï¼Œå˜é‡æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå˜é‡å€¼æ‰æœ‰ç±»å‹ä¿¡æ¯ï¼Œè¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ã€‚</p>
<h4 id="8-6ï¼Œæ–¹æ³•é‡å†™çš„æœ¬è´¨"><a href="#8-6ï¼Œæ–¹æ³•é‡å†™çš„æœ¬è´¨" class="headerlink" title="8.6ï¼Œæ–¹æ³•é‡å†™çš„æœ¬è´¨"></a>8.6ï¼Œæ–¹æ³•é‡å†™çš„æœ¬è´¨</h4><p><strong>Java è¯­è¨€ä¸­æ–¹æ³•é‡å†™çš„æœ¬è´¨ï¼š</strong></p>
<ol>
<li>æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æ‰§è¡Œçš„å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè®°ä½œCã€‚</li>
<li>å¦‚æœåœ¨ç±»å‹Cä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦åˆç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒï¼Œå¦‚æœé€šè¿‡åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸï¼›å¦‚æœä¸é€šè¿‡ï¼Œåˆ™è¿”å›java.lang.IllegalAccessError å¼‚å¸¸ã€‚</li>
<li>å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹ã€‚</li>
<li>å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºjava.1ang.AbstractMethodsErrorå¼‚å¸¸ã€‚</li>
</ol>
<p><strong>IllegalAccessErrorä»‹ç»</strong></p>
<p>ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§æˆ–è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½ æ²¡æœ‰æƒé™è®¿é—®ã€‚ä¸€èˆ¬çš„ï¼Œè¿™ä¸ªä¼šå¼•èµ·ç¼–è¯‘å™¨å¼‚å¸¸ã€‚è¿™ä¸ªé”™è¯¯å¦‚æœå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå°±è¯´æ˜ä¸€ä¸ªç±»å‘ç”Ÿäº†ä¸å…¼å®¹çš„æ”¹å˜ã€‚</p>
<h4 id="8-7ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨"><a href="#8-7ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨" class="headerlink" title="8.7ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨"></a>8.7ï¼Œæ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨</h4><p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨åˆ°åŠ¨æ€åˆ†æ´¾ï¼Œå¦‚æœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJVMé‡‡ç”¨åœ¨ç±»çš„æ–¹æ³•åŒºå»ºç«‹ä¸€ä¸ªè™šæ–¹æ³•è¡¨ ï¼ˆvirtual method tableï¼‰ï¼ˆéè™šæ–¹æ³•ä¸ä¼šå‡ºç°åœ¨è¡¨ä¸­ï¼‰æ¥å®ç°ã€‚ä½¿ç”¨ç´¢å¼•è¡¨æ¥ä»£æ›¿æŸ¥æ‰¾ã€‚</p>
<p>æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£ã€‚</p>
<p>è™šæ–¹æ³•è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºçš„å‘¢ï¼Ÿ</p>
<p><strong>è™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µè¢«åˆ›å»ºå¹¶å¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä¹‹åï¼ŒJVMä¼šæŠŠè¯¥ç±»çš„æ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚</strong></p>
<p>ä¸¾ä¾‹1ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220212171409817.png" alt="image-20220212171409817" loading="lazy"></p>
<p>ä¸¾ä¾‹2ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Friendly</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sayGoodbye</span><span class="params">()</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">tostring</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Dog&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">Friendly</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayGoodbye</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CockerSpaniel</span> <span class="keyword">extends</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Friendly</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123; </span><br><span class="line">        <span class="built_in">super</span>.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayGoodbye</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220212171430262.png" alt="image-20220212171430262" loading="lazy"></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>è™šæ–¹æ³•è¡¨å‡ºç°çš„åŸå› å°±æ˜¯å› ä¸ºè™šæ–¹æ³•æ˜¯é€šè¿‡ä¸€å±‚å±‚æ‰¾çš„ï¼Œåœ¨åˆšå¼€å§‹çš„æ—¶å€™ä¸æ¸…æ¥šå…·ä½“æ˜¯ç”±è°è¿›è¡Œå®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³å¯ä»¥æ‰¾åˆ°ä¸€æ¬¡ç„¶åå­˜æ”¾åœ¨è¡¨ä¸­ï¼Œè¿™æ ·å­å†æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å°±ä¸éœ€è¦ä¸€å±‚å±‚çš„æŸ¥æ‰¾äº†ï¼Œæ‰€ä»¥å°±æœ‰äº†è™šæ–¹æ³•è¡¨ã€‚ä»–çš„äº§ç”Ÿæ—¶é—´å°±æ˜¯æˆ‘ä»¬åœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µçš„åˆå§‹åŒ–æ˜¯è¿›è¡Œåˆå§‹åŒ–çš„ã€‚</p>
<h3 id="9ï¼Œæ–¹æ³•è¿”å›åœ°å€ï¼ˆreturn-addressï¼‰"><a href="#9ï¼Œæ–¹æ³•è¿”å›åœ°å€ï¼ˆreturn-addressï¼‰" class="headerlink" title="9ï¼Œæ–¹æ³•è¿”å›åœ°å€ï¼ˆreturn addressï¼‰"></a>9ï¼Œæ–¹æ³•è¿”å›åœ°å€ï¼ˆreturn addressï¼‰</h3><p>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„pcå¯„å­˜å™¨çš„å€¼ã€‚ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><p>æ­£å¸¸æ‰§è¡Œå®Œæˆ</p>
</li>
<li><p>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</p>
</li>
</ul>
<p>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„pcè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</p>
<p>å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li>æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆreturnï¼‰ï¼Œä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œç®€ç§°æ­£å¸¸å®Œæˆå‡ºå£ï¼› </li>
</ol>
<ul>
<li><ul>
<li>ä¸€ä¸ªæ–¹æ³•åœ¨æ­£å¸¸è°ƒç”¨å®Œæˆä¹‹åï¼Œç©¶ç«Ÿéœ€è¦ä½¿ç”¨å“ªä¸€ä¸ªè¿”å›æŒ‡ä»¤ï¼Œè¿˜éœ€è¦æ ¹æ®æ–¹æ³•è¿”å›å€¼çš„å®é™…æ•°æ®ç±»å‹è€Œå®šã€‚</li>
</ul>
</li>
<li><ul>
<li>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè¿”å›æŒ‡ä»¤åŒ…å«ireturnï¼ˆå½“è¿”å›å€¼æ˜¯booleanï¼Œbyteï¼Œcharï¼Œshortå’Œintç±»å‹æ—¶ä½¿ç”¨ï¼‰ï¼Œlreturnï¼ˆLongç±»å‹ï¼‰ï¼Œfreturnï¼ˆFloatç±»å‹ï¼‰ï¼Œdreturnï¼ˆDoubleç±»å‹ï¼‰ï¼Œareturnã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªreturnæŒ‡ä»¤å£°æ˜ä¸ºvoidçš„æ–¹æ³•ï¼Œå®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œç±»å’Œæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚    </li>
</ul>
</li>
</ul>
<ol start="2">
<li>åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºï¼Œç®€ç§°å¼‚å¸¸å®Œæˆå‡ºå£ã€‚</li>
</ol>
<p>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºå¼‚å¸¸æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå¼‚å¸¸å¤„ç†è¡¨ï¼Œæ–¹ä¾¿åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™æ‰¾åˆ°å¤„ç†å¼‚å¸¸çš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception table:</span><br><span class="line">from to target type</span><br><span class="line"><span class="number">4</span>	 <span class="number">16</span>	  <span class="number">19</span>   any</span><br><span class="line"><span class="number">19</span>	 <span class="number">21</span>	  <span class="number">19</span>   any</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½®PCå¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>
<p>æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼ã€‚</p>
<h3 id="10ï¼Œä¸€äº›é™„åŠ ä¿¡æ¯"><a href="#10ï¼Œä¸€äº›é™„åŠ ä¿¡æ¯" class="headerlink" title="10ï¼Œä¸€äº›é™„åŠ ä¿¡æ¯"></a>10ï¼Œä¸€äº›é™„åŠ ä¿¡æ¯</h3><p>æ ˆå¸§ä¸­è¿˜å…è®¸æºå¸¦ä¸Javaè™šæ‹Ÿæœºå®ç°ç›¸å…³çš„ä¸€äº›é™„åŠ ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šå¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ã€‚</p>
<h3 id="11ï¼Œæ ˆçš„ç›¸å…³é¢è¯•é¢˜"><a href="#11ï¼Œæ ˆçš„ç›¸å…³é¢è¯•é¢˜" class="headerlink" title="11ï¼Œæ ˆçš„ç›¸å…³é¢è¯•é¢˜"></a>11ï¼Œæ ˆçš„ç›¸å…³é¢è¯•é¢˜</h3><ul>
<li><p>ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼Ÿï¼ˆStackOverflowErrorï¼‰ </p>
</li>
<li><ul>
<li>é€šè¿‡ -Xssè®¾ç½®æ ˆçš„å¤§å°</li>
</ul>
</li>
<li><p>è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºä¹ˆï¼Ÿ </p>
</li>
<li><ul>
<li>ä¸èƒ½ä¿è¯ä¸æº¢å‡º</li>
</ul>
</li>
<li><p>åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ </p>
</li>
<li><ul>
<li>ä¸æ˜¯ï¼Œä¸€å®šæ—¶é—´å†…é™ä½äº†OOMæ¦‚ç‡ï¼Œä½†æ˜¯ä¼šæŒ¤å å…¶å®ƒçš„çº¿ç¨‹ç©ºé—´ï¼Œå› ä¸ºæ•´ä¸ªç©ºé—´æ˜¯æœ‰é™çš„ã€‚</li>
</ul>
</li>
<li><p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆï¼Ÿ </p>
</li>
<li><ul>
<li>ä¸ä¼š</li>
</ul>
</li>
<li><p>æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ </p>
</li>
<li><ul>
<li>å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚å¦‚æœå¯¹è±¡æ˜¯åœ¨å†…éƒ¨äº§ç”Ÿï¼Œå¹¶åœ¨å†…éƒ¨æ¶ˆäº¡ï¼Œæ²¡æœ‰è¿”å›åˆ°å¤–éƒ¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåä¹‹åˆ™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220212174346118.png" alt="image-20220212174346118" loading="lazy"></p>
<h2 id="äº”ï¼Œæœ¬åœ°æ–¹æ³•æ¥å£å’Œæœ¬åœ°æ–¹æ³•æ ˆ"><a href="#äº”ï¼Œæœ¬åœ°æ–¹æ³•æ¥å£å’Œæœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="äº”ï¼Œæœ¬åœ°æ–¹æ³•æ¥å£å’Œæœ¬åœ°æ–¹æ³•æ ˆ"></a>äº”ï¼Œæœ¬åœ°æ–¹æ³•æ¥å£å’Œæœ¬åœ°æ–¹æ³•æ ˆ</h2><h3 id="1ï¼Œä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ"><a href="#1ï¼Œä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ" class="headerlink" title="1ï¼Œä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ"></a>1ï¼Œä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ</h3><p>ç®€å•åœ°è®²ï¼Œä¸€ä¸ªNative Methodæ˜¯ä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å›—ã€‚ä¸€ä¸ªNative Methodæ˜¯è¿™æ ·ä¸€ä¸ªJavaæ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„å®ç°ç”±éJavaè¯­è¨€å®ç°ï¼Œæ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éJavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨Cä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œcâ€ å‘ŠçŸ¥cç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªcçš„å‡½æ•°ã€‚</p>
<blockquote>
<p>A native method is a Java method whose implementation is provided by non-java code.</p>
</blockquote>
<p>åœ¨å®šä¹‰ä¸€ä¸ªnative methodæ—¶ï¼Œå¹¶ä¸æä¾›å®ç°ä½“ï¼ˆæœ‰äº›åƒå®šä¹‰ä¸€ä¸ªJava interfaceï¼‰ï¼Œå› ä¸ºå…¶å®ç°ä½“æ˜¯ç”±éjavaè¯­è¨€åœ¨å¤–é¢å®ç°çš„ã€‚</p>
<p>æœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸ºJavaæ‰€ç”¨ï¼Œå®ƒçš„åˆè¡·æ˜¯èåˆC/C++ç¨‹åºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213161258695.png" alt="image-20220213161258695" loading="lazy"></p>
<p>ä¸¾ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IHaveNatives</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">methodNative1</span><span class="params">(<span class="type">int</span> x)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">methodNative2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">synchronized</span> <span class="type">float</span> <span class="title function_">methodNative3</span><span class="params">(Object o)</span>;</span><br><span class="line">    <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">methodNative4</span><span class="params">(<span class="type">int</span>[] ary)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ‡è¯†ç¬¦nativeå¯ä»¥ä¸å…¶å®ƒjavaæ ‡è¯†ç¬¦è¿ç”¨ï¼Œä½†æ˜¯abstracté™¤å¤–</p>
<h3 id="2ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Native-Methodï¼Ÿ"><a href="#2ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Native-Methodï¼Ÿ" class="headerlink" title="2ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Native Methodï¼Ÿ"></a>2ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Native Methodï¼Ÿ</h3><p>Javaä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œç„¶è€Œæœ‰äº›å±‚æ¬¡çš„ä»»åŠ¡ç”¨Javaå®ç°èµ·æ¥ä¸å®¹æ˜“ï¼Œæˆ–è€…æˆ‘ä»¬å¯¹ç¨‹åºçš„æ•ˆç‡å¾ˆåœ¨æ„æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ã€‚</p>
<p><strong>ä¸Javaç¯å¢ƒçš„äº¤äº’</strong></p>
<p><u>æœ‰æ—¶Javaåº”ç”¨éœ€è¦ä¸Javaå¤–é¢çš„ç¯å¢ƒäº¤äº’ï¼Œè¿™æ˜¯æœ¬åœ°æ–¹æ³•å­˜åœ¨çš„ä¸»è¦åŸå› </u>ã€‚ä½ å¯ä»¥æƒ³æƒ³Javaéœ€è¦ä¸ä¸€äº›åº•å±‚ç³»ç»Ÿï¼Œå¦‚æ“ä½œç³»ç»Ÿæˆ–æŸäº›ç¡¬ä»¶äº¤æ¢ä¿¡æ¯æ—¶çš„æƒ…å†µã€‚æœ¬åœ°æ–¹æ³•æ­£æ˜¯è¿™æ ·ä¸€ç§äº¤æµæœºåˆ¶ï¼šå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„æ¥å£ï¼Œè€Œä¸”æˆ‘ä»¬æ— éœ€å»äº†è§£Javaåº”ç”¨ä¹‹å¤–çš„ç¹ççš„ç»†èŠ‚ã€‚</p>
<p><strong>ä¸æ“ä½œç³»ç»Ÿçš„äº¤äº’</strong></p>
<p>JVMæ”¯æŒç€Javaè¯­è¨€æœ¬èº«å’Œè¿è¡Œæ—¶åº“ï¼Œå®ƒæ˜¯Javaç¨‹åºèµ–ä»¥ç”Ÿå­˜çš„å¹³å°ï¼Œå®ƒç”±ä¸€ä¸ªè§£é‡Šå™¨ï¼ˆè§£é‡Šå­—èŠ‚ç ï¼‰å’Œä¸€äº›è¿æ¥åˆ°æœ¬åœ°ä»£ç çš„åº“ç»„æˆã€‚ç„¶è€Œä¸ç®¡æ€æ ·ï¼Œå®ƒæ¯•ç«Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œå®ƒç»å¸¸ä¾èµ–äºä¸€åº•å±‚ç³»ç»Ÿçš„æ”¯æŒã€‚è¿™äº›åº•å±‚ç³»ç»Ÿå¸¸å¸¸æ˜¯å¼ºå¤§çš„æ“ä½œç³»ç»Ÿã€‚<u>é€šè¿‡ä½¿ç”¨æœ¬åœ°æ–¹æ³•ï¼Œæˆ‘ä»¬å¾—ä»¥ç”¨Javaå®ç°äº†jreçš„ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ï¼Œ</u>ç”šè‡³JVMçš„ä¸€äº›éƒ¨åˆ†å°±æ˜¯ç”¨cå†™çš„ã€‚è¿˜æœ‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ä¸€äº›Javaè¯­è¨€æœ¬èº«æ²¡æœ‰æä¾›å°è£…çš„æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚</p>
<p><strong>Sunâ€™s Java</strong></p>
<p><u>Sunçš„è§£é‡Šå™¨æ˜¯ç”¨Cå®ç°çš„ï¼Œè¿™ä½¿å¾—å®ƒèƒ½åƒä¸€äº›æ™®é€šçš„Cä¸€æ ·ä¸å¤–éƒ¨äº¤äº’ã€‚</u>jreå¤§éƒ¨åˆ†æ˜¯ç”¨Javaå®ç°çš„ï¼Œå®ƒä¹Ÿé€šè¿‡ä¸€äº›æœ¬åœ°æ–¹æ³•ä¸å¤–ç•Œäº¤äº’ã€‚ä¾‹å¦‚ï¼šç±»java.lang.Threadçš„setPriority()æ–¹æ³•æ˜¯ç”¨Javaå®ç°çš„ï¼Œä½†æ˜¯å®ƒå®ç°è°ƒç”¨çš„æ˜¯è¯¥ç±»é‡Œçš„æœ¬åœ°æ–¹æ³•setPriority()ã€‚è¿™ä¸ªæœ¬åœ°æ–¹æ³•æ˜¯ç”¨Cå®ç°çš„ï¼Œå¹¶è¢«æ¤å…¥JVMå†…éƒ¨ï¼Œåœ¨Windows 95çš„å¹³å°ä¸Šï¼Œè¿™ä¸ªæœ¬åœ°æ–¹æ³•æœ€ç»ˆå°†è°ƒç”¨Win32 setPriority() ApIã€‚è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„å…·ä½“å®ç°ç”±JVMç›´æ¥æä¾›ï¼Œæ›´å¤šçš„æƒ…å†µæ˜¯æœ¬åœ°æ–¹æ³•ç”±å¤–éƒ¨çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆexternal dynamic link libraryï¼‰æä¾›ï¼Œç„¶åè¢«JVwè°ƒç”¨ã€‚</p>
<p><strong>ç°çŠ¶</strong></p>
<p>ç›®å‰è¯¥æ–¹æ³•ä½¿ç”¨çš„è¶Šæ¥è¶Šå°‘äº†ï¼Œé™¤éæ˜¯ä¸ç¡¬ä»¶æœ‰å…³çš„åº”ç”¨ï¼Œæ¯”å¦‚é€šè¿‡Javaç¨‹åºé©±åŠ¨æ‰“å°æœºæˆ–è€…Javaç³»ç»Ÿç®¡ç†ç”Ÿäº§è®¾å¤‡ï¼Œåœ¨ä¼ä¸šçº§åº”ç”¨ä¸­å·²ç»æ¯”è¾ƒå°‘è§ã€‚å› ä¸ºç°åœ¨çš„å¼‚æ„é¢†åŸŸé—´çš„é€šä¿¡å¾ˆå‘è¾¾ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨Socketé€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Web Serviceç­‰ç­‰ï¼Œä¸å¤šåšä»‹ç»ã€‚</p>
<h3 id="3ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ"></a>3ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ</h3><p>Javaè™šæ‹Ÿæœºæ ˆäºç®¡ç†Javaæ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>æœ¬åœ°æ–¹æ³•æ ˆï¼Œä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
<p>å…è®¸è¢«å®ç°æˆå›ºå®šæˆ–è€…æ˜¯å¯åŠ¨æ€æ‰©å±•çš„å†…å­˜å¤§å°ã€‚ï¼ˆåœ¨å†…å­˜æº¢å‡ºæ–¹é¢æ˜¯ç›¸åŒçš„ï¼‰</p>
<ul>
<li><p>å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡æœ¬åœ°æ–¹æ³•æ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªStackOverflowError å¼‚å¸¸ã€‚</p>
</li>
<li><p>å¦‚æœæœ¬åœ°æ–¹æ³•æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„æœ¬åœ°æ–¹æ³•æ ˆï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
</li>
</ul>
<p>æœ¬åœ°æ–¹æ³•æ˜¯ä½¿ç”¨Cè¯­è¨€å®ç°çš„ã€‚</p>
<p>å®ƒçš„å…·ä½“åšæ³•æ˜¯Native Method Stackä¸­ç™»è®°nativeæ–¹æ³•ï¼Œåœ¨Execution Engine æ‰§è¡Œæ—¶åŠ è½½æœ¬åœ°æ–¹æ³•åº“ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213162144270.png" alt="image-20220213162144270" loading="lazy"></p>
<p>å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å¹¶ä¸”ä¸å†å—è™šæ‹Ÿæœºé™åˆ¶çš„ä¸–ç•Œã€‚å®ƒå’Œè™šæ‹Ÿæœºæ‹¥æœ‰åŒæ ·çš„æƒé™ã€‚</p>
<ul>
<li><p>æœ¬åœ°æ–¹æ³•å¯ä»¥é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å£æ¥è®¿é—®è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚</p>
</li>
<li><p>å®ƒç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°å¤„ç†å™¨ä¸­çš„å¯„å­˜å™¨</p>
</li>
<li><p>ç›´æ¥ä»æœ¬åœ°å†…å­˜çš„å †ä¸­åˆ†é…ä»»æ„æ•°é‡çš„å†…å­˜ã€‚</p>
</li>
</ul>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„JVMéƒ½æ”¯æŒæœ¬åœ°æ–¹æ³•ã€‚å› ä¸ºJavaè™šæ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚æœ¬åœ°æ–¹æ³•æ ˆçš„ä½¿ç”¨è¯­è¨€ã€å…·ä½“å®ç°æ–¹å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚å¦‚æœJVMäº§å“ä¸æ‰“ç®—æ”¯æŒnativeæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ— éœ€å®ç°æœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<p>åœ¨Hotspot JVMä¸­ï¼Œç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</p>
<h2 id="å…­ï¼Œ-å †"><a href="#å…­ï¼Œ-å †" class="headerlink" title="å…­ï¼Œ å †"></a>å…­ï¼Œ å †</h2><h3 id="1ï¼Œå †ï¼ˆHeapï¼‰çš„æ ¸å¿ƒæ¦‚è¿°"><a href="#1ï¼Œå †ï¼ˆHeapï¼‰çš„æ ¸å¿ƒæ¦‚è¿°" class="headerlink" title="1ï¼Œå †ï¼ˆHeapï¼‰çš„æ ¸å¿ƒæ¦‚è¿°"></a>1ï¼Œå †ï¼ˆHeapï¼‰çš„æ ¸å¿ƒæ¦‚è¿°</h3><p>å †é’ˆå¯¹ä¸€ä¸ªJVMè¿›ç¨‹æ¥è¯´æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªJVMï¼Œä½†æ˜¯è¿›ç¨‹åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œä»–ä»¬æ˜¯å…±äº«åŒä¸€å †ç©ºé—´çš„ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213171939622.png" alt="image-20220213171939622" loading="lazy"></p>
<p>ä¸€ä¸ªJVMå®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯Javaå†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚</p>
<p>Javaå †åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯JVMç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚</p>
<ul>
<li>å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚</li>
</ul>
<p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚</p>
<p><strong>æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †</strong>ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚</p>
<p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹Javaå †çš„æè¿°æ˜¯ï¼š<strong>æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨è¿è¡Œæ—¶åˆ†é…åœ¨å †ä¸Šã€‚</strong>ï¼ˆ<code>The heap is the run-time data area from which memory for all class instances and arrays is allocated</code>ï¼‰</p>
<p>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå› ä¸º<strong>æ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</strong></p>
<p>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚</p>
<p>å †ï¼Œæ˜¯GCï¼ˆGarbage Collectionï¼Œåƒåœ¾æ”¶é›†å™¨ï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213172136795.png" alt="image-20220213172136795" loading="lazy"></p>
<h4 id="1-1ï¼Œå †å†…å­˜ç»†åˆ†"><a href="#1-1ï¼Œå †å†…å­˜ç»†åˆ†" class="headerlink" title="1.1ï¼Œå †å†…å­˜ç»†åˆ†"></a>1.1ï¼Œå †å†…å­˜ç»†åˆ†</h4><p>Java 7åŠä¹‹å‰å †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº+å…»è€åŒº+æ°¸ä¹…åŒº</p>
<ul>
<li><p>Young Generation Space æ–°ç”ŸåŒº Young/New åˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒº</p>
</li>
<li><p>Tenure generation space å…»è€åŒº Old/Tenure</p>
</li>
<li><p>Permanent Space æ°¸ä¹…åŒº Perm</p>
</li>
</ul>
<p>Java 8åŠä¹‹åå †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”ŸåŒº+å…»è€åŒº+å…ƒç©ºé—´</p>
<ul>
<li><p>Young Generation Space æ–°ç”ŸåŒº Young/New åˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒº</p>
</li>
<li><p>Tenure generation space å…»è€åŒº Old/Tenure</p>
</li>
<li><p>Meta Space å…ƒç©ºé—´ Meta</p>
</li>
</ul>
<p>çº¦å®šï¼šæ–°ç”ŸåŒºï¼ˆä»£ï¼‰&lt;=&gt;å¹´è½»ä»£ ã€ å…»è€åŒº&lt;=&gt;è€å¹´åŒºï¼ˆä»£ï¼‰ã€ æ°¸ä¹…åŒº&lt;=&gt;æ°¸ä¹…ä»£</p>
<h4 id="1-2ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK7ï¼‰"><a href="#1-2ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK7ï¼‰" class="headerlink" title="1.2ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK7ï¼‰"></a>1.2ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK7ï¼‰</h4><p><img src="/2022/04/18/JVM/image-20220213172303028.png" alt="image-20220213172303028" loading="lazy"></p>
<h4 id="1-3ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK8ï¼‰"><a href="#1-3ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK8ï¼‰" class="headerlink" title="1.3ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK8ï¼‰"></a>1.3ï¼Œå †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ˆJDK8ï¼‰</h4><p><img src="/2022/04/18/JVM/image-20220213172344082.png" alt="image-20220213172344082" loading="lazy"></p>
<h3 id="2ï¼Œè®¾ç½®å †å†…å­˜å¤§å°ä¸OOM"><a href="#2ï¼Œè®¾ç½®å †å†…å­˜å¤§å°ä¸OOM" class="headerlink" title="2ï¼Œè®¾ç½®å †å†…å­˜å¤§å°ä¸OOM"></a>2ï¼Œè®¾ç½®å †å†…å­˜å¤§å°ä¸OOM</h3><h4 id="2-1ï¼Œå †ç©ºé—´å¤§å°çš„è®¾ç½®"><a href="#2-1ï¼Œå †ç©ºé—´å¤§å°çš„è®¾ç½®" class="headerlink" title="2.1ï¼Œå †ç©ºé—´å¤§å°çš„è®¾ç½®"></a>2.1ï¼Œå †ç©ºé—´å¤§å°çš„è®¾ç½®</h4><p>Javaå †åŒºç”¨äºå­˜å‚¨Javaå¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨JVMå¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡é€‰é¡¹â€-Xmxâ€å’Œâ€-Xmsâ€æ¥è¿›è¡Œè®¾ç½®ã€‚</p>
<ul>
<li><p>â€œ-Xmsâ€ç”¨äºè¡¨ç¤ºå †åŒºçš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº<code>-XX:InitialHeapSize</code></p>
</li>
<li><p>â€œ-Xmxâ€åˆ™ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº<code>-XX:MaxHeapSize</code></p>
</li>
</ul>
<p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡â€œ-Xmxâ€æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<p>é€šå¸¸ä¼š<strong>å°†-Xmså’Œ-Xmxä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨Javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹</p>
<ul>
<li><p>åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 64</p>
</li>
<li><p>æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 4</p>
</li>
</ul>
<h4 id="2-2ï¼ŒOutOfMemoryä¸¾ä¾‹"><a href="#2-2ï¼ŒOutOfMemoryä¸¾ä¾‹" class="headerlink" title="2.2ï¼ŒOutOfMemoryä¸¾ä¾‹"></a>2.2ï¼ŒOutOfMemoryä¸¾ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">-Xms ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„åˆå§‹åŒ–å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment">  -X æ˜¯Jvmçš„è¿è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment">  ms æ˜¯memory start</span></span><br><span class="line"><span class="comment">-Xmx ç”¨æ¥è®¾è®¡å †ç©ºé—´çš„æœ€å¤§å†…å­˜çš„å¤§å°  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OOMTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[]args)</span>&#123;</span><br><span class="line">        ArrayList&lt;Picture&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">Picture</span>(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">1024</span>*<span class="number">1024</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutofMemoryError: Java heap space</span><br><span class="line">    at com.atguigu. java.Picture.&lt;init&gt;(OOMTest. java:<span class="number">25</span>)</span><br><span class="line">    at com.atguigu.java.O0MTest.main(OOMTest.java:<span class="number">16</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3ï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£"><a href="#3ï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£" class="headerlink" title="3ï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£"></a>3ï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£</h3><p>å­˜å‚¨åœ¨JVMä¸­çš„Javaå¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><p>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿ</p>
</li>
<li><p>å¦å¤–ä¸€ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå´éå¸¸é•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸JVMçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´</p>
</li>
</ul>
<p>Javaå †åŒºè¿›ä¸€æ­¥ç»†åˆ†çš„è¯ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoungGenï¼‰å’Œè€å¹´ä»£ï¼ˆoldGenï¼‰</p>
<p>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸ºEdenç©ºé—´ã€Survivor0ç©ºé—´å’ŒSurvivor1ç©ºé—´ï¼ˆæœ‰æ—¶ä¹Ÿå«åšfromåŒºã€toåŒºï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220213172820874.png" alt="image-20220213172820874" loading="lazy"></p>
<p>ä¸‹é¢è¿™å‚æ•°å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šè°ƒï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220213172840518.png" alt="image-20220213172840518" loading="lazy"></p>
<p>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”ã€‚</p>
<ul>
<li><p>é»˜è®¤<code>-XX:NewRatio=2</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1/3</p>
</li>
<li><p>å¯ä»¥ä¿®æ”¹<code>-XX:NewRatio=4</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1/5</p>
</li>
</ul>
<p>åœ¨HotSpotä¸­ï¼ŒEdenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ªsurvivorç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯8ï¼š1ï¼š1</p>
<p>å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ<code>-xx:SurvivorRatio</code>â€è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚æ¯”å¦‚<code>-xx:SurvivorRatio=8</code></p>
<p>å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æ˜¯åœ¨EdenåŒºè¢«newå‡ºæ¥çš„ã€‚ç»å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ã€‚</p>
<ul>
<li>IBMå…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­80%çš„å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ã€‚</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨é€‰é¡¹â€<code>-Xmn</code>â€œè®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°ï¼Œè¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213173044012.png" alt="image-20220213173044012" loading="lazy"></p>
<h3 id="4ï¼Œå›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"><a href="#4ï¼Œå›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹" class="headerlink" title="4ï¼Œå›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"></a>4ï¼Œå›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</h3><p>ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJVMçš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘GCæ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
<ol>
<li> newçš„å¯¹è±¡å…ˆæ”¾ä¼Šç”¸å›­åŒºã€‚æ­¤åŒºæœ‰å¤§å°é™åˆ¶ã€‚ </li>
<li> å½“ä¼Šç”¸å›­çš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVMçš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinorGCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒº </li>
<li> ç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€…0åŒºã€‚ </li>
<li> å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€…0åŒºçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€…1åŒºã€‚ </li>
<li> å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€…0åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€…1åŒºã€‚ </li>
<li>å•¥æ—¶å€™èƒ½å»å…»è€åŒºå‘¢ï¼Ÿå¯ä»¥è®¾ç½®æ¬¡æ•°ã€‚é»˜è®¤æ˜¯15æ¬¡ã€‚ <ul>
<li>å¯ä»¥è®¾ç½®å‚æ•°ï¼šè¿›è¡Œè®¾ç½®<code>-Xx:MaxTenuringThreshold= N</code></li>
</ul>
</li>
<li> åœ¨å…»è€åŒºï¼Œç›¸å¯¹æ‚ é—²ã€‚å½“å…»è€åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘GCï¼šMajor GCï¼Œè¿›è¡Œå…»è€åŒºçš„å†…å­˜æ¸…ç†</li>
<li> è‹¥å…»è€åŒºæ‰§è¡Œäº†Major GCä¹‹åï¼Œå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”ŸOOMå¼‚å¸¸ã€‚  </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutofMemoryError: Java heap space</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220213173519053.png" alt="image-20220213173519053" loading="lazy"></p>
<p><strong>æµç¨‹å›¾</strong></p>
<p><img src="/2022/04/18/JVM/image-20220213173643549.png" alt="image-20220213173643549" loading="lazy"></p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><p>é’ˆå¯¹å¹¸å­˜è€…s0ï¼Œs1åŒºçš„æ€»ç»“ï¼šå¤åˆ¶ä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯to</p>
</li>
<li><p>å…³äºåƒåœ¾å›æ”¶ï¼šé¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´è¿›è¡Œæ”¶é›†</p>
</li>
</ul>
<p><strong>å¸¸ç”¨è°ƒä¼˜å·¥å…·ï¼ˆåœ¨JVMä¸‹ç¯‡ï¼šæ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜ç¯‡ä¼šè¯¦ç»†ä»‹ç»ï¼‰</strong></p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><p>é’ˆå¯¹å¹¸å­˜è€…s0ï¼Œs1åŒºçš„æ€»ç»“ï¼šå¤åˆ¶ä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯to</p>
</li>
<li><p>å…³äºåƒåœ¾å›æ”¶ï¼šé¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´è¿›è¡Œæ”¶é›†</p>
</li>
</ul>
<p><strong>å¸¸ç”¨è°ƒä¼˜å·¥å…·ï¼ˆåœ¨JVMä¸‹ç¯‡ï¼šæ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜ç¯‡ä¼šè¯¦ç»†ä»‹ç»ï¼‰</strong></p>
<ul>
<li><p>JDKå‘½ä»¤è¡Œ</p>
</li>
<li><p>Eclipse:Memory Analyzer Tool</p>
</li>
<li><p>Jconsole</p>
</li>
<li><p>VisualVM</p>
</li>
<li><p>Jprofiler</p>
</li>
<li><p>Java Flight Recorder</p>
</li>
<li><p>GCViewer</p>
</li>
<li><p>GC Easy</p>
</li>
</ul>
<h3 id="5ï¼ŒMinor-GCï¼ŒMajorGCã€Full-GC"><a href="#5ï¼ŒMinor-GCï¼ŒMajorGCã€Full-GC" class="headerlink" title="5ï¼ŒMinor GCï¼ŒMajorGCã€Full GC"></a>5ï¼ŒMinor GCï¼ŒMajorGCã€Full GC</h3><p>JVMåœ¨è¿›è¡ŒGCæ—¶ï¼Œå¹¶éæ¯æ¬¡éƒ½å¯¹ä¸Šé¢ä¸‰ä¸ªå†…å­˜åŒºåŸŸä¸€èµ·å›æ”¶çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚</p>
<p>é’ˆå¯¹Hotspot VMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCæŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼Œä¸€ç§æ˜¯æ•´å †æ”¶é›†ï¼ˆFullGCï¼‰</p>
<ul>
<li><p>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š </p>
</li>
<li><ul>
<li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†</li>
</ul>
</li>
<li><ul>
<li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªæ˜¯è€å¹´ä»£çš„åœ¾æ”¶é›†ã€‚ </li>
</ul>
</li>
<li><ul>
<li><ul>
<li>ç›®å‰ï¼Œåªæœ‰CMSGCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™Major GCä¼šå’ŒFull GCæ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>æ··åˆæ”¶é›†ï¼ˆMixedGCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ </li>
</ul>
</li>
<li><ul>
<li><ul>
<li>ç›®å‰ï¼Œåªæœ‰G1 GCä¼šæœ‰è¿™ç§è¡Œä¸º</li>
</ul>
</li>
</ul>
</li>
<li><p>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªjavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</p>
</li>
</ul>
<h4 id="5-1ï¼Œæœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶"><a href="#5-1ï¼Œæœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶" class="headerlink" title="5.1ï¼Œæœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶"></a>5.1ï¼Œæœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶</h4><p><strong>å¹´è½»ä»£GCï¼ˆMinor GCï¼‰è§¦å‘æœºåˆ¶</strong></p>
<ul>
<li><p>å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘MinorGCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯Edenä»£æ»¡ï¼ŒSurvivoræ»¡ä¸ä¼šå¼•å‘GCã€‚ï¼ˆæ¯æ¬¡Minor GCä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ã€‚ï¼‰ </p>
</li>
<li><p>å› ä¸ºJavaå¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§.ï¼Œæ‰€ä»¥Minor GCéå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚è¿™ä¸€å®šä¹‰æ—¢æ¸…æ™°åˆæ˜“äºç†è§£ã€‚ </p>
</li>
<li><p>Minor GCä¼šå¼•å‘STWï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220213174051585.png" alt="image-20220213174051585" loading="lazy"></p>
<p><strong>è€å¹´ä»£GCï¼ˆMajor GC / Full GCï¼‰è§¦å‘æœºåˆ¶</strong></p>
<ul>
<li><p>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶ï¼Œæˆ‘ä»¬è¯´ â€œMajor GCâ€ æˆ– â€œFull GCâ€ å‘ç”Ÿäº† </p>
</li>
<li><p>å‡ºç°äº†Major Gcï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GCï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨Paralle1 Scavengeæ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajorGCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰ </p>
</li>
<li><ul>
<li>ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘Minor Gcã€‚å¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘Major GC</li>
</ul>
</li>
<li><p>Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šï¼ŒSTWçš„æ—¶é—´æ›´é•¿ </p>
</li>
<li><p>å¦‚æœMajor GCåï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥OOMäº† </p>
</li>
</ul>
<p><strong>Full GCè§¦å‘æœºåˆ¶ï¼ˆåé¢ç»†è®²ï¼‰ï¼š</strong></p>
<p>è§¦å‘Full GCæ‰§è¡Œçš„æƒ…å†µæœ‰å¦‚ä¸‹äº”ç§ï¼š</p>
<ol>
<li>è°ƒç”¨System.gc()æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡ŒFull GCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li>
<li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li>
<li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li>
<li>é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li>
<li>ç”±EdenåŒºã€survivor space0ï¼ˆFrom Spaceï¼‰åŒºå‘survivor space1ï¼ˆTo Spaceï¼‰åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äºTo Spaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</li>
</ol>
<p>è¯´æ˜ï¼šFull GC æ˜¯å¼€å‘æˆ–è°ƒä¼˜ä¸­å°½é‡è¦é¿å…çš„ã€‚è¿™æ ·æš‚æ—¶æ—¶é—´ä¼šçŸ­ä¸€äº›</p>
<h3 id="6ï¼Œå †ç©ºé—´åˆ†ä»£æ€æƒ³"><a href="#6ï¼Œå †ç©ºé—´åˆ†ä»£æ€æƒ³" class="headerlink" title="6ï¼Œå †ç©ºé—´åˆ†ä»£æ€æƒ³"></a>6ï¼Œå †ç©ºé—´åˆ†ä»£æ€æƒ³</h3><p>ä¸ºä»€ä¹ˆè¦æŠŠJavaå †åˆ†ä»£ï¼Ÿä¸åˆ†ä»£å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†å—ï¼Ÿ</p>
<p>ç»ç ”ç©¶ï¼Œä¸åŒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸åŒã€‚70%-99%çš„å¯¹è±¡æ˜¯ä¸´æ—¶å¯¹è±¡ã€‚</p>
<ul>
<li><p>æ–°ç”Ÿä»£ï¼šæœ‰Edenã€ä¸¤å—å¤§å°ç›¸åŒçš„survivorï¼ˆåˆç§°ä¸ºfrom/toï¼Œs0/s1ï¼‰æ„æˆï¼Œtoæ€»ä¸ºç©ºã€‚</p>
</li>
<li><p>è€å¹´ä»£ï¼šå­˜æ”¾æ–°ç”Ÿä»£ä¸­ç»å†å¤šæ¬¡GCä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220213174355950.png" alt="image-20220213174355950" loading="lazy"></p>
<p>å…¶å®ä¸åˆ†ä»£å®Œå…¨å¯ä»¥ï¼Œåˆ†ä»£çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ–GCæ€§èƒ½ã€‚å¦‚æœæ²¡æœ‰åˆ†ä»£ï¼Œé‚£æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ä¸€å—ï¼Œå°±å¦‚åŒæŠŠä¸€ä¸ªå­¦æ ¡çš„äººéƒ½å…³åœ¨ä¸€ä¸ªæ•™å®¤ã€‚GCçš„æ—¶å€™è¦æ‰¾åˆ°å“ªäº›å¯¹è±¡æ²¡ç”¨ï¼Œè¿™æ ·å°±ä¼šå¯¹å †çš„æ‰€æœ‰åŒºåŸŸè¿›è¡Œæ‰«æã€‚è€Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœåˆ†ä»£çš„è¯ï¼ŒæŠŠæ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åˆ°æŸä¸€åœ°æ–¹ï¼Œå½“GCçš„æ—¶å€™å…ˆæŠŠè¿™å—å­˜å‚¨â€œæœç”Ÿå¤•æ­»â€å¯¹è±¡çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å°±ä¼šè…¾å‡ºå¾ˆå¤§çš„ç©ºé—´å‡ºæ¥ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220213174423912.png" alt="image-20220213174423912" loading="lazy"></p>
<h3 id="7ï¼Œå†…å­˜åˆ†é…ç­–ç•¥"><a href="#7ï¼Œå†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="7ï¼Œå†…å­˜åˆ†é…ç­–ç•¥"></a>7ï¼Œå†…å­˜åˆ†é…ç­–ç•¥</h3><p>å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°survivorç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º1ã€‚å¯¹è±¡åœ¨survivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡MinorGCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼Œå…¶å®æ¯ä¸ªJVMã€æ¯ä¸ªGCéƒ½æœ‰æ‰€ä¸åŒï¼‰æ—¶ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£</p>
<p>å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜€å€¼ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹<code>-XX:MaxTenuringThreshold</code>æ¥è®¾ç½®</p>
<p>é’ˆå¯¹ä¸åŒå¹´é¾„æ®µçš„å¯¹è±¡åˆ†é…åŸåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li><p>ä¼˜å…ˆåˆ†é…åˆ°Eden</p>
</li>
<li><p>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆå°½é‡é¿å…ç¨‹åºä¸­å‡ºç°è¿‡å¤šçš„å¤§å¯¹è±¡ï¼‰</p>
</li>
<li><p>é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£</p>
</li>
<li><p>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­ï¼šå¦‚æœsurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°<code>MaxTenuringThreshold</code>ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p>
</li>
<li><p>ç©ºé—´åˆ†é…æ‹…ä¿ï¼š <code>-XX:HandlePromotionFailure</code></p>
</li>
</ul>
<h3 id="8ï¼Œä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB"><a href="#8ï¼Œä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB" class="headerlink" title="8ï¼Œä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB"></a>8ï¼Œä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB</h3><h4 id="8-1ï¼Œä¸ºä»€ä¹ˆæœ‰TLABï¼ˆThread-Local-Allocation-Bufferï¼‰ï¼Ÿ"><a href="#8-1ï¼Œä¸ºä»€ä¹ˆæœ‰TLABï¼ˆThread-Local-Allocation-Bufferï¼‰ï¼Ÿ" class="headerlink" title="8.1ï¼Œä¸ºä»€ä¹ˆæœ‰TLABï¼ˆThread Local Allocation Bufferï¼‰ï¼Ÿ"></a>8.1ï¼Œä¸ºä»€ä¹ˆæœ‰TLABï¼ˆThread Local Allocation Bufferï¼‰ï¼Ÿ</h4><ul>
<li><p> å †åŒºæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°å †åŒºä¸­çš„å…±äº«æ•°æ® </p>
</li>
<li><p> ç”±äºå¯¹è±¡å®ä¾‹çš„åˆ›å»ºåœ¨JVMä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä»å †åŒºä¸­åˆ’åˆ†å†…å­˜ç©ºé—´æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ </p>
</li>
<li><p> ä¸ºé¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€åœ°å€ï¼Œéœ€è¦ä½¿ç”¨åŠ é”ç­‰æœºåˆ¶ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦ã€‚</p>
</li>
</ul>
<h4 id="8-2ï¼Œä»€ä¹ˆæ˜¯TLABï¼Ÿ"><a href="#8-2ï¼Œä»€ä¹ˆæ˜¯TLABï¼Ÿ" class="headerlink" title="8.2ï¼Œä»€ä¹ˆæ˜¯TLABï¼Ÿ"></a>8.2ï¼Œä»€ä¹ˆæ˜¯TLABï¼Ÿ</h4><ul>
<li><p> ä»å†…å­˜æ¨¡å‹è€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„è§’åº¦ï¼Œå¯¹EdenåŒºåŸŸç»§ç»­è¿›è¡Œåˆ’åˆ†ï¼ŒJVMä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸï¼Œå®ƒåŒ…å«åœ¨Edenç©ºé—´å†…ã€‚ </p>
</li>
<li><p> å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨TLABå¯ä»¥é¿å…ä¸€ç³»åˆ—çš„éçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸ºå¿«é€Ÿåˆ†é…ç­–ç•¥ã€‚ </p>
</li>
<li><p> æ®æˆ‘æ‰€çŸ¥æ‰€æœ‰OpenJDKè¡ç”Ÿå‡ºæ¥çš„JVMéƒ½æä¾›äº†TLABçš„è®¾è®¡ã€‚ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220213174738090.png" alt="image-20220213174738090" loading="lazy"></p>
<h4 id="8-3ï¼ŒTLABçš„å†è¯´æ˜"><a href="#8-3ï¼ŒTLABçš„å†è¯´æ˜" class="headerlink" title="8.3ï¼ŒTLABçš„å†è¯´æ˜"></a>8.3ï¼ŒTLABçš„å†è¯´æ˜</h4><ul>
<li><p>å°½ç®¡ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨TLABä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼Œä½†JVMç¡®å®æ˜¯å°†TLABä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰ã€‚ </p>
</li>
<li><p>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ<code>-XX:UseTLAB</code>â€è®¾ç½®æ˜¯å¦å¼€å¯TLABç©ºé—´ã€‚ </p>
</li>
<li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTLABç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œä»…å æœ‰æ•´ä¸ªEdenç©ºé—´çš„1%ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹ â€œ<code>-XX:TLABWasteTargetPercent</code>â€ è®¾ç½®TLABç©ºé—´æ‰€å ç”¨Edenç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚ </p>
</li>
<li><p>ä¸€æ—¦å¯¹è±¡åœ¨TLABç©ºé—´åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼ŒJVMå°±ä¼šå°è¯•ç€é€šè¿‡ä½¿ç”¨åŠ é”æœºåˆ¶ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œç›´æ¥åœ¨Edenç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220213174824666.png" alt="image-20220213174824666" loading="lazy"></p>
<h3 id="9ï¼Œå°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®"><a href="#9ï¼Œå°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®" class="headerlink" title="9ï¼Œå°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®"></a>9ï¼Œå°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯¦ç»†çš„å‚æ•°å†…å®¹ä¼šåœ¨JVMä¸‹ç¯‡ï¼šæ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜ç¯‡ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå…ˆç†Ÿæ‚‰ä¸‹</span></span><br><span class="line">-XX:+PrintFlagsInitial  <span class="comment">//æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼</span></span><br><span class="line">-XX:+PrintFlagsFinal  <span class="comment">//æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆå¯èƒ½ä¼šå­˜åœ¨ä¿®æ”¹ï¼Œä¸å†æ˜¯åˆå§‹å€¼ï¼‰</span></span><br><span class="line">-Xms  <span class="comment">//åˆå§‹å †ç©ºé—´å†…å­˜ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼‰</span></span><br><span class="line">-Xmx  <span class="comment">//æœ€å¤§å †ç©ºé—´å†…å­˜ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4ï¼‰</span></span><br><span class="line">-Xmn  <span class="comment">//è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°ã€‚ï¼ˆåˆå§‹å€¼åŠæœ€å¤§å€¼ï¼‰</span></span><br><span class="line">-XX:NewRatio  <span class="comment">//é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”</span></span><br><span class="line">-XX:SurvivorRatio  <span class="comment">//è®¾ç½®æ–°ç”Ÿä»£ä¸­Edenå’ŒS0/S1ç©ºé—´çš„æ¯”ä¾‹</span></span><br><span class="line">-XX:MaxTenuringThreshold  <span class="comment">//è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„</span></span><br><span class="line">-XX:+PrintGCDetails <span class="comment">//è¾“å‡ºè¯¦ç»†çš„GCå¤„ç†æ—¥å¿—</span></span><br><span class="line"><span class="comment">//æ‰“å°gcç®€è¦ä¿¡æ¯ï¼šâ‘ -Xxï¼š+PrintGC â‘¡ - verbose:gc</span></span><br><span class="line">-XX:HandlePromotionFalilureï¼š<span class="comment">//æ˜¯å¦è®¾ç½®ç©ºé—´åˆ†é…æ‹…ä¿</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ã€‚</p>
<ul>
<li><p>å¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡Minor GCæ˜¯å®‰å…¨çš„</p>
</li>
<li><p>å¦‚æœå°äºï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹<code>-XX:HandlePromotionFailure</code>è®¾ç½®å€¼æ˜¯å¦å…æ‹…ä¿å¤±è´¥ã€‚ </p>
</li>
<li><ul>
<li>å¦‚æœ<code>HandlePromotionFailure=true</code>ï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ã€‚ </li>
</ul>
</li>
<li><ul>
<li><ul>
<li>å¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡Minor GCï¼Œä½†è¿™æ¬¡Minor GCä¾ç„¶æ˜¯æœ‰é£é™©çš„ï¼›</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>å¦‚æœå°äºï¼Œåˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCã€‚</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>å¦‚æœ<code>HandlePromotionFailure=false</code>ï¼Œåˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full Gcã€‚</li>
</ul>
</li>
</ul>
<p>åœ¨JDK6 Update24ä¹‹åï¼ŒHandlePromotionFailureå‚æ•°ä¸ä¼šå†å½±å“åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´åˆ†é…æ‹…ä¿ç­–ç•¥ï¼Œè§‚å¯ŸopenJDKä¸­çš„æºç å˜åŒ–ï¼Œè™½ç„¶æºç ä¸­è¿˜å®šä¹‰äº†HandlePromotionFailureå‚æ•°ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å·²ç»ä¸ä¼šå†ä½¿ç”¨å®ƒã€‚JDK6 Update 24ä¹‹åçš„è§„åˆ™å˜ä¸ºåªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±ä¼šè¿›è¡ŒMinor GCï¼Œå¦åˆ™å°†è¿›è¡ŒFullGCã€‚</p>
<h3 id="10ï¼Œå †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ"><a href="#10ï¼Œå †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ" class="headerlink" title="10ï¼Œå †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ"></a>10ï¼Œå †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ</h3><p>åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­å…³äºJavaå †å†…å­˜æœ‰è¿™æ ·ä¸€æ®µæè¿°ï¼š</p>
<blockquote>
<p>éšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚</p>
</blockquote>
<p>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡æ˜¯åœ¨Javaå †ä¸­åˆ†é…å†…å­˜çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®éçš„å¸¸è¯†ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯å¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰åå‘ç°ï¼Œä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é….ã€‚è¿™æ ·å°±æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä¹Ÿæ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„å †å¤–å­˜å‚¨æŠ€æœ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œå‰é¢æåˆ°çš„åŸºäºOpenJDKæ·±åº¦å®šåˆ¶çš„TaoBaoVMï¼Œå…¶ä¸­åˆ›æ–°çš„GCIHï¼ˆGC invisible heapï¼‰æŠ€æœ¯å®ç°off-heapï¼Œå°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä»heapä¸­ç§»è‡³heapå¤–ï¼Œå¹¶ä¸”GCä¸èƒ½ç®¡ç†GCIHå†…éƒ¨çš„Javaå¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½GCçš„å›æ”¶é¢‘ç‡å’Œæå‡GCçš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</p>
<h4 id="10-1ï¼Œé€ƒé€¸åˆ†ææ¦‚è¿°"><a href="#10-1ï¼Œé€ƒé€¸åˆ†ææ¦‚è¿°" class="headerlink" title="10.1ï¼Œé€ƒé€¸åˆ†ææ¦‚è¿°"></a>10.1ï¼Œé€ƒé€¸åˆ†ææ¦‚è¿°</h4><p>å¦‚ä½•å°†å †ä¸Šçš„å¯¹è±¡åˆ†é…åˆ°æ ˆï¼Œéœ€è¦ä½¿ç”¨é€ƒé€¸åˆ†ææ‰‹æ®µã€‚</p>
<p>è¿™æ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå‡å°‘Javaç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚</p>
<p>é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspotç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®šæ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Šã€‚</p>
<p>é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼š</p>
<ul>
<li><p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚</p>
</li>
<li><p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒè¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</p>
</li>
</ul>
<p><strong>ä¸¾ä¾‹1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">my_method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">v</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">V</span>();</span><br><span class="line">    <span class="comment">// use v</span></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    v = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥åˆ†é…åˆ°æ ˆä¸Šï¼Œéšç€æ–¹æ³•æ‰§è¡Œçš„ç»“æŸï¼Œæ ˆç©ºé—´å°±è¢«ç§»é™¤ï¼Œæ¯ä¸ªæ ˆé‡Œé¢åŒ…å«äº†å¾ˆå¤šæ ˆå¸§</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StringBuffer <span class="title function_">createStringBuffer</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°æ–¹æ³•å¦‚æœæƒ³è¦<code>StringBuffer sb</code>ä¸å‘ç”Ÿé€ƒé€¸ï¼Œå¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createStringBuffer</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä¸¾ä¾‹2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EscapeAnalysis</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­é€ƒé€¸åˆ†æï¼šçœ‹è¿™ä¸ªå€¼æ˜¯å¦åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•è¿”å›EscapeAnalysiså¯¹è±¡ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">return</span> <span class="variable">obj</span> <span class="operator">=</span>= <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>() : obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ºæˆå‘˜å±æ€§èµ‹å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObj</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.obj = <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹è±¡çš„ä½œç”¨äºä»…åœ¨å½“å‰æ–¹æ³•ä¸­æœ‰æ•ˆï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useEscapeAnalysis</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EscapeAnalysis</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼•ç”¨æˆå‘˜å˜é‡çš„å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useEscapeAnalysis2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EscapeAnalysis</span> <span class="variable">e</span> <span class="operator">=</span> getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è®¾ç½®</strong></p>
<p>åœ¨JDK 6u23 ç‰ˆæœ¬ä¹‹åï¼ŒHotSpotä¸­é»˜è®¤å°±å·²ç»å¼€å¯äº†é€ƒé€¸åˆ†æ</p>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯è¾ƒæ—©çš„ç‰ˆæœ¬ï¼Œå¼€å‘äººå‘˜åˆ™å¯ä»¥é€šè¿‡ï¼š</p>
<ul>
<li><p>é€‰é¡¹â€œ<code>-XX:+DoEscapeAnalysis</code>â€œæ˜¾å¼å¼€å¯é€ƒé€¸åˆ†æ</p>
</li>
<li><p>é€šè¿‡é€‰é¡¹â€œ<code>-XX:+PrintEscapeAnalysis</code>â€œæŸ¥çœ‹é€ƒé€¸åˆ†æçš„ç­›é€‰ç»“æœ</p>
</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼šå¼€å‘ä¸­èƒ½ä½¿ç”¨å±€éƒ¨å˜é‡çš„ï¼Œå°±ä¸è¦ä½¿ç”¨åœ¨æ–¹æ³•å¤–å®šä¹‰ã€‚</p>
<h4 id="10-2ï¼Œé€ƒé€¸åˆ†æï¼šä»£ç ä¼˜åŒ–"><a href="#10-2ï¼Œé€ƒé€¸åˆ†æï¼šä»£ç ä¼˜åŒ–" class="headerlink" title="10.2ï¼Œé€ƒé€¸åˆ†æï¼šä»£ç ä¼˜åŒ–"></a>10.2ï¼Œé€ƒé€¸åˆ†æï¼šä»£ç ä¼˜åŒ–</h4><p>ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<p>ä¸€ã€æ ˆä¸Šåˆ†é…ï¼šå°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…ï¼Œè¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Œå¯¹è±¡å¯èƒ½æ˜¯æ ˆä¸Šåˆ†é…çš„å€™é€‰ï¼Œè€Œä¸æ˜¯å †ä¸Šåˆ†é…</p>
<p>äºŒã€åŒæ­¥çœç•¥ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥ã€‚</p>
<p>ä¸‰ã€åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢ï¼šæœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨CPUå¯„å­˜å™¨ä¸­ã€‚</p>
<h5 id="æ ˆä¸Šåˆ†é…"><a href="#æ ˆä¸Šåˆ†é…" class="headerlink" title="æ ˆä¸Šåˆ†é…"></a>æ ˆä¸Šåˆ†é…</h5><p>JITç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´æ ¹æ®é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå‘ç°<u>å¦‚æœä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚</u>åˆ†é…å®Œæˆåï¼Œç»§ç»­åœ¨è°ƒç”¨æ ˆå†…æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹ç»“æŸï¼Œæ ˆç©ºé—´è¢«å›æ”¶ï¼Œå±€éƒ¨å˜é‡å¯¹è±¡ä¹Ÿè¢«å›æ”¶ã€‚è¿™æ ·å°±æ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚</p>
<p><strong>å¸¸è§çš„æ ˆä¸Šåˆ†é…çš„åœºæ™¯</strong></p>
<p>åœ¨é€ƒé€¸åˆ†æä¸­ï¼Œå·²ç»è¯´æ˜äº†ã€‚åˆ†åˆ«æ˜¯ç»™æˆå‘˜å˜é‡èµ‹å€¼ã€æ–¹æ³•è¿”å›å€¼ã€å®ä¾‹å¼•ç”¨ä¼ é€’ã€‚</p>
<hr>
<h5 id="åŒæ­¥çœç•¥"><a href="#åŒæ­¥çœç•¥" class="headerlink" title="åŒæ­¥çœç•¥"></a>åŒæ­¥çœç•¥</h5><p>çº¿ç¨‹åŒæ­¥çš„ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼ŒåŒæ­¥çš„åæœæ˜¯é™ä½å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚</p>
<p>åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼Œ<u>JITç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©é€ƒé€¸åˆ†ææ¥åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆJITç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å°±ä¼šå–æ¶ˆå¯¹è¿™éƒ¨åˆ†ä»£ç çš„åŒæ­¥ã€‚è¿™æ ·å°±èƒ½å¤§å¤§æé«˜å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚</u>è¿™ä¸ªå–æ¶ˆåŒæ­¥çš„è¿‡ç¨‹å°±å«åŒæ­¥çœç•¥ï¼Œä¹Ÿå«é”æ¶ˆé™¤ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">hellis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">synchronized</span>(hellis) &#123;</span><br><span class="line">        System.out.println(hellis);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»£ç ä¸­å¯¹hellisè¿™ä¸ªå¯¹è±¡åŠ é”ï¼Œä½†æ˜¯helliså¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåªåœ¨f()æ–¹æ³•ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€è®¿é—®åˆ°ï¼Œæ‰€ä»¥åœ¨JITç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«ä¼˜åŒ–æ‰ï¼Œä¼˜åŒ–æˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">hellis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">	System.out.println(hellis);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h5 id="æ ‡é‡æ›¿æ¢"><a href="#æ ‡é‡æ›¿æ¢" class="headerlink" title="æ ‡é‡æ›¿æ¢"></a>æ ‡é‡æ›¿æ¢</h5><p>æ ‡é‡ï¼ˆscalarï¼‰æ˜¯æŒ‡ä¸€ä¸ªæ— æ³•å†åˆ†è§£æˆæ›´å°çš„æ•°æ®çš„æ•°æ®ã€‚Javaä¸­çš„åŸå§‹æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ã€‚</p>
<p>ç›¸å¯¹çš„ï¼Œé‚£äº›è¿˜å¯ä»¥åˆ†è§£çš„æ•°æ®å«åšèšåˆé‡ï¼ˆAggregateï¼‰ï¼ŒJavaä¸­çš„å¯¹è±¡å°±æ˜¯èšåˆé‡ï¼Œå› ä¸ºä»–å¯ä»¥åˆ†è§£æˆå…¶ä»–èšåˆé‡å’Œæ ‡é‡ã€‚</p>
<p>åœ¨JITé˜¶æ®µï¼Œå¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼Œå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–ç•Œè®¿é—®çš„è¯ï¼Œé‚£ä¹ˆç»è¿‡JITä¼˜åŒ–ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ‹†è§£æˆè‹¥å¹²ä¸ªå…¶ä¸­åŒ…å«çš„è‹¥å¹²ä¸ªæˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ ‡é‡æ›¿æ¢ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">    alloc();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Point</span> <span class="variable">point</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;point.x&quot;</span> + point.x + <span class="string">&quot;;point.y&quot;</span> + point.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ï¼Œç»è¿‡æ ‡é‡æ›¿æ¢åï¼Œå°±ä¼šå˜æˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;point.x = &quot;</span> + x + <span class="string">&quot;; point.y=&quot;</span> + y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒPointè¿™ä¸ªèšåˆé‡ç»è¿‡é€ƒé€¸åˆ†æåï¼Œå‘ç°ä»–å¹¶æ²¡æœ‰é€ƒé€¸ï¼Œå°±è¢«æ›¿æ¢æˆä¸¤ä¸ªæ ‡é‡äº†ã€‚é‚£ä¹ˆæ ‡é‡æ›¿æ¢æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å¤§å¤§å‡å°‘å †å†…å­˜çš„å ç”¨ã€‚å› ä¸ºä¸€æ—¦ä¸éœ€è¦åˆ›å»ºå¯¹è±¡äº†ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦åˆ†é…å †å†…å­˜äº†ã€‚ æ ‡é‡æ›¿æ¢ä¸ºæ ˆä¸Šåˆ†é…æä¾›äº†å¾ˆå¥½çš„åŸºç¡€ã€‚</p>
<p><strong>æ ‡é‡æ›¿æ¢å‚æ•°è®¾ç½®</strong></p>
<p>å‚æ•°<code>-XX:EliminateAllocations</code>ï¼šå¼€å¯äº†æ ‡é‡æ›¿æ¢ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åˆ°æ ˆä¸Šã€‚</p>
<p>ä¸Šè¿°ä»£ç åœ¨ä¸»å‡½æ•°ä¸­è¿›è¡Œäº†1äº¿æ¬¡allocã€‚è°ƒç”¨è¿›è¡Œå¯¹è±¡åˆ›å»ºï¼Œç”±äºUserå¯¹è±¡å®ä¾‹éœ€è¦å æ®çº¦16å­—èŠ‚çš„ç©ºé—´ï¼Œå› æ­¤ç´¯è®¡åˆ†é…ç©ºé—´è¾¾åˆ°å°†è¿‘1.5GBã€‚å¦‚æœå †ç©ºé—´å°äºè¿™ä¸ªå€¼ï¼Œå°±å¿…ç„¶ä¼šå‘ç”ŸGCã€‚ä½¿ç”¨å¦‚ä¸‹å‚æ•°è¿è¡Œä¸Šè¿°ä»£ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-server -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å‚æ•°<code>-server</code>ï¼šå¯åŠ¨Serveræ¨¡å¼ï¼Œå› ä¸ºåœ¨serveræ¨¡å¼ä¸‹ï¼Œæ‰å¯ä»¥å¯ç”¨é€ƒé€¸åˆ†æã€‚</p>
</li>
<li><p>å‚æ•°<code>-XX:+DoEscapeAnalysis</code>ï¼šå¯ç”¨é€ƒé€¸åˆ†æ</p>
</li>
<li><p>å‚æ•°<code>-Xmx10m</code>ï¼šæŒ‡å®šäº†å †ç©ºé—´æœ€å¤§ä¸º10MB</p>
</li>
<li><p>å‚æ•°<code>-XX:+PrintGC</code>ï¼šå°†æ‰“å°Gcæ—¥å¿—</p>
</li>
<li><p>å‚æ•°<code>-XX:+EliminateAllocations</code>ï¼šå¼€å¯äº†æ ‡é‡æ›¿æ¢ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åœ¨æ ˆä¸Šï¼Œæ¯”å¦‚å¯¹è±¡æ‹¥æœ‰idå’Œnameä¸¤ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—æ®µå°†ä¼šè¢«è§†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å±€éƒ¨å˜é‡è¿›è¡Œåˆ†é…</p>
</li>
</ul>
<h4 id="10-3ï¼Œé€ƒé€¸åˆ†æå°ç»“ï¼šé€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ"><a href="#10-3ï¼Œé€ƒé€¸åˆ†æå°ç»“ï¼šé€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ" class="headerlink" title="10.3ï¼Œé€ƒé€¸åˆ†æå°ç»“ï¼šé€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ"></a>10.3ï¼Œé€ƒé€¸åˆ†æå°ç»“ï¼šé€ƒé€¸åˆ†æå¹¶ä¸æˆç†Ÿ</h4><p>å…³äºé€ƒé€¸åˆ†æçš„è®ºæ–‡åœ¨1999å¹´å°±å·²ç»å‘è¡¨äº†ï¼Œä½†ç›´åˆ°JDK1.6æ‰æœ‰å®ç°ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯åˆ°å¦‚ä»Šä¹Ÿå¹¶ä¸æ˜¯ååˆ†æˆç†Ÿã€‚</p>
<p>å…¶æ ¹æœ¬åŸå› å°±æ˜¯æ— æ³•ä¿è¯é€ƒé€¸åˆ†æçš„æ€§èƒ½æ¶ˆè€—ä¸€å®šèƒ½é«˜äºä»–çš„æ¶ˆè€—ã€‚è™½ç„¶ç»è¿‡é€ƒé€¸åˆ†æå¯ä»¥åšæ ‡é‡æ›¿æ¢ã€æ ˆä¸Šåˆ†é…ã€å’Œé”æ¶ˆé™¤ã€‚ä½†æ˜¯é€ƒé€¸åˆ†æè‡ªèº«ä¹Ÿæ˜¯éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„åˆ†æçš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ã€‚ </p>
<p>ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œå°±æ˜¯ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œå‘ç°æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸é€ƒé€¸çš„ã€‚é‚£è¿™ä¸ªé€ƒé€¸åˆ†æçš„è¿‡ç¨‹å°±ç™½ç™½æµªè´¹æ‰äº†ã€‚</p>
<p>è™½ç„¶è¿™é¡¹æŠ€æœ¯å¹¶ä¸ååˆ†æˆç†Ÿï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ä¸­ä¸€ä¸ªååˆ†é‡è¦çš„æ‰‹æ®µã€‚</p>
<p>æ³¨æ„åˆ°æœ‰ä¸€äº›è§‚ç‚¹ï¼Œè®¤ä¸ºé€šè¿‡é€ƒé€¸åˆ†æï¼ŒJVMä¼šåœ¨æ ˆä¸Šåˆ†é…é‚£äº›ä¸ä¼šé€ƒé€¸çš„å¯¹è±¡ï¼Œè¿™åœ¨ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å–å†³äºJVMè®¾è®¡è€…çš„é€‰æ‹©ã€‚æ®æˆ‘æ‰€çŸ¥ï¼ŒOracle Hotspot JVMä¸­å¹¶æœªè¿™ä¹ˆåšï¼Œè¿™ä¸€ç‚¹åœ¨é€ƒé€¸åˆ†æç›¸å…³çš„æ–‡æ¡£é‡Œå·²ç»è¯´æ˜ï¼Œæ‰€ä»¥å¯ä»¥æ˜ç¡®æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ›å»ºåœ¨å †ä¸Šã€‚</p>
<p>ç›®å‰å¾ˆå¤šä¹¦ç±è¿˜æ˜¯åŸºäºJDK7ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒJDKå·²ç»å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œinternå­—ç¬¦ä¸²çš„ç¼“å­˜å’Œé™æ€å˜é‡æ›¾ç»éƒ½è¢«åˆ†é…åœ¨æ°¸ä¹…ä»£ä¸Šï¼Œè€Œæ°¸ä¹…ä»£å·²ç»è¢«å…ƒæ•°æ®åŒºå–ä»£ã€‚ä½†æ˜¯ï¼Œinternå­—ç¬¦ä¸²ç¼“å­˜å’Œé™æ€å˜é‡å¹¶ä¸æ˜¯è¢«è½¬ç§»åˆ°å…ƒæ•°æ®åŒºï¼Œè€Œæ˜¯ç›´æ¥åœ¨å †ä¸Šåˆ†é…ï¼Œæ‰€ä»¥è¿™ä¸€ç‚¹åŒæ ·ç¬¦åˆå‰é¢ä¸€ç‚¹çš„ç»“è®ºï¼šå¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ†é…åœ¨å †ä¸Šã€‚</p>
<h3 id="æœ¬ç« å°ç»“"><a href="#æœ¬ç« å°ç»“" class="headerlink" title="æœ¬ç« å°ç»“"></a>æœ¬ç« å°ç»“</h3><p>å¹´è½»ä»£æ˜¯å¯¹è±¡çš„è¯ç”Ÿã€æˆé•¿ã€æ¶ˆäº¡çš„åŒºåŸŸï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¿™é‡Œäº§ç”Ÿã€åº”ç”¨ï¼Œæœ€åè¢«åƒåœ¾å›æ”¶å™¨æ”¶é›†ã€ç»“æŸç”Ÿå‘½ã€‚</p>
<p>è€å¹´ä»£æ”¾ç½®é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯ä»survivoråŒºåŸŸç­›é€‰æ‹·è´è¿‡æ¥çš„Javaå¯¹è±¡ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“æ™®é€šçš„å¯¹è±¡ä¼šè¢«åˆ†é…åœ¨TLABä¸Šï¼›å¦‚æœå¯¹è±¡è¾ƒå¤§ï¼ŒJVMä¼šè¯•å›¾ç›´æ¥åˆ†é…åœ¨Edenå…¶ä»–ä½ç½®ä¸Šï¼›å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå®Œå…¨æ— æ³•åœ¨æ–°ç”Ÿä»£æ‰¾åˆ°è¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼ŒJVMå°±ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚</p>
<p>å½“GCåªå‘ç”Ÿåœ¨å¹´è½»ä»£ä¸­ï¼Œå›æ”¶å¹´è½»ä»£å¯¹è±¡çš„è¡Œä¸ºè¢«ç§°ä¸ºMinorGcã€‚</p>
<p>å½“GCå‘ç”Ÿåœ¨è€å¹´ä»£æ—¶åˆ™è¢«ç§°ä¸ºMajorGcæˆ–è€…FullGCã€‚ä¸€èˆ¬çš„ï¼ŒMinorGcçš„å‘ç”Ÿé¢‘ç‡è¦æ¯”MajorGCé«˜å¾ˆå¤šï¼Œå³è€å¹´ä»£ä¸­åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡å°†å¤§å¤§ä½äºå¹´è½»ä»£ã€‚</p>
<h2 id="ä¸ƒï¼Œæ–¹æ³•åŒº"><a href="#ä¸ƒï¼Œæ–¹æ³•åŒº" class="headerlink" title="ä¸ƒï¼Œæ–¹æ³•åŒº"></a>ä¸ƒï¼Œæ–¹æ³•åŒº</h2><p><img src="/2022/04/18/JVM/image-20220216161544710.png" alt="image-20220216161544710" loading="lazy"></p>
<p>ä»çº¿ç¨‹å…±äº«ä¸å¦çš„è§’åº¦æ¥çœ‹</p>
<p><img src="/2022/04/18/JVM/image-20220216162126770.png" alt="image-20220216162126770" loading="lazy"></p>
<h3 id="1ï¼Œæ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»"><a href="#1ï¼Œæ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»" class="headerlink" title="1ï¼Œæ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»"></a>1ï¼Œæ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»</h3><p><img src="/2022/04/18/JVM/image-20220216162317597.png" alt="image-20220216162317597" loading="lazy"></p>
<h3 id="2ï¼Œæ–¹æ³•åŒºçš„ç†è§£"><a href="#2ï¼Œæ–¹æ³•åŒºçš„ç†è§£" class="headerlink" title="2ï¼Œæ–¹æ³•åŒºçš„ç†è§£"></a>2ï¼Œæ–¹æ³•åŒºçš„ç†è§£</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4">Chapter 2. The Structure of the Java Virtual Machine (oracle.com)</a></p>
<p><img src="/2022/04/18/JVM/image-20220216162437723.png" alt="image-20220216162437723" loading="lazy"></p>
<h4 id="2-1ï¼Œæ–¹æ³•åŒºåœ¨å“ªé‡Œï¼Ÿ"><a href="#2-1ï¼Œæ–¹æ³•åŒºåœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="2.1ï¼Œæ–¹æ³•åŒºåœ¨å“ªé‡Œï¼Ÿ"></a>2.1ï¼Œæ–¹æ³•åŒºåœ¨å“ªé‡Œï¼Ÿ</h4><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è¯´æ˜ï¼šâ€œå°½ç®¡æ‰€æœ‰çš„æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å±äºå †çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸€äº›ç®€å•çš„å®ç°å¯èƒ½ä¸ä¼šé€‰æ‹©å»è¿›è¡Œåƒåœ¾æ”¶é›†æˆ–è€…è¿›è¡Œå‹ç¼©ã€‚â€ä½†å¯¹äºHotSpotJVMè€Œè¨€ï¼Œæ–¹æ³•åŒºè¿˜æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„å°±æ˜¯è¦å’Œå †åˆ†å¼€ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>æ–¹æ³•åŒºçœ‹ä½œæ˜¯ä¸€å—ç‹¬ç«‹äºJavaå †çš„å†…å­˜ç©ºé—´ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220216162615326.png" alt="image-20220216162615326" loading="lazy"></p>
<h4 id="2-2ï¼Œæ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£"><a href="#2-2ï¼Œæ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£" class="headerlink" title="2.2ï¼Œæ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£"></a>2.2ï¼Œæ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£</h4><ul>
<li><p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯<u>å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸ</u>ã€‚</p>
</li>
<li><p>æ–¹æ³•åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™è¢«åˆ›å»ºï¼Œå¹¶ä¸”å®ƒçš„å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´ä¸­å’ŒJavaå †åŒºä¸€æ ·éƒ½<u>å¯ä»¥æ˜¯ä¸è¿ç»­çš„</u>ã€‚</p>
</li>
<li><p>æ–¹æ³•åŒºçš„å¤§å°ï¼Œè·Ÿå †ç©ºé—´ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•ã€‚</p>
</li>
<li><p>æ–¹æ³•åŒºçš„å¤§å°å†³å®šäº†ç³»ç»Ÿå¯ä»¥ä¿å­˜å¤šå°‘ä¸ªç±»ï¼Œå¦‚æœç³»ç»Ÿå®šä¹‰äº†å¤ªå¤šçš„ç±»ï¼Œå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºï¼Œè™šæ‹ŸæœºåŒæ ·ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºé”™è¯¯ï¼š<code>java.lang.OutOfMemoryError: PermGen space</code> æˆ–è€…<code>java.lang.OutOfMemoryError: Metaspace</code> </p>
</li>
<li><ul>
<li>åŠ è½½å¤§é‡çš„ç¬¬ä¸‰æ–¹çš„jaråŒ…ï¼›Tomcatéƒ¨ç½²çš„å·¥ç¨‹è¿‡å¤šï¼ˆ30~50ä¸ªï¼‰ï¼›å¤§é‡åŠ¨æ€çš„ç”Ÿæˆåå°„ç±»</li>
</ul>
</li>
<li><p>å…³é—­JVMå°±ä¼šé‡Šæ”¾è¿™ä¸ªåŒºåŸŸçš„å†…å­˜ã€‚</p>
</li>
</ul>
<h4 id="2-3ï¼ŒHotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›"><a href="#2-3ï¼ŒHotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›" class="headerlink" title="2.3ï¼ŒHotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›"></a>2.3ï¼ŒHotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›</h4><p>åœ¨jdk7åŠä»¥å‰ï¼Œä¹ æƒ¯ä¸ŠæŠŠæ–¹æ³•åŒºç§°ä¸ºæ°¸ä¹…ä»£ã€‚jdk8å¼€å§‹ï¼Œä½¿ç”¨å…ƒç©ºé—´å–ä»£äº†æ°¸ä¹…ä»£ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220216163305809.png" alt="image-20220216163305809" loading="lazy"></p>
<p>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£å¹¶ä¸ç­‰ä»·ã€‚ä»…æ˜¯å¯¹hotspotè€Œè¨€çš„ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹å¦‚ä½•å®ç°æ–¹æ³•åŒºï¼Œä¸åšç»Ÿä¸€è¦æ±‚ã€‚ä¾‹å¦‚ï¼šBEA JRockit / IBM J9 ä¸­ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µã€‚</p>
<p>ç°åœ¨æ¥çœ‹ï¼Œå½“å¹´ä½¿ç”¨æ°¸ä¹…ä»£ï¼Œä¸æ˜¯å¥½çš„ideaã€‚å¯¼è‡´Javaç¨‹åºæ›´å®¹æ˜“OOMï¼ˆè¶…è¿‡<code>-XX:MaxPermsize</code>ä¸Šé™ï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220216163359461.png" alt="image-20220216163359461" loading="lazy"></p>
<p>è€Œåˆ°äº†JDK8ï¼Œç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œæ”¹ç”¨ä¸JRockitã€J9ä¸€æ ·<u>åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰æ¥ä»£æ›¿</u></p>
<p><img src="/2022/04/18/JVM/image-20220216163444608.png" alt="image-20220216163444608" loading="lazy"></p>
<p>å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š<u>å…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚</u></p>
<p>æ°¸ä¹…ä»£ã€å…ƒç©ºé—´äºŒè€…å¹¶ä¸åªæ˜¯åå­—å˜äº†ï¼Œå†…éƒ¨ç»“æ„ä¹Ÿè°ƒæ•´äº†ã€‚</p>
<p>æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼Œå¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOOMå¼‚å¸¸ã€‚</p>
<h3 id="3ï¼Œè®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM"><a href="#3ï¼Œè®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM" class="headerlink" title="3ï¼Œè®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM"></a>3ï¼Œè®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM</h3><h4 id="3-1ï¼Œè®¾ç½®æ–¹æ³•åŒºå†…å­˜çš„å¤§å°"><a href="#3-1ï¼Œè®¾ç½®æ–¹æ³•åŒºå†…å­˜çš„å¤§å°" class="headerlink" title="3.1ï¼Œè®¾ç½®æ–¹æ³•åŒºå†…å­˜çš„å¤§å°"></a>3.1ï¼Œè®¾ç½®æ–¹æ³•åŒºå†…å­˜çš„å¤§å°</h4><p>æ–¹æ³•åŒºçš„å¤§å°ä¸å¿…æ˜¯å›ºå®šçš„ï¼ŒJVMå¯ä»¥æ ¹æ®åº”ç”¨çš„éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚</p>
<p><strong>jdk7åŠä»¥å‰</strong></p>
<ul>
<li><p>é€šè¿‡æ¥è®¾ç½®æ°¸ä¹…ä»£åˆå§‹åˆ†é…ç©ºé—´ã€‚é»˜è®¤å€¼æ˜¯20.75M<code>-XX:Permsize</code></p>
</li>
<li><p>é€šè¿‡æ¥è®¾å®šæ°¸ä¹…ä»£æœ€å¤§å¯åˆ†é…ç©ºé—´ã€‚32ä½æœºå™¨é»˜è®¤æ˜¯64Mï¼Œ64ä½æœºå™¨æ¨¡å¼æ˜¯82M<code>-XX:MaxPermsize</code></p>
</li>
<li><p>å½“JVMåŠ è½½çš„ç±»ä¿¡æ¯å®¹é‡è¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œä¼šæŠ¥å¼‚å¸¸<code>OutOfMemoryError:PermGen space</code>ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220216164422722.png" alt="image-20220216164422722" loading="lazy"></p>
<p><strong>JDK8ä»¥å</strong></p>
<ul>
<li><p>å…ƒæ•°æ®åŒºå¤§å°å¯ä»¥ä½¿ç”¨å‚æ•° <code>-XX:MetaspaceSize</code> å’Œ <code>-XX:MaxMetaspaceSize</code>æŒ‡å®š</p>
</li>
<li><p>é»˜è®¤å€¼ä¾èµ–äºå¹³å°ã€‚windowsä¸‹ï¼Œ<code>-XX:MetaspaceSize=21M -XX:MaxMetaspaceSize=-1//å³æ²¡æœ‰é™åˆ¶</code>ã€‚</p>
</li>
<li><p>ä¸æ°¸ä¹…ä»£ä¸åŒï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰çš„å¯ç”¨ç³»ç»Ÿå†…å­˜ã€‚å¦‚æœå…ƒæ•°æ®åŒºå‘ç”Ÿæº¢å‡ºï¼Œè™šæ‹Ÿæœºä¸€æ ·ä¼šæŠ›å‡ºå¼‚å¸¸<code>OutOfMemoryError:Metaspace</code></p>
</li>
<li><p><code>-XX:MetaspaceSize</code>ï¼šè®¾ç½®åˆå§‹çš„å…ƒç©ºé—´å¤§å°ã€‚å¯¹äºä¸€ä¸ª64ä½çš„æœåŠ¡å™¨ç«¯JVMæ¥è¯´ï¼Œå…¶é»˜è®¤çš„<code>-XX:MetaspaceSize</code>å€¼ä¸º21MBã€‚è¿™å°±æ˜¯åˆå§‹çš„é«˜æ°´ä½çº¿ï¼Œä¸€æ—¦è§¦åŠè¿™ä¸ªæ°´ä½çº¿ï¼ŒFull GCå°†ä¼šè¢«è§¦å‘å¹¶å¸è½½æ²¡ç”¨çš„ç±»ï¼ˆå³è¿™äº›ç±»å¯¹åº”çš„ç±»åŠ è½½å™¨ä¸å†å­˜æ´»ï¼‰ï¼Œç„¶åè¿™ä¸ªé«˜æ°´ä½çº¿å°†ä¼šé‡ç½®ã€‚æ–°çš„é«˜æ°´ä½çº¿çš„å€¼å–å†³äºGCåé‡Šæ”¾äº†å¤šå°‘å…ƒç©ºé—´ã€‚å¦‚æœé‡Šæ”¾çš„ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡<code>MaxMetaspaceSize</code>æ—¶ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚å¦‚æœé‡Šæ”¾ç©ºé—´è¿‡å¤šï¼Œåˆ™é€‚å½“é™ä½è¯¥å€¼ã€‚</p>
</li>
<li><p>å¦‚æœåˆå§‹åŒ–çš„é«˜æ°´ä½çº¿è®¾ç½®è¿‡ä½ï¼Œä¸Šè¿°é«˜æ°´ä½çº¿è°ƒæ•´æƒ…å†µä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ã€‚é€šè¿‡åƒåœ¾å›æ”¶å™¨çš„æ—¥å¿—å¯ä»¥è§‚å¯Ÿåˆ°Full GCå¤šæ¬¡è°ƒç”¨ã€‚ä¸ºäº†é¿å…é¢‘ç¹åœ°GCï¼Œå»ºè®®å°†<code>-XX:MetaspaceSize</code>è®¾ç½®ä¸ºä¸€ä¸ªç›¸å¯¹è¾ƒé«˜çš„å€¼ã€‚</p>
</li>
</ul>
<p><strong>ä¸¾ä¾‹1ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹çš„ä¾‹å­</strong></p>
<p><img src="/2022/04/18/JVM/image-20220216164703741.png" alt="image-20220216164703741" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jdk8ä¸­ï¼š</span></span><br><span class="line"><span class="comment"> * -XX:MetaspaceSize=10m-XX:MaxMetaspaceSize=10m</span></span><br><span class="line"><span class="comment"> * jdk6ä¸­ï¼š</span></span><br><span class="line"><span class="comment"> * -XX:PermSize=10m-XX:MaxPermSize=10m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OOMTest</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">OOMTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OOMTest</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10000</span>;i++)&#123;</span><br><span class="line">                <span class="comment">//åˆ›å»ºClasswriterå¯¹è±¡ï¼Œç”¨äºç”Ÿæˆç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç </span></span><br><span class="line">                <span class="type">ClassWriter</span> <span class="variable">classWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="comment">//æŒ‡æ˜ç‰ˆæœ¬å·ï¼Œpublicï¼Œç±»åï¼ŒåŒ…åï¼Œçˆ¶ç±»ï¼Œæ¥å£</span></span><br><span class="line">                classWriter.visit(Opcodes.V1_6, Opcodes.ACC_PUBLIC, <span class="string">&quot;Class&quot;</span> + i, nu1l, <span class="string">&quot;java/lang/Object&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//è¿”å›byte[]</span></span><br><span class="line">                <span class="type">byte</span>[] code = classWriter.toByteArray();</span><br><span class="line">                <span class="comment">//ç±»çš„åŠ è½½</span></span><br><span class="line">                test.defineClass(<span class="string">&quot;Class&quot;</span> + i, code, <span class="number">0</span>, code.length); <span class="comment">//CLasså¯¹è±¡</span></span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            System.out.println(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2ï¼Œå¦‚ä½•è§£å†³è¿™äº›OOM"><a href="#3-2ï¼Œå¦‚ä½•è§£å†³è¿™äº›OOM" class="headerlink" title="3.2ï¼Œå¦‚ä½•è§£å†³è¿™äº›OOM"></a>3.2ï¼Œå¦‚ä½•è§£å†³è¿™äº›OOM</h4><ol>
<li> è¦è§£å†³OOMå¼‚å¸¸æˆ–heap spaceçš„å¼‚å¸¸ï¼Œä¸€èˆ¬çš„æ‰‹æ®µæ˜¯é¦–å…ˆé€šè¿‡å†…å­˜æ˜ åƒåˆ†æå·¥å…·ï¼ˆå¦‚Eclipse Memory Analyzerï¼‰å¯¹dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆåˆ†æ¸…æ¥šåˆ°åº•æ˜¯å‡ºç°äº†å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰è¿˜æ˜¯å†…å­˜æº¢å‡ºï¼ˆMemory Overflowï¼‰ </li>
<li> å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œå¯è¿›ä¸€æ­¥é€šè¿‡å·¥å…·æŸ¥çœ‹æ³„æ¼å¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ã€‚äºæ˜¯å°±èƒ½æ‰¾åˆ°æ³„æ¼å¯¹è±¡æ˜¯é€šè¿‡æ€æ ·çš„è·¯å¾„ä¸GCRootsç›¸å…³è”å¹¶å¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨å›æ”¶å®ƒä»¬çš„ã€‚æŒæ¡äº†æ³„æ¼å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œä»¥åŠGCRootså¼•ç”¨é“¾çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¯”è¾ƒå‡†ç¡®åœ°å®šä½å‡ºæ³„æ¼ä»£ç çš„ä½ç½®ã€‚ </li>
<li> å¦‚æœä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å†…å­˜ä¸­çš„å¯¹è±¡ç¡®å®éƒ½è¿˜å¿…é¡»å­˜æ´»ç€ï¼Œé‚£å°±åº”å½“æ£€æŸ¥è™šæ‹Ÿæœºçš„å †å‚æ•°ï¼ˆ<code>-Xmx</code>ä¸<code>-Xms</code>ï¼‰ï¼Œä¸æœºå™¨ç‰©ç†å†…å­˜å¯¹æ¯”çœ‹æ˜¯å¦è¿˜å¯ä»¥è°ƒå¤§ï¼Œä»ä»£ç ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ã€æŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œå°è¯•å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—ã€‚ </li>
</ol>
<h3 id="4ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"><a href="#4ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„" class="headerlink" title="4ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"></a>4ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</h3><p><img src="/2022/04/18/JVM/image-20220216165227944.png" alt="image-20220216165227944" loading="lazy"></p>
<h4 id="4-1ï¼Œæ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰å­˜å‚¨ä»€ä¹ˆ"><a href="#4-1ï¼Œæ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰å­˜å‚¨ä»€ä¹ˆ" class="headerlink" title="4.1ï¼Œæ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨ä»€ä¹ˆ"></a>4.1ï¼Œæ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨ä»€ä¹ˆ</h4><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¹¦ä¸­å¯¹æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨å†…å®¹æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰ã€‚</p>
</blockquote>
<p><img src="/2022/04/18/JVM/image-20220216165501664.png" alt="image-20220216165501664" loading="lazy"></p>
<h4 id="4-2ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"><a href="#4-2ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„" class="headerlink" title="4.2ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"></a>4.2ï¼Œæ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</h4><h5 id="ç±»å‹ä¿¡æ¯"><a href="#ç±»å‹ä¿¡æ¯" class="headerlink" title="ç±»å‹ä¿¡æ¯"></a>ç±»å‹ä¿¡æ¯</h5><p>å¯¹æ¯ä¸ªåŠ è½½çš„ç±»å‹ï¼ˆç±»classã€æ¥å£interfaceã€æšä¸¾enumã€æ³¨è§£annotationï¼‰ï¼ŒJVMå¿…é¡»åœ¨æ–¹æ³•åŒºä¸­å­˜å‚¨ä»¥ä¸‹ç±»å‹ä¿¡æ¯ï¼š</p>
<ol>
<li>è¿™ä¸ªç±»å‹çš„å®Œæ•´æœ‰æ•ˆåç§°ï¼ˆå…¨å=åŒ…å.ç±»åï¼‰</li>
<li>è¿™ä¸ªç±»å‹ç›´æ¥çˆ¶ç±»çš„å®Œæ•´æœ‰æ•ˆåï¼ˆå¯¹äºinterfaceæˆ–æ˜¯java.lang.objectï¼Œéƒ½æ²¡æœ‰çˆ¶ç±»ï¼‰</li>
<li>è¿™ä¸ªç±»å‹çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œabstractï¼Œfinalçš„æŸä¸ªå­é›†ï¼‰</li>
<li>è¿™ä¸ªç±»å‹ç›´æ¥æ¥å£çš„ä¸€ä¸ªæœ‰åºåˆ—è¡¨</li>
</ol>
<h5 id="åŸŸï¼ˆFieldï¼‰ä¿¡æ¯"><a href="#åŸŸï¼ˆFieldï¼‰ä¿¡æ¯" class="headerlink" title="åŸŸï¼ˆFieldï¼‰ä¿¡æ¯"></a>åŸŸï¼ˆFieldï¼‰ä¿¡æ¯</h5><p>JVMå¿…é¡»åœ¨æ–¹æ³•åŒºä¸­ä¿å­˜ç±»å‹çš„æ‰€æœ‰åŸŸçš„ç›¸å…³ä¿¡æ¯ä»¥åŠåŸŸçš„å£°æ˜é¡ºåºã€‚</p>
<p>åŸŸçš„ç›¸å…³ä¿¡æ¯åŒ…æ‹¬ï¼šåŸŸåç§°ã€åŸŸç±»å‹ã€åŸŸä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œvolatileï¼Œtransientçš„æŸä¸ªå­é›†ï¼‰</p>
<h5 id="æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯"><a href="#æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯" class="headerlink" title="æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯"></a>æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯</h5><p>JVMå¿…é¡»ä¿å­˜æ‰€æœ‰æ–¹æ³•çš„ä»¥ä¸‹ä¿¡æ¯ï¼ŒåŒåŸŸä¿¡æ¯ä¸€æ ·åŒ…æ‹¬å£°æ˜é¡ºåºï¼š</p>
<ol>
<li>æ–¹æ³•åç§°</li>
<li>æ–¹æ³•çš„è¿”å›ç±»å‹ï¼ˆæˆ–voidï¼‰</li>
<li>æ–¹æ³•å‚æ•°çš„æ•°é‡å’Œç±»å‹ï¼ˆæŒ‰é¡ºåºï¼‰</li>
<li>æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œsynchronizedï¼Œnativeï¼Œabstractçš„ä¸€ä¸ªå­é›†ï¼‰</li>
<li>æ–¹æ³•çš„å­—èŠ‚ç ï¼ˆbytecodesï¼‰ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨åŠå¤§å°ï¼ˆabstractå’Œnativeæ–¹æ³•é™¤å¤–ï¼‰</li>
<li>å¼‚å¸¸è¡¨ï¼ˆabstractå’Œnativeæ–¹æ³•é™¤å¤–ï¼‰ </li>
</ol>
<ul>
<li><ul>
<li>æ¯ä¸ªå¼‚å¸¸å¤„ç†çš„å¼€å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€ä»£ç å¤„ç†åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­çš„åç§»åœ°å€ã€è¢«æ•è·çš„å¼‚å¸¸ç±»çš„å¸¸é‡æ± ç´¢å¼•</li>
</ul>
</li>
</ul>
<h5 id="non-finalçš„ç±»å˜é‡"><a href="#non-finalçš„ç±»å˜é‡" class="headerlink" title="non-finalçš„ç±»å˜é‡"></a>non-finalçš„ç±»å˜é‡</h5><ul>
<li><p>é™æ€å˜é‡å’Œç±»å…³è”åœ¨ä¸€èµ·ï¼Œéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼Œä»–ä»¬æˆä¸ºç±»æ•°æ®åœ¨é€»è¾‘ä¸Šçš„ä¸€éƒ¨åˆ†</p>
</li>
<li><p>ç±»å˜é‡è¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œå³ä½¿æ²¡æœ‰ç±»å®ä¾‹æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥è®¿é—®å®ƒ</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.hello();</span><br><span class="line">        System.out.println(order.count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="è¡¥å……è¯´æ˜ï¼šå…¨å±€å¸¸é‡ï¼ˆstatic-finalï¼‰"><a href="#è¡¥å……è¯´æ˜ï¼šå…¨å±€å¸¸é‡ï¼ˆstatic-finalï¼‰" class="headerlink" title="è¡¥å……è¯´æ˜ï¼šå…¨å±€å¸¸é‡ï¼ˆstatic finalï¼‰"></a>è¡¥å……è¯´æ˜ï¼šå…¨å±€å¸¸é‡ï¼ˆstatic finalï¼‰</h5><p>è¢«å£°æ˜ä¸ºfinalçš„ç±»å˜é‡çš„å¤„ç†æ–¹æ³•åˆ™ä¸åŒï¼Œæ¯ä¸ª<u>å…¨å±€å¸¸é‡åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šè¢«åˆ†é…äº†</u>ã€‚</p>
<h4 id="4-3ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± -VS-å¸¸é‡æ± "><a href="#4-3ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± -VS-å¸¸é‡æ± " class="headerlink" title="4.3ï¼Œè¿è¡Œæ—¶å¸¸é‡æ±  VS å¸¸é‡æ± "></a>4.3ï¼Œè¿è¡Œæ—¶å¸¸é‡æ±  VS å¸¸é‡æ± </h4><p><img src="/2022/04/18/JVM/image-20220216170021555.png" alt="image-20220216170021555" loading="lazy"></p>
<ul>
<li><p>æ–¹æ³•åŒºï¼Œå†…éƒ¨åŒ…å«äº†è¿è¡Œæ—¶å¸¸é‡æ± </p>
</li>
<li><p>å­—èŠ‚ç æ–‡ä»¶ï¼Œå†…éƒ¨åŒ…å«äº†å¸¸é‡æ± </p>
</li>
<li><p>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºï¼Œéœ€è¦ç†è§£æ¸…æ¥šClassFileï¼Œå› ä¸ºåŠ è½½ç±»çš„ä¿¡æ¯éƒ½åœ¨æ–¹æ³•åŒºã€‚</p>
</li>
<li><p>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œéœ€è¦ç†è§£æ¸…æ¥šClassFileä¸­çš„å¸¸é‡æ± ã€‚</p>
</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></p>
<p><img src="/2022/04/18/JVM/image-20220216170139807.png" alt="image-20220216170139807" loading="lazy"></p>
<p>ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€å­—æ®µã€æ–¹æ³•ä»¥åŠæ¥å£ç­‰æè¿°ç¬¦ä¿¡æ¯å¤–ï¼Œè¿˜åŒ…å«ä¸€é¡¹ä¿¡æ¯å°±æ˜¯å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰ï¼ŒåŒ…æ‹¬å„ç§å­—é¢é‡å’Œå¯¹ç±»å‹ã€åŸŸå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨</p>
<h5 id="ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ</h5><p>ä¸€ä¸ªjavaæºæ–‡ä»¶ä¸­çš„ç±»ã€æ¥å£ï¼Œç¼–è¯‘åäº§ç”Ÿä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ã€‚è€ŒJavaä¸­çš„å­—èŠ‚ç éœ€è¦æ•°æ®æ”¯æŒï¼Œé€šå¸¸è¿™ç§æ•°æ®ä¼šå¾ˆå¤§ä»¥è‡³äºä¸èƒ½ç›´æ¥å­˜åˆ°å­—èŠ‚ç é‡Œï¼Œæ¢å¦ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å­˜åˆ°å¸¸é‡æ± ï¼Œè¿™ä¸ªå­—èŠ‚ç åŒ…å«äº†æŒ‡å‘å¸¸é‡æ± çš„å¼•ç”¨ã€‚åœ¨åŠ¨æ€é“¾æ¥çš„æ—¶å€™ä¼šç”¨åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¹‹å‰æœ‰ä»‹ç»ã€‚</p>
<p>æ¯”å¦‚ï¼šå¦‚ä¸‹çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶åªæœ‰194å­—èŠ‚ï¼Œä½†æ˜¯é‡Œé¢å´ä½¿ç”¨äº†Stringã€Systemã€PrintStreamåŠObjectç­‰ç»“æ„ã€‚è¿™é‡Œçš„ä»£ç é‡å…¶å®å¾ˆå°‘äº†ï¼Œå¦‚æœä»£ç å¤šçš„è¯ï¼Œå¼•ç”¨çš„ç»“æ„å°†ä¼šæ›´å¤šï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°å¸¸é‡æ± äº†ã€‚</p>
<h5 id="å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ"><a href="#å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ" class="headerlink" title="å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ?"></a>å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ?</h5><p>å‡»ä¸­å¸¸é‡æ± å†…å­˜å‚¨çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>æ•°é‡å€¼</p>
</li>
<li><p>å­—ç¬¦ä¸²å€¼</p>
</li>
<li><p>ç±»å¼•ç”¨</p>
</li>
<li><p>å­—æ®µå¼•ç”¨</p>
</li>
<li><p>æ–¹æ³•å¼•ç”¨</p>
</li>
</ul>
<p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Object obj = new Object();</code>å°†ä¼šè¢«ç¿»è¯‘æˆå¦‚ä¸‹å­—èŠ‚ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: <span class="keyword">new</span> #<span class="number">2</span>  <span class="comment">// Class java/lang/Object</span></span><br><span class="line"><span class="number">1</span>: dup</span><br><span class="line"><span class="number">2</span>: invokespecial <span class="comment">// Method java/lang/Object &quot;&lt;init&gt;&quot;() V</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><p>å¸¸é‡æ± ã€å¯ä»¥çœ‹åšæ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ç±»å‹</p>
<h4 id="4-4ï¼Œ-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#4-4ï¼Œ-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="4.4ï¼Œ è¿è¡Œæ—¶å¸¸é‡æ± "></a>4.4ï¼Œ è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</p>
</li>
<li><p>å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰<u>æ˜¯Classæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚</u></p>
</li>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œåœ¨åŠ è½½ç±»å’Œæ¥å£åˆ°è™šæ‹Ÿæœºåï¼Œå°±ä¼šåˆ›å»ºå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p>
</li>
<li><p>JVMä¸ºæ¯ä¸ªå·²åŠ è½½çš„ç±»å‹ï¼ˆç±»æˆ–æ¥å£ï¼‰éƒ½ç»´æŠ¤ä¸€ä¸ªå¸¸é‡æ± ã€‚æ± ä¸­çš„æ•°æ®é¡¹åƒæ•°ç»„é¡¹ä¸€æ ·ï¼Œæ˜¯é€šè¿‡ç´¢å¼•è®¿é—®çš„ã€‚</p>
</li>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ä¸­åŒ…å«å¤šç§ä¸åŒçš„å¸¸é‡ï¼ŒåŒ…æ‹¬ç¼–è¯‘æœŸå°±å·²ç»æ˜ç¡®çš„æ•°å€¼å­—é¢é‡ï¼Œä¹ŸåŒ…æ‹¬åˆ°è¿è¡ŒæœŸè§£æåæ‰èƒ½å¤Ÿè·å¾—çš„æ–¹æ³•æˆ–è€…å­—æ®µå¼•ç”¨ã€‚æ­¤æ—¶ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·åœ°å€äº†ï¼Œè¿™é‡Œæ¢ä¸ºçœŸå®åœ°å€ã€‚</p>
</li>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç›¸å¯¹äºClassæ–‡ä»¶å¸¸é‡æ± çš„å¦ä¸€é‡è¦ç‰¹å¾æ˜¯ï¼šå…·å¤‡åŠ¨æ€æ€§ã€‚</p>
</li>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­çš„ç¬¦å·è¡¨ï¼ˆsymboltableï¼‰ï¼Œä½†æ˜¯å®ƒæ‰€åŒ…å«çš„æ•°æ®å´æ¯”ç¬¦å·è¡¨è¦æ›´åŠ ä¸°å¯Œä¸€äº›ã€‚</p>
</li>
<li><p>å½“åˆ›å»ºç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶å¸¸é‡æ± æ—¶ï¼Œå¦‚æœæ„é€ è¿è¡Œæ—¶å¸¸é‡æ± æ‰€éœ€çš„å†…å­˜ç©ºé—´è¶…è¿‡äº†æ–¹æ³•åŒºæ‰€èƒ½æä¾›çš„æœ€å¤§å€¼ï¼Œåˆ™JVMä¼šæŠ›OutOfMemoryErrorå¼‚å¸¸</p>
</li>
</ul>
<h3 id="5ï¼Œæ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹"><a href="#5ï¼Œæ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="5ï¼Œæ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹"></a>5ï¼Œæ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> x / y;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">        System.out.println(a+b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220216170903651.png" alt="image-20220216170903651" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216170944359.png" alt="image-20220216170944359" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171016642.png" alt="image-20220216171016642" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171056031.png" alt="image-20220216171056031" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171108517.png" alt="image-20220216171108517" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171129443.png" alt="image-20220216171129443" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171146350.png" alt="image-20220216171146350" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171156533.png" alt="image-20220216171156533" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171223328.png" alt="image-20220216171223328" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171302523.png" alt="image-20220216171302523" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171330285.png" alt="image-20220216171330285" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171354428.png" alt="image-20220216171354428" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171413472.png" alt="image-20220216171413472" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171430158.png" alt="image-20220216171430158" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171444357.png" alt="image-20220216171444357" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171512383.png" alt="image-20220216171512383" loading="lazy"></p>
<h3 id="6ï¼Œæ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚"><a href="#6ï¼Œæ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚" class="headerlink" title="6ï¼Œæ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚"></a>6ï¼Œæ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚</h3><ol>
<li><p>é¦–å…ˆæ˜ç¡®ï¼šåªæœ‰Hotspotæ‰æœ‰æ°¸ä¹…ä»£ã€‚BEA JRockitã€IBMJ9ç­‰æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µçš„ã€‚åŸåˆ™ä¸Šå¦‚ä½•å®ç°æ–¹æ³•åŒºå±äºè™šæ‹Ÿæœºå®ç°ç»†èŠ‚ï¼Œä¸å—ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ç®¡æŸï¼Œå¹¶ä¸è¦æ±‚ç»Ÿä¸€</p>
</li>
<li><p>Hotspotä¸­æ–¹æ³•åŒºçš„å˜åŒ–ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220216171630156.png" alt="image-20220216171630156" loading="lazy"></p>
</li>
</ol>
<p><img src="/2022/04/18/JVM/image-20220216171715566.png" alt="image-20220216171715566" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171734535.png" alt="image-20220216171734535" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220216171747085.png" alt="image-20220216171747085" loading="lazy"></p>
<h4 id="6-1ï¼Œä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ"><a href="#6-1ï¼Œä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ" class="headerlink" title="6.1ï¼Œä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ"></a>6.1ï¼Œä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</h4><p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/122">JEP 122: Remove the Permanent Generation (java.net)</a><img src="/2022/04/18/JVM/image-20220216171821904.png" alt="image-20220216171821904" loading="lazy"></p>
<p>JRockitæ˜¯å’ŒHotSpotèåˆåçš„ç»“æœï¼Œå› ä¸ºJRockitæ²¡æœ‰æ°¸ä¹…ä»£ï¼Œæ‰€ä»¥ä»–ä»¬ä¸éœ€è¦é…ç½®æ°¸ä¹…ä»£</p>
<p>éšç€Java8çš„åˆ°æ¥ï¼ŒHotSpot VMä¸­å†ä¹Ÿè§ä¸åˆ°æ°¸ä¹…ä»£äº†ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ä¹Ÿæ¶ˆå¤±äº†ã€‚è¿™äº›æ•°æ®è¢«ç§»åˆ°äº†ä¸€ä¸ªä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸå«åšå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚</p>
<p>ç”±äºç±»çš„å…ƒæ•°æ®åˆ†é…åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œå…ƒç©ºé—´çš„æœ€å¤§å¯åˆ†é…ç©ºé—´å°±æ˜¯ç³»ç»Ÿå¯ç”¨å†…å­˜ç©ºé—´ã€‚</p>
<p>è¿™é¡¹æ”¹åŠ¨æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼ŒåŸå› æœ‰ï¼š</p>
<ul>
<li><p>ä¸ºæ°¸ä¹…ä»£è®¾ç½®ç©ºé—´å¤§å°æ˜¯å¾ˆéš¾ç¡®å®šçš„ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¦‚æœåŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼Œå®¹æ˜“äº§ç”ŸPermåŒºçš„oomã€‚æ¯”å¦‚æŸä¸ªå®é™…Webå·¥ ç¨‹ä¸­ï¼Œå› ä¸ºåŠŸèƒ½ç‚¹æ¯”è¾ƒå¤šï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ä¸æ–­åŠ¨æ€åŠ è½½å¾ˆå¤šç±»ï¼Œç»å¸¸å‡ºç°è‡´å‘½é”™è¯¯ã€‚<br>è€Œå…ƒç©ºé—´å’Œæ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Exception in thread &#x27;dubbo client x.x connector&#x27; java.lang.OutOfMemoryError:PermGen space&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>å¯¹æ°¸ä¹…ä»£è¿›è¡Œè°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ã€‚ </p>
<p>æœ‰äº›äººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆå¦‚HotSpotè™šæ‹Ÿæœºä¸­çš„å…ƒç©ºé—´æˆ–è€…æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†è¡Œä¸ºçš„ï¼Œå…¶å®ä¸ç„¶ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹æ–¹æ³•åŒºçš„çº¦æŸæ˜¯éå¸¸å®½æ¾çš„ï¼Œæåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æœ‰æœªå®ç°æˆ–æœªèƒ½å®Œæ•´å®ç°æ–¹æ³•åŒºç±»å‹å¸è½½çš„æ”¶é›†å™¨å­˜åœ¨ï¼ˆå¦‚JDK 11æ—¶æœŸçš„ZGCæ”¶é›†å™¨å°±ä¸æ”¯æŒç±»å¸è½½ï¼‰ã€‚ ä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶æ•ˆæœæ¯”è¾ƒéš¾ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶æœ‰æ—¶åˆç¡®å®æ˜¯å¿…è¦çš„ã€‚ä»¥å‰Sunå…¬å¸çš„Bugåˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„Bugå°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼</p>
<p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹</p>
</li>
</ul>
<h4 id="6-2ï¼ŒStringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ"><a href="#6-2ï¼ŒStringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ" class="headerlink" title="6.2ï¼ŒStringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ"></a>6.2ï¼ŒStringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ</h4><p>jdk7ä¸­å°†StringTableæ”¾åˆ°äº†å †ç©ºé—´ä¸­ã€‚å› ä¸ºæ°¸ä¹…ä»£çš„å›æ”¶æ•ˆç‡å¾ˆä½ï¼Œåœ¨full gcçš„æ—¶å€™æ‰ä¼šè§¦å‘ã€‚è€Œfull gcæ˜¯è€å¹´ä»£çš„ç©ºé—´ä¸è¶³ã€æ°¸ä¹…ä»£ä¸è¶³æ—¶æ‰ä¼šè§¦å‘ã€‚</p>
<p>è¿™å°±å¯¼è‡´StringTableå›æ”¶æ•ˆç‡ä¸é«˜ã€‚è€Œæˆ‘ä»¬å¼€å‘ä¸­ä¼šæœ‰å¤§é‡çš„å­—ç¬¦ä¸²è¢«åˆ›å»ºï¼Œå›æ”¶æ•ˆç‡ä½ï¼Œå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜ä¸è¶³ã€‚æ”¾åˆ°å †é‡Œï¼Œèƒ½åŠæ—¶å›æ”¶å†…å­˜ã€‚</p>
<h4 id="6-3ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨é‚£é‡Œï¼Ÿ"><a href="#6-3ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨é‚£é‡Œï¼Ÿ" class="headerlink" title="6.3ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨é‚£é‡Œï¼Ÿ"></a>6.3ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨é‚£é‡Œï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å¼•ç”¨å¯¹åº”çš„å¯¹è±¡å®ä½“å§‹ç»ˆéƒ½å­˜åœ¨å †ç©ºé—´</span></span><br><span class="line"><span class="comment"> * jdk7:</span></span><br><span class="line"><span class="comment"> * -Xms200m -Xmx200m -XX:PermSize=300m -XX:MaxPermSize=300m -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * jdk8:</span></span><br><span class="line"><span class="comment"> * -Xms200m -Xmx200m-XX:MetaspaceSize=300m -XX:MaxMetaspaceSize=300m -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticFieldTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] arr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(StaticFieldTest.arr);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * staticobjã€instanceobjã€Localobjå­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticobjTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="type">ObjectHolder</span> <span class="variable">staticobj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectHolder</span>();</span><br><span class="line">        <span class="type">ObjectHolder</span> <span class="variable">instanceobj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectHolder</span>();</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="type">ObjectHolder</span> <span class="variable">localobj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectHolder</span>();</span><br><span class="line">            System.out.println(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ObjectHolder</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticobjTest</span>.Test();</span><br><span class="line">            test.foo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨JHSDBå·¥å…·è¿›è¡Œåˆ†æï¼Œè¿™é‡Œç»†èŠ‚ç•¥æ‰</p>
<p><img src="/2022/04/18/JVM/image-20220216172305117.png" alt="image-20220216172305117" loading="lazy"></p>
<p>staticobjéšç€Testçš„ç±»å‹ä¿¡æ¯å­˜æ”¾åœ¨æ–¹æ³•åŒºï¼Œinstanceobjéšç€Testçš„å¯¹è±¡å®ä¾‹å­˜æ”¾åœ¨Javaå †ï¼Œlocalobjectåˆ™æ˜¯å­˜æ”¾åœ¨foo()æ–¹æ³•æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220216172346952.png" alt="image-20220216172346952" loading="lazy"></p>
<p>æµ‹è¯•å‘ç°ï¼šä¸‰ä¸ªå¯¹è±¡çš„æ•°æ®åœ¨å†…å­˜ä¸­çš„åœ°å€éƒ½è½åœ¨EdenåŒºèŒƒå›´å†…ï¼Œæ‰€ä»¥ç»“è®ºï¼š<strong>åªè¦æ˜¯å¯¹è±¡å®ä¾‹å¿…ç„¶ä¼šåœ¨Javaå †ä¸­åˆ†é…ã€‚</strong></p>
<p>æ¥ç€ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå¼•ç”¨è¯¥staticobjå¯¹è±¡çš„åœ°æ–¹ï¼Œæ˜¯åœ¨ä¸€ä¸ªjava.lang.Classçš„å®ä¾‹é‡Œï¼Œå¹¶ä¸”ç»™å‡ºäº†è¿™ä¸ªå®ä¾‹çš„åœ°å€ï¼Œé€šè¿‡InspectoræŸ¥çœ‹è¯¥å¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥æ¸…æ¥šçœ‹åˆ°è¿™ç¡®å®æ˜¯ä¸€ä¸ªjava.lang.Classç±»å‹çš„å¯¹è±¡å®ä¾‹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåä¸ºstaticobjçš„å®ä¾‹å­—æ®µï¼š</p>
<p>ä»ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹æ‰€å®šä¹‰çš„æ¦‚å¿µæ¨¡å‹æ¥çœ‹ï¼Œæ‰€æœ‰Classç›¸å…³çš„ä¿¡æ¯éƒ½åº”è¯¥å­˜æ”¾åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œä½†æ–¹æ³•åŒºè¯¥å¦‚ä½•å®ç°ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¹¶æœªåšå‡ºè§„å®šï¼Œè¿™å°±æˆäº†ä¸€ä»¶å…è®¸ä¸åŒè™šæ‹Ÿæœºè‡ªå·±çµæ´»æŠŠæ¡çš„äº‹æƒ…ã€‚JDK7åŠå…¶ä»¥åç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºé€‰æ‹©æŠŠé™æ€å˜é‡ä¸ç±»å‹åœ¨Javaè¯­è¨€ä¸€ç«¯çš„æ˜ å°„classå¯¹è±¡å­˜æ”¾åœ¨ä¸€èµ·ï¼Œå­˜å‚¨äºJavaå †ä¹‹ä¸­ï¼Œä»æˆ‘ä»¬çš„å®éªŒä¸­ä¹Ÿæ˜ç¡®éªŒè¯äº†è¿™ä¸€ç‚¹</p>
<h3 id="7ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶"><a href="#7ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶" class="headerlink" title="7ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶"></a>7ï¼Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</h3><p>æœ‰äº›äººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆå¦‚Hotspotè™šæ‹Ÿæœºä¸­çš„å…ƒç©ºé—´æˆ–è€…æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†è¡Œä¸ºçš„ï¼Œå…¶å®ä¸ç„¶ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹æ–¹æ³•åŒºçš„çº¦æŸæ˜¯éå¸¸å®½æ¾çš„ï¼Œæåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æœ‰æœªå®ç°æˆ–æœªèƒ½å®Œæ•´å®ç°æ–¹æ³•åŒºç±»å‹å¸è½½çš„æ”¶é›†å™¨å­˜åœ¨ï¼ˆå¦‚JDK11æ—¶æœŸçš„zGCæ”¶é›†å™¨å°±ä¸æ”¯æŒç±»å¸è½½ï¼‰ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶æ•ˆæœæ¯”è¾ƒéš¾ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶æœ‰æ—¶åˆç¡®å®æ˜¯å¿…è¦çš„ã€‚ä»¥å‰sunå…¬å¸çš„Bugåˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„Bugå°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p><strong>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹ã€‚</strong></p>
<p>å…ˆæ¥è¯´è¯´æ–¹æ³•åŒºå†…å¸¸é‡æ± ä¹‹ä¸­ä¸»è¦å­˜æ”¾çš„ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘Javaè¯­è¨€å±‚æ¬¡çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š</p>
<ul>
<li><p>ç±»å’Œæ¥å£çš„å…¨é™å®šå</p>
</li>
<li><p>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</p>
</li>
<li><p>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</p>
</li>
</ul>
<p>HotSpotè™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œ<strong>åªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</strong></p>
<p>å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶Javaå †ä¸­çš„å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚</p>
<p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦â€œåºŸå¼ƒâ€è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äºâ€œä¸å†è¢«ä½¿ç”¨çš„ç±»â€çš„æ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><p> <strong>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶</strong>ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚ </p>
</li>
<li><p> <strong>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶</strong>ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚OSGiã€JSPçš„é‡åŠ è½½ç­‰ï¼Œå¦åˆ™é€šå¸¸æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚ </p>
</li>
<li><p> <strong>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨</strong>ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ </p>
</li>
</ul>
<p>Javaè™šæ‹Ÿæœºè¢«å…è®¸å¯¹æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œè¢«å…è®¸â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œæ²¡æœ‰å¼•ç”¨äº†å°±å¿…ç„¶ä¼šå›æ”¶ã€‚å…³äºæ˜¯å¦è¦å¯¹ç±»å‹è¿›è¡Œå›æ”¶ï¼ŒHotSpotè™šæ‹Ÿæœºæä¾›äº†<code>-Xnoclassgc</code>å‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>-verbose:class</code> ä»¥åŠ <code>-XX:+TraceClassLoading</code>ã€<code>-XX:+TraceClassUnLoading</code>æŸ¥çœ‹ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯</p>
<p>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰å­—èŠ‚ç æ¡†æ¶ï¼ŒåŠ¨æ€ç”ŸæˆJSPä»¥åŠOSGiè¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åœºæ™¯ä¸­ï¼Œé€šå¸¸éƒ½éœ€è¦Javaè™šæ‹Ÿæœºå…·å¤‡ç±»å‹å¸è½½çš„èƒ½åŠ›ï¼Œä»¥ä¿è¯ä¸ä¼šå¯¹æ–¹æ³•åŒºé€ æˆè¿‡å¤§çš„å†…å­˜å‹åŠ›ã€‚</p>
<h3 id="8ï¼Œæ€»ç»“"><a href="#8ï¼Œæ€»ç»“" class="headerlink" title="8ï¼Œæ€»ç»“"></a>8ï¼Œæ€»ç»“</h3><p><img src="/2022/04/18/JVM/image-20220216172843525.png" alt="image-20220216172843525" loading="lazy"></p>
<h4 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h4><p><strong>ç™¾åº¦ï¼š</strong></p>
<p>è¯´ä¸€ä¸‹JVMå†…å­˜æ¨¡å‹å§ï¼Œæœ‰å“ªäº›åŒºï¼Ÿåˆ†åˆ«å¹²ä»€ä¹ˆçš„ï¼Ÿ</p>
<p><strong>èš‚èšé‡‘æœï¼š</strong></p>
<p>Java8çš„å†…å­˜åˆ†ä»£æ”¹è¿› JVMå†…å­˜åˆ†å“ªå‡ ä¸ªåŒºï¼Œæ¯ä¸ªåŒºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ä¸€é¢ï¼šJVMå†…å­˜åˆ†å¸ƒ/å†…å­˜ç»“æ„ï¼Ÿæ ˆå’Œå †çš„åŒºåˆ«ï¼Ÿå †çš„ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆä¸¤ä¸ªsurvivoråŒºï¼Ÿ</p>
<p>äºŒé¢ï¼šEdenå’Œsurviorçš„æ¯”ä¾‹åˆ†é…</p>
<p><strong>å°ç±³ï¼š</strong></p>
<p>jvmå†…å­˜åˆ†åŒºï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£</p>
<p><strong>å­—èŠ‚è·³åŠ¨ï¼š</strong></p>
<p>äºŒé¢ï¼šJavaçš„å†…å­˜åˆ†åŒº</p>
<p>äºŒé¢ï¼šè®²è®²vmè¿è¡Œæ—¶æ•°æ®åº“åŒº ä»€ä¹ˆæ—¶å€™å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ</p>
<p><strong>äº¬ä¸œï¼š</strong></p>
<p>JVMçš„å†…å­˜ç»“æ„ï¼ŒEdenå’ŒSurvivoræ¯”ä¾‹ã€‚</p>
<p>JVMå†…å­˜ä¸ºä»€ä¹ˆè¦åˆ†æˆæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼ŒæŒä¹…ä»£ã€‚</p>
<p>æ–°ç”Ÿä»£ä¸­ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºEdenå’Œsurvivorã€‚</p>
<p><strong>å¤©çŒ«ï¼š</strong></p>
<p>ä¸€é¢ï¼šJvmå†…å­˜æ¨¡å‹ä»¥åŠåˆ†åŒºï¼Œéœ€è¦è¯¦ç»†åˆ°æ¯ä¸ªåŒºæ”¾ä»€ä¹ˆã€‚</p>
<p>ä¸€é¢ï¼šJVMçš„å†…å­˜æ¨¡å‹ï¼ŒJava8åšäº†ä»€ä¹ˆæ”¹</p>
<p><strong>æ‹¼å¤šå¤šï¼š</strong></p>
<p>JVMå†…å­˜åˆ†å“ªå‡ ä¸ªåŒºï¼Œæ¯ä¸ªåŒºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><strong>ç¾å›¢ï¼š</strong></p>
<p>javaå†…å­˜åˆ†é… jvmçš„æ°¸ä¹…ä»£ä¸­ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶å—ï¼Ÿ</p>
<p>ä¸€é¢ï¼šjvmå†…å­˜åˆ†åŒºï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ</p>
<h2 id="å…«ï¼Œå¯¹è±¡å®ä¾‹åŒ–åŠç›´æ¥å†…å­˜"><a href="#å…«ï¼Œå¯¹è±¡å®ä¾‹åŒ–åŠç›´æ¥å†…å­˜" class="headerlink" title="å…«ï¼Œå¯¹è±¡å®ä¾‹åŒ–åŠç›´æ¥å†…å­˜"></a>å…«ï¼Œ<strong>å¯¹è±¡å®ä¾‹åŒ–åŠç›´æ¥å†…å­˜</strong></h2><h3 id="1ï¼Œå¯¹è±¡å®ä¾‹åŒ–"><a href="#1ï¼Œå¯¹è±¡å®ä¾‹åŒ–" class="headerlink" title="1ï¼Œå¯¹è±¡å®ä¾‹åŒ–"></a>1ï¼Œå¯¹è±¡å®ä¾‹åŒ–</h3><p><strong>é¢è¯•é¢˜</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç¾å›¢ï¼š</span><br><span class="line">å¯¹è±¡åœ¨JVMä¸­æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ</span><br><span class="line">å¯¹è±¡å¤´ä¿¡æ¯é‡Œé¢æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">èš‚èšé‡‘æœï¼š</span><br><span class="line">Javaå¯¹è±¡å¤´æœ‰ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220226155623663.png" alt="image-20220226155623663" loading="lazy"></p>
<h4 id="1-1ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹å¼"><a href="#1-1ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹å¼" class="headerlink" title="1.1ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹å¼"></a>1.1ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹å¼</h4><ul>
<li><p>newï¼šæœ€å¸¸è§çš„æ–¹å¼ã€Xxxçš„é™æ€æ–¹æ³•ï¼ŒXxxBuilder/XxxFactoryçš„é™æ€æ–¹æ³•</p>
</li>
<li><p>Classçš„newInstanceæ–¹æ³•ï¼šåå°„çš„æ–¹å¼ï¼Œåªèƒ½è°ƒç”¨ç©ºå‚çš„æ„é€ å™¨ï¼Œæƒé™å¿…é¡»æ˜¯public</p>
</li>
<li><p>Constructorçš„newInstance(XXX)ï¼šåå°„çš„æ–¹å¼ï¼Œå¯ä»¥è°ƒç”¨ç©ºå‚ã€å¸¦å‚çš„æ„é€ å™¨ï¼Œæƒé™æ²¡æœ‰è¦æ±‚</p>
</li>
<li><p>ä½¿ç”¨clone()ï¼šä¸è°ƒç”¨ä»»ä½•çš„æ„é€ å™¨ï¼Œè¦æ±‚å½“å‰çš„ç±»éœ€è¦å®ç°Cloneableæ¥å£ï¼Œå®ç°clone()</p>
</li>
<li><p>ä½¿ç”¨ååºåˆ—åŒ–ï¼šä»æ–‡ä»¶ä¸­ã€ä»ç½‘ç»œä¸­è·å–ä¸€ä¸ªå¯¹è±¡çš„äºŒè¿›åˆ¶æµ</p>
</li>
<li><p>ç¬¬ä¸‰æ–¹åº“ Objenesis</p>
</li>
</ul>
<h4 id="1-2ï¼Œåˆ›å»ºå¯¹è±¡çš„æ­¥éª¤"><a href="#1-2ï¼Œåˆ›å»ºå¯¹è±¡çš„æ­¥éª¤" class="headerlink" title="1.2ï¼Œåˆ›å»ºå¯¹è±¡çš„æ­¥éª¤"></a>1.2ï¼Œåˆ›å»ºå¯¹è±¡çš„æ­¥éª¤</h4><p>å‰é¢æ‰€è¿°æ˜¯ä»å­—èŠ‚ç è§’åº¦çœ‹å¾…å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œç°åœ¨ä»æ‰§è¡Œæ­¥éª¤çš„è§’åº¦æ¥åˆ†æï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220226161701981.png" alt="image-20220226161701981" loading="lazy"></p>
<h5 id="1-åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–"><a href="#1-åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–" class="headerlink" title="1. åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–"></a>1. åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–</h5><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤ï¼Œé¦–å…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°èƒ½å¦åœ¨Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æå’Œåˆå§‹åŒ–ï¼ˆå³åˆ¤æ–­ç±»å…ƒä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼‰ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨åŒäº²å§”æ´¾æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨ä»¥ClassLoader + åŒ…å + ç±»åä¸ºkeyè¿›è¡ŒæŸ¥æ‰¾å¯¹åº”çš„ .classæ–‡ä»¶ï¼›</p>
<ul>
<li><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸</p>
</li>
<li><p>å¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡</p>
</li>
</ul>
<h5 id="2-ä¸ºå¯¹è±¡åˆ†é…å†…å­˜"><a href="#2-ä¸ºå¯¹è±¡åˆ†é…å†…å­˜" class="headerlink" title="2. ä¸ºå¯¹è±¡åˆ†é…å†…å­˜"></a>2. ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</h5><p>é¦–å…ˆè®¡ç®—å¯¹è±¡å ç”¨ç©ºé—´çš„å¤§å°ï¼Œæ¥ç€åœ¨å †ä¸­åˆ’åˆ†ä¸€å—å†…å­˜ç»™æ–°å¯¹è±¡ã€‚å¦‚æœå®ä¾‹æˆå‘˜å˜é‡æ˜¯å¼•ç”¨å˜é‡ï¼Œä»…åˆ†é…å¼•ç”¨å˜é‡ç©ºé—´å³å¯ï¼Œå³4ä¸ªå­—èŠ‚å¤§å°</p>
<p><strong>å¦‚æœå†…å­˜è§„æ•´</strong>ï¼šè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯æŒ‡é’ˆç¢°æ’æ³•ï¼ˆBump The Pointï¼‰æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</p>
<ul>
<li>æ„æ€æ˜¯æ‰€æœ‰ç”¨è¿‡çš„å†…å­˜åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾å¦å¤–ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œåˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠæŒ‡é’ˆæŒ‡å‘ç©ºé—²é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ç½¢äº†ã€‚å¦‚æœåƒåœ¾æ”¶é›†å™¨é€‰æ‹©çš„æ˜¯Serial ï¼ŒParNewè¿™ç§åŸºäºå‹ç¼©ç®—æ³•çš„ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§åˆ†é…æ–¹å¼ã€‚ä¸€èˆ¬ä½¿ç”¨å¸¦Compactï¼ˆæ•´ç†ï¼‰è¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œä½¿ç”¨æŒ‡é’ˆç¢°æ’ã€‚</li>
</ul>
<p><strong>å¦‚æœå†…å­˜ä¸è§„æ•´</strong>ï¼šè™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</p>
<ul>
<li>å·²ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯ç©ºé—²åˆ—è¡¨æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚æ„æ€æ˜¯è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šé‚£äº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œå†åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„å†…å®¹ã€‚</li>
</ul>
<p>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±Javaå †æ˜¯å¦è§„æ•´æ‰€å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚</p>
<h5 id="3-å¤„ç†å¹¶å‘é—®é¢˜"><a href="#3-å¤„ç†å¹¶å‘é—®é¢˜" class="headerlink" title="3. å¤„ç†å¹¶å‘é—®é¢˜"></a>3. å¤„ç†å¹¶å‘é—®é¢˜</h5><ul>
<li><p>é‡‡ç”¨CASå¤±è´¥é‡è¯•ã€åŒºåŸŸåŠ é”ä¿è¯æ›´æ–°çš„åŸå­æ€§</p>
</li>
<li><p>æ¯ä¸ªçº¿ç¨‹é¢„å…ˆåˆ†é…ä¸€å—TLABï¼šé€šè¿‡è®¾ç½® <code>-XX:+UseTLAB</code>å‚æ•°æ¥è®¾å®š</p>
</li>
</ul>
<h5 id="4-åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜"><a href="#4-åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜" class="headerlink" title="4. åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜"></a>4. åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜</h5><p>æ‰€æœ‰å±æ€§è®¾ç½®é»˜è®¤å€¼ï¼Œä¿è¯å¯¹è±¡å®ä¾‹å­—æ®µåœ¨ä¸èµ‹å€¼æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨</p>
<h5 id="5-è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´"><a href="#5-è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´" class="headerlink" title="5. è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´"></a>5. è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´</h5><p>å°†å¯¹è±¡çš„æ‰€å±ç±»ï¼ˆå³ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€å¯¹è±¡çš„HashCodeå’Œå¯¹è±¡çš„GCä¿¡æ¯ã€é”ä¿¡æ¯ç­‰æ•°æ®å­˜å‚¨åœ¨å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹çš„å…·ä½“è®¾ç½®æ–¹å¼å–å†³äºJVMå®ç°ã€‚</p>
<h5 id="6-æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–"><a href="#6-æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–" class="headerlink" title="6. æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–"></a>6. æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</h5><p>åœ¨Javaç¨‹åºçš„è§†è§’çœ‹æ¥ï¼Œåˆå§‹åŒ–æ‰æ­£å¼å¼€å§‹ã€‚åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œæ‰§è¡Œå®ä¾‹åŒ–ä»£ç å—ï¼Œè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¹¶æŠŠå †å†…å¯¹è±¡çš„é¦–åœ°å€èµ‹å€¼ç»™å¼•ç”¨å˜é‡ã€‚</p>
<p>å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼ˆç”±å­—èŠ‚ç ä¸­è·ŸéšinvokespecialæŒ‡ä»¤æ‰€å†³å®šï¼‰ï¼ŒnewæŒ‡ä»¤ä¹‹åä¼šæ¥ç€å°±æ˜¯æ‰§è¡Œæ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œæˆåˆ›å»ºå‡ºæ¥ã€‚</p>
<p><strong>ç»™å¯¹è±¡å±æ€§èµ‹å€¼çš„æ“ä½œ</strong></p>
<ul>
<li><p>å±æ€§çš„é»˜è®¤åˆå§‹åŒ–</p>
</li>
<li><p>æ˜¾å¼åˆå§‹åŒ–</p>
</li>
<li><p>ä»£ç å—ä¸­åˆå§‹åŒ–</p>
</li>
<li><p>æ„é€ å™¨ä¸­åˆå§‹åŒ–</p>
</li>
<li><p>åä¸‰ç§åˆå§‹åŒ–æ˜¯åœ¨æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™å®Œæˆçš„</p>
</li>
</ul>
<p><strong>å¯¹è±¡å®ä¾‹åŒ–çš„è¿‡ç¨‹</strong></p>
<ol>
<li>åŠ è½½ç±»å…ƒä¿¡æ¯</li>
<li>ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</li>
<li>å¤„ç†å¹¶å‘é—®é¢˜</li>
<li>å±æ€§çš„é»˜è®¤åˆå§‹åŒ–ï¼ˆé›¶å€¼åˆå§‹åŒ–ï¼‰</li>
<li>è®¾ç½®å¯¹è±¡å¤´ä¿¡æ¯</li>
<li>å±æ€§çš„æ˜¾ç¤ºåˆå§‹åŒ–ã€ä»£ç å—ä¸­åˆå§‹åŒ–ã€æ„é€ å™¨ä¸­åˆå§‹åŒ–</li>
</ol>
<h3 id="2ï¼Œå¯¹è±¡å†…å­˜å¸ƒå±€"><a href="#2ï¼Œå¯¹è±¡å†…å­˜å¸ƒå±€" class="headerlink" title="2ï¼Œå¯¹è±¡å†…å­˜å¸ƒå±€"></a>2ï¼Œå¯¹è±¡å†…å­˜å¸ƒå±€</h3><p><img src="/2022/04/18/JVM/image-20220226164508878.png" alt="image-20220226164508878" loading="lazy"></p>
<h4 id="2-1ï¼Œå¯¹è±¡å¤´ï¼ˆHeaderï¼‰"><a href="#2-1ï¼Œå¯¹è±¡å¤´ï¼ˆHeaderï¼‰" class="headerlink" title="2.1ï¼Œå¯¹è±¡å¤´ï¼ˆHeaderï¼‰"></a>2.1ï¼Œå¯¹è±¡å¤´ï¼ˆHeaderï¼‰</h4><p>å¯¹è±¡å¤´åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯è¿è¡Œæ—¶å…ƒæ•°æ®ï¼ˆMark Wordï¼‰å’Œç±»å‹æŒ‡é’ˆã€‚å¦‚æœæ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦è®°å½•æ•°ç»„çš„é•¿åº¦</p>
<p><strong>è¿è¡Œæ—¶å…ƒæ•°æ®</strong></p>
<ul>
<li><p>å“ˆå¸Œå€¼ï¼ˆHashCodeï¼‰</p>
</li>
<li><p>GCåˆ†ä»£å¹´é¾„</p>
</li>
<li><p>é”çŠ¶æ€æ ‡å¿—</p>
</li>
<li><p>çº¿ç¨‹æŒæœ‰çš„é”</p>
</li>
<li><p>åå‘çº¿ç¨‹ID</p>
</li>
<li><p>ç¿©å‘æ—¶é—´æˆ³</p>
</li>
</ul>
<p><strong>ç±»å‹æŒ‡é’ˆ</strong></p>
<p>æŒ‡å‘ç±»å…ƒæ•°æ®InstanceKlassï¼ˆå®ä¾‹ç±»ï¼‰ï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹ã€‚</p>
<h4 id="2-2ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance-Dataï¼‰"><a href="#2-2ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance-Dataï¼‰" class="headerlink" title="2.2ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰"></a>2.2ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</h4><p>å®ƒæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µï¼ˆåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µï¼‰</p>
<ul>
<li><p>ç›¸åŒå®½åº¦çš„å­—æ®µæ€»æ˜¯è¢«åˆ†é…åœ¨ä¸€èµ·</p>
</li>
<li><p>çˆ¶ç±»ä¸­å®šä¹‰çš„å˜é‡ä¼šå‡ºç°åœ¨å­ç±»ä¹‹å‰</p>
</li>
<li><p>å¦‚æœCompactFieldså‚æ•°ä¸ºtrueï¼ˆé»˜è®¤ä¸ºtrueï¼‰ï¼šå­ç±»çš„çª„å˜é‡å¯èƒ½æ’å…¥åˆ°çˆ¶ç±»å˜é‡çš„ç©ºéš™</p>
</li>
</ul>
<h4 id="2-3ï¼Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰"><a href="#2-3ï¼Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰" class="headerlink" title="2.3ï¼Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰"></a>2.3ï¼Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰</h4><p>ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·åˆ°å ä½ç¬¦çš„ä½œç”¨</p>
<p><strong>ä¸¾ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line">    String name;</span><br><span class="line">    Account acct;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        name = <span class="string">&quot;åŒ¿åå®¢æˆ·&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">()</span> &#123;</span><br><span class="line">        acct = <span class="keyword">new</span> <span class="title class_">Account</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span>&#123;</span><br><span class="line">        Customer cust=<span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å›¾ç¤º</strong></p>
<p><img src="/2022/04/18/JVM/image-20220226164929452.png" alt="image-20220226164929452" loading="lazy"></p>
<h4 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p><img src="/2022/04/18/JVM/image-20220226164959223.png" alt="image-20220226164959223" loading="lazy"></p>
<h3 id="3ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½"><a href="#3ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="3ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½"></a>3ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½</h3><p><img src="/2022/04/18/JVM/image-20220226170028641.png" alt="image-20220226170028641" loading="lazy"></p>
<p>JVMæ˜¯å¦‚ä½•é€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨è®¿é—®åˆ°å…¶å†…éƒ¨çš„å¯¹è±¡å®ä¾‹å‘¢ï¼Ÿ</p>
<p><img src="/2022/04/18/JVM/image-20220226170051298.png" alt="image-20220226170051298" loading="lazy"></p>
<h4 id="3-1ï¼Œå¥æŸ„è®¿é—®"><a href="#3-1ï¼Œå¥æŸ„è®¿é—®" class="headerlink" title="3.1ï¼Œå¥æŸ„è®¿é—®"></a>3.1ï¼Œå¥æŸ„è®¿é—®</h4><p><img src="/2022/04/18/JVM/image-20220226170122435.png" alt="image-20220226170122435" loading="lazy"></p>
<p>referenceä¸­å­˜å‚¨ç¨³å®šå¥æŸ„åœ°å€ï¼Œå¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡å¾ˆæ™®éï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­å®ä¾‹æ•°æ®æŒ‡é’ˆå³å¯ï¼Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹</p>
<h4 id="3-2ï¼Œç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰"><a href="#3-2ï¼Œç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰" class="headerlink" title="3.2ï¼Œç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰"></a>3.2ï¼Œç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰</h4><p><img src="/2022/04/18/JVM/image-20220226170216430.png" alt="image-20220226170216430" loading="lazy"></p>
<p>ç›´æ¥æŒ‡é’ˆæ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¼•ç”¨ï¼Œç›´æ¥æŒ‡å‘å †ä¸­çš„å®ä¾‹ï¼Œåœ¨å¯¹è±¡å®ä¾‹ä¸­æœ‰ç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯æ–¹æ³•åŒºä¸­çš„å¯¹è±¡ç±»å‹æ•°æ®ã€‚</p>
<h3 id="4ï¼Œç›´æ¥å†…å­˜ï¼ˆDirect-Memoryï¼‰"><a href="#4ï¼Œç›´æ¥å†…å­˜ï¼ˆDirect-Memoryï¼‰" class="headerlink" title="4ï¼Œç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰"></a>4ï¼Œç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</h3><h4 id="4-1ï¼Œç›´æ¥å†…å­˜æ¦‚è¿°"><a href="#4-1ï¼Œç›´æ¥å†…å­˜æ¦‚è¿°" class="headerlink" title="4.1ï¼Œç›´æ¥å†…å­˜æ¦‚è¿°"></a>4.1ï¼Œç›´æ¥å†…å­˜æ¦‚è¿°</h4><p>ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚ç›´æ¥å†…å­˜æ˜¯åœ¨Javaå †å¤–çš„ã€ç›´æ¥å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜åŒºé—´ã€‚æ¥æºäºNIOï¼Œé€šè¿‡å­˜åœ¨å †ä¸­çš„DirectByteBufferæ“ä½œNativeå†…å­˜ã€‚é€šå¸¸ï¼Œè®¿é—®ç›´æ¥å†…å­˜çš„é€Ÿåº¦ä¼šä¼˜äºJavaå †ï¼Œå³è¯»å†™æ€§èƒ½é«˜ã€‚</p>
<ul>
<li><p>å› æ­¤å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œè¯»å†™é¢‘ç¹çš„åœºåˆå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">è¿™ä¸ªä¾‹å­æ˜¯é€šè¿‡å¯¹æ¯”IOå’ŒNIOçš„é€Ÿåº¦ï¼Œä»è€ŒçŸ¥é“äº†NIOçš„è®¿é—®æ•°è¯»å—</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferTest1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TO</span> <span class="operator">=</span> <span class="string">&quot;F:\\test\\å¼‚ç•ŒBDä¸­å­—.mp4&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_100Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;F:\\test\\å¼‚ç•ŒBDä¸­å­—.mp4&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="string">&quot;F:\\test\\å¼‚ç•ŒBDä¸­å­—_&quot;</span> + i + <span class="string">&quot;.mp4&quot;</span>;</span><br><span class="line"><span class="comment">//            sum += io(src,dest);//54606</span></span><br><span class="line">            sum += directBuffer(src,dest);<span class="comment">//50244</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ€»èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&quot;</span> + sum );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">directBuffer</span><span class="params">(String src,String dest)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">outChannel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inChannel = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src).getChannel();</span><br><span class="line">            outChannel = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dest).getChannel();</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_100Mb);</span><br><span class="line">            <span class="keyword">while</span> (inChannel.read(byteBuffer) != -<span class="number">1</span>) &#123;</span><br><span class="line">                byteBuffer.flip();<span class="comment">//ä¿®æ”¹ä¸ºè¯»æ•°æ®æ¨¡å¼</span></span><br><span class="line">                outChannel.write(byteBuffer);</span><br><span class="line">                byteBuffer.clear();<span class="comment">//æ¸…ç©º</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (inChannel != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    inChannel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (outChannel != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    outChannel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> end - start;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">io</span><span class="params">(String src,String dest)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src);</span><br><span class="line">            fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dest);</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[_100Mb];</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fis.read(buffer);</span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fos != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> end - start;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>Javaçš„NIOåº“å…è®¸Javaç¨‹åºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº</p>
</li>
</ul>
<h4 id="4-2ï¼Œéç›´æ¥ç¼“å­˜åŒº"><a href="#4-2ï¼Œéç›´æ¥ç¼“å­˜åŒº" class="headerlink" title="4.2ï¼Œéç›´æ¥ç¼“å­˜åŒº"></a>4.2ï¼Œéç›´æ¥ç¼“å­˜åŒº</h4><p>ä½¿ç”¨IOè¯»å†™æ–‡ä»¶ï¼Œéœ€è¦ä¸ç£ç›˜äº¤äº’ï¼Œéœ€è¦ç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚åœ¨å†…æ ¸æ€æ—¶ï¼Œéœ€è¦ä¸¤ä»½å†…å­˜å­˜å‚¨é‡å¤æ•°æ®ï¼Œæ•ˆç‡ä½ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226175754421.png" alt="image-20220226175754421" loading="lazy"></p>
<h4 id="4-3ï¼Œç›´æ¥ç¼“å­˜åŒº"><a href="#4-3ï¼Œç›´æ¥ç¼“å­˜åŒº" class="headerlink" title="4.3ï¼Œç›´æ¥ç¼“å­˜åŒº"></a>4.3ï¼Œç›´æ¥ç¼“å­˜åŒº</h4><p>ä½¿ç”¨NIOæ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆ’å‡ºçš„ç›´æ¥ç¼“å­˜åŒºå¯ä»¥è¢«javaä»£ç ç›´æ¥è®¿é—®ï¼Œåªæœ‰ä¸€ä»½ã€‚NIOé€‚åˆå¯¹å¤§æ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226175831564.png" alt="image-20220226175831564" loading="lazy"></p>
<p>ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ¬åœ°å†…å­˜çš„OOM:  OutOfMemoryError: Direct buffer memory</span></span><br><span class="line"><span class="comment"> * éœ€è¦è®¾ç½®ç›´æ¥å†…å­˜ä¸º10MB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  0:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferTest2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BUFFER</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">20</span>;<span class="comment">//20MB</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;ByteBuffer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(BUFFER);</span><br><span class="line">                list.add(byteBuffer);</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Direct buffer memory </span><br><span class="line">    at java.nio.Bits.reserveMemory(Bits.java:<span class="number">693</span>)</span><br><span class="line">    at java.nio.DirectByteBuffer.&lt;init&gt;(DirectByteBuffer.java:<span class="number">123</span>)</span><br><span class="line">    at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:<span class="number">311</span>)</span><br><span class="line">    at com.atguigu.java.BufferTest2.main(BufferTest2.java:<span class="number">20</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç”±äºç›´æ¥å†…å­˜åœ¨Javaå †å¤–ï¼Œå› æ­¤å®ƒçš„å¤§å°ä¸ä¼šç›´æ¥å—é™äº-XmxæŒ‡å®šçš„æœ€å¤§å †å¤§å°ï¼Œä½†æ˜¯ç³»ç»Ÿå†…å­˜æ˜¯æœ‰é™çš„ï¼ŒJavaå †å’Œç›´æ¥å†…å­˜çš„æ€»å’Œä¾ç„¶å—é™äºæ“ä½œç³»ç»Ÿèƒ½ç»™å‡ºçš„æœ€å¤§å†…å­˜ã€‚</p>
<ul>
<li><p>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜</p>
</li>
<li><p>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</p>
</li>
</ul>
<p>ç›´æ¥å†…å­˜å¤§å°å¯ä»¥é€šè¿‡<code>MaxDirectMemorySize</code>è®¾ç½®ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸å †çš„æœ€å¤§å€¼-Xmxå‚æ•°å€¼ä¸€è‡´</p>
<p><img src="/2022/04/18/JVM/image-20220226180024852.png" alt="image-20220226180024852" loading="lazy"></p>
<h2 id="ä¹ï¼Œæ‰§è¡Œå¼•æ“"><a href="#ä¹ï¼Œæ‰§è¡Œå¼•æ“" class="headerlink" title="ä¹ï¼Œæ‰§è¡Œå¼•æ“"></a>ä¹ï¼Œ<strong>æ‰§è¡Œå¼•æ“</strong></h2><h3 id="1ï¼Œæ‰§è¡Œå¼•æ“æ¦‚è¿°"><a href="#1ï¼Œæ‰§è¡Œå¼•æ“æ¦‚è¿°" class="headerlink" title="1ï¼Œæ‰§è¡Œå¼•æ“æ¦‚è¿°"></a>1ï¼Œæ‰§è¡Œå¼•æ“æ¦‚è¿°</h3><p>æ‰§è¡Œå¼•æ“å±äºJVMçš„ä¸‹å±‚ï¼Œé‡Œé¢åŒ…æ‹¬è§£é‡Šå™¨ã€åŠæ—¶ç¼–è¯‘å™¨ã€åƒåœ¾å›æ”¶å™¨</p>
<p><img src="/2022/04/18/JVM/image-20220226221916202.png" alt="image-20220226221916202" loading="lazy"></p>
<p>æ‰§è¡Œå¼•æ“æ˜¯Javaè™šæ‹Ÿæœºæ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚</p>
<p>â€œè™šæ‹Ÿæœºâ€æ˜¯ä¸€ä¸ªç›¸å¯¹äºâ€œç‰©ç†æœºâ€çš„æ¦‚å¿µï¼Œè¿™ä¸¤ç§æœºå™¨éƒ½æœ‰ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œå…¶åŒºåˆ«æ˜¯ç‰©ç†æœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç›´æ¥å»ºç«‹åœ¨å¤„ç†å™¨ã€ç¼“å­˜ã€æŒ‡ä»¤é›†å’Œæ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“åˆ™æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå› æ­¤å¯ä»¥<strong>ä¸å—ç‰©ç†æ¡ä»¶åˆ¶çº¦åœ°å®šåˆ¶æŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„ä½“ç³»ï¼Œèƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼ã€‚</strong></p>
<p>JVMçš„ä¸»è¦ä»»åŠ¡æ˜¯<strong>è´Ÿè´£è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨</strong>ï¼Œä½†å­—èŠ‚ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œå› ä¸ºå­—èŠ‚ç æŒ‡ä»¤å¹¶éç­‰ä»·äºæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œå®ƒå†…éƒ¨åŒ…å«çš„ä»…ä»…åªæ˜¯ä¸€äº›èƒ½å¤Ÿè¢«JVMæ‰€è¯†åˆ«çš„å­—èŠ‚ç æŒ‡ä»¤ã€ç¬¦å·è¡¨ï¼Œä»¥åŠå…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226222144879.png" alt="image-20220226222144879" loading="lazy"></p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦è®©ä¸€ä¸ªJavaç¨‹åºè¿è¡Œèµ·æ¥ï¼Œæ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰çš„ä»»åŠ¡å°±æ˜¯<strong>å°†å­—èŠ‚ç æŒ‡ä»¤è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰å¯ä»¥ã€‚ï¼ˆåç«¯ç¼–è¯‘ï¼‰</strong>ç®€å•æ¥è¯´ï¼ŒJVMä¸­çš„æ‰§è¡Œå¼•æ“å……å½“äº†å°†é«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€çš„è¯‘è€…ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226222401034.png" alt="image-20220226222401034" loading="lazy"></p>
<h4 id="9-1ï¼Œæ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹"><a href="#9-1ï¼Œæ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹" class="headerlink" title="9.1ï¼Œæ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹"></a>9.1ï¼Œæ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹</h4><ol>
<li>æ‰§è¡Œå¼•æ“åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ç©¶ç«Ÿéœ€è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤å®Œå…¨ä¾èµ–äºPCå¯„å­˜å™¨ã€‚</li>
<li>æ¯å½“æ‰§è¡Œå®Œä¸€é¡¹æŒ‡ä»¤æ“ä½œåï¼ŒPCå¯„å­˜å™¨å°±ä¼šæ›´æ–°ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚</li>
<li>å½“ç„¶æ–¹æ³•åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå¼•æ“æœ‰å¯èƒ½ä¼šé€šè¿‡å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¯¹è±¡å¼•ç”¨å‡†ç¡®å®šä½åˆ°å­˜å‚¨åœ¨Javaå †åŒºä¸­çš„å¯¹è±¡å®ä¾‹ä¿¡æ¯ï¼Œä»¥åŠé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®æŒ‡é’ˆå®šä½åˆ°ç›®æ ‡å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="/2022/04/18/JVM/image-20220226222832734.png" alt="image-20220226222832734" loading="lazy"></p>
<p>ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œæ‰€æœ‰çš„Javaè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“è¾“å…¥ï¼Œè¾“å‡ºéƒ½æ˜¯ä¸€è‡´çš„ï¼šè¾“å…¥çš„æ˜¯å­—èŠ‚ç äºŒè¿›åˆ¶æµï¼Œå¤„ç†è¿‡ç¨‹æ˜¯å­—èŠ‚ç è§£ææ‰§è¡Œçš„ç­‰æ•ˆè¿‡ç¨‹ï¼Œè¾“å‡ºçš„æ˜¯æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<h3 id="2ï¼ŒJavaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹"><a href="#2ï¼ŒJavaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="2ï¼ŒJavaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹"></a>2ï¼ŒJavaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹</h3><p><img src="/2022/04/18/JVM/image-20220226223702803.png" alt="image-20220226223702803" loading="lazy"></p>
<p>å¤§éƒ¨åˆ†çš„ç¨‹åºä»£ç è½¬æ¢æˆç‰©ç†æœºçš„ç›®æ ‡ä»£ç æˆ–è™šæ‹Ÿæœºèƒ½æ‰§è¡Œçš„æŒ‡ä»¤é›†ä¹‹å‰ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸Šå›¾ä¸­çš„å„ä¸ªæ­¥éª¤</p>
<p>Javaä»£ç ç¼–è¯‘æ˜¯ç”±<strong>Javaæºç ç¼–è¯‘å™¨ï¼ˆå‰ç«¯ç¼–è¯‘å™¨ï¼‰æ¥å®Œæˆ</strong>ï¼Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220226223708998.png" alt="image-20220226223708998" loading="lazy"></p>
<p>Javaå­—èŠ‚ç çš„æ‰§è¡Œæ˜¯ç”±JVMæ‰§è¡Œå¼•æ“ï¼ˆåç«¯ç¼–è¯‘å™¨ï¼‰æ¥å®Œæˆï¼Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="/2022/04/18/JVM/image-20220226223751470.png" alt="image-20220226223751470" loading="lazy"></p>
<h4 id="2-1ï¼Œ-ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ"><a href="#2-1ï¼Œ-ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ" class="headerlink" title="2.1ï¼Œ ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ"></a>2.1ï¼Œ ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ</h4><p>è§£é‡Šå™¨ï¼šå½“Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶ä¼šæ ¹æ®é¢„å®šä¹‰çš„è§„èŒƒ<strong>å¯¹å­—èŠ‚ç é‡‡ç”¨é€è¡Œè§£é‡Šçš„æ–¹å¼æ‰§è¡Œ</strong>ï¼Œå°†æ¯æ¡å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹â€œç¿»è¯‘â€ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</p>
<p>JITï¼ˆJust In Time Compilerï¼‰ç¼–è¯‘å™¨ï¼šå°±æ˜¯è™šæ‹Ÿæœºå°†æºä»£ç ç›´æ¥ç¼–è¯‘æˆå’Œæœ¬åœ°æœºå™¨å¹³å°ç›¸å…³çš„æœºå™¨è¯­è¨€ã€‚</p>
<h4 id="2-2ï¼Œä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ"><a href="#2-2ï¼Œä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ" class="headerlink" title="2.2ï¼Œä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ"></a>2.2ï¼Œä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ</h4><p>JDK1.0æ—¶ä»£ï¼Œå°†Javaè¯­è¨€å®šä½ä¸ºâ€œè§£é‡Šæ‰§è¡Œâ€è¿˜æ˜¯æ¯”è¾ƒå‡†ç¡®çš„ã€‚å†åæ¥ï¼ŒJavaä¹Ÿå‘å±•å‡ºå¯ä»¥ç›´æ¥ç”Ÿæˆæœ¬åœ°ä»£ç çš„ç¼–è¯‘å™¨ã€‚ç°åœ¨JVMåœ¨æ‰§è¡ŒJavaä»£ç çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šå°†è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡ŒäºŒè€…ç»“åˆèµ·æ¥è¿›è¡Œã€‚</p>
<p><strong>å›¾ç¤º</strong></p>
<p><img src="/2022/04/18/JVM/image-20220226223929703.png" alt="image-20220226223929703" loading="lazy"></p>
<h3 id="3ï¼Œæœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€"><a href="#3ï¼Œæœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€" class="headerlink" title="3ï¼Œæœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€"></a>3ï¼Œæœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€</h3><h4 id="3-1ï¼Œæœºå™¨ç "><a href="#3-1ï¼Œæœºå™¨ç " class="headerlink" title="3.1ï¼Œæœºå™¨ç "></a>3.1ï¼Œæœºå™¨ç </h4><p>å„ç§ç”¨äºŒè¿›åˆ¶ç¼–ç æ–¹å¼è¡¨ç¤ºçš„æŒ‡ä»¤ï¼Œå«åšæœºå™¨æŒ‡ä»¤ç ã€‚å¼€å§‹ï¼Œäººä»¬å°±ç”¨å®ƒé‡‡ç¼–å†™ç¨‹åºï¼Œè¿™å°±æ˜¯æœºå™¨è¯­è¨€ã€‚</p>
<p>æœºå™¨è¯­è¨€è™½ç„¶èƒ½å¤Ÿè¢«è®¡ç®—æœºç†è§£å’Œæ¥å—ï¼Œä½†å’Œäººä»¬çš„è¯­è¨€å·®åˆ«å¤ªå¤§ï¼Œä¸æ˜“è¢«äººä»¬ç†è§£å’Œè®°å¿†ï¼Œå¹¶ä¸”ç”¨å®ƒç¼–ç¨‹å®¹æ˜“å‡ºå·®é”™ã€‚</p>
<p>ç”¨å®ƒç¼–å†™çš„ç¨‹åºä¸€ç»è¾“å…¥è®¡ç®—æœºï¼ŒCPUç›´æ¥è¯»å–è¿è¡Œï¼Œå› æ­¤å’Œå…¶ä»–è¯­è¨€ç¼–çš„ç¨‹åºç›¸æ¯”ï¼Œæ‰§è¡Œé€Ÿåº¦æœ€å¿«ã€‚</p>
<p>æœºå™¨æŒ‡ä»¤ä¸CPUç´§å¯†ç›¸å…³ï¼Œæ‰€ä»¥ä¸åŒç§ç±»çš„CPUæ‰€å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ä¹Ÿå°±ä¸åŒã€‚</p>
<h4 id="3-2ï¼ŒæŒ‡ä»¤"><a href="#3-2ï¼ŒæŒ‡ä»¤" class="headerlink" title="3.2ï¼ŒæŒ‡ä»¤"></a>3.2ï¼ŒæŒ‡ä»¤</h4><p>ç”±äºæœºå™¨ç æ˜¯æœ‰0å’Œ1ç»„æˆçš„äºŒè¿›åˆ¶åºåˆ—ï¼Œå¯è¯»æ€§å®åœ¨å¤ªå·®ï¼Œäºæ˜¯äººä»¬å‘æ˜äº†æŒ‡ä»¤ã€‚</p>
<p>æŒ‡ä»¤å°±æ˜¯æŠŠæœºå™¨ç ä¸­ç‰¹å®šçš„0å’Œ1åºåˆ—ï¼Œç®€åŒ–æˆå¯¹åº”çš„æŒ‡ä»¤ï¼ˆä¸€èˆ¬ä¸ºè‹±æ–‡ç®€å†™ï¼Œå¦‚movï¼Œincç­‰ï¼‰ï¼Œå¯è¯»æ€§ç¨å¥½</p>
<p>ç”±äºä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œå¯¹åº”çš„æœºå™¨ç å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„ç¡¬ä»¶å¹³å°çš„åŒä¸€ç§æŒ‡ä»¤ï¼ˆæ¯”å¦‚movï¼‰ï¼Œå¯¹åº”çš„æœºå™¨ç ä¹Ÿå¯èƒ½ä¸åŒã€‚</p>
<h4 id="3-3ï¼ŒæŒ‡ä»¤é›†"><a href="#3-3ï¼ŒæŒ‡ä»¤é›†" class="headerlink" title="3.3ï¼ŒæŒ‡ä»¤é›†"></a>3.3ï¼ŒæŒ‡ä»¤é›†</h4><p>ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œå„è‡ªæ”¯æŒçš„æŒ‡ä»¤ï¼Œæ˜¯æœ‰å·®åˆ«çš„ã€‚å› æ­¤æ¯ä¸ªå¹³å°æ‰€æ”¯æŒçš„æŒ‡ä»¤ï¼Œç§°ä¹‹ä¸ºå¯¹åº”å¹³å°çš„æŒ‡ä»¤é›†ã€‚ å¦‚å¸¸è§çš„</p>
<ul>
<li><p>x86æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯x86æ¶æ„çš„å¹³å°</p>
</li>
<li><p>ARMæŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯ARMæ¶æ„çš„å¹³å°</p>
</li>
</ul>
<h4 id="3-4ï¼Œæ±‡ç¼–è¯­è¨€"><a href="#3-4ï¼Œæ±‡ç¼–è¯­è¨€" class="headerlink" title="3.4ï¼Œæ±‡ç¼–è¯­è¨€"></a>3.4ï¼Œæ±‡ç¼–è¯­è¨€</h4><p>ç”±äºæŒ‡ä»¤çš„å¯è¯»æ€§è¿˜æ˜¯å¤ªå·®ï¼Œäºæ˜¯äººä»¬åˆå‘æ˜äº†æ±‡ç¼–è¯­è¨€ã€‚</p>
<p>åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œ<strong>ç”¨åŠ©è®°ç¬¦ï¼ˆMnemonicsï¼‰ä»£æ›¿æœºå™¨æŒ‡ä»¤çš„æ“ä½œç ï¼Œç”¨åœ°å€ç¬¦å·ï¼ˆSymbolï¼‰æˆ–æ ‡å·ï¼ˆLabelï¼‰ä»£æ›¿æŒ‡ä»¤æˆ–æ“ä½œæ•°çš„åœ°å€ã€‚</strong></p>
<p>åœ¨<strong>ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ±‡ç¼–è¯­è¨€å¯¹åº”ç€ä¸åŒçš„æœºå™¨è¯­è¨€æŒ‡ä»¤é›†</strong>ï¼Œé€šè¿‡æ±‡ç¼–è¿‡ç¨‹è½¬æ¢æˆæœºå™¨æŒ‡ä»¤ã€‚</p>
<p>ç”±äºè®¡ç®—æœºåªè®¤è¯†æŒ‡ä»¤ç ï¼Œæ‰€ä»¥ç”¨<strong>æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ç¨‹åºè¿˜å¿…é¡»ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ç ï¼Œè®¡ç®—æœºæ‰èƒ½è¯†åˆ«å’Œæ‰§è¡Œã€‚</strong></p>
<h4 id="3-5ï¼Œé«˜çº§è¯­è¨€"><a href="#3-5ï¼Œé«˜çº§è¯­è¨€" class="headerlink" title="3.5ï¼Œé«˜çº§è¯­è¨€"></a>3.5ï¼Œé«˜çº§è¯­è¨€</h4><p>ä¸ºäº†ä½¿è®¡ç®—æœºç”¨æˆ·ç¼–ç¨‹åºæ›´å®¹æ˜“äº›ï¼Œåæ¥å°±å‡ºç°äº†å„ç§é«˜çº§è®¡ç®—æœºè¯­è¨€ã€‚é«˜çº§è¯­è¨€æ¯”æœºå™¨è¯­è¨€ã€æ±‡ç¼–è¯­è¨€æ›´æ¥è¿‘äººçš„è¯­è¨€</p>
<p>å½“è®¡ç®—æœºæ‰§è¡Œé«˜çº§è¯­è¨€ç¼–å†™çš„ç¨‹åºæ—¶ï¼Œä»ç„¶éœ€è¦æŠŠç¨‹åºè§£é‡Šå’Œç¼–è¯‘æˆæœºå™¨çš„æŒ‡ä»¤ç ã€‚å®Œæˆè¿™ä¸ªè¿‡ç¨‹çš„ç¨‹åºå°±å«åšè§£é‡Šç¨‹åºæˆ–ç¼–è¯‘ç¨‹åºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226224926291.png" alt="image-20220226224926291" loading="lazy"></p>
<p>é«˜çº§è¯­è¨€ä¹Ÿä¸æ˜¯ç›´æ¥ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ï¼Œè€Œæ˜¯ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€ç ï¼Œå¦‚ä¸‹é¢è¯´çš„Cå’ŒC++ã€‚</p>
<h5 id="Cã€C-æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹"><a href="#Cã€C-æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Cã€C++æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹"></a>Cã€C++æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹</h5><p>ç¼–è¯‘è¿‡ç¨‹åˆå¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ±‡ç¼–ã€‚</p>
<p>ç¼–è¯‘è¿‡ç¨‹ï¼šæ˜¯è¯»å–æºç¨‹åºï¼ˆå­—ç¬¦æµï¼‰ï¼Œå¯¹ä¹‹è¿›è¡Œè¯æ³•å’Œè¯­æ³•çš„åˆ†æï¼Œå°†é«˜çº§è¯­è¨€æŒ‡ä»¤è½¬æ¢ä¸ºåŠŸèƒ½ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç </p>
<p>æ±‡ç¼–è¿‡ç¨‹ï¼šå®é™…ä¸ŠæŒ‡æŠŠæ±‡ç¼–è¯­è¨€ä»£ç ç¿»è¯‘æˆç›®æ ‡æœºå™¨æŒ‡ä»¤çš„è¿‡ç¨‹ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226225040562.png" alt="image-20220226225040562" loading="lazy"></p>
<h4 id="3-6ï¼Œå­—èŠ‚ç "><a href="#3-6ï¼Œå­—èŠ‚ç " class="headerlink" title="3.6ï¼Œå­—èŠ‚ç "></a>3.6ï¼Œå­—èŠ‚ç </h4><p>å­—èŠ‚ç æ˜¯ä¸€ç§ä¸­é—´çŠ¶æ€ï¼ˆä¸­é—´ç ï¼‰çš„äºŒè¿›åˆ¶ä»£ç ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå®ƒæ¯”æœºå™¨ç æ›´æŠ½è±¡ï¼Œéœ€è¦ç›´è¯‘å™¨è½¬è¯‘åæ‰èƒ½æˆä¸ºæœºå™¨ç </p>
<p>å­—èŠ‚ç ä¸»è¦ä¸ºäº†å®ç°ç‰¹å®šè½¯ä»¶è¿è¡Œå’Œè½¯ä»¶ç¯å¢ƒã€ä¸ç¡¬ä»¶ç¯å¢ƒæ— å…³ã€‚</p>
<p>å­—èŠ‚ç çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºå™¨ã€‚ç¼–è¯‘å™¨å°†æºç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç‰¹å®šå¹³å°ä¸Šçš„è™šæ‹Ÿæœºå™¨å°†å­—èŠ‚ç è½¬è¯‘ä¸ºå¯ä»¥ç›´æ¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚å­—èŠ‚ç å…¸å‹çš„åº”ç”¨ä¸ºï¼šJava bytecode</p>
<p><img src="/2022/04/18/JVM/image-20220226225256399.png" alt="image-20220226225256399" loading="lazy"></p>
<h3 id="4ï¼Œè§£é‡Šå™¨"><a href="#4ï¼Œè§£é‡Šå™¨" class="headerlink" title="4ï¼Œè§£é‡Šå™¨"></a>4ï¼Œè§£é‡Šå™¨</h3><p>JVMè®¾è®¡è€…ä»¬çš„åˆè¡·ä»…ä»…åªæ˜¯å•çº¯åœ°ä¸ºäº†æ»¡è¶³Javaç¨‹åºå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œå› æ­¤é¿å…é‡‡ç”¨é™æ€ç¼–è¯‘çš„æ–¹å¼ç›´æ¥ç”Ÿæˆæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»è€Œè¯ç”Ÿäº†å®ç°è§£é‡Šå™¨åœ¨è¿è¡Œæ—¶é‡‡ç”¨é€è¡Œè§£é‡Šå­—èŠ‚ç æ‰§è¡Œç¨‹åºçš„æƒ³æ³•ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226230240034.png" alt="image-20220226230240034" loading="lazy"></p>
<p>ä¸ºä»€ä¹ˆJavaæºæ–‡ä»¶ä¸ç›´æ¥ç¿»è¯‘æˆJMVï¼Œè€Œæ˜¯ç¿»è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Ÿå¯èƒ½æ˜¯å› ä¸ºç›´æ¥ç¿»è¯‘çš„ä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„</p>
<h4 id="4-1ï¼Œè§£é‡Šå™¨å·¥ä½œæœºåˆ¶"><a href="#4-1ï¼Œè§£é‡Šå™¨å·¥ä½œæœºåˆ¶" class="headerlink" title="4.1ï¼Œè§£é‡Šå™¨å·¥ä½œæœºåˆ¶"></a>4.1ï¼Œè§£é‡Šå™¨å·¥ä½œæœºåˆ¶</h4><p>è§£é‡Šå™¨çœŸæ­£æ„ä¹‰ä¸Šæ‰€æ‰¿æ‹…çš„è§’è‰²å°±æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶â€œç¿»è¯‘è€…â€ï¼Œå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹â€œç¿»è¯‘â€ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</p>
<p>å½“ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤è¢«è§£é‡Šæ‰§è¡Œå®Œæˆåï¼Œæ¥ç€å†æ ¹æ®PCå¯„å­˜å™¨ä¸­è®°å½•çš„ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œè§£é‡Šæ“ä½œã€‚</p>
<h4 id="4-2ï¼Œè§£é‡Šå™¨åˆ†ç±»"><a href="#4-2ï¼Œè§£é‡Šå™¨åˆ†ç±»" class="headerlink" title="4.2ï¼Œè§£é‡Šå™¨åˆ†ç±»"></a>4.2ï¼Œè§£é‡Šå™¨åˆ†ç±»</h4><p>åœ¨Javaçš„å‘å±•å†å²é‡Œï¼Œä¸€å…±æœ‰ä¸¤å¥—è§£é‡Šæ‰§è¡Œå™¨ï¼Œå³å¤è€çš„å­—èŠ‚ç è§£é‡Šå™¨ã€ç°åœ¨æ™®éä½¿ç”¨çš„æ¨¡æ¿è§£é‡Šå™¨ã€‚</p>
<ul>
<li><p>å­—èŠ‚ç è§£é‡Šå™¨åœ¨æ‰§è¡Œæ—¶é€šè¿‡çº¯è½¯ä»¶ä»£ç æ¨¡æ‹Ÿå­—èŠ‚ç çš„æ‰§è¡Œï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚</p>
</li>
<li><p>è€Œæ¨¡æ¿è§£é‡Šå™¨å°†æ¯ä¸€æ¡å­—èŠ‚ç å’Œä¸€ä¸ªæ¨¡æ¿å‡½æ•°ç›¸å…³è”ï¼Œæ¨¡æ¿å‡½æ•°ä¸­ç›´æ¥äº§ç”Ÿè¿™æ¡å­—èŠ‚ç æ‰§è¡Œæ—¶çš„æœºå™¨ç ï¼Œä»è€Œå¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†è§£é‡Šå™¨çš„æ€§èƒ½ã€‚</p>
</li>
</ul>
<p>åœ¨HotSpot VMä¸­ï¼Œè§£é‡Šå™¨ä¸»è¦ç”±Interpreteræ¨¡å—å’ŒCodeæ¨¡å—æ„æˆã€‚</p>
<ul>
<li><p>Interpreteræ¨¡å—ï¼šå®ç°äº†è§£é‡Šå™¨çš„æ ¸å¿ƒåŠŸèƒ½</p>
</li>
<li><p>Codeæ¨¡å—ï¼šç”¨äºç®¡ç†HotSpot JVMåœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤</p>
</li>
</ul>
<h4 id="4-3ï¼Œç°çŠ¶"><a href="#4-3ï¼Œç°çŠ¶" class="headerlink" title="4.3ï¼Œç°çŠ¶"></a>4.3ï¼Œç°çŠ¶</h4><p>ç”±äºè§£é‡Šå™¨åœ¨è®¾è®¡å’Œå®ç°ä¸Šéå¸¸ç®€å•ï¼Œå› æ­¤é™¤äº†Javaè¯­è¨€ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§è¯­è¨€åŒæ ·ä¹Ÿæ˜¯åŸºäºè§£é‡Šå™¨æ‰§è¡Œçš„ï¼Œæ¯”å¦‚Pythonã€Perlã€Rubyç­‰ã€‚ä½†æ˜¯åœ¨ä»Šå¤©ï¼ŒåŸºäº<strong>è§£é‡Šå™¨æ‰§è¡Œå·²ç»æ²¦è½ä¸ºä½æ•ˆçš„ä»£åè¯</strong>ï¼Œå¹¶ä¸”æ—¶å¸¸è¢«ä¸€äº›C/C++ç¨‹åºå‘˜æ‰€è°ƒä¾ƒã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>JVMå¹³å°æ”¯æŒä¸€ç§å«ä½œå³æ—¶ç¼–è¯‘çš„æŠ€æœ¯</strong>ã€‚<strong>å³æ—¶ç¼–è¯‘çš„ç›®çš„æ˜¯é¿å…å‡½æ•°è¢«è§£é‡Šæ‰§è¡Œï¼Œè€Œæ˜¯å°†æ•´ä¸ªå‡½æ•°ä½“ç¼–è¯‘æˆä¸ºæœºå™¨ç ï¼Œæ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶ï¼Œåªæ‰§è¡Œç¼–è¯‘åçš„æœºå™¨ç å³å¯</strong>ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä½¿æ‰§è¡Œæ•ˆç‡å¤§å¹…åº¦æå‡ã€‚</p>
<p>ä¸è¿‡æ— è®ºå¦‚ä½•ï¼ŒåŸºäºè§£é‡Šå™¨çš„æ‰§è¡Œæ¨¡å¼ä»ç„¶ä¸ºä¸­é—´è¯­è¨€çš„å‘å±•åšå‡ºäº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ã€‚</p>
<h3 id="5ï¼ŒJITç¼–è¯‘å™¨"><a href="#5ï¼ŒJITç¼–è¯‘å™¨" class="headerlink" title="5ï¼ŒJITç¼–è¯‘å™¨"></a>5ï¼ŒJITç¼–è¯‘å™¨</h3><h4 id="5-1ï¼ŒJavaä»£ç çš„æ‰§è¡Œåˆ†ç±»"><a href="#5-1ï¼ŒJavaä»£ç çš„æ‰§è¡Œåˆ†ç±»" class="headerlink" title="5.1ï¼ŒJavaä»£ç çš„æ‰§è¡Œåˆ†ç±»"></a>5.1ï¼ŒJavaä»£ç çš„æ‰§è¡Œåˆ†ç±»</h4><ul>
<li><p> ç¬¬ä¸€ç§æ˜¯å°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶ååœ¨è¿è¡Œæ—¶é€šè¿‡è§£é‡Šå™¨å°†å­—èŠ‚ç æ–‡ä»¶è½¬ä¸ºæœºå™¨ç æ‰§è¡Œ </p>
</li>
<li><p> ç¬¬äºŒç§æ˜¯ç¼–è¯‘æ‰§è¡Œï¼ˆç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼Œä½†æ˜¯è¦çŸ¥é“ä¸åŒæœºå™¨ä¸Šç¼–è¯‘çš„æœºå™¨ç æ˜¯ä¸ä¸€æ ·ï¼Œè€Œå­—èŠ‚ç æ˜¯å¯ä»¥è·¨å¹³å°çš„ï¼‰ã€‚ç°ä»£è™šæ‹Ÿæœºä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä¼šä½¿ç”¨å³æ—¶ç¼–è¯‘æŠ€æœ¯ï¼ˆJITï¼ŒJust In Timeï¼‰å°†æ–¹æ³•ç¼–è¯‘æˆæœºå™¨ç åå†æ‰§è¡Œ</p>
</li>
</ul>
<p>HotSpot VMæ˜¯ç›®å‰å¸‚é¢ä¸Šé«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚å®ƒ<strong>é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„</strong>ã€‚åœ¨Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨å’Œå³æ—¶ç¼–è¯‘å™¨èƒ½å¤Ÿç›¸äº’åä½œï¼Œå„è‡ªå–é•¿è¡¥çŸ­ï¼Œå°½åŠ›å»é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼æ¥æƒè¡¡ç¼–è¯‘æœ¬åœ°ä»£ç çš„æ—¶é—´å’Œç›´æ¥è§£é‡Šæ‰§è¡Œä»£ç çš„æ—¶é—´ã€‚</p>
<p>åœ¨ä»Šå¤©ï¼ŒJavaç¨‹åºçš„è¿è¡Œæ€§èƒ½æ—©å·²è„±èƒæ¢éª¨ï¼Œå·²ç»è¾¾åˆ°äº†å¯ä»¥å’ŒC/C++ ç¨‹åºä¸€è¾ƒé«˜ä¸‹çš„åœ°æ­¥ã€‚</p>
<p><strong>é—®é¢˜æ¥äº†</strong></p>
<p>æœ‰äº›å¼€å‘äººå‘˜ä¼šæ„Ÿè§‰åˆ°è¯§å¼‚ï¼Œæ—¢ç„¶HotSpot VMä¸­å·²ç»å†…ç½®JITç¼–è¯‘å™¨äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦å†ä½¿ç”¨è§£é‡Šå™¨æ¥â€œæ‹–ç´¯â€ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½å‘¢ï¼Ÿæ¯”å¦‚JRockit VMå†…éƒ¨å°±ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå­—èŠ‚ç å…¨éƒ¨éƒ½ä¾é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</p>
<p>é¦–å…ˆæ˜ç¡®ï¼š å½“ç¨‹åºå¯åŠ¨åï¼Œ<strong>è§£é‡Šå™¨å¯ä»¥é©¬ä¸Šå‘æŒ¥ä½œç”¨ï¼Œçœå»ç¼–è¯‘çš„æ—¶é—´ï¼Œç«‹å³æ‰§è¡Œã€‚</strong> <strong>ç¼–è¯‘å™¨è¦æƒ³å‘æŒ¥ä½œç”¨ï¼ŒæŠŠä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œéœ€è¦ä¸€å®šçš„æ‰§è¡Œæ—¶é—´ã€‚ä½†ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç åï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</strong></p>
<p>æ‰€ä»¥ï¼š å°½ç®¡JRockit JVMä¸­ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ä¼šéå¸¸é«˜æ•ˆï¼Œä½†ç¨‹åºåœ¨å¯åŠ¨æ—¶å¿…ç„¶éœ€è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´æ¥è¿›è¡Œç¼–è¯‘ã€‚å¯¹äºæœåŠ¡ç«¯åº”ç”¨æ¥è¯´ï¼Œå¯åŠ¨æ—¶é—´å¹¶éæ˜¯å…³æ³¨é‡ç‚¹ï¼Œä½†å¯¹äºé‚£äº›çœ‹ä¸­å¯åŠ¨æ—¶é—´çš„åº”ç”¨åœºæ™¯è€Œè¨€ï¼Œæˆ–è®¸å°±éœ€è¦é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„æ¥æ¢å–ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œ<strong>å½“Javaè™šæ‹Ÿå™¨å¯åŠ¨æ—¶ï¼Œè§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œè€Œä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨å…¨éƒ¨ç¼–è¯‘å®Œæˆåå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥çœå»è®¸å¤šä¸å¿…è¦çš„ç¼–è¯‘æ—¶é—´</strong>ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç¼–è¯‘å™¨å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œè·å¾—æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p>åŒæ—¶ï¼Œè§£é‡Šæ‰§è¡Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ä¸æˆç«‹çš„æ—¶å€™ï¼Œä½œä¸ºç¼–è¯‘å™¨çš„â€œé€ƒç”Ÿé—¨â€ã€‚</p>
<h4 id="5-2ï¼ŒHotSpot-JVMæ‰§è¡Œæ–¹å¼"><a href="#5-2ï¼ŒHotSpot-JVMæ‰§è¡Œæ–¹å¼" class="headerlink" title="5.2ï¼ŒHotSpot JVMæ‰§è¡Œæ–¹å¼"></a>5.2ï¼ŒHotSpot JVMæ‰§è¡Œæ–¹å¼</h4><p>å½“è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™ï¼Œ<strong>è§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨</strong>ï¼Œè€Œä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨å…¨éƒ¨ç¼–è¯‘å®Œæˆå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥çœå»è®¸å¤šä¸å¿…è¦çš„ç¼–è¯‘æ—¶é—´ã€‚å¹¶ä¸”éšç€ç¨‹åºè¿è¡Œæ—¶é—´çš„æ¨ç§»ï¼Œå³æ—¶ç¼–è¯‘å™¨é€æ¸å‘æŒ¥ä½œç”¨ï¼Œ<strong>æ ¹æ®çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼Œå°†æœ‰ä»·å€¼çš„å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤</strong>ï¼Œä»¥æ¢å–æ›´é«˜çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚</p>
<p><strong>æ¡ˆä¾‹æ¥äº†</strong></p>
<p>æ³¨æ„è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡Œåœ¨çº¿ä¸Šç¯å¢ƒå¾®å¦™çš„è¾©è¯å…³ç³»ã€‚æœºå™¨åœ¨çƒ­æœºçŠ¶æ€å¯ä»¥æ‰¿å—çš„è´Ÿè½½è¦å¤§äºå†·æœºçŠ¶æ€ã€‚å¦‚æœä»¥çƒ­æœºçŠ¶æ€æ—¶çš„æµé‡è¿›è¡Œåˆ‡æµï¼Œå¯èƒ½ä½¿å¤„äºå†·æœºçŠ¶æ€çš„æœåŠ¡å™¨å› æ— æ³•æ‰¿è½½æµé‡è€Œå‡æ­»ã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œä»¥åˆ†æ‰¹çš„æ–¹å¼è¿›è¡Œå‘å¸ƒï¼Œæ ¹æ®æœºå™¨æ•°é‡åˆ’åˆ†æˆå¤šä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡çš„æœºå™¨æ•°è‡³å¤šå åˆ°æ•´ä¸ªé›†ç¾¤çš„1/8ã€‚æ›¾ç»æœ‰è¿™æ ·çš„æ•…éšœæ¡ˆä¾‹ï¼šæŸç¨‹åºå‘˜åœ¨å‘å¸ƒå¹³å°è¿›è¡Œåˆ†æ‰¹å‘å¸ƒï¼Œåœ¨è¾“å…¥å‘å¸ƒæ€»æ‰¹æ•°æ—¶ï¼Œè¯¯å¡«å†™æˆåˆ†ä¸ºä¸¤æ‰¹å‘å¸ƒã€‚å¦‚æœæ˜¯çƒ­æœºçŠ¶æ€ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸€åŠçš„æœºå™¨å¯ä»¥å‹‰å¼ºæ‰¿è½½æµé‡ï¼Œä½†ç”±äºåˆšå¯åŠ¨çš„JVMå‡æ˜¯è§£é‡Šæ‰§è¡Œï¼Œè¿˜æ²¡æœ‰è¿›è¡Œçƒ­ç‚¹ä»£ç ç»Ÿè®¡å’ŒJITåŠ¨æ€ç¼–è¯‘ï¼Œå¯¼è‡´æœºå™¨å¯åŠ¨ä¹‹åï¼Œå½“å‰1/2å‘å¸ƒæˆåŠŸçš„æœåŠ¡å™¨é©¬ä¸Šå…¨éƒ¨å®•æœºï¼Œæ­¤æ•…éšœè¯´æ˜äº†JITçš„å­˜åœ¨ã€‚â€”é˜¿é‡Œå›¢é˜Ÿ</p>
<p><img src="/2022/04/18/JVM/image-20220226231505643.png" alt="image-20220226231505643" loading="lazy"></p>
<h4 id="5-3ï¼Œæ¦‚å¿µè§£é‡Š"><a href="#5-3ï¼Œæ¦‚å¿µè§£é‡Š" class="headerlink" title="5.3ï¼Œæ¦‚å¿µè§£é‡Š"></a>5.3ï¼Œæ¦‚å¿µè§£é‡Š</h4><p>Java è¯­è¨€çš„â€œç¼–è¯‘æœŸâ€å…¶å®æ˜¯ä¸€æ®µâ€œä¸ç¡®å®šâ€çš„æ“ä½œè¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯æŒ‡ä¸€ä¸ªå‰ç«¯ç¼–è¯‘å™¨ï¼ˆå…¶å®å«â€œç¼–è¯‘å™¨çš„å‰ç«¯â€æ›´å‡†ç¡®ä¸€äº›ï¼‰æŠŠ.javaæ–‡ä»¶è½¬å˜æˆ.classæ–‡ä»¶çš„è¿‡ç¨‹ï¼›</p>
<p>ä¹Ÿå¯èƒ½æ˜¯æŒ‡è™šæ‹Ÿæœºçš„åç«¯è¿è¡ŒæœŸç¼–è¯‘å™¨ï¼ˆJITç¼–è¯‘å™¨ï¼ŒJust In Time Compilerï¼‰æŠŠå­—èŠ‚ç è½¬å˜æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚</p>
<p>è¿˜å¯èƒ½æ˜¯æŒ‡ä½¿ç”¨é™æ€æå‰ç¼–è¯‘å™¨ï¼ˆAOTç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰ç›´æ¥æŠŠ.javaæ–‡ä»¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ä»£ç çš„è¿‡ç¨‹ã€‚</p>
<ul>
<li><p> å‰ç«¯ç¼–è¯‘å™¨ï¼šSunçš„Javacã€Eclipse JDTä¸­çš„å¢é‡å¼ç¼–è¯‘å™¨ï¼ˆECJï¼‰ã€‚ </p>
</li>
<li><p> JITç¼–è¯‘å™¨ï¼šHotSpot VMçš„C1ã€C2ç¼–è¯‘å™¨ã€‚ </p>
</li>
<li><p> AOT ç¼–è¯‘å™¨ï¼šGNU Compiler for the Javaï¼ˆGCJï¼‰ã€Excelsior JETã€‚</p>
</li>
</ul>
<h4 id="5-4ï¼Œçƒ­ç‚¹ä»£ç åŠæ¢æµ‹æŠ€æœ¯"><a href="#5-4ï¼Œçƒ­ç‚¹ä»£ç åŠæ¢æµ‹æŠ€æœ¯" class="headerlink" title="5.4ï¼Œçƒ­ç‚¹ä»£ç åŠæ¢æµ‹æŠ€æœ¯"></a>5.4ï¼Œçƒ­ç‚¹ä»£ç åŠæ¢æµ‹æŠ€æœ¯</h4><p>å½“ç„¶æ˜¯å¦éœ€è¦å¯åŠ¨JITç¼–è¯‘å™¨å°†å­—èŠ‚ç ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œåˆ™<strong>éœ€è¦æ ¹æ®ä»£ç è¢«è°ƒç”¨æ‰§è¡Œçš„é¢‘ç‡è€Œå®š</strong>ã€‚å…³äºé‚£äº›éœ€è¦è¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç çš„å­—èŠ‚ç ï¼Œä¹Ÿè¢«<strong>ç§°ä¹‹ä¸ºâ€œçƒ­ç‚¹ä»£ç â€</strong>ï¼ŒJITç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ä¼šé’ˆå¯¹é‚£äº›é¢‘ç¹è¢«è°ƒç”¨çš„â€œçƒ­ç‚¹ä»£ç â€åšå‡ºæ·±åº¦ä¼˜åŒ–ï¼Œå°†å…¶ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»¥æ­¤æå‡Javaç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚</p>
<p><strong>ä¸€ä¸ªè¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ–¹æ³•ä½“å†…éƒ¨å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“éƒ½å¯ä»¥è¢«ç§°ä¹‹ä¸ºâ€œçƒ­ç‚¹ä»£ç â€</strong>ï¼Œå› æ­¤éƒ½å¯ä»¥é€šè¿‡JITç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤ã€‚ç”±äºè¿™ç§ç¼–è¯‘æ–¹å¼å‘ç”Ÿåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› æ­¤è¢«ç§°ä¹‹ä¸º<strong>æ ˆä¸Šæ›¿æ¢ï¼Œæˆ–ç®€ç§°ä¸ºOSR</strong>ï¼ˆOn Stack Replacementï¼‰ç¼–è¯‘ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³•ç©¶ç«Ÿè¦è¢«è°ƒç”¨å¤šå°‘æ¬¡ï¼Œæˆ–è€…ä¸€ä¸ªå¾ªç¯ä½“ç©¶ç«Ÿéœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡å¾ªç¯æ‰å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ ‡å‡†ï¼Ÿå¿…ç„¶éœ€è¦ä¸€ä¸ªæ˜ç¡®çš„é˜ˆå€¼ï¼Œ<strong>JITç¼–è¯‘å™¨æ‰ä¼šå°†è¿™äº›â€œçƒ­ç‚¹ä»£ç â€ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚è¿™é‡Œä¸»è¦ä¾é çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ã€‚</strong></p>
<p><strong>ç›®å‰HotSpot VMæ‰€é‡‡ç”¨çš„çƒ­ç‚¹æ¢æµ‹æ–¹å¼æ˜¯åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹</strong></p>
<p>é‡‡ç”¨åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼ŒHotSpot VMå°†ä¼šä¸ºæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å»ºç«‹2ä¸ªä¸åŒç±»å‹çš„è®¡æ•°å™¨ï¼Œåˆ†åˆ«ä¸º<strong>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼ˆInvocation Counterï¼‰å’Œå›è¾¹è®¡æ•°å™¨ï¼ˆBack Edge Counterï¼‰ã€‚</strong></p>
<ul>
<li><p>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç”¨äºç»Ÿè®¡æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°</p>
</li>
<li><p>å›è¾¹è®¡æ•°å™¨åˆ™ç”¨äºç»Ÿè®¡å¾ªç¯ä½“æ‰§è¡Œçš„å¾ªç¯æ¬¡æ•°</p>
</li>
</ul>
<h5 id="æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨"><a href="#æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨"></a>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨</h5><p>è¿™ä¸ªè®¡æ•°å™¨å°±ç”¨äºç»Ÿè®¡æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œå®ƒçš„é»˜è®¤é˜€å€¼åœ¨Clientæ¨¡å¼ä¸‹æ˜¯1500æ¬¡ï¼Œåœ¨Serveræ¨¡å¼ä¸‹æ˜¯10000æ¬¡ã€‚è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘JITç¼–è¯‘ã€‚</p>
<p>è¿™ä¸ªé˜€å€¼å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•° <code>-XX:CompileThreshold</code>æ¥äººä¸ºè®¾å®šã€‚</p>
<p>å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦å­˜åœ¨è¢«JITç¼–è¯‘è¿‡çš„ç‰ˆæœ¬ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ç¼–è¯‘åçš„æœ¬åœ°ä»£ç æ¥æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨å·²è¢«ç¼–è¯‘è¿‡çš„ç‰ˆæœ¬ï¼Œåˆ™å°†æ­¤æ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å€¼åŠ 1ï¼Œç„¶ååˆ¤æ–­æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ä¸å›è¾¹è®¡æ•°å™¨å€¼ä¹‹å’Œæ˜¯å¦è¶…è¿‡æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çš„é˜€å€¼ã€‚å¦‚æœå·²è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°†ä¼šå‘å³æ—¶ç¼–è¯‘å™¨æäº¤ä¸€ä¸ªè¯¥æ–¹æ³•çš„ä»£ç ç¼–è¯‘è¯·æ±‚ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226232315860.png" alt="image-20220226232315860" loading="lazy"></p>
<h5 id="çƒ­ç‚¹è¡°å‡"><a href="#çƒ­ç‚¹è¡°å‡" class="headerlink" title="çƒ­ç‚¹è¡°å‡"></a>çƒ­ç‚¹è¡°å‡</h5><p>å¦‚æœä¸åšä»»ä½•è®¾ç½®ï¼Œæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç»Ÿè®¡çš„å¹¶ä¸æ˜¯æ–¹æ³•è¢«è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ‰§è¡Œé¢‘ç‡ï¼Œå³<strong>ä¸€æ®µæ—¶é—´ä¹‹å†…æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚å½“è¶…è¿‡ä¸€å®šçš„æ—¶é—´é™åº¦ï¼Œå¦‚æœæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ä»ç„¶ä¸è¶³ä»¥è®©å®ƒæäº¤ç»™å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å°±ä¼šè¢«å‡å°‘ä¸€åŠ</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çƒ­åº¦çš„è¡°å‡ï¼ˆCounter Decayï¼‰ï¼Œè€Œè¿™æ®µæ—¶é—´å°±ç§°ä¸ºæ­¤æ–¹æ³•ç»Ÿè®¡çš„<strong>åŠè¡°å‘¨æœŸ</strong>ï¼ˆCounter Half Life Timeï¼‰</p>
<p>è¿›è¡Œçƒ­åº¦è¡°å‡çš„åŠ¨ä½œæ˜¯åœ¨è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶é¡ºä¾¿è¿›è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•° <code>-XX:-UseCounterDecay</code> æ¥å…³é—­çƒ­åº¦è¡°å‡ï¼Œè®©æ–¹æ³•è®¡æ•°å™¨ç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè¿™æ ·ï¼Œåªè¦ç³»ç»Ÿè¿è¡Œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œç»å¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¼šè¢«ç¼–è¯‘æˆæœ¬åœ°ä»£ç ã€‚</p>
<p>å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨<code>-XX:CounterHalfLifeTime</code>å‚æ•°è®¾ç½®åŠè¡°å‘¨æœŸçš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚</p>
<h5 id="å›è¾¹è®¡æ•°å™¨"><a href="#å›è¾¹è®¡æ•°å™¨" class="headerlink" title="å›è¾¹è®¡æ•°å™¨"></a>å›è¾¹è®¡æ•°å™¨</h5><p>å®ƒçš„ä½œç”¨æ˜¯ç»Ÿè®¡ä¸€ä¸ª<strong>æ–¹æ³•ä¸­å¾ªç¯ä½“ä»£ç æ‰§è¡Œçš„æ¬¡æ•°</strong>ï¼Œåœ¨å­—èŠ‚ç ä¸­é‡åˆ°æ§åˆ¶æµå‘åè·³è½¬çš„æŒ‡ä»¤ç§°ä¸ºâ€œå›è¾¹â€ï¼ˆBack Edgeï¼‰ã€‚æ˜¾ç„¶ï¼Œå»ºç«‹å›è¾¹è®¡æ•°å™¨ç»Ÿè®¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§¦å‘OSRç¼–è¯‘ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220226232538297.png" alt="image-20220226232538297" loading="lazy"></p>
<h4 id="5-5ï¼ŒHotSpotVM-å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•"><a href="#5-5ï¼ŒHotSpotVM-å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•" class="headerlink" title="5.5ï¼ŒHotSpotVM å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•"></a>5.5ï¼ŒHotSpotVM å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•</h4><p>ç¼ºçœæƒ…å†µä¸‹HotSpot VMæ˜¯é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ï¼Œå½“ç„¶å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡å‘½ä»¤æ˜¾å¼åœ°ä¸ºJavaè™šæ‹ŸæœºæŒ‡å®šåœ¨è¿è¡Œæ—¶åˆ°åº•æ˜¯å®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ‰§è¡Œï¼Œè¿˜æ˜¯å®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li><p><code>-Xint</code>ï¼šå®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ¨¡å¼æ‰§è¡Œç¨‹åºï¼›</p>
</li>
<li><p><code>-Xcomp</code>ï¼šå®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ¨¡å¼æ‰§è¡Œç¨‹åºã€‚å¦‚æœå³æ—¶ç¼–è¯‘å‡ºç°é—®é¢˜ï¼Œè§£é‡Šå™¨ä¼šä»‹å…¥æ‰§è¡Œ</p>
</li>
<li><p><code>-Xmixed</code>ï¼šé‡‡ç”¨è§£é‡Šå™¨+å³æ—¶ç¼–è¯‘å™¨çš„æ··åˆæ¨¡å¼å…±åŒæ‰§è¡Œç¨‹åºã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•è§£é‡Šå™¨æ¨¡å¼å’ŒJITç¼–è¯‘æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *  -Xint  : 6520ms</span></span><br><span class="line"><span class="comment"> *  -Xcomp : 950ms</span></span><br><span class="line"><span class="comment"> *  -Xmixed : 936ms</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  12:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntCompTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        testPrimeNumber(<span class="number">1000000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&quot;</span> + (end - start));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPrimeNumber</span><span class="params">(<span class="type">int</span> count)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="comment">//è®¡ç®—100ä»¥å†…çš„è´¨æ•°</span></span><br><span class="line">            label:<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span>;j &lt;= <span class="number">100</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">2</span>;k &lt;= Math.sqrt(j);k++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j % k == <span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">continue</span> label;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//System.out.println(j);</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-6ï¼ŒHotSpotVMä¸­-JIT-åˆ†ç±»"><a href="#5-6ï¼ŒHotSpotVMä¸­-JIT-åˆ†ç±»" class="headerlink" title="5.6ï¼ŒHotSpotVMä¸­ JIT åˆ†ç±»"></a>5.6ï¼ŒHotSpotVMä¸­ JIT åˆ†ç±»</h4><p>JITçš„ç¼–è¯‘å™¨è¿˜åˆ†ä¸ºäº†ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯C1å’ŒC2ï¼Œåœ¨HotSpot VMä¸­å†…åµŒæœ‰ä¸¤ä¸ªJITç¼–è¯‘å™¨ï¼Œåˆ†åˆ«ä¸ºClient Compilerå’ŒServer Compilerï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ç®€ç§°ä¸ºC1ç¼–è¯‘å™¨ å’Œ C2ç¼–è¯‘å™¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ˜¾å¼æŒ‡å®šJavaè™šæ‹Ÿæœºåœ¨è¿è¡Œæ—¶åˆ°åº•ä½¿ç”¨å“ªä¸€ç§å³æ—¶ç¼–è¯‘å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<ul>
<li><p><code>-client</code>ï¼šæŒ‡å®šJavaè™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨C1ç¼–è¯‘å™¨ï¼›<strong>C1ç¼–è¯‘å™¨ä¼šå¯¹å­—èŠ‚ç è¿›è¡Œç®€å•å’Œå¯é çš„ä¼˜åŒ–</strong>ï¼Œè€—æ—¶çŸ­ï¼Œä»¥è¾¾åˆ°æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ã€‚</p>
</li>
<li><p><code>-server</code>ï¼šæŒ‡å®šJavaè™šæ‹Ÿæœºè¿è¡Œåœ¨serveræ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨C2ç¼–è¯‘å™¨ã€‚<strong>C2è¿›è¡Œè€—æ—¶è¾ƒé•¿çš„ä¼˜åŒ–ï¼Œä»¥åŠæ¿€è¿›ä¼˜åŒ–</strong>ï¼Œä½†ä¼˜åŒ–çš„ä»£ç æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚</p>
</li>
</ul>
<p>åˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ç­–ç•¥ï¼šç¨‹åºè§£é‡Šæ‰§è¡Œï¼ˆä¸å¼€å¯æ€§èƒ½ç›‘æ§ï¼‰å¯ä»¥è§¦å‘C1ç¼–è¯‘ï¼Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¯ä»¥è¿›è¡Œç®€å•ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šæ€§èƒ½ç›‘æ§ï¼ŒC2ç¼–è¯‘ä¼šæ ¹æ®æ€§èƒ½ç›‘æ§ä¿¡æ¯è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ã€‚</p>
<p>ä¸è¿‡åœ¨Java7ç‰ˆæœ¬ä¹‹åï¼Œä¸€æ—¦å¼€å‘äººå‘˜åœ¨ç¨‹åºä¸­æ˜¾å¼æŒ‡å®šå‘½ä»¤â€œ-serverâ€æ—¶ï¼Œé»˜è®¤å°†ä¼šå¼€å¯åˆ†å±‚ç¼–è¯‘ç­–ç•¥ï¼Œç”±C1ç¼–è¯‘å™¨å’ŒC2ç¼–è¯‘å™¨ç›¸äº’åä½œå…±åŒæ¥æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ã€‚</p>
<h5 id="C1-å’Œ-C2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥"><a href="#C1-å’Œ-C2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="C1 å’Œ C2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥"></a>C1 å’Œ C2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥</h5><p>åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ä¸Šæœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ï¼ŒC1ç¼–è¯‘å™¨ä¸Šä¸»è¦æœ‰æ–¹æ³•å†…è”ã€å»è™šæ‹ŸåŒ–ã€å†—ä½™æ¶ˆé™¤ã€‚</p>
<ul>
<li><p>æ–¹æ³•å†…è”ï¼šå°†å¼•ç”¨çš„å‡½æ•°ä»£ç ç¼–è¯‘åˆ°å¼•ç”¨ç‚¹å¤„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ ˆå¸§çš„ç”Ÿæˆï¼Œå‡å°‘å‚æ•°ä¼ é€’ä»¥åŠè·³è½¬è¿‡ç¨‹</p>
</li>
<li><p>å»è™šæ‹ŸåŒ–ï¼šå¯¹å”¯ä¸€çš„å®ç°ç±»è¿›è¡Œå†…è”</p>
</li>
<li><p>å†—ä½™æ¶ˆé™¤ï¼šåœ¨è¿è¡ŒæœŸé—´æŠŠä¸€äº›ä¸ä¼šæ‰§è¡Œçš„ä»£ç æŠ˜å æ‰</p>
</li>
</ul>
<p>C2çš„ä¼˜åŒ–ä¸»è¦æ˜¯åœ¨å…¨å±€å±‚é¢ï¼Œé€ƒé€¸åˆ†æï¼ˆå‰é¢è®²è¿‡ï¼Œå¹¶ä¸æˆç†Ÿï¼‰æ˜¯ä¼˜åŒ–çš„åŸºç¡€ã€‚åŸºäºé€ƒé€¸åˆ†æåœ¨C2ä¸Šæœ‰å¦‚ä¸‹å‡ ç§ä¼˜åŒ–</p>
<ul>
<li><p>æ ‡é‡æ›¿æ¢ï¼šç”¨æ ‡é‡å€¼ä»£æ›¿èšåˆå¯¹è±¡çš„å±æ€§å€¼</p>
</li>
<li><p>æ ˆä¸Šåˆ†é…ï¼šå¯¹äºæœªé€ƒé€¸çš„å¯¹è±¡åˆ†é…å¯¹è±¡åœ¨æ ˆè€Œä¸æ˜¯å †</p>
</li>
<li><p>åŒæ­¥æ¶ˆé™¤ï¼šæ¸…é™¤åŒæ­¥æ“ä½œï¼Œé€šå¸¸æŒ‡synchronized</p>
</li>
</ul>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸€èˆ¬æ¥è®²ï¼ŒJITç¼–è¯‘å‡ºæ¥çš„æœºå™¨ç æ€§èƒ½æ¯”è§£é‡Šå™¨é«˜ã€‚C2ç¼–è¯‘å™¨å¯åŠ¨æ—¶é•¿æ¯”C1æ…¢ï¼Œç³»ç»Ÿç¨³å®šæ‰§è¡Œä»¥åï¼ŒC2ç¼–è¯‘å™¨æ‰§è¡Œé€Ÿåº¦è¿œå¿«äºC1ç¼–è¯‘å™¨</p>
<ul>
<li><p>è‡ªJDK10èµ·ï¼ŒHotSpotåˆåŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„åŠæ—¶ç¼–è¯‘å™¨ï¼šGraalç¼–è¯‘å™¨</p>
</li>
<li><p>ç¼–è¯‘æ•ˆæœçŸ­çŸ­å‡ å¹´æ—¶é—´å°±è¿½è¯„äº†C2ç¼–è¯‘å™¨ï¼Œæœªæ¥å¯æœŸ</p>
</li>
<li><p>ç›®å‰ï¼Œå¸¦ç€å®éªŒçŠ¶æ€æ ‡ç­¾ï¼Œéœ€è¦ä½¿ç”¨å¼€å…³å‚æ•°<code>-XX:+UnlockExperimentalvMOptions -XX:+UseJVMCICompiler</code>å»æ¿€æ´»æ‰èƒ½ä½¿ç”¨</p>
</li>
</ul>
<h4 id="AOTç¼–è¯‘å™¨"><a href="#AOTç¼–è¯‘å™¨" class="headerlink" title="AOTç¼–è¯‘å™¨"></a>AOTç¼–è¯‘å™¨</h4><p>jdk9å¼•å…¥äº†AOTç¼–è¯‘å™¨ï¼ˆé™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰</p>
<p>Java 9å¼•å…¥äº†å®éªŒæ€§AOTç¼–è¯‘å·¥å…·jaotcã€‚å®ƒå€ŸåŠ©äº†Graalç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„Javaç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚</p>
<p>æ‰€è°“AOTç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€ŒAOTç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚</p>
<p>æœ€å¤§çš„å¥½å¤„ï¼šJavaè™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…åŠæ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘Javaåº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒ</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>ç ´åäº† java â€œ ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€çš„ç†å¿µï¼Œå¿…é¡»ä¸ºæ¯ä¸ªä¸åŒçš„ç¡¬ä»¶ï¼ŒOSç¼–è¯‘å¯¹åº”çš„å‘è¡ŒåŒ…</p>
</li>
<li><p><strong>é™ä½äº†Javaé“¾æ¥è¿‡ç¨‹çš„åŠ¨æ€æ€§</strong>ï¼ŒåŠ è½½çš„ä»£ç åœ¨ç¼–è¯‘å™¨å°±å¿…é¡»å…¨éƒ¨å·²çŸ¥ã€‚</p>
</li>
<li><p>è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ä¸­ï¼Œæœ€åˆåªæ”¯æŒLinux X64 java base</p>
</li>
</ul>
<h2 id="åï¼ŒStringTable"><a href="#åï¼ŒStringTable" class="headerlink" title="åï¼ŒStringTable"></a>åï¼Œ<strong>StringTable</strong></h2><h3 id="1ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§"><a href="#1ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§" class="headerlink" title="1ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§"></a>1ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§</h3><ul>
<li><p>Stringï¼šå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹â€â€å¼•èµ·æ¥è¡¨ç¤º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;avc&quot;</span>;<span class="comment">//å­—é¢é‡å®šä¹‰</span></span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;avc&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>Stringå£°æ˜ä¸ºfinalçš„ï¼Œä¸å¯è¢«ç»§æ‰¿</p>
</li>
<li><p>Stringå®ç°äº†Serializableæ¥å£ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²æ˜¯æ”¯æŒåºåˆ—åŒ–çš„ã€‚</p>
</li>
<li><p>Stringå®ç°äº†Comparableæ¥å£ï¼šè¡¨ç¤ºstringå¯ä»¥æ¯”è¾ƒå¤§å°</p>
</li>
<li><p>Stringåœ¨jdk8åŠä»¥å‰å†…éƒ¨å®šä¹‰äº†final char[] valueç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚JDK9æ—¶æ”¹ä¸ºbyte[]</p>
</li>
</ul>
<h4 id="1-1ï¼ŒStringåœ¨jdk9ä¸­å­˜å‚¨ç»“æ„å˜æ›´"><a href="#1-1ï¼ŒStringåœ¨jdk9ä¸­å­˜å‚¨ç»“æ„å˜æ›´" class="headerlink" title="1.1ï¼ŒStringåœ¨jdk9ä¸­å­˜å‚¨ç»“æ„å˜æ›´"></a>1.1ï¼ŒStringåœ¨jdk9ä¸­å­˜å‚¨ç»“æ„å˜æ›´</h4><p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/254">JEP 254: Compact Strings (java.net)</a></p>
<blockquote>
<h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>The current implementation of the <code>String</code> class stores characters in a <code>char</code> array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most <code>String</code> objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal <code>char</code> arrays of such <code>String</code> objects is going unused.</p>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>We propose to change the internal representation of the <code>String</code> class from a UTF-16 <code>char</code> array to a <code>byte</code> array plus an encoding-flag field. The new <code>String</code> class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.</p>
<p>String-related classes such as <code>AbstractStringBuilder</code>, <code>StringBuilder</code>, and <code>StringBuffer</code> will be updated to use the same representation, as will the HotSpot VMâ€™s intrinsic string operations.</p>
<p>This is purely an implementation change, with no changes to existing public interfaces. There are no plans to add any new public APIs or other interfaces.</p>
<p>The prototyping work done to date confirms the expected reduction in memory footprint, substantial reductions of GC activity, and minor performance regressions in some corner cases.</p>
</blockquote>
<p><strong>åŠ¨æœº</strong></p>
<p>ç›®å‰Stringç±»çš„å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨ä¸€ä¸ªcharæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰ã€‚ä»è®¸å¤šä¸åŒçš„åº”ç”¨ä¸­æ”¶é›†åˆ°çš„æ•°æ®è¡¨æ˜ï¼Œå­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œæ­¤å¤–ï¼Œå¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å«Latin-1å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨å­—ç¬¦æ•°ç»„ä¸­æœ‰ä¸€åŠçš„ç©ºé—´æ²¡æœ‰è¢«ä½¿ç”¨ã€‚</p>
<p><strong>è¯´æ˜</strong></p>
<p>æˆ‘ä»¬å»ºè®®å°†Stringç±»çš„å†…éƒ¨è¡¨ç¤ºæ–¹æ³•ä»UTF-16å­—ç¬¦æ•°ç»„æ”¹ä¸ºå­—èŠ‚æ•°ç»„åŠ ç¼–ç æ ‡å¿—åŸŸã€‚æ–°çš„Stringç±»å°†æ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä»¥ISO-8859-1/Latin-1ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼‰æˆ–UTF-16ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚ï¼‰çš„æ–¹å¼å­˜å‚¨å­—ç¬¦ç¼–ç ã€‚ç¼–ç æ ‡å¿—å°†è¡¨æ˜ä½¿ç”¨çš„æ˜¯å“ªç§ç¼–ç ã€‚</p>
<p>ä¸å­—ç¬¦ä¸²ç›¸å…³çš„ç±»ï¼Œå¦‚AbstractStringBuilderã€StringBuilderå’ŒStringBufferå°†è¢«æ›´æ–°ä»¥ä½¿ç”¨ç›¸åŒçš„è¡¨ç¤ºæ–¹æ³•ï¼ŒHotSpot VMçš„å†…åœ¨å­—ç¬¦ä¸²æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>è¿™çº¯ç²¹æ˜¯ä¸€ä¸ªå®ç°ä¸Šçš„å˜åŒ–ï¼Œå¯¹ç°æœ‰çš„å…¬å…±æ¥å£æ²¡æœ‰å˜åŒ–ã€‚ç›®å‰æ²¡æœ‰è®¡åˆ’å¢åŠ ä»»ä½•æ–°çš„å…¬å…±APIæˆ–å…¶ä»–æ¥å£ã€‚</p>
<p>è¿„ä»Šä¸ºæ­¢æ‰€åšçš„åŸå‹è®¾è®¡å·¥ä½œè¯å®äº†å†…å­˜å ç”¨çš„é¢„æœŸå‡å°‘ï¼ŒGCæ´»åŠ¨çš„å¤§å¹…å‡å°‘ï¼Œä»¥åŠåœ¨æŸäº›è§’è½æƒ…å†µä¸‹çš„è½»å¾®æ€§èƒ½å€’é€€ã€‚</p>
<p>ç»“è®ºï¼šStringå†ä¹Ÿä¸ç”¨char[] æ¥å­˜å‚¨äº†ï¼Œæ”¹æˆäº†byte [] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    <span class="meta">@Stable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§"><a href="#1-2ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§" class="headerlink" title="1.2ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§"></a>1.2ï¼ŒStringçš„åŸºæœ¬ç‰¹æ€§</h4><p>Stringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ã€‚ç®€ç§°ï¼šä¸å¯å˜æ€§ã€‚</p>
<ul>
<li><p>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</p>
</li>
<li><p>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</p>
</li>
<li><p>å½“è°ƒç”¨stringçš„replace()æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</p>
</li>
</ul>
<p>é€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äºnewï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringExer</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;good&quot;</span>);</span><br><span class="line">    <span class="type">char</span>[] ch = &#123;<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(String str, <span class="type">char</span> ch[])</span> &#123;</span><br><span class="line">        str = <span class="string">&quot;test ok&quot;</span>;</span><br><span class="line">        ch[<span class="number">0</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringExer</span> <span class="variable">ex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringExer</span>();</span><br><span class="line">        ex.change(ex.str, ex.ch);</span><br><span class="line">        System.out.println(ex.str);<span class="comment">//good</span></span><br><span class="line">        System.out.println(ex.ch);<span class="comment">//best</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŸºæœ¬æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²æ˜¯æŒ‰ç…§å€¼ä¼ é€’çš„ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„</strong>ã€‚</p>
<p>Stringçš„String Poolæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯1009ã€‚å¦‚æœæ”¾è¿›String Poolçš„Stringéå¸¸å¤šï¼Œå°±ä¼šé€ æˆHashå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨String.internæ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ã€‚</p>
<p>ä½¿ç”¨<code>-XX:StringTablesize</code>å¯è®¾ç½®StringTableçš„é•¿åº¦ã€‚</p>
<ul>
<li><p> åœ¨jdk6ä¸­StringTableæ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯1009çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ã€‚StringTablesizeè®¾ç½®æ²¡æœ‰è¦æ±‚ </p>
</li>
<li><p> åœ¨jdk7ä¸­ï¼ŒStringTableçš„é•¿åº¦é»˜è®¤å€¼æ˜¯60013ï¼ŒStringTablesizeè®¾ç½®æ²¡æœ‰è¦æ±‚ </p>
</li>
<li><p> åœ¨JDK8ä¸­ï¼Œè®¾ç½®StringTableé•¿åº¦çš„è¯ï¼Œ1009æ˜¯å¯ä»¥è®¾ç½®çš„æœ€å°å€¼ </p>
</li>
</ul>
<h3 id="2ï¼ŒStringçš„å†…å­˜åˆ†é…"><a href="#2ï¼ŒStringçš„å†…å­˜åˆ†é…" class="headerlink" title="2ï¼ŒStringçš„å†…å­˜åˆ†é…"></a>2ï¼ŒStringçš„å†…å­˜åˆ†é…</h3><p>åœ¨Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹Stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚</p>
<p>å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„ï¼ŒStringç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ã€‚</p>
<ul>
<li><p> ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚ </p>
</li>
<li><p> å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Stringæä¾›çš„intern()æ–¹æ³•ã€‚è¿™ä¸ªåé¢é‡ç‚¹è°ˆ </p>
</li>
</ul>
<p>Java 6åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£</p>
<p>Java 7ä¸­ Oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ°Javaå †å†…</p>
<ul>
<li><p> æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚ </p>
</li>
<li><p> å­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨Java 7ä¸­ä½¿ç”¨<code>String.intern()</code>ã€‚ </p>
</li>
</ul>
<p>Java8å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡åœ¨å †</p>
<p><img src="/2022/04/18/JVM/image-20220227110715676.png" alt="image-20220227110715676" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220227110726282.png" alt="image-20220227110726282" loading="lazy"></p>
<p><strong>StringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´ï¼Ÿ</strong></p>
<p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes">Java SE 7 Features and Enhancements (oracle.com)</a></p>
<blockquote>
<p><strong>Synopsis:</strong> In JDK 7, interned strings are no longer allocated in the permanent generation of the Java heap, but are instead allocated in the main part of the Java heap (known as the young and old generations), along with the other objects created by the application. This change will result in more data residing in the main Java heap, and less data in the permanent generation, and thus may require heap sizes to be adjusted. Most applications will see only relatively small differences in heap usage due to this change, but larger applications that load many classes or make heavy use of the <code>String.intern()</code> method will see more significant differences.</p>
</blockquote>
<p>ç®€ä»‹ï¼šåœ¨JDK 7ä¸­ï¼Œå†…éƒ¨å­—ç¬¦ä¸²ä¸å†åˆ†é…åœ¨Javaå †çš„æ°¸ä¹…ä»£ä¸­ï¼Œè€Œæ˜¯åˆ†é…åœ¨Javaå †çš„ä¸»è¦éƒ¨åˆ†ï¼ˆç§°ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼‰ï¼Œä¸åº”ç”¨ç¨‹åºåˆ›å»ºçš„å…¶ä»–å¯¹è±¡ä¸€èµ·ã€‚è¿™ç§å˜åŒ–å°†å¯¼è‡´æ›´å¤šçš„æ•°æ®é©»ç•™åœ¨ä¸»Javaå †ä¸­ï¼Œè€Œæ›´å°‘çš„æ•°æ®åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒæ•´å †çš„å¤§å°ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†çœ‹åˆ°ç”±äºè¿™ä¸€å˜åŒ–è€Œå¯¼è‡´çš„å †ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°çš„å·®å¼‚ï¼Œä½†åŠ è½½è®¸å¤šç±»æˆ–å¤§é‡ä½¿ç”¨String.intern()æ–¹æ³•çš„å¤§å‹åº”ç”¨ç¨‹åºå°†çœ‹åˆ°æ›´æ˜æ˜¾çš„å·®å¼‚ã€‚</p>
<hr>
<h3 id="3ï¼ŒStringçš„åŸºæœ¬æ“ä½œ"><a href="#3ï¼ŒStringçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="3ï¼ŒStringçš„åŸºæœ¬æ“ä½œ"></a>3ï¼ŒStringçš„åŸºæœ¬æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println();<span class="comment">//2293</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1&quot;</span>);<span class="comment">//2294</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;7&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;10&quot;</span>);<span class="comment">//2303</span></span><br><span class="line">        <span class="comment">//å¦‚ä¸‹çš„å­—ç¬¦ä¸²&quot;1&quot; åˆ° &quot;10&quot;ä¸ä¼šå†æ¬¡åŠ è½½</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;7&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;10&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Javaè¯­è¨€è§„èŒƒé‡Œè¦æ±‚å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œåº”è¯¥åŒ…å«åŒæ ·çš„Unicodeå­—ç¬¦åºåˆ—ï¼ˆåŒ…å«åŒä¸€ä»½ç ç‚¹åºåˆ—çš„å¸¸é‡ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æŒ‡å‘åŒä¸€ä¸ªStringç±»å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;<span class="comment">//line 1</span></span><br><span class="line">        <span class="type">int</span> i= <span class="number">1</span>;<span class="comment">//line 2</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();<span class="comment">//line 3</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">mem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Memory</span>();<span class="comment">//Line 4</span></span><br><span class="line">        mem.foo(obj);<span class="comment">//Line 5</span></span><br><span class="line">    &#125;<span class="comment">//Line 9</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Object param)</span> &#123;<span class="comment">//line 6</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> param.toString();<span class="comment">//line 7</span></span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;<span class="comment">//Line 8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220227112610240.png" alt="image-20220227112610240" loading="lazy"></p>
<h3 id="4ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"><a href="#4ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ" class="headerlink" title="4ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"></a>4ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</h3><ul>
<li><p>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</p>
</li>
<li><p>å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡</p>
</li>
<li><p>åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilder</p>
</li>
<li><p>å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨intern()æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€</p>
</li>
</ul>
<p><strong>ä¸¾ä¾‹ä¸€</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// éƒ½æ˜¯å¸¸é‡ï¼Œå‰ç«¯ç¼–è¯‘æœŸä¼šè¿›è¡Œä»£ç ä¼˜åŒ–</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ideaç›´æ¥çœ‹å¯¹åº”çš„åç¼–è¯‘çš„classæ–‡ä»¶ï¼Œä¼šæ˜¾ç¤º String s1 = &quot;abc&quot;; è¯´æ˜åšäº†ä»£ç ä¼˜åŒ–</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span> + <span class="string">&quot;c&quot;</span>;  </span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// trueï¼Œæœ‰ä¸Šè¿°å¯çŸ¥ï¼Œs1å’Œs2å®é™…ä¸ŠæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„åŒä¸€ä¸ªå€¼</span></span><br><span class="line">    System.out.println(s1 == s2); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç»“è®ºå°±æ˜¯ï¼šå¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</p>
<p><strong>ä¸¾ä¾‹äºŒ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + <span class="string">&quot;hadoop&quot;</span>;<span class="comment">//ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœï¼šjavaEEhadoop</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s1 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + s2;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s7</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line"></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">    System.out.println(s3 == s5);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s6 == s7);<span class="comment">//false</span></span><br><span class="line">    <span class="comment">//intern():åˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨javaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­javaEEhadoopçš„åœ°å€ï¼›</span></span><br><span class="line">    <span class="comment">//å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨javaEEhadoopï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åŠ è½½ä¸€ä»½javaEEhadoopï¼Œå¹¶è¿”å›æ¬¡å¯¹è±¡çš„åœ°å€ã€‚</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s8</span> <span class="operator">=</span> s6.intern();</span><br><span class="line">    System.out.println(s3 == s8);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä¸¾ä¾‹ä¸‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¦‚ä¸‹çš„s1 + s2 çš„æ‰§è¡Œç»†èŠ‚ï¼š(å˜é‡sæ˜¯æˆ‘ä¸´æ—¶å®šä¹‰çš„ï¼‰</span></span><br><span class="line"><span class="comment">    â‘  StringBuilder s = new StringBuilder();</span></span><br><span class="line"><span class="comment">    â‘¡ s.append(&quot;a&quot;)</span></span><br><span class="line"><span class="comment">    â‘¢ s.append(&quot;b&quot;)</span></span><br><span class="line"><span class="comment">    â‘£ s.toString()  --&gt; çº¦ç­‰äº new String(&quot;ab&quot;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    è¡¥å……ï¼šåœ¨jdk5.0ä¹‹åä½¿ç”¨çš„æ˜¯StringBuilder,åœ¨jdk5.0ä¹‹å‰ä½¿ç”¨çš„æ˜¯StringBuffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;<span class="comment">//</span></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å­—èŠ‚ç </span><br><span class="line"> <span class="number">0</span> ldc #<span class="number">2</span> &lt;a&gt;</span><br><span class="line"> <span class="number">2</span> astore_1</span><br><span class="line"> <span class="number">3</span> ldc #<span class="number">3</span> &lt;b&gt;</span><br><span class="line"> <span class="number">5</span> astore_2</span><br><span class="line"> <span class="number">6</span> ldc #<span class="number">4</span> &lt;ab&gt;</span><br><span class="line"> <span class="number">8</span> astore_3</span><br><span class="line"> <span class="number">9</span> <span class="keyword">new</span> #<span class="number">5</span> &lt;java/lang/StringBuilder&gt;</span><br><span class="line"><span class="number">12</span> dup</span><br><span class="line"><span class="number">13</span> invokespecial #<span class="number">6</span> &lt;java/lang/StringBuilder.&lt;init&gt;&gt;</span><br><span class="line"><span class="number">16</span> aload_1</span><br><span class="line"><span class="number">17</span> invokevirtual #<span class="number">7</span> &lt;java/lang/StringBuilder.append&gt;</span><br><span class="line"><span class="number">20</span> aload_2</span><br><span class="line"><span class="number">21</span> invokevirtual #<span class="number">7</span> &lt;java/lang/StringBuilder.append&gt;</span><br><span class="line"><span class="number">24</span> invokevirtual #<span class="number">8</span> &lt;java/lang/StringBuilder.toString&gt;</span><br><span class="line"><span class="number">27</span> astore <span class="number">4</span></span><br><span class="line"><span class="number">29</span> getstatic #<span class="number">9</span> &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">32</span> aload_3</span><br><span class="line"><span class="number">33</span> aload <span class="number">4</span></span><br><span class="line"><span class="number">35</span> if_acmpne <span class="number">42</span> (+<span class="number">7</span>)</span><br><span class="line"><span class="number">38</span> iconst_1</span><br><span class="line"><span class="number">39</span> goto <span class="number">43</span> (+<span class="number">4</span>)</span><br><span class="line"><span class="number">42</span> iconst_0</span><br><span class="line"><span class="number">43</span> invokevirtual #<span class="number">10</span> &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">46</span> <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">æˆ‘ä»¬æ‹¿ä¾‹<span class="number">4</span>çš„å­—èŠ‚ç è¿›è¡ŒæŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°s1 + s2å®é™…ä¸Šæ˜¯<span class="keyword">new</span>äº†ä¸€ä¸ªStringBuilderå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨äº†appendæ–¹æ³•å°†s1å’Œs2æ·»åŠ è¿›æ¥ï¼Œæœ€åè°ƒç”¨äº†toStringæ–¹æ³•èµ‹ç»™s4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä¸¾ä¾‹å››</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œä¸ä¸€å®šä½¿ç”¨çš„æ˜¯StringBuilder!</span></span><br><span class="line"><span class="comment">   å¦‚æœæ‹¼æ¥ç¬¦å·å·¦å³ä¸¤è¾¹éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æˆ–å¸¸é‡å¼•ç”¨ï¼Œåˆ™ä»ç„¶ä½¿ç”¨ç¼–è¯‘æœŸä¼˜åŒ–ï¼Œå³éStringBuilderçš„æ–¹å¼ã€‚</span></span><br><span class="line"><span class="comment">2. é’ˆå¯¹äºfinalä¿®é¥°ç±»ã€æ–¹æ³•ã€åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹çš„é‡çš„ç»“æ„æ—¶ï¼Œèƒ½ä½¿ç”¨ä¸Šfinalçš„æ—¶å€™å»ºè®®ä½¿ç”¨ä¸Šã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä¸¾ä¾‹äº”</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä½“ä¼šæ‰§è¡Œæ•ˆç‡ï¼šé€šè¿‡StringBuilderçš„append()çš„æ–¹å¼æ·»åŠ å­—ç¬¦ä¸²çš„æ•ˆç‡è¦è¿œé«˜äºä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼</span></span><br><span class="line"><span class="comment">    è¯¦æƒ…ï¼šâ‘  StringBuilderçš„append()çš„æ–¹å¼ï¼šè‡ªå§‹è‡³ç»ˆä¸­åªåˆ›å»ºè¿‡ä¸€ä¸ªStringBuilderçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">          ä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼šåˆ›å»ºè¿‡å¤šä¸ªStringBuilderå’ŒStringçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">         â‘¡ ä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼šå†…å­˜ä¸­ç”±äºåˆ›å»ºäº†è¾ƒå¤šçš„StringBuilderå’ŒStringçš„å¯¹è±¡ï¼Œå†…å­˜å ç”¨æ›´å¤§ï¼›å¦‚æœè¿›è¡ŒGCï¼Œéœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> æ”¹è¿›çš„ç©ºé—´ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœåŸºæœ¬ç¡®å®šè¦å‰å‰ååæ·»åŠ çš„å­—ç¬¦ä¸²é•¿åº¦ä¸é«˜äºæŸä¸ªé™å®šå€¼highLevelçš„æƒ…å†µä¸‹,å»ºè®®ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–ï¼š</span></span><br><span class="line"><span class="comment">           StringBuilder s = new StringBuilder(highLevel);//new char[highLevel]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">      method1(<span class="number">100000</span>);<span class="comment">//4014</span></span><br><span class="line">    method2(<span class="number">100000</span>);<span class="comment">//7</span></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&quot;</span> + (end - start));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">(<span class="type">int</span> highLevel)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; highLevel;i++)&#123;</span><br><span class="line">        src = src + <span class="string">&quot;a&quot;</span>;<span class="comment">//æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderã€String</span></span><br><span class="line">    &#125;</span><br><span class="line">      System.out.println(src);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(<span class="type">int</span> highLevel)</span>&#123;</span><br><span class="line">    <span class="comment">//åªéœ€è¦åˆ›å»ºä¸€ä¸ªStringBuilder</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">src</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; highLevel; i++) &#123;</span><br><span class="line">        src.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">      System.out.println(src);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5ï¼Œintern-çš„ä½¿ç”¨"><a href="#5ï¼Œintern-çš„ä½¿ç”¨" class="headerlink" title="5ï¼Œintern()çš„ä½¿ç”¨"></a>5ï¼Œintern()çš„ä½¿ç”¨</h3><p>å®˜æ–¹APIæ–‡æ¡£ä¸­çš„è§£é‡Š</p>
<blockquote>
<p>public String intern()</p>
<p>Returns a canonical representation for the string object.</p>
<p>A pool of strings, initially empty, is maintained privately by the class String.</p>
<p>When the intern method is invoked, if the pool already contains a string equal to this String object as determined by the <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#equals-java.lang.Object-">equals(Object)</a> method, then the string from the pool is returned. Otherwise, this String object is added to the pool and a reference to this String object is returned.</p>
<p>It follows that for any two strings s and t, s.intern() == t.intern() is true if and only if s.equals(t) is true.</p>
<p>All literal strings and string-valued constant expressions are interned. String literals are defined in section 3.10.5 of the The Javaâ„¢ Language Specification.</p>
<p>â— Returns: a string that has the same contents as this string, but is guaranteed to be from a pool of unique strings. </p>
</blockquote>
<p>å½“è°ƒç”¨internæ–¹æ³•æ—¶ï¼Œå¦‚æœæ± å­é‡Œå·²ç»åŒ…å«äº†ä¸€ä¸ªä¸è¿™ä¸ªStringå¯¹è±¡ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œæ­£å¦‚equals(Object)æ–¹æ³•æ‰€ç¡®å®šçš„ï¼Œé‚£ä¹ˆæ± å­é‡Œçš„å­—ç¬¦ä¸²ä¼šè¢«è¿”å›ã€‚å¦åˆ™ï¼Œè¿™ä¸ªStringå¯¹è±¡è¢«æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›è¿™ä¸ªStringå¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œå¯¹äºä»»ä½•ä¸¤ä¸ªå­—ç¬¦ä¸²så’Œtï¼Œå½“ä¸”ä»…å½“s.equals(t)ä¸ºçœŸæ—¶ï¼Œs.intern() == t.intern()ä¸ºçœŸã€‚</p>
<p>æ‰€æœ‰å­—é¢å­—ç¬¦ä¸²å’Œä»¥å­—ç¬¦ä¸²ä¸ºå€¼çš„å¸¸é‡è¡¨è¾¾å¼éƒ½æ˜¯internedã€‚</p>
<p>è¿”å›ä¸€ä¸ªä¸æ­¤å­—ç¬¦ä¸²å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½†ä¿è¯æ˜¯æ¥è‡ªä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æ± ã€‚</p>
<hr>
<p>internæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯åº•å±‚Cçš„æ–¹æ³•.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">intern</span><span class="params">()</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Stringæä¾›çš„internæ–¹æ³•ï¼Œå®ƒä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">myInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">string</span>(<span class="string">&quot;I love atguigu&quot;</span>).intern();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä»»æ„å­—ç¬¦ä¸²ä¸Šè°ƒç”¨String.internæ–¹æ³•ï¼Œé‚£ä¹ˆå…¶è¿”å›ç»“æœæ‰€æŒ‡å‘çš„é‚£ä¸ªç±»å®ä¾‹ï¼Œå¿…é¡»å’Œç›´æ¥ä»¥å¸¸é‡å½¢å¼å‡ºç°çš„å­—ç¬¦ä¸²å®ä¾‹å®Œå…¨ç›¸åŒã€‚å› æ­¤ï¼Œä¸‹åˆ—è¡¨è¾¾å¼çš„å€¼å¿…å®šæ˜¯trueã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&quot;a&quot;</span>+<span class="string">&quot;b&quot;</span>+<span class="string">&quot;c&quot;</span>).intern() == <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šä¿—ç‚¹è®²ï¼ŒInterned stringå°±æ˜¯ç¡®ä¿å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä»½æ‹·è´ï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´ï¼ŒåŠ å¿«å­—ç¬¦ä¸²æ“ä½œä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å­˜æ”¾åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ± ï¼ˆString Intern Poolï¼‰</p>
<h4 id="5-1ï¼Œå…³äºintern-çš„é¢è¯•é¢˜"><a href="#5-1ï¼Œå…³äºintern-çš„é¢è¯•é¢˜" class="headerlink" title="5.1ï¼Œå…³äºintern()çš„é¢è¯•é¢˜"></a>5.1ï¼Œå…³äºintern()çš„é¢è¯•é¢˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringIntern</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        s.intern();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        System.out.println(s == s2);<span class="comment">//jdk6ï¼šfalse   jdk7/8ï¼šfalse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        s3.intern();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//jdk6ï¼šfalse  jdk7/8ï¼štrue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨è§£é‡Šä¸Šé¢çš„è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘ä»¬å…ˆå»è§£å†³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¹‹åæ‰èƒ½æ›´å¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢˜ç›®ï¼š</span></span><br><span class="line"><span class="comment"> * new String(&quot;ab&quot;)ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿçœ‹å­—èŠ‚ç ï¼Œå°±çŸ¥é“æ˜¯ä¸¤ä¸ªã€‚</span></span><br><span class="line"><span class="comment"> *     ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šnewå…³é”®å­—åœ¨å †ç©ºé—´åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment"> *     å¦ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡&quot;ab&quot;ã€‚ å­—èŠ‚ç æŒ‡ä»¤ï¼šldc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ€è€ƒï¼š</span></span><br><span class="line"><span class="comment"> * new String(&quot;a&quot;) + new String(&quot;b&quot;)å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡1ï¼šnew StringBuilder()</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡2ï¼š new String(&quot;a&quot;)</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡3ï¼š å¸¸é‡æ± ä¸­çš„&quot;a&quot;</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡4ï¼š new String(&quot;b&quot;)</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡5ï¼š å¸¸é‡æ± ä¸­çš„&quot;b&quot;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  æ·±å…¥å‰–æï¼š StringBuilderçš„toString():</span></span><br><span class="line"><span class="comment"> *      å¯¹è±¡6 ï¼šnew String(&quot;ab&quot;)</span></span><br><span class="line"><span class="comment"> *       å¼ºè°ƒä¸€ä¸‹ï¼ŒtoString()çš„è°ƒç”¨ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ²¡æœ‰ç”Ÿæˆ&quot;ab&quot;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  20:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringNewTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        String str = new String(&quot;ab&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å­—èŠ‚ç </span><br><span class="line"> <span class="number">0</span> <span class="keyword">new</span> #<span class="number">2</span> &lt;java/lang/StringBuilder&gt;</span><br><span class="line"> <span class="number">3</span> dup</span><br><span class="line"> <span class="number">4</span> invokespecial #<span class="number">3</span> &lt;java/lang/StringBuilder.&lt;init&gt;&gt;</span><br><span class="line"> <span class="number">7</span> <span class="keyword">new</span> #<span class="number">4</span> &lt;java/lang/String&gt;</span><br><span class="line"><span class="number">10</span> dup</span><br><span class="line"><span class="number">11</span> ldc #<span class="number">5</span> &lt;a&gt;</span><br><span class="line"><span class="number">13</span> invokespecial #<span class="number">6</span> &lt;java/lang/String.&lt;init&gt;&gt;</span><br><span class="line"><span class="number">16</span> invokevirtual #<span class="number">7</span> &lt;java/lang/StringBuilder.append&gt;</span><br><span class="line"><span class="number">19</span> <span class="keyword">new</span> #<span class="number">4</span> &lt;java/lang/String&gt;</span><br><span class="line"><span class="number">22</span> dup</span><br><span class="line"><span class="number">23</span> ldc #<span class="number">8</span> &lt;b&gt;</span><br><span class="line"><span class="number">25</span> invokespecial #<span class="number">6</span> &lt;java/lang/String.&lt;init&gt;&gt;</span><br><span class="line"><span class="number">28</span> invokevirtual #<span class="number">7</span> &lt;java/lang/StringBuilder.append&gt;</span><br><span class="line"><span class="number">31</span> invokevirtual #<span class="number">9</span> &lt;java/lang/StringBuilder.toString&gt;</span><br><span class="line"><span class="number">34</span> astore_1</span><br><span class="line"><span class="number">35</span> <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„ä»£ç å’Œå­—èŠ‚ç çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p>
<ul>
<li>æ­£å¸¸çš„newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªåœ¨å †é‡Œï¼Œä¸€ä¸ªåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</li>
<li>å¦‚æœæ˜¯æ‹¼æ¥ä¿©newçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»º6ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯StringBuilderä¸­çš„toStringæ–¹æ³•ï¼Œå®ƒè™½ç„¶è°ƒç”¨äº†newæ–¹æ³•ï¼Œä½†æ˜¯ä»–åªåœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚</li>
</ul>
<p>ç°åœ¨å†å»è§£é‡Šä¹‹å‰çš„é¢˜ç›®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        s.intern();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        System.out.println(s == s2);<span class="comment">//jdk6ï¼šfalse   jdk7/8ï¼šfalse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        s3.intern();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//jdk6ï¼šfalse  jdk7/8ï¼štrue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>sæ˜¯é€šè¿‡newçš„æ–¹å¼åˆ›å»ºçš„ï¼Œæ‰€ä»¥åœ¨å †å’Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­éƒ½ä¼šæœ‰è¿™ä¸ªã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227173925125.png" alt="image-20220227173925125" loading="lazy"></p>
</li>
<li><p><code>s.intern();</code>å› ä¸ºæ± å­ä¸­å­˜åœ¨è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><code>String s2 = &quot;1&quot;;</code>ä½¿ç”¨å­—é¢é‡å®šä¹‰ï¼Œç›´æ¥åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¯»æ‰¾ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227174625236.png" alt="image-20220227174625236" loading="lazy"></p>
</li>
<li><p>æ‰€ä»¥ä»–ä»¬ä¸ç›¸ç­‰ã€‚</p>
</li>
<li><p><code>String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;);</code>ç”±ä¹‹å‰çš„çŸ¥è¯†æˆ‘ä»¬çŸ¥é“ï¼Œä»–æœ€ç»ˆçš„è¿”å›ç»“æœåœ¨å †ä¸­ï¼Œå¸¸é‡æ± ä¸­æ²¡æœ‰çš„ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227174829865.png" alt="image-20220227174829865" loading="lazy"></p>
</li>
<li><p><code>s3.intern();</code>å› ä¸ºå¸¸é‡æ± ä¸­æ²¡æœ‰ï¼Œæ‰€ä»¥ä»–è¦åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œç„¶åæŒ‡å‘å †ä¸­çš„11ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227175004981.png" alt="image-20220227175004981" loading="lazy"></p>
</li>
<li><p><code>String s4 = &quot;11&quot;;</code></p>
<p><img src="/2022/04/18/JVM/image-20220227175041494.png" alt="image-20220227175041494" loading="lazy"></p>
</li>
</ol>
<p><strong>æœ€ç»ˆçš„ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * æœ‰ä¸¤ç§æ–¹å¼ï¼š</span></span><br><span class="line"><span class="comment"> * æ–¹å¼ä¸€ï¼š String s = &quot;shkstart&quot;;//å­—é¢é‡å®šä¹‰çš„æ–¹å¼</span></span><br><span class="line"><span class="comment"> * æ–¹å¼äºŒï¼š è°ƒç”¨intern()</span></span><br><span class="line"><span class="comment"> *         String s = new String(&quot;shkstart&quot;).intern();</span></span><br><span class="line"><span class="comment"> *         String s = new StringBuilder(&quot;shkstart&quot;).toString().intern();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  18:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringIntern</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        s.intern();<span class="comment">//è°ƒç”¨æ­¤æ–¹æ³•ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨äº†&quot;1&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        System.out.println(s == s2);<span class="comment">//jdk6ï¼šfalse   jdk7/8ï¼šfalse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);<span class="comment">//s3å˜é‡è®°å½•çš„åœ°å€ä¸ºï¼šnew String(&quot;11&quot;)</span></span><br><span class="line">        <span class="comment">//æ‰§è¡Œå®Œä¸Šä¸€è¡Œä»£ç ä»¥åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ˜¯å¦å­˜åœ¨&quot;11&quot;å‘¢ï¼Ÿç­”æ¡ˆï¼šä¸å­˜åœ¨ï¼ï¼</span></span><br><span class="line">        s3.intern();<span class="comment">//åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆ&quot;11&quot;ã€‚å¦‚ä½•ç†è§£ï¼šjdk6:åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡&quot;11&quot;,ä¹Ÿå°±æœ‰æ–°çš„åœ°å€ã€‚</span></span><br><span class="line">                                            <span class="comment">//         jdk7:æ­¤æ—¶å¸¸é‡ä¸­å¹¶æ²¡æœ‰åˆ›å»º&quot;11&quot;,è€Œæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡å‘å †ç©ºé—´ä¸­new String(&quot;11&quot;)çš„åœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;<span class="comment">//s4å˜é‡è®°å½•çš„åœ°å€ï¼šä½¿ç”¨çš„æ˜¯ä¸Šä¸€è¡Œä»£ç ä»£ç æ‰§è¡Œæ—¶ï¼Œåœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆçš„&quot;11&quot;çš„åœ°å€</span></span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//jdk6ï¼šfalse  jdk7/8ï¼štrue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    	<span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">    	<span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s3.intern();</span><br><span class="line">        s3.intern();</span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line">    	System.out.println(s5 == s4);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒåŸå› ä¹Ÿæ˜¯å¤„åœ¨internä¸Šï¼Œåœ¨s4åˆ›å»ºçš„æ—¶å€™å‘¢ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰11ï¼Œæ‰€ä»¥æ˜¯s4åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºçš„ï¼Œä¹‹åå†è°ƒç”¨s3.intern();çš„æ—¶å€™è¿”å›çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„11ã€‚è¿™ä¹Ÿå°±è¯´æ˜äº†ä¸Šé¢å‡ºç°çš„åŸå› ã€‚</p>
<h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>æ€»ç»“Stringçš„intern()çš„ä½¿ç”¨ï¼š</p>
<p>JDK1.6ä¸­ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚</p>
<ul>
<li><p>å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</p>
</li>
<li><p>å¦‚æœæ²¡æœ‰ï¼Œä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡åœ°å€</p>
</li>
</ul>
<p>JDK1.7èµ·ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚</p>
<ul>
<li><p>å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</p>
</li>
<li><p>å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæŠŠå¯¹è±¡çš„å¼•ç”¨åœ°å€å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¼•ç”¨åœ°å€</p>
</li>
</ul>
<p><strong>ç»ƒä¹ 1</strong></p>
<p><img src="/2022/04/18/JVM/image-20220227180351245.png" alt="image-20220227180351245" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220227180404664.png" alt="image-20220227180404664" loading="lazy"></p>
<p><strong>ç»ƒä¹ 2</strong></p>
<p><img src="/2022/04/18/JVM/image-20220227180430783.png" alt="image-20220227180430783" loading="lazy"></p>
<h4 id="5-2ï¼Œinternçš„æ•ˆç‡æµ‹è¯•ï¼šç©ºé—´è§’åº¦"><a href="#5-2ï¼Œinternçš„æ•ˆç‡æµ‹è¯•ï¼šç©ºé—´è§’åº¦" class="headerlink" title="5.2ï¼Œinternçš„æ•ˆç‡æµ‹è¯•ï¼šç©ºé—´è§’åº¦"></a>5.2ï¼Œinternçš„æ•ˆç‡æµ‹è¯•ï¼šç©ºé—´è§’åº¦</h4><p>æˆ‘ä»¬é€šè¿‡æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨äº†internå’Œä¸ä½¿ç”¨çš„æ—¶å€™ï¼Œå…¶å®ç›¸å·®è¿˜æŒºå¤šçš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringIntern2</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COUNT</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String[] arr = <span class="keyword">new</span> <span class="title class_">String</span>[MAX_COUNT];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Integer [] data = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MAX_COUNT; i++) &#123;</span><br><span class="line">            <span class="comment">// arr[i] = new String(String.valueOf(data[i%data.length]));</span></span><br><span class="line">            arr[i] = <span class="keyword">new</span> <span class="title class_">String</span>(String.valueOf(data[i%data.length])).intern();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&quot;</span> + (end - start));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.getStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åŸå› </span></span><br><span class="line">ä½¿ç”¨internçš„è¯å°‘äº†å †é‡Œé¢çš„å†…å­˜ï¼Œä»è€ŒèŠ‚çœäº†ç©ºé—´å’Œæ—¶é—´ã€‚</span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœ</span></span><br><span class="line">ä¸ä½¿ç”¨internï¼š7256ms</span><br><span class="line">ä½¿ç”¨internï¼š1395ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ç»“è®º</strong>ï¼šå¯¹äºç¨‹åºä¸­å¤§é‡ä½¿ç”¨å­˜åœ¨çš„å­—ç¬¦ä¸²æ—¶ï¼Œå°¤å…¶å­˜åœ¨å¾ˆå¤šå·²ç»é‡å¤çš„å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨intern()æ–¹æ³•èƒ½å¤ŸèŠ‚çœå†…å­˜ç©ºé—´ã€‚</p>
<p>å¤§çš„ç½‘ç«™å¹³å°ï¼Œéœ€è¦å†…å­˜ä¸­å­˜å‚¨å¤§é‡çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ç¤¾äº¤ç½‘ç«™ï¼Œå¾ˆå¤šäººéƒ½å­˜å‚¨ï¼šåŒ—äº¬å¸‚ã€æµ·æ·€åŒºç­‰ä¿¡æ¯ã€‚è¿™æ—¶å€™å¦‚æœå­—ç¬¦ä¸²éƒ½è°ƒç”¨intern()æ–¹æ³•ï¼Œå°±ä¼šå¾ˆæ˜æ˜¾é™ä½å†…å­˜çš„å¤§å°ã€‚</p>
<h3 id="6ï¼ŒStringTableçš„åƒåœ¾å›æ”¶"><a href="#6ï¼ŒStringTableçš„åƒåœ¾å›æ”¶" class="headerlink" title="6ï¼ŒStringTableçš„åƒåœ¾å›æ”¶"></a>6ï¼ŒStringTableçš„åƒåœ¾å›æ”¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Stringçš„åƒåœ¾å›æ”¶:</span></span><br><span class="line"><span class="comment"> * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  21:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringGCTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100000</span>; j++) &#123;</span><br><span class="line">            String.valueOf(j).intern();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 4096K-&gt;504K(4608K)] 4096K-&gt;1689K(15872K), <span class="number">0.0581583</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.06</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4600K-&gt;504K(4608K)] 5785K-&gt;2310K(15872K), <span class="number">0.0015621</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4600K-&gt;504K(4608K)] 6406K-&gt;2350K(15872K), <span class="number">0.0034849</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 4608K, used 1919K [<span class="number">0x00000000ffb00000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 4096K, <span class="number">34</span>% used [<span class="number">0x00000000ffb00000</span>,<span class="number">0x00000000ffc61d30</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space 512K, <span class="number">98</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff7e010</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line">  to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line"> ParOldGen       total 11264K, used 1846K [<span class="number">0x00000000ff000000</span>, <span class="number">0x00000000ffb00000</span>, <span class="number">0x00000000ffb00000</span>)</span><br><span class="line">  object space 11264K, <span class="number">16</span>% used [<span class="number">0x00000000ff000000</span>,<span class="number">0x00000000ff1cd9b0</span>,<span class="number">0x00000000ffb00000</span>)</span><br><span class="line"> Metaspace       used 3378K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 361K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7ï¼ŒG1ä¸­çš„Stringå»é‡æ“ä½œ"><a href="#7ï¼ŒG1ä¸­çš„Stringå»é‡æ“ä½œ" class="headerlink" title="7ï¼ŒG1ä¸­çš„Stringå»é‡æ“ä½œ"></a>7ï¼ŒG1ä¸­çš„Stringå»é‡æ“ä½œ</h3><p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/192">JEP 192: String Deduplication in G1 (java.net)</a><br>Motivation</p>
<p>Many large-scale Java applications are currently bottlenecked on memory. Measurements have shown that roughly 25% of the Java heap live data set in these types of applications is consumed by String objects. Further, roughly half of those String objects are duplicates, where duplicates means string1.equals(string2) is true. Having duplicate String objects on the heap is, essentially, just a waste of memory. This project will implement automatic and continuous String deduplication in the G1 garbage collector to avoid wasting memory and reduce the memory footprint.</p>
<p>ç›®å‰ï¼Œè®¸å¤šå¤§è§„æ¨¡çš„Javaåº”ç”¨ç¨‹åºåœ¨å†…å­˜ä¸Šé‡åˆ°äº†ç“¶é¢ˆã€‚æµ‹é‡è¡¨æ˜ï¼Œåœ¨è¿™äº›ç±»å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤§çº¦25%çš„Javaå †å®æ—¶æ•°æ®é›†è¢«Stringâ€™å¯¹è±¡æ‰€æ¶ˆè€—ã€‚æ­¤å¤–ï¼Œè¿™äº› â€œString â€œå¯¹è±¡ä¸­å¤§çº¦æœ‰ä¸€åŠæ˜¯é‡å¤çš„ï¼Œå…¶ä¸­é‡å¤æ„å‘³ç€ â€œstring1.equals(string2) â€œæ˜¯çœŸçš„ã€‚åœ¨å †ä¸Šæœ‰é‡å¤çš„Stringâ€™å¯¹è±¡ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œåªæ˜¯ä¸€ç§å†…å­˜çš„æµªè´¹ã€‚è¿™ä¸ªé¡¹ç›®å°†åœ¨G1åƒåœ¾æ”¶é›†å™¨ä¸­å®ç°è‡ªåŠ¨å’ŒæŒç»­çš„`Stringâ€™é‡å¤æ•°æ®åˆ é™¤ï¼Œä»¥é¿å…æµªè´¹å†…å­˜ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</p>
<p>æ³¨æ„è¿™é‡Œè¯´çš„é‡å¤ï¼ŒæŒ‡çš„æ˜¯åœ¨å †ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¸¸é‡æ± ä¸­çš„ï¼Œå› ä¸ºå¸¸é‡æ± ä¸­çš„æœ¬èº«å°±ä¸ä¼šé‡å¤</p>
<p>èƒŒæ™¯ï¼šå¯¹è®¸å¤šJavaåº”ç”¨ï¼ˆæœ‰å¤§çš„ä¹Ÿæœ‰å°çš„ï¼‰åšçš„æµ‹è¯•å¾—å‡ºä»¥ä¸‹ç»“æœï¼š</p>
<p>â—å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢stringå¯¹è±¡å äº†25%</p>
<p>â—å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢é‡å¤çš„stringå¯¹è±¡æœ‰13.5%</p>
<p>â—stringå¯¹è±¡çš„å¹³å‡é•¿åº¦æ˜¯45</p>
<p>è®¸å¤šå¤§è§„æ¨¡çš„Javaåº”ç”¨çš„ç“¶é¢ˆåœ¨äºå†…å­˜ï¼Œæµ‹è¯•è¡¨æ˜ï¼Œåœ¨è¿™äº›ç±»å‹çš„åº”ç”¨é‡Œé¢ï¼ŒJavaå †ä¸­å­˜æ´»çš„æ•°æ®é›†åˆå·®ä¸å¤š25%æ˜¯Stringå¯¹è±¡ã€‚æ›´è¿›ä¸€æ­¥ï¼Œè¿™é‡Œé¢å·®ä¸å¤šä¸€åŠstringå¯¹è±¡æ˜¯é‡å¤çš„ï¼Œé‡å¤çš„æ„æ€æ˜¯è¯´ï¼š stringl.equals(string2)= trueã€‚å †ä¸Šå­˜åœ¨é‡å¤çš„Stringå¯¹è±¡å¿…ç„¶æ˜¯ä¸€ç§å†…å­˜çš„æµªè´¹ã€‚è¿™ä¸ªé¡¹ç›®å°†åœ¨G1åƒåœ¾æ”¶é›†å™¨ä¸­å®ç°è‡ªåŠ¨æŒç»­å¯¹é‡å¤çš„stringå¯¹è±¡è¿›è¡Œå»é‡ï¼Œè¿™æ ·å°±èƒ½é¿å…æµªè´¹å†…å­˜ã€‚</p>
<p><strong>å®ç°</strong></p>
<p>1å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„æ—¶å€™ï¼Œä¼šè®¿é—®å †ä¸Šå­˜æ´»çš„å¯¹è±¡ã€‚å¯¹æ¯ä¸€ä¸ªè®¿é—®çš„å¯¹è±¡éƒ½ä¼šæ£€æŸ¥æ˜¯å¦æ˜¯å€™é€‰çš„è¦å»é‡çš„Stringå¯¹è±¡</p>
<p>2å¦‚æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…åç»­çš„å¤„ç†ã€‚ä¸€ä¸ªå»é‡çš„çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œå¤„ç†è¿™ä¸ªé˜Ÿåˆ—ã€‚å¤„ç†é˜Ÿåˆ—çš„ä¸€ä¸ªå…ƒç´ æ„å‘³ç€ä»é˜Ÿåˆ—åˆ é™¤è¿™ä¸ªå…ƒç´ ï¼Œç„¶åå°è¯•å»é‡å®ƒå¼•ç”¨çš„stringå¯¹è±¡ã€‚</p>
<p>3ä½¿ç”¨ä¸€ä¸ªhashtableæ¥è®°å½•æ‰€æœ‰çš„è¢«Stringå¯¹è±¡ä½¿ç”¨çš„ä¸é‡å¤çš„charæ•°ç»„ã€‚å½“å»é‡çš„æ—¶å€™ï¼Œä¼šæŸ¥è¿™ä¸ªhashtableï¼Œæ¥çœ‹å †ä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„charæ•°ç»„ã€‚</p>
<p>4å¦‚æœå­˜åœ¨ï¼ŒStringå¯¹è±¡ä¼šè¢«è°ƒæ•´å¼•ç”¨é‚£ä¸ªæ•°ç»„ï¼Œé‡Šæ”¾å¯¹åŸæ¥çš„æ•°ç»„çš„å¼•ç”¨ï¼Œæœ€ç»ˆä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ‰ã€‚</p>
<p>5å¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œcharæ•°ç»„ä¼šè¢«æ’å…¥åˆ°hashtableï¼Œè¿™æ ·ä»¥åçš„æ—¶å€™å°±å¯ä»¥å…±äº«è¿™ä¸ªæ•°ç»„äº†ã€‚</p>
<p><strong>å‘½ä»¤è¡Œé€‰é¡¹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯Stringå»é‡ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚ </span><br><span class="line">UseStringDeduplication(bool)  </span><br><span class="line"># æ‰“å°è¯¦ç»†çš„å»é‡ç»Ÿè®¡ä¿¡æ¯ </span><br><span class="line">PrintStringDeduplicationStatistics(bool)  </span><br><span class="line"># è¾¾åˆ°è¿™ä¸ªå¹´é¾„çš„Stringå¯¹è±¡è¢«è®¤ä¸ºæ˜¯å»é‡çš„å€™é€‰å¯¹è±¡</span><br><span class="line">StringpeDuplicationAgeThreshold(uintx)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="åä¸€ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°åŠç®—æ³•"><a href="#åä¸€ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°åŠç®—æ³•" class="headerlink" title="åä¸€ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°åŠç®—æ³•"></a>åä¸€ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°åŠç®—æ³•</h2><h3 id="1ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°"><a href="#1ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°" class="headerlink" title="1ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°"></a>1ï¼Œåƒåœ¾å›æ”¶æ¦‚è¿°</h3><h4 id="1-1ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ"><a href="#1-1ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ" class="headerlink" title="1.1ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ"></a>1.1ï¼Œä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ</h4><p><img src="/2022/04/18/JVM/image-20220227220434449.png" alt="image-20220227220434449" loading="lazy"></p>
<p>åƒåœ¾æ”¶é›†ï¼Œä¸æ˜¯Javaè¯­è¨€çš„ä¼´ç”Ÿäº§ç‰©ã€‚æ—©åœ¨1960å¹´ï¼Œç¬¬ä¸€é—¨å¼€å§‹ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„Lispè¯­è¨€è¯ç”Ÿã€‚</p>
<p>å…³äºåƒåœ¾æ”¶é›†æœ‰ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼š</p>
<ul>
<li><p>å“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ</p>
</li>
<li><p>ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ</p>
</li>
<li><p>å¦‚ä½•å›æ”¶ï¼Ÿ</p>
</li>
</ul>
<p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯Javaçš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚å¦‚ä»Šï¼Œåƒåœ¾æ”¶é›†å‡ ä¹æˆä¸ºç°ä»£è¯­è¨€çš„æ ‡é…ï¼Œå³ä½¿ç»è¿‡å¦‚æ­¤é•¿æ—¶é—´çš„å‘å±•ï¼ŒJavaçš„åƒåœ¾æ”¶é›†æœºåˆ¶ä»ç„¶åœ¨ä¸æ–­çš„æ¼”è¿›ä¸­ï¼Œä¸åŒå¤§å°çš„è®¾å¤‡ã€ä¸åŒç‰¹å¾çš„åº”ç”¨åœºæ™¯ï¼Œå¯¹åƒåœ¾æ”¶é›†æå‡ºäº†æ–°çš„æŒ‘æˆ˜ï¼Œè¿™å½“ç„¶ä¹Ÿæ˜¯é¢è¯•çš„çƒ­ç‚¹ã€‚</p>
<p><strong>å¤§å‚é¢è¯•é¢˜</strong></p>
<p>èš‚èšé‡‘æœ</p>
<ul>
<li><p> ä½ çŸ¥é“å“ªå‡ ç§åƒåœ¾å›æ”¶å™¨ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œé‡ç‚¹è®²ä¸€ä¸‹cmså’ŒG1ï¼Ÿ </p>
</li>
<li><p> JVM GCç®—æ³•æœ‰å“ªäº›ï¼Œç›®å‰çš„JDKç‰ˆæœ¬é‡‡ç”¨ä»€ä¹ˆå›æ”¶ç®—æ³•ï¼Ÿ </p>
</li>
<li><p> G1å›æ”¶å™¨è®²ä¸‹å›æ”¶è¿‡ç¨‹GCæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰GCï¼Ÿ </p>
</li>
<li><p>GCçš„ä¸¤ç§åˆ¤å®šæ–¹æ³•ï¼ŸCMSæ”¶é›†å™¨ä¸G1æ”¶é›†å™¨çš„ç‰¹ç‚¹ </p>
</li>
</ul>
<p>ç™¾åº¦</p>
<ul>
<li><p> è¯´ä¸€ä¸‹GCç®—æ³•ï¼Œåˆ†ä»£å›æ”¶è¯´ä¸‹ </p>
</li>
<li><p>åƒåœ¾æ”¶é›†ç­–ç•¥å’Œç®—æ³• </p>
</li>
</ul>
<p>å¤©çŒ«</p>
<ul>
<li><p> JVM GCåŸç†ï¼ŒJVMæ€ä¹ˆå›æ”¶å†…å­˜ </p>
</li>
<li><p>CMSç‰¹ç‚¹ï¼Œåƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œä»–ä»¬å…±åŒçš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ </p>
</li>
</ul>
<p>æ»´æ»´</p>
<ul>
<li>Javaçš„åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Œè¯´ä¸‹g1çš„åº”ç”¨åœºæ™¯ï¼Œå¹³æ—¶ä½ æ˜¯å¦‚ä½•æ­é…ä½¿ç”¨åƒåœ¾å›æ”¶å™¨çš„</li>
</ul>
<p>äº¬ä¸œ</p>
<ul>
<li><p> ä½ çŸ¥é“å“ªå‡ ç§åƒåœ¾æ”¶é›†å™¨ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œé‡ç‚¹è®²ä¸‹cmså’ŒG1ï¼Œ </p>
</li>
<li><p>åŒ…æ‹¬åŸç†ï¼Œæµç¨‹ï¼Œä¼˜ç¼ºç‚¹ã€‚åƒåœ¾å›æ”¶ç®—æ³•çš„å®ç°åŸç† </p>
</li>
</ul>
<p>é˜¿é‡Œ</p>
<ul>
<li><p> è®²ä¸€è®²åƒåœ¾å›æ”¶ç®—æ³•ã€‚ </p>
</li>
<li><p> ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ </p>
</li>
<li><p> å¦‚ä½•é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Ÿ </p>
</li>
<li><p>JVMæœ‰å“ªä¸‰ç§åƒåœ¾å›æ”¶å™¨ï¼Ÿ </p>
</li>
</ul>
<p>å­—èŠ‚è·³åŠ¨</p>
<ul>
<li><p>å¸¸è§çš„åƒåœ¾å›æ”¶å™¨ç®—æ³•æœ‰å“ªäº›ï¼Œå„æœ‰ä»€ä¹ˆä¼˜åŠ£ï¼Ÿ</p>
</li>
<li><p>System.gcï¼ˆï¼‰å’ŒRuntime.gcï¼ˆï¼‰ä¼šåšä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p>
</li>
<li><p>Java GCæœºåˆ¶ï¼ŸGC Rootsæœ‰å“ªäº›ï¼Ÿ</p>
</li>
<li><p>Javaå¯¹è±¡çš„å›æ”¶æ–¹å¼ï¼Œå›æ”¶ç®—æ³•ã€‚</p>
</li>
<li><p>CMSå’ŒG1äº†è§£ä¹ˆï¼ŒCMSè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œè¯´ä¸€ä¸‹å›æ”¶çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>CMSå›æ”¶åœé¡¿äº†å‡ æ¬¡ï¼Œä¸ºä»€ä¹ˆè¦åœé¡¿ä¸¤æ¬¡?</p>
</li>
</ul>
<h5 id="ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ</h5><blockquote>
<p>An object is considered garbage when it can no longer be reached from any pointer in the running progra</p>
</blockquote>
<p>åƒåœ¾æ˜¯æŒ‡åœ¨<u>è¿è¡Œç¨‹åºä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡</u>ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯éœ€è¦è¢«å›æ”¶çš„åƒåœ¾ã€‚</p>
<p>å¦‚æœä¸åŠæ—¶å¯¹å†…å­˜ä¸­çš„åƒåœ¾è¿›è¡Œæ¸…ç†ï¼Œé‚£ä¹ˆï¼Œè¿™äº›åƒåœ¾å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ä¼šä¸€ç›´ä¿ç•™åˆ°åº”ç”¨ç¨‹åºçš„ç»“æŸï¼Œè¢«ä¿ç•™çš„ç©ºé—´æ— æ³•è¢«å…¶å®ƒå¯¹è±¡ä½¿ç”¨ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p>
<p><strong>ç£ç›˜ç¢ç‰‡æ•´ç†çš„æ—¥å­</strong></p>
<p>æœºæ¢°ç¡¬ç›˜éœ€è¦è¿›è¡Œç£ç›˜æ•´ç†ï¼ŒåŒæ—¶è¿˜æœ‰åé“ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227221547755.png" alt="image-20220227221547755" loading="lazy"></p>
<h4 id="1-2ï¼Œä¸ºä»€ä¹ˆéœ€è¦GC"><a href="#1-2ï¼Œä¸ºä»€ä¹ˆéœ€è¦GC" class="headerlink" title="1.2ï¼Œä¸ºä»€ä¹ˆéœ€è¦GC"></a>1.2ï¼Œä¸ºä»€ä¹ˆéœ€è¦GC</h4><blockquote>
<p><strong>æƒ³è¦å­¦ä¹ GCï¼Œé¦–å…ˆéœ€è¦ç†è§£ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ</strong></p>
</blockquote>
<p>å¯¹äºé«˜çº§è¯­è¨€æ¥è¯´ï¼Œä¸€ä¸ªåŸºæœ¬è®¤çŸ¥æ˜¯å¦‚æœä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ<strong>å†…å­˜è¿Ÿæ—©éƒ½ä¼šè¢«æ¶ˆè€—å®Œ</strong>ï¼Œå› ä¸ºä¸æ–­åœ°åˆ†é…å†…å­˜ç©ºé—´è€Œä¸è¿›è¡Œå›æ”¶ï¼Œå°±å¥½åƒä¸åœåœ°ç”Ÿäº§ç”Ÿæ´»åƒåœ¾è€Œä»æ¥ä¸æ‰“æ‰«ä¸€æ ·ã€‚</p>
<p>é™¤äº†é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¹Ÿå¯ä»¥æ¸…é™¤å†…å­˜é‡Œçš„è®°å½•ç¢ç‰‡ã€‚<strong>ç¢ç‰‡æ•´ç†å°†æ‰€å ç”¨çš„å †å†…å­˜ç§»åˆ°å †çš„ä¸€ç«¯ï¼Œä»¥ä¾¿JVMå°†æ•´ç†å‡ºçš„å†…å­˜åˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚</strong></p>
<p>éšç€åº”ç”¨ç¨‹åºæ‰€åº”ä»˜çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œ<strong>æ²¡æœ‰GCå°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚</strong>è€Œç»å¸¸é€ æˆSTWçš„GCåˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹GCè¿›è¡Œä¼˜åŒ–ã€‚</p>
<h4 id="1-3ï¼Œæ—©æœŸåƒåœ¾å›æ”¶"><a href="#1-3ï¼Œæ—©æœŸåƒåœ¾å›æ”¶" class="headerlink" title="1.3ï¼Œæ—©æœŸåƒåœ¾å›æ”¶"></a>1.3ï¼Œæ—©æœŸåƒåœ¾å›æ”¶</h4><p>åœ¨æ—©æœŸçš„C/C++æ—¶ä»£ï¼Œåƒåœ¾å›æ”¶åŸºæœ¬ä¸Šæ˜¯æ‰‹å·¥è¿›è¡Œçš„ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨newå…³é”®å­—è¿›è¡Œå†…å­˜ç”³è¯·ï¼Œå¹¶ä½¿ç”¨deleteå…³é”®å­—è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MibBridge *pBridge= <span class="keyword">new</span> <span class="title class_">cmBaseGroupBridge</span>();</span><br><span class="line"><span class="comment">//å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œä½¿ç”¨Deleteé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å å†…å­˜åŒºåŸŸ</span></span><br><span class="line"><span class="keyword">if</span> (pBridge-&gt;Register(kDestroy) != NO ERRORï¼‰</span><br><span class="line">	delete pBridge;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼å¯ä»¥çµæ´»æ§åˆ¶å†…å­˜é‡Šæ”¾çš„æ—¶é—´ï¼Œä½†æ˜¯ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥é¢‘ç¹<strong>ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„ç®¡ç†è´Ÿæ‹…</strong>ã€‚å€˜è‹¥æœ‰ä¸€å¤„å†…å­˜åŒºé—´ç”±äºç¨‹åºå‘˜<strong>ç¼–ç çš„é—®é¢˜å¿˜è®°è¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ï¼Œåƒåœ¾å¯¹è±¡æ°¸è¿œæ— æ³•è¢«æ¸…é™¤</strong>ï¼Œéšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„ä¸æ–­å¢é•¿ï¼Œåƒåœ¾å¯¹è±¡æ‰€è€—å†…å­˜å¯èƒ½æŒç»­ä¸Šå‡ï¼Œç›´åˆ°å‡ºç°å†…å­˜æº¢å‡ºå¹¶é€ æˆåº”ç”¨ç¨‹åºå´©æºƒã€‚</p>
<p>åœ¨æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œä¸Šè¿°ä»£ç ææœ‰å¯èƒ½å˜æˆè¿™æ ·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MibBridge *pBridge = <span class="keyword">new</span> <span class="title class_">cmBaseGroupBridge</span>(); </span><br><span class="line">pBridge-&gt;Register(kDestroy);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œé™¤äº†Javaä»¥å¤–ï¼ŒC#ã€Pythonã€Rubyç­‰è¯­è¨€éƒ½ä½¿ç”¨äº†è‡ªåŠ¨åƒåœ¾å›æ”¶çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯æœªæ¥å‘å±•è¶‹åŠ¿ï¼Œå¯ä»¥è¯´è¿™ç§è‡ªåŠ¨åŒ–çš„å†…å­˜åˆ†é…å’Œæ¥åŠå›æ”¶æ–¹å¼å·²ç»æˆä¸ºäº†çº¿ä»£å¼€å‘è¯­è¨€å¿…å¤‡çš„æ ‡å‡†ã€‚</p>
<h4 id="1-4ï¼ŒJavaåƒåœ¾å›æ”¶æœºåˆ¶"><a href="#1-4ï¼ŒJavaåƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="1.4ï¼ŒJavaåƒåœ¾å›æ”¶æœºåˆ¶"></a>1.4ï¼ŒJavaåƒåœ¾å›æ”¶æœºåˆ¶</h4><p>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæ— éœ€å¼€å‘äººå‘˜æ‰‹åŠ¨å‚ä¸å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼Œè¿™æ ·é™ä½å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„é£é™©</p>
<ul>
<li>æ²¡æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œjavaä¹Ÿä¼šå’Œcppä¸€æ ·ï¼Œå„ç§æ‚¬å‚æŒ‡é’ˆï¼Œé‡æŒ‡é’ˆï¼Œæ³„éœ²é—®é¢˜è®©ä½ å¤´ç–¼ä¸å·²ã€‚</li>
</ul>
<p>è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå°†ç¨‹åºå‘˜ä»ç¹é‡çš„å†…å­˜ç®¡ç†ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œå¯ä»¥æ›´ä¸“å¿ƒåœ°ä¸“æ³¨äºä¸šåŠ¡å¼€å‘</p>
<p>oracleå®˜ç½‘å…³äºåƒåœ¾å›æ”¶çš„ä»‹ç» <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html</a></p>
<h5 id="æ‹…å¿§"><a href="#æ‹…å¿§" class="headerlink" title="æ‹…å¿§"></a>æ‹…å¿§</h5><p>å¯¹äºJavaå¼€å‘äººå‘˜è€Œè¨€ï¼Œè‡ªåŠ¨å†…å­˜ç®¡ç†å°±åƒæ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼Œå¦‚æœè¿‡åº¦ä¾èµ–äºâ€œè‡ªåŠ¨â€ï¼Œé‚£ä¹ˆè¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ï¼Œæœ€ä¸¥é‡çš„å°±ä¼šå¼±åŒ–Javaå¼€å‘äººå‘˜åœ¨ç¨‹åºå‡ºç°å†…å­˜æº¢å‡ºæ—¶å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚</p>
<p>æ­¤æ—¶ï¼Œäº†è§£JVMçš„è‡ªåŠ¨å†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶åŸç†å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œåªæœ‰åœ¨çœŸæ­£äº†è§£JVMæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜åï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨é‡è§outofMemoryErroræ—¶ï¼Œå¿«é€Ÿåœ°æ ¹æ®é”™è¯¯å¼‚å¸¸æ—¥å¿—å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</p>
<p>å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼é—®é¢˜æ—¶ï¼Œå½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘é‡çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚</p>
<h5 id="GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ"><a href="#GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ" class="headerlink" title="GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ"></a>GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ</h5><p>GCä¸»è¦å…³æ³¨äº æ–¹æ³•åŒº å’Œå †ä¸­çš„åƒåœ¾æ”¶é›†</p>
<p><img src="/2022/04/18/JVM/image-20220227222506390.png" alt="image-20220227222506390" loading="lazy"></p>
<p>åƒåœ¾æ”¶é›†å™¨å¯ä»¥å¯¹å¹´è½»ä»£å›æ”¶ï¼Œä¹Ÿå¯ä»¥å¯¹è€å¹´ä»£å›æ”¶ï¼Œç”šè‡³æ˜¯å…¨æ ˆå’Œæ–¹æ³•åŒºçš„å›æ”¶ã€‚å…¶ä¸­ï¼ŒJavaå †æ˜¯åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œé‡ç‚¹</p>
<p>ä»æ¬¡æ•°ä¸Šè®²ï¼š</p>
<ul>
<li><p>é¢‘ç¹æ”¶é›†YoungåŒº</p>
</li>
<li><p>è¾ƒå°‘æ”¶é›†OldåŒº</p>
</li>
<li><p>åŸºæœ¬ä¸æ”¶é›†PermåŒºï¼ˆå…ƒç©ºé—´ï¼‰</p>
</li>
</ul>
<h3 id="2ï¼Œåƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"><a href="#2ï¼Œåƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•" class="headerlink" title="2ï¼Œåƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"></a>2ï¼Œåƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•</h3><p><strong>å¯¹è±¡å­˜æ´»åˆ¤æ–­</strong></p>
<p>åœ¨å †é‡Œå­˜æ”¾ç€å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡å®ä¾‹ï¼Œåœ¨GCæ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚åªæœ‰è¢«æ ‡è®°ä¸ºå·±ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGCæ‰ä¼šåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œé‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¸ºåƒåœ¾æ ‡è®°é˜¶æ®µã€‚</p>
<p>é‚£ä¹ˆåœ¨JVMä¸­ç©¶ç«Ÿæ˜¯å¦‚ä½•æ ‡è®°ä¸€ä¸ªæ­»äº¡å¯¹è±¡å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å·²ç»ä¸å†è¢«ä»»ä½•çš„å­˜æ´»å¯¹è±¡ç»§ç»­å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥å®£åˆ¤ä¸ºå·²ç»æ­»äº¡ã€‚</p>
<p>åˆ¤æ–­å¯¹è±¡å­˜æ´»ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•å’Œå¯è¾¾æ€§åˆ†æç®—æ³•ã€‚</p>
<h4 id="2-1ï¼Œæ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#2-1ï¼Œæ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="2.1ï¼Œæ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"></a>2.1ï¼Œæ ‡è®°é˜¶æ®µï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</h4><h5 id="æ–¹å¼ä¸€ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#æ–¹å¼ä¸€ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="æ–¹å¼ä¸€ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•"></a>æ–¹å¼ä¸€ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</h5><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰æ¯”è¾ƒç®€å•ï¼Œ<strong>å¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„å¼•ç”¨è®¡æ•°å™¨å±æ€§ã€‚ç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µ</strong>ã€‚</p>
<p>å¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†Aï¼Œåˆ™Açš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ã€‚åªè¦å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º0ï¼Œå³è¡¨ç¤ºå¯¹è±¡Aä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚</p>
<p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåƒåœ¾å¯¹è±¡ä¾¿äºè¾¨è¯†ï¼›åˆ¤å®šæ•ˆç‡é«˜ï¼Œå›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>å®ƒéœ€è¦å•ç‹¬çš„å­—æ®µå­˜å‚¨è®¡æ•°å™¨ï¼Œè¿™æ ·çš„åšæ³•<strong>å¢åŠ äº†å­˜å‚¨ç©ºé—´çš„å¼€é”€ã€‚</strong></p>
</li>
<li><p>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œä¼´éšç€åŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œè¿™<strong>å¢åŠ äº†æ—¶é—´å¼€é”€ã€‚</strong></p>
</li>
<li><p>å¼•ç”¨è®¡æ•°å™¨æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå³<strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„æƒ…å†µ</strong>ã€‚è¿™æ˜¯ä¸€æ¡è‡´å‘½ç¼ºé™·ï¼Œå¯¼è‡´åœ¨Javaçš„åƒåœ¾å›æ”¶å™¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç±»ç®—æ³•ã€‚</p>
</li>
</ul>
<p><strong>å¾ªç¯å¼•ç”¨</strong></p>
<p>å½“pçš„æŒ‡é’ˆæ–­å¼€çš„æ—¶å€™ï¼Œå†…éƒ¨çš„å¼•ç”¨å½¢æˆä¸€ä¸ªå¾ªç¯ï¼Œè¿™å°±æ˜¯å¾ªç¯å¼•ç”¨ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227224405811.png" alt="image-20220227224405811" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹</strong></p>
<p>æµ‹è¯•Javaä¸­æ˜¯å¦é‡‡ç”¨çš„æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefCountGC</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€ä½œç”¨å°±æ˜¯å ç”¨ä¸€ç‚¹å†…å­˜</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] bigSize = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// å¼•ç”¨</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line">        </span><br><span class="line">        obj1.reference = obj2;</span><br><span class="line">        obj2.reference = obj1;</span><br><span class="line">        </span><br><span class="line">        obj1 = <span class="literal">null</span>;</span><br><span class="line">        obj2 = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºçš„æ‰§è¡Œåƒåœ¾æ”¶é›†è¡Œä¸º</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå‘ç”ŸGCï¼Œobj1å’Œobj2æ˜¯å¦è¢«å›æ”¶ï¼Ÿ</span></span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœ</span></span><br><span class="line">PSYoungGen: 15490K-&gt;808K(76288K)] 15490K-&gt;816K(251392K)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°è¿›è¡Œäº†GCæ”¶é›†çš„è¡Œä¸ºï¼Œæ‰€ä»¥å¯ä»¥è¯æ˜JVMä¸­é‡‡ç”¨çš„ä¸æ˜¯å¼•ç”¨è®¡æ•°å™¨çš„ç®—æ³•ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220227224816404.png" alt="image-20220227224816404" loading="lazy"></p>
<h5 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œæ˜¯å¾ˆå¤šè¯­è¨€çš„èµ„æºå›æ”¶é€‰æ‹©ï¼Œä¾‹å¦‚å› äººå·¥æ™ºèƒ½è€Œæ›´åŠ ç«çƒ­çš„Pythonï¼Œå®ƒæ›´æ˜¯åŒæ—¶æ”¯æŒå¼•ç”¨è®¡æ•°å’Œåƒåœ¾æ”¶é›†æœºåˆ¶ã€‚</p>
<p>å…·ä½“å“ªç§æœ€ä¼˜æ˜¯è¦çœ‹åœºæ™¯çš„ï¼Œä¸šç•Œæœ‰å¤§è§„æ¨¡å®è·µä¸­ä»…ä¿ç•™å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œä»¥æé«˜ååé‡çš„å°è¯•ã€‚</p>
<p>Javaå¹¶æ²¡æœ‰é€‰æ‹©å¼•ç”¨è®¡æ•°ï¼Œæ˜¯å› ä¸ºå…¶å­˜åœ¨ä¸€ä¸ªåŸºæœ¬çš„éš¾é¢˜ï¼Œä¹Ÿå°±æ˜¯å¾ˆéš¾å¤„ç†å¾ªç¯å¼•ç”¨å…³ç³»ã€‚</p>
<p>Pythonå¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨ï¼Ÿ</p>
<ul>
<li>æ‰‹åŠ¨è§£é™¤ï¼šå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨åˆé€‚çš„æ—¶æœºï¼Œè§£é™¤å¼•ç”¨å…³ç³»ã€‚ </li>
<li>ä½¿ç”¨å¼±å¼•ç”¨weakrefï¼Œweakrefæ˜¯Pythonæä¾›çš„æ ‡å‡†åº“ï¼Œæ—¨åœ¨è§£å†³å¾ªç¯å¼•ç”¨ã€‚</li>
</ul>
<h4 id="2-2ï¼Œæ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#2-2ï¼Œæ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="2.2ï¼Œæ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•"></a>2.2ï¼Œæ ‡è®°é˜¶æ®µï¼šå¯è¾¾æ€§åˆ†æç®—æ³•</h4><h5 id="å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼‰"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼‰" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼‰"></a>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼‰</h5><p>ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•è€Œè¨€ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¸ä»…åŒæ ·å…·å¤‡å®ç°ç®€å•å’Œæ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œæ›´é‡è¦çš„æ˜¯è¯¥ç®—æ³•<strong>å¯ä»¥æœ‰æ•ˆåœ°è§£å†³åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚</strong></p>
<p>ç›¸è¾ƒäºå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè¿™é‡Œçš„å¯è¾¾æ€§åˆ†æå°±æ˜¯Javaã€C#é€‰æ‹©çš„ã€‚è¿™ç§ç±»å‹çš„åƒåœ¾æ”¶é›†é€šå¸¸ä¹Ÿå«ä½œè¿½è¸ªæ€§åƒåœ¾æ”¶é›†ï¼ˆTracing Garbage Collectionï¼‰</p>
<p>æ‰€è°“â€GCRootsâ€æ ¹é›†åˆå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚</p>
<h5 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h5><ul>
<li><p>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆï¼ˆGCRootsï¼‰ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ–¹å¼æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ã€‚</p>
</li>
<li><p>ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰</p>
</li>
<li><p>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ï¼Œå¯ä»¥æ ‡è®°ä¸ºåƒåœ¾å¯¹è±¡ã€‚</p>
</li>
<li><p>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220227225328342.png" alt="image-20220227225328342" loading="lazy"></p>
<p><strong>åœ¨Javaè¯­è¨€ä¸­ï¼ŒGC RootsåŒ…æ‹¬ä»¥ä¸‹å‡ ç±»å…ƒç´ ï¼š</strong></p>
<ul>
<li><p>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ </p>
</li>
<li><ul>
<li>æ¯”å¦‚ï¼šå„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li>
</ul>
</li>
<li><p>æœ¬åœ°æ–¹æ³•æ ˆå†…JNIï¼ˆé€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</p>
</li>
<li><p>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ </p>
</li>
<li><ul>
<li>æ¯”å¦‚ï¼šJavaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li>
</ul>
</li>
<li><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ </p>
</li>
<li><ul>
<li>æ¯”å¦‚ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Tableï¼‰é‡Œçš„å¼•ç”¨</li>
</ul>
</li>
<li><p>æ‰€æœ‰è¢«åŒæ­¥é”synchronizedæŒæœ‰çš„å¯¹è±¡</p>
</li>
<li><p>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚ </p>
</li>
<li><ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚ï¼šNullPointerExceptionã€OutOfMemoryErrorï¼‰ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li>
</ul>
</li>
<li><p>åæ˜ javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220227225640216.png" alt="image-20220227225640216" loading="lazy"></p>
<p>é™¤äº†è¿™äº›å›ºå®šçš„GC Rootsé›†åˆä»¥å¤–ï¼Œæ ¹æ®ç”¨æˆ·æ‰€é€‰ç”¨çš„åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„å†…å­˜åŒºåŸŸä¸åŒï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–å¯¹è±¡â€œä¸´æ—¶æ€§â€åœ°åŠ å…¥ï¼Œå…±åŒæ„æˆå®Œæ•´GC Rootsé›†åˆã€‚æ¯”å¦‚ï¼šåˆ†ä»£æ”¶é›†å’Œå±€éƒ¨å›æ”¶ï¼ˆPartialGCï¼‰ã€‚</p>
<p>å¦‚æœåªé’ˆå¯¹Javaå †ä¸­çš„æŸä¸€å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆæ¯”å¦‚ï¼šå…¸å‹çš„åªé’ˆå¯¹æ–°ç”Ÿä»£ï¼‰ï¼Œå¿…é¡»è€ƒè™‘åˆ°å†…å­˜åŒºåŸŸæ˜¯è™šæ‹Ÿæœºè‡ªå·±çš„å®ç°ç»†èŠ‚ï¼Œæ›´ä¸æ˜¯å­¤ç«‹å°é—­çš„ï¼Œè¿™ä¸ªåŒºåŸŸçš„å¯¹è±¡å®Œå…¨æœ‰å¯èƒ½è¢«å…¶ä»–åŒºåŸŸçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€å¹¶å°†å…³è”çš„åŒºåŸŸå¯¹è±¡ä¹ŸåŠ å…¥GCRootsé›†åˆä¸­å»è€ƒè™‘ï¼Œæ‰èƒ½ä¿è¯å¯è¾¾æ€§åˆ†æçš„å‡†ç¡®æ€§ã€‚</p>
<p>å°æŠ€å·§ï¼šç”±äºRooté‡‡ç”¨æ ˆæ–¹å¼å­˜æ”¾å˜é‡å’ŒæŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒä¿å­˜äº†å †å†…å­˜é‡Œé¢çš„å¯¹è±¡ï¼Œä½†æ˜¯è‡ªå·±åˆä¸å­˜æ”¾åœ¨å †å†…å­˜é‡Œé¢ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªRootã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<p>å¦‚æœè¦ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œé‚£ä¹ˆåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ã€‚</p>
<p>è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»â€œstop The Worldâ€çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚</p>
<ul>
<li>å³ä½¿æ˜¯å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMSæ”¶é›†å™¨ä¸­ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚</li>
</ul>
<h4 id="2-3ï¼Œå¯¹è±¡çš„finalizationæœºåˆ¶"><a href="#2-3ï¼Œå¯¹è±¡çš„finalizationæœºåˆ¶" class="headerlink" title="2.3ï¼Œå¯¹è±¡çš„finalizationæœºåˆ¶"></a>2.3ï¼Œå¯¹è±¡çš„finalizationæœºåˆ¶</h4><p>Javaè¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›<strong>å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚</strong></p>
<p>å½“åƒåœ¾å›æ”¶å™¨å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå³ï¼šåƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ã€‚</p>
<p>finalize() æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œ<strong>ç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾</strong>ã€‚é€š<strong>å¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰ã€‚</strong></p>
<p>æ°¸è¿œä¸è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•Iåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨ã€‚ç†ç”±åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š</p>
<ul>
<li><p>åœ¨finalize()æ—¶å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡å¤æ´»ã€‚</p>
</li>
<li><p>finalize()æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä¿éšœçš„ï¼Œå®ƒå®Œå…¨ç”±GCçº¿ç¨‹å†³å®šï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè‹¥ä¸å‘ç”ŸGCï¼Œåˆ™finalize()æ–¹æ³•å°†æ²¡æœ‰æ‰§è¡Œæœºä¼šã€‚</p>
</li>
<li><p>ä¸€ä¸ªç³Ÿç³•çš„finalize()ä¼šä¸¥é‡å½±å“Gcçš„æ€§èƒ½ã€‚</p>
</li>
</ul>
<p>ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œfinalize()æ–¹æ³•ä¸Cä¸­çš„ææ„å‡½æ•°æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯Javaé‡‡ç”¨çš„æ˜¯åŸºäºåƒåœ¾å›æ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ‰€ä»¥finalize()æ–¹æ³•åœ¨æœ¬è´¨ä¸Šä¸åŒäºCä¸­çš„ææ„å‡½æ•°ã€‚</p>
<p>ç”±äºfinalize()æ–¹æ³•çš„å­˜åœ¨ï¼Œ<strong>è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡ä¸€èˆ¬å¤„äºä¸‰ç§å¯èƒ½çš„çŠ¶æ€ã€‚</strong></p>
<h5 id="ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ"><a href="#ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ" class="headerlink" title="ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ"></a>ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ</h5><p>å¦‚æœä»æ‰€æœ‰çš„æ ¹èŠ‚ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œè¯´æ˜å¯¹è±¡å·±ç»ä¸å†ä½¿ç”¨äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ­¤å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ä½†äº‹å®ä¸Šï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µã€‚ä¸€ä¸ªæ— æ³•è§¦åŠçš„å¯¹è±¡æœ‰å¯èƒ½åœ¨æŸä¸€ä¸ªæ¡ä»¶ä¸‹â€œå¤æ´»â€è‡ªå·±ï¼Œå¦‚æœè¿™æ ·ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„å›æ”¶å°±æ˜¯ä¸åˆç†çš„ï¼Œä¸ºæ­¤ï¼Œå®šä¹‰è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ã€‚å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥åˆ°è¾¾è¿™ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li><p>å¯å¤æ´»çš„ï¼šå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹è±¡æœ‰å¯èƒ½åœ¨finalize()ä¸­å¤æ´»ã€‚</p>
</li>
<li><p>ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„finalize()è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸å¯è§¦åŠçŠ¶æ€ã€‚ä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ï¼Œ<strong>å› ä¸ºfinalize()åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</strong></p>
</li>
</ul>
<p>ä»¥ä¸Š3ç§çŠ¶æ€ä¸­ï¼Œæ˜¯ç”±äºinalize()æ–¹æ³•çš„å­˜åœ¨ï¼Œè¿›è¡Œçš„åŒºåˆ†ã€‚åªæœ‰åœ¨å¯¹è±¡ä¸å¯è§¦åŠæ—¶æ‰å¯ä»¥è¢«å›æ”¶ã€‚</p>
<h5 id="å…·ä½“è¿‡ç¨‹"><a href="#å…·ä½“è¿‡ç¨‹" class="headerlink" title="å…·ä½“è¿‡ç¨‹"></a>å…·ä½“è¿‡ç¨‹</h5><p>åˆ¤å®šä¸€ä¸ªå¯¹è±¡objAæ˜¯å¦å¯å›æ”¶ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p>
<ol>
<li>å¦‚æœå¯¹è±¡objAåˆ°GC Rootsæ²¡æœ‰å¼•ç”¨é“¾ï¼Œåˆ™è¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°ã€‚</li>
<li>è¿›è¡Œç­›é€‰ï¼Œåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•<ol>
<li>å¦‚æœå¯¹è±¡objAæ²¡æœ‰é‡å†™finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œåˆ™è™šæ‹Ÿæœºè§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ï¼ŒobjAè¢«åˆ¤å®šä¸ºä¸å¯è§¦åŠçš„ã€‚</li>
<li>å¦‚æœå¯¹è±¡objAé‡å†™äº†finalize()æ–¹æ³•ï¼Œä¸”è¿˜æœªæ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆobjAä¼šè¢«æ’å…¥åˆ°F-Queueé˜Ÿåˆ—ä¸­ï¼Œç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹è§¦å‘å…¶finalize()æ–¹æ³•æ‰§è¡Œã€‚</li>
<li><strong>finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡çš„æœ€åæœºä¼š</strong>ï¼Œç¨åGCä¼šå¯¹F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ã€‚<strong>å¦‚æœobjAåœ¨finalize()æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»</strong>ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶ï¼ŒobjAä¼šè¢«ç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚ä¹‹åï¼Œå¯¹è±¡ä¼šå†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œfinalizeæ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œå¯¹è±¡ä¼šç›´æ¥å˜æˆä¸å¯è§¦åŠçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹è±¡çš„finalizeæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li>
</ol>
</li>
</ol>
<p><strong>ä¸¾ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanReliveObj</span> &#123;</span><br><span class="line">    <span class="comment">// ç±»å˜é‡ï¼Œå±äºGC Rootsçš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CanReliveObj canReliveObj;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å½“å‰ç±»é‡å†™çš„finalize()æ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="comment">//å½“å‰å¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œä¸”finalizeåªèƒ½æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">        canReliveObj = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        canReliveObj = <span class="keyword">new</span> <span class="title class_">CanReliveObj</span>();</span><br><span class="line">        canReliveObj = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------ç¬¬ä¸€æ¬¡gcæ“ä½œ------------&quot;</span>);</span><br><span class="line">        <span class="comment">// å› ä¸ºFinalizerçº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œæš‚åœ2ç§’ï¼Œä»¥ç­‰å¾…å®ƒ</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">if</span> (canReliveObj == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;obj is dead&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;obj is still alive&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------ç¬¬äºŒæ¬¡gcæ“ä½œ------------&quot;</span>);</span><br><span class="line">        canReliveObj = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// ä¸‹é¢ä»£ç å’Œä¸Šé¢ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ canReliveObjå´è‡ªæ•‘å¤±è´¥äº†</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">if</span> (canReliveObj == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;obj is dead&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;obj is still alive&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-----------------ç¬¬ä¸€æ¬¡gcæ“ä½œ------------</span><br><span class="line">è°ƒç”¨å½“å‰ç±»é‡å†™çš„finalize()æ–¹æ³•</span><br><span class="line">obj is still alive</span><br><span class="line">-----------------ç¬¬äºŒæ¬¡gcæ“ä½œ------------</span><br><span class="line">obj is dead</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸€æ¬¡GCæ—¶ï¼Œæ‰§è¡Œäº†finalizeæ–¹æ³•ï¼Œä½†finalize()æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è¯¥å¯¹è±¡è¢«GCæ ‡è®°å¹¶æ¸…é™¤äº†ã€‚</p>
<h4 id="2-4ï¼ŒMATä¸JProfilerçš„GC-Rootsæº¯æº"><a href="#2-4ï¼ŒMATä¸JProfilerçš„GC-Rootsæº¯æº" class="headerlink" title="2.4ï¼ŒMATä¸JProfilerçš„GC Rootsæº¯æº"></a>2.4ï¼ŒMATä¸JProfilerçš„GC Rootsæº¯æº</h4><h5 id="MATæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#MATæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="MATæ˜¯ä»€ä¹ˆï¼Ÿ"></a>MATæ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>MATæ˜¯Memory Analyzerçš„ç®€ç§°ï¼Œå®ƒæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„Javaå †å†…å­˜åˆ†æå™¨ã€‚ç”¨äºæŸ¥æ‰¾å†…å­˜æ³„æ¼ä»¥åŠæŸ¥çœ‹å†…å­˜æ¶ˆè€—æƒ…å†µã€‚</p>
<p>MATæ˜¯åŸºäºEclipseå¼€å‘çš„ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</p>
<p>å¤§å®¶å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="http://www.eclipse.org/mat/">http://www.eclipse.org/mat/</a> ä¸‹è½½å¹¶ä½¿ç”¨MAT</p>
<h5 id="è·å–dumpæ–‡ä»¶"><a href="#è·å–dumpæ–‡ä»¶" class="headerlink" title="è·å–dumpæ–‡ä»¶"></a>è·å–dumpæ–‡ä»¶</h5><h6 id="æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨-jmap"><a href="#æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨-jmap" class="headerlink" title="æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨ jmap"></a>æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨ jmap</h6><p><img src="/2022/04/18/JVM/image-20220227233127065.png" alt="image-20220227233127065" loading="lazy"></p>
<h6 id="æ–¹å¼äºŒï¼šä½¿ç”¨JVisualVMå¯¼å‡º"><a href="#æ–¹å¼äºŒï¼šä½¿ç”¨JVisualVMå¯¼å‡º" class="headerlink" title="æ–¹å¼äºŒï¼šä½¿ç”¨JVisualVMå¯¼å‡º"></a>æ–¹å¼äºŒï¼šä½¿ç”¨JVisualVMå¯¼å‡º</h6><p>æ•è·çš„heap dumpæ–‡ä»¶æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå…³é—­JVisualVMåè‡ªåŠ¨åˆ é™¤ï¼Œè‹¥è¦ä¿ç•™ï¼Œéœ€è¦å°†å…¶å¦å­˜ä¸ºæ–‡ä»¶ã€‚</p>
<p>å¯é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ•è·heap dumpï¼š</p>
<ul>
<li><p> åœ¨å·¦ä¾§â€œApplicationâ€ï¼ˆåº”ç”¨ç¨‹åºï¼‰å­çª—å£ä¸­å³å‡»ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼Œé€‰æ‹©Heap Dumpï¼ˆå †Dumpï¼‰ã€‚ </p>
</li>
<li><p> åœ¨Monitorï¼ˆç›‘è§†ï¼‰å­æ ‡ç­¾é¡µä¸­ç‚¹å‡»Heap Dumpï¼ˆå †Dumpï¼‰æŒ‰é’®ã€‚ </p>
</li>
</ul>
<p>æœ¬åœ°åº”ç”¨ç¨‹åºçš„Heap dumpsä½œä¸ºåº”ç”¨ç¨‹åºæ ‡ç­¾é¡µçš„ä¸€ä¸ªå­æ ‡ç­¾é¡µæ‰“å¼€ã€‚åŒæ—¶ï¼Œheap dumpåœ¨å·¦ä¾§çš„Applicationï¼ˆåº”ç”¨ç¨‹åºï¼‰æ ä¸­å¯¹åº”ä¸€ä¸ªå«æœ‰æ—¶é—´æˆ³çš„èŠ‚ç‚¹ã€‚</p>
<p>å³å‡»è¿™ä¸ªèŠ‚ç‚¹é€‰æ‹©save asï¼ˆå¦å­˜ä¸ºï¼‰å³å¯å°†heap dumpä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<h6 id="æ–¹å¼ä¸‰ï¼šä½¿ç”¨MATæ‰“å¼€Dumpæ–‡ä»¶"><a href="#æ–¹å¼ä¸‰ï¼šä½¿ç”¨MATæ‰“å¼€Dumpæ–‡ä»¶" class="headerlink" title="æ–¹å¼ä¸‰ï¼šä½¿ç”¨MATæ‰“å¼€Dumpæ–‡ä»¶"></a>æ–¹å¼ä¸‰ï¼šä½¿ç”¨MATæ‰“å¼€Dumpæ–‡ä»¶</h6><p><img src="/2022/04/18/JVM/image-20220227233826020.png" alt="image-20220227233826020" loading="lazy"></p>
<h5 id="JProfilerçš„GC-Rootsæº¯æº"><a href="#JProfilerçš„GC-Rootsæº¯æº" class="headerlink" title="JProfilerçš„GC Rootsæº¯æº"></a>JProfilerçš„GC Rootsæº¯æº</h5><p>æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šæŸ¥æ‰¾å…¨éƒ¨çš„GC Rootsï¼Œå¯èƒ½åªæ˜¯æŸ¥æ‰¾æŸä¸ªå¯¹è±¡çš„æ•´ä¸ªé“¾è·¯ï¼Œæˆ–è€…ç§°ä¸ºGC Rootsæº¯æºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨JProfiler</p>
<p><img src="/2022/04/18/JVM/image-20220227233856253.png" alt="image-20220227233856253" loading="lazy"></p>
<h4 id="2-5ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#2-5ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="2.5ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•"></a>2.5ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>å½“æˆåŠŸåŒºåˆ†å‡ºå†…å­˜ä¸­å­˜æ´»å¯¹è±¡å’Œæ­»äº¡å¯¹è±¡åï¼ŒGCæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾æ‰æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚</p>
<p>ç›®å‰åœ¨JVMä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯æ ‡è®°ä¸€æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰ã€å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰ã€æ ‡è®°-å‹ç¼©ç®—æ³•ï¼ˆMark-Compactï¼‰</p>
<h5 id="æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h5><p>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ˜¯ä¸€ç§éå¸¸åŸºç¡€å’Œå¸¸è§çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œè¯¥ç®—æ³•è¢«J.McCarthyç­‰äººåœ¨1960å¹´æå‡ºå¹¶å¹¶åº”ç”¨äºLispè¯­è¨€ã€‚</p>
<h5 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h5><p>å½“å †ä¸­çš„æœ‰æ•ˆå†…å­˜ç©ºé—´ï¼ˆavailable memoryï¼‰è¢«è€—å°½çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢æ•´ä¸ªç¨‹åºï¼ˆä¹Ÿè¢«ç§°ä¸ºstop the worldï¼‰ï¼Œç„¶åè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼Œç¬¬ä¸€é¡¹åˆ™æ˜¯æ ‡è®°ï¼Œç¬¬äºŒé¡¹åˆ™æ˜¯æ¸…é™¤</p>
<ul>
<li><p> æ ‡è®°ï¼šCollectorä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„Headerä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ã€‚ </p>
</li>
<li><p> æ¸…é™¤ï¼šCollectorå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§çš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡åœ¨å…¶Headerä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220227234910721.png" alt="image-20220227234910721" loading="lazy"></p>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li><p>æ ‡è®°æ¸…é™¤ç®—æ³•çš„æ•ˆç‡ä¸ç®—é«˜</p>
</li>
<li><p>åœ¨è¿›è¡ŒGCçš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®</p>
</li>
<li><p>è¿™ç§æ–¹å¼æ¸…ç†å‡ºæ¥çš„ç©ºé—²å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œäº§ç”Ÿå†…ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</p>
</li>
</ul>
<h5 id="ä½•ä¸ºæ¸…é™¤ï¼Ÿ"><a href="#ä½•ä¸ºæ¸…é™¤ï¼Ÿ" class="headerlink" title="ä½•ä¸ºæ¸…é™¤ï¼Ÿ"></a>ä½•ä¸ºæ¸…é™¤ï¼Ÿ</h5><p>è¿™é‡Œæ‰€è°“çš„æ¸…é™¤å¹¶ä¸æ˜¯çœŸçš„ç½®ç©ºï¼Œè€Œæ˜¯æŠŠéœ€è¦æ¸…é™¤çš„å¯¹è±¡åœ°å€ä¿å­˜åœ¨ç©ºé—²çš„åœ°å€åˆ—è¡¨é‡Œã€‚ä¸‹æ¬¡æœ‰æ–°å¯¹è±¡éœ€è¦åŠ è½½æ—¶ï¼Œåˆ¤æ–­åƒåœ¾çš„ä½ç½®ç©ºé—´æ˜¯å¦å¤Ÿï¼Œå¦‚æœå¤Ÿï¼Œå°±å­˜æ”¾<strong>è¦†ç›–åŸæœ‰çš„åœ°å€</strong>ã€‚</p>
<h4 id="2-6ï¼Œæ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•"><a href="#2-6ï¼Œæ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•" class="headerlink" title="2.6ï¼Œæ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•"></a>2.6ï¼Œæ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•</h4><h5 id="å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•"><a href="#å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•" class="headerlink" title="å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•"></a>å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•</h5><p>ä¸ºäº†è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•åœ¨åƒåœ¾æ”¶é›†æ•ˆç‡æ–¹é¢çš„ç¼ºé™·ï¼ŒM.L.Minskyäº1963å¹´å‘è¡¨äº†è‘—åçš„è®ºæ–‡ï¼Œâ€œä½¿ç”¨åŒå­˜å‚¨åŒºçš„Lispè¯­è¨€åƒåœ¾æ”¶é›†å™¨CA LISP Garbage Collector Algorithm Using Serial Secondary Storageï¼‰â€ã€‚M.L.Minskyåœ¨è¯¥è®ºæ–‡ä¸­æè¿°çš„ç®—æ³•è¢«äººä»¬ç§°ä¸ºå¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•ï¼Œå®ƒä¹Ÿè¢«M.L.Minskyæœ¬äººæˆåŠŸåœ°å¼•å…¥åˆ°äº†Lispè¯­è¨€çš„ä¸€ä¸ªå®ç°ç‰ˆæœ¬ä¸­ã€‚</p>
<h5 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h5><p>å°†æ´»ç€çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶å°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œä¹‹åæ¸…é™¤æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œæœ€åå®Œæˆåƒåœ¾å›æ”¶</p>
<p><img src="/2022/04/18/JVM/image-20220228162822227.png" alt="image-20220228162822227" loading="lazy"></p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li><p>æ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆ</p>
</li>
<li><p>å¤åˆ¶è¿‡å»ä»¥åä¿è¯ç©ºé—´çš„è¿ç»­æ€§ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚</p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li><p>æ­¤ç®—æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå°±æ˜¯éœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€‚</p>
</li>
<li><p>å¯¹äºG1è¿™ç§åˆ†æ‹†æˆä¸ºå¤§é‡regionçš„GCï¼Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ„å‘³ç€GCéœ€è¦ç»´æŠ¤regionä¹‹é—´å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œä¸ç®¡æ˜¯å†…å­˜å ç”¨æˆ–è€…æ—¶é—´å¼€é”€ä¹Ÿä¸å°</p>
</li>
</ul>
<p><strong>ç‰¹åˆ«çš„</strong></p>
<p>å¦‚æœç³»ç»Ÿä¸­çš„åƒåœ¾å¯¹è±¡å¾ˆå¤šï¼Œå¤åˆ¶ç®—æ³•éœ€è¦å¤åˆ¶çš„å­˜æ´»å¯¹è±¡æ•°é‡å¹¶ä¸ä¼šå¤ªå¤§ï¼Œæˆ–è€…è¯´éå¸¸ä½æ‰è¡Œ</p>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<p>åœ¨æ–°ç”Ÿä»£ï¼Œå¯¹å¸¸è§„åº”ç”¨çš„åƒåœ¾å›æ”¶ï¼Œä¸€æ¬¡é€šå¸¸å¯ä»¥å›æ”¶70% - 99% çš„å†…å­˜ç©ºé—´ã€‚å›æ”¶æ€§ä»·æ¯”å¾ˆé«˜ã€‚æ‰€ä»¥ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228163241674.png" alt="image-20220228163241674" loading="lazy"></p>
<h4 id="2-7ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•"><a href="#2-7ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•" class="headerlink" title="2.7ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•"></a>2.7ï¼Œæ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•</h4><p><strong>æ ‡è®°-å‹ç¼©ï¼ˆæˆ–æ ‡è®°-æ•´ç†ã€Mark-Compactï¼‰ç®—æ³•</strong></p>
<p>å¤åˆ¶ç®—æ³•çš„é«˜æ•ˆæ€§æ˜¯å»ºç«‹åœ¨å­˜æ´»å¯¹è±¡å°‘ã€åƒåœ¾å¯¹è±¡å¤šçš„å‰æä¸‹çš„ã€‚è¿™ç§æƒ…å†µåœ¨æ–°ç”Ÿä»£ç»å¸¸å‘ç”Ÿï¼Œä½†æ˜¯åœ¨è€å¹´ä»£ï¼Œæ›´å¸¸è§çš„æƒ…å†µæ˜¯å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å­˜æ´»å¯¹è±¡ã€‚å¦‚æœä¾ç„¶ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œç”±äºå­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¤åˆ¶çš„æˆæœ¬ä¹Ÿå°†å¾ˆé«˜ã€‚å› æ­¤ï¼ŒåŸºäºè€å¹´ä»£åƒåœ¾å›æ”¶çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„ç®—æ³•ã€‚</p>
<p>æ ‡è®°ä¸€æ¸…é™¤ç®—æ³•çš„ç¡®å¯ä»¥åº”ç”¨åœ¨è€å¹´ä»£ä¸­ï¼Œä½†æ˜¯è¯¥ç®—æ³•ä¸ä»…æ‰§è¡Œæ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”åœ¨æ‰§è¡Œå®Œå†…å­˜å›æ”¶åè¿˜ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥JVMçš„è®¾è®¡è€…éœ€è¦åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹è¿›ã€‚æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•ç”±æ­¤è¯ç”Ÿã€‚</p>
<p>1970å¹´å‰åï¼ŒG.L.Steeleã€C.J.Cheneå’ŒD.s.Wiseç­‰ç ”ç©¶è€…å‘å¸ƒæ ‡è®°-å‹ç¼©ç®—æ³•ã€‚åœ¨è®¸å¤šç°ä»£çš„åƒåœ¾æ”¶é›†å™¨ä¸­ï¼Œäººä»¬éƒ½ä½¿ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•æˆ–å…¶æ”¹è¿›ç‰ˆæœ¬ã€‚</p>
<p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p>
<ol>
<li> ç¬¬ä¸€é˜¶æ®µå’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡ </li>
<li> ç¬¬äºŒé˜¶æ®µå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚ </li>
<li> ä¹‹åï¼Œæ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´ã€‚</li>
</ol>
<p><img src="/2022/04/18/JVM/image-20220228164104180.png" alt="image-20220228164104180" loading="lazy"></p>
<p>æ ‡è®°-å‹ç¼©ç®—æ³•çš„æœ€ç»ˆæ•ˆæœç­‰åŒäºæ ‡è®°-æ¸…é™¤ç®—æ³•æ‰§è¡Œå®Œæˆåï¼Œå†è¿›è¡Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç§°ä¸ºæ ‡è®°-æ¸…é™¤-å‹ç¼©ï¼ˆMark-Sweep-Compactï¼‰ç®—æ³•ã€‚</p>
<p>äºŒè€…çš„æœ¬è´¨å·®å¼‚åœ¨äºæ ‡è®°-æ¸…é™¤ç®—æ³•æ˜¯ä¸€ç§éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•ï¼Œæ ‡è®°-å‹ç¼©æ˜¯ç§»åŠ¨å¼çš„ã€‚æ˜¯å¦ç§»åŠ¨å›æ”¶åçš„å­˜æ´»å¯¹è±¡æ˜¯ä¸€é¡¹ä¼˜ç¼ºç‚¹å¹¶å­˜çš„é£é™©å†³ç­–ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°çš„å­˜æ´»å¯¹è±¡å°†ä¼šè¢«æ•´ç†ï¼ŒæŒ‰ç…§å†…å­˜åœ°å€ä¾æ¬¡æ’åˆ—ï¼Œè€Œæœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«æ¸…ç†æ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ï¼Œè¿™æ¯”ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ˜¾ç„¶å°‘äº†è®¸å¤šå¼€é”€ã€‚</p>
<p><strong>æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰</strong></p>
<p>å¦‚æœå†…å­˜ç©ºé—´ä»¥è§„æ•´å’Œæœ‰åºçš„æ–¹å¼åˆ†å¸ƒï¼Œå³å·²ç”¨å’Œæœªç”¨çš„å†…å­˜éƒ½å„è‡ªä¸€è¾¹ï¼Œå½¼æ­¤ä¹‹é—´ç»´ç³»ç€ä¸€ä¸ªè®°å½•ä¸‹ä¸€æ¬¡åˆ†é…èµ·å§‹ç‚¹çš„æ ‡è®°æŒ‡é’ˆï¼Œå½“ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦é€šè¿‡ä¿®æ”¹æŒ‡é’ˆçš„åç§»é‡å°†æ–°å¯¹è±¡åˆ†é…åœ¨ç¬¬ä¸€ä¸ªç©ºé—²å†…å­˜ä½ç½®ä¸Šï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±å«åšæŒ‡é’ˆç¢°æ’ï¼ˆBump tHe Pointerï¼‰ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li><p>æ¶ˆé™¤äº†æ ‡è®°-æ¸…é™¤ç®—æ³•å½“ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ã€‚</p>
</li>
<li><p>æ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·ã€‚</p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li><p>ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•ã€‚</p>
</li>
<li><p>ç§»åŠ¨å¯¹è±¡çš„åŒæ—¶ï¼Œå¦‚æœå¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œåˆ™è¿˜éœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€</p>
</li>
<li><p>ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºã€‚å³ï¼šSTW</p>
</li>
</ul>
<h4 id="2-8ï¼Œå°ç»“"><a href="#2-8ï¼Œå°ç»“" class="headerlink" title="2.8ï¼Œå°ç»“"></a>2.8ï¼Œå°ç»“</h4><p><img src="/2022/04/18/JVM/image-20220228164220211.png" alt="image-20220228164220211" loading="lazy"></p>
<p>æ•ˆç‡ä¸Šæ¥è¯´ï¼Œå¤åˆ¶ç®—æ³•æ˜¯å½“ä¹‹æ— æ„§çš„è€å¤§ï¼Œä½†æ˜¯å´æµªè´¹äº†å¤ªå¤šå†…å­˜ã€‚</p>
<p>è€Œä¸ºäº†å°½é‡å…¼é¡¾ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ç›¸å¯¹æ¥è¯´æ›´å¹³æ»‘ä¸€äº›ï¼Œä½†æ˜¯æ•ˆç‡ä¸Šä¸å°½å¦‚äººæ„ï¼Œå®ƒæ¯”å¤åˆ¶ç®—æ³•å¤šäº†ä¸€ä¸ªæ ‡è®°çš„é˜¶æ®µï¼Œæ¯”æ ‡è®°-æ¸…é™¤å¤šäº†ä¸€ä¸ªæ•´ç†å†…å­˜çš„é˜¶æ®µ</p>
<p>éš¾é“å°±æ²¡æœ‰ä¸€ç§æœ€ä¼˜ç®—æ³•å—ï¼Ÿ</p>
<p>å›ç­”ï¼šæ— ï¼Œæ²¡æœ‰æœ€å¥½çš„ç®—æ³•ï¼Œåªæœ‰æœ€åˆé€‚çš„ç®—æ³•ã€‚</p>
<h4 id="2-9ï¼Œåˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#2-9ï¼Œåˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="2.9ï¼Œåˆ†ä»£æ”¶é›†ç®—æ³•"></a>2.9ï¼Œåˆ†ä»£æ”¶é›†ç®—æ³•</h4><p>å‰é¢æ‰€æœ‰è¿™äº›ç®—æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸€ç§ç®—æ³•å¯ä»¥å®Œå…¨æ›¿ä»£å…¶ä»–ç®—æ³•ï¼Œå®ƒä»¬éƒ½å…·æœ‰è‡ªå·±ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚åˆ†ä»£æ”¶é›†ç®—æ³•åº”è¿è€Œç”Ÿã€‚</p>
<p>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¸åŒçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥é‡‡å–ä¸åŒçš„æ”¶é›†æ–¹å¼ï¼Œä»¥ä¾¿æé«˜å›æ”¶æ•ˆç‡ã€‚ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚</p>
<p>åœ¨Javaç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„å¯¹è±¡ï¼Œå…¶ä¸­æœ‰äº›å¯¹è±¡æ˜¯ä¸ä¸šåŠ¡ä¿¡æ¯ç›¸å…³ï¼Œæ¯”å¦‚Httpè¯·æ±‚ä¸­çš„Sessionå¯¹è±¡ã€çº¿ç¨‹ã€Socketè¿æ¥ï¼Œè¿™ç±»å¯¹è±¡è·Ÿä¸šåŠ¡ç›´æ¥æŒ‚é’©ï¼Œå› æ­¤ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€äº›å¯¹è±¡ï¼Œä¸»è¦æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶å˜é‡ï¼Œè¿™äº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¼šæ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ï¼šStringå¯¹è±¡ï¼Œç”±äºå…¶ä¸å˜ç±»çš„ç‰¹æ€§ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿå¤§é‡çš„è¿™äº›å¯¹è±¡ï¼Œæœ‰äº›å¯¹è±¡ç”šè‡³åªç”¨ä¸€æ¬¡å³å¯å›æ”¶ã€‚</p>
<p>ç›®å‰å‡ ä¹æ‰€æœ‰çš„GCéƒ½é‡‡ç”¨åˆ†ä»£æ‰‹æœºç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶çš„ã€‚</p>
<p>åœ¨HotSpotä¸­ï¼ŒåŸºäºåˆ†ä»£çš„æ¦‚å¿µï¼ŒGCæ‰€ä½¿ç”¨çš„å†…å­˜å›æ”¶ç®—æ³•å¿…é¡»ç»“åˆå¹´è½»ä»£å’Œè€å¹´ä»£å„è‡ªçš„ç‰¹ç‚¹ã€‚</p>
<p><strong>å¹´è½»ä»£ï¼ˆYoung Genï¼‰</strong></p>
<p>å¹´è½»ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸç›¸å¯¹è€å¹´ä»£è¾ƒå°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ã€å­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ã€‚</p>
<p>è¿™ç§æƒ…å†µå¤åˆ¶ç®—æ³•çš„å›æ”¶æ•´ç†ï¼Œé€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚å¤åˆ¶ç®—æ³•çš„æ•ˆç‡åªå’Œå½“å‰å­˜æ´»å¯¹è±¡å¤§å°æœ‰å…³ï¼Œå› æ­¤å¾ˆé€‚ç”¨äºå¹´è½»ä»£çš„å›æ”¶ã€‚è€Œå¤åˆ¶ç®—æ³•å†…å­˜åˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ï¼Œé€šè¿‡hotspotä¸­çš„ä¸¤ä¸ªsurvivorçš„è®¾è®¡å¾—åˆ°ç¼“è§£ã€‚</p>
<p><strong>è€å¹´ä»£ï¼ˆTenured Genï¼‰</strong></p>
<p>è€å¹´ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ã€å­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠå¹´è½»ä»£é¢‘ç¹ã€‚</p>
<p>è¿™ç§æƒ…å­˜åœ¨å¤§é‡å­˜æ´»ç‡é«˜çš„å¯¹è±¡ï¼Œå¤åˆ¶ç®—æ³•æ˜æ˜¾å˜å¾—ä¸åˆé€‚ã€‚ä¸€èˆ¬æ˜¯ç”±æ ‡è®°-æ¸…é™¤æˆ–è€…æ˜¯æ ‡è®°-æ¸…é™¤ä¸æ ‡è®°-æ•´ç†çš„æ··åˆå®ç°ã€‚</p>
<ul>
<li><p>Marké˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°é‡æˆæ­£æ¯”ã€‚</p>
</li>
<li><p>Sweepé˜¶æ®µçš„å¼€é”€ä¸æ‰€ç®¡ç†åŒºåŸŸçš„å¤§å°æˆæ­£ç›¸å…³ã€‚</p>
</li>
<li><p>Compacté˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°æ®æˆæ­£æ¯”ã€‚</p>
</li>
</ul>
<p>ä»¥HotSpotä¸­çš„CMSå›æ”¶å™¨ä¸ºä¾‹ï¼ŒCMSæ˜¯åŸºäºMark-Sweepå®ç°çš„ï¼Œå¯¹äºå¯¹è±¡çš„å›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚è€Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼ŒCMSé‡‡ç”¨åŸºäºMark-Compactç®—æ³•çš„Serial Oldå›æ”¶å™¨ä½œä¸ºè¡¥å¿æªæ–½ï¼šå½“å†…å­˜å›æ”¶ä¸ä½³ï¼ˆç¢ç‰‡å¯¼è‡´çš„Concurrent Mode Failureæ—¶ï¼‰ï¼Œå°†é‡‡ç”¨Serial Oldæ‰§è¡ŒFull GCä»¥è¾¾åˆ°å¯¹è€å¹´ä»£å†…å­˜çš„æ•´ç†ã€‚</p>
<p>åˆ†ä»£çš„æ€æƒ³è¢«ç°æœ‰çš„è™šæ‹Ÿæœºå¹¿æ³›ä½¿ç”¨ã€‚å‡ ä¹æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨éƒ½åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£</p>
<h4 id="2-10ï¼Œå¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•"><a href="#2-10ï¼Œå¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•" class="headerlink" title="2.10ï¼Œå¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•"></a>2.10ï¼Œå¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•</h4><h5 id="å¢é‡æ”¶é›†ç®—æ³•"><a href="#å¢é‡æ”¶é›†ç®—æ³•" class="headerlink" title="å¢é‡æ”¶é›†ç®—æ³•"></a>å¢é‡æ”¶é›†ç®—æ³•</h5><p>ä¸Šè¿°ç°æœ‰çš„ç®—æ³•ï¼Œåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è½¯ä»¶å°†å¤„äºä¸€ç§Stop the Worldçš„çŠ¶æ€ã€‚<u>åœ¨Stop the WorldçŠ¶æ€ä¸‹</u>ï¼Œåº”ç”¨ç¨‹åºæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šæŒ‚èµ·ï¼Œæš‚åœä¸€åˆ‡æ­£å¸¸çš„å·¥ä½œï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆã€‚å¦‚æœåƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿ï¼Œåº”ç”¨ç¨‹åºä¼šè¢«æŒ‚èµ·å¾ˆä¹…ï¼Œå°†ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒæˆ–è€…ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³å¯¹å®æ—¶åƒåœ¾æ”¶é›†ç®—æ³•çš„ç ”ç©¶ç›´æ¥å¯¼è‡´äº†å¢é‡æ”¶é›†ï¼ˆIncremental Collectingï¼‰ç®—æ³•çš„è¯ç”Ÿã€‚</p>
<p><strong>åŸºæœ¬æ€æƒ³</strong></p>
<p>å¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„åƒåœ¾è¿›è¡Œå¤„ç†ï¼Œéœ€è¦é€ æˆç³»ç»Ÿé•¿æ—¶é—´çš„åœé¡¿ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿æ‰§è¡Œã€‚æ¯æ¬¡ï¼Œ<u>åƒåœ¾æ”¶é›†çº¿ç¨‹åªæ”¶é›†ä¸€å°ç‰‡åŒºåŸŸçš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åˆ‡æ¢åˆ°åº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚ä¾æ¬¡åå¤ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚</u></p>
<p>æ€»çš„æ¥è¯´ï¼Œå¢é‡æ”¶é›†ç®—æ³•çš„åŸºç¡€ä»æ˜¯ä¼ ç»Ÿçš„æ ‡è®°-æ¸…é™¤å’Œå¤åˆ¶ç®—æ³•ã€‚<u>å¢é‡æ”¶é›†ç®—æ³•é€šè¿‡å¯¹çº¿ç¨‹é—´å†²çªçš„å¦¥å–„å¤„ç†ï¼Œå…è®¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä»¥åˆ†é˜¶æ®µçš„æ–¹å¼å®Œæˆæ ‡è®°ã€æ¸…ç†æˆ–å¤åˆ¶å·¥ä½œ</u></p>
<p><strong>ç¼ºç‚¹</strong></p>
<p>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç”±äºåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé—´æ–­æ€§åœ°è¿˜æ‰§è¡Œäº†åº”ç”¨ç¨‹åºä»£ç ï¼Œæ‰€ä»¥èƒ½å‡å°‘ç³»ç»Ÿçš„åœé¡¿æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå› ä¸ºçº¿ç¨‹åˆ‡æ¢å’Œä¸Šä¸‹æ–‡è½¬æ¢çš„æ¶ˆè€—ï¼Œä¼šä½¿å¾—åƒåœ¾å›æ”¶çš„æ€»ä½“æˆæœ¬ä¸Šå‡ï¼Œ<u>é€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ã€‚</u></p>
<h5 id="åˆ†åŒºç®—æ³•"><a href="#åˆ†åŒºç®—æ³•" class="headerlink" title="åˆ†åŒºç®—æ³•"></a>åˆ†åŒºç®—æ³•</h5><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç›¸åŒæ¡ä»¶ä¸‹ï¼Œå †ç©ºé—´è¶Šå¤§ï¼Œä¸€æ¬¡Gcæ—¶æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæœ‰å…³GCäº§ç”Ÿçš„åœé¡¿ä¹Ÿè¶Šé•¿ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶GCäº§ç”Ÿçš„åœé¡¿æ—¶é—´ï¼Œå°†ä¸€å—å¤§çš„å†…å­˜åŒºåŸŸåˆ†å‰²æˆå¤šä¸ªå°å—ï¼Œæ ¹æ®ç›®æ ‡çš„åœé¡¿æ—¶é—´ï¼Œæ¯æ¬¡åˆç†åœ°å›æ”¶è‹¥å¹²ä¸ªå°åŒºé—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå †ç©ºé—´ï¼Œä»è€Œå‡å°‘ä¸€æ¬¡GCæ‰€äº§ç”Ÿçš„åœé¡¿ã€‚</p>
<p>åˆ†ä»£ç®—æ³•å°†æŒ‰ç…§å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿çŸ­åˆ’åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åŒºç®—æ³•å°†æ•´ä¸ªå †ç©ºé—´åˆ’åˆ†æˆè¿ç»­çš„ä¸åŒå°åŒºé—´ã€‚</p>
<p>æ¯ä¸€ä¸ªå°åŒºé—´éƒ½ç‹¬ç«‹ä½¿ç”¨ï¼Œç‹¬ç«‹å›æ”¶ã€‚è¿™ç§ç®—æ³•çš„å¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228171749275.png" alt="image-20220228171749275" loading="lazy"></p>
<p>æ³¨æ„ï¼Œè¿™äº›åªæ˜¯åŸºæœ¬çš„ç®—æ³•æ€è·¯ï¼Œå®é™…GCå®ç°è¿‡ç¨‹è¦å¤æ‚çš„å¤šï¼Œç›®å‰è¿˜åœ¨å‘å±•ä¸­çš„å‰æ²¿GCéƒ½æ˜¯å¤åˆç®—æ³•ï¼Œå¹¶ä¸”å¹¶è¡Œå’Œå¹¶å‘å…¼å¤‡ã€‚</p>
<h2 id="åäºŒï¼Œåƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><a href="#åäºŒï¼Œåƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ" class="headerlink" title="åäºŒï¼Œåƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"></a>åäºŒï¼Œåƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</h2><h3 id="1ï¼ŒSystem-gc-çš„ç†è§£"><a href="#1ï¼ŒSystem-gc-çš„ç†è§£" class="headerlink" title="1ï¼ŒSystem.gc()çš„ç†è§£"></a>1ï¼ŒSystem.gc()çš„ç†è§£</h3><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡system.gc()æˆ–è€…Runtime.getRuntime().gc() çš„è°ƒç”¨ï¼Œä¼šæ˜¾å¼è§¦å‘Full GCï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p>
<p>ç„¶è€ŒSystem.gc() è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ã€‚(ä¸èƒ½ç¡®ä¿ç«‹å³ç”Ÿæ•ˆ)</p>
<p>JVMå®ç°è€…å¯ä»¥é€šè¿‡System.gc() è°ƒç”¨æ¥å†³å®šJVMçš„GCè¡Œä¸ºã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶åº”è¯¥æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ— é¡»æ‰‹åŠ¨è§¦å‘ï¼Œå¦åˆ™å°±å¤ªè¿‡äºéº»çƒ¦äº†ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œä¹‹é—´è°ƒç”¨System.gc()ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemGCTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SystemGCTest</span>();</span><br><span class="line">        System.gc();<span class="comment">// æé†’JVMçš„åƒåœ¾å›æ”¶å™¨æ‰§è¡Œgcï¼Œä½†æ˜¯ä¸ç¡®å®šæ˜¯å¦é©¬ä¸Šæ‰§è¡Œgc</span></span><br><span class="line">        <span class="comment">// ä¸Runtime.getRuntime().gc();çš„ä½œç”¨ä¸€æ ·</span></span><br><span class="line">        </span><br><span class="line">        System.runFinalization();<span class="comment">//å¼ºåˆ¶æ‰§è¡Œä½¿ç”¨å¼•ç”¨çš„å¯¹è±¡çš„finalize()æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;SystemGCTest é‡å†™äº†finalize()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ‰‹åŠ¨ç†è§£gcçš„è¡Œä¸º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  14:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalVarGC</span> &#123;</span><br><span class="line">    <span class="comment">//bufferæ²¡æœ‰è¢«åƒåœ¾å›æ”¶ï¼Œæ˜¯å› ä¸ºä»–è¿˜æœ‰å¼•ç”¨æŒ‡å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];<span class="comment">//10MB</span></span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bufferè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œå› ä¸ºä»–æ–­å¼€äº†å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        buffer = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bufferæ²¡æœ‰è¢«åƒåœ¾å›æ”¶ï¼Œå› ä¸ºé€šè¿‡çœ‹å±€éƒ¨å˜é‡è¡¨å¯çŸ¥ï¼Œæœ€åå±€éƒ¨å˜é‡è¡¨æ˜¾ç¤ºçš„åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å› ä¸ºæ§½çš„æœºåˆ¶ï¼Œè¿™ä¸ªå¼•ç”¨ä¾æ—§å­˜åœ¨çš„ï¼Œå³æ§½çš„å¤ç”¨æœºåˆ¶ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC3</span><span class="params">()</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bufferè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™valueå ç”¨äº†è¿™ä¸ªæ§½ï¼Œå¯¼è‡´å…¶å¼•ç”¨ä¸¢å¤±ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC4</span><span class="params">()</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œæ˜¯å› ä¸ºåœ¨æ–¹æ³•ä¸€ä½¿ç”¨å®Œåï¼Œè™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§å¼¹å‡ºï¼Œå¯¼è‡´å…¶å±€éƒ¨å˜é‡è¡¨é”€æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC5</span><span class="params">()</span> &#123;</span><br><span class="line">        localvarGC1();</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LocalVarGC</span> <span class="variable">local</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalVarGC</span>();</span><br><span class="line">        local.localvarGC5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼Œå†…å­˜æº¢å‡ºä¸å†…å­˜æ³„éœ²"><a href="#2ï¼Œå†…å­˜æº¢å‡ºä¸å†…å­˜æ³„éœ²" class="headerlink" title="2ï¼Œå†…å­˜æº¢å‡ºä¸å†…å­˜æ³„éœ²"></a>2ï¼Œå†…å­˜æº¢å‡ºä¸å†…å­˜æ³„éœ²</h3><h4 id="å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰"><a href="#å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰" class="headerlink" title="å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰"></a>å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</h4><p>å†…å­˜æº¢å‡ºç›¸å¯¹äºå†…å­˜æ³„æ¼æ¥è¯´ï¼Œå°½ç®¡æ›´å®¹æ˜“è¢«ç†è§£ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå†…å­˜æº¢å‡ºä¹Ÿæ˜¯å¼•å‘ç¨‹åºå´©æºƒçš„ç½ªé­ç¥¸é¦–ä¹‹ä¸€ã€‚</p>
<p>ç”±äºGCä¸€ç›´åœ¨å‘å±•ï¼Œæ‰€æœ‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤éåº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œé€ æˆåƒåœ¾å›æ”¶å·²ç»è·Ÿä¸ä¸Šå†…å­˜æ¶ˆè€—çš„é€Ÿåº¦ï¼Œå¦åˆ™ä¸å¤ªå®¹æ˜“å‡ºç°ooMçš„æƒ…å†µã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGCä¼šè¿›è¡Œå„ç§å¹´é¾„æ®µçš„åƒåœ¾å›æ”¶ï¼Œå®åœ¨ä¸è¡Œäº†å°±æ”¾å¤§æ‹›ï¼Œæ¥ä¸€æ¬¡ç‹¬å å¼çš„Full GCæ“ä½œï¼Œè¿™æ—¶å€™ä¼šå›æ”¶å¤§é‡çš„å†…å­˜ï¼Œä¾›åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨ã€‚</p>
<p>javadocä¸­å¯¹OutOfMemoryErrorçš„è§£é‡Šæ˜¯ï¼Œ<strong>æ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</strong></p>
<p>é¦–å…ˆè¯´æ²¡æœ‰ç©ºé—²å†…å­˜çš„æƒ…å†µï¼šè¯´æ˜Javaè™šæ‹Ÿæœºçš„å †å†…å­˜ä¸å¤Ÿã€‚åŸå› æœ‰äºŒï¼š</p>
<ol>
<li>Javaè™šæ‹Ÿæœºçš„å †å†…å­˜è®¾ç½®ä¸å¤Ÿã€‚<br> æ¯”å¦‚ï¼šå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼›ä¹Ÿå¾ˆæœ‰å¯èƒ½å°±æ˜¯å †çš„å¤§å°ä¸åˆç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å¤„ç†æ¯”è¾ƒå¯è§‚çš„æ•°æ®é‡ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾å¼æŒ‡å®šJVMå †å¤§å°æˆ–è€…æŒ‡å®šæ•°å€¼åå°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°<code>-Xms</code> ã€<code>-Xmx</code>æ¥è°ƒæ•´ã€‚ </li>
<li>ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†ï¼ˆå­˜åœ¨è¢«å¼•ç”¨ï¼‰<br> å¯¹äºè€ç‰ˆæœ¬çš„Oracle JDKï¼Œå› ä¸ºæ°¸ä¹…ä»£çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”JVMå¯¹æ°¸ä¹…ä»£åƒåœ¾å›æ”¶ï¼ˆå¦‚ï¼Œå¸¸é‡æ± å›æ”¶ã€å¸è½½ä¸å†éœ€è¦çš„ç±»å‹ï¼‰éå¸¸ä¸ç§¯æï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä¸æ–­æ·»åŠ æ–°ç±»å‹çš„æ—¶å€™ï¼Œæ°¸ä¹…ä»£å‡ºç°OutOfMemoryErrorä¹Ÿéå¸¸å¤šè§ï¼Œå°¤å…¶æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨å¤§é‡åŠ¨æ€ç±»å‹ç”Ÿæˆçš„åœºåˆï¼›ç±»ä¼¼internå­—ç¬¦ä¸²ç¼“å­˜å ç”¨å¤ªå¤šç©ºé—´ï¼Œä¹Ÿä¼šå¯¼è‡´OOMé—®é¢˜ã€‚å¯¹åº”çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¼šæ ‡è®°å‡ºæ¥å’Œæ°¸ä¹…ä»£ç›¸å…³ï¼šâ€œ<code>java.lang.OutOfMemoryError: PermGen space</code>â€œã€‚<br> éšç€å…ƒæ•°æ®åŒºçš„å¼•å…¥ï¼Œæ–¹æ³•åŒºå†…å­˜å·²ç»ä¸å†é‚£ä¹ˆçª˜è¿«ï¼Œæ‰€ä»¥ç›¸åº”çš„ooMæœ‰æ‰€æ”¹è§‚ï¼Œå‡ºç°OOMï¼Œå¼‚å¸¸ä¿¡æ¯åˆ™å˜æˆäº†ï¼šâ€œ<code>java.lang.OutofMemoryError:Metaspace</code>â€œã€‚ç›´æ¥å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´OOMã€‚ </li>
</ol>
<p>è¿™é‡Œé¢éšå«ç€ä¸€å±‚æ„æ€æ˜¯ï¼Œåœ¨æŠ›å‡ºOutOfMemoryErrorä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚</p>
<ul>
<li><p>ä¾‹å¦‚ï¼šåœ¨å¼•ç”¨æœºåˆ¶åˆ†æä¸­ï¼Œæ¶‰åŠåˆ°JVMä¼šå»å°è¯•å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ç­‰ã€‚</p>
</li>
<li><p>åœ¨<code>java.nio.BIts.reserveMemory()</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°ï¼Œ<code>System.gc()</code>ä¼šè¢«è°ƒç”¨ï¼Œä»¥æ¸…ç†ç©ºé—´ã€‚</p>
</li>
</ul>
<p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè¢«è§¦å‘çš„</p>
<ul>
<li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å»åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVMå¯ä»¥åˆ¤æ–­å‡ºåƒåœ¾æ”¶é›†å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡ºOutOfMemoryErrorã€‚</li>
</ul>
<h4 id="å†…å­˜æ³„æ¼ï¼ˆMemory-Leakï¼‰"><a href="#å†…å­˜æ³„æ¼ï¼ˆMemory-Leakï¼‰" class="headerlink" title="å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰"></a>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</h4><p>ä¹Ÿç§°ä½œâ€œå­˜å‚¨æ¸—æ¼â€ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œ<strong>åªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µ</strong>ï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</p>
<p>ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´00Mï¼Œä¹Ÿå¯ä»¥å«åš<strong>å®½æ³›æ„ä¹‰ä¸Šçš„â€œå†…å­˜æ³„æ¼â€ã€‚</strong></p>
<p>å°½ç®¡å†…å­˜æ³„æ¼å¹¶ä¸ä¼šç«‹åˆ»å¼•èµ·ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç¨‹åºä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¢«é€æ­¥èš•é£Ÿï¼Œç›´è‡³è€—å°½æ‰€æœ‰å†…å­˜ï¼Œæœ€ç»ˆå‡ºç°OutOfMemoryå¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯æŒ‡ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯æŒ‡è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œè¿™ä¸ªè™šæ‹Ÿå†…å­˜å¤§å°å–å†³äºç£ç›˜äº¤æ¢åŒºè®¾å®šçš„å¤§å°ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228213106235.png" alt="image-20220228213106235" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹</strong></p>
<ol>
<li>å•ä¾‹æ¨¡å¼<br> å•ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºæ˜¯ä¸€æ ·é•¿çš„ï¼Œæ‰€ä»¥å•ä¾‹ç¨‹åºä¸­ï¼Œå¦‚æœæŒæœ‰å¯¹å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„äº§ç”Ÿã€‚ </li>
<li>ä¸€äº›æä¾›closeçš„èµ„æºæœªå…³é—­å¯¼è‡´å†…å­˜æ³„æ¼<br> æ•°æ®åº“è¿æ¥ï¼ˆdataSourse.getConnection() ï¼‰ï¼Œç½‘ç»œè¿æ¥ï¼ˆsocketï¼‰å’Œioè¿æ¥å¿…é¡»æ‰‹åŠ¨closeï¼Œå¦åˆ™æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ã€‚ </li>
</ol>
<h3 id="3ï¼ŒStop-The-World"><a href="#3ï¼ŒStop-The-World" class="headerlink" title="3ï¼ŒStop The World"></a>3ï¼ŒStop The World</h3><p>Stop-the-Worldï¼Œç®€ç§°STWï¼ŒæŒ‡çš„æ˜¯GCäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ã€‚åœé¡¿äº§ç”Ÿæ—¶æ•´ä¸ªåº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œæ²¡æœ‰ä»»ä½•å“åº”ï¼Œæœ‰ç‚¹åƒå¡æ­»çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªåœé¡¿ç§°ä¸ºSTWã€‚</p>
<p>å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­æšä¸¾æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ä¼šå¯¼è‡´æ‰€æœ‰Javaæ‰§è¡Œçº¿ç¨‹åœé¡¿ã€‚</p>
<ul>
<li><p>åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œ</p>
</li>
<li><p>ä¸€è‡´æ€§æŒ‡æ•´ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š</p>
</li>
<li><p>å¦‚æœå‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœçš„å‡†ç¡®æ€§æ— æ³•ä¿è¯</p>
</li>
</ul>
<p>è¢«STWä¸­æ–­çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ä¼šåœ¨å®ŒæˆGCä¹‹åæ¢å¤ï¼Œé¢‘ç¹ä¸­æ–­ä¼šè®©ç”¨æˆ·æ„Ÿè§‰åƒæ˜¯ç½‘é€Ÿä¸å¿«é€ æˆç”µå½±å¡å¸¦ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘STWçš„å‘ç”Ÿã€‚</p>
<p>STWäº‹ä»¶å’Œé‡‡ç”¨å“ªæ¬¾GCæ— å…³ï¼Œæ‰€æœ‰çš„GCéƒ½æœ‰è¿™ä¸ªäº‹ä»¶ã€‚</p>
<p>å“ªæ€•æ˜¯G1ä¹Ÿä¸èƒ½å®Œå…¨é¿å…Stop-the-Worldæƒ…å†µå‘ç”Ÿï¼Œåªèƒ½è¯´åƒåœ¾å›æ”¶å™¨è¶Šæ¥è¶Šä¼˜ç§€ï¼Œå›æ”¶æ•ˆç‡è¶Šæ¥è¶Šé«˜ï¼Œå°½å¯èƒ½åœ°ç¼©çŸ­äº†æš‚åœæ—¶é—´ã€‚</p>
<p>STWæ˜¯JVMåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„ã€‚åœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹ï¼ŒæŠŠç”¨æˆ·æ­£å¸¸çš„å·¥ä½œçº¿ç¨‹å…¨éƒ¨åœæ‰ã€‚</p>
<p>å¼€å‘ä¸­ä¸è¦ç”¨System.gc() ä¼šå¯¼è‡´Stop-the-Worldçš„å‘ç”Ÿã€‚</p>
<p><strong>ä»£ç æ¼”ç¤º</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  15:50</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> æ­£å¸¸æ˜¯ä¸€ç§’æ‰“å°ä¸€æ¬¡æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºSTWçš„å­˜åœ¨ï¼Œæ‰€ä»¥æ‰“å°æ—¶é—´ä¼šæ”¹å˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopTheWorldDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WorkThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        List&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;<span class="type">byte</span>[]&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">1000</span>;i++)&#123;</span><br><span class="line">                        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                        list.add(buffer);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(list.size() &gt; <span class="number">10000</span>)&#123;</span><br><span class="line">                        list.clear();</span><br><span class="line">                        System.gc();<span class="comment">//ä¼šè§¦å‘full gcï¼Œè¿›è€Œä¼šå‡ºç°STWäº‹ä»¶</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PrintThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ¯ç§’æ‰“å°æ—¶é—´ä¿¡æ¯</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">                    System.out.println(t / <span class="number">1000</span> + <span class="string">&quot;.&quot;</span> + t % <span class="number">1000</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WorkThread</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkThread</span>();</span><br><span class="line">        <span class="type">PrintThread</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintThread</span>();</span><br><span class="line">        w.start();</span><br><span class="line">        p.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4ï¼Œåƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘"><a href="#4ï¼Œåƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="4ï¼Œåƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘"></a>4ï¼Œåƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</h3><h4 id="å¹¶å‘ï¼ˆConcurrentï¼‰"><a href="#å¹¶å‘ï¼ˆConcurrentï¼‰" class="headerlink" title="å¹¶å‘ï¼ˆConcurrentï¼‰"></a>å¹¶å‘ï¼ˆConcurrentï¼‰</h4><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™å‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œã€‚</p>
<p>å¹¶å‘ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œåŒæ—¶è¿›è¡Œâ€ï¼Œåªæ˜¯CPUæŠŠä¸€ä¸ªæ—¶é—´æ®µåˆ’åˆ†æˆå‡ ä¸ªæ—¶é—´ç‰‡æ®µï¼ˆæ—¶é—´åŒºé—´ï¼‰ï¼Œç„¶ååœ¨è¿™å‡ ä¸ªæ—¶é—´åŒºé—´ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œç”±äºCPUå¤„ç†çš„é€Ÿåº¦éå¸¸å¿«ï¼Œåªè¦æ—¶é—´é—´éš”å¤„ç†å¾—å½“ï¼Œå³å¯è®©ç”¨æˆ·æ„Ÿè§‰æ˜¯å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶åœ¨è¿›è¡Œã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228215125493.png" alt="image-20220228215125493" loading="lazy"></p>
<h4 id="å¹¶è¡Œï¼ˆParallelï¼‰"><a href="#å¹¶è¡Œï¼ˆParallelï¼‰" class="headerlink" title="å¹¶è¡Œï¼ˆParallelï¼‰"></a>å¹¶è¡Œï¼ˆParallelï¼‰</h4><p>å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸ŠCPUæ—¶ï¼Œå½“ä¸€ä¸ªCPUæ‰§è¡Œä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ªCPUå¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸¤ä¸ªè¿›ç¨‹äº’ä¸æŠ¢å CPUèµ„æºï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œï¼ˆParallelï¼‰ã€‚</p>
<p>å…¶å®å†³å®šå¹¶è¡Œçš„å› ç´ ä¸æ˜¯CPUçš„æ•°é‡ï¼Œè€Œæ˜¯CPUçš„æ ¸å¿ƒæ•°é‡ï¼Œæ¯”å¦‚ä¸€ä¸ªCPUå¤šä¸ªæ ¸ä¹Ÿå¯ä»¥å¹¶è¡Œã€‚</p>
<p>é€‚åˆç§‘å­¦è®¡ç®—ï¼Œåå°å¤„ç†ç­‰å¼±äº¤äº’åœºæ™¯ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228215600498.png" alt="image-20220228215600498" loading="lazy"></p>
<h4 id="å¹¶å‘-vs-å¹¶è¡Œ"><a href="#å¹¶å‘-vs-å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ vs å¹¶è¡Œ"></a>å¹¶å‘ vs å¹¶è¡Œ</h4><ul>
<li><p> å¹¶å‘ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿäº†ã€‚ </p>
</li>
<li><p> å¹¶è¡Œï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹ä¸ŠåŒæ—¶å‘ç”Ÿäº†ã€‚ </p>
</li>
<li><p> å¹¶å‘çš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯äº’ç›¸æŠ¢å èµ„æºçš„ã€‚ </p>
</li>
<li><p> å¹¶è¡Œçš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯ä¸äº’ç›¸æŠ¢å èµ„æºçš„ã€‚ </p>
</li>
<li><p> åªæœ‰åœ¨å¤šCPUæˆ–è€…ä¸€ä¸ªCPUå¤šæ ¸çš„æƒ…å†µä¸­ï¼Œæ‰ä¼šå‘ç”Ÿå¹¶è¡Œã€‚ </p>
</li>
<li><p> å¦åˆ™ï¼Œçœ‹ä¼¼åŒæ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼Œå…¶å®éƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚ </p>
</li>
</ul>
<h4 id="åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ"><a href="#åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ"></a>åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ</h4><p>å¹¶å‘å’Œå¹¶è¡Œï¼Œåœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œå®ƒä»¬å¯ä»¥è§£é‡Šå¦‚ä¸‹ï¼š</p>
<p><strong>å¹¶è¡Œï¼ˆParallelï¼‰</strong></p>
<p>æŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚ParNewã€Parallel Scavengeã€Parallel Oldï¼›</p>
<p><strong>ä¸²è¡Œï¼ˆSerialï¼‰</strong></p>
<p>ç›¸è¾ƒäºå¹¶è¡Œçš„æ¦‚å¿µï¼Œå•çº¿ç¨‹æ‰§è¡Œã€‚å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™ç¨‹åºæš‚åœï¼Œå¯åŠ¨JMåƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å›æ”¶å®Œï¼Œå†å¯åŠ¨ç¨‹åºçš„çº¿ç¨‹ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228215815821.png" alt="image-20220228215815821" loading="lazy"></p>
<p><strong>å¹¶å‘ï¼ˆConcurrentï¼‰</strong></p>
<p>æŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä¼šåœé¡¿ç”¨æˆ·ç¨‹åºçš„è¿è¡Œã€‚ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºçº¿ç¨‹è¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Šï¼›å¦‚ï¼šCMSã€G1</p>
<p><img src="/2022/04/18/JVM/image-20220228215856361.png" alt="image-20220228215856361" loading="lazy"></p>
<h3 id="5ï¼Œå®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ"><a href="#5ï¼Œå®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" class="headerlink" title="5ï¼Œå®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ"></a>5ï¼Œå®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</h3><h4 id="å®‰å…¨ç‚¹"><a href="#å®‰å…¨ç‚¹" class="headerlink" title="å®‰å…¨ç‚¹"></a>å®‰å…¨ç‚¹</h4><p>ç¨‹åºæ‰§è¡Œæ—¶å¹¶éåœ¨æ‰€æœ‰åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰åœ¨ç‰¹å®šçš„ä½ç½®æ‰èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œè¿™äº›ä½ç½®ç§°ä¸ºâ€œå®‰å…¨ç‚¹ï¼ˆSafepointï¼‰â€ã€‚</p>
<p>Safe Pointçš„é€‰æ‹©å¾ˆé‡è¦ï¼Œå¦‚æœå¤ªå°‘å¯èƒ½å¯¼è‡´GCç­‰å¾…çš„æ—¶é—´å¤ªé•¿ï¼Œå¦‚æœå¤ªé¢‘ç¹å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶çš„æ€§èƒ½é—®é¢˜ã€‚å¤§éƒ¨åˆ†æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´éƒ½éå¸¸çŸ­æš‚ï¼Œé€šå¸¸ä¼šæ ¹æ®â€œæ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾â€ä¸ºæ ‡å‡†ã€‚æ¯”å¦‚ï¼šé€‰æ‹©ä¸€äº›æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æŒ‡ä»¤ä½œä¸ºSafe Pointï¼Œå¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬å’Œå¼‚å¸¸è·³è½¬ç­‰ã€‚</p>
<p>å¦‚ä½•åœ¨GCå‘ç”Ÿæ—¶ï¼Œæ£€æŸ¥æ‰€æœ‰çº¿ç¨‹éƒ½è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹åœé¡¿ä¸‹æ¥å‘¢ï¼Ÿ</p>
<p><strong>æŠ¢å…ˆå¼ä¸­æ–­ï¼šï¼ˆç›®å‰æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨äº†ï¼‰</strong></p>
<ul>
<li>é¦–å…ˆä¸­æ–­æ‰€æœ‰çº¿ç¨‹ã€‚å¦‚æœè¿˜æœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ã€‚\</li>
</ul>
<p><strong>ä¸»åŠ¨å¼ä¸­æ–­</strong></p>
<ul>
<li>è®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹è¿è¡Œåˆ°Safe Pointçš„æ—¶å€™ä¸»åŠ¨è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå¦‚æœä¸­æ–­æ ‡å¿—ä¸ºçœŸï¼Œåˆ™å°†è‡ªå·±è¿›è¡Œä¸­æ–­æŒ‚èµ·ã€‚ï¼ˆæœ‰è½®è¯¢çš„æœºåˆ¶ï¼‰</li>
</ul>
<h4 id="å®‰å…¨åŒºåŸŸï¼ˆSafe-Resionï¼‰"><a href="#å®‰å…¨åŒºåŸŸï¼ˆSafe-Resionï¼‰" class="headerlink" title="å®‰å…¨åŒºåŸŸï¼ˆSafe Resionï¼‰"></a>å®‰å…¨åŒºåŸŸï¼ˆSafe Resionï¼‰</h4><p>Safepoint æœºåˆ¶ä¿è¯äº†ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåœ¨ä¸å¤ªé•¿çš„æ—¶é—´å†…å°±ä¼šé‡åˆ°å¯è¿›å…¥GCçš„Safepointã€‚ä½†æ˜¯ï¼Œç¨‹åºâ€œä¸æ‰§è¡Œâ€çš„æ—¶å€™å‘¢ï¼Ÿä¾‹å¦‚çº¿ç¨‹å¤„äºSleep çŠ¶æ€æˆ–Blocked çŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº”JVMçš„ä¸­æ–­è¯·æ±‚ï¼Œâ€œèµ°â€åˆ°å®‰å…¨ç‚¹å»ä¸­æ–­æŒ‚èµ·ï¼ŒJVMä¹Ÿä¸å¤ªå¯èƒ½ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰æ¥è§£å†³ã€‚</p>
<p><strong>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»»ä½•ä½ç½®å¼€å§‹Gcéƒ½æ˜¯å®‰å…¨çš„ã€‚</strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠSafe Regionçœ‹åšæ˜¯è¢«æ‰©å±•äº†çš„Safepointã€‚</p>
<p><strong>å®é™…æ‰§è¡Œæ—¶ï¼š</strong></p>
<ol>
<li>å½“çº¿ç¨‹è¿è¡Œåˆ°Safe Regionçš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†å·²ç»è¿›å…¥äº†Safe Relgionï¼Œå¦‚æœè¿™æ®µæ—¶é—´å†…å‘ç”ŸGCï¼ŒJVMä¼šå¿½ç•¥æ ‡è¯†ä¸ºSafe RegionçŠ¶æ€çš„çº¿ç¨‹</li>
<li>å½“çº¿ç¨‹å³å°†ç¦»å¼€Safe Regionæ—¶ï¼Œä¼šæ£€æŸ¥JVMæ˜¯å¦å·²ç»å®ŒæˆGCï¼Œå¦‚æœå®Œæˆäº†ï¼Œåˆ™ç»§ç»­è¿è¡Œï¼Œå¦åˆ™çº¿ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€Safe Regionçš„ä¿¡å·ä¸ºæ­¢ï¼›</li>
</ol>
<h3 id="6ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨"><a href="#6ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨" class="headerlink" title="6ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨"></a>6ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼ºå¼•ç”¨</h3><p>æˆ‘ä»¬å¸Œæœ›èƒ½æè¿°è¿™æ ·ä¸€ç±»å¯¹è±¡ï¼šå½“å†…å­˜ç©ºé—´è¿˜è¶³å¤Ÿæ—¶ï¼Œåˆ™èƒ½ä¿ç•™åœ¨å†…å­˜ä¸­ï¼›å¦‚æœå†…å­˜ç©ºé—´åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†åè¿˜æ˜¯å¾ˆç´§å¼ ï¼Œåˆ™å¯ä»¥æŠ›å¼ƒè¿™äº›å¯¹è±¡ã€‚</p>
<p>ã€æ—¢åé—¨åˆéå¸¸é«˜é¢‘çš„é¢è¯•é¢˜ã€‘å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…·ä½“ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>åœ¨JDK1.2ç‰ˆä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºï¼šå¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ã€è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰è¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚</p>
<p>é™¤å¼ºå¼•ç”¨å¤–ï¼Œå…¶ä»–3ç§å¼•ç”¨å‡å¯ä»¥åœ¨java.lang.refåŒ…ä¸­æ‰¾åˆ°å®ƒä»¬çš„èº«å½±ã€‚å¦‚ä¸‹å›¾ï¼Œæ˜¾ç¤ºäº†è¿™3ç§å¼•ç”¨ç±»å‹å¯¹åº”çš„ç±»ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220228222137617.png" alt="image-20220228222137617" loading="lazy"></p>
<p>Referenceå­ç±»ä¸­åªæœ‰ç»ˆç»“å™¨å¼•ç”¨æ˜¯åŒ…å†…å¯è§çš„ï¼Œå…¶ä»–3ç§å¼•ç”¨ç±»å‹å‡ä¸ºpublicï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨</p>
<ul>
<li><p><strong>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</strong>ï¼šæœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼â€œ<code>Object obj = new Object()</code>â€è¿™ç§å¼•ç”¨å…³ç³»ã€‚<strong>æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡</strong>ã€‚</p>
</li>
<li><p><strong>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</strong>ï¼šåœ¨<strong>ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—å…¥å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶</strong>ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æµå‡ºå¼‚å¸¸ã€‚</p>
</li>
<li><p><strong>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong>ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½<strong>ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰</strong>ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p>
</li>
<li><p><strong>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</strong>ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å¾—ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨<strong>è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</strong></p>
</li>
</ul>
<h4 id="å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰â€”â€”ä¸å›æ”¶"><a href="#å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰â€”â€”ä¸å›æ”¶" class="headerlink" title="å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰â€”â€”ä¸å›æ”¶"></a>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰â€”â€”ä¸å›æ”¶</h4><p>åœ¨Javaç¨‹åºä¸­ï¼Œæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹æ˜¯å¼ºå¼•ç”¨ï¼ˆæ™®é€šç³»ç»Ÿ99%ä»¥ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œä¹Ÿæ˜¯<strong>é»˜è®¤çš„å¼•ç”¨ç±»å‹ã€‚</strong></p>
<p>å½“åœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å°±æˆä¸ºæŒ‡å‘è¯¥å¯¹è±¡çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p>
<p><strong>å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯å¯è§¦åŠçš„ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</strong></p>
<p>å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸ºnu11ï¼Œå°±æ˜¯å¯ä»¥å½“åšåƒåœ¾è¢«æ”¶é›†äº†ï¼Œå½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥ã€‚</p>
<p>ç›¸å¯¹çš„ï¼Œè½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨çš„å¯¹è±¡æ˜¯è½¯å¯è§¦åŠã€å¼±å¯è§¦åŠå’Œè™šå¯è§¦åŠçš„ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œéƒ½æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚æ‰€ä»¥ï¼Œ<strong>å¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrongReferenceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span> (<span class="string">&quot;Hello,å°šç¡…è°·&quot;</span>);</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">str1</span> <span class="operator">=</span> str;</span><br><span class="line"></span><br><span class="line">        str = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        System.out.println(str1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220228222738557.png" alt="image-20220228222738557" loading="lazy"></p>
<p>æœ¬ä¾‹ä¸­çš„ä¸¤ä¸ªå¼•ç”¨ï¼Œéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå¼ºå¼•ç”¨å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>å¼ºå¼•ç”¨å¯ä»¥ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚</p>
</li>
<li><p>å¼ºå¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œè™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOOMå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡ã€‚</p>
</li>
<li><p>å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
</li>
</ul>
<h3 id="7ï¼Œå†è°ˆå¼•ç”¨ï¼š-è½¯å¼•ç”¨"><a href="#7ï¼Œå†è°ˆå¼•ç”¨ï¼š-è½¯å¼•ç”¨" class="headerlink" title="7ï¼Œå†è°ˆå¼•ç”¨ï¼š è½¯å¼•ç”¨"></a>7ï¼Œå†è°ˆå¼•ç”¨ï¼š è½¯å¼•ç”¨</h3><h4 id="è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶"><a href="#è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶" class="headerlink" title="è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶"></a>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶</h4><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…éœ€çš„å¯¹è±¡ã€‚åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p>
<p>è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚æ¯”å¦‚ï¼šé«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ã€‚å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚</p>
<p>åƒåœ¾å›æ”¶å™¨åœ¨æŸä¸ªæ—¶åˆ»å†³å®šå›æ”¶è½¯å¯è¾¾çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šæ¸…ç†è½¯å¼•ç”¨ï¼Œå¹¶å¯é€‰åœ°æŠŠå¼•ç”¨å­˜æ”¾åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReference Queueï¼‰ã€‚</p>
<p>ç±»ä¼¼å¼±å¼•ç”¨ï¼Œåªä¸è¿‡Javaè™šæ‹Ÿæœºä¼šå°½é‡è®©è½¯å¼•ç”¨çš„å­˜æ´»æ—¶é—´é•¿ä¸€äº›ï¼Œè¿«ä¸å¾—å·²æ‰æ¸…ç†ã€‚</p>
<p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†java.lang.ref.SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// å£°æ˜å¼ºå¼•ç”¨</span></span><br><span class="line">SoftReference&lt;Object&gt; sf = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(obj);</span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">//é”€æ¯å¼ºå¼•ç”¨</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>ä»£ç å®ç°ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.ref.SoftReference;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¯å¼•ç”¨çš„æµ‹è¯•ï¼šå†…å­˜ä¸è¶³å³å›æ”¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  16:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoftReferenceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.id = id;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;] &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡ï¼Œå»ºç«‹è½¯å¼•ç”¨</span></span><br><span class="line"><span class="comment">//        SoftReference&lt;User&gt; userSoftRef = new SoftReference&lt;User&gt;(new User(1, &quot;songhk&quot;));</span></span><br><span class="line">        <span class="comment">//ä¸Šé¢çš„ä¸€è¡Œä»£ç ï¼Œç­‰ä»·äºå¦‚ä¸‹çš„ä¸‰è¡Œä»£ç </span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>,<span class="string">&quot;songhk&quot;</span>);</span><br><span class="line">        SoftReference&lt;User&gt; userSoftRef = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;User&gt;(u1);</span><br><span class="line">        u1 = <span class="literal">null</span>;<span class="comment">//å–æ¶ˆå¼ºå¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä»è½¯å¼•ç”¨ä¸­é‡æ–°è·å¾—å¼ºå¼•ç”¨å¯¹è±¡</span></span><br><span class="line">        System.out.println(userSoftRef.get());</span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">&quot;After GC:&quot;</span>);</span><br><span class="line"><span class="comment">//        //åƒåœ¾å›æ”¶ä¹‹åè·å¾—è½¯å¼•ç”¨ä¸­çš„å¯¹è±¡</span></span><br><span class="line">        System.out.println(userSoftRef.get());<span class="comment">//ç”±äºå †ç©ºé—´å†…å­˜è¶³å¤Ÿï¼Œæ‰€æœ‰ä¸ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è®©ç³»ç»Ÿè®¤ä¸ºå†…å­˜èµ„æºç´§å¼ ã€ä¸å¤Ÿ</span></span><br><span class="line"><span class="comment">//            byte[] b = new byte[1024 * 1024 * 7];</span></span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">7168</span> - <span class="number">635</span> * <span class="number">1024</span>];</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//å†æ¬¡ä»è½¯å¼•ç”¨ä¸­è·å–æ•°æ®</span></span><br><span class="line">            System.out.println(userSoftRef.get());<span class="comment">//åœ¨æŠ¥OOMä¹‹å‰ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨"><a href="#8ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨" class="headerlink" title="8ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨"></a>8ï¼Œå†è°ˆå¼•ç”¨ï¼šå¼±å¼•ç”¨</h3><h4 id="å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶"><a href="#å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶" class="headerlink" title="å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶"></a>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶</h4><p>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°é‚£äº›éå¿…éœ€å¯¹è±¡ï¼Œ<strong>åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢</strong>ã€‚åœ¨ç³»ç»ŸGCæ—¶ï¼Œåªè¦å‘ç°å¼±å¼•ç”¨ï¼Œä¸ç®¡ç³»ç»Ÿå †ç©ºé—´ä½¿ç”¨æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹é€šå¸¸ä¼˜å…ˆçº§å¾ˆä½ï¼Œå› æ­¤ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾ˆå¿«åœ°å‘ç°æŒæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>å¼±å¼•ç”¨å¯¹è±¡å¯ä»¥å­˜åœ¨è¾ƒé•¿çš„æ—¶é—´ã€‚</strong></p>
<p>å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨ä¸€æ ·ï¼Œåœ¨æ„é€ å¼±å¼•ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¼±å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå°±ä¼šåŠ å…¥æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p>
<p><strong>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨éƒ½éå¸¸é€‚åˆæ¥ä¿å­˜é‚£äº›å¯æœ‰å¯æ— çš„ç¼“å­˜æ•°æ®ã€‚</strong>å¦‚æœè¿™ä¹ˆåšï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®ä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è€Œå½“å†…å­˜èµ„æºå……è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®åˆå¯ä»¥å­˜åœ¨ç›¸å½“é•¿çš„æ—¶é—´ï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿç³»ç»Ÿçš„ä½œç”¨ã€‚</p>
<p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// å£°æ˜å¼ºå¼•ç”¨</span></span><br><span class="line">WeakReference&lt;Object&gt; sf = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(obj);</span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">//é”€æ¯å¼ºå¼•ç”¨</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¼±å¼•ç”¨å¯¹è±¡ä¸è½¯å¼•ç”¨å¯¹è±¡çš„æœ€å¤§ä¸åŒå°±åœ¨äºï¼Œå½“GCåœ¨è¿›è¡Œå›æ”¶æ—¶ï¼Œéœ€è¦é€šè¿‡ç®—æ³•æ£€æŸ¥æ˜¯å¦å›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œè€Œå¯¹äºå¼±å¼•ç”¨å¯¹è±¡ï¼ŒGCæ€»æ˜¯è¿›è¡Œå›æ”¶ã€‚å¼±å¼•ç”¨å¯¹è±¡æ›´å®¹æ˜“ã€æ›´å¿«è¢«GCå›æ”¶ã€‚</p>
<p><strong>é¢è¯•é¢˜ï¼šä½ å¼€å‘ä¸­ä½¿ç”¨è¿‡WeakHashMapå—ï¼Ÿ</strong></p>
<p>WeakHashMapç”¨æ¥å­˜å‚¨å›¾ç‰‡ä¿¡æ¯ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒåŠæ—¶å›æ”¶ï¼Œé¿å…äº†OOM</p>
<p><strong>ä»£ç å®ç°ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼±å¼•ç”¨çš„æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  16:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeakReferenceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.id = id;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;] &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//æ„é€ äº†å¼±å¼•ç”¨</span></span><br><span class="line">        WeakReference&lt;User&gt; userWeakRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;User&gt;(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;songhk&quot;</span>));</span><br><span class="line">        <span class="comment">//ä»å¼±å¼•ç”¨ä¸­é‡æ–°è·å–å¯¹è±¡</span></span><br><span class="line">        System.out.println(userWeakRef.get());</span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// ä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜</span></span><br><span class="line">        System.out.println(<span class="string">&quot;After GC:&quot;</span>);</span><br><span class="line">        <span class="comment">//é‡æ–°å°è¯•ä»å¼±å¼•ç”¨ä¸­è·å–å¯¹è±¡</span></span><br><span class="line">        System.out.println(userWeakRef.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9ï¼Œå†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨"><a href="#9ï¼Œå†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨" class="headerlink" title="9ï¼Œå†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨"></a>9ï¼Œå†è°ˆå¼•ç”¨ï¼šè™šå¼•ç”¨</h3><h4 id="è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª"><a href="#è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª" class="headerlink" title="è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª"></a>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª</h4><p>ä¹Ÿç§°ä¸ºâ€œå¹½çµå¼•ç”¨â€æˆ–è€…â€œå¹»å½±å¼•ç”¨â€ï¼Œæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ä¸ªã€‚</p>
<p>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéšæ—¶éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>
<p><strong>å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å½“è¯•å›¾é€šè¿‡è™šå¼•ç”¨çš„get()æ–¹æ³•å–å¾—å¯¹è±¡æ—¶ï¼Œæ€»æ˜¯null</strong></p>
<p><strong>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</strong>æ¯”å¦‚ï¼šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p>
<p><strong>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚è™šå¼•ç”¨åœ¨åˆ›å»ºæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä½œä¸ºå‚æ•°ã€‚</strong>å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡åï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p>
<p><strong>ç”±äºè™šå¼•ç”¨å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æ—¶é—´ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œæ”¾ç½®åœ¨è™šå¼•ç”¨ä¸­æ‰§è¡Œå’Œè®°å½•ã€‚</strong></p>
<p>åœ¨JDK1.2ç‰ˆä¹‹åæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// å£°æ˜å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">phantomQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line">PhantomReference&lt;Object&gt; sf = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(obj, phantomQueue);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä»£ç å®ç°ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è™šå¼•ç”¨çš„æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  16:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhantomReferenceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PhantomReferenceTest obj;<span class="comment">//å½“å‰ç±»å¯¹è±¡çš„å£°æ˜</span></span><br><span class="line">    <span class="keyword">static</span> ReferenceQueue&lt;PhantomReferenceTest&gt; phantomQueue = <span class="literal">null</span>;<span class="comment">//å¼•ç”¨é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CheckRefQueue</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (phantomQueue != <span class="literal">null</span>) &#123;</span><br><span class="line">                    PhantomReference&lt;PhantomReferenceTest&gt; objt = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        objt = (PhantomReference&lt;PhantomReferenceTest&gt;) phantomQueue.remove();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (objt != <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;è¿½è¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼šPhantomReferenceTestå®ä¾‹è¢«GCäº†&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; <span class="comment">//finalize()æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼</span></span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å½“å‰ç±»çš„finalize()æ–¹æ³•&quot;</span>);</span><br><span class="line">        obj = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CheckRefQueue</span>();</span><br><span class="line">        t.setDaemon(<span class="literal">true</span>);<span class="comment">//è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼šå½“ç¨‹åºä¸­æ²¡æœ‰éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±æ‰§è¡Œç»“æŸã€‚</span></span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        phantomQueue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;PhantomReferenceTest&gt;();</span><br><span class="line">        obj = <span class="keyword">new</span> <span class="title class_">PhantomReferenceTest</span>();</span><br><span class="line">        <span class="comment">//æ„é€ äº† PhantomReferenceTest å¯¹è±¡çš„è™šå¼•ç”¨ï¼Œå¹¶æŒ‡å®šäº†å¼•ç”¨é˜Ÿåˆ—</span></span><br><span class="line">        PhantomReference&lt;PhantomReferenceTest&gt; phantomRef = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;PhantomReferenceTest&gt;(obj, phantomQueue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//ä¸å¯è·å–è™šå¼•ç”¨ä¸­çš„å¯¹è±¡</span></span><br><span class="line">            System.out.println(phantomRef.get());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å°†å¼ºå¼•ç”¨å»é™¤</span></span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//ç¬¬ä¸€æ¬¡è¿›è¡ŒGC,ç”±äºå¯¹è±¡å¯å¤æ´»ï¼ŒGCæ— æ³•å›æ”¶è¯¥å¯¹è±¡</span></span><br><span class="line">            System.gc();</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj æ˜¯ null&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj å¯ç”¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¬¬ 2 æ¬¡ gc&quot;</span>);</span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            System.gc(); <span class="comment">//ä¸€æ—¦å°†objå¯¹è±¡å›æ”¶ï¼Œå°±ä¼šå°†æ­¤è™šå¼•ç”¨å­˜æ”¾åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj æ˜¯ null&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj å¯ç”¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10ï¼Œç»ˆç»“å™¨å¼•ç”¨"><a href="#10ï¼Œç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="10ï¼Œç»ˆç»“å™¨å¼•ç”¨"></a>10ï¼Œç»ˆç»“å™¨å¼•ç”¨</h3><p>å®ƒç”¨äºå®ç°å¯¹è±¡çš„finalize() æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç»ˆç»“å™¨å¼•ç”¨ã€‚æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œå…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ã€‚</p>
<p>åœ¨GCæ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿã€‚ç”±Finalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡è°ƒç”¨å®ƒçš„finalize()æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡GCæ—¶æ‰å›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<h2 id="åä¸‰ï¼Œåƒåœ¾å›æ”¶å™¨"><a href="#åä¸‰ï¼Œåƒåœ¾å›æ”¶å™¨" class="headerlink" title="åä¸‰ï¼Œåƒåœ¾å›æ”¶å™¨"></a>åä¸‰ï¼Œåƒåœ¾å›æ”¶å™¨</h2><h3 id="1ï¼ŒGCåˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡"><a href="#1ï¼ŒGCåˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="1ï¼ŒGCåˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡"></a>1ï¼ŒGCåˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡</h3><h4 id="1-1ï¼Œåƒåœ¾å›æ”¶å™¨æ¦‚è¿°"><a href="#1-1ï¼Œåƒåœ¾å›æ”¶å™¨æ¦‚è¿°" class="headerlink" title="1.1ï¼Œåƒåœ¾å›æ”¶å™¨æ¦‚è¿°"></a>1.1ï¼Œåƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h4><p>åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰åœ¨è§„èŒƒä¸­è¿›è¡Œè¿‡å¤šçš„è§„å®šï¼Œå¯ä»¥ç”±ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„JVMæ¥å®ç°ã€‚</p>
<p>ç”±äºJDKçš„ç‰ˆæœ¬å¤„äºé«˜é€Ÿè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå› æ­¤Javaå‘å±•è‡³ä»Šå·²ç»è¡ç”Ÿäº†ä¼—å¤šçš„GCç‰ˆæœ¬ã€‚</p>
<p>ä»ä¸åŒè§’åº¦åˆ†æåƒåœ¾æ”¶é›†å™¨ï¼Œå¯ä»¥å°†GCåˆ†ä¸ºä¸åŒçš„ç±»å‹ã€‚</p>
<h4 id="1-2ï¼Œåƒåœ¾æ”¶é›†å™¨åˆ†ç±»"><a href="#1-2ï¼Œåƒåœ¾æ”¶é›†å™¨åˆ†ç±»" class="headerlink" title="1.2ï¼Œåƒåœ¾æ”¶é›†å™¨åˆ†ç±»"></a>1.2ï¼Œåƒåœ¾æ”¶é›†å™¨åˆ†ç±»</h4><p>æŒ‰çº¿ç¨‹æ•°åˆ†ï¼Œå¯ä»¥åˆ†ä¸º<strong>ä¸²è¡Œåƒåœ¾å›æ”¶å™¨å’Œå¹¶è¡Œåƒåœ¾å›æ”¶å™¨ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220301165120165.png" alt="image-20220301165120165" loading="lazy"></p>
<p>ä¸²è¡Œå›æ”¶æŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶é—´æ®µå†…åªå…è®¸æœ‰ä¸€ä¸ªCPUç”¨äºæ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ­¤æ—¶å·¥ä½œçº¿ç¨‹è¢«æš‚åœï¼Œç›´è‡³åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚</p>
<ul>
<li><p>åœ¨è¯¸å¦‚å•CPUå¤„ç†å™¨æˆ–è€…è¾ƒå°çš„åº”ç”¨å†…å­˜ç­‰ç¡¬ä»¶å¹³å°ä¸æ˜¯ç‰¹åˆ«ä¼˜è¶Šçš„åœºåˆï¼Œä¸²è¡Œå›æ”¶å™¨çš„æ€§èƒ½è¡¨ç°å¯ä»¥è¶…è¿‡å¹¶è¡Œå›æ”¶å™¨å’Œå¹¶å‘å›æ”¶å™¨ã€‚æ‰€ä»¥ï¼Œä¸²è¡Œå›æ”¶é»˜è®¤è¢«åº”ç”¨åœ¨å®¢æˆ·ç«¯çš„Clientæ¨¡å¼ä¸‹çš„JVMä¸­</p>
</li>
<li><p>åœ¨å¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„CPUä¸Šï¼Œå¹¶è¡Œå›æ”¶å™¨äº§ç”Ÿçš„åœé¡¿æ—¶é—´è¦çŸ­äºä¸²è¡Œå›æ”¶å™¨ã€‚</p>
</li>
</ul>
<p>å’Œä¸²è¡Œå›æ”¶ç›¸åï¼Œå¹¶è¡Œæ”¶é›†å¯ä»¥è¿ç”¨å¤šä¸ªCPUåŒæ—¶æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œå› æ­¤æå‡äº†åº”ç”¨çš„ååé‡ï¼Œä¸è¿‡å¹¶è¡Œå›æ”¶ä»ç„¶ä¸ä¸²è¡Œå›æ”¶ä¸€æ ·ï¼Œé‡‡ç”¨ç‹¬å å¼ï¼Œä½¿ç”¨äº†â€œStop-the-Worldâ€æœºåˆ¶ã€‚</p>
<p>æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºå¹¶å‘å¼åƒåœ¾å›æ”¶å™¨å’Œç‹¬å å¼åƒåœ¾å›æ”¶å™¨ã€‚</p>
<ul>
<li><p>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ã€‚</p>
</li>
<li><p>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨ï¼ˆStop the worldï¼‰ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220301165231582.png" alt="image-20220301165231582" loading="lazy"></p>
<p>æŒ‰ç¢ç‰‡å¤„ç†æ–¹å¼åˆ†ï¼Œå¯åˆ†ä¸ºå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨å’Œéå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ã€‚</p>
<ul>
<li><p>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ã€‚</p>
</li>
<li><p>éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œã€‚</p>
</li>
</ul>
<p>æŒ‰å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ï¼Œåˆå¯åˆ†ä¸ºå¹´è½»ä»£åƒåœ¾å›æ”¶å™¨å’Œè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</p>
<h4 id="1-3ï¼Œè¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡"><a href="#1-3ï¼Œè¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="1.3ï¼Œè¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡"></a>1.3ï¼Œè¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡</h4><ul>
<li><p><strong>ååé‡</strong>ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ï¼ˆæ€»è¿è¡Œæ—¶é—´ = ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´ï¼‰</p>
</li>
<li><p>åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€‚</p>
</li>
<li><p><strong>æš‚åœæ—¶é—´</strong>ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚</p>
</li>
<li><p>æ”¶é›†é¢‘ç‡ï¼šç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œæ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡ã€‚</p>
</li>
<li><p><strong>å†…å­˜å ç”¨</strong>ï¼šJavaå †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚</p>
</li>
<li><p>å¿«é€Ÿï¼šä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´ã€‚</p>
</li>
</ul>
<p>ååé‡ã€æš‚åœæ—¶é—´ã€å†…å­˜å ç”¨ è¿™ä¸‰è€…å…±åŒæ„æˆä¸€ä¸ªâ€œä¸å¯èƒ½ä¸‰è§’â€ã€‚ä¸‰è€…æ€»ä½“çš„è¡¨ç°ä¼šéšç€æŠ€æœ¯è¿›æ­¥è€Œè¶Šæ¥è¶Šå¥½ã€‚ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨é€šå¸¸æœ€å¤šåŒæ—¶æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ã€‚</p>
<p>è¿™ä¸‰é¡¹é‡Œï¼Œæš‚åœæ—¶é—´çš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾ã€‚å› ä¸ºéšç€ç¡¬ä»¶å‘å±•ï¼Œå†…å­˜å ç”¨å¤šäº›è¶Šæ¥è¶Šèƒ½å®¹å¿ï¼Œç¡¬ä»¶æ€§èƒ½çš„æå‡ä¹Ÿæœ‰åŠ©äºé™ä½æ”¶é›†å™¨è¿è¡Œæ—¶å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼Œå³æé«˜äº†ååé‡ã€‚è€Œå†…å­˜çš„æ‰©å¤§ï¼Œå¯¹å»¶è¿Ÿåè€Œå¸¦æ¥è´Ÿé¢æ•ˆæœã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œä¸»è¦æŠ“ä½ä¸¤ç‚¹ï¼šååé‡ã€æš‚åœæ—¶é—´</p>
<p><strong>ååé‡</strong></p>
<p>ååé‡å°±æ˜¯<strong>CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼</strong>ï¼Œå³ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ã€‚æ¯”å¦‚ï¼šè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºèƒ½å®¹å¿è¾ƒé«˜çš„æš‚åœæ—¶é—´ï¼Œå› æ­¤ï¼Œé«˜ååé‡çš„åº”ç”¨ç¨‹åºæœ‰æ›´é•¿çš„æ—¶é—´åŸºå‡†ï¼Œå¿«é€Ÿå“åº”æ˜¯ä¸å¿…è€ƒè™‘çš„</p>
<p>ååé‡ä¼˜å…ˆï¼Œæ„å‘³ç€åœ¨å•ä½æ—¶é—´å†…ï¼ŒSTWçš„æ—¶é—´æœ€çŸ­ï¼š0.2 + 0.2 = 0.4</p>
<p><img src="/2022/04/18/JVM/image-20220301165434632.png" alt="image-20220301165434632" loading="lazy"></p>
<p><strong>æš‚åœæ—¶é—´</strong></p>
<p>â€œæš‚åœæ—¶é—´â€æ˜¯æŒ‡<strong>ä¸€ä¸ªæ—¶é—´æ®µå†…åº”ç”¨ç¨‹åºçº¿ç¨‹æš‚åœï¼Œè®©GCçº¿ç¨‹æ‰§è¡Œçš„çŠ¶æ€</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒGCæœŸé—´100æ¯«ç§’çš„æš‚åœæ—¶é—´æ„å‘³ç€åœ¨è¿™100æ¯«ç§’æœŸé—´å†…æ²¡æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚</p>
<p>æš‚åœæ—¶é—´ä¼˜å…ˆï¼Œæ„å‘³ç€å°½å¯èƒ½è®©å•æ¬¡STWçš„æ—¶é—´æœ€çŸ­ï¼š0.1 + 0.1 + 0.1 + 0.1 + 0.1 = 0.5</p>
<p><img src="/2022/04/18/JVM/image-20220301165517402.png" alt="image-20220301165517402" loading="lazy"></p>
<p><strong>ååé‡vsæš‚åœæ—¶é—´</strong></p>
<p>é«˜ååé‡è¾ƒå¥½å› ä¸ºè¿™ä¼šè®©åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·æ„Ÿè§‰åªæœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹åœ¨åšâ€œç”Ÿäº§æ€§â€å·¥ä½œã€‚ç›´è§‰ä¸Šï¼Œååé‡è¶Šé«˜ç¨‹åºè¿è¡Œè¶Šå¿«ã€‚</p>
<p>ä½æš‚åœæ—¶é—´ï¼ˆä½å»¶è¿Ÿï¼‰è¾ƒå¥½å› ä¸ºä»æœ€ç»ˆç”¨æˆ·çš„è§’åº¦æ¥çœ‹ä¸ç®¡æ˜¯GCè¿˜æ˜¯å…¶ä»–åŸå› å¯¼è‡´ä¸€ä¸ªåº”ç”¨è¢«æŒ‚èµ·å§‹ç»ˆæ˜¯ä¸å¥½çš„ã€‚è¿™å–å†³äºåº”ç”¨ç¨‹åºçš„ç±»å‹ï¼Œæœ‰æ—¶å€™ç”šè‡³çŸ­æš‚çš„200æ¯«ç§’æš‚åœéƒ½å¯èƒ½æ‰“æ–­ç»ˆç«¯ç”¨æˆ·ä½“éªŒã€‚å› æ­¤ï¼Œå…·æœ‰ä½çš„è¾ƒå¤§æš‚åœæ—¶é—´æ˜¯éå¸¸é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªäº¤äº’å¼åº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸å¹¸çš„æ˜¯â€é«˜ååé‡â€å’Œâ€ä½æš‚åœæ—¶é—´â€æ˜¯ä¸€å¯¹ç›¸äº’ç«äº‰çš„ç›®æ ‡ï¼ˆçŸ›ç›¾ï¼‰ã€‚</p>
<ul>
<li><p>å› ä¸ºå¦‚æœé€‰æ‹©ä»¥ååé‡ä¼˜å…ˆï¼Œé‚£ä¹ˆå¿…ç„¶éœ€è¦é™ä½å†…å­˜å›æ”¶çš„æ‰§è¡Œé¢‘ç‡ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´GCéœ€è¦æ›´é•¿çš„æš‚åœæ—¶é—´æ¥æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</p>
</li>
<li><p>ç›¸åçš„ï¼Œå¦‚æœé€‰æ‹©ä»¥ä½å»¶è¿Ÿä¼˜å…ˆä¸ºåŸåˆ™ï¼Œé‚£ä¹ˆä¸ºäº†é™ä½æ¯æ¬¡æ‰§è¡Œå†…å­˜å›æ”¶æ—¶çš„æš‚åœæ—¶é—´ï¼Œä¹Ÿåªèƒ½é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜å›æ”¶ï¼Œä½†è¿™åˆå¼•èµ·äº†å¹´è½»ä»£å†…å­˜çš„ç¼©å‡å’Œå¯¼è‡´ç¨‹åºååé‡çš„ä¸‹é™ã€‚</p>
</li>
</ul>
<p>åœ¨è®¾è®¡ï¼ˆæˆ–ä½¿ç”¨ï¼‰GCç®—æ³•æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæˆ‘ä»¬çš„ç›®æ ‡ï¼šä¸€ä¸ªGCç®—æ³•åªå¯èƒ½é’ˆå¯¹ä¸¤ä¸ªç›®æ ‡ä¹‹ä¸€ï¼ˆå³åªä¸“æ³¨äºè¾ƒå¤§ååé‡æˆ–æœ€å°æš‚åœæ—¶é—´ï¼‰ï¼Œæˆ–å°è¯•æ‰¾åˆ°ä¸€ä¸ªäºŒè€…çš„æŠ˜è¡·ã€‚</p>
<p>ç°åœ¨æ ‡å‡†ï¼šåœ¨æœ€å¤§ååé‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œé™ä½åœé¡¿æ—¶é—´</p>
<h3 id="2ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°"><a href="#2ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°" class="headerlink" title="2ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°"></a>2ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h3><p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯Javaçš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚è¿™å½“ç„¶ä¹Ÿæ˜¯é¢è¯•çš„çƒ­ç‚¹ã€‚</p>
<h4 id="2-1ï¼Œåƒåœ¾å›æ”¶å™¨å‘å±•å²"><a href="#2-1ï¼Œåƒåœ¾å›æ”¶å™¨å‘å±•å²" class="headerlink" title="2.1ï¼Œåƒåœ¾å›æ”¶å™¨å‘å±•å²"></a>2.1ï¼Œåƒåœ¾å›æ”¶å™¨å‘å±•å²</h4><p>æœ‰äº†è™šæ‹Ÿæœºï¼Œå°±ä¸€å®šéœ€è¦æ”¶é›†åƒåœ¾çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯Garbage Collectionï¼Œå¯¹åº”çš„äº§å“æˆ‘ä»¬ç§°ä¸ºGarbage Collectorã€‚</p>
<ul>
<li><p>1999å¹´éšJDK1.3.1ä¸€èµ·æ¥çš„æ˜¯ä¸²è¡Œæ–¹å¼çš„serialGcï¼Œå®ƒæ˜¯ç¬¬ä¸€æ¬¾GCã€‚ParNewåƒåœ¾æ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p>
</li>
<li><p>2002å¹´2æœˆ26æ—¥ï¼ŒParallel GCå’ŒConcurrent Mark Sweep GCè·ŸéšJDK1.4.2ä¸€èµ·å‘å¸ƒÂ·</p>
</li>
<li><p>Parallel GCåœ¨JDK6ä¹‹åæˆä¸ºHotSpoté»˜è®¤GCã€‚</p>
</li>
<li><p>2012å¹´ï¼Œåœ¨JDK1.7u4ç‰ˆæœ¬ä¸­ï¼ŒG1å¯ç”¨ã€‚</p>
</li>
<li><p>2017å¹´ï¼ŒJDK9ä¸­G1å˜æˆé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥æ›¿ä»£CMSã€‚</p>
</li>
<li><p>2018å¹´3æœˆï¼ŒJDK10ä¸­G1åƒåœ¾å›æ”¶å™¨çš„å¹¶è¡Œå®Œæ•´åƒåœ¾å›æ”¶ï¼Œå®ç°å¹¶è¡Œæ€§æ¥æ”¹å–„æœ€åæƒ…å†µä¸‹çš„å»¶è¿Ÿã€‚</p>
</li>
<li><p>2018å¹´9æœˆï¼ŒJDK11å‘å¸ƒã€‚å¼•å…¥Epsilon åƒåœ¾å›æ”¶å™¨ï¼Œåˆè¢«ç§°ä¸º â€œNo-Op(æ— æ“ä½œ)â€œ å›æ”¶å™¨ã€‚åŒæ—¶ï¼Œå¼•å…¥ZGCï¼šå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾å›æ”¶å™¨ï¼ˆExperimentalï¼‰</p>
</li>
<li><p>2019å¹´3æœˆï¼ŒJDK12å‘å¸ƒã€‚å¢å¼ºG1ï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚åŒæ—¶ï¼Œå¼•å…¥Shenandoah GCï¼šä½åœé¡¿æ—¶é—´çš„GCï¼ˆExperimentalï¼‰ã€‚Â·</p>
</li>
<li><p>2019å¹´9æœˆï¼ŒJDK13å‘å¸ƒã€‚å¢å¼ºZGCï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚</p>
</li>
<li><p>2020å¹´3æœˆï¼ŒJDK14å‘å¸ƒã€‚åˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ã€‚æ‰©å±•ZGCåœ¨macoså’ŒWindowsä¸Šçš„åº”ç”¨</p>
</li>
</ul>
<h4 id="2-2ï¼Œ7ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨"><a href="#2-2ï¼Œ7ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="2.2ï¼Œ7ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨"></a>2.2ï¼Œ7ç§ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</h4><ul>
<li><p>ä¸²è¡Œå›æ”¶å™¨ï¼šSerialã€Serial Old</p>
</li>
<li><p>å¹¶è¡Œå›æ”¶å™¨ï¼šParNewã€Parallel Scavengeã€Parallel old</p>
</li>
<li><p>å¹¶å‘å›æ”¶å™¨ï¼šCMSã€G1</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220301170130168.png" alt="image-20220301170130168" loading="lazy"></p>
<p>å®˜æ–¹æ‰‹å†Œï¼š<a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/tech/memorymanagement-whitepaper-1-150020.pdf">https://www.oracle.com/technetwork/java/javase/tech/memorymanagement-whitepaper-1-150020.pdf</a></p>
<p><img src="/2022/04/18/JVM/image-20220301170148723.png" alt="image-20220301170148723" loading="lazy"></p>
<h4 id="2-3ï¼Œ7æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»"><a href="#2-3ï¼Œ7æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»" class="headerlink" title="2.3ï¼Œ7æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»"></a>2.3ï¼Œ7æ¬¾ç»å…¸æ”¶é›†å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»</h4><p><img src="/2022/04/18/JVM/image-20220301170214941.png" alt="image-20220301170214941" loading="lazy"></p>
<ul>
<li><p> æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼šSerialã€ParNewã€Parallel Scavengeï¼› </p>
</li>
<li><p> è€å¹´ä»£æ”¶é›†å™¨ï¼šSerial Oldã€Parallel Oldã€CMSï¼› </p>
</li>
<li><p> æ•´å †æ”¶é›†å™¨ï¼šG1ï¼›</p>
</li>
</ul>
<h4 id="2-4ï¼Œåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»"><a href="#2-4ï¼Œåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»" class="headerlink" title="2.4ï¼Œåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»"></a>2.4ï¼Œåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆå…³ç³»</h4><p><img src="/2022/04/18/JVM/image-20220301170333707.png" alt="image-20220301170333707" loading="lazy"></p>
<ol>
<li>ä¸¤ä¸ªæ”¶é›†å™¨é—´æœ‰è¿çº¿ï¼Œè¡¨æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼šSerial/Serial Oldã€Serial/CMSã€ParNew/Serial Oldã€ParNew/CMSã€Parallel Scavenge/Serial Oldã€Parallel Scavenge/Parallel Oldã€G1ï¼›</li>
<li>å…¶ä¸­Serial Oldä½œä¸ºCMSå‡ºç°â€<code>Concurrent Mode Failure</code>â€œå¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚</li>
<li>ï¼ˆçº¢è‰²è™šçº¿ï¼‰ç”±äºç»´æŠ¤å’Œå…¼å®¹æ€§æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨JDK 8æ—¶å°†Serial+CMSã€ParNew+Serial Oldè¿™ä¸¤ä¸ªç»„åˆå£°æ˜ä¸ºåºŸå¼ƒï¼ˆJEP173ï¼‰ï¼Œå¹¶åœ¨JDK9ä¸­å®Œå…¨å–æ¶ˆäº†è¿™äº›ç»„åˆçš„æ”¯æŒï¼ˆJEP214ï¼‰ï¼Œå³ï¼šç§»é™¤ã€‚</li>
<li>ï¼ˆç»¿è‰²è™šçº¿ï¼‰JDK14ä¸­ï¼šå¼ƒç”¨Parallel Scavengeå’ŒSerialold GCç»„åˆï¼ˆJEP366ï¼‰</li>
<li>ï¼ˆç»¿è‰²è™šæ¡†ï¼‰JDK14ä¸­ï¼šåˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰</li>
</ol>
<h4 id="2-5ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°"><a href="#2-5ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°" class="headerlink" title="2.5ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°"></a>2.5ï¼Œä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ¦‚è¿°</h4><p>ä¸ºä»€ä¹ˆè¦æœ‰å¾ˆå¤šæ”¶é›†å™¨ï¼Œä¸€ä¸ªä¸å¤Ÿå—ï¼Ÿå› ä¸ºJavaçš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œç§»åŠ¨ç«¯ï¼ŒæœåŠ¡å™¨ç­‰ã€‚æ‰€ä»¥å°±éœ€è¦é’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œæä¾›ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ï¼Œæé«˜åƒåœ¾æ”¶é›†çš„æ€§èƒ½ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬ä¼šå¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éä¸ºäº†æŒ‘é€‰ä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨å‡ºæ¥ã€‚æ²¡æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·çš†å‡†ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†å™¨ã€‚æ‰€ä»¥æˆ‘ä»¬<strong>é€‰æ‹©çš„åªæ˜¯å¯¹å…·ä½“åº”ç”¨æœ€åˆé€‚çš„æ”¶é›†å™¨</strong>ã€‚</p>
<h4 id="2-6ï¼Œå¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨"><a href="#2-6ï¼Œå¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="2.6ï¼Œå¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨"></a>2.6ï¼Œå¦‚ä½•æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨</h4><p><code>-XX:+PrintCommandLineFlags</code>ï¼šæŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°ï¼ˆåŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼‰</p>
<p>ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼š<code>jinfo -flag ç›¸å…³åƒåœ¾å›æ”¶å™¨å‚æ•° è¿›ç¨‹ID</code></p>
<h3 id="3ï¼ŒSerialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶"><a href="#3ï¼ŒSerialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶" class="headerlink" title="3ï¼ŒSerialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶"></a>3ï¼ŒSerialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</h3><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚JDK1.3ä¹‹å‰å›æ”¶æ–°ç”Ÿä»£å”¯ä¸€çš„é€‰æ‹©ã€‚</p>
<p>Serialæ”¶é›†å™¨ä½œä¸ºHotSpotä¸­<strong>clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚</strong></p>
<p><strong>Serialæ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€ä¸²è¡Œå›æ”¶å’Œâ€stop-the-Worldâ€æœºåˆ¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</strong></p>
<p>é™¤äº†å¹´è½»ä»£ä¹‹å¤–ï¼Œ<strong>Serialæ”¶é›†å™¨è¿˜æä¾›ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Serial Oldæ”¶é›†å™¨ã€‚Serial Oldæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†ä¸²è¡Œå›æ”¶å’Œâ€Stop the Worldâ€æœºåˆ¶ï¼Œåªä¸è¿‡å†…å­˜å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•ã€‚</strong></p>
<ul>
<li><p>Serial oldæ˜¯è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨</p>
</li>
<li><p>Serial 0ldåœ¨Serveræ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼šâ‘  ä¸æ–°ç”Ÿä»£çš„Parallel scavengeé…åˆä½¿ç”¨ â‘¡ ä½œä¸ºè€å¹´ä»£CMSæ”¶é›†å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆ</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220301172000362.png" alt="image-20220301172000362" loading="lazy"></p>
<p>è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½†å®ƒçš„â€œå•çº¿ç¨‹â€çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸï¼ˆStop The Worldï¼‰</p>
<p>ä¼˜åŠ¿ï¼šç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ç”¨å†…å­˜ä¸€èˆ¬ä¸å¤§ï¼ˆå‡ åMBè‡³ä¸€ä¸¤ç™¾MBï¼‰ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼ˆå‡ åmsè‡³ä¸€ç™¾å¤šmsï¼‰ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œä½¿ç”¨<code>-XX:+UseSerialGC</code>å‚æ•°å¯ä»¥æŒ‡å®šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨Serial GCï¼Œä¸”è€å¹´ä»£ç”¨Serial Old G</p>
<p><strong>æ€»ç»“</strong></p>
<p>è¿™ç§åƒåœ¾æ”¶é›†å™¨å¤§å®¶äº†è§£ï¼Œç°åœ¨å·²ç»ä¸ç”¨ä¸²è¡Œçš„äº†ã€‚è€Œä¸”åœ¨é™å®šå•æ ¸cpuæ‰å¯ä»¥ç”¨ã€‚ç°åœ¨éƒ½ä¸æ˜¯å•æ ¸çš„äº†ã€‚</p>
<p>å¯¹äºäº¤äº’è¾ƒå¼ºçš„åº”ç”¨è€Œè¨€ï¼Œè¿™ç§åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ä¸€èˆ¬åœ¨Java webåº”ç”¨ç¨‹åºä¸­æ˜¯ä¸ä¼šé‡‡ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨çš„ã€‚</p>
<h3 id="4ï¼ŒParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶"><a href="#4ï¼ŒParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶" class="headerlink" title="4ï¼ŒParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶"></a>4ï¼ŒParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</h3><p>å¦‚æœè¯´Serial GCæ˜¯å¹´è½»ä»£ä¸­çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ï¼Œé‚£ä¹ˆParNewæ”¶é›†å™¨åˆ™æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚Paræ˜¯Parallelçš„ç¼©å†™ï¼ŒNewï¼šåªèƒ½å¤„ç†çš„æ˜¯æ–°ç”Ÿä»£</p>
<p>ParNew æ”¶é›†å™¨é™¤äº†é‡‡ç”¨å¹¶è¡Œå›æ”¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶å¤–ï¼Œä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹‹é—´å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ParNewæ”¶é›†å™¨åœ¨å¹´è½»ä»£ä¸­åŒæ ·ä¹Ÿæ˜¯é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€â€Stop-the-Worldâ€æœºåˆ¶ã€‚</p>
<p>ParNew æ˜¯å¾ˆå¤šJVMè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301172302536.png" alt="image-20220301172302536" loading="lazy"></p>
<ul>
<li><p>å¯¹äºæ–°ç”Ÿä»£ï¼Œå›æ”¶æ¬¡æ•°é¢‘ç¹ï¼Œä½¿ç”¨å¹¶è¡Œæ–¹å¼é«˜æ•ˆã€‚</p>
</li>
<li><p>å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶æ¬¡æ•°å°‘ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼èŠ‚çœèµ„æºã€‚ï¼ˆCPUå¹¶è¡Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œä¸²è¡Œå¯ä»¥çœå»åˆ‡æ¢çº¿ç¨‹çš„èµ„æºï¼‰</p>
</li>
</ul>
<p>ç”±äºParNewæ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æ–­å®šParNewæ”¶é›†å™¨çš„å›æ”¶æ•ˆç‡åœ¨ä»»ä½•åœºæ™¯ä¸‹éƒ½ä¼šæ¯”serialæ”¶é›†å™¨æ›´é«˜æ•ˆï¼Ÿ</p>
<ul>
<li><p>ParNew æ”¶é›†å™¨è¿è¡Œåœ¨å¤šCPUçš„ç¯å¢ƒä¸‹ï¼Œç”±äºå¯ä»¥å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸å¿ƒç­‰ç‰©ç†ç¡¬ä»¶èµ„æºä¼˜åŠ¿ï¼Œå¯ä»¥æ›´å¿«é€Ÿåœ°å®Œæˆåƒåœ¾æ”¶é›†ï¼Œæå‡ç¨‹åºçš„ååé‡ã€‚</p>
</li>
<li><p>ä½†æ˜¯åœ¨å•ä¸ªCPUçš„ç¯å¢ƒä¸‹ï¼ŒParNewæ”¶é›†å™¨ä¸æ¯”Serial æ”¶é›†å™¨æ›´é«˜æ•ˆã€‚è™½ç„¶Serialæ”¶é›†å™¨æ˜¯åŸºäºä¸²è¡Œå›æ”¶ï¼Œä½†æ˜¯ç”±äºCPUä¸éœ€è¦é¢‘ç¹åœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆé¿å…å¤šçº¿ç¨‹äº¤äº’è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›é¢å¤–å¼€é”€ã€‚</p>
</li>
</ul>
<p>å› ä¸ºé™¤Serialå¤–ï¼Œç›®å‰åªæœ‰ParNew GCèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œ</p>
<p>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€<code>-XX:+UseParNewGC</code>â€œæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ParNewæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å®ƒè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£ã€‚</p>
<p><code>-XX:ParallelGCThreads</code>é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤å¼€å¯å’ŒCPUæ•°æ®ç›¸åŒçš„çº¿ç¨‹æ•°ã€‚</p>
<h3 id="5ï¼ŒParallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ"><a href="#5ï¼ŒParallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ" class="headerlink" title="5ï¼ŒParallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ"></a>5ï¼ŒParallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</h3><p>HotSpotçš„å¹´è½»ä»£ä¸­é™¤äº†æ‹¥æœ‰ParNewæ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶çš„ä»¥å¤–ï¼ŒParallel Scavengeæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ã€å¹¶è¡Œå›æ”¶å’Œâ€Stop the Worldâ€æœºåˆ¶ã€‚</p>
<p>é‚£ä¹ˆParallel æ”¶é›†å™¨çš„å‡ºç°æ˜¯å¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p>
<ul>
<li><p>å’ŒParNewæ”¶é›†å™¨ä¸åŒï¼ŒParallelScavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯<strong>è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡</strong>ï¼ˆThroughputï¼‰ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨ã€‚</p>
</li>
<li><p><strong>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ä¹Ÿæ˜¯Parallel Scavengeä¸ParNewä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚</p>
</li>
</ul>
<p>é«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œå¸¸è§åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œæ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>Parallel æ”¶é›†å™¨åœ¨JDK1.6æ—¶æä¾›äº†ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Parallel Oldæ”¶é›†å™¨ï¼Œç”¨æ¥ä»£æ›¿è€å¹´ä»£çš„Serial Oldæ”¶é›†å™¨ã€‚</p>
<p>Parallel Oldæ”¶é›†å™¨é‡‡ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•ï¼Œä½†åŒæ ·ä¹Ÿæ˜¯åŸºäºå¹¶è¡Œå›æ”¶å’Œâ€Stop-the-Worldâ€æœºåˆ¶ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301173249130.png" alt="image-20220301173249130" loading="lazy"></p>
<p>åœ¨ç¨‹åºååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ä¸­ï¼ŒParallel æ”¶é›†å™¨å’ŒParallel Oldæ”¶é›†å™¨çš„ç»„åˆï¼Œåœ¨Serveræ¨¡å¼ä¸‹çš„å†…å­˜å›æ”¶æ€§èƒ½å¾ˆä¸é”™ã€‚åœ¨Java8ä¸­ï¼Œé»˜è®¤æ˜¯æ­¤åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p><strong>å‚æ•°é…ç½®</strong></p>
<ul>
<li><p><code>-XX:+UseParallelGC</code> æ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨Parallelå¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚ </p>
</li>
<li><p><code>-XX:+UseParallelOldGC</code> æ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£éƒ½æ˜¯ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ã€‚ </p>
</li>
<li><ul>
<li>åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é»˜è®¤jdk8æ˜¯å¼€å¯çš„ã€‚</li>
</ul>
</li>
<li><ul>
<li>ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ã€‚ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰</li>
</ul>
</li>
<li><p><code>-XX:ParallelGCThreads</code> è®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸CPUæ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚ <img src="/2022/04/18/JVM/image-20220301173325731.png" alt="image-20220301173325731" loading="lazy"> </p>
</li>
<li><p><code>-XX:MaxGCPauseMillis</code> è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STwçš„æ—¶é—´ï¼‰ã€‚å•ä½æ˜¯æ¯«ç§’ã€‚ </p>
</li>
<li><ul>
<li>ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨MaxGCPauseMillsä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´Javaå †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚</li>
</ul>
</li>
<li><ul>
<li>å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ã€‚ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡ã€‚æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆParallelï¼Œè¿›è¡Œæ§åˆ¶ã€‚</li>
</ul>
</li>
<li><ul>
<li>è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…ã€‚</li>
</ul>
</li>
<li><p><code>-XX:GCTimeRatio</code> åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼ˆ=1/ï¼ˆN+1ï¼‰ï¼‰ã€‚ç”¨äºè¡¡é‡ååé‡çš„å¤§å°ã€‚ </p>
</li>
<li><ul>
<li>å–å€¼èŒƒå›´ï¼ˆ0, 100ï¼‰ã€‚é»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡1%ã€‚</li>
</ul>
</li>
<li><ul>
<li>ä¸å‰ä¸€ä¸ª<code>-XX:MaxGCPauseMillis</code>å‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ã€‚æš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadioå‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚</li>
</ul>
</li>
<li><p><code>-XX:+UseAdaptivesizePolicy</code> è®¾ç½®Parallel Scavengeæ”¶é›†å™¨å…·æœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ </p>
</li>
<li><ul>
<li>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Edenå’ŒSurvivorçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œå·²è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚</li>
</ul>
</li>
<li><ul>
<li>åœ¨æ‰‹åŠ¨è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ï¼ˆ<code>GCTimeRatio</code>ï¼‰å’Œåœé¡¿æ—¶é—´ï¼ˆ<code>MaxGCPauseMills</code>ï¼‰ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚</li>
</ul>
</li>
</ul>
<h3 id="6ï¼ŒCMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ"><a href="#6ï¼ŒCMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ" class="headerlink" title="6ï¼ŒCMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ"></a>6ï¼ŒCMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</h3><p>åœ¨JDK1.5æ—¶æœŸï¼ŒHotspotæ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweepï¼‰æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯<strong>HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ</strong></p>
<p>CMSæ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ã€‚åœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰å°±è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<ul>
<li>ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒã€‚CMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚</li>
</ul>
<p><strong>CMSçš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼Œå¹¶ä¸”ä¹Ÿä¼šâ€Stop-the-Worldâ€</p>
<p>ä¸å¹¸çš„æ˜¯ï¼ŒCMSä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸JDK1.4.0ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨JDK1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚</p>
<p>åœ¨G1å‡ºç°ä¹‹å‰ï¼ŒCMSä½¿ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šç³»ç»Ÿä½¿ç”¨CMS GCã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301173744780.png" alt="image-20220301173744780" loading="lazy"></p>
<p>CMSæ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µ</p>
<ul>
<li><p><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸ºâ€œStop-the-Worldâ€æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œ<strong>è¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ä»…ä»…åªæ˜¯æ ‡è®°å‡ºGCRootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ã€‚</strong>ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„é€Ÿåº¦éå¸¸å¿«ã€‚</p>
</li>
<li><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆConcurrent-Markï¼‰é˜¶æ®µï¼šä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</p>
</li>
<li><p><strong>é‡æ–°æ ‡è®°</strong>ï¼ˆRemarkï¼‰é˜¶æ®µï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œå› æ­¤ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</p>
</li>
<li><p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼ˆConcurrent-Sweepï¼‰é˜¶æ®µï¼šæ­¤é˜¶æ®µæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</p>
</li>
</ul>
<p>å°½ç®¡<strong>CMSæ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯å¹¶å‘å›æ”¶ï¼ˆéç‹¬å å¼ï¼‰</strong>ï¼Œä½†æ˜¯åœ¨å…¶<strong>åˆå§‹åŒ–æ ‡è®°å’Œå†æ¬¡æ ‡è®°</strong>è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ä»ç„¶éœ€è¦æ‰§è¡Œâ€œStop-the-Worldâ€æœºåˆ¶æš‚åœç¨‹åºä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œä¸è¿‡æš‚åœæ—¶é—´å¹¶ä¸ä¼šå¤ªé•¿ï¼Œå› æ­¤å¯ä»¥è¯´æ˜<strong>ç›®å‰æ‰€æœ‰çš„åƒåœ¾æ”¶é›†å™¨éƒ½åšä¸åˆ°å®Œå…¨ä¸éœ€è¦â€œstop-the-Worldâ€ï¼Œåªæ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­æš‚åœæ—¶é—´ã€‚</strong></p>
<p>ç”±äºæœ€è€—è´¹æ—¶é—´çš„å¹¶å‘æ ‡è®°ä¸å¹¶å‘æ¸…é™¤é˜¶æ®µéƒ½ä¸éœ€è¦æš‚åœå·¥ä½œï¼Œæ‰€ä»¥æ•´ä½“çš„å›æ”¶æ˜¯ä½åœé¡¿çš„ã€‚</p>
<p>å¦å¤–ï¼Œç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹æ²¡æœ‰ä¸­æ–­ï¼Œæ‰€ä»¥åœ¨CMSå›æ”¶è¿‡ç¨‹ä¸­ï¼Œè¿˜åº”è¯¥<strong>ç¡®ä¿åº”ç”¨ç¨‹åºç”¨æˆ·çº¿ç¨‹æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨</strong>ã€‚å› æ­¤ï¼ŒCMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œè€Œæ˜¯<strong>å½“å †å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶</strong>ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨CMSå·¥ä½œè¿‡ç¨‹ä¸­ä¾ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¯æŒåº”ç”¨ç¨‹åºè¿è¡Œã€‚è¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œ<code>Concurrent Mode Failure</code>â€ å¤±è´¥ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨Serial Oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚</p>
<p>CMSæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ‰§è¡Œå®Œå†…å­˜å›æ”¶åï¼Œç”±äºè¢«æ‰§è¡Œå†…å­˜å›æ”¶çš„æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ææœ‰å¯èƒ½æ˜¯ä¸è¿ç»­çš„ä¸€äº›å†…å­˜å—ï¼Œä¸å¯é¿å…åœ°å°†ä¼šäº§ç”Ÿä¸€äº›å†…å­˜ç¢ç‰‡ã€‚é‚£ä¹ˆCMSåœ¨ä¸º<strong>æ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰æŠ€æœ¯ï¼Œè€Œåªèƒ½å¤Ÿé€‰æ‹©ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰æ‰§è¡Œå†…å­˜åˆ†é…ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220301174614376.png" alt="image-20220301174614376" loading="lazy"></p>
<p><strong>æœ‰äººä¼šè§‰å¾—æ—¢ç„¶Mark Sweepä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠç®—æ³•æ¢æˆMark Compactï¼Ÿ</strong></p>
<p>ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºå½“å¹¶å‘æ¸…é™¤çš„æ—¶å€™ï¼Œç”¨Compactæ•´ç†å†…å­˜çš„è¯ï¼ŒåŸæ¥çš„ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨çš„å†…å­˜è¿˜æ€ä¹ˆç”¨å‘¢ï¼Ÿè¦ä¿è¯ç”¨æˆ·çº¿ç¨‹èƒ½ç»§ç»­æ‰§è¡Œï¼Œå‰æçš„å®ƒè¿è¡Œçš„èµ„æºä¸å—å½±å“å˜›ã€‚Mark Compactæ›´é€‚åˆâ€œStop the Worldâ€ è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p>
<h4 id="6-1ï¼ŒCMSçš„ä¼˜ç‚¹"><a href="#6-1ï¼ŒCMSçš„ä¼˜ç‚¹" class="headerlink" title="6.1ï¼ŒCMSçš„ä¼˜ç‚¹"></a>6.1ï¼ŒCMSçš„ä¼˜ç‚¹</h4><ul>
<li><p>å¹¶å‘æ”¶é›†</p>
</li>
<li><p>ä½å»¶è¿Ÿ</p>
</li>
</ul>
<h4 id="6-2ï¼ŒCMSçš„å¼Šç«¯"><a href="#6-2ï¼ŒCMSçš„å¼Šç«¯" class="headerlink" title="6.2ï¼ŒCMSçš„å¼Šç«¯"></a>6.2ï¼ŒCMSçš„å¼Šç«¯</h4><ul>
<li><p><strong>ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼Œå¯¼è‡´å¹¶å‘æ¸…é™¤åï¼Œç”¨æˆ·çº¿ç¨‹å¯ç”¨çš„ç©ºé—´ä¸è¶³ã€‚åœ¨æ— æ³•åˆ†é…å¤§å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸æå‰è§¦å‘FullGCã€‚</p>
</li>
<li><p><strong>CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚</p>
</li>
<li><p><strong>CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚</strong>å¯èƒ½å‡ºç°â€œ<code>Concurrent Mode Failure</code>â€œå¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”±äºç¨‹åºçš„å·¥ä½œçº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œçš„ï¼Œé‚£ä¹ˆåœ¨<strong>å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚æœäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼ŒCMSå°†æ— æ³•å¯¹è¿™äº›åƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¿™äº›æ–°äº§ç”Ÿçš„åƒåœ¾å¯¹è±¡æ²¡æœ‰è¢«åŠæ—¶å›æ”¶ï¼Œä»è€Œåªèƒ½åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡ŒGCæ—¶é‡Šæ”¾è¿™äº›ä¹‹å‰æœªè¢«å›æ”¶çš„å†…å­˜ç©ºé—´ã€‚</strong></p>
</li>
</ul>
<h4 id="6-3ï¼Œè®¾ç½®çš„å‚æ•°"><a href="#6-3ï¼Œè®¾ç½®çš„å‚æ•°" class="headerlink" title="6.3ï¼Œè®¾ç½®çš„å‚æ•°"></a>6.3ï¼Œè®¾ç½®çš„å‚æ•°</h4><ul>
<li><p><code>-XX:+UseConcMarkSweepGC</code>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨CMSæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚<br>å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†<code>-xx:+UseParNewGC</code>æ‰“å¼€ã€‚å³ï¼šParNewï¼ˆYoungåŒºç”¨ï¼‰+CMSï¼ˆOldåŒºç”¨ï¼‰+ Serial Oldçš„ç»„åˆã€‚ </p>
</li>
<li><p><code>-XX:CMSInitiatingOccupanyFraction</code> è®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚ </p>
</li>
<li><ul>
<li>JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ°68%æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡CMSå›æ”¶ã€‚JDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%</li>
</ul>
</li>
<li><ul>
<li>å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ï¼Œå¤§çš„é˜€å€¼å¯ä»¥æœ‰æ•ˆé™ä½CMSçš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½Ful1Gcçš„æ‰§è¡Œæ¬¡æ•°ã€‚</li>
</ul>
</li>
<li><p><code>-XX:+UseCMSCompactAtFullCollection</code> ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®ŒFull GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚ä¸è¿‡ç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿äº†ã€‚ </p>
</li>
<li><p><code>-XX:CMSFullGCsBeforeCompaction</code> è®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡Full GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ã€‚ </p>
</li>
<li><p><code>-XX:ParallelcMSThreads</code> è®¾ç½®CMSçš„çº¿ç¨‹æ•°é‡ã€‚ </p>
</li>
<li><ul>
<li>CMSé»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯ï¼ˆParallelGCThreads+3ï¼‰/4ï¼ŒParallelGCThreadsæ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚å½“CPUèµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ°CMSæ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>HotSpotæœ‰è¿™ä¹ˆå¤šçš„åƒåœ¾å›æ”¶å™¨ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººé—®ï¼ŒSerial GCã€Parallel GCã€Concurrent Mark Sweep GCè¿™ä¸‰ä¸ªGcæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p>
<p>è¯·è®°ä½ä»¥ä¸‹å£ä»¤ï¼š</p>
<ul>
<li><p>å¦‚æœä½ æƒ³è¦æœ€å°åŒ–åœ°ä½¿ç”¨å†…å­˜å’Œå¹¶è¡Œå¼€é”€ï¼Œè¯·é€‰Serial GCï¼›</p>
</li>
<li><p>å¦‚æœä½ æƒ³è¦æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œè¯·é€‰Parallel GCï¼›</p>
</li>
<li><p>å¦‚æœä½ æƒ³è¦æœ€å°åŒ–GCçš„ä¸­æ–­æˆ–åœé¡¿æ—¶é—´ï¼Œè¯·é€‰CMS GCã€‚</p>
</li>
</ul>
<h4 id="6-4ï¼ŒJDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ–"><a href="#6-4ï¼ŒJDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ–" class="headerlink" title="6.4ï¼ŒJDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ–"></a>6.4ï¼ŒJDKåç»­ç‰ˆæœ¬ä¸­CMSçš„å˜åŒ–</h4><p>JDK9æ–°ç‰¹æ€§ï¼šCMSè¢«æ ‡è®°ä¸ºDeprecateï¼ˆä¸èµæˆï¼‰äº†ï¼ˆJEP291ï¼‰</p>
<ul>
<li>å¦‚æœå¯¹JDK9åŠä»¥ä¸Šç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨å‚æ•°<code>-XX: +UseConcMarkSweepGC</code>æ¥å¼€å¯CMSæ”¶é›†å™¨çš„è¯ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºCMSæœªæ¥å°†ä¼šè¢«åºŸå¼ƒã€‚</li>
</ul>
<p>JDK14æ–°ç‰¹æ€§ï¼šåˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰</p>
<ul>
<li>ç§»é™¤äº†CMSåƒåœ¾æ”¶é›†å™¨ï¼Œå¦‚æœåœ¨JDK14ä¸­ä½¿ç”¨ <code>-XX:+UseConcMarkSweepGC</code>çš„è¯ï¼ŒJVMä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯ç»™å‡ºä¸€ä¸ªwarningä¿¡æ¯ï¼Œä½†æ˜¯ä¸ä¼šexitã€‚JVMä¼šè‡ªåŠ¨å›é€€ä»¥é»˜è®¤GCæ–¹å¼å¯åŠ¨JVM</li>
</ul>
<h3 id="7ï¼ŒG1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼"><a href="#7ï¼ŒG1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼" class="headerlink" title="7ï¼ŒG1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼"></a>7ï¼ŒG1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</h3><blockquote>
<p><strong>æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†å‰é¢å‡ ä¸ªå¼ºå¤§çš„GCï¼Œä¸ºä»€ä¹ˆè¿˜è¦å‘å¸ƒGarbage Firstï¼ˆG1ï¼‰ï¼Ÿ</strong></p>
</blockquote>
<p>åŸå› å°±åœ¨äºåº”ç”¨ç¨‹åºæ‰€åº”å¯¹çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œæ²¡æœ‰GCå°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿›è¡Œï¼Œè€Œç»å¸¸é€ æˆSTWçš„GCåˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹GCè¿›è¡Œä¼˜åŒ–ã€‚G1ï¼ˆGarbage-Firstï¼‰åƒåœ¾å›æ”¶å™¨æ˜¯åœ¨Java7 update4ä¹‹åå¼•å…¥çš„ä¸€ä¸ªæ–°çš„åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯å½“ä»Šæ”¶é›†å™¨æŠ€æœ¯å‘å±•çš„æœ€å‰æ²¿æˆæœä¹‹ä¸€ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œ<strong>ä¸ºäº†é€‚åº”ç°åœ¨ä¸æ–­æ‰©å¤§çš„å†…å­˜å’Œä¸æ–­å¢åŠ çš„å¤„ç†å™¨æ•°é‡ï¼Œè¿›ä¸€æ­¥é™ä½æš‚åœæ—¶é—´ï¼ˆpause timeï¼‰ï¼ŒåŒæ—¶å…¼é¡¾è‰¯å¥½çš„ååé‡ã€‚</strong></p>
<p><strong>å®˜æ–¹ç»™G1è®¾å®šçš„ç›®æ ‡æ˜¯åœ¨å»¶è¿Ÿå¯æ§çš„æƒ…å†µä¸‹è·å¾—å°½å¯èƒ½é«˜çš„ååé‡ï¼Œæ‰€ä»¥æ‰æ‹…å½“èµ·â€œå…¨åŠŸèƒ½æ”¶é›†å™¨â€çš„é‡ä»»ä¸æœŸæœ›ã€‚</strong></p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆåå­—å« Garbage First(G1)å‘¢ï¼Ÿ</strong></p>
</blockquote>
<p>å› ä¸ºG1æ˜¯ä¸€ä¸ªå¹¶å‘å›æ”¶å™¨ï¼Œ<strong>å®ƒæŠŠå †å†…å­˜åˆ†å‰²ä¸ºå¾ˆå¤šä¸ç›¸å…³çš„åŒºåŸŸï¼ˆRegionï¼‰</strong>ï¼ˆç‰©ç†ä¸Šä¸è¿ç»­çš„ï¼‰ã€‚ä½¿ç”¨ä¸åŒçš„Regionæ¥è¡¨ç¤ºEdenã€å¹¸å­˜è€…0åŒºï¼Œå¹¸å­˜è€…1åŒºï¼Œè€å¹´ä»£ç­‰ã€‚</p>
<p><strong>G1 GCæœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚</strong>G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionã€‚</p>
<p>ç”±äºè¿™ç§æ–¹å¼çš„ä¾§é‡ç‚¹åœ¨äº<strong>å›æ”¶åƒåœ¾æœ€å¤§é‡çš„åŒºé—´ï¼ˆRegionï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™G1ä¸€ä¸ªåå­—ï¼šåƒåœ¾ä¼˜å…ˆï¼ˆGarbage Firstï¼‰ã€‚</strong></p>
<p>G1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾<strong>é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨</strong>ï¼Œä¸»è¦é’ˆå¯¹é…å¤‡å¤šæ ¸CPUåŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨ï¼Œä»¥æé«˜æ¦‚ç‡æ»¡è¶³GCåœé¡¿æ—¶é—´çš„åŒæ—¶ï¼Œè¿˜å…¼å…·é«˜ååé‡çš„æ€§èƒ½ç‰¹å¾ã€‚</p>
<p>åœ¨JDK1.7ç‰ˆæœ¬æ­£å¼å¯ç”¨ï¼Œç§»é™¤äº†Experimenta1çš„æ ‡è¯†ï¼Œæ˜¯<strong>JDK9ä»¥åçš„é»˜è®¤åƒåœ¾å›æ”¶å™¨</strong>ï¼Œå–ä»£äº†CMSå›æ”¶å™¨ä»¥åŠParallel+Parallel Oldç»„åˆã€‚è¢«Oracleå®˜æ–¹ç§°ä¸ºâ€œ<strong>å…¨åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨</strong>â€ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼ŒCMSå·²ç»åœ¨JDK9ä¸­è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚åœ¨jdk8ä¸­è¿˜ä¸æ˜¯é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ï¼Œéœ€è¦ä½¿ç”¨<code>-XX:+UseG1GC</code>æ¥å¯ç”¨ã€‚</p>
<h4 id="7-1ï¼ŒG1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰"><a href="#7-1ï¼ŒG1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰" class="headerlink" title="7.1ï¼ŒG1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰"></a>7.1ï¼ŒG1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰</h4><p>ä¸å…¶ä»–GCæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1ä½¿ç”¨äº†å…¨æ–°çš„åˆ†åŒºç®—æ³•ï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<h5 id="å¹¶è¡Œä¸å¹¶å‘"><a href="#å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="å¹¶è¡Œä¸å¹¶å‘"></a>å¹¶è¡Œä¸å¹¶å‘</h5><ul>
<li><p>å¹¶è¡Œæ€§ï¼šG1åœ¨å›æ”¶æœŸé—´ï¼Œå¯ä»¥æœ‰å¤šä¸ªGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œæœ‰æ•ˆåˆ©ç”¨å¤šæ ¸è®¡ç®—èƒ½åŠ›ã€‚æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹STW</p>
</li>
<li><p>å¹¶å‘æ€§ï¼šG1æ‹¥æœ‰ä¸åº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œçš„èƒ½åŠ›ï¼Œéƒ¨åˆ†å·¥ä½œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œå› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸ä¼šåœ¨æ•´ä¸ªå›æ”¶é˜¶æ®µå‘ç”Ÿå®Œå…¨é˜»å¡åº”ç”¨ç¨‹åºçš„æƒ…å†µ</p>
</li>
</ul>
<h5 id="åˆ†ä»£æ”¶é›†"><a href="#åˆ†ä»£æ”¶é›†" class="headerlink" title="åˆ†ä»£æ”¶é›†"></a>åˆ†ä»£æ”¶é›†</h5><ul>
<li><p>ä»åˆ†ä»£ä¸Šçœ‹ï¼ŒG1ä¾ç„¶å±äºåˆ†ä»£å‹åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¼šåŒºåˆ†å¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå¹´è½»ä»£ä¾ç„¶æœ‰EdenåŒºå’ŒSurvivoråŒºã€‚ä½†ä»å †çš„ç»“æ„ä¸Šçœ‹ï¼Œå®ƒä¸è¦æ±‚æ•´ä¸ªEdenåŒºã€å¹´è½»ä»£æˆ–è€…è€å¹´ä»£éƒ½æ˜¯è¿ç»­çš„ï¼Œä¹Ÿä¸å†åšæŒå›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡ã€‚</p>
</li>
<li><p>å°†å †ç©ºé—´åˆ†ä¸ºè‹¥å¹²ä¸ªåŒºåŸŸï¼ˆRegionï¼‰ï¼Œè¿™äº›åŒºåŸŸä¸­åŒ…å«äº†é€»è¾‘ä¸Šçš„å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚</p>
</li>
<li><p>å’Œä¹‹å‰çš„å„ç±»å›æ”¶å™¨ä¸åŒï¼Œå®ƒåŒæ—¶å…¼é¡¾å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚å¯¹æ¯”å…¶ä»–å›æ”¶å™¨ï¼Œæˆ–è€…å·¥ä½œåœ¨å¹´è½»ä»£ï¼Œæˆ–è€…å·¥ä½œåœ¨è€å¹´ä»£ï¼›</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220301175708359.png" alt="image-20220301175708359" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220301175738102.png" alt="image-20220301175738102" loading="lazy"></p>
<h5 id="ç©ºé—´æ•´åˆ"><a href="#ç©ºé—´æ•´åˆ" class="headerlink" title="ç©ºé—´æ•´åˆ"></a>ç©ºé—´æ•´åˆ</h5><ul>
<li><p>CMSï¼šâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€å†…å­˜ç¢ç‰‡ã€è‹¥å¹²æ¬¡Gcåè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†</p>
</li>
<li><p>G1å°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„regionã€‚å†…å­˜çš„å›æ”¶æ˜¯ä»¥regionä½œä¸ºåŸºæœ¬å•ä½çš„ã€‚<strong>Regionä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•</strong>ï¼Œä½†<strong>æ•´ä½“ä¸Šå®é™…å¯çœ‹ä½œæ˜¯æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•</strong>ï¼Œä¸¤ç§ç®—æ³•éƒ½å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚å°¤å…¶æ˜¯å½“Javaå †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</p>
</li>
</ul>
<h5 id="å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft-real-timeï¼‰"><a href="#å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft-real-timeï¼‰" class="headerlink" title="å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft real-timeï¼‰"></a>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³ï¼šè½¯å®æ—¶soft real-timeï¼‰</h5><p>è¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼ŒG1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚</p>
<ul>
<li><p>ç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶ã€‚</p>
</li>
<li><p>G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionã€‚ä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p>
</li>
<li><p>ç›¸æ¯”äºCMSGCï¼ŒG1æœªå¿…èƒ½åšåˆ°CMSåœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚</p>
</li>
</ul>
<h4 id="7-2ï¼ŒG1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹"><a href="#7-2ï¼ŒG1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹" class="headerlink" title="7.2ï¼ŒG1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹"></a>7.2ï¼ŒG1åƒåœ¾æ”¶é›†å™¨çš„ç¼ºç‚¹</h4><p>ç›¸è¾ƒäºCMSï¼ŒG1è¿˜ä¸å…·å¤‡å…¨æ–¹ä½ã€å‹å€’æ€§ä¼˜åŠ¿ã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆOverloadï¼‰éƒ½è¦æ¯”CMSè¦é«˜ã€‚</p>
<p>ä»ç»éªŒä¸Šæ¥è¯´ï¼Œåœ¨å°å†…å­˜åº”ç”¨ä¸ŠCMSçš„è¡¨ç°å¤§æ¦‚ç‡ä¼šä¼˜äºG1ï¼Œè€ŒG1åœ¨å¤§å†…å­˜åº”ç”¨ä¸Šåˆ™å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚å¹³è¡¡ç‚¹åœ¨6-8GBä¹‹é—´ã€‚</p>
<h4 id="7-3ï¼ŒG1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®"><a href="#7-3ï¼ŒG1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®" class="headerlink" title="7.3ï¼ŒG1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®"></a>7.3ï¼ŒG1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®</h4><ul>
<li><p><code>-XX:+UseG1GC</code>ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡</p>
</li>
<li><p><code>-XX:G1HeapRegionSize</code> è®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ã€‚å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„Javaå †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„1/2000ã€‚</p>
</li>
<li><p><code>-XX:MaxGCPauseMillis</code> è®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡ï¼ˆJVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°ï¼‰ã€‚é»˜è®¤å€¼æ˜¯200msï¼ˆäººçš„å¹³å‡ååº”é€Ÿåº¦ï¼‰</p>
</li>
<li><p><code>-XX:+ParallelGCThread</code> è®¾ç½®STWå·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º8ï¼ˆä¸Šé¢è¯´è¿‡Parallelå›æ”¶å™¨çš„çº¿ç¨‹è®¡ç®—å…¬å¼ï¼Œå½“CPU_Count &gt; 8æ—¶ï¼ŒParallelGCThreads ä¹Ÿä¼šå¤§äº8ï¼‰</p>
</li>
<li><p><code>-XX:ConcGCThreads</code> è®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°†nè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼ˆParallelGCThreadsï¼‰çš„1/4å·¦å³ã€‚</p>
</li>
<li><p><code>-XX:InitiatingHeapOccupancyPercent</code> è®¾ç½®è§¦å‘å¹¶å‘GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCã€‚é»˜è®¤å€¼æ˜¯45ã€‚</p>
</li>
</ul>
<h4 id="7-4ï¼ŒG1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤"><a href="#7-4ï¼ŒG1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤" class="headerlink" title="7.4ï¼ŒG1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤"></a>7.4ï¼ŒG1æ”¶é›†å™¨çš„å¸¸è§æ“ä½œæ­¥éª¤</h4><p>G1çš„è®¾è®¡åŸåˆ™å°±æ˜¯ç®€åŒ–JVMæ€§èƒ½è°ƒä¼˜ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ç®€å•çš„ä¸‰æ­¥å³å¯å®Œæˆè°ƒä¼˜ï¼š</p>
<ul>
<li><p>ç¬¬ä¸€æ­¥ï¼šå¼€å¯G1åƒåœ¾æ”¶é›†å™¨</p>
</li>
<li><p>ç¬¬äºŒæ­¥ï¼šè®¾ç½®å †çš„æœ€å¤§å†…å­˜</p>
</li>
<li><p>ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®æœ€å¤§çš„åœé¡¿æ—¶é—´</p>
</li>
</ul>
<p>G1ä¸­æä¾›äº†ä¸‰ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼šYoung GCã€Mixed GCå’ŒFull GCï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹è¢«è§¦å‘ã€‚</p>
<h4 id="7-5ï¼ŒG1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯"><a href="#7-5ï¼ŒG1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="7.5ï¼ŒG1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯"></a>7.5ï¼ŒG1æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯</h4><p>é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨ã€‚ï¼ˆåœ¨æ™®é€šå¤§å°çš„å †é‡Œè¡¨ç°å¹¶ä¸æƒŠå–œï¼‰</p>
<p>æœ€ä¸»è¦çš„åº”ç”¨æ˜¯éœ€è¦ä½GCå»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åºæä¾›è§£å†³æ–¹æ¡ˆï¼›å¦‚ï¼šåœ¨å †å¤§å°çº¦6GBæˆ–æ›´å¤§æ—¶ï¼Œå¯é¢„æµ‹çš„æš‚åœæ—¶é—´å¯ä»¥ä½äº0.5ç§’ï¼›ï¼ˆG1é€šè¿‡æ¯æ¬¡åªæ¸…ç†ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨çš„Regionçš„å¢é‡å¼æ¸…ç†æ¥ä¿è¯æ¯æ¬¡GCåœé¡¿æ—¶é—´ä¸ä¼šè¿‡é•¿ï¼‰ã€‚</p>
<p>ç”¨æ¥æ›¿æ¢æ‰JDK1.5ä¸­çš„CMSæ”¶é›†å™¨ï¼›åœ¨ä¸‹é¢çš„æƒ…å†µæ—¶ï¼Œä½¿ç”¨G1å¯èƒ½æ¯”CMSå¥½ï¼š</p>
<ul>
<li><p>è¶…è¿‡50%çš„Javaå †è¢«æ´»åŠ¨æ•°æ®å ç”¨ï¼›</p>
</li>
<li><p>å¯¹è±¡åˆ†é…é¢‘ç‡æˆ–å¹´ä»£æå‡é¢‘ç‡å˜åŒ–å¾ˆå¤§ï¼›</p>
</li>
<li><p>GCåœé¡¿æ—¶é—´è¿‡é•¿ï¼ˆé•¿äº0.5è‡³1ç§’ï¼‰</p>
</li>
</ul>
<p>HotSpotåƒåœ¾æ”¶é›†å™¨é‡Œï¼Œé™¤äº†G1ä»¥å¤–ï¼Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å†…ç½®çš„JVMçº¿ç¨‹æ‰§è¡ŒGCçš„å¤šçº¿ç¨‹æ“ä½œï¼Œè€ŒG1 GCå¯ä»¥é‡‡ç”¨åº”ç”¨çº¿ç¨‹æ‰¿æ‹…åå°è¿è¡Œçš„GCå·¥ä½œï¼Œå³å½“JVMçš„GCçº¿ç¨‹å¤„ç†é€Ÿåº¦æ…¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹å¸®åŠ©åŠ é€Ÿåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</p>
<h4 id="7-6ï¼Œåˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶"><a href="#7-6ï¼Œåˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶" class="headerlink" title="7.6ï¼Œåˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶"></a>7.6ï¼Œåˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶</h4><p>ä½¿ç”¨G1æ”¶é›†å™¨æ—¶ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆçº¦2048ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹Regionå—ï¼Œæ¯ä¸ªRegionå—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”ä¸º2çš„Næ¬¡å¹‚ï¼Œå³1MBï¼Œ2MBï¼Œ4MBï¼Œ8MBï¼Œ16MBï¼Œ32MBã€‚å¯ä»¥é€šè¿‡<code>-XX:G1HeapRegionSize</code>è®¾å®šã€‚æ‰€æœ‰çš„Regionå¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚</p>
<p>è™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚é€šè¿‡Regionçš„åŠ¨æ€åˆ†é…æ–¹å¼å®ç°é€»è¾‘ä¸Šçš„è¿ç»­ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301181009227.png" alt="image-20220301181009227" loading="lazy"></p>
<p>ä¸€ä¸ªregionæœ‰å¯èƒ½å±äºEdenï¼ŒSurvivoræˆ–è€…Old/Tenuredå†…å­˜åŒºåŸŸã€‚ä½†æ˜¯ä¸€ä¸ªregionåªå¯èƒ½å±äºä¸€ä¸ªè§’è‰²ã€‚å›¾ä¸­çš„Eè¡¨ç¤ºè¯¥regionå±äºEdenå†…å­˜åŒºåŸŸï¼ŒSè¡¨ç¤ºå±äºsurvivorå†…å­˜åŒºåŸŸï¼ŒOè¡¨ç¤ºå±äºOldå†…å­˜åŒºåŸŸã€‚å›¾ä¸­ç©ºç™½çš„è¡¨ç¤ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>G1åƒåœ¾æ”¶é›†å™¨è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„å†…å­˜åŒºåŸŸï¼Œå«åšHumongouså†…å­˜åŒºåŸŸï¼Œå¦‚å›¾ä¸­çš„Hå—ã€‚ä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡1.5ä¸ªregionï¼Œå°±æ”¾åˆ°Hã€‚</p>
<p>è®¾ç½®Hçš„åŸå› ï¼šå¯¹äº<strong>å †ä¸­çš„å¯¹è±¡ï¼Œé»˜è®¤ç›´æ¥ä¼šè¢«åˆ†é…åˆ°è€å¹´ä»£ï¼Œä½†æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªçŸ­æœŸå­˜åœ¨çš„å¤§å¯¹è±¡å°±ä¼šå¯¹åƒåœ¾æ”¶é›†å™¨é€ æˆè´Ÿé¢å½±å“</strong>ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒG1åˆ’åˆ†äº†ä¸€ä¸ªHumongousåŒºï¼Œå®ƒç”¨æ¥ä¸“é—¨å­˜æ”¾å¤§å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªHåŒºè£…ä¸ä¸‹ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œé‚£ä¹ˆG1ä¼šå¯»æ‰¾è¿ç»­çš„HåŒºæ¥å­˜å‚¨ã€‚ä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„HåŒºï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨Full GCã€‚G1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHåŒºä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥çœ‹å¾…ã€‚</p>
<p>æ¯ä¸ªRegionéƒ½æ˜¯é€šè¿‡æŒ‡é’ˆç¢°æ’æ¥åˆ†é…ç©ºé—´ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301181156136.png" alt="image-20220301181156136" loading="lazy"></p>
<h4 id="7-7ï¼ŒG1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹"><a href="#7-7ï¼ŒG1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹" class="headerlink" title="7.7ï¼ŒG1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹"></a>7.7ï¼ŒG1åƒåœ¾å›æ”¶å™¨çš„å›æ”¶è¿‡ç¨‹</h4><p>G1GCçš„åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªç¯èŠ‚ï¼š</p>
<ul>
<li><p> å¹´è½»ä»£GCï¼ˆYoung GCï¼‰ </p>
</li>
<li><p> è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼ˆConcurrent Markingï¼‰ </p>
</li>
<li><p>æ··åˆå›æ”¶ï¼ˆMixed GCï¼‰<br> ï¼ˆå¦‚æœéœ€è¦ï¼Œå•çº¿ç¨‹ã€ç‹¬å å¼ã€é«˜å¼ºåº¦çš„Full GCè¿˜æ˜¯ç»§ç»­å­˜åœ¨çš„ã€‚å®ƒé’ˆå¯¹GCçš„è¯„ä¼°å¤±è´¥æä¾›äº†ä¸€ç§å¤±è´¥ä¿æŠ¤æœºåˆ¶ï¼Œå³å¼ºåŠ›å›æ”¶ã€‚ï¼‰ </p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220301181228985.png" alt="image-20220301181228985" loading="lazy"></p>
<p>é¡ºæ—¶é’ˆï¼ŒYoung gc -&gt; Young gc + Concurrent mark-&gt;Mixed GCé¡ºåºï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<p>åº”ç”¨ç¨‹åºåˆ†é…å†…å­˜ï¼Œå½“å¹´è½»ä»£çš„EdenåŒºç”¨å°½æ—¶å¼€å§‹å¹´è½»ä»£å›æ”¶è¿‡ç¨‹ï¼›<strong>G1çš„å¹´è½»ä»£æ”¶é›†é˜¶æ®µæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„ç‹¬å å¼æ”¶é›†å™¨</strong>ã€‚åœ¨<strong>å¹´è½»ä»£</strong>å›æ”¶æœŸï¼Œ<strong>G1GCæš‚åœæ‰€æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯åŠ¨å¤šçº¿ç¨‹æ‰§è¡Œå¹´è½»ä»£å›æ”¶</strong>ã€‚ç„¶åä»å¹´è½»ä»£åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°SurvivoråŒºé—´æˆ–è€…è€å¹´åŒºé—´ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªåŒºé—´éƒ½ä¼šæ¶‰åŠã€‚</p>
<p>å½“å †å†…å­˜ä½¿ç”¨<strong>è¾¾åˆ°ä¸€å®šå€¼ï¼ˆé»˜è®¤45%ï¼‰æ—¶ï¼Œå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ã€‚</strong></p>
<p>æ ‡è®°å®Œæˆé©¬ä¸Šå¼€å§‹æ··åˆå›æ”¶è¿‡ç¨‹ã€‚å¯¹äºä¸€ä¸ªæ··åˆå›æ”¶æœŸï¼ŒG1 GCä»è€å¹´åŒºé—´ç§»åŠ¨å­˜æ´»å¯¹è±¡åˆ°ç©ºé—²åŒºé—´ï¼Œè¿™äº›ç©ºé—²åŒºé—´ä¹Ÿå°±æˆä¸ºäº†è€å¹´ä»£çš„ä¸€éƒ¨åˆ†ã€‚å’Œå¹´è½»ä»£ä¸åŒï¼Œè€å¹´ä»£çš„G1å›æ”¶å™¨å’Œå…¶ä»–GCä¸åŒï¼Œ<strong>G1çš„è€å¹´ä»£å›æ”¶å™¨ä¸éœ€è¦æ•´ä¸ªè€å¹´ä»£è¢«å›æ”¶ï¼Œä¸€æ¬¡åªéœ€è¦æ‰«æ/å›æ”¶ä¸€å°éƒ¨åˆ†è€å¹´ä»£çš„Regionå°±å¯ä»¥äº†ã€‚åŒæ—¶ï¼Œè¿™ä¸ªè€å¹´ä»£Regionæ˜¯å’Œå¹´è½»ä»£ä¸€èµ·è¢«å›æ”¶çš„ã€‚</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šä¸€ä¸ªWebæœåŠ¡å™¨ï¼ŒJavaè¿›ç¨‹æœ€å¤§å †å†…å­˜ä¸º4Gï¼Œæ¯åˆ†é’Ÿå“åº”1500ä¸ªè¯·æ±‚ï¼Œæ¯45ç§’é’Ÿä¼šæ–°åˆ†é…å¤§çº¦2Gçš„å†…å­˜ã€‚G1ä¼šæ¯45ç§’é’Ÿè¿›è¡Œä¸€æ¬¡å¹´è½»ä»£å›æ”¶ï¼Œæ¯31ä¸ªå°æ—¶æ•´ä¸ªå †çš„ä½¿ç”¨ç‡ä¼šè¾¾åˆ°45%ï¼Œä¼šå¼€å§‹è€å¹´ä»£å¹¶å‘æ ‡è®°è¿‡ç¨‹ï¼Œæ ‡è®°å®Œæˆåå¼€å§‹å››åˆ°äº”æ¬¡çš„æ··åˆå›æ”¶ã€‚</p>
<h4 id="7-8ï¼ŒRemembered-Set"><a href="#7-8ï¼ŒRemembered-Set" class="headerlink" title="7.8ï¼ŒRemembered Set"></a>7.8ï¼ŒRemembered Set</h4><ul>
<li><p> ä¸€ä¸ªå¯¹è±¡è¢«ä¸åŒåŒºåŸŸå¼•ç”¨çš„é—®é¢˜ </p>
</li>
<li><p> ä¸€ä¸ªRegionä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªRegionä¸­çš„å¯¹è±¡å¯èƒ½è¢«å…¶ä»–ä»»æ„Regionä¸­å¯¹è±¡å¼•ç”¨ï¼Œåˆ¤æ–­å¯¹è±¡å­˜æ´»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªJavaå †æ‰èƒ½ä¿è¯å‡†ç¡®ï¼Ÿ </p>
</li>
<li><p> åœ¨å…¶ä»–çš„åˆ†ä»£æ”¶é›†å™¨ï¼Œä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼ˆè€ŒG1æ›´çªå‡ºï¼‰å›æ”¶æ–°ç”Ÿä»£ä¹Ÿä¸å¾—ä¸åŒæ—¶æ‰«æè€å¹´ä»£ï¼Ÿ </p>
</li>
<li><p> è¿™æ ·çš„è¯ä¼šé™ä½MinorGCçš„æ•ˆç‡ï¼› </p>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<p>æ— è®ºG1è¿˜æ˜¯å…¶ä»–åˆ†ä»£æ”¶é›†å™¨ï¼ŒJVMéƒ½æ˜¯ä½¿ç”¨Remembered Setæ¥é¿å…å…¨å±€æ‰«æï¼š</p>
<p>æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Remembered Setï¼›</p>
<p>æ¯æ¬¡Referenceç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­æ“ä½œï¼›</p>
<p>ç„¶åæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥Referenceç±»å‹æ•°æ®åœ¨ä¸åŒçš„Regionï¼ˆå…¶ä»–æ”¶é›†å™¨ï¼šæ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼‰ï¼›</p>
<p>å¦‚æœä¸åŒï¼Œé€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨Regionå¯¹åº”çš„Remembered Setä¸­ï¼›</p>
<p>å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥Remembered Setï¼›å°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301182341838.png" alt="image-20220301182341838" loading="lazy"></p>
<h4 id="7-9ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£GC"><a href="#7-9ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£GC" class="headerlink" title="7.9ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£GC"></a>7.9ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸€ï¼šå¹´è½»ä»£GC</h4><p>JVMå¯åŠ¨æ—¶ï¼ŒG1å…ˆå‡†å¤‡å¥½EdenåŒºï¼Œç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºå¯¹è±¡åˆ°EdenåŒºï¼Œå½“Edenç©ºé—´è€—å°½æ—¶ï¼ŒG1ä¼šå¯åŠ¨ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚</p>
<p>å¹´è½»ä»£åƒåœ¾å›æ”¶åªä¼šå›æ”¶EdenåŒºå’ŒSurvivoråŒºã€‚</p>
<p>é¦–å…ˆG1åœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰ï¼ŒG1åˆ›å»ºå›æ”¶é›†ï¼ˆCollection Setï¼‰ï¼Œå›æ”¶é›†æ˜¯æŒ‡éœ€è¦è¢«å›æ”¶çš„å†…å­˜åˆ†æ®µçš„é›†åˆï¼Œå¹´è½»ä»£å›æ”¶è¿‡ç¨‹çš„å›æ”¶é›†åŒ…å«å¹´è½»ä»£EdenåŒºå’ŒSurvivoråŒºæ‰€æœ‰çš„å†…å­˜åˆ†æ®µã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301182500380.png" alt="image-20220301182500380" loading="lazy"></p>
<p>ç„¶åå¼€å§‹å¦‚ä¸‹å›æ”¶è¿‡ç¨‹ï¼š</p>
<ol>
<li>ç¬¬ä¸€é˜¶æ®µï¼Œæ‰«ææ ¹ã€‚æ ¹æ˜¯æŒ‡staticå˜é‡æŒ‡å‘çš„å¯¹è±¡ï¼Œæ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•è°ƒç”¨é“¾æ¡ä¸Šçš„å±€éƒ¨å˜é‡ç­‰ã€‚æ ¹å¼•ç”¨è¿åŒRSetè®°å½•çš„å¤–éƒ¨å¼•ç”¨ä½œä¸ºæ‰«æå­˜æ´»å¯¹è±¡çš„å…¥å£ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼Œæ›´æ–°RSetã€‚å¤„ç†dirty card queueï¼ˆè§å¤‡æ³¨ï¼‰ä¸­çš„cardï¼Œæ›´æ–°RSetã€‚æ­¤é˜¶æ®µå®Œæˆåï¼ŒRSetå¯ä»¥å‡†ç¡®çš„åæ˜ è€å¹´ä»£å¯¹æ‰€åœ¨çš„å†…å­˜åˆ†æ®µä¸­å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>ç¬¬ä¸‰é˜¶æ®µï¼Œå¤„ç†RSetã€‚è¯†åˆ«è¢«è€å¹´ä»£å¯¹è±¡æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡ï¼Œè¿™äº›è¢«æŒ‡å‘çš„Edenä¸­çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å­˜æ´»çš„å¯¹è±¡ã€‚</li>
<li>ç¬¬å››é˜¶æ®µï¼Œå¤åˆ¶å¯¹è±¡ã€‚æ­¤é˜¶æ®µï¼Œå¯¹è±¡æ ‘è¢«éå†ï¼ŒEdenåŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µï¼ŒSurvivoråŒºå†…å­˜æ®µä¸­å­˜æ´»çš„å¯¹è±¡å¦‚æœå¹´é¾„æœªè¾¾é˜ˆå€¼ï¼Œå¹´é¾„ä¼šåŠ 1ï¼Œè¾¾åˆ°é˜€å€¼ä¼šè¢«ä¼šè¢«å¤åˆ¶åˆ°OldåŒºä¸­ç©ºçš„å†…å­˜åˆ†æ®µã€‚å¦‚æœSurvivorç©ºé—´ä¸å¤Ÿï¼ŒEdenç©ºé—´çš„éƒ¨åˆ†æ•°æ®ä¼šç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ç©ºé—´ã€‚</li>
<li>ç¬¬äº”é˜¶æ®µï¼Œå¤„ç†å¼•ç”¨ã€‚å¤„ç†Softï¼ŒWeakï¼ŒPhantomï¼ŒFinalï¼ŒJNI Weak ç­‰å¼•ç”¨ã€‚æœ€ç»ˆEdenç©ºé—´çš„æ•°æ®ä¸ºç©ºï¼ŒGCåœæ­¢å·¥ä½œï¼Œè€Œç›®æ ‡å†…å­˜ä¸­çš„å¯¹è±¡éƒ½æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œæ²¡æœ‰ç¢ç‰‡ï¼Œæ‰€ä»¥å¤åˆ¶è¿‡ç¨‹å¯ä»¥è¾¾åˆ°å†…å­˜æ•´ç†çš„æ•ˆæœï¼Œå‡å°‘ç¢ç‰‡ã€‚</li>
</ol>
<h4 id="7-10ï¼ŒG1å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹"><a href="#7-10ï¼ŒG1å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹" class="headerlink" title="7.10ï¼ŒG1å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹"></a>7.10ï¼ŒG1å›æ”¶è¿‡ç¨‹äºŒï¼šå¹¶å‘æ ‡è®°è¿‡ç¨‹</h4><ol>
<li>åˆå§‹æ ‡è®°é˜¶æ®µï¼šæ ‡è®°ä»æ ¹èŠ‚ç‚¹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯STWçš„ï¼Œå¹¶ä¸”ä¼šè§¦å‘ä¸€æ¬¡å¹´è½»ä»£GCã€‚</li>
<li>æ ¹åŒºåŸŸæ‰«æï¼ˆRoot Region Scanningï¼‰ï¼šG1 GCæ‰«æSurvivoråŒºç›´æ¥å¯è¾¾çš„è€å¹´ä»£åŒºåŸŸå¯¹è±¡ï¼Œå¹¶æ ‡è®°è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™ä¸€è¿‡ç¨‹å¿…é¡»åœ¨YoungGCä¹‹å‰å®Œæˆã€‚</li>
<li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰ï¼šåœ¨æ•´ä¸ªå †ä¸­è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆå’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼‰ï¼Œæ­¤è¿‡ç¨‹å¯èƒ½è¢«YoungGCä¸­æ–­ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œè‹¥å‘ç°åŒºåŸŸå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œé‚£è¿™ä¸ªåŒºåŸŸä¼šè¢«ç«‹å³å›æ”¶ã€‚åŒæ—¶ï¼Œå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œä¼šè®¡ç®—æ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§ï¼ˆåŒºåŸŸä¸­å­˜æ´»å¯¹è±¡çš„æ¯”ä¾‹ï¼‰ã€‚</li>
<li>å†æ¬¡æ ‡è®°ï¼ˆRemarkï¼‰ï¼šç”±äºåº”ç”¨ç¨‹åºæŒç»­è¿›è¡Œï¼Œéœ€è¦ä¿®æ­£ä¸Šä¸€æ¬¡çš„æ ‡è®°ç»“æœã€‚æ˜¯STWçš„ã€‚G1ä¸­é‡‡ç”¨äº†æ¯”CMSæ›´å¿«çš„åˆå§‹å¿«ç…§ç®—æ³•ï¼šsnapshot-at-the-beginningï¼ˆSATBï¼‰ã€‚</li>
<li>ç‹¬å æ¸…ç†ï¼ˆcleanupï¼ŒSTWï¼‰ï¼šè®¡ç®—å„ä¸ªåŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’ŒGCå›æ”¶æ¯”ä¾‹ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œè¯†åˆ«å¯ä»¥æ··åˆå›æ”¶çš„åŒºåŸŸã€‚ä¸ºä¸‹é˜¶æ®µåšé“ºå«ã€‚æ˜¯STWçš„ã€‚è¿™ä¸ªé˜¶æ®µå¹¶ä¸ä¼šå®é™…ä¸Šå»åšåƒåœ¾çš„æ”¶é›†</li>
<li>å¹¶å‘æ¸…ç†é˜¶æ®µï¼šè¯†åˆ«å¹¶æ¸…ç†å®Œå…¨ç©ºé—²çš„åŒºåŸŸã€‚</li>
</ol>
<h4 id="7-11ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶"><a href="#7-11ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶" class="headerlink" title="7.11ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶"></a>7.11ï¼ŒG1å›æ”¶è¿‡ç¨‹ä¸‰ï¼šæ··åˆå›æ”¶</h4><p>å½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£o1d regionæ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå³Mixed GCï¼Œè¯¥ç®—æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªOld GCï¼Œé™¤äº†å›æ”¶æ•´ä¸ªYoung Regionï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„Old Regionã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼šæ˜¯ä¸€éƒ¨åˆ†è€å¹´ä»£ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è€å¹´ä»£ã€‚å¯ä»¥é€‰æ‹©å“ªäº›Old Regionè¿›è¡Œæ”¶é›†ï¼Œä»è€Œå¯ä»¥å¯¹åƒåœ¾å›æ”¶çš„è€—æ—¶æ—¶é—´è¿›è¡Œæ§åˆ¶ã€‚ä¹Ÿè¦æ³¨æ„çš„æ˜¯Mixed GCå¹¶ä¸æ˜¯Full GCã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301183839838.png" alt="image-20220301183839838" loading="lazy"></p>
<p>å¹¶å‘æ ‡è®°ç»“æŸä»¥åï¼Œè€å¹´ä»£ä¸­ç™¾åˆ†ç™¾ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«å›æ”¶äº†ï¼Œéƒ¨åˆ†ä¸ºåƒåœ¾çš„å†…å­˜åˆ†æ®µè¢«è®¡ç®—äº†å‡ºæ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è€å¹´ä»£çš„å†…å­˜åˆ†æ®µä¼šåˆ†8æ¬¡ï¼ˆå¯ä»¥é€šè¿‡<code>-XX:G1MixedGCCountTarget</code>è®¾ç½®ï¼‰è¢«å›æ”¶</p>
<p>æ··åˆå›æ”¶çš„å›æ”¶é›†ï¼ˆCollection Setï¼‰åŒ…æ‹¬å…«åˆ†ä¹‹ä¸€çš„è€å¹´ä»£å†…å­˜åˆ†æ®µï¼ŒEdenåŒºå†…å­˜åˆ†æ®µï¼ŒSurvivoråŒºå†…å­˜åˆ†æ®µã€‚<strong>æ··åˆå›æ”¶çš„ç®—æ³•å’Œå¹´è½»ä»£å›æ”¶çš„ç®—æ³•å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯å›æ”¶é›†å¤šäº†è€å¹´ä»£çš„å†…å­˜åˆ†æ®µã€‚</strong>å…·ä½“è¿‡ç¨‹è¯·å‚è€ƒä¸Šé¢çš„å¹´è½»ä»£å›æ”¶è¿‡ç¨‹ã€‚</p>
<p><strong>ç”±äºè€å¹´ä»£ä¸­çš„å†…å­˜åˆ†æ®µé»˜è®¤åˆ†8æ¬¡å›æ”¶ï¼ŒG1ä¼šä¼˜å…ˆå›æ”¶åƒåœ¾å¤šçš„å†…å­˜åˆ†æ®µã€‚</strong>åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¶Šé«˜çš„ï¼Œè¶Šä¼šè¢«å…ˆå›æ”¶ã€‚å¹¶ä¸”æœ‰ä¸€ä¸ªé˜ˆå€¼ä¼šå†³å®šå†…å­˜åˆ†æ®µæ˜¯å¦è¢«å›æ”¶ï¼Œ<code>-XX:G1MixedGCLiveThresholdPercent</code>ï¼Œé»˜è®¤ä¸º65%ï¼Œæ„æ€æ˜¯åƒåœ¾å å†…å­˜åˆ†æ®µæ¯”ä¾‹è¦è¾¾åˆ°65%æ‰ä¼šè¢«å›æ”¶ã€‚å¦‚æœåƒåœ¾å æ¯”å¤ªä½ï¼Œæ„å‘³ç€å­˜æ´»çš„å¯¹è±¡å æ¯”é«˜ï¼Œåœ¨å¤åˆ¶çš„æ—¶å€™ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p>
<p><strong>æ··åˆå›æ”¶å¹¶ä¸ä¸€å®šè¦è¿›è¡Œ8æ¬¡ã€‚</strong>æœ‰ä¸€ä¸ªé˜ˆå€¼<code>-XX:G1HeapWastePercent</code>ï¼Œé»˜è®¤å€¼ä¸º10%ï¼Œæ„æ€æ˜¯å…è®¸æ•´ä¸ªå †å†…å­˜ä¸­æœ‰10%çš„ç©ºé—´è¢«æµªè´¹ï¼Œæ„å‘³ç€å¦‚æœå‘ç°å¯ä»¥å›æ”¶çš„åƒåœ¾å å †å†…å­˜çš„æ¯”ä¾‹ä½äº10%ï¼Œåˆ™ä¸å†è¿›è¡Œæ··åˆå›æ”¶ã€‚å› ä¸ºGCä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ä½†æ˜¯å›æ”¶åˆ°çš„å†…å­˜å´å¾ˆå°‘ã€‚</p>
<h4 id="7-12ï¼ŒG1å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull-GC"><a href="#7-12ï¼ŒG1å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull-GC" class="headerlink" title="7.12ï¼ŒG1å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull GC"></a>7.12ï¼ŒG1å›æ”¶å¯é€‰çš„è¿‡ç¨‹å››ï¼šFull GC</h4><p>G1çš„åˆè¡·å°±æ˜¯è¦é¿å…Full GCçš„å‡ºç°ã€‚ä½†æ˜¯å¦‚æœä¸Šè¿°æ–¹å¼ä¸èƒ½æ­£å¸¸å·¥ä½œï¼ŒG1ä¼šåœæ­¢åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼ˆStop-The-Worldï¼‰ï¼Œä½¿ç”¨å•çº¿ç¨‹çš„å†…å­˜å›æ”¶ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ€§èƒ½ä¼šéå¸¸å·®ï¼Œåº”ç”¨ç¨‹åºåœé¡¿æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p>
<p>è¦é¿å…Full GCçš„å‘ç”Ÿï¼Œä¸€æ—¦å‘ç”Ÿéœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸFull GCå‘¢ï¼Ÿæ¯”å¦‚å †å†…å­˜å¤ªå°ï¼Œå½“G1åœ¨å¤åˆ¶å­˜æ´»å¯¹è±¡çš„æ—¶å€™æ²¡æœ‰ç©ºçš„å†…å­˜åˆ†æ®µå¯ç”¨ï¼Œåˆ™ä¼šå›é€€åˆ°Full GCï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¢å¤§å†…å­˜è§£å†³ã€‚</p>
<p>å¯¼è‡´G1 Full GCçš„åŸå› å¯èƒ½æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li><p>Evacuationçš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„to-spaceæ¥å­˜æ”¾æ™‹å‡çš„å¯¹è±¡ï¼›</p>
</li>
<li><p>å¹¶å‘å¤„ç†è¿‡ç¨‹å®Œæˆä¹‹å‰ç©ºé—´è€—å°½ã€‚</p>
</li>
</ul>
<h4 id="7-13ï¼Œè¡¥å……"><a href="#7-13ï¼Œè¡¥å……" class="headerlink" title="7.13ï¼Œè¡¥å……"></a>7.13ï¼Œè¡¥å……</h4><p>ä»Oracleå®˜æ–¹é€éœ²å‡ºæ¥çš„ä¿¡æ¯å¯è·çŸ¥ï¼Œå›æ”¶é˜¶æ®µï¼ˆEvacuationï¼‰å…¶å®æœ¬ä¹Ÿæœ‰æƒ³è¿‡è®¾è®¡æˆä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†è¿™ä»¶äº‹æƒ…åšèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè€ƒè™‘åˆ°G1åªæ˜¯å›ä¸€éƒ¨åˆ†Regionï¼Œåœé¡¿æ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œæ‰€ä»¥å¹¶ä¸è¿«åˆ‡å»å®ç°ï¼Œè€Œé€‰æ‹©æŠŠè¿™ä¸ªç‰¹æ€§æ”¾åˆ°äº†G1ä¹‹åå‡ºç°çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ˆå³ZGCï¼‰ä¸­ã€‚å¦å¤–ï¼Œè¿˜è€ƒè™‘åˆ°G1ä¸æ˜¯ä»…ä»…é¢å‘ä½å»¶è¿Ÿï¼Œåœé¡¿ç”¨æˆ·çº¿ç¨‹èƒ½å¤Ÿæœ€å¤§å¹…åº¦æé«˜åƒåœ¾æ”¶é›†æ•ˆç‡ï¼Œä¸ºäº†ä¿è¯ååé‡æ‰€ä»¥æ‰é€‰æ‹©äº†å®Œå…¨æš‚åœç”¨æˆ·çº¿ç¨‹çš„å®ç°æ–¹æ¡ˆã€‚</p>
<h4 id="7-14ï¼ŒG1å›æ”¶å™¨ä¼˜åŒ–å»ºè®®"><a href="#7-14ï¼ŒG1å›æ”¶å™¨ä¼˜åŒ–å»ºè®®" class="headerlink" title="7.14ï¼ŒG1å›æ”¶å™¨ä¼˜åŒ–å»ºè®®"></a>7.14ï¼ŒG1å›æ”¶å™¨ä¼˜åŒ–å»ºè®®</h4><p>å¹´è½»ä»£å¤§å°</p>
<ul>
<li><p>é¿å…ä½¿ç”¨<code>-Xmn</code>æˆ–<code>-XX:NewRatio</code>ç­‰ç›¸å…³é€‰é¡¹æ˜¾å¼è®¾ç½®å¹´è½»ä»£å¤§å°</p>
</li>
<li><p>å›ºå®šå¹´è½»ä»£çš„å¤§å°ä¼šè¦†ç›–æš‚åœæ—¶é—´ç›®æ ‡</p>
</li>
</ul>
<p>æš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªè¿‡ä¸¥è‹›</p>
<ul>
<li><p>G1 GCçš„ååé‡ç›®æ ‡æ˜¯90%çš„åº”ç”¨ç¨‹åºæ—¶é—´å’Œ10%çš„åƒåœ¾å›æ”¶æ—¶é—´</p>
</li>
<li><p>è¯„ä¼°G1 GCçš„ååé‡æ—¶ï¼Œæš‚åœæ—¶é—´ç›®æ ‡ä¸è¦å¤ªä¸¥è‹›ã€‚ç›®æ ‡å¤ªè¿‡ä¸¥è‹›è¡¨ç¤ºä½ æ„¿æ„æ‰¿å—æ›´å¤šçš„åƒåœ¾å›æ”¶å¼€é”€ï¼Œè€Œè¿™äº›ä¼šç›´æ¥å½±å“åˆ°ååé‡ã€‚</p>
</li>
</ul>
<h3 id="8ï¼Œåƒåœ¾å›æ”¶å™¨æ€»ç»“"><a href="#8ï¼Œåƒåœ¾å›æ”¶å™¨æ€»ç»“" class="headerlink" title="8ï¼Œåƒåœ¾å›æ”¶å™¨æ€»ç»“"></a>8ï¼Œåƒåœ¾å›æ”¶å™¨æ€»ç»“</h3><h4 id="8-1ï¼Œ7ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“"><a href="#8-1ï¼Œ7ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“" class="headerlink" title="8.1ï¼Œ7ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“"></a>8.1ï¼Œ7ç§ç»å…¸åƒåœ¾å›æ”¶å™¨æ€»ç»“</h4><p>æˆªæ­¢JDK1.8ï¼Œä¸€å…±æœ‰7æ¬¾ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚æ¯ä¸€æ¬¾çš„åƒåœ¾æ”¶é›†å™¨éƒ½æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œåœ¨å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„æƒ…å†µé€‰ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301184528969.png" alt="image-20220301184528969" loading="lazy"></p>
<p>GCå‘å±•é˜¶æ®µï¼šSerial =&gt; Parallelï¼ˆå¹¶è¡Œï¼‰=&gt; CMSï¼ˆå¹¶å‘ï¼‰=&gt; G1 =&gt; ZGC</p>
<h4 id="8-2ï¼Œåƒåœ¾å›æ”¶å™¨ç»„åˆ"><a href="#8-2ï¼Œåƒåœ¾å›æ”¶å™¨ç»„åˆ" class="headerlink" title="8.2ï¼Œåƒåœ¾å›æ”¶å™¨ç»„åˆ"></a>8.2ï¼Œåƒåœ¾å›æ”¶å™¨ç»„åˆ</h4><p>ä¸åŒå‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºå®ç°å·®è·æ¯”è¾ƒå¤§ã€‚HotSpotè™šæ‹Ÿæœºåœ¨JDK7/8åæ‰€æœ‰æ”¶é›†å™¨åŠç»„åˆå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301184646575.png" alt="image-20220301184646575" loading="lazy"></p>
<ol>
<li> ä¸¤ä¸ªæ”¶é›†å™¨é—´æœ‰è¿çº¿ï¼Œè¡¨æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼šSerial/Serial Oldã€Serial/CMSã€ParNew/Serial Oldã€ParNew/CMSã€Parallel Scavenge/Serial Oldã€Parallel Scavenge/Parallel Oldã€G1; </li>
<li> å…¶ä¸­Serial Oldä½œä¸ºCMSå‡ºç°ï¼‚<code>Concurrent Mode Failure</code>ï¼‚å¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚ </li>
<li> ï¼ˆçº¢è‰²è™šçº¿ï¼‰ç”±äºç»´æŠ¤å’Œå…¼å®¹æ€§æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨JDK 8æ—¶å°†Serialï¼‹CMSã€ParNewï¼‹Serial oldè¿™ä¸¤ä¸ªç»„åˆå£°æ˜ä¸ºDeprecatedï¼ˆJEP 173ï¼‰ï¼Œå¹¶åœ¨JDK 9ä¸­ </li>
</ol>
<p>å®Œå…¨å–æ¶ˆäº†è¿™äº›ç»„åˆçš„æ”¯æŒï¼ˆJEP214ï¼‰ï¼Œå³ï¼šç§»é™¤ã€‚</p>
<ol>
<li>ï¼ˆç»¿è‰²è™šçº¿ï¼‰JDK 14ä¸­ï¼šå¼ƒç”¨ParallelScavengeå’ŒSeriaOold GCç»„åˆ(JEP 366) </li>
<li>ï¼ˆç»¿è‰²è™šæ¡†ï¼‰JDK 14ä¸­ï¼šåˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ï¼ˆJEP 363ï¼‰ </li>
</ol>
<h4 id="8-3ï¼Œæ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨"><a href="#8-3ï¼Œæ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨" class="headerlink" title="8.3ï¼Œæ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨"></a>8.3ï¼Œæ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨</h4><p>Javaåƒåœ¾æ”¶é›†å™¨çš„é…ç½®å¯¹äºJVMä¼˜åŒ–æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„é€‰æ‹©ï¼Œé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥è®©JVMçš„æ€§èƒ½æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æå‡ã€‚</p>
<p>æ€ä¹ˆé€‰æ‹©åƒåœ¾æ”¶é›†å™¨ï¼Ÿ</p>
<ol>
<li>ä¼˜å…ˆè°ƒæ•´å †çš„å¤§å°è®©JVMè‡ªé€‚åº”å®Œæˆã€‚ </li>
<li>å¦‚æœå†…å­˜å°äº100Mï¼Œä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ </li>
<li>å¦‚æœæ˜¯å•æ ¸ã€å•æœºç¨‹åºï¼Œå¹¶ä¸”æ²¡æœ‰åœé¡¿æ—¶é—´çš„è¦æ±‚ï¼Œä¸²è¡Œæ”¶é›†å™¨ </li>
<li>å¦‚æœæ˜¯å¤šCPUã€éœ€è¦é«˜ååé‡ã€å…è®¸åœé¡¿æ—¶é—´è¶…è¿‡1ç§’ï¼Œé€‰æ‹©å¹¶è¡Œæˆ–è€…JVMè‡ªå·±é€‰æ‹© </li>
<li>å¦‚æœæ˜¯å¤šCPUã€è¿½æ±‚ä½åœé¡¿æ—¶é—´ï¼Œéœ€å¿«é€Ÿå“åº”ï¼ˆæ¯”å¦‚å»¶è¿Ÿä¸èƒ½è¶…è¿‡1ç§’ï¼Œå¦‚äº’è”ç½‘åº”ç”¨ï¼‰ï¼Œä½¿ç”¨å¹¶å‘æ”¶é›†å™¨<br>å®˜æ–¹æ¨èG1ï¼Œæ€§èƒ½é«˜ã€‚ç°åœ¨äº’è”ç½‘çš„é¡¹ç›®ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨G1ã€‚ </li>
</ol>
<p>æœ€åéœ€è¦æ˜ç¡®ä¸€ä¸ªè§‚ç‚¹ï¼š</p>
<ol>
<li>æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨ï¼Œæ›´æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†</li>
<li>è°ƒä¼˜æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ã€ç‰¹å®šéœ€æ±‚ï¼Œä¸å­˜åœ¨ä¸€åŠ³æ°¸é€¸çš„æ”¶é›†å™¨</li>
</ol>
<p><strong>é¢è¯•</strong></p>
<p>å¯¹äºåƒåœ¾æ”¶é›†ï¼Œé¢è¯•å®˜å¯ä»¥å¾ªåºæ¸è¿›ä»ç†è®ºã€å®è·µå„ç§è§’åº¦æ·±å…¥ï¼Œä¹Ÿæœªå¿…æ˜¯è¦æ±‚é¢è¯•è€…ä»€ä¹ˆéƒ½æ‡‚ã€‚ä½†å¦‚æœä½ æ‡‚å¾—åŸç†ï¼Œä¸€å®šä¼šæˆä¸ºé¢è¯•ä¸­çš„åŠ åˆ†é¡¹ã€‚ è¿™é‡Œè¾ƒé€šç”¨ã€åŸºç¡€æ€§çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<ul>
<li><p> åƒåœ¾æ”¶é›†çš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶ï¼Ÿ </p>
</li>
<li><p> åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„åŸºæœ¬æµç¨‹ã€‚ </p>
</li>
</ul>
<p>å¦å¤–ï¼Œå¤§å®¶éœ€è¦å¤šå…³æ³¨åƒåœ¾å›æ”¶å™¨è¿™ä¸€ç« çš„å„ç§å¸¸ç”¨çš„å‚æ•°</p>
<h3 id="9ï¼ŒGCæ—¥å¿—åˆ†æ"><a href="#9ï¼ŒGCæ—¥å¿—åˆ†æ" class="headerlink" title="9ï¼ŒGCæ—¥å¿—åˆ†æ"></a>9ï¼ŒGCæ—¥å¿—åˆ†æ</h3><p>é€šè¿‡é˜…è¯»Gcæ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£Javaè™šæ‹Ÿæœºå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥ã€‚ å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶çš„å‚æ•°åˆ—è¡¨</p>
<ul>
<li><p><code>-XX:+PrintGC</code> è¾“å‡ºGCæ—¥å¿—ã€‚ç±»ä¼¼ï¼š<code>-verbose:gc</code></p>
</li>
<li><p><code>-XX:+PrintGCDetails</code> è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—</p>
</li>
<li><p><code>-XX:+PrintGCTimestamps</code> è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰</p>
</li>
<li><p><code>-XX:+PrintGCDatestamps</code> è¾“å‡ºGcçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚2013-05-04T21ï¼š53ï¼š59.234+0800ï¼‰</p>
</li>
<li><p><code>-XX:+PrintHeapAtGC</code> åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</p>
</li>
<li><p><code>-Xloggc:../logs/gc.log</code> æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</p>
</li>
</ul>
<p><strong>ä»£ç æ¼”ç¤º</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms60m -Xmx60m -XX:SurvivorRatio=8 -XX:+PrintGCDetails -Xloggc:./logs/gc.log</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  18:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GCLogTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">            <span class="type">byte</span>[] arr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">100</span>];<span class="comment">//100KB</span></span><br><span class="line">            list.add(arr);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ‰“å¼€GCæ—¥å¿—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªåªä¼šæ˜¾ç¤ºæ€»çš„GCå †çš„å˜åŒ–ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) 80832K-&gt;19298K(227840K),0.0084018 secs]</span><br><span class="line">[GC (Metadata GC Threshold) 109499K-&gt;21465K(228352K),0.0184066 secs]</span><br><span class="line">[Full GC (Metadata GC Threshold) 21465K-&gt;16716K(201728K),0.0619261 secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GCã€Full GCï¼šGCçš„ç±»å‹ï¼ŒGCåªåœ¨æ–°ç”Ÿä»£ä¸Šè¿›è¡Œï¼ŒFull GCåŒ…æ‹¬æ°¸ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ã€‚</span><br><span class="line">Allocation Failureï¼šGCå‘ç”Ÿçš„åŸå› ã€‚</span><br><span class="line">80832K-&gt;19298Kï¼šå †åœ¨GCå‰çš„å¤§å°å’ŒGCåçš„å¤§å°ã€‚</span><br><span class="line">228840kï¼šç°åœ¨çš„å †å¤§å°ã€‚</span><br><span class="line">0.0084018 secsï¼šGCæŒç»­çš„æ—¶é—´ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ‰“å¼€GCæ—¥å¿—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc -XX:+PrintGCDetails</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¾“å…¥ä¿¡æ¯å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen:70640K-&gt;10116K(141312K)] 80541K-&gt;20017K(227328K),0.0172573 secs] [Times:user=0.03 sys=0.00,real=0.02 secs]</span><br><span class="line">[GC (Metadata GC Threshold) [PSYoungGen:98859K-&gt;8154K(142336K)] 108760K-&gt;21261K(228352K),0.0151573 secs] [Times:user=0.00 sys=0.01,real=0.02 secs]</span><br><span class="line">[Full GC (Metadata GC Threshold)[PSYoungGen:8154K-&gt;0K(142336K)]</span><br><span class="line">[ParOldGen:13107K-&gt;16809K(62464K)] 21261K-&gt;16809K(204800K),[Metaspace:20599K-&gt;20599K(1067008K)],0.0639732 secs]</span><br><span class="line">[Times:user=0.14 sys=0.00,real=0.06 secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GCï¼ŒFull FCï¼šåŒæ ·æ˜¯GCçš„ç±»å‹</span><br><span class="line">Allocation Failureï¼šGCåŸå› </span><br><span class="line">PSYoungGenï¼šä½¿ç”¨äº†Parallel Scavengeå¹¶è¡Œåƒåœ¾æ”¶é›†å™¨çš„æ–°ç”Ÿä»£GCå‰åå¤§å°çš„å˜åŒ–</span><br><span class="line">ParOldGenï¼šä½¿ç”¨äº†Parallel Oldå¹¶è¡Œåƒåœ¾æ”¶é›†å™¨çš„è€å¹´ä»£GCå‰åå¤§å°çš„å˜åŒ–</span><br><span class="line">Metaspaceï¼š å…ƒæ•°æ®åŒºGCå‰åå¤§å°çš„å˜åŒ–ï¼ŒJDK1.8ä¸­å¼•å…¥äº†å…ƒæ•°æ®åŒºä»¥æ›¿ä»£æ°¸ä¹…ä»£</span><br><span class="line">xxx secsï¼šæŒ‡GCèŠ±è´¹çš„æ—¶é—´</span><br><span class="line">Timesï¼šuserï¼šæŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨èŠ±è´¹çš„æ‰€æœ‰CPUæ—¶é—´ï¼Œsysï¼šèŠ±è´¹åœ¨ç­‰å¾…ç³»ç»Ÿè°ƒç”¨æˆ–ç³»ç»Ÿäº‹ä»¶çš„æ—¶é—´ï¼Œrealï¼šGCä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´ï¼ŒåŒ…æ‹¬å…¶ä»–è¿›ç¨‹å ç”¨æ—¶é—´ç‰‡çš„å®é™…æ—¶é—´ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ‰“å¼€GCæ—¥å¿—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimestamps -XX:+PrintGCDatestamps</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºä¿¡æ¯å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2019-09-24T22:15:24.518+0800: 3.287: [GC (Allocation Failure) [PSYoungGen:136162K-&gt;5113K(136192K)] 141425K-&gt;17632K(222208K),0.0248249 secs] [Times:user=0.05 sys=0.00,real=0.03 secs]</span><br><span class="line"></span><br><span class="line">2019-09-24T22:15:25.559+0800: 4.329: [GC (Metadata GC Threshold) [PSYoungGen:97578K-&gt;10068K(274944K)] 110096K-&gt;22658K(360960K),0.0094071 secs] [Times: user=0.00 sys=0.00,real=0.01 secs]</span><br><span class="line"></span><br><span class="line">2019-09-24T22:15:25.569+0800: 4.338: [Full GC (Metadata GC Threshold) [PSYoungGen:10068K-&gt;0K(274944K)][ParoldGen:12590K-&gt;13564K(56320K)] 22658K-&gt;13564K(331264K),[Metaspace:20590K-&gt;20590K(1067008K)],0.0494875 secs] [Times: user=0.17 sys=0.02,real=0.05 secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼šå¸¦ä¸Šäº†æ—¥æœŸå’Œå®è·µ</p>
<p>å¦‚æœæƒ³æŠŠGCæ—¥å¿—å­˜åˆ°æ–‡ä»¶çš„è¯ï¼Œæ˜¯ä¸‹é¢çš„å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xloggc:/path/to/gc.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æ—¥å¿—è¡¥å……è¯´æ˜</strong></p>
<ul>
<li><p> â€œ<code>[GC</code>â€œå’Œâ€<code>[Full GC</code>â€œè¯´æ˜äº†è¿™æ¬¡åƒåœ¾æ”¶é›†çš„åœé¡¿ç±»å‹ï¼Œå¦‚æœæœ‰â€Fullâ€åˆ™è¯´æ˜GCå‘ç”Ÿäº†â€Stop The Worldâ€ </p>
</li>
<li><p> ä½¿ç”¨Serialæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯Default New Generationï¼Œå› æ­¤æ˜¾ç¤ºçš„æ˜¯â€<code>[DefNew</code>â€œ </p>
</li>
<li><p> ä½¿ç”¨ParNewæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—ä¼šå˜æˆâ€<code>[ParNew</code>â€œï¼Œæ„æ€æ˜¯â€Parallel New Generationâ€ </p>
</li>
<li><p> ä½¿ç”¨Parallel scavengeæ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯â€<code>[PSYoungGen</code>â€œ </p>
</li>
<li><p> è€å¹´ä»£çš„æ”¶é›†å’Œæ–°ç”Ÿä»£é“ç†ä¸€æ ·ï¼Œåå­—ä¹Ÿæ˜¯æ”¶é›†å™¨å†³å®šçš„ </p>
</li>
<li><p> ä½¿ç”¨G1æ”¶é›†å™¨çš„è¯ï¼Œä¼šæ˜¾ç¤ºä¸ºâ€garbage-first heapâ€ </p>
</li>
<li><p>Allocation Failure<br> è¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ã€‚ </p>
</li>
<li><p>[PSYoungGenï¼š5986K-&gt;696K(8704K) ] 5986K-&gt;704K(9216K)<br> ä¸­æ‹¬å·å†…ï¼šGCå›æ”¶å‰å¹´è½»ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£æ€»å¤§å°ï¼‰<br> æ‹¬å·å¤–ï¼šGCå›æ”¶å‰å¹´è½»ä»£å’Œè€å¹´ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å’Œè€å¹´ä»£æ€»å¤§å°ï¼‰ </p>
</li>
<li><p> userä»£è¡¨ç”¨æˆ·æ€å›æ”¶è€—æ—¶ï¼Œsyså†…æ ¸æ€å›æ”¶è€—æ—¶ï¼Œreaå®é™…è€—æ—¶ã€‚ç”±äºå¤šæ ¸çš„åŸå› ï¼Œæ—¶é—´æ€»å’Œå¯èƒ½ä¼šè¶…è¿‡realæ—¶é—´ </p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Heapï¼ˆå †ï¼‰</span><br><span class="line">PSYoungGenï¼ˆParallel Scavengeæ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰total 9216Kï¼Œused 6234K [0x00000000ff600000,0x0000000100000000,0x0000000100000000)</span><br><span class="line">eden spaceï¼ˆå †ä¸­çš„EdenåŒºé»˜è®¤å æ¯”æ˜¯8ï¼‰8192Kï¼Œ768 used [0x00000000ff600000,0x00000000ffc16b08,0x00000000ffe00000)</span><br><span class="line">from spaceï¼ˆå †ä¸­çš„Survivorï¼Œè¿™é‡Œæ˜¯From SurvivoråŒºé»˜è®¤å æ¯”æ˜¯1ï¼‰1024Kï¼Œ 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)</span><br><span class="line">to spaceï¼ˆå †ä¸­çš„Survivorï¼Œè¿™é‡Œæ˜¯to SurvivoråŒºé»˜è®¤å æ¯”æ˜¯1ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹å †çš„åˆ†é…ç­–ç•¥ï¼‰1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)</span><br><span class="line">                                                                         </span><br><span class="line">ParOldGenï¼ˆè€å¹´ä»£æ€»å¤§å°å’Œä½¿ç”¨å¤§å°ï¼‰total 10240Kï¼Œ used 7001K ï¼»0x00000000fec00000,0x00000000ff600000,0x00000000ff600000)</span><br><span class="line">object spaceï¼ˆæ˜¾ç¤ºä¸ªä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰10240Kï¼Œ688 used [0x00000000fec00000,0x00000000ff2d6630,0x00000000ff600000)</span><br><span class="line"></span><br><span class="line">PSPermGenï¼ˆæ°¸ä¹…ä»£æ€»å¤§å°å’Œä½¿ç”¨å¤§å°ï¼‰total 21504Kï¼Œ used 4949K [0x00000000f9a00000,0x00000000faf00000,0x00000000fec00000)</span><br><span class="line">object spaceï¼ˆæ˜¾ç¤ºä¸ªä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œè‡ªå·±èƒ½ç®—å‡ºæ¥ï¼‰21504Kï¼Œ 238 used [0x00000000f9a00000,0x00000000f9ed55e0,0x00000000faf00000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Minor-GCæ—¥å¿—"><a href="#Minor-GCæ—¥å¿—" class="headerlink" title="Minor GCæ—¥å¿—"></a>Minor GCæ—¥å¿—</h4><p><img src="/2022/04/18/JVM/image-20220301191450969.png" alt="image-20220301191450969" loading="lazy"></p>
<h4 id="Full-GCæ—¥å¿—"><a href="#Full-GCæ—¥å¿—" class="headerlink" title="Full GCæ—¥å¿—"></a>Full GCæ—¥å¿—</h4><p><img src="/2022/04/18/JVM/image-20220301191516341.png" alt="image-20220301191516341" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨jdk7 å’Œ jdk8ä¸­åˆ†åˆ«æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * -verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8 -XX:+UseSerialGC</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  0:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GCLogTest1</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testAllocation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] allocation1, allocation2, allocation3, allocation4;</span><br><span class="line">        allocation1 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2</span> * _1MB];</span><br><span class="line">        allocation2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2</span> * _1MB];</span><br><span class="line">        allocation3 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2</span> * _1MB];</span><br><span class="line">        allocation4 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4</span> * _1MB];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] agrs)</span> &#123;</span><br><span class="line">        testAllocation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æ§åˆ¶å°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> chapter5.GCLogTest1</span><br><span class="line">[GC (Allocation Failure) [DefNew: 8177K-&gt;666K(9216K), <span class="number">0.0062102</span> secs] 8177K-&gt;6810K(19456K), <span class="number">0.0062594</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.02</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> <span class="title class_">generation</span>   total 9216K, used 4928K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space 8192K,  <span class="number">52</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff029838</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space 1024K,  <span class="number">65</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff5a6a28</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total 10240K, used 6144K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,  <span class="number">60</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffc00030</span>, <span class="number">0x00000000ffc00200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3302K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 358K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å›¾ç¤º</strong></p>
<p><img src="/2022/04/18/JVM/image-20220301192456647.png" alt="image-20220301192456647" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220301192505603.png" alt="image-20220301192505603" loading="lazy"></p>
<p>å¯ä»¥ç”¨ä¸€äº›å·¥å…·å»åˆ†æè¿™äº›GCæ—¥å¿—</p>
<p>å¸¸ç”¨çš„æ—¥å¿—åˆ†æå·¥å…·æœ‰ï¼šGCViewerã€GCEasyã€GCHistoã€GCLogViewerã€Hpjmeterã€garbagecatç­‰</p>
<h3 id="10ï¼Œåƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•"><a href="#10ï¼Œåƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•" class="headerlink" title="10ï¼Œåƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•"></a>10ï¼Œåƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•</h3><p>GCä»ç„¶å¤„äºé£é€Ÿå‘å±•ä¹‹ä¸­ï¼Œç›®å‰çš„é»˜è®¤é€‰é¡¹G1 GCåœ¨ä¸æ–­çš„è¿›è¡Œæ”¹è¿›ï¼Œå¾ˆå¤šæˆ‘ä»¬åŸæ¥è®¤ä¸ºçš„ç¼ºç‚¹ï¼Œä¾‹å¦‚ä¸²è¡Œçš„Fu11GCã€Card Tableæ‰«æçš„ä½æ•ˆç­‰ï¼Œéƒ½å·²ç»è¢«å¤§å¹…æ”¹è¿›ï¼Œä¾‹å¦‚ï¼ŒJDK10ä»¥åï¼ŒFu11GCå·²ç»æ˜¯å¹¶è¡Œè¿è¡Œï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå…¶è¡¨ç°è¿˜ç•¥ä¼˜äºParallelGCçš„å¹¶è¡ŒFul1GCå®ç°ã€‚</p>
<p>å³ä½¿æ˜¯Serial GCï¼Œè™½ç„¶æ¯”è¾ƒå¤è€ï¼Œä½†æ˜¯ç®€å•çš„è®¾è®¡å’Œå®ç°æœªå¿…å°±æ˜¯è¿‡æ—¶çš„ï¼Œå®ƒæœ¬èº«çš„å¼€é”€ï¼Œä¸ç®¡æ˜¯GCç›¸å…³æ•°æ®ç»“æ„çš„å¼€é”€ï¼Œè¿˜æ˜¯çº¿ç¨‹çš„å¼€é”€ï¼Œéƒ½æ˜¯éå¸¸å°çš„ï¼Œæ‰€ä»¥éšç€äº‘è®¡ç®—çš„å…´èµ·ï¼Œåœ¨Serverlessç­‰æ–°çš„åº”ç”¨åœºæ™¯ä¸‹ï¼ŒSerial GCæ‰¾åˆ°äº†æ–°çš„èˆå°ã€‚</p>
<p>æ¯”è¾ƒä¸å¹¸çš„æ˜¯CMSGCï¼Œå› ä¸ºå…¶ç®—æ³•çš„ç†è®ºç¼ºé™·ç­‰åŸå› ï¼Œè™½ç„¶ç°åœ¨è¿˜æœ‰éå¸¸å¤§çš„ç”¨æˆ·ç¾¤ä½“ï¼Œä½†åœ¨JDK9ä¸­å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶åœ¨JDK14ç‰ˆæœ¬ä¸­ç§»é™¤</p>
<h4 id="10-1ï¼ŒJDK11æ–°ç‰¹æ€§"><a href="#10-1ï¼ŒJDK11æ–°ç‰¹æ€§" class="headerlink" title="10.1ï¼ŒJDK11æ–°ç‰¹æ€§"></a>10.1ï¼ŒJDK11æ–°ç‰¹æ€§</h4><p>Epsilon:A No-Op GarbageCollectorï¼ˆEpsilonåƒåœ¾å›æ”¶å™¨ï¼Œâ€No-Opï¼ˆæ— æ“ä½œï¼‰â€å›æ”¶å™¨ï¼‰<a target="_blank" rel="noopener" href="http://openidk.iava.net/jeps/318">http://openidk.iava.net/jeps/318</a></p>
<p>ZGC:A Scalable Low-Latency Garbage Collectorï¼ˆExperimentalï¼‰ï¼ˆZGCï¼šå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾å›æ”¶å™¨ï¼Œå¤„äºå®éªŒæ€§é˜¶æ®µï¼‰<a target="_blank" rel="noopener" href="http://openidk.iava.net/jeps/318">http://openidk.iava.net/jeps/333</a></p>
<p><img src="/2022/04/18/JVM/image-20220301194830071.png" alt="image-20220301194830071" loading="lazy"></p>
<p>ç°åœ¨G1å›æ”¶å™¨å·²æˆä¸ºé»˜è®¤å›æ”¶å™¨å¥½å‡ å¹´äº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜çœ‹åˆ°äº†å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„æ”¶é›†å™¨ï¼šZGCï¼ˆJDK11å‡ºç°ï¼‰å’ŒShenandoahï¼ˆOpen JDK12ï¼‰ã€‚ä¸»æ‰“ç‰¹ç‚¹ï¼šä½åœé¡¿æ—¶é—´</p>
<p>Shenandoahå‘½åæºäº</p>
<p><img src="/2022/04/18/JVM/image-20220301194925202.png" alt="image-20220301194925202" loading="lazy"></p>
<h4 id="10-2ï¼ŒOpen-JDK12çš„Shenandoash-GC"><a href="#10-2ï¼ŒOpen-JDK12çš„Shenandoash-GC" class="headerlink" title="10.2ï¼ŒOpen JDK12çš„Shenandoash GC"></a>10.2ï¼ŒOpen JDK12çš„Shenandoash GC</h4><p>Open JDK12çš„Shenandoash GCï¼š<strong>ä½åœé¡¿æ—¶é—´çš„GC</strong>ï¼ˆå®éªŒæ€§ï¼‰</p>
<p>Shenandoahï¼Œæ— ç–‘æ˜¯ä¼—å¤šGCä¸­æœ€å­¤ç‹¬çš„ä¸€ä¸ªã€‚æ˜¯ç¬¬ä¸€æ¬¾ä¸ç”±oracleå…¬å¸å›¢é˜Ÿé¢†å¯¼å¼€å‘çš„Hotspotåƒåœ¾æ”¶é›†å™¨ã€‚ä¸å¯é¿å…çš„å—åˆ°å®˜æ–¹çš„æ’æŒ¤ã€‚æ¯”å¦‚å·ç§°OpenJDKå’ŒOracleJDKæ²¡æœ‰åŒºåˆ«çš„Oracleå…¬å¸ä»æ‹’ç»åœ¨OracleJDK12ä¸­æ”¯æŒShenandoahã€‚</p>
<p>Shenandoahåƒåœ¾å›æ”¶å™¨æœ€åˆç”±RedHatè¿›è¡Œçš„ä¸€é¡¹åƒåœ¾æ”¶é›†å™¨ç ”ç©¶é¡¹ç›®Pauseless GCçš„å®ç°ï¼Œæ—¨åœ¨é’ˆå¯¹JVMä¸Šçš„å†…å­˜å›æ”¶å®ç°ä½åœé¡¿çš„éœ€æ±‚.ã€‚åœ¨2014å¹´è´¡çŒ®ç»™OpenJDKã€‚</p>
<p>Red Hatç ”å‘Shenandoahå›¢é˜Ÿå¯¹å¤–å®£ç§°ï¼Œ<strong>Shenandoahåƒåœ¾å›æ”¶å™¨çš„æš‚åœæ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œè¿™æ„å‘³ç€æ— è®ºå°†å †è®¾ç½®ä¸º200MBè¿˜æ˜¯200GBï¼Œ99.9%çš„ç›®æ ‡éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…ã€‚</strong>ä¸è¿‡å®é™…ä½¿ç”¨æ€§èƒ½å°†å–å†³äºå®é™…å·¥ä½œå †çš„å¤§å°å’Œå·¥ä½œè´Ÿè½½ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220301200112971.png" alt="image-20220301200112971" loading="lazy"></p>
<p>è¿™æ˜¯RedHatåœ¨2016å¹´å‘è¡¨çš„è®ºæ–‡æ•°æ®ï¼Œæµ‹è¯•å†…å®¹æ˜¯ä½¿ç”¨Eså¯¹200GBçš„ç»´åŸºç™¾ç§‘æ•°æ®è¿›è¡Œç´¢å¼•ã€‚ä»ç»“æœçœ‹ï¼š</p>
<ul>
<li><p>åœé¡¿æ—¶é—´æ¯”å…¶ä»–å‡ æ¬¾æ”¶é›†å™¨ç¡®å®æœ‰äº†è´¨çš„é£è·ƒï¼Œä½†ä¹Ÿæœªå®ç°æœ€å¤§åœé¡¿æ—¶é—´æ§åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ç›®æ ‡ã€‚</p>
</li>
<li><p>è€Œ<strong>ååé‡æ–¹é¢å‡ºç°äº†æ˜æ˜¾çš„ä¸‹é™</strong>ï¼Œæ€»è¿è¡Œæ—¶é—´æ˜¯æ‰€æœ‰æµ‹è¯•æ”¶é›†å™¨é‡Œæœ€é•¿çš„ã€‚</p>
</li>
</ul>
<p>æ€»ç»“</p>
<ul>
<li><p>Shenandoah GCçš„å¼±é¡¹ï¼šé«˜è¿è¡Œè´Ÿæ‹…ä¸‹çš„ååé‡ä¸‹é™ã€‚</p>
</li>
<li><p>Shenandoah GCçš„å¼ºé¡¹ï¼šä½å»¶è¿Ÿæ—¶é—´ã€‚</p>
</li>
<li><p>Shenandoah GCçš„å·¥ä½œè¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä¹ä¸ªé˜¶æ®µç»ã€‚</p>
</li>
</ul>
<h4 id="10-3ï¼Œä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ZGC"><a href="#10-3ï¼Œä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ZGC" class="headerlink" title="10.3ï¼Œä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ZGC"></a>10.3ï¼Œä»¤äººéœ‡æƒŠã€é©å‘½æ€§çš„ZGC</h4><p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/12/gctuning/">https://docs.oracle.com/en/java/javase/12/gctuning/</a></p>
<p><img src="/2022/04/18/JVM/image-20220301200417114.png" alt="image-20220301200417114" loading="lazy"></p>
<p>ZGCä¸Shenandoahç›®æ ‡é«˜åº¦ç›¸ä¼¼ï¼Œ<strong>åœ¨å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤§çš„å‰æä¸‹ï¼Œå®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¢‡æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ä½å»¶è¿Ÿã€‚</strong></p>
<p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸€ä¹¦ä¸­è¿™æ ·å®šä¹‰ZGCï¼š<strong>ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œï¼ˆæš‚æ—¶ï¼‰ä¸è®¾åˆ†ä»£çš„ï¼Œä½¿ç”¨äº†è¯»å±éšœã€æŸ“è‰²æŒ‡é’ˆå’Œå†…å­˜å¤šé‡æ˜ å°„ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-å‹ç¼©ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</strong></p>
<p>ZGCçš„å·¥ä½œè¿‡ç¨‹å¯ä»¥åˆ†ä¸º4ä¸ªé˜¶æ®µï¼šå¹¶å‘æ ‡è®° - å¹¶å‘é¢„å¤‡é‡åˆ†é… - å¹¶å‘é‡åˆ†é… - å¹¶å‘é‡æ˜ å°„ ç­‰ã€‚</p>
<p>ZGCä¹åœ¨æ‰€æœ‰åœ°æ–¹å¹¶å‘æ‰§è¡Œçš„ï¼Œé™¤äº†åˆå§‹æ ‡è®°çš„æ˜¯STwçš„ã€‚æ‰€ä»¥åœé¡¿æ—¶é—´å‡ ä¹å°±è€—è´¹åœ¨åˆå§‹æ ‡è®°ä¸Šï¼Œè¿™éƒ¨åˆ†çš„å®é™…æ—¶é—´æ˜¯éå¸¸å°‘çš„ã€‚</p>
<p>æµ‹è¯•æ•°æ®ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220301200554429.png" alt="image-20220301200554429" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220301200609378.png" alt="image-20220301200609378" loading="lazy"></p>
<p>åœ¨ZGCçš„å¼ºé¡¹åœé¡¿æ—¶é—´æµ‹è¯•ä¸Šï¼Œå®ƒæ¯«ä¸ç•™æƒ…çš„å°†Parallelã€G1æ‹‰å¼€äº†ä¸¤ä¸ªæ•°é‡çº§çš„å·®è·ã€‚æ— è®ºå¹³å‡åœé¡¿ã€95ï¼…åœé¡¿ã€99ï¼…åœé¡¿ã€99.9ï¼…åœé¡¿ï¼Œè¿˜æ˜¯æœ€å¤§åœé¡¿æ—¶é—´ï¼ŒZGCéƒ½èƒ½æ¯«ä¸è´¹åŠ²æ§åˆ¶åœ¨10æ¯«ç§’ä»¥å†…ã€‚</p>
<p>è™½ç„¶ZGCè¿˜åœ¨è¯•éªŒçŠ¶æ€ï¼Œæ²¡æœ‰å®Œæˆæ‰€æœ‰ç‰¹æ€§ï¼Œä½†æ­¤æ—¶æ€§èƒ½å·²ç»ç›¸å½“äº®çœ¼ï¼Œç”¨â€œä»¤äººéœ‡æƒŠã€é©å‘½æ€§â€æ¥å½¢å®¹ï¼Œä¸ä¸ºè¿‡ã€‚ æœªæ¥å°†åœ¨æœåŠ¡ç«¯ã€å¤§å†…å­˜ã€ä½å»¶è¿Ÿåº”ç”¨çš„é¦–é€‰åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p>å¦‚æœæƒ³è¦å­¦ä¹ ç›¸å…³çŸ¥è¯†å¯ä»¥çœ‹:</p>
<p><img src="/2022/04/18/JVM/image-20220301200709311.png" alt="image-20220301200709311" loading="lazy"></p>
<p>JEP 364ï¼šZGCåº”ç”¨åœ¨macosä¸Š</p>
<p>JEP 365ï¼šZGCåº”ç”¨åœ¨Windowsä¸Š</p>
<p>JDK14ä¹‹å‰ï¼ŒZGCä»…Linuxæ‰æ”¯æŒã€‚</p>
<p>å°½ç®¡è®¸å¤šä½¿ç”¨zGcçš„ç”¨æˆ·éƒ½ä½¿ç”¨ç±»Linuxçš„ç¯å¢ƒï¼Œä½†åœ¨Windowså’Œmacosä¸Šï¼Œäººä»¬ä¹Ÿéœ€è¦ZGCè¿›è¡Œå¼€å‘éƒ¨ç½²å’Œæµ‹è¯•ã€‚è®¸å¤šæ¡Œé¢åº”ç”¨ä¹Ÿå¯ä»¥ä»ZGCä¸­å—ç›Šã€‚å› æ­¤ï¼ŒZGCç‰¹æ€§è¢«ç§»æ¤åˆ°äº†Windowså’Œmacosä¸Šã€‚</p>
<p>ç°åœ¨macæˆ–Windowsä¸Šä¹Ÿèƒ½ä½¿ç”¨zGCäº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10-4ï¼Œå…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC"><a href="#10-4ï¼Œå…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC" class="headerlink" title="10.4ï¼Œå…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC"></a>10.4ï¼Œå…¶ä»–åƒåœ¾å›æ”¶å™¨ï¼šAliGC</h3><p>AliGCæ˜¯é˜¿é‡Œå·´å·´JVMå›¢é˜ŸåŸºäºG1ç®—æ³•ï¼Œé¢å‘å¤§å †ï¼ˆLargeHeapï¼‰åº”ç”¨åœºæ™¯ã€‚æŒ‡å®šåœºæ™¯ä¸‹çš„å¯¹æ¯”ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220301200822654.png" alt="image-20220301200822654" loading="lazy"></p>
<p>å½“ç„¶ï¼Œå…¶å®ƒå‚å•†ä¹Ÿæä¾›äº†å„ç§åˆ«å…·ä¸€æ ¼çš„GCå®ç°ï¼Œä¾‹å¦‚æ¯”è¾ƒæœ‰åçš„ä½å»¶è¿ŸGCï¼šZingï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒæä¾›çš„é“¾æ¥ <a target="_blank" rel="noopener" href="https://www.infoq.com/articles/azul_gc_in_detail">https://www.infoq.com/articles/azul_gc_in_detail</a></p>
<h1 id="å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡"><a href="#å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡" class="headerlink" title="å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡"></a>å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡</h1><p><strong>è§£æä»£ç å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        num = num + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ä¸€ï¼ŒClassæ–‡ä»¶ç»“æ„"><a href="#ä¸€ï¼ŒClassæ–‡ä»¶ç»“æ„" class="headerlink" title="ä¸€ï¼ŒClassæ–‡ä»¶ç»“æ„"></a>ä¸€ï¼ŒClassæ–‡ä»¶ç»“æ„</h2><h3 id="1ï¼ŒClasså­—èŠ‚ç æ–‡ä»¶ç»“æ„"><a href="#1ï¼ŒClasså­—èŠ‚ç æ–‡ä»¶ç»“æ„" class="headerlink" title="1ï¼ŒClasså­—èŠ‚ç æ–‡ä»¶ç»“æ„"></a>1ï¼ŒClasså­—èŠ‚ç æ–‡ä»¶ç»“æ„</h3><p><img src="/2022/04/18/JVM/image-20220302163951552.png" alt="image-20220302163951552" loading="lazy"></p>
<h3 id="2ï¼ŒClassæ–‡ä»¶æ•°æ®ç±»å‹"><a href="#2ï¼ŒClassæ–‡ä»¶æ•°æ®ç±»å‹" class="headerlink" title="2ï¼ŒClassæ–‡ä»¶æ•°æ®ç±»å‹"></a>2ï¼ŒClassæ–‡ä»¶æ•°æ®ç±»å‹</h3><p><img src="/2022/04/18/JVM/image-20220302164026485.png" alt="image-20220302164026485" loading="lazy"></p>
<h3 id="3ï¼Œé­”æ•°"><a href="#3ï¼Œé­”æ•°" class="headerlink" title="3ï¼Œé­”æ•°"></a>3ï¼Œé­”æ•°</h3><p><strong>Magic Numberï¼ˆé­”æ•°ï¼‰</strong></p>
<ul>
<li><p>æ¯ä¸ªClassæ–‡ä»¶å¼€å¤´çš„4ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰</p>
</li>
<li><p>å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„æœ‰æ•ˆåˆæ³•çš„Classæ–‡ä»¶ã€‚å³ï¼šé­”æ•°æ˜¯Classæ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚</p>
</li>
<li><p>é­”æ•°å€¼å›ºå®šä¸º0xCAFEBABEã€‚ä¸ä¼šæ”¹å˜ã€‚</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªClassæ–‡ä»¶ä¸ä»¥0xCAFEBABEå¼€å¤´ï¼Œè™šæ‹Ÿæœºåœ¨è¿›è¡Œæ–‡ä»¶æ ¡éªŒçš„æ—¶å€™å°±ä¼šç›´æ¥æŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error: A JNI error has occurred, please check your installation and <span class="keyword">try</span> again</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.ClassFormatError: Incompatible magic value <span class="number">1885430635</span> in <span class="keyword">class</span> <span class="title class_">file</span> StringTest</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„åœ°æ”¹åŠ¨ã€‚</li>
</ul>
<h3 id="4ï¼Œæ–‡ä»¶ç‰ˆæœ¬å·"><a href="#4ï¼Œæ–‡ä»¶ç‰ˆæœ¬å·" class="headerlink" title="4ï¼Œæ–‡ä»¶ç‰ˆæœ¬å·"></a>4ï¼Œæ–‡ä»¶ç‰ˆæœ¬å·</h3><p>ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚åŒæ ·ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ã€‚ç¬¬5ä¸ªå’Œç¬¬6ä¸ªå­—èŠ‚æ‰€ä»£è¡¨çš„å«ä¹‰å°±æ˜¯ç¼–è¯‘çš„å‰¯ç‰ˆæœ¬å·minor_versionï¼Œè€Œç¬¬7ä¸ªå’Œç¬¬8ä¸ªå­—èŠ‚å°±æ˜¯ç¼–è¯‘çš„ä¸»ç‰ˆæœ¬å·major_versionã€‚</p>
<p>å®ƒä»¬å…±åŒæ„æˆäº†classæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ã€‚è­¬å¦‚æŸä¸ªClassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·ä¸ºMï¼Œå‰¯ç‰ˆæœ¬å·ä¸ºmï¼Œé‚£ä¹ˆè¿™ä¸ªClassæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·å°±ç¡®å®šä¸ºM.mã€‚</p>
<p>ç‰ˆæœ¬å·å’ŒJavaç¼–è¯‘å™¨çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š</p>
<h4 id="4-1ï¼ŒClassæ–‡ä»¶ç‰ˆæœ¬å·å¯¹åº”å…³ç³»"><a href="#4-1ï¼ŒClassæ–‡ä»¶ç‰ˆæœ¬å·å¯¹åº”å…³ç³»" class="headerlink" title="4.1ï¼ŒClassæ–‡ä»¶ç‰ˆæœ¬å·å¯¹åº”å…³ç³»"></a>4.1ï¼ŒClassæ–‡ä»¶ç‰ˆæœ¬å·å¯¹åº”å…³ç³»</h4><p><img src="/2022/04/18/JVM/image-20220302164500434.png" alt="image-20220302164500434" loading="lazy"></p>
<p>Javaçš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ã€‚</p>
<p>ä¸åŒç‰ˆæœ¬çš„Javaç¼–è¯‘å™¨ç¼–è¯‘çš„Classæ–‡ä»¶å¯¹åº”çš„ç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚ç›®å‰ï¼Œé«˜ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”±ä½ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºä¸èƒ½æ‰§è¡Œç”±é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ã€‚å¦åˆ™JVMä¼šæŠ›å‡ºjava.lang.UnsupportedClassVersionErrorå¼‚å¸¸ã€‚ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¥é—®é¢˜çš„å‘ç”Ÿã€‚å› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¼€å‘æ—¶ï¼Œç‰¹åˆ«æ³¨æ„å¼€å‘ç¼–è¯‘çš„JDKç‰ˆæœ¬å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„JDKç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚</p>
<ul>
<li>è™šæ‹ŸæœºJDKç‰ˆæœ¬ä¸º1.kï¼ˆk&gt;=2ï¼‰æ—¶ï¼Œå¯¹åº”çš„classæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·çš„èŒƒå›´ä¸º45.0 - 44+k.0ï¼ˆå«ä¸¤ç«¯ï¼‰ã€‚</li>
</ul>
<h3 id="5ï¼Œå¸¸é‡æ± é›†åˆ"><a href="#5ï¼Œå¸¸é‡æ± é›†åˆ" class="headerlink" title="5ï¼Œå¸¸é‡æ± é›†åˆ"></a>5ï¼Œå¸¸é‡æ± é›†åˆ</h3><p>å¸¸é‡æ± æ˜¯Classæ–‡ä»¶ä¸­å†…å®¹æœ€ä¸ºä¸°å¯Œçš„åŒºåŸŸä¹‹ä¸€ã€‚å¸¸é‡æ± å¯¹äºClassæ–‡ä»¶ä¸­çš„å­—æ®µå’Œæ–¹æ³•è§£æä¹Ÿæœ‰ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p>
<p>éšç€Javaè™šæ‹Ÿæœºçš„ä¸æ–­å‘å±•ï¼Œå¸¸é‡æ± çš„å†…å®¹ä¹Ÿæ—¥æ¸ä¸°å¯Œã€‚å¯ä»¥è¯´ï¼Œå¸¸é‡æ± æ˜¯æ•´ä¸ªClassæ–‡ä»¶çš„åŸºçŸ³ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220302164601099.png" alt="image-20220302164601099" loading="lazy"></p>
<p>åœ¨ç‰ˆæœ¬å·ä¹‹åï¼Œç´§è·Ÿç€çš„æ˜¯å¸¸é‡æ± çš„æ•°é‡ï¼Œä»¥åŠè‹¥å¹²ä¸ªå¸¸é‡æ± è¡¨é¡¹ã€‚</p>
<p>å¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨å¸¸é‡æ± çš„å…¥å£éœ€è¦æ”¾ç½®ä¸€é¡¹u2ç±»å‹çš„æ— ç¬¦å·æ•°ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆconstant_pool_countï¼‰ã€‚ä¸Javaä¸­è¯­è¨€ä¹ æƒ¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220302164622006.png" alt="image-20220302164622006" loading="lazy"></p>
<p>ç”±ä¸Šè¡¨å¯è§ï¼ŒClassæ–‡ä»¶ä½¿ç”¨äº†ä¸€ä¸ªå‰ç½®çš„å®¹é‡è®¡æ•°å™¨ï¼ˆconstant_pool_countï¼‰åŠ è‹¥å¹²ä¸ªè¿ç»­çš„æ•°æ®é¡¹ï¼ˆconstant_poolï¼‰çš„å½¢å¼æ¥æè¿°å¸¸é‡æ± å†…å®¹ã€‚æˆ‘ä»¬æŠŠè¿™ä¸€ç³»åˆ—è¿ç»­å¸¸é‡æ± æ•°æ®ç§°ä¸ºå¸¸é‡æ± é›†åˆã€‚</p>
<ul>
<li>å¸¸é‡æ± è¡¨é¡¹ä¸­ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æ—¶æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾</li>
</ul>
<h4 id="5-1ï¼Œå¸¸é‡æ± è®¡æ•°å™¨"><a href="#5-1ï¼Œå¸¸é‡æ± è®¡æ•°å™¨" class="headerlink" title="5.1ï¼Œå¸¸é‡æ± è®¡æ•°å™¨"></a>5.1ï¼Œå¸¸é‡æ± è®¡æ•°å™¨</h4><p><strong>constant_pool_countï¼ˆå¸¸é‡æ± è®¡æ•°å™¨ï¼‰</strong></p>
<ul>
<li><p>ç”±äºå¸¸é‡æ± çš„æ•°é‡ä¸å›ºå®šï¼Œæ—¶é•¿æ—¶çŸ­ï¼Œæ‰€ä»¥éœ€è¦æ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚</p>
</li>
<li><p>å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆu2ç±»å‹ï¼‰ï¼šä»1å¼€å§‹ï¼Œè¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰å¤šå°‘é¡¹å¸¸é‡ã€‚å³constant_pool_count=1è¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰0ä¸ªå¸¸é‡é¡¹ã€‚</p>
</li>
<li><p>Demoçš„å€¼ä¸ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302164709921.png" alt="image-20220302164709921" loading="lazy"></p>
</li>
</ul>
<p>å…¶å€¼ä¸º0x0016ï¼ŒææŒ‡ä¸€ç®—ï¼Œä¹Ÿå°±æ˜¯22ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å®é™…ä¸Šåªæœ‰21é¡¹å¸¸é‡ã€‚ç´¢å¼•ä¸ºèŒƒå›´æ˜¯1-21ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>é€šå¸¸æˆ‘ä»¬å†™ä»£ç æ—¶éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„å¸¸é‡æ± å´æ˜¯ä»1å¼€å§‹ï¼Œå› ä¸ºå®ƒæŠŠç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥äº†ã€‚<strong>è¿™æ˜¯ä¸ºäº†æ»¡è¶³åé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œè¿™ç§æƒ…å†µå¯ç”¨ç´¢å¼•å€¼0æ¥è¡¨ç¤ºã€‚</strong></p>
<h4 id="5-2ï¼Œå¸¸é‡æ± è¡¨"><a href="#5-2ï¼Œå¸¸é‡æ± è¡¨" class="headerlink" title="5.2ï¼Œå¸¸é‡æ± è¡¨"></a>5.2ï¼Œå¸¸é‡æ± è¡¨</h4><p>constant_poolæ˜¯ä¸€ç§è¡¨ç»“æ„ï¼Œä»¥1 ~ constant_pool_count - 1ä¸ºç´¢å¼•ã€‚è¡¨æ˜äº†åé¢æœ‰å¤šå°‘ä¸ªå¸¸é‡é¡¹ã€‚</p>
<p>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰</p>
<p>å®ƒåŒ…å«äº†classæ–‡ä»¶ç»“æ„åŠå…¶å­ç»“æ„ä¸­å¼•ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–æ¥å£åã€å­—æ®µåå’Œå…¶ä»–å¸¸é‡ã€‚å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½å…·å¤‡ç›¸åŒçš„ç‰¹å¾ã€‚ç¬¬1ä¸ªå­—èŠ‚ä½œä¸ºç±»å‹æ ‡è®°ï¼Œç”¨äºç¡®å®šè¯¥é¡¹çš„æ ¼å¼ï¼Œè¿™ä¸ªå­—èŠ‚ç§°ä¸ºtag byteï¼ˆæ ‡è®°å­—èŠ‚ã€æ ‡ç­¾å­—èŠ‚ï¼‰ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220302164805126.png" alt="image-20220302164805126" loading="lazy"></p>
<h5 id="â… -å­—é¢é‡å’Œç¬¦å·å¼•ç”¨"><a href="#â… -å­—é¢é‡å’Œç¬¦å·å¼•ç”¨" class="headerlink" title="â… . å­—é¢é‡å’Œç¬¦å·å¼•ç”¨"></a>â… . å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</h5><p>åœ¨å¯¹è¿™äº›å¸¸é‡è§£è¯»å‰ï¼Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µã€‚</p>
<p>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å¦‚ä¸‹è¡¨ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302164854504.png" alt="image-20220302164854504" loading="lazy"></p>
<p><strong>å…¨é™å®šå</strong></p>
<p>com/atguigu/test/Demoè¿™ä¸ªå°±æ˜¯ç±»çš„å…¨é™å®šåï¼Œä»…ä»…æ˜¯æŠŠåŒ…åçš„â€œ.â€œæ›¿æ¢æˆâ€/â€ï¼Œä¸ºäº†ä½¿è¿ç»­çš„å¤šä¸ªå…¨é™å®šåä¹‹é—´ä¸äº§ç”Ÿæ··æ·†ï¼Œåœ¨ä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€œ;â€è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚</p>
<p><strong>ç®€å•åç§°</strong></p>
<p>ç®€å•åç§°æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„ç±»çš„add()æ–¹æ³•å’Œnumå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«æ˜¯addå’Œnumã€‚</p>
<p><strong>æè¿°ç¬¦</strong></p>
<p>æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteã€charã€doubleã€floatã€intã€longã€shortã€booleanï¼‰ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œè¯¦è§ä¸‹è¡¨ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302164920967.png" alt="image-20220302164920967" loading="lazy"></p>
<p>ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·â€œ()â€ä¹‹å†…ã€‚å¦‚æ–¹æ³•java.lang.String tostring()çš„æè¿°ç¬¦ä¸º()Ljava/lang/String; ï¼Œæ–¹æ³•int abc(int[]x, int y)çš„æè¿°ç¬¦ä¸º([II)Iã€‚</p>
<p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p>
<p>è™šæ‹Ÿæœºåœ¨åŠ è½½Classæ–‡ä»¶æ—¶æ‰ä¼šè¿›è¡ŒåŠ¨æ€é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒClassæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•å’Œå­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ã€‚å› æ­¤ï¼Œè¿™äº›å­—æ®µå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ç»è¿‡è½¬æ¢æ˜¯æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨çš„ã€‚å½“è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œéœ€è¦ä»å¸¸é‡æ± ä¸­è·å¾—å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œå†åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„è§£æé˜¶æ®µå°†å…¶æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œå¹¶ç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¸­ã€‚</p>
<p>è¿™é‡Œè¯´æ˜ä¸‹ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„åŒºåˆ«ä¸å…³è”ï¼š</p>
<ul>
<li><p>ç¬¦å·å¼•ç”¨ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°äº†å†…å­˜ä¸­ã€‚</p>
</li>
<li><p>ç›´æ¥å¼•ç”¨ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£è¯´æ˜å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¹‹ä¸­äº†ã€‚</p>
</li>
</ul>
<h5 id="â…¡-å¸¸é‡ç±»å‹å’Œç»“æ„"><a href="#â…¡-å¸¸é‡ç±»å‹å’Œç»“æ„" class="headerlink" title="â…¡. å¸¸é‡ç±»å‹å’Œç»“æ„"></a>â…¡. å¸¸é‡ç±»å‹å’Œç»“æ„</h5><p>å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼ŒJ0K1.7ä¹‹åå…±æœ‰14ç§ä¸åŒçš„è¡¨ç»“æ„æ•°æ®ã€‚å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302165336859.png" alt="image-20220302165336859" loading="lazy"></p>
<p>æ ¹æ®ä¸Šå›¾æ¯ä¸ªç±»å‹çš„æè¿°æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“æ¯ä¸ªç±»å‹æ˜¯ç”¨æ¥æè¿°å¸¸é‡æ± ä¸­å“ªäº›å†…å®¹ï¼ˆä¸»è¦æ˜¯å­—é¢é‡ã€ç¬¦å·å¼•ç”¨ï¼‰çš„ã€‚æ¯”å¦‚:<br>CONSTANT_Integer_infoæ˜¯ç”¨æ¥æè¿°å¸¸é‡æ± ä¸­å­—é¢é‡ä¿¡æ¯çš„ï¼Œè€Œä¸”åªæ˜¯æ•´å‹å­—é¢é‡ä¿¡æ¯ã€‚</p>
<p>æ ‡å¿—ä¸º15ã€16ã€18çš„å¸¸é‡é¡¹ç±»å‹æ˜¯ç”¨æ¥æ”¯æŒåŠ¨æ€è¯­è¨€è°ƒç”¨çš„ï¼ˆjdk1.7æ—¶æ‰åŠ å…¥çš„ï¼‰ã€‚</p>
<p><strong>ç»†èŠ‚è¯´æ˜:</strong></p>
<ul>
<li><p>CONSTANT_Class_infoç»“æ„ç”¨äºè¡¨ç¤ºç±»æˆ–æ¥å£</p>
</li>
<li><p>CONSTAT_Fieldref_infoã€CONSTAHT_Methodref_infoFå’ŒlCONSTANIT_InterfaceMethodref_infoç»“æ„è¡¨ç¤ºå­—æ®µã€æ–¹æ±‡å’ŒæŒ‰å£å°æ³•</p>
</li>
<li><p>CONSTANT_String_infoç»“æ„ç”¨äºè¡¨ç¤ºç¤ºStringç±»å‹çš„å¸¸é‡å¯¹è±¡</p>
</li>
<li><p>CONSTANT_Integer_infoå’ŒCONSTANT_Float_infoè¡¨ç¤º4å­—èŠ‚ï¼ˆintå’Œfloatï¼‰çš„æ•°å€¼å¸¸é‡</p>
</li>
<li><p>CONSTANT_Long_infoå’ŒCONSTAT_Double_infoç»“æ„è¡¨ç¤º8å­—ä½œï¼ˆlongå’Œdoubleï¼‰çš„æ•°å€¼å¸¸é‡ </p>
</li>
<li><ul>
<li>åœ¨classæ–‡ä»¶çš„å¸¸æœ€æ± è¡¨ä¸­ï¼Œæ‰€è¡Œçš„aå­—èŠ‚å¸¸å€Ÿå‡å ä¸¤ä¸ªè¡¨æˆå‘˜ï¼ˆé¡¹ï¼‰çš„ç©ºé—®ã€‚å¦‚æœä¸€ä¸ªCONSTAHT_Long_infoå’ŒCNSTAHT_Double_infoç»“æ„åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ä½nï¼Œåˆ™å¸¸é‡æ± ä¸­ä¸€ä¸ªå¯ç”¨çš„ç´¢å¼•ä½n+2ï¼Œæ­¤æ—¶å¸¸é‡æ± é•¿ä¸­ç´¢å¼•ä¸ºn+1çš„é¡¹ä»ç„¶æœ‰æ•ˆä½†å¿…é¡»è§†ä¸ºä¸å¯ç”¨çš„ã€‚</li>
</ul>
</li>
<li><p>CONSTANT_NameAndType_infoç»“æ„ç”¨äºè¡¨ç¤ºå­—æ®µæˆ–æ–¹æ³•ï¼Œä½†æ˜¯å’Œä¹‹å‰çš„3ä¸ªç»“æ„ä¸åŒï¼ŒCONSTANT_NameAndType_infoç»“æ„æ²¡æœ‰æŒ‡æ˜è¯¥å­—æ®µæˆ–æ–¹æ³•æ‰€å±çš„ç±»æˆ–æ¥å£ã€‚</p>
</li>
<li><p>CONSTANT_Utf8_infoç”¨äºè¡¨ç¤ºå­—ç¬¦å¸¸é‡çš„å€¼</p>
</li>
<li><p>CONSTANT_MethodHandle_infoç»“æ„ç”¨äºè¡¨ç¤ºæ–¹æ³•å¥æŸ„</p>
</li>
<li><p>CONSTANT_MethodType_infoç»“æ„è¡¨ç¤ºæ–¹æ³•ç±»å‹</p>
</li>
<li><p>CONSTANT_InvokeDynamic_infoç»“æ„è¡¨ç¤ºinvokedynamicæŒ‡ä»¤æ‰€ç”¨åˆ°çš„å¼•å¯¼æ–¹æ³•(bootstrap method)ã€å¼•å¯¼æ–¹æ³•æ‰€ç”¨åˆ°çš„åŠ¨æ€è°ƒç”¨åç§°(dynamic invocation name)ã€å‚æ•°å’Œè¿”å›ç±»å‹ï¼Œå¹¶å¯ä»¥ç»™å¼•å¯¼æ–¹æ³•ä¼ å…¥ä¸€ç³»åˆ—ç§°ä¸ºé™æ€å‚æ•°ï¼ˆstatic argumentï¼‰çš„å¸¸é‡ã€‚</p>
</li>
</ul>
<p><strong>è§£ææ–¹æ³•ï¼š</strong></p>
<ul>
<li><p>ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è§£æ</p>
<p><img src="/2022/04/18/JVM/image-20220302165144646.png" alt="image-20220302165144646" loading="lazy"></p>
</li>
<li><p>ä½¿ç”¨javapå‘½ä»¤è§£æï¼šjavap-verbose Demo.classæˆ–jclasslibå·¥å…·ä¼šæ›´æ–¹ä¾¿ã€‚</p>
</li>
</ul>
<p><strong>æ€»ç»“1ï¼š</strong></p>
<ul>
<li><p>è¿™14ç§è¡¨ï¼ˆæˆ–è€…å¸¸é‡é¡¹ç»“æ„ï¼‰çš„å…±åŒç‚¹æ˜¯ï¼šè¡¨å¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ï¼ˆtagï¼‰ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡é¡¹ä½¿ç”¨çš„æ˜¯å“ªç§è¡¨ç»“æ„ï¼Œå³å“ªç§å¸¸é‡ç±»å‹ã€‚</p>
</li>
<li><p>åœ¨å¸¸é‡æ± åˆ—è¡¨ä¸­ï¼ŒCONSTANT_Utf8_infoå¸¸é‡é¡¹æ˜¯ä¸€ç§ä½¿ç”¨æ”¹è¿›è¿‡çš„UTF-8ç¼–ç æ ¼å¼æ¥å­˜å‚¨è¯¸å¦‚æ–‡å­—å­—ç¬¦ä¸²ã€ç±»æˆ–è€…æ¥å£çš„å…¨é™å®šåã€å­—æ®µæˆ–è€…æ–¹æ³•çš„ç®€å•åç§°ä»¥åŠæè¿°ç¬¦ç­‰å¸¸é‡å­—ç¬¦ä¸²ä¿¡æ¯ã€‚</p>
</li>
<li><p>è¿™14ç§å¸¸é‡é¡¹ç»“æ„è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå…¶ä¸­13ä¸ªå¸¸é‡é¡¹å ç”¨çš„å­—èŠ‚å›ºå®šï¼Œåªæœ‰CONSTANT_Utf8_infoå ç”¨å­—èŠ‚ä¸å›ºå®šï¼Œå…¶å¤§å°ç”±lengthå†³å®šã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<strong>å› ä¸ºä»å¸¸é‡æ± å­˜æ”¾çš„å†…å®¹å¯çŸ¥ï¼Œå…¶å­˜æ”¾çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œæœ€ç»ˆè¿™äº›å†…å®¹éƒ½ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²çš„å¤§å°æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶æ‰ç¡®å®š</strong>ï¼Œæ¯”å¦‚ä½ å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»åå¯ä»¥å–é•¿å–çŸ­ï¼Œæ‰€ä»¥åœ¨æ²¡ç¼–è¯‘å‰ï¼Œå¤§å°ä¸å›ºå®šï¼Œç¼–è¯‘åï¼Œé€šè¿‡utf-8ç¼–ç ï¼Œå°±å¯ä»¥çŸ¥é“å…¶é•¿åº¦ã€‚</p>
</li>
</ul>
<p><strong>æ€»ç»“2ï¼š</strong></p>
<ul>
<li><p>å¸¸é‡æ± ï¼šå¯ä»¥ç†è§£ä¸ºClassæ–‡ä»¶ä¹‹ä¸­çš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ç±»å‹ï¼ˆåé¢çš„å¾ˆå¤šæ•°æ®ç±»å‹éƒ½ä¼šæŒ‡å‘æ­¤å¤„ï¼‰ï¼Œä¹Ÿæ˜¯å ç”¨Classæ–‡ä»¶ç©ºé—´æœ€å¤§çš„æ•°æ®é¡¹ç›®ä¹‹ä¸€ã€‚</p>
</li>
<li><p>å¸¸é‡æ± ä¸­ä¸ºä»€ä¹ˆè¦åŒ…å«è¿™äº›å†…å®¹ï¼ŸJavaä»£ç åœ¨è¿›è¡ŒJavacç¼–è¯‘çš„æ—¶å€™ï¼Œå¹¶ä¸åƒCå’ŒC++é‚£æ ·æœ‰â€œè¿æ¥â€è¿™ä¸€æ­¥éª¤ï¼Œè€Œæ˜¯åœ¨è™šæ‹ŸæœºåŠ è½½C1assæ–‡ä»¶çš„æ—¶å€™è¿›è¡ŒåŠ¨æ€é“¾æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨Classæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•ã€å­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤è¿™äº›å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ç»è¿‡è¿è¡ŒæœŸè½¬æ¢çš„è¯æ— æ³•å¾—åˆ°çœŸæ­£çš„å†…å­˜å…¥å£åœ°å€ï¼Œä¹Ÿå°±æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨ã€‚</strong>å½“è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œéœ€è¦ä»å¸¸é‡æ± è·å¾—å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œå†åœ¨ç±»åˆ›å»ºæ—¶æˆ–è¿è¡Œæ—¶è§£æã€ç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¹‹ä¸­ã€‚å…³äºç±»çš„åˆ›å»ºå’ŒåŠ¨æ€é“¾æ¥çš„å†…å®¹ï¼Œåœ¨è™šæ‹Ÿæœºç±»åŠ è½½è¿‡ç¨‹æ—¶å†è¿›è¡Œè¯¦ç»†è®²è§£</p>
</li>
</ul>
<h3 id="6ï¼Œè®¿é—®æ ‡å¿—"><a href="#6ï¼Œè®¿é—®æ ‡å¿—" class="headerlink" title="6ï¼Œè®¿é—®æ ‡å¿—"></a>6ï¼Œè®¿é—®æ ‡å¿—</h3><p><strong>è®¿é—®æ ‡è¯†ï¼ˆaccess_flagã€è®¿é—®æ ‡å¿—ã€è®¿é—®æ ‡è®°ï¼‰</strong></p>
<p>åœ¨å¸¸é‡æ± åï¼Œç´§è·Ÿç€è®¿é—®æ ‡è®°ã€‚è¯¥æ ‡è®°ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸ºabstractç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸ºfinalç­‰ã€‚å„ç§è®¿é—®æ ‡è®°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302221033300.png" alt="image-20220302221033300" loading="lazy"></p>
<p>ç±»çš„è®¿é—®æƒé™é€šå¸¸ä¸ºACC_å¼€å¤´çš„å¸¸é‡ã€‚</p>
<p>æ¯ä¸€ç§ç±»å‹çš„è¡¨ç¤ºéƒ½æ˜¯é€šè¿‡è®¾ç½®è®¿é—®æ ‡è®°çš„32ä½ä¸­çš„ç‰¹å®šä½æ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼Œè‹¥æ˜¯public finalçš„ç±»ï¼Œåˆ™è¯¥æ ‡è®°ä¸ºACC_PUBLIC | ACC_FINALã€‚</p>
<p>ä½¿ç”¨ACC_SUPERå¯ä»¥è®©ç±»æ›´å‡†ç¡®åœ°å®šä½åˆ°çˆ¶ç±»çš„æ–¹æ³•super.method()ï¼Œç°ä»£ç¼–è¯‘å™¨éƒ½ä¼šè®¾ç½®å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ ‡è®°ã€‚</p>
<p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p>
<ol>
<li> å¸¦æœ‰ACC_INTERFACEæ ‡å¿—çš„classæ–‡ä»¶è¡¨ç¤ºçš„æ˜¯æ¥å£è€Œä¸æ˜¯ç±»ï¼Œåä¹‹åˆ™è¡¨ç¤ºçš„æ˜¯ç±»è€Œä¸æ˜¯æ¥å£ã€‚ </li>
</ol>
<ul>
<li><ul>
<li>å¦‚æœä¸€ä¸ªclassæ–‡ä»¶è¢«è®¾ç½®äº†ACC_INTERFACEæ ‡å¿—ï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿå¾—è®¾ç½®ACC_ABSTRACTæ ‡å¿—ã€‚åŒæ—¶å®ƒä¸èƒ½å†è®¾ç½®ACC_FINALã€ACC_SUPER æˆ–ACC_ENUMæ ‡å¿—ã€‚</li>
</ul>
</li>
<li><ul>
<li>å¦‚æœæ²¡æœ‰è®¾ç½®ACC_INTERFACEæ ‡å¿—ï¼Œé‚£ä¹ˆè¿™ä¸ªclassæ–‡ä»¶å¯ä»¥å…·æœ‰ä¸Šè¡¨ä¸­é™¤ACC_ANNOTATIONå¤–çš„å…¶ä»–æ‰€æœ‰æ ‡å¿—ã€‚å½“ç„¶ï¼ŒACC_FINALå’ŒACC_ABSTRACTè¿™ç±»äº’æ–¥çš„æ ‡å¿—é™¤å¤–ã€‚è¿™ä¸¤ä¸ªæ ‡å¿—ä¸å¾—åŒæ—¶è®¾ç½®ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li>ACC_SUPERæ ‡å¿—ç”¨äºç¡®å®šç±»æˆ–æ¥å£é‡Œé¢çš„invokespecialæŒ‡ä»¤ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§æ‰§è¡Œè¯­ä¹‰ã€‚é’ˆå¯¹Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†çš„ç¼–è¯‘å™¨éƒ½åº”å½“è®¾ç½®è¿™ä¸ªæ ‡å¿—ã€‚å¯¹äºJava SE 8åŠåç»­ç‰ˆæœ¬æ¥è¯´ï¼Œæ— è®ºclassæ–‡ä»¶ä¸­è¿™ä¸ªæ ‡å¿—çš„å®é™…å€¼æ˜¯ä»€ä¹ˆï¼Œä¹Ÿä¸ç®¡classæ–‡ä»¶çš„ç‰ˆæœ¬å·æ˜¯å¤šå°‘ï¼ŒJavaè™šæ‹Ÿæœºéƒ½è®¤ä¸ºæ¯ä¸ªclassæ–‡ä»¶å‡è®¾ç½®äº†ACC_SUPERæ ‡å¿—ã€‚ </li>
</ol>
<ul>
<li><ul>
<li>ACC_SUPERæ ‡å¿—æ˜¯ä¸ºäº†å‘åå…¼å®¹ç”±æ—§Javaç¼–è¯‘å™¨æ‰€ç¼–è¯‘çš„ä»£ç è€Œè®¾è®¡çš„ã€‚ç›®å‰çš„ACC_SUPERæ ‡å¿—åœ¨ç”±JDK1.0.2ä¹‹å‰çš„ç¼–è¯‘å™¨æ‰€ç”Ÿæˆçš„access_flagsä¸­æ˜¯æ²¡æœ‰ç¡®å®šå«ä¹‰çš„ï¼Œå¦‚æœè®¾ç½®äº†è¯¥æ ‡å¿—ï¼Œé‚£ä¹ˆ0racleçš„Javaè™šæ‹Ÿæœºå®ç°ä¼šå°†å…¶å¿½ç•¥ã€‚</li>
</ul>
</li>
</ul>
<ol start="3">
<li>ACC_SYNTHETICæ ‡å¿—æ„å‘³ç€è¯¥ç±»æˆ–æ¥å£æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯ç”±æºä»£ç ç”Ÿæˆçš„ã€‚ </li>
<li>æ³¨è§£ç±»å‹å¿…é¡»è®¾ç½®ACC_ANNOTATIONæ ‡å¿—ã€‚å¦‚æœè®¾ç½®äº†ACC_ANNOTATIONæ ‡å¿—ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»è®¾ç½®ACC_INTERFACEæ ‡å¿—ã€‚ </li>
<li>ACC_ENUMæ ‡å¿—è¡¨æ˜è¯¥ç±»æˆ–å…¶çˆ¶ç±»ä¸ºæšä¸¾ç±»å‹ã€‚ </li>
</ol>
<h3 id="7ï¼Œç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•"><a href="#7ï¼Œç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•" class="headerlink" title="7ï¼Œç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•"></a>7ï¼Œç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•</h3><p>åœ¨è®¿é—®æ ‡è®°åï¼Œä¼šæŒ‡å®šè¯¥ç±»çš„ç±»åˆ«ã€çˆ¶ç±»ç±»åˆ«ä»¥åŠå®ç°çš„æ¥å£ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302222857815.png" alt="image-20220302222857815" loading="lazy"></p>
<p>è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<ul>
<li><p>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šå</p>
</li>
<li><p>çˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.1ang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸ºeã€‚</p>
</li>
<li><p>æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementsè¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendsè¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</p>
</li>
</ul>
<h4 id="7-1ï¼Œthis-classï¼ˆç±»ç´¢å¼•ï¼‰"><a href="#7-1ï¼Œthis-classï¼ˆç±»ç´¢å¼•ï¼‰" class="headerlink" title="7.1ï¼Œthis_classï¼ˆç±»ç´¢å¼•ï¼‰"></a>7.1ï¼Œthis_classï¼ˆç±»ç´¢å¼•ï¼‰</h4><p>2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†ç±»çš„å…¨é™å®šåï¼Œå¦‚com/atguigu/java1/Demoã€‚this_classçš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¸¸é‡æ± åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„æˆå‘˜å¿…é¡»ä¸ºCONSTANT_Class_infoç±»å‹ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“è¡¨ç¤ºè¿™ä¸ªclassæ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æ¥å£ã€‚</p>
<h4 id="7-2ï¼Œsuper-classï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰"><a href="#7-2ï¼Œsuper-classï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰" class="headerlink" title="7.2ï¼Œsuper_classï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰"></a>7.2ï¼Œsuper_classï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰</h4><p>2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†å½“å‰ç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ï¼Œå…¶é»˜è®¤ç»§æ‰¿çš„æ˜¯java/lang/objectç±»ã€‚åŒæ—¶ï¼Œç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥å…¶çˆ¶ç±»åªæœ‰ä¸€ä¸ªã€‚</p>
<p>super_classæŒ‡å‘çš„çˆ¶ç±»ä¸èƒ½æ˜¯finalã€‚</p>
<h4 id="7-3ï¼Œinterfaces"><a href="#7-3ï¼Œinterfaces" class="headerlink" title="7.3ï¼Œinterfaces"></a>7.3ï¼Œinterfaces</h4><p>æŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¬¦å·å¼•ç”¨åˆ°æ‰€æœ‰å·²å®ç°çš„æ¥å£</p>
<p>ç”±äºä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤éœ€è¦ä»¥æ•°ç»„å½¢å¼ä¿å­˜å¤šä¸ªæ¥å£çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæ¥å£çš„æ¯ä¸ªç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„CONSTANT_Classï¼ˆå½“ç„¶è¿™é‡Œå°±å¿…é¡»æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯ç±»ï¼‰ã€‚</p>
<h5 id="â… -interfaces-countï¼ˆæ¥å£è®¡æ•°å™¨ï¼‰"><a href="#â… -interfaces-countï¼ˆæ¥å£è®¡æ•°å™¨ï¼‰" class="headerlink" title="â… . interfaces_countï¼ˆæ¥å£è®¡æ•°å™¨ï¼‰"></a>â… . interfaces_countï¼ˆæ¥å£è®¡æ•°å™¨ï¼‰</h5><p>interfaces_counté¡¹çš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£çš„ç›´æ¥è¶…æ¥å£æ•°é‡ã€‚</p>
<h5 id="â…¡-interfaces-ï¼ˆæ¥å£ç´¢å¼•é›†åˆï¼‰"><a href="#â…¡-interfaces-ï¼ˆæ¥å£ç´¢å¼•é›†åˆï¼‰" class="headerlink" title="â…¡. interfaces[]ï¼ˆæ¥å£ç´¢å¼•é›†åˆï¼‰"></a>â…¡. interfaces[]ï¼ˆæ¥å£ç´¢å¼•é›†åˆï¼‰</h5><p>interfaces[]ä¸­æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„æœ‰æ•ˆç´¢å¼•å€¼ï¼Œå®ƒçš„é•¿åº¦ä¸ºinterfaces_countã€‚æ¯ä¸ªæˆå‘˜interfaces[i]å¿…é¡»ä¸ºCONSTANT_Class_infoç»“æ„ï¼Œå…¶ä¸­0 &lt;= i &lt; interfaces_countã€‚åœ¨interfaces[]ä¸­ï¼Œå„æˆå‘˜æ‰€è¡¨ç¤ºçš„æ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æ¥å£é¡ºåºï¼ˆä»å·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æ¥å£ã€‚ï¼ˆå¦‚æœcountä¸º0æ—¶ï¼Œå°±ä¸å­˜åœ¨è¿™ä¸€é¡¹ï¼‰</p>
<h3 id="8ï¼Œå­—æ®µè¡¨é›†åˆ"><a href="#8ï¼Œå­—æ®µè¡¨é›†åˆ" class="headerlink" title="8ï¼Œå­—æ®µè¡¨é›†åˆ"></a>8ï¼Œå­—æ®µè¡¨é›†åˆ</h3><p><strong>fields</strong></p>
<p>ç”¨äºæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å­—æ®µï¼ˆfieldï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨ã€ä»£ç å—å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚</p>
<p>å­—æ®µå«ä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚</p>
<p>å®ƒæŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæè¿°äº†æ¯ä¸ªå­—æ®µçš„å®Œæ•´ä¿¡æ¯ã€‚æ¯”å¦‚å­—æ®µçš„æ ‡è¯†ç¬¦ã€è®¿é—®ä¿®é¥°ç¬¦ï¼ˆpublicã€privateæˆ–protectedï¼‰ã€æ˜¯ç±»å˜é‡è¿˜æ˜¯å®ä¾‹å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰ã€æ˜¯å¦æ˜¯å¸¸é‡ï¼ˆfinalä¿®é¥°ç¬¦ï¼‰ç­‰ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li><p>å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»çˆ¶ç±»æˆ–è€…å®ç°çš„æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æœ‰å¯èƒ½åˆ—å‡ºåŸæœ¬Javaä»£ç ä¹‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚è­¬å¦‚åœ¨å†…éƒ¨ç±»ä¸­ä¸ºäº†ä¿æŒå¯¹å¤–éƒ¨ç±»çš„è®¿é—®æ€§ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»å®ä¾‹çš„å­—æ®µã€‚</p>
</li>
<li><p>åœ¨Javaè¯­è¨€ä¸­å­—æ®µæ˜¯æ— æ³•é‡è½½çš„ï¼Œä¸¤ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ã€ä¿®é¥°ç¬¦ä¸ç®¡æ˜¯å¦ç›¸åŒï¼Œéƒ½å¿…é¡»ä½¿ç”¨ä¸ä¸€æ ·çš„åç§°ï¼Œä½†æ˜¯å¯¹äºå­—èŠ‚ç æ¥è®²ï¼Œå¦‚æœä¸¤ä¸ªå­—æ®µçš„æè¿°ç¬¦ä¸ä¸€è‡´ï¼Œé‚£å­—æ®µé‡åå°±æ˜¯åˆæ³•çš„ã€‚</p>
</li>
</ul>
<h4 id="8-1ï¼Œå­—æ®µè®¡æ•°å™¨"><a href="#8-1ï¼Œå­—æ®µè®¡æ•°å™¨" class="headerlink" title="8.1ï¼Œå­—æ®µè®¡æ•°å™¨"></a>8.1ï¼Œå­—æ®µè®¡æ•°å™¨</h4><p><strong>fields_countï¼ˆå­—æ®µè®¡æ•°å™¨ï¼‰</strong></p>
<p>fields_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶fieldsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</p>
<p>fieldsè¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªfield_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºè¯¥ç±»æˆ–æ¥å£æ‰€å£°æ˜çš„æ‰€æœ‰ç±»å­—æ®µæˆ–è€…å®ä¾‹å­—æ®µï¼Œä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œä¹Ÿä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„é‚£äº›å­—æ®µã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220302223218131.png" alt="image-20220302223218131" loading="lazy"></p>
<h4 id="8-2ï¼Œå­—æ®µè¡¨"><a href="#8-2ï¼Œå­—æ®µè¡¨" class="headerlink" title="8.2ï¼Œå­—æ®µè¡¨"></a>8.2ï¼Œå­—æ®µè¡¨</h4><h5 id="â… -å­—æ®µè¡¨è®¿é—®æ ‡è¯†"><a href="#â… -å­—æ®µè¡¨è®¿é—®æ ‡è¯†" class="headerlink" title="â… . å­—æ®µè¡¨è®¿é—®æ ‡è¯†"></a>â… . å­—æ®µè¡¨è®¿é—®æ ‡è¯†</h5><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå­—æ®µå¯ä»¥è¢«å„ç§å…³é”®å­—å»ä¿®é¥°ï¼Œæ¯”å¦‚ï¼šä½œç”¨åŸŸä¿®é¥°ç¬¦ï¼ˆpublicã€privateã€protectedï¼‰ã€staticä¿®é¥°ç¬¦ã€finalä¿®é¥°ç¬¦ã€volatileä¿®é¥°ç¬¦ç­‰ç­‰ã€‚å› æ­¤ï¼Œå…¶å¯åƒç±»çš„è®¿é—®æ ‡å¿—é‚£æ ·ï¼Œä½¿ç”¨ä¸€äº›æ ‡å¿—æ¥æ ‡è®°å­—æ®µã€‚å­—æ®µçš„è®¿é—®æ ‡å¿—æœ‰å¦‚ä¸‹è¿™äº›ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302223555141.png" alt="image-20220302223555141" loading="lazy"></p>
<h5 id="â…¡-æè¿°ç¬¦ç´¢å¼•"><a href="#â…¡-æè¿°ç¬¦ç´¢å¼•" class="headerlink" title="â…¡. æè¿°ç¬¦ç´¢å¼•"></a>â…¡. æè¿°ç¬¦ç´¢å¼•</h5><p>æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteï¼Œcharï¼Œdoubleï¼Œfloatï¼Œintï¼Œlongï¼Œshortï¼Œbooleanï¼‰åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302223614982.png" alt="image-20220302223614982" loading="lazy"></p>
<h5 id="â…¢-å±æ€§è¡¨é›†åˆ"><a href="#â…¢-å±æ€§è¡¨é›†åˆ" class="headerlink" title="â…¢. å±æ€§è¡¨é›†åˆ"></a>â…¢. å±æ€§è¡¨é›†åˆ</h5><p>ä¸€ä¸ªå­—æ®µè¿˜å¯èƒ½æ‹¥æœ‰ä¸€äº›å±æ€§ï¼Œç”¨äºå­˜å‚¨æ›´å¤šçš„é¢å¤–ä¿¡æ¯ã€‚æ¯”å¦‚åˆå§‹åŒ–å€¼ã€ä¸€äº›æ³¨é‡Šä¿¡æ¯ç­‰ã€‚å±æ€§ä¸ªæ•°å­˜æ”¾åœ¨attribute_countä¸­ï¼Œå±æ€§å…·ä½“å†…å®¹å­˜æ”¾åœ¨attributesæ•°ç»„ä¸­ã€‚(ä¸€èˆ¬åªæœ‰å¸¸é‡æœ‰)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥å¸¸é‡å±æ€§ä¸ºä¾‹ï¼Œç»“æ„ä¸ºï¼š</span></span><br><span class="line">ConstantValue_attribute&#123;</span><br><span class="line">	u2 attribute_name_index;</span><br><span class="line">	u4 attribute_length;</span><br><span class="line">    u2 constantvalue_index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼šå¯¹äºå¸¸é‡å±æ€§è€Œè¨€ï¼Œattribute_lengthå€¼æ’ä¸º2ã€‚</p>
<h3 id="9ï¼Œæ–¹æ³•è¡¨é›†åˆ"><a href="#9ï¼Œæ–¹æ³•è¡¨é›†åˆ" class="headerlink" title="9ï¼Œæ–¹æ³•è¡¨é›†åˆ"></a>9ï¼Œæ–¹æ³•è¡¨é›†åˆ</h3><p>methodsï¼šæŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒå®Œæ•´æè¿°äº†æ¯ä¸ªæ–¹æ³•çš„ç­¾åã€‚</p>
<ul>
<li><p>åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ªmethod_infoé¡¹éƒ½å¯¹åº”ç€ä¸€ä¸ªç±»æˆ–è€…æ¥å£ä¸­çš„æ–¹æ³•ä¿¡æ¯ã€‚æ¯”å¦‚æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ï¼ˆpublicã€privateæˆ–protectedï¼‰ï¼Œæ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä»¥åŠæ–¹æ³•çš„å‚æ•°ä¿¡æ¯ç­‰ã€‚</p>
</li>
<li><p>å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æŠ½è±¡çš„æˆ–è€…ä¸æ˜¯nativeçš„ï¼Œé‚£ä¹ˆå­—èŠ‚ç ä¸­ä¼šä½“ç°å‡ºæ¥ã€‚</p>
</li>
<li><p>ä¸€æ–¹é¢ï¼Œmethodsè¡¨åªæè¿°å½“å‰ç±»æˆ–æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„æ–¹æ³•ã€‚å¦ä¸€æ–¹é¢ï¼Œmethodsè¡¨æœ‰å¯èƒ½ä¼šå‡ºç°ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å…¸å‹çš„ä¾¿æ˜¯ç¼–è¯‘å™¨äº§ç”Ÿçš„æ–¹æ³•ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šç±»ï¼ˆæ¥å£ï¼‰åˆå§‹åŒ–æ–¹æ³•<clinit>()å’Œå®ä¾‹åˆå§‹åŒ–æ–¹æ³•<init>()ï¼‰ã€‚</init></clinit></p>
</li>
</ul>
<p><strong>ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<p>åœ¨Javaè¯­è¨€ä¸­ï¼Œè¦é‡è½½ï¼ˆOverloadï¼‰ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†è¦ä¸åŸæ–¹æ³•å…·æœ‰ç›¸åŒçš„ç®€å•åç§°ä¹‹å¤–ï¼Œè¿˜è¦æ±‚å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªä¸åŸæ–¹æ³•ä¸åŒçš„ç‰¹å¾ç­¾åï¼Œç‰¹å¾ç­¾åå°±æ˜¯ä¸€ä¸ªæ–¹æ³•ä¸­å„ä¸ªå‚æ•°åœ¨å¸¸é‡æ± ä¸­çš„å­—æ®µç¬¦å·å¼•ç”¨çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯å› ä¸ºè¿”å›å€¼ä¸ä¼šåŒ…å«åœ¨ç‰¹å¾ç­¾åä¹‹ä¸­ï¼Œå› æ­¤Javaè¯­è¨€é‡Œæ— æ³•ä»…ä»…ä¾é è¿”å›å€¼çš„ä¸åŒæ¥å¯¹ä¸€ä¸ªå·²æœ‰æ–¹æ³•è¿›è¡Œé‡è½½ã€‚ä½†åœ¨Classæ–‡ä»¶æ ¼å¼ä¸­ï¼Œç‰¹å¾ç­¾åçš„èŒƒå›´æ›´å¤§ä¸€äº›ï¼Œåªè¦æè¿°ç¬¦ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ä¸¤ä¸ªæ–¹æ³•å°±å¯ä»¥å…±å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•æœ‰ç›¸åŒçš„åç§°å’Œç‰¹å¾ç­¾åï¼Œä½†è¿”å›å€¼ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥åˆæ³•å…±å­˜äºåŒä¸€ä¸ªclassæ–‡ä»¶ä¸­ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡Javaè¯­æ³•è§„èŒƒå¹¶ä¸å…è®¸åœ¨ä¸€ä¸ªç±»æˆ–è€…æ¥å£ä¸­å£°æ˜å¤šä¸ªæ–¹æ³•ç­¾åç›¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯å’ŒJavaè¯­æ³•è§„èŒƒç›¸åï¼Œå­—èŠ‚ç æ–‡ä»¶ä¸­å´æ°æ°å…è®¸å­˜æ”¾å¤šä¸ªæ–¹æ³•ç­¾åç›¸åŒçš„æ–¹æ³•ï¼Œå”¯ä¸€çš„æ¡ä»¶å°±æ˜¯è¿™äº›æ–¹æ³•ä¹‹é—´çš„è¿”å›å€¼ä¸èƒ½ç›¸åŒã€‚</p>
<h4 id="9-1ï¼Œæ–¹æ³•è®¡æ•°å™¨"><a href="#9-1ï¼Œæ–¹æ³•è®¡æ•°å™¨" class="headerlink" title="9.1ï¼Œæ–¹æ³•è®¡æ•°å™¨"></a>9.1ï¼Œæ–¹æ³•è®¡æ•°å™¨</h4><p><strong>methods_countï¼ˆæ–¹æ³•è®¡æ•°å™¨ï¼‰</strong></p>
<p>methods_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶methodsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</p>
<p>methodsè¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ã€‚</p>
<h4 id="9-2ï¼Œæ–¹æ³•è¡¨"><a href="#9-2ï¼Œæ–¹æ³•è¡¨" class="headerlink" title="9.2ï¼Œæ–¹æ³•è¡¨"></a>9.2ï¼Œæ–¹æ³•è¡¨</h4><p><strong>methods[]ï¼ˆæ–¹æ³•è¡¨ï¼‰</strong></p>
<p>methodsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªæ–¹æ³•çš„å®Œæ•´æè¿°ã€‚å¦‚æœæŸä¸ªmethod_infoç»“æ„çš„access_flagsé¡¹æ—¢æ²¡æœ‰è®¾ç½®ACC_NATIVEæ ‡å¿—ä¹Ÿæ²¡æœ‰è®¾ç½®ACC_ABSTRACTæ ‡å¿—ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä¸­ä¹Ÿåº”åŒ…å«å®ç°è¿™ä¸ªæ–¹æ³•æ‰€ç”¨çš„Javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚</p>
<p>method_infoç»“æ„å¯ä»¥è¡¨ç¤ºç±»å’Œæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•å’Œç±»æˆ–æ¥å£åˆå§‹åŒ–æ–¹æ³•</p>
<p>æ–¹æ³•è¡¨çš„ç»“æ„å®é™…è·Ÿå­—æ®µè¡¨æ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302225733705.png" alt="image-20220302225733705" loading="lazy"></p>
<p><strong>æ–¹æ³•è¡¨è®¿é—®æ ‡å¿—</strong></p>
<p>è·Ÿå­—æ®µè¡¨ä¸€æ ·ï¼Œæ–¹æ³•è¡¨ä¹Ÿæœ‰è®¿é—®æ ‡å¿—ï¼Œè€Œä¸”ä»–ä»¬çš„æ ‡å¿—æœ‰éƒ¨åˆ†ç›¸åŒï¼Œéƒ¨åˆ†åˆ™ä¸åŒï¼Œæ–¹æ³•è¡¨çš„å…·ä½“è®¿é—®æ ‡å¿—å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302225749163.png" alt="image-20220302225749163" loading="lazy"></p>
<p><strong>å±æ€§</strong></p>
<p>è¿™ä¸ªåŒ…å«çš„å†…å®¹æ¯”è¾ƒå¤šï¼ŒåŒ…å«äº†å…·ä½“çš„å­—èŠ‚ç ç­‰ï¼Œä¸‹é¢çš„ç¯‡å¹…å»ä»‹ç»ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220302225911488.png" alt="image-20220302225911488" loading="lazy"></p>
<h3 id="10ï¼Œå±æ€§è¡¨é›†åˆ"><a href="#10ï¼Œå±æ€§è¡¨é›†åˆ" class="headerlink" title="10ï¼Œå±æ€§è¡¨é›†åˆ"></a>10ï¼Œå±æ€§è¡¨é›†åˆ</h3><p>æ–¹æ³•è¡¨é›†åˆä¹‹åçš„å±æ€§è¡¨é›†åˆï¼ŒæŒ‡çš„æ˜¯classæ–‡ä»¶æ‰€æºå¸¦çš„è¾…åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚è¯¥classæ–‡ä»¶çš„æºæ–‡ä»¶çš„åç§°ã€‚ä»¥åŠä»»ä½•å¸¦æœ‰RetentionPolicy.CLASS æˆ–è€…RetentionPolicy.RUNTIMEçš„æ³¨è§£ã€‚è¿™ç±»ä¿¡æ¯é€šå¸¸è¢«ç”¨äºJavaè™šæ‹Ÿæœºçš„éªŒè¯å’Œè¿è¡Œï¼Œä»¥åŠJavaç¨‹åºçš„è°ƒè¯•ï¼Œä¸€èˆ¬æ— é¡»æ·±å…¥äº†è§£ã€‚</p>
<p>æ­¤å¤–ï¼Œå­—æ®µè¡¨ã€æ–¹æ³•è¡¨éƒ½å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§è¡¨ã€‚ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚</p>
<p>å±æ€§è¡¨é›†åˆçš„é™åˆ¶æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼ï¼Œä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå¹¶ä¸”åªè¦ä¸ä¸å·²æœ‰çš„å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ï¼Œä½†Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶ä¼šå¿½ç•¥æ‰å®ƒä¸è®¤è¯†çš„å±æ€§ã€‚</p>
<h4 id="10-1ï¼Œå±æ€§è®¡æ•°å™¨"><a href="#10-1ï¼Œå±æ€§è®¡æ•°å™¨" class="headerlink" title="10.1ï¼Œå±æ€§è®¡æ•°å™¨"></a>10.1ï¼Œå±æ€§è®¡æ•°å™¨</h4><p><strong>attributes_countï¼ˆå±æ€§è®¡æ•°å™¨ï¼‰</strong></p>
<p>attributes_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶å±æ€§è¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚å±æ€§è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_infoç»“æ„ã€‚</p>
<h4 id="10-2ï¼Œå±æ€§è¡¨"><a href="#10-2ï¼Œå±æ€§è¡¨" class="headerlink" title="10.2ï¼Œå±æ€§è¡¨"></a>10.2ï¼Œå±æ€§è¡¨</h4><p><strong>attributes[]ï¼ˆå±æ€§è¡¨ï¼‰</strong></p>
<p>å±æ€§è¡¨çš„æ¯ä¸ªé¡¹çš„å€¼å¿…é¡»æ˜¯attribute_infoç»“æ„ã€‚å±æ€§è¡¨çš„ç»“æ„æ¯”è¾ƒçµæ´»ï¼Œå„ç§ä¸åŒçš„å±æ€§åªè¦æ»¡è¶³ä»¥ä¸‹ç»“æ„å³å¯ã€‚</p>
<p><strong>å±æ€§çš„é€šç”¨æ ¼å¼</strong></p>
<p><img src="/2022/04/18/JVM/image-20220302230227770.png" alt="image-20220302230227770" loading="lazy"></p>
<p><strong>å±æ€§ç±»å‹</strong></p>
<p>å±æ€§è¡¨å®é™…ä¸Šå¯ä»¥æœ‰å¾ˆå¤šç±»å‹ï¼Œä¸Šé¢çœ‹åˆ°çš„Codeå±æ€§åªæ˜¯å…¶ä¸­ä¸€ç§ï¼ŒJava8é‡Œé¢å®šä¹‰äº†23ç§å±æ€§ã€‚ä¸‹é¢è¿™äº›æ˜¯è™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302230306358.png" alt="image-20220302230306358" loading="lazy"></p>
<p><strong>éƒ¨åˆ†å±æ€§è¯¦è§£</strong></p>
<p><strong>â‘  ConstantValueå±æ€§</strong></p>
<p>ConstantValueå±æ€§è¡¨ç¤ºä¸€ä¸ªå¸¸é‡å­—æ®µçš„å€¼ã€‚ä½äºfield_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ConstantValue_attribute&#123;</span><br><span class="line">	u2 attribute_name_index;</span><br><span class="line">	u4 attribute_length;</span><br><span class="line">	u2 constantvalue_index;<span class="comment">//å­—æ®µå€¼åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹ç»™å‡ºè¯¥å±æ€§è¡¨ç¤ºçš„å¸¸é‡å€¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œå€¼æ˜¯1ongå‹çš„ï¼Œåœ¨å¸¸é‡æ± ä¸­ä¾¿æ˜¯CONSTANT_Longï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>â‘¡ Deprecated å±æ€§</strong></p>
<p>Deprecated å±æ€§æ˜¯åœ¨JDK1.1ä¸ºäº†æ”¯æŒæ³¨é‡Šä¸­çš„å…³é”®è¯@deprecatedè€Œå¼•å…¥çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Deprecated_attribute&#123;</span><br><span class="line">	u2 attribute_name_index;</span><br><span class="line">	u4 attribute_length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>â‘¢ Codeå±æ€§</strong></p>
<p>Codeå±æ€§å°±æ˜¯å­˜æ”¾æ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰æ–¹æ³•è¡¨éƒ½æœ‰Codeå±æ€§ã€‚åƒæ¥å£æˆ–è€…æŠ½è±¡æ–¹æ³•ï¼Œä»–ä»¬æ²¡æœ‰å…·ä½“çš„æ–¹æ³•ä½“ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæœ‰Codeå±æ€§äº†ã€‚Codeå±æ€§è¡¨çš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220302230402547.png" alt="image-20220302230402547" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼šCodeå±æ€§è¡¨çš„å‰ä¸¤é¡¹è·Ÿå±æ€§è¡¨æ˜¯ä¸€è‡´çš„ï¼Œå³Codeå±æ€§è¡¨éµå¾ªå±æ€§è¡¨çš„ç»“æ„ï¼Œåé¢é‚£äº›åˆ™æ˜¯ä»–è‡ªå®šä¹‰çš„ç»“æ„ã€‚</p>
<p><strong>â‘£ InnerClasses å±æ€§</strong></p>
<p>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ç‰¹åˆ«å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºç±»æˆ–æ¥å£çš„Classæ ¼å¼ä¸ºCã€‚å¦‚æœCçš„å¸¸é‡æ± ä¸­åŒ…å«æŸä¸ªCONSTANT_Class_infoæˆå‘˜ï¼Œä¸”è¿™ä¸ªæˆå‘˜æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£ä¸å±äºä»»ä½•ä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆCçš„ClassFileç»“æ„çš„å±æ€§è¡¨ä¸­å°±å¿…é¡»å«æœ‰å¯¹åº”çš„InnerClasseså±æ€§ã€‚InnerClasseså±æ€§æ˜¯åœ¨JDK1.1ä¸­ä¸ºäº†æ”¯æŒå†…éƒ¨ç±»å’Œå†…éƒ¨æ¥å£è€Œå¼•å…¥çš„ï¼Œä½äºClassFileç»“æ„çš„å±æ€§è¡¨ã€‚</p>
<p><strong>â‘¤ LineNumberTableå±æ€§</strong></p>
<p>LineNumberTableå±æ€§æ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äºCodeç»“æ„çš„å±æ€§è¡¨ã€‚</p>
<p>LineNumberTableå±æ€§æ˜¯ç”¨æ¥æè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚è¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥åœ¨è°ƒè¯•çš„æ—¶å€™å®šä½ä»£ç æ‰§è¡Œçš„è¡Œæ•°ã€‚</p>
<ul>
<li>start_pcï¼Œå³å­—èŠ‚ç è¡Œå·ï¼›1ine_numberï¼Œå³Javaæºä»£ç è¡Œå·ã€‚</li>
</ul>
<p>åœ¨Codeå±æ€§çš„å±æ€§è¡¨ä¸­ï¼ŒLineNumberTableå±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ï¼Œæ­¤å¤–ï¼Œå¤šä¸ªLineNumberTableå±æ€§å¯ä»¥å…±åŒè¡¨ç¤ºä¸€ä¸ªè¡Œå·åœ¨æºæ–‡ä»¶ä¸­è¡¨ç¤ºçš„å†…å®¹ï¼Œå³LineNumberTableå±æ€§ä¸éœ€è¦ä¸æºæ–‡ä»¶çš„è¡Œä¸€ä¸€å¯¹åº”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LineNumberTableå±æ€§è¡¨ç»“æ„ï¼š</span></span><br><span class="line">LineNumberTable_attribute&#123;</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 line_number_table_length;</span><br><span class="line">    &#123;</span><br><span class="line">        u2 start_pc;</span><br><span class="line">        u2 line_number;</span><br><span class="line">    &#125; line_number_table[line_number_table_length];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>â‘¥ LocalVariableTableå±æ€§</strong></p>
<p>LocalVariableTableæ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äºCodeå±æ€§çš„å±æ€§è¡¨ä¸­ã€‚å®ƒè¢«è°ƒè¯•å™¨ç”¨äºç¡®å®šæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡çš„ä¿¡æ¯ã€‚åœ¨Codeå±æ€§çš„å±æ€§è¡¨ä¸­ï¼ŒLocalVariableTableå±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ã€‚Codeå±æ€§ä¸­çš„æ¯ä¸ªå±€éƒ¨å˜é‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªLocalVariableTableå±æ€§ã€‚</p>
<ul>
<li>start pc + lengthè¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨å­—èŠ‚ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸèµ·å§‹å’Œç»“æŸçš„åç§»ä½ç½®ï¼ˆthisç”Ÿå‘½å‘¨æœŸä»å¤´eåˆ°ç»“å°¾10ï¼‰</li>
<li>indexå°±æ˜¯è¿™ä¸ªå˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½ï¼ˆæ§½ä½å¯å¤ç”¨ï¼‰</li>
<li>nameå°±æ˜¯å˜é‡å</li>
<li>Descriptorè¡¨ç¤ºå±€éƒ¨å˜é‡ç±»å‹æè¿°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LocalVariableTableå±æ€§è¡¨ç»“æ„ï¼š</span></span><br><span class="line">LocalVariableTable_attribute&#123;</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 local_variable_table_length;</span><br><span class="line">    &#123;</span><br><span class="line">        u2 start_pc;</span><br><span class="line">        u2 length;</span><br><span class="line">        u2 name_index;</span><br><span class="line">        u2 descriptor_index;</span><br><span class="line">        u2 index;</span><br><span class="line">    &#125; local_variable_table[local_variable_table_length];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>â‘¦ Signatureå±æ€§</strong></p>
<p>Signatureå±æ€§æ˜¯å¯é€‰çš„å®šé•¿å±æ€§ï¼Œä½äºClassFileï¼Œfield_infoæˆ–method_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆType Variablesï¼‰æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆParameterized Typesï¼‰ï¼Œåˆ™Signatureå±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚</p>
<p><strong>â‘§ SourceFileå±æ€§</strong></p>
<p>SourceFileå±æ€§ç»“æ„</p>
<p><img src="/2022/04/18/JVM/image-20220302231430870.png" alt="image-20220302231430870" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶é•¿åº¦æ€»æ˜¯å›ºå®šçš„8ä¸ªå­—èŠ‚ã€‚</p>
<p><strong>â‘¨ å…¶ä»–å±æ€§</strong></p>
<p>Javaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§æœ‰20å¤šä¸ªï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œé€šè¿‡ä¸Šé¢å‡ ä¸ªå±æ€§çš„ä»‹ç»ï¼Œåªè¦é¢†ä¼šå…¶ç²¾é«“ï¼Œå…¶ä»–å±æ€§çš„è§£è¯»ä¹Ÿæ˜¯æ˜“å¦‚åæŒã€‚</p>
<h2 id="äºŒï¼Œå­—èŠ‚ç æŒ‡ä»¤é›†"><a href="#äºŒï¼Œå­—èŠ‚ç æŒ‡ä»¤é›†" class="headerlink" title="äºŒï¼Œå­—èŠ‚ç æŒ‡ä»¤é›†"></a>äºŒï¼Œå­—èŠ‚ç æŒ‡ä»¤é›†</h2><h3 id="1ï¼Œæ¦‚è¿°"><a href="#1ï¼Œæ¦‚è¿°" class="headerlink" title="1ï¼Œæ¦‚è¿°"></a>1ï¼Œæ¦‚è¿°</h3><h4 id="1-1ï¼Œæ‰§è¡Œæ¨¡å‹"><a href="#1-1ï¼Œæ‰§è¡Œæ¨¡å‹" class="headerlink" title="1.1ï¼Œæ‰§è¡Œæ¨¡å‹"></a>1.1ï¼Œæ‰§è¡Œæ¨¡å‹</h4><p>å¦‚æœä¸è€ƒè™‘å¼‚å¸¸å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºçš„è§£é‡Šå™¨å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä¼ªä»£ç å½“åšæœ€åŸºæœ¬çš„æ‰§è¡Œæ¨¡å‹æ¥ç†è§£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">do&#123;</span><br><span class="line">    è‡ªåŠ¨è®¡ç®—PCå¯„å­˜å™¨çš„å€¼åŠ 1;</span><br><span class="line">    æ ¹æ®PCå¯„å­˜å™¨çš„æŒ‡ç¤ºä½ç½®ï¼Œä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œç ;</span><br><span class="line">    if(å­—èŠ‚ç å­˜åœ¨æ“ä½œæ•°) ä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œæ•°;</span><br><span class="line">    æ‰§è¡Œæ“ä½œç æ‰€å®šä¹‰çš„æ“ä½œ;</span><br><span class="line">&#125;while(å­—èŠ‚ç é•¿åº¦&gt;0)ï¼›</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2ï¼Œå­—èŠ‚ç ä¸æ•°æ®ç±»å‹"><a href="#1-2ï¼Œå­—èŠ‚ç ä¸æ•°æ®ç±»å‹" class="headerlink" title="1.2ï¼Œå­—èŠ‚ç ä¸æ•°æ®ç±»å‹"></a>1.2ï¼Œå­—èŠ‚ç ä¸æ•°æ®ç±»å‹</h4><p>åœ¨Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­ï¼Œå¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½åŒ…å«äº†å…¶æ“ä½œæ‰€å¯¹åº”çš„æ•°æ®ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œ<strong>iloadæŒ‡ä»¤ç”¨äºä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½intå‹çš„æ•°æ®åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œè€ŒfloadæŒ‡ä»¤åŠ è½½çš„åˆ™æ˜¯floatç±»å‹çš„æ•°æ®ã€‚</strong></p>
<p>å¯¹äºå¤§éƒ¨åˆ†ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡ï¼š</p>
<ul>
<li><p>iä»£è¡¨å¯¹intç±»å‹çš„æ•°æ®æ“ä½œï¼Œ</p>
</li>
<li><p>lä»£è¡¨long</p>
</li>
<li><p>sä»£è¡¨short</p>
</li>
<li><p>bä»£è¡¨byte</p>
</li>
<li><p>cä»£è¡¨char</p>
</li>
<li><p>fä»£è¡¨float</p>
</li>
<li><p>dä»£è¡¨double</p>
</li>
</ul>
<p>ä¹Ÿæœ‰ä¸€äº›æŒ‡ä»¤çš„åŠ©è®°ç¬¦ä¸­æ²¡æœ‰æ˜ç¡®åœ°æŒ‡æ˜æ“ä½œç±»å‹çš„å­—æ¯ï¼Œå¦‚arraylengthæŒ‡ä»¤ï¼Œå®ƒæ²¡æœ‰ä»£è¡¨æ•°æ®ç±»å‹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ“ä½œæ•°æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ã€‚</p>
<p>è¿˜æœ‰å¦å¤–ä¸€äº›æŒ‡ä»¤ï¼Œå¦‚æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤gotoåˆ™æ˜¯ä¸æ•°æ®ç±»å‹æ— å…³çš„ã€‚</p>
<p><strong>å¤§éƒ¨åˆ†çš„æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹byteã€charå’Œshortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°†byteå’Œshortç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±•ï¼ˆSign-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ï¼Œå°†booleanå’Œcharç±»å‹æ•°æ®é›¶ä½æ‰©å±•ï¼ˆZero-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ã€‚</strong>ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨å¤„ç†booleanã€byteã€shortå’Œcharç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„intç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å¯¹äºbooleanã€byteã€shortå’Œcharç±»å‹æ•°æ®çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä½¿ç”¨ç›¸åº”çš„intç±»å‹ä½œä¸ºè¿ç®—ç±»å‹ã€‚</p>
<h4 id="1-3ï¼ŒæŒ‡ä»¤åˆ†æ"><a href="#1-3ï¼ŒæŒ‡ä»¤åˆ†æ" class="headerlink" title="1.3ï¼ŒæŒ‡ä»¤åˆ†æ"></a>1.3ï¼ŒæŒ‡ä»¤åˆ†æ</h4><p>ç”±äºå®Œå…¨ä»‹ç»å’Œå­¦ä¹ è¿™äº›æŒ‡ä»¤éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿæ›´å¿«åœ°ç†Ÿæ‚‰å’Œäº†è§£è¿™äº›åŸºæœ¬æŒ‡ä»¤ï¼Œè¿™é‡Œå°†JVMä¸­çš„å­—èŠ‚ç æŒ‡ä»¤é›†æŒ‰ç”¨é€”å¤§è‡´åˆ†æˆ9ç±»ã€‚</p>
<ul>
<li><p>åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</p>
</li>
<li><p>ç®—æœ¯æŒ‡ä»¤</p>
</li>
<li><p>ç±»å‹è½¬æ¢æŒ‡ä»¤</p>
</li>
<li><p>å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</p>
</li>
<li><p>æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</p>
</li>
<li><p>æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</p>
</li>
<li><p>æ¯”è¾ƒæ§åˆ¶æŒ‡ä»¤</p>
</li>
<li><p>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</p>
</li>
<li><p>åŒæ­¥æ§åˆ¶æŒ‡ä»¤</p>
</li>
</ul>
<p>ï¼ˆè¯´åœ¨å‰é¢ï¼‰åœ¨åšå€¼ç›¸å…³æ“ä½œæ—¶ï¼š</p>
<ul>
<li><p>ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥ä»å±€éƒ¨å˜é‡è¡¨ã€å¸¸é‡æ± ã€å †ä¸­å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨ä¸­ç­‰å–å¾—æ•°æ®ï¼Œè¿™äº›æ•°æ®ï¼ˆå¯èƒ½æ˜¯å€¼ï¼Œå¯èƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼‰è¢«å‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
</li>
<li><p>ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ä»æ“ä½œæ•°æ ˆä¸­å–å‡ºä¸€åˆ°å¤šä¸ªå€¼ï¼ˆpopå¤šæ¬¡ï¼‰ï¼Œå®Œæˆèµ‹å€¼ã€åŠ å‡ä¹˜é™¤ã€æ–¹æ³•ä¼ å‚ã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰æ“ä½œã€‚</p>
</li>
</ul>
<h3 id="2ï¼ŒåŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"><a href="#2ï¼ŒåŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤" class="headerlink" title="2ï¼ŒåŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"></a>2ï¼ŒåŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</h3><h4 id="2-1ï¼Œä½œç”¨"><a href="#2-1ï¼Œä½œç”¨" class="headerlink" title="2.1ï¼Œä½œç”¨"></a>2.1ï¼Œä½œç”¨</h4><p>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤ç”¨äºå°†æ•°æ®ä»æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆä¹‹é—´æ¥å›ä¼ é€’ã€‚</p>
<h4 id="2-2ï¼Œå¸¸ç”¨æŒ‡ä»¤"><a href="#2-2ï¼Œå¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="2.2ï¼Œå¸¸ç”¨æŒ‡ä»¤"></a>2.2ï¼Œå¸¸ç”¨æŒ‡ä»¤</h4><ol>
<li>ã€å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤ã€‘å°†ä¸€ä¸ªå±€éƒ¨å˜é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼š<code>xloadã€xload_&lt;n&gt;</code>ï¼ˆå…¶ä¸­xä¸ºiã€lã€fã€dã€aï¼Œnä¸º0åˆ°3ï¼‰</li>
<li>ã€å¸¸é‡å…¥æ ˆæŒ‡ä»¤ã€‘å°†ä¸€ä¸ªå¸¸é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼š<code>bipushã€sipushã€ldcã€ldc_wã€ldc2_wã€aconst_nullã€iconst_m1ã€iconst_&lt;i&gt;ã€lconst_&lt;l&gt;ï¼‰ã€fconst_&lt;f&gt;ã€dconst_&lt;d&gt;</code></li>
<li>ã€å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤ã€‘å°†ä¸€ä¸ªæ•°å€¼ä»æ“ä½œæ•°æ ˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼š<code>xstoreã€xstore_&lt;n&gt;</code>ï¼ˆå…¶ä¸­xä¸ºiã€lã€fã€dã€aï¼Œnä¸º0åˆ°3ï¼‰ï¼›<code>xastore</code>ï¼ˆå…¶ä¸­xä¸ºiã€lã€fã€dã€aã€bã€cã€sï¼‰</li>
<li>æ‰©å……å±€éƒ¨å˜é‡è¡¨çš„è®¿é—®ç´¢å¼•çš„æŒ‡ä»¤ï¼š<code>wide</code>ã€‚</li>
</ol>
<p>ä¸Šé¢æ‰€åˆ—ä¸¾çš„æŒ‡ä»¤åŠ©è®°ç¬¦ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯ä»¥å°–æ‹¬å·ç»“å°¾çš„ï¼ˆä¾‹å¦‚iload_<n>ï¼‰ã€‚è¿™äº›æŒ‡ä»¤åŠ©è®°ç¬¦å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æŒ‡ä»¤ï¼ˆä¾‹å¦‚iload_<n>ä»£è¡¨äº†<code>iload_0ã€iload_1ã€iload_2</code>å’Œ<code>iload_3</code>è¿™å‡ ä¸ªæŒ‡ä»¤ï¼‰ã€‚è¿™å‡ ç»„æŒ‡ä»¤éƒ½æ˜¯æŸä¸ªå¸¦æœ‰ä¸€ä¸ªæ“ä½œæ•°çš„é€šç”¨æŒ‡ä»¤ï¼ˆä¾‹å¦‚iloadï¼‰çš„ç‰¹æ®Šå½¢å¼ï¼Œå¯¹äºè¿™è‹¥å¹²ç»„ç‰¹æ®ŠæŒ‡ä»¤æ¥è¯´ï¼Œå®ƒä»¬è¡¨é¢ä¸Šæ²¡æœ‰æ“ä½œæ•°ï¼Œä¸éœ€è¦è¿›è¡Œå–æ“ä½œæ•°çš„åŠ¨ä½œï¼Œä½†æ“ä½œæ•°éƒ½éšå«åœ¨æŒ‡ä»¤ä¸­ã€‚</n></n></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬çš„è¯­ä¹‰ä¸åŸç”Ÿçš„é€šç”¨æŒ‡ä»¤å®Œå…¨ä¸€è‡´ï¼ˆä¾‹å¦‚<code>iload_0</code>çš„è¯­ä¹‰ä¸æ“ä½œæ•°ä¸º0æ—¶çš„iloadæŒ‡ä»¤è¯­ä¹‰å®Œå…¨ä¸€è‡´ï¼‰ã€‚åœ¨å°–æ‹¬å·ä¹‹é—´çš„å­—æ¯æŒ‡å®šäº†æŒ‡ä»¤éšå«æ“ä½œæ•°çš„æ•°æ®ç±»å‹ï¼Œ<n>ä»£è¡¨éè´Ÿçš„æ•´æ•°ï¼Œ<i>ä»£è¡¨æ˜¯intç±»å‹æ•°æ®ï¼Œ<l>ä»£è¡¨longç±»å‹ï¼Œ<f>ä»£è¡¨floatç±»å‹ï¼Œ<d>ä»£è¡¨doubleç±»å‹ã€‚</d></f></l></i></n></p>
<p>æ“ä½œbyteã€charã€shortå’Œbooleanç±»å‹æ•°æ®æ—¶ï¼Œç»å¸¸ç”¨intç±»å‹çš„æŒ‡ä»¤æ¥è¡¨ç¤ºã€‚</p>
<h4 id="2-3ï¼Œå†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨"><a href="#2-3ï¼Œå†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="2.3ï¼Œå†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨"></a>2.3ï¼Œå†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨</h4><p><strong>æ“ä½œæ•°æ ˆï¼ˆOperand Stacksï¼‰</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒJavaå­—èŠ‚ç æ˜¯Javaè™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„æŒ‡ä»¤é›†ã€‚å› æ­¤ï¼Œå®ƒä¸Javaè™šæ‹ŸæœºåŸºäºæ ˆçš„è®¡ç®—æ¨¡å‹æ˜¯å¯†ä¸å¯åˆ†çš„ã€‚åœ¨è§£é‡Šæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯å½“ä¸ºJavaæ–¹æ³•åˆ†é…æ ˆæ¡¢æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå¾€å¾€éœ€è¦å¼€è¾Ÿä¸€å—é¢å¤–çš„ç©ºé—´ä½œä¸ºæ“ä½œæ•°æ ˆï¼Œæ¥å­˜æ”¾è®¡ç®—çš„æ“ä½œæ•°ä»¥åŠè¿”å›ç»“æœã€‚</p>
<p>å…·ä½“æ¥è¯´ä¾¿æ˜¯ï¼šæ‰§è¡Œæ¯ä¸€æ¡æŒ‡ä»¤ä¹‹å‰ï¼ŒJavaè™šæ‹Ÿæœºè¦æ±‚è¯¥æŒ‡ä»¤çš„æ“ä½œæ•°å·²è¢«å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šå°†è¯¥æŒ‡ä»¤æ‰€éœ€çš„æ“ä½œæ•°å¼¹å‡ºï¼Œå¹¶ä¸”å°†æŒ‡ä»¤çš„ç»“æœé‡æ–°å‹å…¥æ ˆä¸­ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220303180218379.png" alt="image-20220303180218379" loading="lazy"></p>
<p>ä»¥åŠ æ³•æŒ‡ä»¤iaddä¸ºä¾‹ã€‚å‡è®¾åœ¨æ‰§è¡Œè¯¥æŒ‡ä»¤å‰ï¼Œæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«ä¸ºintå€¼1å’Œintå€¼2ï¼Œé‚£ä¹ˆiaddæŒ‡ä»¤å°†å¼¹å‡ºè¿™ä¸¤ä¸ªintï¼Œå¹¶å°†æ±‚å¾—çš„å’Œintå€¼3å‹å…¥æ ˆä¸­ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220303180233047.png" alt="image-20220303180233047" loading="lazy"></p>
<p>ç”±äºiaddæŒ‡ä»¤åªæ¶ˆè€—æ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œå¯¹äºç¦»æ ˆé¡¶è·ç¦»ä¸º2çš„å…ƒç´ ï¼Œå³å›¾ä¸­çš„é—®å·ï¼Œiadd æŒ‡ä»¤å¹¶ä¸å…³å¿ƒå®ƒæ˜¯å¦å­˜åœ¨ï¼Œæ›´åŠ ä¸ä¼šå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p>
<p><strong>å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</strong></p>
<p>Javaæ–¹æ³•æ ˆæ¡¢çš„å¦å¤–ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†åˆ™æ˜¯å±€éƒ¨å˜é‡åŒºï¼Œå­—èŠ‚ç ç¨‹åºå¯ä»¥å°†è®¡ç®—çš„ç»“æœç¼“å­˜åœ¨å±€éƒ¨å˜é‡åŒºä¹‹ä¸­</p>
<p>å®é™…ä¸Šï¼ŒJavaè™šæ‹Ÿæœºå°†å±€éƒ¨å˜é‡åŒºå½“æˆä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡å­˜æ”¾thisæŒ‡é’ˆï¼ˆä»…éé™æ€æ–¹æ³•ï¼‰ï¼Œæ‰€ä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠå­—èŠ‚ç ä¸­çš„å±€éƒ¨å˜é‡ã€‚</p>
<p>å’Œæ“ä½œæ•°æ ˆä¸€æ ·ï¼Œlongç±»å‹ä»¥åŠdoubleç±»å‹çš„å€¼å°†å æ®ä¸¤ä¸ªå•å…ƒï¼Œå…¶ä½™ç±»å‹ä»…å æ®ä¸€ä¸ªå•å…ƒã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220303180250150.png" alt="image-20220303180250150" loading="lazy"></p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(<span class="type">long</span> l, <span class="type">float</span> f)</span> &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello, World&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å›¾ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220303180326273.png" alt="image-20220303180326273" loading="lazy"></p>
<p>thisè¡¨ç¤ºå½“å‰ç±»çš„å¼•ç”¨ï¼Œlå’Œfçš„ç±»å‹çš„å€¼å ä¸¤ä¸ªæ§½ä½ï¼Œiå’Œså˜é‡ç”±äºåˆ†åˆ«åœ¨å„è‡ªä»£ç å—ä¸­ï¼Œæ²¡æœ‰å…±åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥å åŒä¸€ä¸ªæ§½ä½ï¼ˆå³æ§½ä½å¤ç”¨ï¼‰</p>
<p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å±€éƒ¨å˜é‡è¡¨ã€‚å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h4 id="2-4ï¼Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤"><a href="#2-4ï¼Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤" class="headerlink" title="2.4ï¼Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤"></a>2.4ï¼Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">iload ä»å±€éƒ¨å˜é‡ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">lload ä»å±€éƒ¨å˜é‡ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">fload ä»å±€éƒ¨å˜é‡ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">dload ä»å±€éƒ¨å˜é‡ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aload ä»å±€éƒ¨å˜é‡ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼ï¼ˆrefernceï¼‰</span><br><span class="line"></span><br><span class="line">iload_0 ä»å±€éƒ¨å˜é‡0ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">iload_1 ä»å±€éƒ¨å˜é‡1ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">iload_2 ä»å±€éƒ¨å˜é‡2ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">iload_3 ä»å±€éƒ¨å˜é‡3ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">lload_0 ä»å±€éƒ¨å˜é‡0ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">lload_1 ä»å±€éƒ¨å˜é‡1ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">lload_2 ä»å±€éƒ¨å˜é‡2ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">lload_3 ä»å±€éƒ¨å˜é‡3ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">fload_0 ä»å±€éƒ¨å˜é‡0ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">fload_1 ä»å±€éƒ¨å˜é‡1ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">fload_2 ä»å±€éƒ¨å˜é‡2ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">fload_3 ä»å±€éƒ¨å˜é‡3ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">dload_0 ä»å±€éƒ¨å˜é‡0ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">dload_1 ä»å±€éƒ¨å˜é‡1ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">dload_2 ä»å±€éƒ¨å˜é‡2ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">dload_3 ä»å±€éƒ¨å˜é‡3ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aload_0 ä»å±€éƒ¨å˜é‡0ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aload_1 ä»å±€éƒ¨å˜é‡1ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aload_2 ä»å±€éƒ¨å˜é‡2ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aload_3 ä»å±€éƒ¨å˜é‡3ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">iaload ä»æ•°ç»„ä¸­è£…è½½intç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">laload ä»æ•°ç»„ä¸­è£…è½½longç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">faload ä»æ•°ç»„ä¸­è£…è½½floatç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">daload ä»æ•°ç»„ä¸­è£…è½½doubleç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">aaload ä»æ•°ç»„ä¸­è£…è½½å¼•ç”¨ç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">baload ä»æ•°ç»„ä¸­è£…è½½byteç±»å‹æˆ–booleanç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">caload ä»æ•°ç»„ä¸­è£…è½½charç±»å‹å€¼</span><br><span class="line"></span><br><span class="line">saload ä»æ•°ç»„ä¸­è£…è½½shortç±»å‹å€¼</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å±€éƒ¨å˜é‡å‹æ ˆå¸¸ç”¨æŒ‡ä»¤é›†</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303180740047.png" alt="image-20220303180740047" loading="lazy"></p>
<p><strong>å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤å‰–æ</strong></p>
<p>å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤å°†ç»™å®šçš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ•°æ®å‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
<p>è¿™ç±»æŒ‡ä»¤å¤§ä½“å¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li><p><code>xload_&lt;n&gt;</code>ï¼ˆxä¸ºiã€lã€fã€dã€aï¼Œnä¸º0åˆ°3ï¼‰</p>
</li>
<li><p><code>xload</code>ï¼ˆxä¸ºiã€lã€fã€dã€aï¼‰</p>
</li>
</ul>
<p>è¯´æ˜ï¼šåœ¨è¿™é‡Œï¼Œxçš„å–å€¼è¡¨ç¤ºæ•°æ®ç±»å‹ã€‚</p>
<p>æŒ‡ä»¤xload_nè¡¨ç¤ºå°†ç¬¬nä¸ªå±€éƒ¨å˜é‡å‹å…¥æ“ä½œæ•°æ ˆï¼Œæ¯”å¦‚iload_1ã€fload_0ã€aload_0ç­‰æŒ‡ä»¤ã€‚å…¶ä¸­aload_nè¡¨ç¤ºå°†ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å‹æ ˆã€‚</p>
<p>æŒ‡ä»¤xloadé€šè¿‡æŒ‡å®šå‚æ•°çš„å½¢å¼ï¼ŒæŠŠå±€éƒ¨å˜é‡å‹å…¥æ“ä½œæ•°æ ˆï¼Œå½“ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œè¡¨ç¤ºå±€éƒ¨å˜é‡çš„æ•°é‡å¯èƒ½è¶…è¿‡äº†4ä¸ªï¼Œæ¯”å¦‚æŒ‡ä»¤iloadã€floadç­‰ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">load</span><span class="params">(<span class="type">int</span> num, Object obj, <span class="type">long</span> count, <span class="type">boolean</span> flag, <span class="type">short</span>[] arr)</span> &#123;</span><br><span class="line">    System.out.println(num);</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    System.out.println(flag);</span><br><span class="line">    System.out.println(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220303180839141.png" alt="image-20220303180839141" loading="lazy"></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>åœ¨æ“ä½œæ•°æ ˆä¸­æœ¬åº”è¯¥æ˜¯ç”¨å®Œå°±å‡ºæ ˆçš„ï¼Œä½†æ˜¯è¿™é‡Œä¸ºäº†ä¿ç•™è¿è¡Œç—•è¿¹ï¼Œæ‰€ä»¥æ²¡æœ‰å°†å…¶ç§»é™¤</li>
</ul>
<h4 id="2-5ï¼Œå¸¸é‡å…¥æ ˆæŒ‡ä»¤"><a href="#2-5ï¼Œå¸¸é‡å…¥æ ˆæŒ‡ä»¤" class="headerlink" title="2.5ï¼Œå¸¸é‡å…¥æ ˆæŒ‡ä»¤"></a>2.5ï¼Œå¸¸é‡å…¥æ ˆæŒ‡ä»¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">aconst_null å°†<span class="literal">null</span>å¯¹è±¡å¼•ç”¨å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_m1 å°†<span class="type">int</span>ç±»å‹å¸¸é‡-<span class="number">1</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_0 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">0</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_1 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">1</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_2 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">2</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_3 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">3</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_4 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">4</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">iconst_5 å°†<span class="type">int</span>ç±»å‹å¸¸é‡<span class="number">5</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">lconst_0 å°†<span class="type">long</span>ç±»å‹å¸¸é‡<span class="number">0</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">lconst_1 å°†<span class="type">long</span>ç±»å‹å¸¸é‡<span class="number">1</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">fconst_0 å°†<span class="type">float</span>ç±»å‹å¸¸é‡<span class="number">0</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">fconst_1 å°†<span class="type">float</span>ç±»å‹å¸¸é‡<span class="number">1</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">dconst_0 å°†<span class="type">double</span>ç±»å‹å¸¸é‡<span class="number">0</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">dconst_1 å°†<span class="type">double</span>ç±»å‹å¸¸é‡<span class="number">1</span>å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">bipush å°†ä¸€ä¸ª<span class="number">8</span>ä½å¸¦ç¬¦å·æ•´æ•°å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">sipush å°†<span class="number">16</span>ä½å¸¦ç¬¦å·æ•´æ•°å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">ldc æŠŠå¸¸é‡æ± ä¸­çš„é¡¹å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">ldc_w æŠŠå¸¸é‡æ± ä¸­çš„é¡¹å‹å…¥æ ˆï¼ˆä½¿ç”¨å®½ç´¢å¼•ï¼‰</span><br><span class="line"> </span><br><span class="line">ldc2_w æŠŠå¸¸é‡æ± ä¸­<span class="type">long</span>ç±»å‹æˆ–è€…<span class="type">double</span>ç±»å‹çš„é¡¹å‹å…¥æ ˆï¼ˆä½¿ç”¨å®½ç´¢å¼•ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å¸¸é‡å…¥æ ˆå¸¸ç”¨æŒ‡ä»¤é›†</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303181140311.png" alt="image-20220303181140311" loading="lazy"></p>
<p><strong>å¸¸é‡å…¥æ ˆæŒ‡ä»¤å‰–æ</strong></p>
<p>å¸¸é‡å…¥æ ˆæŒ‡ä»¤çš„åŠŸèƒ½æ˜¯å°†å¸¸æ•°å‹å…¥æ“ä½œæ•°æ ˆï¼Œæ ¹æ®æ•°æ®ç±»å‹å’Œå…¥æ ˆå†…å®¹çš„ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸ºconstç³»åˆ—ã€pushç³»åˆ—å’ŒldcæŒ‡ä»¤ã€‚</p>
<p>æŒ‡ä»¤constç³»åˆ—ï¼šç”¨äºå¯¹ç‰¹å®šçš„å¸¸é‡å…¥æ ˆï¼Œå…¥æ ˆçš„å¸¸é‡éšå«åœ¨æŒ‡ä»¤æœ¬èº«é‡Œã€‚æŒ‡ä»¤æœ‰ï¼š<code>iconst_&lt;i&gt;ï¼ˆiä»-1åˆ°5ï¼‰ã€lconst_&lt;l&gt;ï¼ˆ1ä»0åˆ°1ï¼‰ã€fconst_&lt;f&gt;ï¼ˆfä»0åˆ°2ï¼‰ã€dconst_&lt;d&gt;ï¼ˆdä»0åˆ°1ï¼‰ã€aconst_null</code>ã€‚æ¯”å¦‚ï¼Œ</p>
<ul>
<li><p>iconst_m1å°†-1å‹å…¥æ“ä½œæ•°æ ˆï¼›</p>
</li>
<li><p>iconst_xï¼ˆxä¸º0åˆ°5ï¼‰å°†xå‹å…¥æ ˆï¼›</p>
</li>
<li><p>lconst_0ã€lconst_1åˆ†åˆ«å°†é•¿æ•´æ•°0å’Œ1å‹å…¥æ ˆï¼›</p>
</li>
<li><p>fconst_0ã€fconst_1ã€fconst_2åˆ†åˆ«å°†æµ®ç‚¹æ•°0ã€1ã€2å‹å…¥æ ˆï¼›</p>
</li>
<li><p>dconst_0å’Œdconst_1åˆ†åˆ«å°†doubleå‹0å’Œ1å‹å…¥æ ˆï¼›</p>
</li>
<li><p>aconst_nullå°†nullå‹å…¥æ“ä½œæ•°æ ˆï¼›</p>
</li>
</ul>
<p>ä»æŒ‡ä»¤çš„å‘½åä¸Šä¸éš¾æ‰¾å‡ºè§„å¾‹ï¼ŒæŒ‡ä»¤åŠ©è®°ç¬¦çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ€»æ˜¯å–œæ¬¢è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œiè¡¨ç¤ºæ•´æ•°ï¼Œlè¡¨ç¤ºé•¿æ•´æ•°ï¼Œfè¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œdè¡¨ç¤ºåŒç²¾åº¦æµ®ç‚¹ï¼Œä¹ æƒ¯ä¸Šç”¨aè¡¨ç¤ºå¯¹è±¡å¼•ç”¨ã€‚å¦‚æœæŒ‡ä»¤éšå«æ“ä½œçš„å‚æ•°ï¼Œä¼šä»¥ä¸‹åˆ’çº¿å½¢å¼ç»™å‡ºã€‚</p>
<p>æŒ‡ä»¤pushç³»åˆ—ï¼šä¸»è¦åŒ…æ‹¬bipushå’Œsipushã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºæ¥æ”¶æ•°æ®ç±»å‹çš„ä¸åŒï¼Œbipushæ¥æ”¶8ä½æ•´æ•°ä½œä¸ºå‚æ•°ï¼Œsipushæ¥æ”¶16ä½æ•´æ•°ï¼Œå®ƒä»¬éƒ½å°†å‚æ•°å‹å…¥æ ˆã€‚</p>
<p>æŒ‡ä»¤ldcç³»åˆ—ï¼šå¦‚æœä»¥ä¸ŠæŒ‡ä»¤éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‡èƒ½çš„</p>
<ul>
<li><p>ldcæŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ¥æ”¶ä¸€ä¸ª8ä½çš„å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å‘å¸¸é‡æ± ä¸­çš„intã€floatæˆ–è€…Stringçš„ç´¢å¼•ï¼Œå°†æŒ‡å®šçš„å†…å®¹å‹å…¥å †æ ˆã€‚</p>
</li>
<li><p>ç±»ä¼¼çš„è¿˜æœ‰ldc_wï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ª8ä½å‚æ•°ï¼Œèƒ½æ”¯æŒçš„ç´¢å¼•èŒƒå›´å¤§äºldcã€‚</p>
</li>
<li><p>å¦‚æœè¦å‹å…¥çš„å…ƒç´ æ˜¯longæˆ–è€…doubleç±»å‹çš„ï¼Œåˆ™ä½¿ç”¨ldc2_wæŒ‡ä»¤ï¼Œä½¿ç”¨æ–¹å¼éƒ½æ˜¯ç±»ä¼¼çš„</p>
</li>
</ul>
<p><strong>æ€»ç»“å¦‚ä¸‹ï¼š</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303181259139.png" alt="image-20220303181259139" loading="lazy"></p>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303181358101.png" alt="image-20220303181358101" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220303181438036.png" alt="image-20220303181438036" loading="lazy"></p>
<h4 id="2-6ï¼Œå‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤"><a href="#2-6ï¼Œå‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤" class="headerlink" title="2.6ï¼Œå‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤"></a>2.6ï¼Œå‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">istore å°†intç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡</span><br><span class="line"> </span><br><span class="line">lstore å°†longç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡</span><br><span class="line"> </span><br><span class="line">fstore å°†floatç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡</span><br><span class="line"> </span><br><span class="line">dstore å°†doubleç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡</span><br><span class="line"> </span><br><span class="line">astore å°†å°†å¼•ç”¨ç±»å‹æˆ–returnAddressç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡</span><br><span class="line"> </span><br><span class="line">istore_0 å°†intç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡0</span><br><span class="line"> </span><br><span class="line">istore_1 å°†intç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡1</span><br><span class="line"> </span><br><span class="line">istore_2 å°†intç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡2</span><br><span class="line"> </span><br><span class="line">istore_3 å°†intç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡3</span><br><span class="line"> </span><br><span class="line">lstore_0 å°†longç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡0</span><br><span class="line"> </span><br><span class="line">lstore_1 å°†longç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡1</span><br><span class="line"> </span><br><span class="line">lstore_2 å°†longç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡2</span><br><span class="line"> </span><br><span class="line">lstore_3 å°†longç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡3</span><br><span class="line"> </span><br><span class="line">fstore_0 å°†floatç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡0</span><br><span class="line"> </span><br><span class="line">fstore_1 å°†floatç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡1</span><br><span class="line"> </span><br><span class="line">fstore_2 å°†floatç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡2</span><br><span class="line"> </span><br><span class="line">fstore_3 å°†floatç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡3</span><br><span class="line"> </span><br><span class="line">dstore_0 å°†doubleç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡0</span><br><span class="line"> </span><br><span class="line">dstore_1 å°†doubleç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡1</span><br><span class="line"> </span><br><span class="line">dstore_2 å°†doubleç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡2</span><br><span class="line"> </span><br><span class="line">dstore_3 å°†doubleç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡3</span><br><span class="line"> </span><br><span class="line">astore_0 å°†å¼•ç”¨ç±»å‹æˆ–returnAddressç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡0</span><br><span class="line"> </span><br><span class="line">astore_1 å°†å¼•ç”¨ç±»å‹æˆ–returnAddressç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡1</span><br><span class="line"> </span><br><span class="line">astore_2 å°†å¼•ç”¨ç±»å‹æˆ–returnAddressç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡2</span><br><span class="line"> </span><br><span class="line">astore_3 å°†å¼•ç”¨ç±»å‹æˆ–returnAddressç±»å‹å€¼å­˜å…¥å±€éƒ¨å˜é‡3</span><br><span class="line"> </span><br><span class="line">iastore å°†intç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">lastore å°†longç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">fastore å°†floatç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">dastore å°†doubleç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">aastore å°†å¼•ç”¨ç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">bastore å°†byteç±»å‹æˆ–è€…booleanç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">castore å°†charç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">sastore å°†shortç±»å‹å€¼å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line"> </span><br><span class="line">wideæŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">wide ä½¿ç”¨é™„åŠ å­—èŠ‚æ‰©å±•å±€éƒ¨å˜é‡ç´¢å¼•</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨å¸¸ç”¨æŒ‡ä»¤é›†</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303181631528.png" alt="image-20220303181631528" loading="lazy"></p>
<p><strong>å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤å‰–æ</strong></p>
<p>å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°æ ˆä¸­æ ˆé¡¶å…ƒç´ å¼¹å‡ºåï¼Œè£…å…¥å±€éƒ¨å˜é‡è¡¨çš„æŒ‡å®šä½ç½®ï¼Œç”¨äºç»™å±€éƒ¨å˜é‡èµ‹å€¼ã€‚è¿™ç±»æŒ‡ä»¤ä¸»è¦ä»¥storeçš„å½¢å¼å­˜åœ¨ï¼Œæ¯”å¦‚<code>xstoreï¼ˆxä¸ºiã€lã€fã€dã€aï¼‰ã€xstore_nï¼ˆxä¸ºiã€lã€fã€dã€aï¼Œnä¸º0è‡³3ï¼‰</code>ã€‚</p>
<ul>
<li><p>å…¶ä¸­ï¼ŒæŒ‡ä»¤istore_nå°†ä»æ“ä½œæ•°æ ˆä¸­å¼¹å‡ºä¸€ä¸ªæ•´æ•°ï¼Œå¹¶æŠŠå®ƒå€¼ç»™å±€éƒ¨å˜é‡ç´¢å¼•nä½ç½®ã€‚</p>
</li>
<li><p>æŒ‡ä»¤xstoreç”±äºæ²¡æœ‰éšå«å‚æ•°ä¿¡æ¯ï¼Œæ•…éœ€è¦æä¾›ä¸€ä¸ªbyteç±»å‹çš„å‚æ•°ç±»æŒ‡å®šç›®æ ‡å±€éƒ¨å˜é‡è¡¨çš„ä½ç½®ã€‚</p>
</li>
</ul>
<p>è¯´æ˜ï¼šä¸€èˆ¬è¯´æ¥ï¼Œç±»ä¼¼åƒstoreè¿™æ ·çš„å‘½ä»¤éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æŒ‡æ˜å°†å¼¹å‡ºçš„å…ƒç´ æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨çš„ç¬¬å‡ ä¸ªä½ç½®ã€‚ä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½å‹ç¼©æŒ‡ä»¤å¤§å°ï¼Œä½¿ç”¨ä¸“é—¨çš„istore_1æŒ‡ä»¤è¡¨ç¤ºå°†å¼¹å‡ºçš„å…ƒç´ æ”¾ç½®åœ¨å±€éƒ¨å˜é‡è¡¨ç¬¬1ä¸ªä½ç½®ã€‚ç±»ä¼¼çš„è¿˜æœ‰istore_0ã€istore_2ã€istore_3ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºä»æ“ä½œæ•°æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ç¬¬0ã€2ã€3ä¸ªä½ç½®ã€‚ç”±äºå±€éƒ¨å˜é‡è¡¨å‰å‡ ä¸ªä½ç½®æ€»æ˜¯éå¸¸å¸¸ç”¨ï¼Œå› æ­¤è¿™ç§åšæ³•è™½ç„¶å¢åŠ äº†æŒ‡ä»¤æ•°é‡ï¼Œä½†æ˜¯å¯ä»¥å¤§å¤§å‹ç¼©ç”Ÿæˆçš„å­—èŠ‚ç çš„ä½“ç§¯ã€‚å¦‚æœå±€éƒ¨å˜é‡è¡¨å¾ˆå¤§ï¼Œéœ€è¦å­˜å‚¨çš„æ§½ä½å¤§äº3ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨istoreæŒ‡ä»¤ï¼Œå¤–åŠ ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥è¡¨ç¤ºéœ€è¦å­˜æ”¾çš„æ§½ä½ä½ç½®ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220303181721600.png" alt="image-20220303181721600" loading="lazy"></p>
<h3 id="3ï¼Œç®—æœ¯æŒ‡ä»¤"><a href="#3ï¼Œç®—æœ¯æŒ‡ä»¤" class="headerlink" title="3ï¼Œç®—æœ¯æŒ‡ä»¤"></a>3ï¼Œç®—æœ¯æŒ‡ä»¤</h3><h4 id="3-1ï¼Œä½œç”¨"><a href="#3-1ï¼Œä½œç”¨" class="headerlink" title="3.1ï¼Œä½œç”¨"></a>3.1ï¼Œä½œç”¨</h4><p>ç®—æœ¯æŒ‡ä»¤ç”¨äºå¯¹ä¸¤ä¸ªæ“ä½œæ•°æ ˆä¸Šçš„å€¼è¿›è¡ŒæŸç§ç‰¹å®šè¿ç®—ï¼Œå¹¶æŠŠç»“æœé‡æ–°å‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
<h4 id="3-2ï¼Œåˆ†ç±»"><a href="#3-2ï¼Œåˆ†ç±»" class="headerlink" title="3.2ï¼Œåˆ†ç±»"></a>3.2ï¼Œåˆ†ç±»</h4><p>å¤§ä½“ä¸Šç®—æœ¯æŒ‡ä»¤å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¯¹æ•´å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ä¸å¯¹æµ®ç‚¹ç±»å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ã€‚</p>
<h4 id="3-3ï¼Œbyteã€shortã€charå’Œbooleanç±»å‹è¯´æ˜"><a href="#3-3ï¼Œbyteã€shortã€charå’Œbooleanç±»å‹è¯´æ˜" class="headerlink" title="3.3ï¼Œbyteã€shortã€charå’Œbooleanç±»å‹è¯´æ˜"></a>3.3ï¼Œbyteã€shortã€charå’Œbooleanç±»å‹è¯´æ˜</h4><p>åœ¨æ¯ä¸€å¤§ç±»ä¸­ï¼Œéƒ½æœ‰é’ˆå¯¹Javaè™šæ‹Ÿæœºå…·ä½“æ•°æ®ç±»å‹çš„ä¸“ç”¨ç®—æœ¯æŒ‡ä»¤ã€‚ä½†æ²¡æœ‰ç›´æ¥æ”¯æŒbyteã€shortã€charå’Œbooleanç±»å‹çš„ç®—æœ¯æŒ‡ä»¤ï¼Œå¯¹äºè¿™äº›æ•°æ®çš„è¿ç®—ï¼Œéƒ½ä½¿ç”¨intç±»å‹çš„æŒ‡ä»¤æ¥å¤„ç†ã€‚æ­¤å¤–ï¼Œåœ¨å¤„ç†booleanã€byteã€shortå’Œcharç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„intç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220303214639412.png" alt="image-20220303214639412" loading="lazy"></p>
<h4 id="3-4ï¼Œè¿ç®—æ—¶çš„æº¢å‡º"><a href="#3-4ï¼Œè¿ç®—æ—¶çš„æº¢å‡º" class="headerlink" title="3.4ï¼Œè¿ç®—æ—¶çš„æº¢å‡º"></a>3.4ï¼Œè¿ç®—æ—¶çš„æº¢å‡º</h4><p>æ•°æ®è¿ç®—å¯èƒ½ä¼šå¯¼è‡´æº¢å‡ºï¼Œä¾‹å¦‚ä¸¤ä¸ªå¾ˆå¤§çš„æ­£æ•´æ•°ç›¸åŠ ï¼Œç»“æœå¯èƒ½æ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚å…¶å®Javaè™šæ‹Ÿæœºè§„èŒƒå¹¶æ— æ˜ç¡®è§„å®šè¿‡æ•´å‹æ•°æ®æº¢å‡ºçš„å…·ä½“ç»“æœï¼Œä»…è§„å®šäº†åœ¨å¤„ç†æ•´å‹æ•°æ®æ—¶ï¼Œåªæœ‰é™¤æ³•æŒ‡ä»¤ä»¥åŠæ±‚ä½™æŒ‡ä»¤ä¸­å½“å‡ºç°é™¤æ•°ä¸º0æ—¶ä¼šå¯¼è‡´è™šæ‹ŸæœºæŠ›å‡ºå¼‚å¸¸ArithmeticExceptionã€‚</p>
<h4 id="3-5ï¼Œè¿ç®—æ¨¡å¼"><a href="#3-5ï¼Œè¿ç®—æ¨¡å¼" class="headerlink" title="3.5ï¼Œè¿ç®—æ¨¡å¼"></a>3.5ï¼Œè¿ç®—æ¨¡å¼</h4><p><strong>å‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼</strong>ï¼šJVMè¦æ±‚åœ¨è¿›è¡Œæµ®ç‚¹æ•°è®¡ç®—æ—¶ï¼Œæ‰€æœ‰çš„è¿ç®—ç»“æœéƒ½å¿…é¡»èˆå…¥åˆ°é€‚å½“çš„ç²¾åº¦ï¼Œéç²¾ç¡®ç»“æœå¿…é¡»èˆå…¥ä¸ºå¯è¢«è¡¨ç¤ºçš„æœ€æ¥è¿‘çš„ç²¾ç¡®å€¼ï¼Œå¦‚æœæœ‰ä¸¤ç§å¯è¡¨ç¤ºçš„å½¢å¼ä¸è¯¥å€¼ä¸€æ ·æ¥è¿‘ï¼Œå°†ä¼˜å…ˆé€‰æ‹©æœ€ä½æœ‰æ•ˆä½ä¸ºé›¶çš„ï¼›</p>
<p><strong>å‘é›¶èˆå…¥æ¨¡å¼</strong>ï¼šå°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°æ—¶ï¼Œé‡‡ç”¨è¯¥æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å°†åœ¨ç›®æ ‡æ•°å€¼ç±»å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ä½†æ˜¯ä¸å¤§äºåŸå€¼çš„æ•°å­—ä½œä¸ºæœ€ç²¾ç¡®çš„èˆå…¥ç»“æœï¼›</p>
<h4 id="3-6ï¼ŒNaNå€¼ä½¿ç”¨"><a href="#3-6ï¼ŒNaNå€¼ä½¿ç”¨" class="headerlink" title="3.6ï¼ŒNaNå€¼ä½¿ç”¨"></a>3.6ï¼ŒNaNå€¼ä½¿ç”¨</h4><p>å½“ä¸€ä¸ªæ“ä½œäº§ç”Ÿæº¢å‡ºæ—¶ï¼Œå°†ä¼šä½¿ç”¨æœ‰ç¬¦å·çš„æ— ç©·å¤§è¡¨ç¤ºï¼Œå¦‚æœæŸä¸ªæ“ä½œç»“æœæ²¡æœ‰æ˜ç¡®çš„æ•°å­¦å®šä¹‰çš„è¯ï¼Œå°†ä¼šä½¿ç”¨NaNå€¼æ¥è¡¨ç¤ºã€‚è€Œä¸”æ‰€æœ‰ä½¿ç”¨NaNå€¼ä½œä¸ºæ“ä½œæ•°çš„ç®—æœ¯æ“ä½œï¼Œç»“æœéƒ½ä¼šè¿”å›NaNï¼›</p>
<p><img src="/2022/04/18/JVM/image-20220303214752109.png" alt="image-20220303214752109" loading="lazy"></p>
<h4 id="3-7ï¼Œæ‰€æœ‰ç®—æœ¯æŒ‡ä»¤"><a href="#3-7ï¼Œæ‰€æœ‰ç®—æœ¯æŒ‡ä»¤" class="headerlink" title="3.7ï¼Œæ‰€æœ‰ç®—æœ¯æŒ‡ä»¤"></a>3.7ï¼Œæ‰€æœ‰ç®—æœ¯æŒ‡ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">æ•´æ•°è¿ç®—</span><br><span class="line"> </span><br><span class="line">iadd æ‰§è¡Œintç±»å‹çš„åŠ æ³•</span><br><span class="line"> </span><br><span class="line">ladd æ‰§è¡Œlongç±»å‹çš„åŠ æ³•</span><br><span class="line"> </span><br><span class="line">isub æ‰§è¡Œintç±»å‹çš„å‡æ³•</span><br><span class="line"> </span><br><span class="line">lsub æ‰§è¡Œlongç±»å‹çš„å‡æ³•</span><br><span class="line"> </span><br><span class="line">imul æ‰§è¡Œintç±»å‹çš„ä¹˜æ³•</span><br><span class="line"> </span><br><span class="line">lmul æ‰§è¡Œlongç±»å‹çš„ä¹˜æ³•</span><br><span class="line"> </span><br><span class="line">idiv æ‰§è¡Œintç±»å‹çš„é™¤æ³•</span><br><span class="line"> </span><br><span class="line">ldiv æ‰§è¡Œlongç±»å‹çš„é™¤æ³•</span><br><span class="line"> </span><br><span class="line">irem è®¡ç®—intç±»å‹é™¤æ³•çš„ä½™æ•°</span><br><span class="line"> </span><br><span class="line">lrem è®¡ç®—longç±»å‹é™¤æ³•çš„ä½™æ•°</span><br><span class="line"> </span><br><span class="line">ineg å¯¹ä¸€ä¸ªintç±»å‹å€¼è¿›è¡Œå–åæ“ä½œ</span><br><span class="line"> </span><br><span class="line">lneg å¯¹ä¸€ä¸ªlongç±»å‹å€¼è¿›è¡Œå–åæ“ä½œ</span><br><span class="line"> </span><br><span class="line">iinc æŠŠä¸€ä¸ªå¸¸é‡å€¼åŠ åˆ°ä¸€ä¸ªintç±»å‹çš„å±€éƒ¨å˜é‡ä¸Š</span><br><span class="line"> </span><br><span class="line">é€»è¾‘è¿ç®—</span><br><span class="line"> </span><br><span class="line">ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">ishl æ‰§è¡Œintç±»å‹çš„å‘å·¦ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">lshl æ‰§è¡Œlongç±»å‹çš„å‘å·¦ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">ishr æ‰§è¡Œintç±»å‹çš„å‘å³ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">lshr æ‰§è¡Œlongç±»å‹çš„å‘å³ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">iushr æ‰§è¡Œintç±»å‹çš„å‘å³é€»è¾‘ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">lushr æ‰§è¡Œlongç±»å‹çš„å‘å³é€»è¾‘ç§»ä½æ“ä½œ</span><br><span class="line"> </span><br><span class="line">æŒ‰ä½å¸ƒå°”è¿ç®—</span><br><span class="line"> </span><br><span class="line">iand å¯¹intç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘ä¸â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">land å¯¹longç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘ä¸â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">ior å¯¹intç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘æˆ–â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">lor å¯¹longç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘æˆ–â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">ixor å¯¹intç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘å¼‚æˆ–â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">lxor å¯¹longç±»å‹å€¼è¿›è¡Œâ€œé€»è¾‘å¼‚æˆ–â€æ“ä½œ</span><br><span class="line"> </span><br><span class="line">æµ®ç‚¹è¿ç®—</span><br><span class="line"> </span><br><span class="line">fadd æ‰§è¡Œfloatç±»å‹çš„åŠ æ³•</span><br><span class="line"> </span><br><span class="line">dadd æ‰§è¡Œdoubleç±»å‹çš„åŠ æ³•</span><br><span class="line"> </span><br><span class="line">fsub æ‰§è¡Œfloatç±»å‹çš„å‡æ³•</span><br><span class="line"> </span><br><span class="line">dsub æ‰§è¡Œdoubleç±»å‹çš„å‡æ³•</span><br><span class="line"> </span><br><span class="line">fmul æ‰§è¡Œfloatç±»å‹çš„ä¹˜æ³•</span><br><span class="line"> </span><br><span class="line">dmul æ‰§è¡Œdoubleç±»å‹çš„ä¹˜æ³•</span><br><span class="line"> </span><br><span class="line">fdiv æ‰§è¡Œfloatç±»å‹çš„é™¤æ³•</span><br><span class="line"> </span><br><span class="line">ddiv æ‰§è¡Œdoubleç±»å‹çš„é™¤æ³•</span><br><span class="line"> </span><br><span class="line">frem è®¡ç®—floatç±»å‹é™¤æ³•çš„ä½™æ•°</span><br><span class="line"> </span><br><span class="line">drem è®¡ç®—doubleç±»å‹é™¤æ³•çš„ä½™æ•°</span><br><span class="line"> </span><br><span class="line">fneg å°†ä¸€ä¸ªfloatç±»å‹çš„æ•°å€¼å–å</span><br><span class="line"> </span><br><span class="line">dneg å°†ä¸€ä¸ªdoubleç±»å‹çš„æ•°å€¼å–å</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ç®—æ•°æŒ‡ä»¤é›†</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303214852394.png" alt="image-20220303214852394" loading="lazy"></p>
<p>ä¸¾ä¾‹1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">bar</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ((i + <span class="number">1</span>) - <span class="number">2</span>) * <span class="number">3</span> / <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220303214930951.png" alt="image-20220303214930951" loading="lazy"></p>
<p>ä¸¾ä¾‹2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">	<span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> x / y;</span><br><span class="line">	<span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">	System.out.println(a + b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220303215033196.png" alt="image-20220303215033196" loading="lazy"></p>
<h4 id="3-8ï¼Œå½»åº•æå®š-è¿ç®—ç¬¦"><a href="#3-8ï¼Œå½»åº•æå®š-è¿ç®—ç¬¦" class="headerlink" title="3.8ï¼Œå½»åº•æå®š++è¿ç®—ç¬¦"></a>3.8ï¼Œå½»åº•æå®š++è¿ç®—ç¬¦</h4><p>å¾ˆå¤šåšå®¢éƒ½åœ¨è®²è‡ªå¢è¿ç®—ç¬¦ï¼Œä½†æ˜¯æˆ‘å½“åˆå§‹ç»ˆæ„Ÿè§‰è®²çš„ä¸å¤ªæ¸…æ™°ï¼Œäºæ˜¯ä¹ä¾¿æœ‰äº†è¿™ä¸€ç‰‡æ–‡ç« ï¼Œä½†æ˜¯ç”±äº++æ“ä½œæ¶‰åŠçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒæ·±ï¼Œæ˜¯ç”±å­—èŠ‚ç æçš„é¬¼ï¼Œæ‰€ä»¥ä½¿ç”¨å›¾å’Œæ–‡å­—çš„å½¢å¼å»ä¹¦å†™ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¯å‘ã€‚</p>
<p><strong>ä¸¾ä¾‹ä¸€</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method7</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> i++;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ++j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å­—èŠ‚ç å¦‚ä¸‹</span><br><span class="line"> <span class="number">0</span> bipush <span class="number">10</span></span><br><span class="line"> <span class="number">2</span> istore_1</span><br><span class="line"> <span class="number">3</span> iload_1</span><br><span class="line"> <span class="number">4</span> iinc <span class="number">1</span> by <span class="number">1</span></span><br><span class="line"> <span class="number">7</span> istore_2</span><br><span class="line"> <span class="number">8</span> bipush <span class="number">20</span></span><br><span class="line"><span class="number">10</span> istore_3</span><br><span class="line"><span class="number">11</span> iinc <span class="number">3</span> by <span class="number">1</span></span><br><span class="line"><span class="number">14</span> iload_3</span><br><span class="line"><span class="number">15</span> istore <span class="number">4</span></span><br><span class="line"><span class="number">17</span> <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>bipush 10</p>
<p><img src="/2022/04/18/JVM/image-20220303220126447.png" alt="image-20220303220126447" loading="lazy"></p>
</li>
<li><p>istore_1</p>
<p><img src="/2022/04/18/JVM/image-20220303220445502.png" alt="image-20220303220445502" loading="lazy"></p>
</li>
<li><p>iload_1</p>
<p><img src="/2022/04/18/JVM/image-20220303220636921.png" alt="image-20220303220636921" loading="lazy"></p>
</li>
<li><p>iinc 1 by 1</p>
<p><img src="/2022/04/18/JVM/image-20220303220842449.png" alt="image-20220303220842449" loading="lazy"></p>
</li>
<li><p>istore_2</p>
<p><img src="/2022/04/18/JVM/image-20220303221252892.png" alt="image-20220303221252892" loading="lazy"></p>
</li>
<li><p>bipush 20ï¼ˆåŒä¸Šï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220303221342168.png" alt="image-20220303221342168" loading="lazy"></p>
</li>
<li><p>istore_3</p>
<p><img src="/2022/04/18/JVM/image-20220303221422860.png" alt="image-20220303221422860" loading="lazy"></p>
</li>
<li><p>iinc 3 by 1</p>
<p><img src="/2022/04/18/JVM/image-20220303221524796.png" alt="image-20220303221524796" loading="lazy"></p>
</li>
<li><p>iload_3</p>
<p><img src="/2022/04/18/JVM/image-20220303221605722.png" alt="image-20220303221605722" loading="lazy"></p>
</li>
<li><p>istore 4</p>
<p><img src="/2022/04/18/JVM/image-20220303221736001.png" alt="image-20220303221736001" loading="lazy"></p>
</li>
<li><p>return</p>
</li>
</ol>
<p>ä¸Šé¢çš„æµç¨‹å°±æ˜¯è‡ªå¢çš„å­—èŠ‚ç è§„å®šçš„æµç¨‹å›¾ï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼š</p>
<p>i++æ˜¯å…ˆå–å‡ºæ”¾å…¥æ“ä½œæ•°æ ˆåä»–æ‰æ”¹å˜ï¼Œiâ€“æ˜¯å…ˆæ”¹å˜ç„¶åæ‰æ”¾å…¥æ“ä½œæ•°æ ˆè¿›è¡Œå¤åˆ¶ã€‚</p>
<p>åŒç†æœ‰ä¸€é“é¢è¯•é¢˜ç›®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method8</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        i = i++;</span><br><span class="line">        System.out.println(i);<span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="number">0</span> bipush <span class="number">10</span></span><br><span class="line"> <span class="number">2</span> istore_1</span><br><span class="line"> <span class="number">3</span> iload_1</span><br><span class="line"> <span class="number">4</span> iinc <span class="number">1</span> by <span class="number">1</span></span><br><span class="line"> <span class="number">7</span> istore_1</span><br><span class="line"> <span class="number">8</span> getstatic #<span class="number">2</span> &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">11</span> iload_1</span><br><span class="line"><span class="number">12</span> invokevirtual #<span class="number">5</span> &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">15</span> <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>å…ˆå¾€æ“ä½œæ•°æ ˆä¸­æ”¾å…¥10</p>
<p><img src="/2022/04/18/JVM/image-20220303222824437.png" alt="image-20220303222824437" loading="lazy"></p>
</li>
<li><p>ç„¶åå°†å…¶æ”¾å…¥å±€éƒ¨å˜é‡è¡¨æƒ³ä¸‹æ ‡ä¸º1çš„åœ°æ–¹</p>
<p><img src="/2022/04/18/JVM/image-20220303222915971.png" alt="image-20220303222915971" loading="lazy"></p>
</li>
<li><p>ç„¶åå°†ä¸‹æ ‡ä¸º1çš„å±€éƒ¨å˜é‡è¡¨çš„å€¼å¡«å†™å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><img src="/2022/04/18/JVM/image-20220303222940232.png" alt="image-20220303222940232" loading="lazy"></p>
</li>
<li><p>æ”¹å˜å±€éƒ¨å˜é‡è¡¨ä¸‹æ ‡ä¸º1çš„æ•°å­—ï¼Œä¸º11</p>
<p><img src="/2022/04/18/JVM/image-20220303222956252.png" alt="image-20220303222956252" loading="lazy"></p>
</li>
<li><p>ç„¶åå°†æ“ä½œæ•°æ ˆä¸­çš„æ•°å­—å‡ºæ ˆï¼Œå¹¶æ”¾å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå³è¦†ç›–äº†åŸæ¥çš„11ï¼Œå˜ä¸ºäº†10</p>
<p><img src="/2022/04/18/JVM/image-20220303223028670.png" alt="image-20220303223028670" loading="lazy"></p>
</li>
</ol>
<p>è¿™ä¹Ÿå°±æ˜¯ä¹‹å‰æœ‰äººå¸¸è¯´çš„<strong>æœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡çš„å€¼è¦†ç›–äº†åŸæœ‰çš„å€¼</strong>ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡çš„å€¼å°±æ˜¯æ“ä½œæ•°æ ˆä¸­å…ˆå­˜å…¥çš„å€¼ã€‚</p>
<h3 id="4ï¼Œç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#4ï¼Œç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="4ï¼Œç±»å‹è½¬æ¢æŒ‡ä»¤"></a>4ï¼Œç±»å‹è½¬æ¢æŒ‡ä»¤</h3><p>ç±»å‹è½¬æ¢æŒ‡ä»¤å¯ä»¥å°†ä¸¤ç§ä¸åŒçš„æ•°å€¼ç±»å‹è¿›è¡Œç›¸äº’è½¬æ¢ã€‚</p>
<p>è¿™äº›è½¬æ¢æ“ä½œä¸€èˆ¬ç”¨äºå®ç°ç”¨æˆ·ä»£ç ä¸­çš„æ˜¾å¼ç±»å‹è½¬æ¢æ“ä½œï¼Œæˆ–è€…ç”¨æ¥å¤„ç†å­—èŠ‚ç æŒ‡ä»¤é›†ä¸­æ•°æ®ç±»å‹ç›¸å…³æŒ‡ä»¤æ— æ³•ä¸æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”çš„é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">å®½åŒ–ç±»å‹è½¬æ¢</span><br><span class="line"> </span><br><span class="line">i2l æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºlongç±»å‹</span><br><span class="line"> </span><br><span class="line">i2f æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºfloatç±»å‹</span><br><span class="line"> </span><br><span class="line">i2d æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºdoubleç±»å‹</span><br><span class="line"> </span><br><span class="line">l2f æŠŠlongç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºfloatç±»å‹</span><br><span class="line"> </span><br><span class="line">l2d æŠŠlongç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºdoubleç±»å‹</span><br><span class="line"> </span><br><span class="line">f2d æŠŠfloatç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºdoubleç±»å‹</span><br><span class="line"> </span><br><span class="line">çª„åŒ–ç±»å‹è½¬æ¢</span><br><span class="line"> </span><br><span class="line">i2b æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºbyteç±»å‹</span><br><span class="line"> </span><br><span class="line">i2c æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºcharç±»å‹</span><br><span class="line"> </span><br><span class="line">i2s æŠŠintç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºshortç±»å‹</span><br><span class="line"> </span><br><span class="line">l2i æŠŠlongç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºintç±»å‹</span><br><span class="line"> </span><br><span class="line">f2i æŠŠfloatç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºintç±»å‹</span><br><span class="line"> </span><br><span class="line">f2l æŠŠfloatç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºlongç±»å‹</span><br><span class="line"> </span><br><span class="line">d2i æŠŠdoubleç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºintç±»å‹</span><br><span class="line"> </span><br><span class="line">d2l æŠŠdoubleç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºlongç±»å‹</span><br><span class="line"> </span><br><span class="line">d2f æŠŠdoubleç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºfloatç±»å‹</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ç±»å‹è½¬æ¢æŒ‡ä»¤é›†</strong></p>
<p><img src="/2022/04/18/JVM/image-20220303230226588.png" alt="image-20220303230226588" loading="lazy"></p>
<h4 id="4-1ï¼Œå®½åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#4-1ï¼Œå®½åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="4.1ï¼Œå®½åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤"></a>4.1ï¼Œå®½åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤</h4><p><strong>å®½åŒ–ç±»å‹è½¬æ¢( Widening Numeric Conversions)</strong></p>
<ol>
<li>è½¬æ¢è§„åˆ™</li>
</ol>
<p>Javaè™šæ‹Ÿæœºç›´æ¥æ”¯æŒä»¥ä¸‹æ•°å€¼çš„å®½åŒ–ç±»å‹è½¬æ¢ï¼ˆ widening numeric conversion,å°èŒƒå›´ç±»å‹å‘å¤§èŒƒå›´ç±»å‹çš„å®‰å…¨è½¬æ¢ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸éœ€è¦æŒ‡ä»¤æ‰§è¡Œï¼ŒåŒ…æ‹¬</p>
<ul>
<li><p> ä»intç±»å‹åˆ°longã€floatæˆ–è€… doubleç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼ši21ã€i2fã€i2d </p>
</li>
<li><p> ä»longç±»å‹åˆ°floatã€ doubleç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼ši2fã€i2d </p>
</li>
<li><p> ä»floatç±»å‹åˆ°doubleç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼šf2d </p>
</li>
</ul>
<p>ç®€åŒ–ä¸ºï¼šintâ€“&gt;longâ€“&gt;float-&gt; double</p>
<ol start="2">
<li>ç²¾åº¦æŸå¤±é—®é¢˜</li>
</ol>
<ul>
<li><p> å®½åŒ–ç±»å‹è½¬æ¢æ˜¯ä¸ä¼šå› ä¸ºè¶…è¿‡ç›®æ ‡ç±»å‹æœ€å¤§å€¼è€Œä¸¢å¤±ä¿¡æ¯çš„ï¼Œä¾‹å¦‚ï¼Œä»intè½¬æ¢åˆ°long,æˆ–è€…ä»intè½¬æ¢åˆ°double,éƒ½ä¸ä¼šä¸¢å¤±ä»»ä½•ä¿¡æ¯ï¼Œè½¬æ¢å‰åçš„å€¼æ˜¯ç²¾ç¡®ç›¸ç­‰çš„ã€‚ </p>
</li>
<li><p> ä»intã€longç±»å‹æ•°å€¼è½¬æ¢åˆ°floatï¼Œæˆ–è€…longç±»å‹æ•°å€¼è½¬æ¢åˆ°doubleæ—¶ï¼Œå°†å¯èƒ½å‘ç”Ÿç²¾åº¦ä¸¢å¤±ä¸€ä¸€å¯èƒ½ä¸¢å¤±æ‰å‡ ä¸ªæœ€ä½æœ‰æ•ˆä½ä¸Šçš„å€¼ï¼Œè½¬æ¢åçš„æµ®ç‚¹æ•°å€¼æ˜¯æ ¹æ®IEEE754æœ€æ¥è¿‘å«å…¥æ¨¡å¼æ‰€å¾—åˆ°çš„æ­£ç¡®æ•´æ•°å€¼ã€‚</p>
</li>
</ul>
<p>å°½ç®¡å®½åŒ–ç±»å‹è½¬æ¢å®é™…ä¸Šæ˜¯å¯èƒ½å‘ç”Ÿç²¾åº¦ä¸¢å¤±çš„ï¼Œä½†æ˜¯è¿™ç§è½¬æ¢æ°¸è¿œä¸ä¼šå¯¼è‡´Javaè™šæ‹ŸæœºæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</p>
<ol start="3">
<li>è¡¥å……è¯´æ˜</li>
</ol>
<p>ä»byteã€charå’Œ shortç±»å‹åˆ°intç±»å‹çš„å®½åŒ–ç±»å‹è½¬æ¢å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ã€‚å¯¹äºbyteç±»å‹è½¬ä¸ºint,æ‹Ÿæœºå¹¶æ²¡æœ‰åšå®è´¨æ€§çš„è½¬åŒ–å¤„ç†ï¼Œåªæ˜¯ç®€å•åœ°é€šè¿‡æ“ä½œæ•°æ ˆäº¤æ›äº†ä¸¤ä¸ªæ•°æ®ã€‚è€Œå°†byteè½¬ä¸ºlongæ—¶ï¼Œä½¿ç”¨çš„æ˜¯i2l,å¯ä»¥çœ‹åˆ°åœ¨å†…éƒ¨ï¼Œbyteåœ¨è¿™é‡Œå·²ç»ç­‰åŒäºintç±»å‹å¤„ç†ï¼Œç±»ä¼¼çš„è¿˜æœ‰ shortç±»å‹ï¼Œè¿™ç§å¤„ç†æ–¹å¼æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<p>ä¸€æ–¹é¢å¯ä»¥å‡å°‘å®é™…çš„æ•°æ®ç±»å‹ï¼Œå¦‚æœä¸º shortå’Œbyteéƒ½å‡†å¤‡ä¸€å¥—æŒ‡ä»¤ï¼Œé‚£ä¹ˆæŒ‡ä»¤çš„æ•°é‡å°±ä¼šå¤§å¢—ï¼Œè€Œè™šæ‹Ÿæœºç›®å‰çš„è®¾è®¡ä¸Šï¼Œåªæ„¿æ„ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæŒ‡ä»¤ï¼Œå› æ­¤æŒ‡ä»¤æ€»æ•°ä¸èƒ½è¶…è¿‡256ä¸ªï¼Œä¸ºäº†èŠ‚çœæŒ‡ä»¤èµ„æºï¼Œå°† shortå’Œbyteå½“åšintå¤„ç†ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œç”±äºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½å›ºå®šä¸º32ä½ï¼Œæ— è®ºæ˜¯byteæˆ–è€… shortå­˜å…¥å±€éƒ¨å˜é‡è¡¨ï¼Œéƒ½ä¼šå ç”¨32ä½ç©ºé—´ã€‚ä»è¿™ä¸ªè§’åº¦è¯´ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ç‰¹æ„åŒºåˆ†è¿™å‡ ç§æ•°æ®ç±»å‹ã€‚</p>
<h4 id="4-1ï¼Œçª„åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#4-1ï¼Œçª„åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="4.1ï¼Œçª„åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤"></a>4.1ï¼Œçª„åŒ–ç±»å‹è½¬æ¢æŒ‡ä»¤</h4><p><strong>çª„åŒ–ç±»å‹è½¬æ¢( Narrowing Numeric Conversion)</strong></p>
<ol>
<li>è½¬æ¢è§„åˆ™</li>
</ol>
<p>Javaè™šæ‹Ÿæœºä¹Ÿç›´æ¥æ”¯æŒä»¥ä¸‹çª„åŒ–ç±»å‹è½¬æ¢ï¼š</p>
<ul>
<li><p> ä»ä¸»intç±»å‹è‡³byteã€ shortæˆ–è€…charç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼ši2bã€i2cã€i2s </p>
</li>
<li><p> ä»longç±»å‹åˆ°intç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šl2i </p>
</li>
<li><p> ä»floatç±»å‹åˆ°intæˆ–è€…longç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šf2iã€f2l </p>
</li>
<li><p> ä»doubleç±»å‹åˆ°intã€longæˆ–è€…floatç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šd2iã€d2lã€d2f </p>
</li>
</ul>
<ol start="2">
<li>ç²¾åº¦æŸå¤±é—®é¢˜</li>
</ol>
<p>çª„åŒ–ç±»å‹è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´è½¬æ¢ç»“æœå…·å¤‡ä¸åŒçš„æ­£è´Ÿå·ã€ä¸åŒçš„æ•°é‡çº§ï¼Œå› æ­¤ï¼Œè½¬æ¢è¿‡ç¨‹å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼ä¸¢å¤±ç²¾åº¦ã€‚</p>
<p>å°½ç®¡æ•°æ®ç±»å‹çª„åŒ–è½¬æ¢å¯èƒ½ä¼šå‘ç”Ÿä¸Šé™æº¢å‡ºã€ä¸‹é™æº¢å‡ºå’Œç²¾åº¦ä¸¢å¤±ç­‰æƒ…å†µï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ˜ç¡®è§„å®šæ•°å€¼ç±»å‹çš„çª„åŒ–è½¬æ¢æŒ‡ä»¤æ°¸è¿œä¸å¯èƒ½å¯¼è‡´è™šæ‹ŸæœºæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</p>
<ol start="3">
<li>è¡¥å……è¯´æ˜</li>
</ol>
<p>å½“å°†ä¸€ä¸ªæµ®ç‚¹å€¼çª„åŒ–è½¬æ¢ä¸ºæ•´æ•°ç±»å‹T(Té™äºintæˆ–longç±»å‹ä¹‹ä¸€)çš„æ—¶å€™ï¼Œå°†éµå¾ªä»¥ä¸‹è½¬æ¢è§„åˆ™ï¼š</p>
<ul>
<li><p> å¦‚æœæµ®ç‚¹å€¼æ˜¯NaN,é‚£è½¬æ¢ç»“æœå°±æ˜¯intæˆ–longç±»å‹çš„0. </p>
</li>
<li><p> å¦‚æœæµ®ç‚¹å€¼ä¸æ˜¯æ— ç©·å¤§çš„è¯ï¼Œæµ®ç‚¹å€¼ä½¿ç”¨IEEE754çš„å‘é›¶å«å…¥æ¨¡å¼å–æ•´ï¼Œè·å¾—æ•´æ•°å€¼vã€‚å¦‚æœvåœ¨ç›®æ ‡ç±»å‹T(intæˆ–long)çš„è¡¨ç¤ºèŒƒå›´ä¹‹å†…ï¼Œé‚£è½¬æ¢ç»“æœå°±æ˜¯vã€‚å¦åˆ™ï¼Œå°†æ ¹æ®vçš„ç¬¦å·ï¼Œè½¬æ¢ä¸ºTæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æˆ–è€…æœ€å°æ­£æ•° </p>
</li>
</ul>
<p>å½“å°†ä¸€ä¸ªdoubleç±»å‹çª„åŒ–è½¬æ¢ä¸ºfloatç±»å‹æ—¶ï¼Œå°†éµå¾ªä»¥ä¸‹è½¬æ¢è§„åˆ™ï¼Œé€šè¿‡å‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼èˆå…¥ä¸€ä¸ªå¯ä»¥ä½¿ç”¨floatç±»å‹è¡¨ç¤ºçš„æ•°å­—ã€‚æœ€åç»“æœæ ¹æ®ä¸‹é¢è¿™3æ¡è§„åˆ™åˆ¤æ–­ï¼š</p>
<ul>
<li><p> å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå°è€Œæ— æ³•ä½¿ç”¨floatæ¥è¡¨ç¤ºï¼Œå°†è¿”å›floatç±»å‹çš„æ­£è´Ÿé›¶ </p>
</li>
<li><p> å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå¤§è€Œæ— æ³•ä½¿ç”¨floatæ¥è¡¨ç¤ºï¼Œå°†è¿”å›floatç±»å‹çš„æ­£è´Ÿæ— ç©·å¤§ã€‚ </p>
</li>
<li><p> å¯¹äºdoubleç±»å‹çš„NaNå€¼å°†æŒ‰è§„å®šè½¬æ¢ä¸ºfloatç±»å‹çš„NaNå€¼ã€‚ </p>
</li>
</ul>
<h3 id="5ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"><a href="#5ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤" class="headerlink" title="5ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"></a>5ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</h3><p>Javaæ˜¯é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œè™šæ‹Ÿæœºå¹³å°ä»å­—èŠ‚ç å±‚é¢å°±å¯¹é¢å‘å¯¹è±¡åšäº†æ·±å±‚æ¬¡çš„æ”¯æŒã€‚æœ‰ä¸€ç³»åˆ—æŒ‡ä»¤ä¸“é—¨ç”¨äºå¯¹è±¡æ“ä½œï¼Œå¯è¿›ä¸€æ­¥ç»†åˆ†ä¸ºåˆ›å»ºæŒ‡ä»¤ã€å­—æ®µè®¿é—®æŒ‡ä»¤ã€æ•°ç»„æ“ä½œæŒ‡ä»¤ã€ç±»å‹æ£€æŸ¥æŒ‡ä»¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">å¯¹è±¡æ“ä½œæŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">new åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span><br><span class="line"> </span><br><span class="line">getfield ä»å¯¹è±¡ä¸­è·å–å­—æ®µ</span><br><span class="line"> </span><br><span class="line">putfield è®¾ç½®å¯¹è±¡ä¸­å­—æ®µçš„å€¼</span><br><span class="line"> </span><br><span class="line">getstatic ä»ç±»ä¸­è·å–é™æ€å­—æ®µ</span><br><span class="line"> </span><br><span class="line">putstatic è®¾ç½®ç±»ä¸­é™æ€å­—æ®µçš„å€¼</span><br><span class="line"> </span><br><span class="line">checkcast ç¡®å®šå¯¹è±¡ä¸ºæ‰€ç»™å®šçš„ç±»å‹ã€‚åè·Ÿç›®æ ‡ç±»ï¼Œåˆ¤æ–­æ ˆé¡¶å…ƒç´ æ˜¯å¦ä¸ºç›®æ ‡ç±» / æ¥å£çš„å®ä¾‹ã€‚å¦‚æœä¸æ˜¯ä¾¿æŠ›å‡ºå¼‚å¸¸</span><br><span class="line"> </span><br><span class="line">instanceof åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç»™å®šçš„ç±»å‹ã€‚åè·Ÿç›®æ ‡ç±»ï¼Œåˆ¤æ–­æ ˆé¡¶å…ƒç´ æ˜¯å¦ä¸ºç›®æ ‡ç±» / æ¥å£çš„å®ä¾‹ã€‚æ˜¯åˆ™å‹å…¥ 1ï¼Œå¦åˆ™å‹å…¥ 0</span><br><span class="line"> </span><br><span class="line">æ•°ç»„æ“ä½œæŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">newarray åˆ†é…æ•°æ®æˆå‘˜ç±»å‹ä¸ºåŸºæœ¬ä¸Šæ•°æ®ç±»å‹çš„æ–°æ•°ç»„</span><br><span class="line"> </span><br><span class="line">anewarray åˆ†é…æ•°æ®æˆå‘˜ç±»å‹ä¸ºå¼•ç”¨ç±»å‹çš„æ–°æ•°ç»„</span><br><span class="line"> </span><br><span class="line">arraylength è·å–æ•°ç»„é•¿åº¦</span><br><span class="line"> </span><br><span class="line">multianewarray åˆ†é…æ–°çš„å¤šç»´æ•°ç»„</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-1ï¼Œåˆ›å»ºæŒ‡ä»¤"><a href="#5-1ï¼Œåˆ›å»ºæŒ‡ä»¤" class="headerlink" title="5.1ï¼Œåˆ›å»ºæŒ‡ä»¤"></a>5.1ï¼Œåˆ›å»ºæŒ‡ä»¤</h4><p><img src="/2022/04/18/JVM/image-20220303234527734.png" alt="image-20220303234527734" loading="lazy"></p>
<p>è™½ç„¶ç±»å®ä¾‹å’Œæ•°ç»„éƒ½æ˜¯å¯¹è±¡ï¼Œä½†Javaè™šæ‹Ÿæœºå¯¹ç±»å®ä¾‹å’Œæ•°ç»„çš„åˆ›å»ºä¸æ“ä½œä½¿ç”¨äº†ä¸åŒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼š</p>
<ol>
<li>åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼š </li>
</ol>
<ul>
<li><ul>
<li>åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼šnew</li>
</ul>
</li>
<li><ul>
<li>å®ƒæ¥æ”¶ä¸€ä¸ªæ“ä½œæ•°ï¼Œä¸ºæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ï¼Œè¡¨ç¤ºè¦åˆ›å»ºçš„ç±»å‹ï¼Œæ‰§è¡Œå®Œæˆåï¼Œå°†å¯¹è±¡çš„å¼•ç”¨å‹å…¥æ ˆã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li>åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼š </li>
</ol>
<ul>
<li><ul>
<li>åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼šnewarrayã€anewarrayã€multianewarray</li>
</ul>
</li>
<li><ul>
<li>ä¸Šè¿°åˆ›å»ºæŒ‡ä»¤å¯ä»¥ç”¨äºåˆ›å»ºå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œç”±äºå¯¹è±¡å’Œæ•°ç»„åœ¨Javaä¸­çš„å¹¿æ³›ä½¿ç”¨ï¼Œè¿™äº›æŒ‡ä»¤çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿéå¸¸é«˜ã€‚</li>
</ul>
</li>
</ul>
<h4 id="5-2ï¼Œå­—æ®µè®¿é—®æŒ‡ä»¤"><a href="#5-2ï¼Œå­—æ®µè®¿é—®æŒ‡ä»¤" class="headerlink" title="5.2ï¼Œå­—æ®µè®¿é—®æŒ‡ä»¤"></a>5.2ï¼Œå­—æ®µè®¿é—®æŒ‡ä»¤</h4><p><img src="/2022/04/18/JVM/image-20220303234605681.png" alt="image-20220303234605681" loading="lazy"></p>
<p>å¯¹è±¡åˆ›å»ºåï¼Œå°±å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®æŒ‡ä»¤è·å–å¯¹è±¡å®ä¾‹æˆ–æ•°ç»„å®ä¾‹ä¸­çš„å­—æ®µæˆ–è€…æ•°ç»„å…ƒç´ ã€‚</p>
<ul>
<li><p>è®¿é—®ç±»å­—æ®µï¼ˆstaticå­—æ®µï¼Œæˆ–è€…ç§°ä¸ºç±»å˜é‡ï¼‰çš„æŒ‡ä»¤ï¼šgetstaticã€putstatic</p>
</li>
<li><p>è®¿é—®ç±»å®ä¾‹å­—æ®µï¼ˆéstaticå­—æ®µï¼Œæˆ–è€…ç§°ä¸ºå®ä¾‹å˜é‡ï¼‰çš„æŒ‡ä»¤ï¼šgetfieldã€putfield</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼šä»¥getstaticæŒ‡ä»¤ä¸ºä¾‹ï¼Œå®ƒå«æœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œä¸ºæŒ‡å‘å¸¸é‡æ± çš„Fieldrefç´¢å¼•ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è·å–FieldrefæŒ‡å®šçš„å¯¹è±¡æˆ–è€…å€¼ï¼Œå¹¶å°†å…¶å‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;hel1o&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> getstatic #<span class="number">8</span> &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">3</span> ldc #<span class="number">9</span> &lt;hello&gt;</span><br><span class="line"><span class="number">5</span> invokevirtual #<span class="number">10</span> &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">8</span> <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220303234639240.png" alt="image-20220303234639240" loading="lazy"></p>
<h4 id="5-3ï¼Œæ•°ç»„æ“ä½œæŒ‡ä»¤"><a href="#5-3ï¼Œæ•°ç»„æ“ä½œæŒ‡ä»¤" class="headerlink" title="5.3ï¼Œæ•°ç»„æ“ä½œæŒ‡ä»¤"></a>5.3ï¼Œæ•°ç»„æ“ä½œæŒ‡ä»¤</h4><p>æ•°ç»„æ“ä½œæŒ‡ä»¤ä¸»è¦æœ‰ï¼šxastoreå’ŒxaloadæŒ‡ä»¤ã€‚å…·ä½“ä¸ºï¼š</p>
<ul>
<li><p>æŠŠä¸€ä¸ªæ•°ç»„å…ƒç´ åŠ è½½åˆ°æ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼šbaloadã€caloadã€saloadã€ialoadã€laloadã€faloadã€daloadã€aaload</p>
</li>
<li><p>å°†ä¸€ä¸ªæ“ä½œæ•°æ ˆçš„å€¼å­˜å‚¨åˆ°æ•°ç»„å…ƒç´ ä¸­çš„æŒ‡ä»¤ï¼šbastoreã€castoreã€sastoreã€iastoreã€lastoreã€fastoreã€dastoreã€aastore</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220303234736375.png" alt="image-20220303234736375" loading="lazy"></p>
<p>å–æ•°ç»„é•¿åº¦çš„æŒ‡ä»¤ï¼šarraylengthã€‚è¯¥æŒ‡ä»¤å¼¹å‡ºæ ˆé¡¶çš„æ•°ç»„å…ƒç´ ï¼Œè·å–æ•°ç»„çš„é•¿åº¦ï¼Œå°†é•¿åº¦å‹å…¥æ ˆã€‚</p>
<p>æŒ‡ä»¤xaloadè¡¨ç¤ºå°†æ•°ç»„çš„å…ƒç´ å‹æ ˆï¼Œæ¯”å¦‚saloadã€caloadåˆ†åˆ«è¡¨ç¤ºå‹å…¥shortæ•°ç»„å’Œcharæ•°ç»„ã€‚æŒ‡ä»¤xaloadåœ¨æ‰§è¡Œæ—¶ï¼Œè¦æ±‚æ“ä½œæ•°ä¸­æ ˆé¡¶å…ƒç´ ä¸ºæ•°ç»„ç´¢å¼•iï¼Œæ ˆé¡¶é¡ºä½ç¬¬2ä¸ªå…ƒç´ ä¸ºæ•°ç»„å¼•ç”¨aï¼Œè¯¥æŒ‡ä»¤ä¼šå¼¹å‡ºæ ˆé¡¶è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶å°†a[i]é‡æ–°å‹å…¥æ ˆã€‚</p>
<p>xastoreåˆ™ä¸“é—¨é’ˆå¯¹æ•°ç»„æ“ä½œï¼Œä»¥iastoreä¸ºä¾‹ï¼Œå®ƒç”¨äºç»™ä¸€ä¸ªintæ•°ç»„çš„ç»™å®šç´¢å¼•èµ‹å€¼ã€‚åœ¨iastoreæ‰§è¡Œå‰ï¼Œæ“ä½œæ•°æ ˆé¡¶éœ€è¦ä»¥æ­¤å‡†å¤‡3ä¸ªå…ƒç´ ï¼šå€¼ã€ç´¢å¼•ã€æ•°ç»„å¼•ç”¨ï¼Œiastoreä¼šå¼¹å‡ºè¿™3ä¸ªå€¼ï¼Œå¹¶å°†å€¼èµ‹ç»™æ•°ç»„ä¸­æŒ‡å®šç´¢å¼•çš„ä½ç½®ã€‚</p>
<h4 id="5-4ï¼Œç±»å‹æ£€æŸ¥æŒ‡ä»¤"><a href="#5-4ï¼Œç±»å‹æ£€æŸ¥æŒ‡ä»¤" class="headerlink" title="5.4ï¼Œç±»å‹æ£€æŸ¥æŒ‡ä»¤"></a>5.4ï¼Œç±»å‹æ£€æŸ¥æŒ‡ä»¤</h4><p>æ£€æŸ¥ç±»å®ä¾‹æˆ–æ•°ç»„ç±»å‹çš„æŒ‡ä»¤ï¼šinstanceofã€checkcastã€‚</p>
<ul>
<li>æŒ‡ä»¤instanceofç”¨æ¥åˆ¤æ–­ç»™å®šå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä¼šå°†åˆ¤æ–­ç»“æœå‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>æŒ‡ä»¤checkcastç”¨äºæ£€æŸ¥ç±»å‹å¼ºåˆ¶è½¬æ¢æ˜¯å¦å¯ä»¥è¿›è¡Œã€‚å¦‚æœå¯ä»¥è¿›è¡Œï¼Œé‚£ä¹ˆcheckcastæŒ‡ä»¤ä¸ä¼šæ”¹å˜æ“ä½œæ•°æ ˆï¼Œå¦åˆ™å®ƒä¼šæŠ›å‡ºClassCastExceptionå¼‚å¸¸</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220303234856790.png" alt="image-20220303234856790" loading="lazy"></p>
<h3 id="6ï¼Œæ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤"><a href="#6ï¼Œæ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤" class="headerlink" title="6ï¼Œæ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤"></a>6ï¼Œæ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">invokcvirtual è¿è¡Œæ—¶æŒ‰ç…§å¯¹è±¡çš„ç±»æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•</span><br><span class="line"> </span><br><span class="line">invokespecial æ ¹æ®ç¼–è¯‘æ—¶ç±»å‹æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•</span><br><span class="line"> </span><br><span class="line">invokestatic è°ƒç”¨ç±»ï¼ˆé™æ€ï¼‰æ–¹æ³•</span><br><span class="line"> </span><br><span class="line">invokcinterface è°ƒç”¨æ¥å£æ–¹æ³•</span><br><span class="line"> </span><br><span class="line">æ–¹æ³•è¿”å›æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">ireturn ä»æ–¹æ³•ä¸­è¿”å›<span class="type">int</span>ç±»å‹çš„æ•°æ®</span><br><span class="line"> </span><br><span class="line">lreturn ä»æ–¹æ³•ä¸­è¿”å›<span class="type">long</span>ç±»å‹çš„æ•°æ®</span><br><span class="line"> </span><br><span class="line">freturn ä»æ–¹æ³•ä¸­è¿”å›<span class="type">float</span>ç±»å‹çš„æ•°æ®</span><br><span class="line"> </span><br><span class="line">dreturn ä»æ–¹æ³•ä¸­è¿”å›<span class="type">double</span>ç±»å‹çš„æ•°æ®</span><br><span class="line"> </span><br><span class="line">areturn ä»æ–¹æ³•ä¸­è¿”å›å¼•ç”¨ç±»å‹çš„æ•°æ®</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> ä»æ–¹æ³•ä¸­è¿”å›ï¼Œè¿”å›å€¼ä¸º<span class="keyword">void</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-1ï¼Œæ–¹æ³•è°ƒç”¨æŒ‡ä»¤"><a href="#6-1ï¼Œæ–¹æ³•è°ƒç”¨æŒ‡ä»¤" class="headerlink" title="6.1ï¼Œæ–¹æ³•è°ƒç”¨æŒ‡ä»¤"></a>6.1ï¼Œæ–¹æ³•è°ƒç”¨æŒ‡ä»¤</h4><p>æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼šinvokevirtualã€invokeinterfaceã€invokespecialã€invokestaticã€invokedynamicï¼Œä»¥ä¸‹5æ¡æŒ‡ä»¤ç”¨äºæ–¹æ³•è°ƒç”¨ï¼š</p>
<ul>
<li><p>invokevirtualæŒ‡ä»¤ç”¨äºè°ƒç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è¿›è¡Œåˆ†æ´¾ï¼ˆè™šæ–¹æ³•åˆ†æ´¾ï¼‰ï¼Œæ”¯æŒå¤šæ€ã€‚è¿™ä¹Ÿæ˜¯Javaè¯­è¨€ä¸­æœ€å¸¸è§çš„æ–¹æ³•åˆ†æ´¾æ–¹å¼ã€‚</p>
</li>
<li><p>invokeinterfaceæŒ‡ä»¤ç”¨äºè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æœç´¢ç”±ç‰¹å®šå¯¹è±¡æ‰€å®ç°çš„è¿™ä¸ªæ¥å£æ–¹æ³•ï¼Œå¹¶æ‰¾å‡ºé€‚åˆçš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</p>
</li>
<li><p>invokespecialæŒ‡ä»¤ç”¨äºè°ƒç”¨ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„å®ä¾‹æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼ˆæ„é€ å™¨ï¼‰ã€ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•éƒ½æ˜¯é™æ€ç±»å‹ç»‘å®šçš„ï¼Œä¸ä¼šåœ¨è°ƒç”¨æ—¶è¿›è¡ŒåŠ¨æ€æ´¾å‘ã€‚</p>
</li>
<li><p>invokestaticæŒ‡ä»¤ç”¨äºè°ƒç”¨å‘½åç±»ä¸­çš„ç±»æ–¹æ³•ï¼ˆstaticæ–¹æ³•ï¼‰ã€‚è¿™æ˜¯é™æ€ç»‘å®šçš„ã€‚</p>
</li>
<li><p>invokedynamicæŒ‡ä»¤ç”¨äºè°ƒç”¨åŠ¨æ€ç»‘å®šçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯JDK1.7åæ–°åŠ å…¥çš„æŒ‡ä»¤ã€‚ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p>
</li>
<li><p>invokedynamicæŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ï¼Œè€Œå‰é¢4æ¡è°ƒç”¨æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘éƒ½å›ºåŒ–åœ¨javaè™šæ‹Ÿæœºå†…éƒ¨ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220304000530101.png" alt="image-20220304000530101" loading="lazy"></p>
<h4 id="6-2ï¼Œæ–¹æ³•è¿”å›æŒ‡ä»¤"><a href="#6-2ï¼Œæ–¹æ³•è¿”å›æŒ‡ä»¤" class="headerlink" title="6.2ï¼Œæ–¹æ³•è¿”å›æŒ‡ä»¤"></a>6.2ï¼Œæ–¹æ³•è¿”å›æŒ‡ä»¤</h4><p>æ–¹æ³•è°ƒç”¨ç»“æŸå‰ï¼Œéœ€è¦è¿›è¡Œè¿”å›ã€‚æ–¹æ³•è¿”å›æŒ‡ä»¤æ˜¯æ ¹æ®è¿”å›å€¼çš„ç±»å‹åŒºåˆ†çš„ã€‚</p>
<ul>
<li><p>åŒ…æ‹¬ireturnï¼ˆå½“è¿”å›å€¼æ˜¯booleanã€byteã€charã€shortå’Œint ç±»å‹æ—¶ä½¿ç”¨ï¼‰ã€lreturnã€freturnã€dreturnå’Œareturn</p>
</li>
<li><p>å¦å¤–è¿˜æœ‰ä¸€æ¡return æŒ‡ä»¤ä¾›å£°æ˜ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ä»¥åŠç±»å’Œæ¥å£çš„ç±»åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220304000553819.png" alt="image-20220304000553819" loading="lazy"></p>
<p>é€šè¿‡ireturnæŒ‡ä»¤ï¼Œå°†å½“å‰å‡½æ•°æ“ä½œæ•°æ ˆçš„é¡¶å±‚å…ƒç´ å¼¹å‡ºï¼Œå¹¶å°†è¿™ä¸ªå…ƒç´ å‹å…¥è°ƒç”¨è€…å‡½æ•°çš„æ“ä½œæ•°æ ˆä¸­ï¼ˆå› ä¸ºè°ƒç”¨è€…éå¸¸å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼Œæ‰€æœ‰åœ¨å½“å‰å‡½æ•°æ“ä½œæ•°æ ˆä¸­çš„å…¶ä»–å…ƒç´ éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>å¦‚æœå½“å‰è¿”å›çš„æ˜¯synchronizedæ–¹æ³•ï¼Œé‚£ä¹ˆè¿˜ä¼šæ‰§è¡Œä¸€ä¸ªéšå«çš„monitorexitæŒ‡ä»¤ï¼Œé€€å‡ºä¸´ç•ŒåŒºã€‚</p>
<p>æœ€åï¼Œä¼šä¸¢å¼ƒå½“å‰æ–¹æ³•çš„æ•´ä¸ªå¸§ï¼Œæ¢å¤è°ƒç”¨è€…çš„å¸§ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬äº¤ç»™è°ƒç”¨è€…ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">methodReturn</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (i + j) / k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220304000629451.png" alt="image-20220304000629451" loading="lazy"></p>
<h3 id="7ï¼Œæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"><a href="#7ï¼Œæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤" class="headerlink" title="7ï¼Œæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"></a>7ï¼Œæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</h3><p>å¦‚åŒæ“ä½œä¸€ä¸ªæ™®é€šæ•°æ®ç»“æ„ä¸­çš„å †æ ˆé‚£æ ·ï¼ŒJVMæä¾›çš„æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨äºç›´æ¥æ“ä½œæ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ã€‚</p>
<p>è¿™ç±»æŒ‡ä»¤åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><p>å°†ä¸€ä¸ªæˆ–ä¸¤ä¸ªå…ƒç´ ä»æ ˆé¡¶å¼¹å‡ºï¼Œå¹¶ä¸”ç›´æ¥åºŸå¼ƒï¼š<code>popï¼Œpop2</code></p>
</li>
<li><p>å¤åˆ¶æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å€¼å¹¶å°†å¤åˆ¶å€¼æˆ–åŒä»½çš„å¤åˆ¶å€¼é‡æ–°å‹å…¥æ ˆé¡¶ï¼š<code>dupï¼Œdup2ï¼Œdup_x1ï¼Œdup2_Ã—1ï¼Œdup_Ã—2ï¼Œdup2_Ã—2</code></p>
</li>
<li><p>å°†æ ˆæœ€é¡¶ç«¯çš„ä¸¤ä¸ªSlotæ•°å€¼ä½ç½®äº¤æ¢ï¼š<code>swap</code>ã€‚Javaè™šæ‹Ÿæœºæ²¡æœ‰æä¾›äº¤æ¢ä¸¤ä¸ª64ä½æ•°æ®ç±»å‹ï¼ˆlongã€doubleï¼‰æ•°å€¼çš„æŒ‡ä»¤ã€‚</p>
</li>
<li><p>æŒ‡ä»¤<code>nop</code>ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œå®ƒçš„å­—èŠ‚ç ä¸º0x00ã€‚å’Œæ±‡ç¼–è¯­è¨€ä¸­çš„nopä¸€æ ·ï¼Œå®ƒè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸åšã€‚è¿™æ¡æŒ‡ä»¤ä¸€èˆ¬å¯ç”¨äºè°ƒè¯•ã€å ä½ç­‰ã€‚</p>
</li>
</ul>
<p>è¿™äº›æŒ‡ä»¤å±äºé€šç”¨å‹ï¼Œå¯¹æ ˆçš„å‹å…¥æˆ–è€…å¼¹å‡ºæ— éœ€æŒ‡æ˜æ•°æ®ç±»å‹ã€‚</p>
<ul>
<li><p>ä¸å¸¦_xçš„æŒ‡ä»¤æ˜¯å¤åˆ¶æ ˆé¡¶æ•°æ®å¹¶å‹å…¥æ ˆé¡¶ã€‚åŒ…æ‹¬ä¸¤ä¸ªæŒ‡ä»¤ï¼Œ<code>dupï¼Œdup2</code>ã€‚dupçš„ç³»æ•°ä»£è¡¨è¦å¤åˆ¶çš„Slotä¸ªæ•°ã€‚dupå¼€å¤´çš„æŒ‡ä»¤ç”¨äºå¤åˆ¶1ä¸ªSlotçš„æ•°æ®ã€‚ä¾‹å¦‚1ä¸ªintæˆ–1ä¸ªreferenceç±»å‹æ•°æ®dup2å¼€å¤´çš„æŒ‡ä»¤ç”¨äºå¤åˆ¶2ä¸ªSlotçš„æ•°æ®ã€‚ä¾‹å¦‚1ä¸ªlongï¼Œæˆ–2ä¸ªintï¼Œæˆ–1ä¸ªint+1ä¸ªfloatç±»å‹æ•°æ®</p>
</li>
<li><p>å¸¦_xçš„æŒ‡ä»¤æ˜¯å¤åˆ¶æ ˆé¡¶æ•°æ®å¹¶æ’å…¥æ ˆé¡¶ä»¥ä¸‹çš„æŸä¸ªä½ç½®ã€‚å…±æœ‰4ä¸ªæŒ‡ä»¤ï¼Œ<code>dup_Ã—1ï¼Œdup2_Ã—1ï¼Œdup_Ã—2ï¼Œdup2Ã—2</code>ã€‚å¯¹äºå¸¦<em>xçš„å¤åˆ¶æ’å…¥æŒ‡ä»¤ï¼Œåªè¦å°†æŒ‡ä»¤çš„dupå’Œxçš„ç³»æ•°ç›¸åŠ ï¼Œç»“æœå³ä¸ºéœ€è¦æ’å…¥çš„ä½ç½®ã€‚å› æ­¤dup</em>Ã—1æ’å…¥ä½ç½®ï¼š1+1=2ï¼Œå³æ ˆé¡¶2ä¸ªslotä¸‹é¢dup_Ã—2æ’å…¥ä½ç½®ï¼š1+2=3ï¼Œå³æ ˆé¡¶3ä¸ªslotä¸‹é¢ï¼›dup2Ã—1æ’å…¥ä½ç½®ï¼š2+1=3ï¼Œå³æ ˆé¡¶3ä¸ªSlotä¸‹é¢</p>
</li>
<li><p>popï¼šå°†æ ˆé¡¶çš„1ä¸ªSlotæ•°å€¼å‡ºæ ˆã€‚ä¾‹å¦‚1ä¸ªshortç±»å‹æ•°å€¼</p>
</li>
<li><p>pop2ï¼šå°†æ ˆé¡¶çš„2ä¸ªslotæ•°å€¼å‡ºæ ˆã€‚ä¾‹å¦‚1ä¸ªdoubleç±»å‹æ•°å€¼ï¼Œæˆ–è€…2ä¸ªintç±»å‹æ•°å€¼</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">é€šç”¨(æ— ç±»å‹ï¼‰æ ˆæ“ä½œ</span><br><span class="line"> </span><br><span class="line">nop ä¸åšä»»ä½•æ“ä½œ</span><br><span class="line"> </span><br><span class="line">pop å¼¹å‡ºæ ˆé¡¶ç«¯ä¸€ä¸ªå­—é•¿çš„å†…å®¹</span><br><span class="line"> </span><br><span class="line">pop2 å¼¹å‡ºæ ˆé¡¶ç«¯ä¸¤ä¸ªå­—é•¿çš„å†…å®¹</span><br><span class="line"> </span><br><span class="line">dup å¤åˆ¶æ ˆé¡¶éƒ¨ä¸€ä¸ªå­—é•¿å†…å®¹</span><br><span class="line"> </span><br><span class="line">dup_x1 å¤åˆ¶æ ˆé¡¶éƒ¨ä¸€ä¸ªå­—é•¿çš„å†…å®¹ï¼Œç„¶åå°†å¤åˆ¶å†…å®¹åŠåŸæ¥å¼¹å‡ºçš„ä¸¤ä¸ªå­—é•¿çš„å†…å®¹å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">dup_x2 å¤åˆ¶æ ˆé¡¶éƒ¨ä¸€ä¸ªå­—é•¿çš„å†…å®¹ï¼Œç„¶åå°†å¤åˆ¶å†…å®¹åŠåŸæ¥å¼¹å‡ºçš„ä¸‰ä¸ªå­—é•¿çš„å†…å®¹å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">dup2 å¤åˆ¶æ ˆé¡¶éƒ¨ä¸¤ä¸ªå­—é•¿å†…å®¹</span><br><span class="line"> </span><br><span class="line">dup2_x1 å¤åˆ¶æ ˆé¡¶éƒ¨ä¸¤ä¸ªå­—é•¿çš„å†…å®¹ï¼Œç„¶åå°†å¤åˆ¶å†…å®¹åŠåŸæ¥å¼¹å‡ºçš„ä¸‰ä¸ªå­—é•¿çš„å†…å®¹å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">dup2_x2 å¤åˆ¶æ ˆé¡¶éƒ¨ä¸¤ä¸ªå­—é•¿çš„å†…å®¹ï¼Œç„¶åå°†å¤åˆ¶å†…å®¹åŠåŸæ¥å¼¹å‡ºçš„å››ä¸ªå­—é•¿çš„å†…å®¹å‹å…¥æ ˆ</span><br><span class="line"> </span><br><span class="line">swap äº¤æ¢æ ˆé¡¶éƒ¨ä¸¤ä¸ªå­—é•¿å†…å®¹</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-08 10:13</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æŒ‡ä»¤6ï¼šæ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackOperateTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="comment">//        String info = obj.toString();</span></span><br><span class="line">        obj.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç±»ä¼¼çš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">        bar();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">bar</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8ï¼Œæ§åˆ¶è½¬ç§»æŒ‡ä»¤"><a href="#8ï¼Œæ§åˆ¶è½¬ç§»æŒ‡ä»¤" class="headerlink" title="8ï¼Œæ§åˆ¶è½¬ç§»æŒ‡ä»¤"></a>8ï¼Œæ§åˆ¶è½¬ç§»æŒ‡ä»¤</h3><p>ç¨‹åºæµç¨‹ç¦»ä¸å¼€æ¡ä»¶æ§åˆ¶ï¼Œä¸ºäº†æ”¯æŒæ¡ä»¶è·³è½¬ï¼Œè™šæ‹Ÿæœºæä¾›äº†å¤§é‡å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º</p>
<ul>
<li><p>1ï¼‰æ¯”è¾ƒæŒ‡ä»¤ã€</p>
</li>
<li><p>2ï¼‰æ¡ä»¶è·³è½¬æŒ‡ä»¤ã€</p>
</li>
<li><p>3ï¼‰æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤ã€</p>
</li>
<li><p>4ï¼‰å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤ã€</p>
</li>
<li><p>5ï¼‰æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ç­‰ã€‚</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">æ¯”è¾ƒæŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">lcmp æ¯”è¾ƒlongç±»å‹å€¼</span><br><span class="line"> </span><br><span class="line">fcmpl æ¯”è¾ƒfloatç±»å‹å€¼ï¼ˆå½“é‡åˆ°NaNæ—¶ï¼Œè¿”å›-1ï¼‰</span><br><span class="line"> </span><br><span class="line">fcmpg æ¯”è¾ƒfloatç±»å‹å€¼ï¼ˆå½“é‡åˆ°NaNæ—¶ï¼Œè¿”å›1ï¼‰</span><br><span class="line"> </span><br><span class="line">dcmpl æ¯”è¾ƒdoubleç±»å‹å€¼ï¼ˆå½“é‡åˆ°NaNæ—¶ï¼Œè¿”å›-1ï¼‰</span><br><span class="line"> </span><br><span class="line">dcmpg æ¯”è¾ƒdoubleç±»å‹å€¼ï¼ˆå½“é‡åˆ°NaNæ—¶ï¼Œè¿”å›1ï¼‰</span><br><span class="line"> </span><br><span class="line">æ¡ä»¶è·³è½¬æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">ifeq å¦‚æœç­‰äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifne å¦‚æœä¸ç­‰äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">iflt å¦‚æœå°äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifge å¦‚æœå¤§äºç­‰äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifgt å¦‚æœå¤§äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifle å¦‚æœå°äºç­‰äº0ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">æ¯”è¾ƒæ¡ä»¶åˆ†æ”¯æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">if_icmpeq å¦‚æœä¸¤ä¸ªintå€¼ç›¸ç­‰ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_icmpne å¦‚æœä¸¤ä¸ªintç±»å‹å€¼ä¸ç›¸ç­‰ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_icmplt å¦‚æœä¸€ä¸ªintç±»å‹å€¼å°äºå¦å¤–ä¸€ä¸ªintç±»å‹å€¼ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_icmpge å¦‚æœä¸€ä¸ªintç±»å‹å€¼å¤§äºæˆ–è€…ç­‰äºå¦å¤–ä¸€ä¸ªintç±»å‹å€¼ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_icmpgt å¦‚æœä¸€ä¸ªintç±»å‹å€¼å¤§äºå¦å¤–ä¸€ä¸ªintç±»å‹å€¼ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_icmple å¦‚æœä¸€ä¸ªintç±»å‹å€¼å°äºæˆ–è€…ç­‰äºå¦å¤–ä¸€ä¸ªintç±»å‹å€¼ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifnull å¦‚æœç­‰äºnullï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">ifnonnull å¦‚æœä¸ç­‰äºnullï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_acmpeq å¦‚æœä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ç›¸ç­‰ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">if_acmpne å¦‚æœä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ä¸ç›¸ç­‰ï¼Œåˆ™è·³è½¬</span><br><span class="line"> </span><br><span class="line">å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">tableswitch é€šè¿‡ç´¢å¼•è®¿é—®è·³è½¬è¡¨ï¼Œå¹¶è·³è½¬</span><br><span class="line"> </span><br><span class="line">lookupswitch é€šè¿‡é”®å€¼åŒ¹é…è®¿é—®è·³è½¬è¡¨ï¼Œå¹¶æ‰§è¡Œè·³è½¬æ“ä½œ</span><br><span class="line"> </span><br><span class="line">æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">goto æ— æ¡ä»¶è·³è½¬</span><br><span class="line"> </span><br><span class="line">goto_w æ— æ¡ä»¶è·³è½¬ï¼ˆå®½ç´¢å¼•ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-1ï¼Œæ¯”è¾ƒæŒ‡ä»¤"><a href="#8-1ï¼Œæ¯”è¾ƒæŒ‡ä»¤" class="headerlink" title="8.1ï¼Œæ¯”è¾ƒæŒ‡ä»¤"></a>8.1ï¼Œæ¯”è¾ƒæŒ‡ä»¤</h4><p>æ¯”è¾ƒæŒ‡ä»¤çš„ä½œç”¨æ˜¯<strong>æ¯”è¾ƒå æ ˆé¡¶ä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼Œå¹¶å°†æ¯”è¾ƒç»“æœå…¥æ ˆ</strong>ã€‚æ¯”è¾ƒæŒ‡ä»¤æœ‰ï¼š dcmpg,dcmplã€ fcmpgã€fcmplã€lcmpã€‚ä¸å‰é¢è®²è§£çš„æŒ‡ä»¤ç±»ä¼¼ï¼Œé¦–å­—ç¬¦dè¡¨ç¤ºdoubleç±»å‹ï¼Œfè¡¨ç¤ºfloat,lè¡¨ç¤ºlongã€‚</p>
<p>å¯¹äºdoubleå’Œfloatç±»å‹çš„æ•°å­—ï¼Œç”±äºNaNçš„å­˜åœ¨ï¼Œå„æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„æ¯”è¾ƒæŒ‡ä»¤ã€‚ä»¥floatä¸ºä¾‹ï¼Œæœ‰fcmpgå’Œfcmplä¸¤ä¸ªæŒ‡ä»¤ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºåœ¨æ•°å­—æ¯”è¾ƒæ—¶ï¼Œè‹¥é‡åˆ°NaNå€¼ï¼Œå¤„ç†ç»“æœä¸åŒã€‚</p>
<p>æŒ‡ä»¤dcmplå’Œ dcmpgä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ ¹æ®å…¶å‘½åå¯ä»¥æ¨æµ‹å…¶å«ä¹‰ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<p>æ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œæ‰å¯ä»¥è°ˆå¤§å°ï¼booleanã€å¼•ç”¨æ•°æ®ç±»å‹ä¸èƒ½æ¯”è¾ƒå¤§å°ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong></p>
<p>æŒ‡ä»¤ fcmpå’Œfcmpléƒ½ä»ä¸­å¼¹å‡ºä¸¤ä¸ªæ“ä½œæ•°ï¼Œå¹¶å°†å®ƒä»¬åšæ¯”è¾ƒï¼Œè®¾æ ˆé¡¶çš„å…ƒç´ ä¸ºv2ï¼Œé¡¶é¡ºä½ç¬¬2ä½çš„å…ƒç´ ä¸ºv1ï¼šè‹¥v1=v2ï¼Œåˆ™å‹å…¥0ï¼›è‹¥v1&gt;v2ï¼Œåˆ™å‹å…¥1ï¼›è‹¥v1&lt;v2ï¼Œåˆ™å‹å…¥-1ã€‚</p>
<p>ä¸¤ä¸ªæŒ‡ä»¤çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœé‡åˆ°NaNå€¼ï¼Œ fcmpgä¼šå‹å…¥1,è€Œfcmplä¼šå‹å…¥-1</p>
<h4 id="8-2ï¼Œæ¡ä»¶è·³è½¬æŒ‡ä»¤"><a href="#8-2ï¼Œæ¡ä»¶è·³è½¬æŒ‡ä»¤" class="headerlink" title="8.2ï¼Œæ¡ä»¶è·³è½¬æŒ‡ä»¤"></a>8.2ï¼Œæ¡ä»¶è·³è½¬æŒ‡ä»¤</h4><p>æ¡ä»¶è·³è½¬æŒ‡ä»¤é€šå¸¸å’Œæ¯”è¾ƒæŒ‡ä»¤ç»“åˆä½¿ç”¨ã€‚åœ¨æ¡ä»¶è·³è½¬æŒ‡ä»¤æ‰§è¡Œå‰ï¼Œä¸€èˆ¬å¯ä»¥å…ˆç”¨æ¯”è¾ƒæŒ‡ä»¤è¿›è¡Œæ ˆé¡¶å…ƒç´ çš„å‡†å¤‡ï¼Œç„¶åè¿›è¡Œæ¡ä»¶è·³è½¬ã€‚</p>
<p>æ¡ä»¶è·³è½¬æŒ‡ä»¤æœ‰ï¼šifeqï¼Œifltï¼Œifleï¼Œifneï¼Œifgtï¼Œifgeï¼Œifnullï¼Œifnonnullã€‚è¿™äº›æŒ‡ä»¤éƒ½æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œç”¨äºè®¡ç®—è·³è½¬çš„ä½ç½®ï¼ˆ16ä½ç¬¦å·æ•´æ•°ä½œä¸ºå½“å‰ä½ç½®çš„offsetï¼‰ã€‚</p>
<p>å®ƒä»¬çš„ç»Ÿä¸€å«ä¹‰ä¸ºï¼šå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œæµ‹è¯•å®ƒæ˜¯å¦æ»¡è¶³æŸä¸€æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™è·³è½¬åˆ°ç»™å®šä½ç½®ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164452098.png" alt="image-20220304164452098" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220304164505559.png" alt="image-20220304164505559" loading="lazy"></p>
<p>ä¸å‰é¢è¿ç®—è§„åˆ™ä¸€è‡´ï¼š</p>
<ul>
<li><p>å¯¹äºbooleanã€byteã€charã€shortç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œéƒ½æ˜¯ä½¿ç”¨intç±»å‹çš„æ¯”è¾ƒæŒ‡ä»¤å®Œæˆ</p>
</li>
<li><p>å¯¹äºlongã€floatã€doubleç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œåˆ™ä¼šå…ˆæ‰§è¡Œç›¸åº”ç±»å‹çš„æ¯”è¾ƒè¿ç®—æŒ‡ä»¤ï¼Œè¿ç®—æŒ‡ä»¤ä¼šè¿”å›ä¸€ä¸ªæ•´å‹å€¼åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œéšåå†æ‰§è¡Œintç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œæ¥å®Œæˆæ•´ä¸ªåˆ†æ”¯è·³è½¬</p>
</li>
</ul>
<p>ç”±äºå„ç±»å‹çš„æ¯”è¾ƒæœ€ç»ˆéƒ½ä¼šè½¬ä¸ºintç±»å‹çš„æ¯”è¾ƒæ“ä½œï¼Œæ‰€ä»¥Javaè™šæ‹Ÿæœºæä¾›çš„intç±»å‹çš„æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤æ˜¯æœ€ä¸ºä¸°å¯Œå’Œå¼ºå¤§çš„ã€‚</p>
<h4 id="8-3ï¼Œæ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤"><a href="#8-3ï¼Œæ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤" class="headerlink" title="8.3ï¼Œæ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤"></a>8.3ï¼Œæ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤</h4><p>æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤ç±»ä¼¼äºæ¯”è¾ƒæŒ‡ä»¤å’Œæ¡ä»¶è·³è½¬æŒ‡ä»¤çš„ç»“åˆä½“ï¼Œå®ƒå°†æ¯”è¾ƒå’Œè·³è½¬ä¸¤ä¸ªæ­¥éª¤åˆäºŒä¸ºä¸€ã€‚</p>
<p>è¿™ç±»æŒ‡ä»¤æœ‰ï¼šif_icmpeqã€if_icmpneã€if_icmpltã€if_icmpgtã€if_icmpleã€if_icmpgeã€if_acmpeqå’Œif_acmpneã€‚å…¶ä¸­æŒ‡ä»¤åŠ©è®°ç¬¦åŠ ä¸Šâ€œif_â€åï¼Œä»¥å­—ç¬¦â€œiâ€å¼€å¤´çš„æŒ‡ä»¤é’ˆå¯¹itå‹æ•´æ•°æ“ä½œï¼ˆä¹ŸåŒ…æ‹¬shortå’Œbyteç±»å‹ï¼‰ï¼Œä»¥å­—ç¬¦â€œaâ€å¼€å¤´çš„æŒ‡ä»¤è¡¨ç¤ºå¯¹è±¡å¼•ç”¨çš„æ¯”è¾ƒã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164618072.png" alt="image-20220304164618072" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220304164635558.png" alt="image-20220304164635558" loading="lazy"></p>
<p>è¿™äº›æŒ‡ä»¤éƒ½æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ä½œä¸ºå‚æ•°ï¼Œç”¨äºè®¡ç®—è·³è½¬çš„ä½ç½®ã€‚åŒæ—¶åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œæ ˆé¡¶éœ€è¦å‡†å¤‡ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚æŒ‡ä»¤æ‰§è¡Œå®Œæˆåï¼Œæ ˆé¡¶çš„è¿™ä¸¤ä¸ªå…ƒç´ è¢«æ¸…ç©ºï¼Œä¸”æ²¡æœ‰ä»»ä½•æ•°æ®å…¥æ ˆã€‚å¦‚æœé¢„è®¾æ¡ä»¶æˆç«‹ï¼Œåˆ™æ‰§è¡Œè·³è½¬ï¼Œå¦åˆ™ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚</p>
<h4 id="8-4ï¼Œå¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤"><a href="#8-4ï¼Œå¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤" class="headerlink" title="8.4ï¼Œå¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤"></a>8.4ï¼Œå¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤</h4><p>å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤æ˜¯ä¸“ä¸ºswitch-caseè¯­å¥è®¾è®¡çš„ï¼Œä¸»è¦æœ‰tableswitchå’Œlookupswitchã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164716007.png" alt="image-20220304164716007" loading="lazy"></p>
<p>ä»åŠ©è®°ç¬¦ä¸Šçœ‹ï¼Œä¸¤è€…éƒ½æ˜¯switchè¯­å¥çš„å®ç°ï¼Œå®ƒä»¬çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>tableswitchè¦æ±‚å¤šä¸ªæ¡ä»¶åˆ†æ”¯å€¼æ˜¯è¿ç»­çš„ï¼Œå®ƒå†…éƒ¨åªå­˜æ”¾èµ·å§‹å€¼å’Œç»ˆæ­¢å€¼ï¼Œä»¥åŠè‹¥å¹²ä¸ªè·³è½¬åç§»é‡ï¼Œé€šè¿‡ç»™å®šçš„æ“ä½œæ•°indexï¼Œå¯ä»¥ç«‹å³å®šä½åˆ°è·³è½¬åç§»é‡ä½ç½®ï¼Œå› æ­¤æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p>
</li>
<li><p>lookupswitchå†…éƒ¨å­˜æ”¾ç€å„ä¸ªç¦»æ•£çš„case-offsetå¯¹ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¦æœç´¢å…¨éƒ¨çš„case-offsetå¯¹ï¼Œæ‰¾åˆ°åŒ¹é…çš„caseå€¼ï¼Œå¹¶æ ¹æ®å¯¹åº”çš„offsetè®¡ç®—è·³è½¬åœ°å€ï¼Œå› æ­¤æ•ˆç‡è¾ƒä½ã€‚</p>
</li>
</ul>
<p>æŒ‡ä»¤tableswitchçš„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç”±äºtableswitchçš„caseå€¼æ˜¯è¿ç»­çš„ï¼Œå› æ­¤åªéœ€è¦è®°å½•æœ€ä½å€¼å’Œæœ€é«˜å€¼ï¼Œä»¥åŠæ¯ä¸€é¡¹å¯¹åº”çš„offsetåç§»é‡ï¼Œæ ¹æ®ç»™å®šçš„indexå€¼é€šè¿‡ç®€å•çš„è®¡ç®—å³å¯ç›´æ¥å®šä½åˆ°offsetã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164755507.png" alt="image-20220304164755507" loading="lazy"></p>
<p>æŒ‡ä»¤lookupswitchå¤„ç†çš„æ˜¯ç¦»æ•£çš„caseå€¼ï¼Œä½†æ˜¯å‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œå°†case-offsetå¯¹æŒ‰ç…§caseå€¼å¤§å°æ’åºï¼Œç»™å®šindexæ—¶ï¼Œéœ€è¦æŸ¥æ‰¾ä¸indexç›¸ç­‰çš„caseï¼Œè·å¾—å…¶offsetï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™è·³è½¬åˆ°defaultã€‚æŒ‡ä»¤lookupswitchå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164811000.png" alt="image-20220304164811000" loading="lazy"></p>
<h4 id="8-5ï¼Œæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤"><a href="#8-5ï¼Œæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤" class="headerlink" title="8.5ï¼Œæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤"></a>8.5ï¼Œæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</h4><p>ç›®å‰ä¸»è¦çš„æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ä¸ºgotoã€‚æŒ‡ä»¤gotoæ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œå…±åŒç»„æˆä¸€ä¸ªå¸¦ç¬¦å·çš„æ•´æ•°ï¼Œç”¨äºæŒ‡å®šæŒ‡ä»¤çš„åç§»é‡ï¼ŒæŒ‡ä»¤æ‰§è¡Œçš„ç›®çš„å°±æ˜¯è·³è½¬åˆ°åç§»é‡ç»™å®šçš„ä½ç½®å¤„ã€‚</p>
<p>å¦‚æœæŒ‡ä»¤åç§»é‡å¤ªå¤§ï¼Œè¶…è¿‡åŒå­—èŠ‚çš„å¸¦ç¬¦å·æ•´æ•°çš„èŒƒå›´ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æŒ‡ä»¤goto_wï¼Œå®ƒå’Œgotoæœ‰ç›¸åŒçš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒæ¥æ”¶4ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œå¯ä»¥è¡¨ç¤ºæ›´å¤§çš„åœ°å€èŒƒå›´ã€‚</p>
<p>æŒ‡ä»¤jsrã€jsr_wã€retè™½ç„¶ä¹Ÿæ˜¯æ— æ¡ä»¶è·³è½¬çš„ï¼Œä½†ä¸»è¦ç”¨äºtry-finallyè¯­å¥ï¼Œä¸”å·²ç»è¢«è™šæ‹Ÿæœºé€æ¸åºŸå¼ƒï¼Œæ•…ä¸åœ¨è¿™é‡Œä»‹ç»è¿™ä¸¤ä¸ªæŒ‡ä»¤ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220304164839304.png" alt="image-20220304164839304" loading="lazy"></p>
<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-08 10:38</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æŒ‡ä»¤7ï¼šæ§åˆ¶è½¬ç§»æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IfSwitchGotoTest</span> &#123;</span><br><span class="line">    <span class="comment">//1.æ¡ä»¶è·³è½¬æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">compare1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(a != <span class="number">0</span>)&#123;</span><br><span class="line">            a = <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">compareNull</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(str == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»“åˆæ¯”è¾ƒæŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">compare2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">        <span class="type">float</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(f1 &lt; f2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">compare3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">l1</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        System.out.println(i1 &gt; l1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare4</span><span class="params">(<span class="type">double</span> d)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (d &gt; <span class="number">50.0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ifCompare1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        System.out.println(i &gt; j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ifCompare2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">short</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(s1 &gt; b1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ifCompare3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        System.out.println(obj1 == obj2);<span class="comment">//false</span></span><br><span class="line">        System.out.println(obj1 != obj2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swtich1</span><span class="params">(<span class="type">int</span> select)</span>&#123;</span><br><span class="line">        <span class="type">int</span> num;</span><br><span class="line">        <span class="keyword">switch</span>(select)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                num = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                num = <span class="number">20</span>;</span><br><span class="line">                <span class="comment">//break;</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                num = <span class="number">30</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                num = <span class="number">40</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swtich2</span><span class="params">(<span class="type">int</span> select)</span>&#123;</span><br><span class="line">        <span class="type">int</span> num;</span><br><span class="line">        <span class="keyword">switch</span>(select)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">                num = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">                num = <span class="number">20</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">                num = <span class="number">30</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                num = <span class="number">40</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//jdk7æ–°ç‰¹æ€§ï¼šå¼•å…¥Stringç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swtich3</span><span class="params">(String season)</span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(season)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SPRING&quot;</span>:<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SUMMER&quot;</span>:<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;AUTUMN&quot;</span>:<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;WINTER&quot;</span>:<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whileInt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;atguigu.com&quot;</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whileDouble</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">while</span>(d &lt; <span class="number">100.1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;atguigu.com&quot;</span>;</span><br><span class="line">            d++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printFor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">short</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;atguigu.com&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ€è€ƒï¼šå¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•çš„æ“ä½œæœ‰ä½•ä¸åŒï¼Ÿ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whileTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= <span class="number">100</span>)&#123;</span><br><span class="line"></span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¯ä»¥ç»§ç»­ä½¿ç”¨i</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i &lt;= <span class="number">100</span>;i++)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä¸å¯ä»¥ç»§ç»­ä½¿ç”¨i</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ›´è¿›ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doWhileTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;<span class="keyword">while</span>(i &lt;= <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9ï¼Œå¼‚å¸¸å¤„ç†æŒ‡ä»¤"><a href="#9ï¼Œå¼‚å¸¸å¤„ç†æŒ‡ä»¤" class="headerlink" title="9ï¼Œå¼‚å¸¸å¤„ç†æŒ‡ä»¤"></a>9ï¼Œå¼‚å¸¸å¤„ç†æŒ‡ä»¤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å¼‚å¸¸å¤„ç†æŒ‡ä»¤</span><br><span class="line"> </span><br><span class="line">athrow æŠ›å‡ºå¼‚å¸¸æˆ–é”™è¯¯ã€‚å°†æ ˆé¡¶å¼‚å¸¸æŠ›å‡º</span><br><span class="line"> </span><br><span class="line">jsr è·³è½¬åˆ°å­ä¾‹ç¨‹</span><br><span class="line"> </span><br><span class="line">jsr_w è·³è½¬åˆ°å­ä¾‹ç¨‹ï¼ˆå®½ç´¢å¼•ï¼‰</span><br><span class="line"> </span><br><span class="line">ret ä»å­ä¾‹ç¨‹è¿”å›</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>athrowæŒ‡ä»¤</strong></p>
<p>åœ¨Javaç¨‹åºä¸­æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸çš„æ“ä½œï¼ˆthrowè¯­å¥ï¼‰éƒ½æ˜¯ç”±athrowæŒ‡ä»¤æ¥å®ç°ã€‚</p>
<p>é™¤äº†ä½¿ç”¨throwè¯­å¥æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸æƒ…å†µä¹‹å¤–ï¼ŒJVMè§„èŒƒè¿˜è§„å®šäº†è®¸å¤šè¿è¡Œæ—¶å¼‚å¸¸ä¼šåœ¨å…¶ä»–Javaè™šæ‹ŸæœºæŒ‡ä»¤æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶å†µæ—¶è‡ªåŠ¨æŠ›å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¹‹å‰ä»‹ç»çš„æ•´æ•°è¿ç®—æ—¶ï¼Œå½“é™¤æ•°ä¸ºé›¶æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨idivæˆ–1divæŒ‡ä»¤ä¸­æŠ›å‡ºArithmeticExceptionå¼‚å¸¸ã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œæ•°æ ˆçš„å‹å…¥å¼¹å‡ºéƒ½æ˜¯ä¸€æ¡æ¡æŒ‡ä»¤å®Œæˆçš„ã€‚å”¯ä¸€çš„ä¾‹å¤–æƒ…å†µæ˜¯åœ¨æŠ›å¼‚å¸¸æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šæ¸…é™¤æ“ä½œæ•°æ ˆä¸Šçš„æ‰€æœ‰å†…å®¹ï¼Œè€Œåå°†å¼‚å¸¸å®ä¾‹å‹å…¥è°ƒç”¨è€…æ“ä½œæ•°æ ˆä¸Šã€‚</p>
<p><strong>å¤„ç†å¼‚å¸¸</strong></p>
<p>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¤„ç†å¼‚å¸¸ï¼ˆcatchè¯­å¥ï¼‰ä¸æ˜¯ç”±å­—èŠ‚ç æŒ‡ä»¤æ¥å®ç°çš„ï¼ˆæ—©æœŸä½¿ç”¨jsrã€retæŒ‡ä»¤ï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨å¼‚å¸¸è¡¨æ¥å®Œæˆçš„ã€‚</p>
<p><strong>å¼‚å¸¸è¡¨</strong></p>
<p>å¦‚æœä¸€ä¸ªæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªtry-catch æˆ–è€…try-finallyçš„å¼‚å¸¸å¤„ç†ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå¼‚å¸¸è¡¨ã€‚å®ƒåŒ…å«äº†æ¯ä¸ªå¼‚å¸¸å¤„ç†æˆ–è€…finallyå—çš„ä¿¡æ¯ã€‚å¼‚å¸¸è¡¨ä¿å­˜äº†æ¯ä¸ªå¼‚å¸¸å¤„ç†ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><p>èµ·å§‹ä½ç½®</p>
</li>
<li><p>ç»“æŸä½ç½®</p>
</li>
<li><p>ç¨‹åºè®¡æ•°å™¨è®°å½•çš„ä»£ç å¤„ç†çš„åç§»åœ°å€</p>
</li>
<li><p>è¢«æ•è·çš„å¼‚å¸¸ç±»åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•</p>
</li>
</ul>
<p>å½“ä¸€ä¸ªå¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼ŒJVMä¼šåœ¨å½“å‰çš„æ–¹æ³•é‡Œå¯»æ‰¾ä¸€ä¸ªåŒ¹é…çš„å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¼ºåˆ¶ç»“æŸå¹¶å¼¹å‡ºå½“å‰æ ˆå¸§ï¼Œå¹¶ä¸”å¼‚å¸¸ä¼šé‡æ–°æŠ›ç»™ä¸Šå±‚è°ƒç”¨çš„æ–¹æ³•ï¼ˆåœ¨è°ƒç”¨æ–¹æ³•æ ˆå¸§ï¼‰ã€‚å¦‚æœåœ¨æ‰€æœ‰æ ˆå¸§å¼¹å‡ºå‰ä»ç„¶æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™ä¸ªçº¿ç¨‹å°†ç»ˆæ­¢ã€‚å¦‚æœè¿™ä¸ªå¼‚å¸¸åœ¨æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹é‡ŒæŠ›å‡ºï¼Œå°†ä¼šå¯¼è‡´JVMè‡ªå·±ç»ˆæ­¢ï¼Œæ¯”å¦‚è¿™ä¸ªçº¿ç¨‹æ˜¯ä¸ªmainçº¿ç¨‹ã€‚</p>
<p>ä¸ç®¡ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸å¤„ç†æœ€ç»ˆåŒ¹é…äº†æ‰€æœ‰å¼‚å¸¸ç±»å‹ï¼Œä»£ç å°±ä¼šç»§ç»­æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ–¹æ³•ç»“æŸåæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œä»ç„¶æ‰§è¡Œfinallyå—ï¼Œåœ¨returnå‰ï¼Œå®ƒç›´æ¥è·³åˆ°finallyå—æ¥å®Œæˆç›®æ ‡</p>
<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-08 11:30</span></span><br><span class="line"><span class="comment"> * æŒ‡ä»¤8ï¼šå¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">throwZero</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‚æ•°å€¼ä¸º0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">throwOne</span><span class="params">(<span class="type">int</span> i)</span> <span class="keyword">throws</span> RuntimeException,IOException&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‚æ•°å€¼ä¸º1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">throwArithmetic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i / <span class="number">0</span>;</span><br><span class="line">        System.out.println(j);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryCatch</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/hello.txt&quot;</span>);</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(RuntimeException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ€è€ƒï¼šå¦‚ä¸‹æ–¹æ³•è¿”å›ç»“æœä¸ºå¤šå°‘ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">func</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">            str = <span class="string">&quot;atguigu&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(func());<span class="comment">//hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10ï¼ŒåŒæ­¥æ§åˆ¶æŒ‡ä»¤"><a href="#10ï¼ŒåŒæ­¥æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="10ï¼ŒåŒæ­¥æ§åˆ¶æŒ‡ä»¤"></a>10ï¼ŒåŒæ­¥æ§åˆ¶æŒ‡ä»¤</h3><p>Javaè™šæ‹Ÿæœºæ”¯æŒä¸¤ç§åŒæ­¥ç»“æ„ï¼šæ–¹æ³•çº§çš„åŒæ­¥å’Œæ–¹æ³•å†…éƒ¨ä¸€æ®µæŒ‡ä»¤åºåˆ—çš„åŒæ­¥ï¼Œè¿™ä¸¤ç§åŒæ­¥éƒ½æ˜¯ä½¿ç”¨monitoræ¥æ”¯æŒçš„</p>
<h4 id="10-1ï¼Œæ–¹æ³•çº§çš„åŒæ­¥"><a href="#10-1ï¼Œæ–¹æ³•çº§çš„åŒæ­¥" class="headerlink" title="10.1ï¼Œæ–¹æ³•çº§çš„åŒæ­¥"></a>10.1ï¼Œæ–¹æ³•çº§çš„åŒæ­¥</h4><p>æ–¹æ³•çº§çš„åŒæ­¥ï¼šæ˜¯éšå¼çš„ï¼Œå³æ— é¡»é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚è™šæ‹Ÿæœºå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± çš„æ–¹æ³•è¡¨ç»“æ„ä¸­çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—å¾—çŸ¥ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼›</p>
<p>å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ˜¯å¦è®¾ç½®ã€‚</p>
<ul>
<li><p>å¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰åŒæ­¥é”ï¼Œç„¶åæ‰§è¡Œæ–¹æ³•ã€‚æœ€ååœ¨æ–¹æ³•å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆï¼‰æ—¶é‡Šæ”¾åŒæ­¥é”ã€‚</p>
</li>
<li><p>åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†åŒæ­¥é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ªé”ã€‚</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„é”å°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•ä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">	i++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0</span>  aload_0</span><br><span class="line"><span class="number">1</span>  dup</span><br><span class="line"><span class="number">2</span>  getfield #<span class="number">2</span> &lt;com/atguigu/java1/SynchronizedTest.i&gt;</span><br><span class="line"><span class="number">5</span>  iconst_1 </span><br><span class="line"><span class="number">6</span>  iadd</span><br><span class="line"><span class="number">7</span>  putfield #<span class="number">2</span> &lt;com/atguigu/java1/SynchronizedTest.i&gt;</span><br><span class="line"><span class="number">10</span> <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å’Œæ™®é€šçš„æ— åŒæ­¥æ“ä½œçš„ä»£ç æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œæ²¡æœ‰ä½¿ç”¨monitorenterå’Œmonitorexitè¿›è¡ŒåŒæ­¥åŒºæ§åˆ¶ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºåŒæ­¥æ–¹æ³•è€Œè¨€ï¼Œå½“è™šæ‹Ÿæœºé€šè¿‡æ–¹æ³•çš„è®¿é—®æ ‡ç¤ºç¬¦åˆ¤æ–­æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨æ–¹æ³•è°ƒç”¨å‰è¿›è¡ŒåŠ é”ï¼Œå½“åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œä¸ç®¡æ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œå‡ä¼šç”±è™šæ‹Ÿæœºé‡Šæ”¾è¿™ä¸ªé”ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºåŒæ­¥æ–¹æ³•è€Œè¨€ï¼Œmonitorenterå’ŒmonitorexitæŒ‡ä»¤æ˜¯éšå¼å­˜åœ¨çš„ï¼Œå¹¶æœªç›´æ¥å‡ºç°åœ¨å­—èŠ‚ç ä¸­ã€‚</p>
<h4 id="10-2ï¼Œæ–¹æ³•å†…æŒ‡ä»¤æŒ‡ä»¤åºåˆ—çš„åŒæ­¥"><a href="#10-2ï¼Œæ–¹æ³•å†…æŒ‡ä»¤æŒ‡ä»¤åºåˆ—çš„åŒæ­¥" class="headerlink" title="10.2ï¼Œæ–¹æ³•å†…æŒ‡ä»¤æŒ‡ä»¤åºåˆ—çš„åŒæ­¥"></a>10.2ï¼Œæ–¹æ³•å†…æŒ‡ä»¤æŒ‡ä»¤åºåˆ—çš„åŒæ­¥</h4><p>åŒæ­¥ä¸€æ®µæŒ‡ä»¤é›†åºåˆ—ï¼šé€šå¸¸æ˜¯ç”±javaä¸­çš„synchronizedè¯­å¥å—æ¥è¡¨ç¤ºçš„ã€‚jvmçš„æŒ‡ä»¤é›†æœ‰monitorenterå’Œmonitorexit ä¸¤æ¡æŒ‡ä»¤æ¥æ”¯æŒsynchronizedå…³é”®å­—çš„è¯­ä¹‰ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒä½¿ç”¨monitorenteræŒ‡ä»¤è¯·æ±‚è¿›å…¥ã€‚å¦‚æœå½“å‰å¯¹è±¡çš„ç›‘è§†å™¨è®¡æ•°å™¨ä¸º0ï¼Œåˆ™å®ƒä¼šè¢«å‡†è®¸è¿›å…¥ï¼Œè‹¥ä¸º1ï¼Œåˆ™åˆ¤æ–­æŒæœ‰å½“å‰ç›‘è§†å™¨çš„çº¿ç¨‹æ˜¯å¦ä¸ºè‡ªå·±ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥ï¼Œå¦åˆ™è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°å¯¹è±¡çš„ç›‘è§†å™¨è®¡æ•°å™¨ä¸º0ï¼Œæ‰ä¼šè¢«å…è®¸è¿›å…¥åŒæ­¥å—ã€‚</p>
<p>å½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—æ—¶ï¼Œéœ€è¦ä½¿ç”¨monitorexitå£°æ˜é€€å‡ºã€‚åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç›‘è§†å™¨ä¸ä¹‹ç›¸å…³è”ï¼Œç”¨æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«é”å®šï¼Œå½“ç›‘è§†å™¨è¢«æŒæœ‰åï¼Œå¯¹è±¡å¤„äºé”å®šçŠ¶æ€ã€‚</p>
<p>æŒ‡ä»¤monitorenterå’Œmonitorexitåœ¨æ‰§è¡Œæ—¶ï¼Œéƒ½éœ€è¦åœ¨æ“ä½œæ•°æ ˆé¡¶å‹å…¥å¯¹è±¡ï¼Œä¹‹åmonitorenterå’Œmonitorexitçš„é”å®šå’Œé‡Šæ”¾éƒ½æ˜¯é’ˆå¯¹è¿™ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨è¿›è¡Œçš„ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†ç›‘è§†å™¨å¦‚ä½•ä¿æŠ¤ä¸´ç•ŒåŒºä»£ç ä¸åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œåªæœ‰å½“çº¿ç¨‹4ç¦»å¼€ä¸´ç•ŒåŒºåï¼Œçº¿ç¨‹1ã€2ã€3æ‰æœ‰å¯èƒ½è¿›å…¥ã€‚</p>
<p>å¯¹åº”çš„å­—èŠ‚ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subtract</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (obj)&#123;</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="number">0</span>: aloade</span><br><span class="line"> <span class="number">1</span>: dup</span><br><span class="line"> <span class="number">2</span>: astore_1</span><br><span class="line"> <span class="number">3</span>: monitorenter</span><br><span class="line"> <span class="number">4</span>: aload_0</span><br><span class="line"> <span class="number">5</span>: dup</span><br><span class="line"> <span class="number">6</span>: getfield #<span class="number">2</span> <span class="comment">//Field i:I</span></span><br><span class="line"> <span class="number">9</span>: iconst_1</span><br><span class="line"><span class="number">10</span>: isub</span><br><span class="line"><span class="number">11</span>: putfield #<span class="number">2</span> <span class="comment">//Field i:I</span></span><br><span class="line"><span class="number">14</span>: aload_1</span><br><span class="line"><span class="number">15</span>: monitorexit</span><br><span class="line"><span class="number">16</span>: goto <span class="number">24</span></span><br><span class="line"><span class="number">19</span>: astore_2</span><br><span class="line"><span class="number">26</span>: aload_1</span><br><span class="line"><span class="number">21</span>: monitorexit</span><br><span class="line"><span class="number">22</span>: aload_2</span><br><span class="line"><span class="number">23</span>: athrow</span><br><span class="line"><span class="number">24</span>: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">Exception table:</span><br><span class="line">	from to target type</span><br><span class="line">	<span class="number">4</span>	 <span class="number">16</span>	   <span class="number">19</span>  any</span><br><span class="line">	<span class="number">19</span>	 <span class="number">22</span>    <span class="number">19</span>  any</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨å¿…é¡»ç¡®ä¿æ— è®ºæ–¹æ³•é€šè¿‡ä½•ç§æ–¹å¼å®Œæˆï¼Œæ–¹æ³•ä¸­è°ƒç”¨è¿‡çš„æ¯æ¡monitorenteræŒ‡ä»¤éƒ½å¿…é¡»æ‰§è¡Œå…¶å¯¹åº”çš„monitorexitæŒ‡ä»¤ï¼Œè€Œæ— è®ºè¿™ä¸ªæ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸã€‚</p>
<p>ä¸ºäº†ä¿è¯åœ¨æ–¹æ³•å¼‚å¸¸å®Œæˆæ—¶monitorenterå’ŒmonitorexitæŒ‡ä»¤ä¾ç„¶å¯ä»¥æ­£ç¡®é…å¯¹æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†å™¨å£°æ˜å¯å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œmonitoreã€‚</p>
<h2 id="ä¸‰ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹ï¼ˆç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰è¯¦è§£"><a href="#ä¸‰ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹ï¼ˆç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰è¯¦è§£" class="headerlink" title="ä¸‰ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹ï¼ˆç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰è¯¦è§£"></a>ä¸‰ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹ï¼ˆç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰è¯¦è§£</h2><h3 id="1ï¼Œæ¦‚è¿°-1"><a href="#1ï¼Œæ¦‚è¿°-1" class="headerlink" title="1ï¼Œæ¦‚è¿°"></a>1ï¼Œæ¦‚è¿°</h3><p>åœ¨Javaä¸­æ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚<strong>åŸºæœ¬æ•°æ®ç±»å‹ç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œå¼•ç”¨æ•°æ®ç±»å‹åˆ™éœ€è¦è¿›è¡Œç±»çš„åŠ è½½ã€‚</strong></p>
<p>æŒ‰ç…§Javaè™šæ‹Ÿæœºè§„èŒƒï¼Œä»classæ–‡ä»¶åˆ°åŠ è½½åˆ°å†…å­˜ä¸­çš„ç±»ï¼Œåˆ°ç±»å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬å¦‚ä¸‹7ä¸ªé˜¶æ®µï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220305155427446.png" alt="image-20220305155427446" loading="lazy"></p>
<p>å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºé“¾æ¥ï¼ˆLinkingï¼‰</p>
<p>ä»ç¨‹åºä¸­ç±»çš„ä½¿ç”¨è¿‡ç¨‹çœ‹</p>
<p><img src="/2022/04/18/JVM/image-20220305155456880.png" alt="image-20220305155456880" loading="lazy"></p>
<p><strong>å¤§å‚é¢è¯•é¢˜</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">èš‚èšé‡‘æœï¼š</span><br><span class="line"> </span><br><span class="line">æè¿°ä¸€ä¸‹JVMåŠ è½½Classæ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">ä¸€é¢ï¼šç±»åŠ è½½è¿‡ç¨‹</span><br><span class="line"> </span><br><span class="line">ç™¾åº¦ï¼š</span><br><span class="line"> </span><br><span class="line">ç±»åŠ è½½çš„æ—¶æœº</span><br><span class="line"> </span><br><span class="line">javaç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">ç®€è¿°javaç±»åŠ è½½æœºåˆ¶ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">è…¾è®¯ï¼š</span><br><span class="line"> </span><br><span class="line">JVMä¸­ç±»åŠ è½½æœºåˆ¶ï¼Œç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">æ»´æ»´ï¼š</span><br><span class="line"> </span><br><span class="line">JVMç±»åŠ è½½æœºåˆ¶</span><br><span class="line"> </span><br><span class="line">ç¾å›¢ï¼š</span><br><span class="line"> </span><br><span class="line">Javaç±»åŠ è½½è¿‡ç¨‹</span><br><span class="line"> </span><br><span class="line">æè¿°ä¸€ä¸‹jvmåŠ è½½classæ–‡ä»¶çš„åŸç†æœºåˆ¶</span><br><span class="line"> </span><br><span class="line">äº¬ä¸œï¼š</span><br><span class="line"> </span><br><span class="line">ä»€ä¹ˆæ˜¯ç±»çš„åŠ è½½ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">å“ªäº›æƒ…å†µä¼šè§¦å‘ç±»çš„åŠ è½½ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">è®²ä¸€ä¸‹JVMåŠ è½½ä¸€ä¸ªç±»çš„è¿‡ç¨‹JVMçš„ç±»åŠ è½½æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼Œè¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ"><a href="#2ï¼Œè¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ" class="headerlink" title="2ï¼Œè¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ"></a>2ï¼Œè¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ</h3><h4 id="2-1ï¼ŒåŠ è½½å®Œæˆçš„æ“ä½œ"><a href="#2-1ï¼ŒåŠ è½½å®Œæˆçš„æ“ä½œ" class="headerlink" title="2.1ï¼ŒåŠ è½½å®Œæˆçš„æ“ä½œ"></a>2.1ï¼ŒåŠ è½½å®Œæˆçš„æ“ä½œ</h4><p><strong>åŠ è½½çš„ç†è§£</strong></p>
<p>æ‰€è°“åŠ è½½ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å°†Javaç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡ºjavaç±»çš„åŸå‹â€”â€”ç±»æ¨¡æ¿å¯¹è±¡ã€‚</p>
<p>æ‰€è°“ç±»æ¨¡æ¿å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯Javaç±»åœ¨]VMå†…å­˜ä¸­çš„ä¸€ä¸ªå¿«ç…§ï¼ŒJVMå°†ä»å­—èŠ‚ç æ–‡ä»¶ä¸­è§£æå‡ºçš„å¸¸é‡æ± ã€ç±»å­—æ®µã€ç±»æ–¹æ³•ç­‰ä¿¡æ¯å­˜å‚¨åˆ°ç±»æ¨¡æ¿ä¸­ï¼Œè¿™æ ·]VMåœ¨è¿è¡ŒæœŸä¾¿èƒ½é€šè¿‡ç±»æ¨¡æ¿è€Œè·å–Javaç±»ä¸­çš„ä»»æ„ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¯¹Javaç±»çš„æˆå‘˜å˜é‡è¿›è¡Œéå†ï¼Œä¹Ÿèƒ½è¿›è¡ŒJavaæ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>åå°„çš„æœºåˆ¶å³åŸºäºè¿™ä¸€åŸºç¡€ã€‚å¦‚æœJVMæ²¡æœ‰å°†Javaç±»çš„å£°æ˜ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œåˆ™JVMåœ¨è¿è¡ŒæœŸä¹Ÿæ— æ³•åå°„ã€‚</p>
<p><strong>åŠ è½½å®Œæˆçš„æ“ä½œ</strong></p>
<p><img src="/2022/04/18/JVM/image-20220305155838124.png" alt="image-20220305155838124" loading="lazy"></p>
<p>åœ¨åŠ è½½ç±»æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå¿…é¡»å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li><p> é€šè¿‡ç±»çš„å…¨åï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµã€‚ </p>
</li>
<li><p> è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµä¸ºæ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼ˆJavaç±»æ¨¡å‹ï¼‰ </p>
</li>
<li><p> åˆ›å»ºjava.lang.Classç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ã€‚ä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ </p>
</li>
</ul>
<h4 id="2-2ï¼ŒäºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼"><a href="#2-2ï¼ŒäºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼" class="headerlink" title="2.2ï¼ŒäºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼"></a>2.2ï¼ŒäºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼</h4><p>å¯¹äºç±»çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡å¤šç§é€”å¾„äº§ç”Ÿæˆ–è·å¾—ã€‚ï¼ˆåªè¦æ‰€è¯»å–çš„å­—èŠ‚ç ç¬¦åˆJVMè§„èŒƒå³å¯ï¼‰</p>
<ul>
<li><p>è™šæ‹Ÿæœºå¯èƒ½é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè¯»å…¥ä¸€ä¸ªclassåç¼€çš„æ–‡ä»¶<img src="/2022/04/18/JVM/image-20220305160958219.png" alt="image-20220305160958219" loading="lazy"></p>
</li>
<li><p>è¯»å…¥jarã€zipç­‰å½’æ¡£æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ã€‚</p>
</li>
<li><p>äº‹å…ˆå­˜æ”¾åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ®</p>
</li>
<li><p>ä½¿ç”¨ç±»ä¼¼äºHTTPä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œè¿›è¡ŒåŠ è½½</p>
</li>
<li><p>åœ¨è¿è¡Œæ—¶ç”Ÿæˆä¸€æ®µclassçš„äºŒè¿›åˆ¶ä¿¡æ¯ç­‰</p>
</li>
<li><p>åœ¨è·å–åˆ°ç±»çš„äºŒè¿›åˆ¶ä¿¡æ¯åï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šå¤„ç†è¿™äº›æ•°æ®ï¼Œå¹¶æœ€ç»ˆè½¬ä¸ºä¸€ä¸ªjava.lang.Classçš„å®ä¾‹ã€‚</p>
</li>
</ul>
<p>å¦‚æœè¾“å…¥æ•°æ®ä¸æ˜¯ClassFileçš„ç»“æ„ï¼Œåˆ™ä¼šæŠ›å‡ºClassFormatErrorã€‚</p>
<h4 id="2-3ï¼Œç±»æ¨¡å‹ä¸Classå®ä¾‹çš„ä½ç½®"><a href="#2-3ï¼Œç±»æ¨¡å‹ä¸Classå®ä¾‹çš„ä½ç½®" class="headerlink" title="2.3ï¼Œç±»æ¨¡å‹ä¸Classå®ä¾‹çš„ä½ç½®"></a>2.3ï¼Œç±»æ¨¡å‹ä¸Classå®ä¾‹çš„ä½ç½®</h4><p><strong>ç±»æ¨¡å‹çš„ä½ç½®</strong></p>
<p>åŠ è½½çš„ç±»åœ¨JVMä¸­åˆ›å»ºç›¸åº”çš„ç±»ç»“æ„ï¼Œç±»ç»“æ„ä¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆJDKl.8ä¹‹å‰ï¼šæ°¸ä¹…ä»£ï¼›J0Kl.8åŠä¹‹åï¼šå…ƒç©ºé—´ï¼‰ã€‚</p>
<p><strong>Classå®ä¾‹çš„ä½ç½®</strong></p>
<p>ç±»å°†.classæ–‡ä»¶åŠ è½½è‡³å…ƒç©ºé—´åï¼Œä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªJava.lang.Classå¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»ä½äºæ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œè¯¥Classå¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„ï¼Œæ¯ä¸ªç±»éƒ½å¯¹åº”æœ‰ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220305161106655.png" alt="image-20220305161106655" loading="lazy"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–å½“å‰è¿è¡Œæ—¶ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">Method[] ms = clazz.getDecla#FF0000Methods();</span><br><span class="line"><span class="keyword">for</span> (Method m : ms) &#123;</span><br><span class="line">    <span class="comment">//è·å–æ–¹æ³•çš„ä¿®é¥°ç¬¦</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">mod</span> <span class="operator">=</span> Modifier.toString(m.getModifiers());</span><br><span class="line">    System.out.print(mod + <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">returnType</span> <span class="operator">=</span> (m.getReturnType()).getSimpleName();</span><br><span class="line">    System.out.print(returnType + <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–æ–¹æ³•å</span></span><br><span class="line">    System.out.print(m.getName() + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–æ–¹æ³•çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">    Class&lt;?&gt;[] ps = m.getParameterTypes();</span><br><span class="line">    <span class="keyword">if</span> (ps.length == <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.print(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ps.length; i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">end</span> <span class="operator">=</span> (i == ps.length - <span class="number">1</span>) ? <span class="string">&#x27;)&#x27;</span> : <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">        <span class="comment">//è·å–å‚æ•™çš„ç±»å‹</span></span><br><span class="line">        System.out.print(ps[i].getSimpleName() + end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4ï¼Œæ•°ç»„ç±»çš„åŠ è½½"><a href="#2-4ï¼Œæ•°ç»„ç±»çš„åŠ è½½" class="headerlink" title="2.4ï¼Œæ•°ç»„ç±»çš„åŠ è½½"></a>2.4ï¼Œæ•°ç»„ç±»çš„åŠ è½½</h4><p>åˆ›å»ºæ•°ç»„ç±»çš„æƒ…å†µç¨å¾®æœ‰äº›ç‰¹æ®Šï¼Œå› ä¸º<strong>æ•°ç»„ç±»æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯ç”±JVMåœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦è€Œç›´æ¥åˆ›å»ºçš„</strong>ï¼Œ<strong>ä½†æ•°ç»„çš„å…ƒç´ ç±»å‹ä»ç„¶éœ€è¦ä¾é ç±»åŠ è½½å™¨å»åˆ›å»º</strong>ã€‚åˆ›å»ºæ•°ç»„ç±»ï¼ˆä¸‹è¿°ç®€ç§°Aï¼‰çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>å¦‚æœæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆå°±éµå¾ªå®šä¹‰çš„åŠ è½½è¿‡ç¨‹é€’å½’åŠ è½½å’Œåˆ›å»ºæ•°ç»„Açš„å…ƒç´ ç±»å‹ï¼›</p>
</li>
<li><p>JVMä½¿ç”¨æŒ‡å®šçš„å…ƒç´ ç±»å‹å’Œæ•°ç»„ç»´åº¦æ¥åˆ›å»ºæ–°çš„æ•°ç»„ç±»ã€‚</p>
</li>
</ul>
<p>å¦‚æœæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°±ç”±å…ƒç´ ç±»å‹çš„å¯è®¿é—®æ€§å†³å®šã€‚å¦åˆ™æ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°†è¢«ç¼ºçœå®šä¹‰ä¸ºpublicã€‚</p>
<p><strong>ç†è§£ï¼š</strong></p>
<ul>
<li>æ•°ç»„è¿™ä¸ªç»“æ„æ˜¯ç”±JVMç›´æ¥åˆ›å»ºçš„ï¼Œå’Œç±»åŠ è½½å™¨æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯æ•°ç»„çš„å…ƒç´ æ—¶æœ‰ç±»å‹çš„ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™å°±æœ‰å¯èƒ½ä¼šç”¨åˆ°ç±»çš„åŠ è½½å™¨ã€‚</li>
<li>æ•°æ®ç±»å‹åŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚è€ŒåŸºæœ¬æ•°æ®ç±»å‹æ˜¯ç”±JVMè¿è¡ŒåŠ è½½å¥½çš„ï¼Œæ‰€ä»¥å¦‚æœåŠ è½½çš„æ•°ç»„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå°±ä¸éœ€è¦ç±»åŠ è½½å™¨ï¼Œåªè€ƒè™‘å®ƒçš„é•¿åº¦å³å¯ï¼Œä¸”ä»–çš„ä¿®é¥°ç¬¦æ˜¯<code>pubilc</code>ã€‚</li>
<li>å¦‚æœåŠ è½½çš„æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡ç±»åŠ è½½å™¨å°†è¿™ä¸ªç±»å‹åŠ è½½è¿›å»ï¼Œä¹‹åæ‰èƒ½è®©JVMåˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦çš„ä¸ä»…ä»…æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œè€Œä¸”ä¹Ÿéœ€è¦å…³å¿ƒå®ƒçš„ç±»å‹ï¼ŒåŒæ—¶å®ƒçš„è®¿é—®æƒé™æ˜¯ç”±å®ƒé‡Œé¢çš„å…ƒç´ çš„è®¿é—®æƒé™å†³å®šçš„ã€‚</li>
</ul>
<h3 id="3ï¼Œè¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ"><a href="#3ï¼Œè¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ" class="headerlink" title="3ï¼Œè¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ"></a>3ï¼Œè¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ</h3><h4 id="3-1ï¼Œç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰"><a href="#3-1ï¼Œç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰" class="headerlink" title="3.1ï¼Œç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰"></a>3.1ï¼Œç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰</h4><p>å½“ç±»åŠ è½½åˆ°ç³»ç»Ÿåï¼Œå°±å¼€å§‹é“¾æ¥æ“ä½œï¼ŒéªŒè¯æ˜¯é“¾æ¥æ“ä½œçš„ç¬¬ä¸€æ­¥ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220305163900589.png" alt="image-20220305163900589" loading="lazy"></p>
<p>éªŒè¯çš„æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œå®é™…è¦éªŒè¯çš„é¡¹ç›®ä¹Ÿå¾ˆç¹å¤šï¼Œå¤§ä½“ä¸ŠJavaè™šæ‹Ÿæœºéœ€è¦åšä»¥ä¸‹æ£€æŸ¥ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220305163921502.png" alt="image-20220305163921502" loading="lazy"></p>
<p><strong>æ•´ä½“è¯´æ˜ï¼š</strong></p>
<p>éªŒè¯çš„å†…å®¹åˆ™æ¶µç›–äº†ç±»æ•°æ®ä¿¡æ¯çš„æ ¼å¼éªŒè¯ã€è¯­ä¹‰æ£€æŸ¥ã€å­—èŠ‚ç éªŒè¯ï¼Œä»¥åŠç¬¦å·å¼•ç”¨éªŒè¯ç­‰ã€‚</p>
<ul>
<li><p><img src="/2022/04/18/JVM/image-20220305163953764.png" alt="image-20220305163953764" loading="lazy">éªŒè¯é€šè¿‡ä¹‹åï¼Œç±»åŠ è½½å™¨æ‰ä¼šæˆåŠŸå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ã€‚</p>
</li>
<li><p><img src="/2022/04/18/JVM/image-20220305164053384.png" alt="image-20220305164053384" loading="lazy"></p>
</li>
</ul>
<p>é“¾æ¥é˜¶æ®µçš„éªŒè¯è™½ç„¶æ‹–æ…¢äº†åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯å®ƒé¿å…äº†åœ¨å­—èŠ‚ç è¿è¡Œæ—¶è¿˜éœ€è¦è¿›è¡Œå„ç§æ£€æŸ¥ã€‚ï¼ˆç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼‰</p>
<p><strong>å…·ä½“è¯´æ˜ï¼š</strong></p>
<ol>
<li><p>æ ¼å¼éªŒè¯ï¼šæ˜¯å¦ä»¥é­”æ•°0XCAFEBABEå¼€å¤´ï¼Œä¸»ç‰ˆæœ¬å’Œå‰¯ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰Javaè™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†…ï¼Œæ•°æ®ä¸­æ¯ä¸€ä¸ªé¡¹æ˜¯å¦éƒ½æ‹¥æœ‰æ­£ç¡®çš„é•¿åº¦ç­‰ã€‚ </p>
</li>
<li><p>è¯­ä¹‰æ£€æŸ¥ï¼šJavaè™šæ‹Ÿæœºä¼šè¿›è¡Œå­—èŠ‚ç çš„è¯­ä¹‰æ£€æŸ¥ï¼Œä½†å‡¡åœ¨è¯­ä¹‰ä¸Šä¸ç¬¦åˆè§„èŒƒçš„ï¼Œè™šæ‹Ÿæœºä¹Ÿä¸ä¼šç»™äºˆéªŒè¯é€šè¿‡ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>æ˜¯å¦æ‰€æœ‰çš„ç±»éƒ½æœ‰çˆ¶ç±»çš„å­˜åœ¨ï¼ˆåœ¨Javaé‡Œï¼Œé™¤äº†objectå¤–ï¼Œå…¶ä»–ç±»éƒ½åº”è¯¥æœ‰çˆ¶ç±»ï¼‰</li>
<li>æ˜¯å¦ä¸€äº›è¢«å®šä¹‰ä¸ºfinalçš„æ–¹æ³•æˆ–è€…ç±»è¢«é‡å†™æˆ–ç»§æ‰¿äº†</li>
<li>éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–è€…æ¥å£æ–¹æ³•</li>
</ul>
</li>
<li><p>å­—èŠ‚ç éªŒè¯ï¼šJavaè™šæ‹Ÿæœºè¿˜ä¼šè¿›è¡Œå­—èŠ‚ç éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œå®ƒè¯•å›¾é€šè¿‡å¯¹å­—èŠ‚ç æµçš„åˆ†æï¼Œåˆ¤æ–­å­—èŠ‚ç æ˜¯å¦å¯ä»¥è¢«æ­£ç¡®åœ°æ‰§è¡Œã€‚æ¯”å¦‚ï¼š </p>
<ul>
<li>åœ¨å­—èŠ‚ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€æ¡ä¸å­˜åœ¨çš„æŒ‡ä»¤</li>
<li>å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®ç±»å‹çš„å‚æ•°</li>
<li>å˜é‡çš„èµ‹å€¼æ˜¯ä¸æ˜¯ç»™äº†æ­£ç¡®çš„æ•°æ®ç±»å‹ç­‰</li>
</ul>
<p>æ ˆæ˜ å°„å¸§ï¼ˆStackMapTableï¼‰å°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç”¨äºæ£€æµ‹åœ¨ç‰¹å®šçš„å­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ã€‚ä½†é—æ†¾çš„æ˜¯ï¼Œ100%å‡†ç¡®åœ°åˆ¤æ–­ä¸€æ®µå­—èŠ‚ç æ˜¯å¦å¯ä»¥è¢«å®‰å…¨æ‰§è¡Œæ˜¯æ— æ³•å®ç°çš„ï¼Œå› æ­¤ï¼Œè¯¥è¿‡ç¨‹åªæ˜¯å°½å¯èƒ½åœ°æ£€æŸ¥å‡ºå¯ä»¥é¢„çŸ¥çš„æ˜æ˜¾çš„é—®é¢˜ã€‚å¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µæ— æ³•é€šè¿‡æ£€æŸ¥ï¼Œè™šæ‹Ÿæœºä¹Ÿä¸ä¼šæ­£ç¡®è£…è½½è¿™ä¸ªç±»ã€‚ä½†æ˜¯ï¼Œå¦‚æœé€šè¿‡äº†è¿™ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œä¹Ÿä¸èƒ½è¯´æ˜è¿™ä¸ªç±»æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<p>åœ¨å‰ä¸‰æ¬¡æ£€æŸ¥ä¸­æˆ‘ä»¬å·²ç»æ’é™¤äº†æ ¼å¼é”™è¯¯ï¼Œè¯­ä¹‰é”™è¯¯ï¼Œå­—èŠ‚ç é”™è¯¯ï¼Œä½†æ˜¯ä¾æ—§ä¸èƒ½ç™¾åˆ†æ¯”ç¡®å®šå…¶æ­£ç¡®ã€‚</p>
</li>
<li><p>ç¬¦å·å¼•ç”¨çš„éªŒè¯ï¼šæ ¡éªŒå™¨è¿˜å°†è¿›ç¬¦å·å¼•ç”¨çš„éªŒè¯ã€‚Classæ–‡ä»¶åœ¨å…¶å¸¸é‡æ± ä¼šé€šè¿‡å­—ç¬¦ä¸²è®°å½•è‡ªå·±å°†è¦ä½¿ç”¨çš„å…¶ä»–ç±»æˆ–è€…æ–¹æ³•ã€‚å› æ­¤ï¼Œåœ¨éªŒè¯é˜¶æ®µï¼Œè™šæ‹Ÿæœºå°±ä¼šæ£€æŸ¥è¿™äº›ç±»å’Œæ–¹æ³•æ˜¯å¦çœŸå®å­˜åœ¨ï¼Œå¹¶ä¸”å½“å‰ç±»æœ‰æƒé™è®¿é—®è¿™äº›æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªéœ€è¦ä½¿ç”¨ç±»æ— æ³•åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ°ï¼Œåˆ™ä¼šæŠ›å‡ºNoClassDefFoundErrorï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ— æ³•è¢«æ‰¾åˆ°ï¼Œåˆ™ä¼šæŠ›å‡ºNoSuchMethodErrorã€‚æ­¤é˜¶æ®µåœ¨è§£æç¯èŠ‚æ‰ä¼šæ‰§è¡Œã€‚ </p>
</li>
</ol>
<h4 id="3-2ï¼Œç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰"><a href="#3-2ï¼Œç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰" class="headerlink" title="3.2ï¼Œç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰"></a>3.2ï¼Œç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰</h4><p><img src="/2022/04/18/JVM/image-20220305165344870.png" alt="image-20220305165344870" loading="lazy"></p>
<p>å½“ä¸€ä¸ªç±»éªŒè¯é€šè¿‡æ—¶ï¼Œè™šæ‹Ÿæœºå°±ä¼šè¿›å…¥å‡†å¤‡é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºè¿™ä¸ªç±»åˆ†é…ç›¸åº”çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ã€‚Javaè™šæ‹Ÿæœºä¸ºå„ç±»å‹å˜é‡é»˜è®¤çš„åˆå§‹å€¼å¦‚è¡¨æ‰€ç¤ºã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220305165408798.png" alt="image-20220305165408798" loading="lazy"></p>
<p>Javaå¹¶ä¸æ”¯æŒbooleanç±»å‹ï¼Œå¯¹äºbooleanç±»å‹ï¼Œå†…éƒ¨å®ç°æ˜¯intï¼Œç”±äºintçš„é»˜è®¤å€¼æ˜¯0ï¼Œæ•…å¯¹åº”çš„ï¼Œbooleançš„é»˜è®¤å€¼å°±æ˜¯falseã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<ul>
<li><p>è¿™é‡Œä¸åŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µä½¿ç”¨<code>static final</code>ä¿®é¥°çš„æƒ…å†µï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±è¿›è¡Œåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µè¿›è¡Œæ˜¾ç¤ºèµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€èˆ¬æƒ…å†µï¼šstatic finalä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹å­—é¢é‡ä¼šåœ¨å‡†å¤‡é˜¶æ®µèµ‹å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line"><span class="comment">// ç‰¹æ®Šæƒ…å†µï¼šstatic finalä¿®é¥°çš„å¼•ç”¨ç±»å‹ä¸ä¼šåœ¨å‡†å¤‡é˜¶æ®µèµ‹å€¼ï¼Œè€Œæ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µèµ‹å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>æ³¨æ„è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚ </p>
</li>
<li><p>åœ¨è¿™ä¸ªé˜¶æ®µå¹¶ä¸ä¼šåƒåˆå§‹åŒ–é˜¶æ®µä¸­é‚£æ ·ä¼šæœ‰åˆå§‹åŒ–æˆ–è€…ä»£ç è¢«æ‰§è¡Œã€‚ </p>
</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¯´ä½¿ç”¨<code>static final</code>ä¿®é¥°çš„æ²¡æœ‰æ‰§è¡Œä»£ç çš„èµ‹å€¼åœ¨ç¼–è¯‘çš„æ—¶å€™å°±è¿›è¡Œåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µè¿›è¡Œæ˜¾ç¤ºèµ‹å€¼ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜å°±åœ¨äºï¼Œå½“æˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™ä¼šåœ¨å¯¹åº”çš„field_infoç»“æ„ä½“ä¸­å¢åŠ ä¸€ä¸ªConstantValueç±»å‹çš„ç»“æ„ä½“ï¼Œ<strong>åœ¨èµ‹å€¼çš„æ—¶å€™</strong>ä½¿ç”¨è¿™ä¸ªConstantValueè¿›è¡Œèµ‹å€¼ï¼›åœ¨å‡†å¤‡é˜¶æ®µçš„æ—¶å€™ï¼Œvalueå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstValueå±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚</p>
<h4 id="3-3ï¼Œç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰"><a href="#3-3ï¼Œç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰" class="headerlink" title="3.3ï¼Œç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰"></a>3.3ï¼Œç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰</h4><p>åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆåï¼Œå°±è¿›å…¥äº†è§£æé˜¶æ®µã€‚è§£æé˜¶æ®µï¼ˆResolutionï¼‰ï¼Œç®€è¨€ä¹‹ï¼Œå°†ç±»ã€æ¥å£ã€å­—æ®µå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<p><strong>å…·ä½“æè¿°</strong>ï¼š</p>
<p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€äº›å­—é¢é‡çš„å¼•ç”¨ï¼Œå’Œè™šæ‹Ÿæœºçš„å†…éƒ¨æ•°æ®ç»“æ„å’Œå’Œå†…å­˜å¸ƒå±€æ— å…³ã€‚æ¯”è¾ƒå®¹æ˜“ç†è§£çš„å°±æ˜¯åœ¨Classç±»æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å¸¸é‡æ± è¿›è¡Œäº†å¤§é‡çš„ç¬¦å·å¼•ç”¨ã€‚ä½†æ˜¯åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„ï¼Œæ¯”å¦‚å½“å¦‚ä¸‹println()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¯¥æ–¹æ³•çš„ä½ç½®ã€‚</p>
<p>æˆ‘ä»¬æ‹¿æ—…æ¸¸è¿›è¡Œç±»æ¯”ï¼Œç¬¦å·å¼•ç”¨å°±æ˜¯æŒ‡æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ°è¾¾æ—…æ¸¸åœ°æ˜¯åšçš„æ”»ç•¥ï¼Œç›´æ¥å¼•ç”¨å°±æ˜¯æˆ‘ä»¬åˆ°äº†æ—…æ¸¸åœ°è¿›è¡ŒçœŸæ­£çš„å®è¡Œã€‚</p>
<p><strong>ä¸¾ä¾‹</strong>ï¼š</p>
<p>è¾“å‡ºæ“ä½œSystem.out.println()å¯¹åº”çš„å­—èŠ‚ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">invokevirtual #24 &lt;java/io/PrintStream.println&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/image-20220305171456453.png" alt="image-20220305171456453" loading="lazy"></p>
<p>ä»¥æ–¹æ³•ä¸ºä¾‹ï¼ŒJavaè™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨ï¼Œå°†å…¶æ‰€æœ‰çš„æ–¹æ³•éƒ½åˆ—åœ¨è¡¨ä¸­ï¼Œå½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚é€šè¿‡è§£ææ“ä½œï¼Œç¬¦å·å¼•ç”¨å°±å¯ä»¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨ä¸­çš„ä½ç½®ï¼Œä»è€Œä½¿å¾—æ–¹æ³•è¢«æˆåŠŸè°ƒç”¨ã€‚</p>
<p><strong>å°ç»“</strong></p>
<ul>
<li>å¦‚æœç›´æ¥å¼•ç”¨å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‚¯å®šç³»ç»Ÿä¸­å­˜åœ¨è¯¥ç±»ï¼Œæ–¹æ³•æˆ–è€…å­—æ®µã€‚ä½†åªå­˜åœ¨ç¬¦å·å¼•ç”¨ï¼Œä¸èƒ½ç¡®å®šç³»ç»Ÿä¸€å®šå­˜åœ¨è¯¥ç»“æ„ã€‚</li>
<li>é“¾æ¥é˜¶æ®µä¸­çš„è§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œã€‚</li>
</ul>
<h3 id="4ï¼Œè¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ"><a href="#4ï¼Œè¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ" class="headerlink" title="4ï¼Œè¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ"></a>4ï¼Œè¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ</h3><ul>
<li>åˆå§‹åŒ–é˜¶æ®µï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹åŒ–å€¼ã€‚</li>
<li>åˆå§‹åŒ–æ˜¯ç±»è£…è½½çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°äº†<strong>åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaä»£ç ã€‚</strong></li>
<li>åˆå§‹åŒ–é˜¶æ®µæœ€é‡è¦çš„æ˜¯æ‰§è¡Œ<code>&lt;clinit&gt;</code>æ–¹æ³•ã€‚</li>
</ul>
<h4 id="4-1ï¼Œstaticä¸finalçš„æ­é…é—®é¢˜"><a href="#4-1ï¼Œstaticä¸finalçš„æ­é…é—®é¢˜" class="headerlink" title="4.1ï¼Œstaticä¸finalçš„æ­é…é—®é¢˜"></a>4.1ï¼Œstaticä¸finalçš„æ­é…é—®é¢˜</h4><p><strong>è¯´æ˜</strong>ï¼šä½¿ç”¨static+ finalä¿®é¥°çš„å­—æ®µçš„æ˜¾å¼èµ‹å€¼çš„æ“ä½œï¼Œåˆ°åº•æ˜¯åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œçš„èµ‹å€¼ï¼Ÿ</p>
<ul>
<li><p> æƒ…å†µ1ï¼šåœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼ </p>
</li>
<li><p> æƒ…å†µ2ï¼šåœ¨åˆå§‹åŒ–é˜¶æ®µ<clinit>()ä¸­èµ‹å€¼ </clinit></p>
</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼š åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼çš„æƒ…å†µï¼š</p>
<ul>
<li><p> å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µæ¥è¯´ï¼Œå¦‚æœä½¿ç”¨static finalä¿®é¥°ï¼Œåˆ™æ˜¾å¼èµ‹å€¼(ç›´æ¥èµ‹å€¼å¸¸é‡ï¼Œè€Œéè°ƒç”¨æ–¹æ³•é€šå¸¸æ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œ </p>
</li>
<li><p> å¯¹äºStringæ¥è¯´ï¼Œå¦‚æœä½¿ç”¨å­—é¢é‡çš„æ–¹å¼èµ‹å€¼ï¼Œä½¿ç”¨static finalä¿®é¥°çš„è¯ï¼Œåˆ™æ˜¾å¼èµ‹å€¼é€šå¸¸æ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œ </p>
</li>
<li><p> åœ¨åˆå§‹åŒ–é˜¶æ®µ<clinit>()ä¸­èµ‹å€¼çš„æƒ…å†µï¼š æ’é™¤ä¸Šè¿°çš„åœ¨å‡†å¤‡ç¯èŠ‚èµ‹å€¼çš„æƒ…å†µä¹‹å¤–çš„æƒ…å†µã€‚ </clinit></p>
</li>
</ul>
<p><strong>æœ€ç»ˆç»“è®º</strong>ï¼šä½¿ç”¨static+finalä¿®é¥°ï¼Œä¸”æ˜¾ç¤ºèµ‹å€¼ä¸­ä¸æ¶‰åŠåˆ°æ–¹æ³•æˆ–æ„é€ å™¨è°ƒç”¨çš„åŸºæœ¬æ•°æ®ç±»åˆ°æˆ–Stringç±»å‹çš„æ˜¾å¼è´¢å€¼ï¼Œæ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œã€‚ï¼ˆæ›´ç®€å•çš„è¡¨è¾¾å°±æ˜¯å¦‚æœèµ‹å€¼çš„æ—¶å€™éœ€è¦æ‰§è¡Œä»£ç å°±åœ¨åˆå§‹åŒ–é˜¶æ®µèµ‹å€¼ï¼Œåä¹‹å°±åœ¨é“¾æ¥çš„å‡†å¤‡é˜¶æ®µèµ‹å€¼ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-14 18:55</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼šä½¿ç”¨static + finalä¿®é¥°çš„å­—æ®µçš„æ˜¾å¼èµ‹å€¼çš„æ“ä½œï¼Œåˆ°åº•æ˜¯åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œçš„èµ‹å€¼ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * æƒ…å†µ1ï¼šåœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼</span></span><br><span class="line"><span class="comment"> * æƒ…å†µ2ï¼šåœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç»“è®ºï¼š</span></span><br><span class="line"><span class="comment"> * åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼çš„æƒ…å†µï¼š</span></span><br><span class="line"><span class="comment"> * 1. å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µæ¥è¯´ï¼Œå¦‚æœä½¿ç”¨static finalä¿®é¥°ï¼Œåˆ™æ˜¾å¼èµ‹å€¼(ç›´æ¥èµ‹å€¼å¸¸é‡ï¼Œè€Œéè°ƒç”¨æ–¹æ³•ï¼‰é€šå¸¸æ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œ</span></span><br><span class="line"><span class="comment"> * 2. å¯¹äºStringæ¥è¯´ï¼Œå¦‚æœä½¿ç”¨å­—é¢é‡çš„æ–¹å¼èµ‹å€¼ï¼Œä½¿ç”¨static finalä¿®é¥°çš„è¯ï¼Œåˆ™æ˜¾å¼èµ‹å€¼é€šå¸¸æ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼çš„æƒ…å†µï¼š</span></span><br><span class="line"><span class="comment"> * æ’é™¤ä¸Šè¿°çš„åœ¨å‡†å¤‡ç¯èŠ‚èµ‹å€¼çš„æƒ…å†µä¹‹å¤–çš„æƒ…å†µã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æœ€ç»ˆç»“è®ºï¼šä½¿ç”¨static + finalä¿®é¥°ï¼Œä¸”æ˜¾ç¤ºèµ‹å€¼ä¸­ä¸æ¶‰åŠåˆ°æ–¹æ³•æˆ–æ„é€ å™¨è°ƒç”¨çš„åŸºæœ¬æ•°æ®ç±»å‹æˆ–Stringç±»å‹çš„æ˜¾å¼èµ‹å€¼ï¼Œæ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚è¿›è¡Œã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitializationTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;<span class="comment">//åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INT_CONSTANT</span> <span class="operator">=</span> <span class="number">10</span>;<span class="comment">//åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">INTEGER_CONSTANT1</span> <span class="operator">=</span> Integer.valueOf(<span class="number">100</span>);<span class="comment">//åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">INTEGER_CONSTANT2</span> <span class="operator">=</span> Integer.valueOf(<span class="number">1000</span>);<span class="comment">//åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="type">INTEGER_CONS</span> <span class="variable">T3</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s0</span> <span class="operator">=</span> <span class="string">&quot;helloworld0&quot;</span>;<span class="comment">//åœ¨é“¾æ¥é˜¶æ®µçš„å‡†å¤‡ç¯èŠ‚èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;helloworld1&quot;</span>);<span class="comment">//åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;helloworld2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NUM1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>);<span class="comment">//åœ¨åˆå§‹åŒ–é˜¶æ®µ&lt;clinit&gt;()ä¸­èµ‹å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2ï¼Œ-çš„çº¿ç¨‹å®‰å…¨æ€§"><a href="#4-2ï¼Œ-çš„çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="4.2ï¼Œ()çš„çº¿ç¨‹å®‰å…¨æ€§"></a>4.2ï¼Œ<clinit>()çš„çº¿ç¨‹å®‰å…¨æ€§</clinit></h4><p>å¯¹äº<clinit>()æ–¹æ³•çš„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ç±»çš„åˆå§‹åŒ–ï¼Œè™šæ‹Ÿæœºä¼šåœ¨å†…éƒ¨ç¡®ä¿å…¶å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚</clinit></p>
<p>è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„<clinit>()æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”ã€åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„<clinit>()æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ<clinit>()æ–¹æ³•å®Œæ¯•ã€‚</clinit></clinit></clinit></p>
<p>æ­£æ˜¯å› ä¸ºå‡½æ•°<clinit>å¸¦é”çº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç±»çš„<clinit>()æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œå¼•å‘æ­»é”ã€‚å¹¶ä¸”è¿™ç§æ­»é”æ˜¯å¾ˆéš¾å‘ç°çš„ï¼Œå› ä¸ºçœ‹èµ·æ¥å®ƒä»¬å¹¶æ²¡æœ‰å¯ç”¨çš„é”ä¿¡æ¯ã€‚</clinit></clinit></p>
<p>å¦‚æœä¹‹å‰çš„çº¿ç¨‹æˆåŠŸåŠ è½½äº†ç±»ï¼Œåˆ™ç­‰åœ¨é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å°±æ²¡æœ‰æœºä¼šå†æ‰§è¡Œ<clinit>()æ–¹æ³•äº†ã€‚é‚£ä¹ˆï¼Œå½“éœ€è¦ä½¿ç”¨è¿™ä¸ªç±»æ—¶ï¼Œè™šæ‹Ÿæœºä¼šç›´æ¥è¿”å›ç»™å®ƒå·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ã€‚</clinit></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-13 12:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StaticA</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.atguigu.java1.StaticB&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;StaticA init OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StaticB</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.atguigu.java1.StaticA&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;StaticB init OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticDeadLockMain</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StaticDeadLockMain</span><span class="params">(<span class="type">char</span> flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">        <span class="built_in">this</span>.setName(<span class="string">&quot;Thread&quot;</span> + flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.atguigu.java1.Static&quot;</span> + flag);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; over&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">StaticDeadLockMain</span> <span class="variable">loadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticDeadLockMain</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">        loadA.start();</span><br><span class="line">        <span class="type">StaticDeadLockMain</span> <span class="variable">loadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticDeadLockMain</span>(<span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">        loadB.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-3ï¼Œç±»çš„åˆå§‹åŒ–æƒ…å†µï¼šä¸»åŠ¨ä½¿ç”¨vsè¢«åŠ¨ä½¿ç”¨"><a href="#4-3ï¼Œç±»çš„åˆå§‹åŒ–æƒ…å†µï¼šä¸»åŠ¨ä½¿ç”¨vsè¢«åŠ¨ä½¿ç”¨" class="headerlink" title="4.3ï¼Œç±»çš„åˆå§‹åŒ–æƒ…å†µï¼šä¸»åŠ¨ä½¿ç”¨vsè¢«åŠ¨ä½¿ç”¨"></a>4.3ï¼Œç±»çš„åˆå§‹åŒ–æƒ…å†µï¼šä¸»åŠ¨ä½¿ç”¨vsè¢«åŠ¨ä½¿ç”¨</h4><p>Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨åˆ†ä¸ºä¸¤ç§ï¼šä¸»åŠ¨ä½¿ç”¨å’Œè¢«åŠ¨ä½¿ç”¨ã€‚</p>
<p><strong>ä¸»åŠ¨ä½¿ç”¨</strong></p>
<p>Classåªæœ‰åœ¨å¿…é¡»è¦é¦–æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè¢«è£…è½½ï¼ŒJavaè™šæ‹Ÿæœºä¸ä¼šæ— æ¡ä»¶åœ°è£…è½½Classç±»å‹ã€‚Javaè™šæ‹Ÿæœºè§„å®šï¼Œä¸€ä¸ªç±»æˆ–æ¥å£åœ¨åˆæ¬¡ä½¿ç”¨å‰ï¼Œå¿…é¡»è¦è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™é‡ŒæŒ‡çš„â€œä½¿ç”¨â€ï¼Œæ˜¯æŒ‡ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸»åŠ¨ä½¿ç”¨åªæœ‰ä¸‹åˆ—å‡ ç§æƒ…å†µï¼šï¼ˆå³ï¼šå¦‚æœå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼Œåˆ™ä¼šå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚è€Œåˆå§‹åŒ–æ“ä½œä¹‹å‰çš„åŠ è½½ã€éªŒè¯ã€å‡†å¤‡å·²ç»å®Œæˆã€‚</p>
<ol>
<li><p>å®ä¾‹åŒ–ï¼šå½“åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨newå…³é”®å­—ï¼Œæˆ–è€…é€šè¿‡åå°„ã€å…‹éš†ã€ååºåˆ—åŒ–ã€‚ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-14 16:37</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼šæ„å‘³ç€ä¼šè°ƒç”¨ç±»çš„&lt;clinit&gt;()ï¼Œå³æ‰§è¡Œäº†ç±»çš„åˆå§‹åŒ–é˜¶æ®µ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. å½“åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨newå…³é”®å­—ï¼Œæˆ–è€…é€šè¿‡åå°„ã€å…‹éš†ã€ååºåˆ—åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> * 2. å½“è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ï¼Œå³å½“ä½¿ç”¨äº†å­—èŠ‚ç invokestaticæŒ‡ä»¤ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActiveUse1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼š</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å†…éƒ¨åŠ å…¥æ–‡ä»¶è¾“å‡ºæµ</span></span><br><span class="line">            oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;order.dat&quot;</span>));</span><br><span class="line">            <span class="comment">//ç„¶åå°†è¾“å‡ºæµå†™å‡ºè¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">            oos.writeObject(<span class="keyword">new</span> <span class="title class_">Order</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (oos != <span class="literal">null</span>)</span><br><span class="line">                    oos.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼šï¼ˆéªŒè¯ï¼‰</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;order.dat&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> (Order) ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (ois != <span class="literal">null</span>)</span><br><span class="line">                    ois.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        Order.method();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Orderç±»çš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Order method()....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>é™æ€æ–¹æ³•ï¼šå½“è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ï¼Œå³å½“ä½¿ç”¨äº†å­—èŠ‚ç invokestaticæŒ‡ä»¤ã€‚ </p>
</li>
<li><p>é™æ€å­—æ®µï¼šå½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆfinalä¿®é¥°ç‰¹æ®Šè€ƒè™‘ï¼‰ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨getstaticæˆ–è€…putstaticæŒ‡ä»¤ã€‚ï¼ˆå¯¹åº”è®¿é—®å˜é‡ã€èµ‹å€¼å˜é‡æ“ä½œï¼‰  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-14 16:49</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3. å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶(finalä¿®é¥°ç‰¹æ®Šè€ƒè™‘)ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨getstaticæˆ–è€…putstaticæŒ‡ä»¤ã€‚ï¼ˆå¯¹åº”è®¿é—®å˜é‡ã€èµ‹å€¼å˜é‡æ“ä½œï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActiveUse2</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(User.num);</span></span><br><span class="line">        System.out.println(User.num1);</span><br><span class="line">        <span class="comment">//System.out.println(User.num2);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(CompareA.NUM1);</span></span><br><span class="line">        System.out.println(CompareA.NUM2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Userç±»çš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CompareA</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CompareAçš„åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NUM1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NUM2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>åå°„ï¼šå½“ä½¿ç”¨java.lang.reflectåŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ã€‚æ¯”å¦‚ï¼šClass.forName(â€œcom.atguigu.java.Testâ€) </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.atguigu.java1.Order&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ç»§æ‰¿ï¼šå½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</p>
<p>å½“Javaè™šæ‹Ÿæœºåˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œè¦æ±‚å®ƒçš„æ‰€æœ‰çˆ¶ç±»éƒ½å·²ç»è¢«åˆå§‹åŒ–ï¼Œä½†æ˜¯è¿™æ¡è§„åˆ™å¹¶ä¸é€‚ç”¨äºæ¥å£ã€‚</p>
<ul>
<li><p>åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒæ‰€å®ç°çš„æ¥å£</p>
</li>
<li><p>åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£</p>
</li>
<li><p>å› æ­¤ï¼Œä¸€ä¸ªçˆ¶æ¥å£å¹¶ä¸ä¼šå› ä¸ºå®ƒçš„å­æ¥å£æˆ–è€…å®ç°ç±»çš„åˆå§‹åŒ–è€Œåˆå§‹åŒ–ã€‚åªæœ‰å½“ç¨‹åºé¦–æ¬¡ä½¿ç”¨ç‰¹å®šæ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´è¯¥æ¥å£çš„åˆå§‹åŒ–ã€‚</p>
</li>
</ul>
</li>
<li><p>defaultæ–¹æ³•ï¼šå¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº†defaultæ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥å®ç°æˆ–è€…é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œè¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</p>
</li>
<li><p>mainæ–¹æ³•ï¼šå½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚  </p>
<p>JVMå¯åŠ¨çš„æ—¶å€™é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ä¸€ä¸ªåˆå§‹ç±»ã€‚è¿™ä¸ªç±»åœ¨è°ƒç”¨public static void main(String[])æ–¹æ³•ä¹‹å‰è¢«é“¾æ¥å’Œåˆå§‹åŒ–ã€‚è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œå°†ä¾æ¬¡å¯¼è‡´æ‰€éœ€çš„ç±»çš„åŠ è½½ï¼Œé“¾æ¥å’Œåˆå§‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-14 17:00</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 4. å½“ä½¿ç”¨java.lang.reflectåŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ã€‚æ¯”å¦‚ï¼šClass.forName(&quot;com.atguigu.java.Test&quot;)</span></span><br><span class="line"><span class="comment"> * 5. å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> * 6. å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº†defaultæ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥å®ç°æˆ–è€…é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œè¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> * 7. å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚</span></span><br><span class="line"><span class="comment"> * 8. å½“åˆæ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</span></span><br><span class="line"><span class="comment"> * ï¼ˆæ¶‰åŠè§£æREF_getStaticã€REF_putStaticã€REF_invokeStaticæ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»ï¼‰</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * é’ˆå¯¹5ï¼Œè¡¥å……è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * å½“Javaè™šæ‹Ÿæœºåˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œè¦æ±‚å®ƒçš„æ‰€æœ‰çˆ¶ç±»éƒ½å·²ç»è¢«åˆå§‹åŒ–ï¼Œä½†æ˜¯è¿™æ¡è§„åˆ™å¹¶ä¸é€‚ç”¨äºæ¥å£ã€‚</span></span><br><span class="line"><span class="comment"> * &gt;åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒæ‰€å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="comment"> * &gt;åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£</span></span><br><span class="line"><span class="comment"> * å› æ­¤ï¼Œä¸€ä¸ªçˆ¶æ¥å£å¹¶ä¸ä¼šå› ä¸ºå®ƒçš„å­æ¥å£æˆ–è€…å®ç°ç±»çš„åˆå§‹åŒ–è€Œåˆå§‹åŒ–ã€‚åªæœ‰å½“ç¨‹åºé¦–æ¬¡ä½¿ç”¨ç‰¹å®šæ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ‰ä¼šå¯¼è‡´è¯¥æ¥å£çš„åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActiveUse3</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ActiveUse3çš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.atguigu.java1.Order&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Son.num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(CompareC.NUM1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Son.num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Fatherç±»çš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span> <span class="keyword">implements</span> <span class="title class_">CompareB</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sonç±»çš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CompareB</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CompareBçš„åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½ å¥½ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CompareC</span> <span class="keyword">extends</span> <span class="title class_">CompareB</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CompareCçš„åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NUM1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>MethodHandleï¼šå½“åˆæ¬¡è°ƒç”¨MethodHandleå®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥MethodHandleæŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚ï¼ˆæ¶‰åŠè§£æREF getStaticã€REF_putStaticã€REF invokeStaticæ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»ï¼‰ </p>
</li>
</ol>
<p><strong>è¢«åŠ¨ä½¿ç”¨</strong></p>
<p>é™¤äº†ä»¥ä¸Šçš„æƒ…å†µå±äºä¸»åŠ¨ä½¿ç”¨ï¼Œå…¶ä»–çš„æƒ…å†µå‡å±äºè¢«åŠ¨ä½¿ç”¨ã€‚è¢«åŠ¨ä½¿ç”¨ä¸ä¼šè°ƒç”¨åˆå§‹åŒ–ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼šå¹¶ä¸æ˜¯åœ¨ä»£ç ä¸­å‡ºç°çš„ç±»ï¼Œå°±ä¸€å®šä¼šè¢«åŠ è½½æˆ–è€…åˆå§‹åŒ–å¦‚æœä¸ç¬¦åˆä¸»åŠ¨ä½¿ç”¨çš„æ¡ä»¶ï¼Œç±»å°±ä¸ä¼šåˆå§‹åŒ–ã€‚</p>
<ol>
<li><p>é™æ€å­—æ®µï¼šå½“é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚</p>
</li>
<li><p>æ•°ç»„å®šä¹‰ï¼šé€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-09-14 17:24</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å…³äºç±»çš„è¢«åŠ¨ä½¿ç”¨ï¼Œå³ä¸ä¼šè¿›è¡Œç±»çš„åˆå§‹åŒ–æ“ä½œï¼Œå³ä¸ä¼šè°ƒç”¨&lt;clinit&gt;()</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment"> *     &gt; å½“é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * 2. é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼šæ²¡æœ‰åˆå§‹åŒ–çš„ç±»ï¼Œä¸æ„å‘³ç€æ²¡æœ‰åŠ è½½ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PassiveUse1</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Child.num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        Parent[] parents = <span class="keyword">new</span> <span class="title class_">Parent</span>[<span class="number">10</span>];</span><br><span class="line">        System.out.println(parents.getClass());</span><br><span class="line">        System.out.println(parents.getClass().getSuperclass());</span><br><span class="line"></span><br><span class="line">        parents[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line">        parents[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Parentçš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_">Parent</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Childçš„åˆå§‹åŒ–è¿‡ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>å¼•ç”¨å¸¸é‡ï¼šå¼•ç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨é“¾æ¥é˜¶æ®µå°±å·²ç»è¢«æ˜¾å¼èµ‹å€¼äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PassiveUse</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Serival.num);</span><br><span class="line">        <span class="comment">// ä½†å¼•ç”¨å…¶ä»–ç±»çš„è¯è¿˜æ˜¯ä¼šåˆå§‹åŒ–</span></span><br><span class="line">        System.out.println(Serival.num2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Serival</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Serivalåˆå§‹åŒ–&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>loadClassæ–¹æ³•ï¼šè°ƒç”¨ClassLoaderç±»çš„loadClass()æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader().loadClass(<span class="string">&quot;com.test.java.Person&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ‰©å±•</p>
<p>-XX:+TraceClassLoadingï¼šè¿½è¸ªæ‰“å°ç±»çš„åŠ è½½ä¿¡æ¯</p>
<h3 id="5ï¼Œè¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰"><a href="#5ï¼Œè¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰" class="headerlink" title="5ï¼Œè¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰"></a>5ï¼Œè¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰</h3><p>ä»»ä½•ä¸€ä¸ªç±»å‹åœ¨ä½¿ç”¨ä¹‹å‰éƒ½å¿…é¡»ç»å†è¿‡å®Œæ•´çš„åŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–3ä¸ªç±»åŠ è½½æ­¥éª¤ã€‚ä¸€æ—¦ä¸€ä¸ªç±»å‹æˆåŠŸç»å†è¿‡è¿™3ä¸ªæ­¥éª¤ä¹‹åï¼Œä¾¿â€œå‰äº‹ä¿±å¤‡åªæ¬ ä¸œé£â€ï¼Œå°±ç­‰ç€å¼€å‘è€…ä½¿ç”¨äº†ã€‚</p>
<p>å¼€å‘äººå‘˜å¯ä»¥åœ¨ç¨‹åºä¸­è®¿é—®å’Œè°ƒç”¨å®ƒçš„é™æ€ç±»æˆå‘˜ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šé™æ€å­—æ®µã€é™æ€æ–¹æ³•ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨newå…³é”®å­—ä¸ºå…¶åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚</p>
<h3 id="6ï¼Œè¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰"><a href="#6ï¼Œè¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰" class="headerlink" title="6ï¼Œè¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰"></a>6ï¼Œè¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰</h3><h4 id="6-1ï¼Œç±»ã€ç±»çš„åŠ è½½å™¨ã€ç±»çš„å®ä¾‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»"><a href="#6-1ï¼Œç±»ã€ç±»çš„åŠ è½½å™¨ã€ç±»çš„å®ä¾‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»" class="headerlink" title="6.1ï¼Œç±»ã€ç±»çš„åŠ è½½å™¨ã€ç±»çš„å®ä¾‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»"></a>6.1ï¼Œç±»ã€ç±»çš„åŠ è½½å™¨ã€ç±»çš„å®ä¾‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»</h4><p>åœ¨ç±»åŠ è½½å™¨çš„å†…éƒ¨å®ç°ä¸­ï¼Œç”¨ä¸€ä¸ªJavaé›†åˆæ¥å­˜æ”¾æ‰€åŠ è½½ç±»çš„å¼•ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ªClasså¯¹è±¡æ€»æ˜¯ä¼šå¼•ç”¨å®ƒçš„ç±»åŠ è½½å™¨ï¼Œè°ƒç”¨Classå¯¹è±¡çš„getClassLoader()æ–¹æ³•ï¼Œå°±èƒ½è·å¾—å®ƒçš„ç±»åŠ è½½å™¨ã€‚ç”±æ­¤å¯è§ï¼Œä»£è¡¨æŸä¸ªç±»çš„Classå®ä¾‹ä¸å…¶ç±»çš„åŠ è½½å™¨ä¹‹é—´ä¸ºåŒå‘å…³è”å…³ç³»ã€‚</p>
<p>ä¸€ä¸ªç±»çš„å®ä¾‹æ€»æ˜¯å¼•ç”¨ä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ã€‚åœ¨Objectç±»ä¸­å®šä¹‰äº†getClass()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä»£è¡¨å¯¹è±¡æ‰€å±ç±»çš„Classå¯¹è±¡çš„å¼•ç”¨ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰çš„javaç±»éƒ½æœ‰ä¸€ä¸ªé™æ€å±æ€§classï¼Œå®ƒå¼•ç”¨ä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ã€‚</p>
<h4 id="6-2ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#6-2ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="6.2ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>6.2ï¼Œç±»çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>å½“Sampleç±»è¢«åŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–åï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±å¼€å§‹äº†ã€‚å½“ä»£è¡¨Sampleç±»çš„Classå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå³ä¸å¯è§¦åŠæ—¶ï¼ŒClasså¯¹è±¡å°±ä¼šç»“æŸç”Ÿå‘½å‘¨æœŸï¼ŒSampleç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ä¹Ÿä¼šè¢«å¸è½½ï¼Œä»è€Œç»“æŸSampleç±»çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>ä¸€ä¸ªä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºä»£è¡¨ä»–çš„Classå¯¹è±¡ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚</p>
<h4 id="6-3ï¼Œå…·ä½“ä¾‹å­"><a href="#6-3ï¼Œå…·ä½“ä¾‹å­" class="headerlink" title="6.3ï¼Œå…·ä½“ä¾‹å­"></a>6.3ï¼Œå…·ä½“ä¾‹å­</h4><p><img src="/2022/04/18/JVM/image-20220305220610873.png" alt="image-20220305220610873" loading="lazy"></p>
<p>loader1å˜é‡å’Œobjå˜é‡é—´æ¥åº”ç”¨ä»£è¡¨Sampleç±»çš„Classå¯¹è±¡ï¼Œè€ŒobjClasså˜é‡åˆ™ç›´æ¥å¼•ç”¨å®ƒã€‚</p>
<p>å¦‚æœç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†ä¸Šå›¾å·¦ä¾§ä¸‰ä¸ªå¼•ç”¨å˜é‡éƒ½ç½®ä¸ºnullï¼Œæ­¤æ—¶Sampleå¯¹è±¡ç»“æŸç”Ÿå‘½å‘¨æœŸï¼ŒMyClassLoaderå¯¹è±¡ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œä»£è¡¨Sampleç±»çš„Classå¯¹è±¡ä¹Ÿç»“æŸç”Ÿå‘½å‘¨æœŸï¼ŒSampleç±»åœ¨æ–¹æ³•åŒºå†…çš„äºŒè¿›åˆ¶æ•°æ®è¢«å¸è½½ã€‚ </p>
<p>å½“å†æ¬¡æœ‰éœ€è¦æ—¶ï¼Œä¼šæ£€æŸ¥Sampleç±»çš„Classå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ä¼šç›´æ¥ä½¿ç”¨ï¼Œä¸å†é‡æ–°åŠ è½½ï¼›å¦‚æœä¸å­˜åœ¨Sampleç±»ä¼šè¢«é‡æ–°åŠ è½½ï¼Œåœ¨Javaè™šæ‹Ÿæœºçš„å †åŒºä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä»£è¡¨Sampleç±»çš„Classå®ä¾‹ï¼ˆå¯ä»¥é€šè¿‡å“ˆå¸Œç æŸ¥çœ‹æ˜¯å¦æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰</p>
<h4 id="6-4ï¼Œç±»çš„å¸è½½"><a href="#6-4ï¼Œç±»çš„å¸è½½" class="headerlink" title="6.4ï¼Œç±»çš„å¸è½½"></a>6.4ï¼Œç±»çš„å¸è½½</h4><p>ï¼ˆ1ï¼‰å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆjvmå’Œjlsè§„èŒƒï¼‰</p>
<p>ï¼ˆ2ï¼‰è¢«ç³»ç»Ÿç±»åŠ è½½å™¨å’Œæ‰©å±•ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–è€…æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šåœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ€»èƒ½ç›´æ¥æˆ–è€…é—´æ¥çš„è®¿é—®çš„åˆ°ï¼Œå…¶è¾¾åˆ°unreachableçš„å¯èƒ½æ€§æå°ã€‚</p>
<p>ï¼ˆ3ï¼‰è¢«å¼€å‘è€…è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å®ä¾‹åŠ è½½çš„ç±»å‹åªæœ‰åœ¨å¾ˆç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè€Œä¸”ä¸€èˆ¬è¿˜è¦å€ŸåŠ©äºå¼ºåˆ¶è°ƒç”¨è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†åŠŸèƒ½æ‰å¯ä»¥åšåˆ°ã€‚å¯ä»¥é¢„æƒ³ï¼Œç¨å¾®å¤æ‚ç‚¹çš„åº”ç”¨åœºæ™¯ä¸­ï¼ˆæ¯”å¦‚ï¼šå¾ˆå¤šæ—¶å€™ç”¨æˆ·åœ¨å¼€å‘è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ä¾‹çš„æ—¶å€™é‡‡ç”¨ç¼“å­˜çš„ç­–ç•¥ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ï¼‰ï¼Œè¢«åŠ è½½çš„ç±»å‹åœ¨è¿è¡ŒæœŸé—´ä¹Ÿæ˜¯å‡ ä¹ä¸å¤ªå¯èƒ½è¢«å¸è½½çš„ï¼ˆè‡³å°‘å¸è½½çš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼‰ã€‚</p>
<p>ç»¼åˆä»¥ä¸Šä¸‰ç‚¹ï¼Œä¸€ä¸ªå·²ç»åŠ è½½çš„ç±»å‹è¢«å¸è½½çš„å‡ ç‡å¾ˆå°è‡³å°‘è¢«å¸è½½çš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œå¼€å‘è€…åœ¨å¼€å‘ä»£ç æ—¶å€™ï¼Œä¸åº”è¯¥å¯¹è™šæ‹Ÿæœºçš„ç±»å‹å¸è½½åšä»»ä½•å‡è®¾çš„å‰æä¸‹ï¼Œæ¥å®ç°ç³»ç»Ÿä¸­çš„ç‰¹å®šåŠŸèƒ½ã€‚</p>
<h3 id="å›é¡¾ï¼šæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶"><a href="#å›é¡¾ï¼šæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶" class="headerlink" title="å›é¡¾ï¼šæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶"></a>å›é¡¾ï¼šæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</h3><p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹ã€‚</p>
<p>HotSpotè™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</p>
<p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦â€œåºŸå¼ƒâ€è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äºâ€œä¸å†ä½¿ç”¨çš„ç±»â€çš„æ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶å¦‚ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚</li>
<li>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨éƒ½å·²ç»è¢«å›æ”¶ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯è¿›è¡Œè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚OSGiï¼ŒJSPçš„é‡åŠ è½½å¦åˆ™é€šå¸¸å¾ˆéš¾å®ç°ã€‚</li>
<li>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li>
</ul>
<h2 id="å››ï¼Œå†è°ˆç±»çš„åŠ è½½å™¨"><a href="#å››ï¼Œå†è°ˆç±»çš„åŠ è½½å™¨" class="headerlink" title="å››ï¼Œå†è°ˆç±»çš„åŠ è½½å™¨"></a>å››ï¼Œå†è°ˆç±»çš„åŠ è½½å™¨</h2><h3 id="1ï¼Œæ¦‚è¿°-2"><a href="#1ï¼Œæ¦‚è¿°-2" class="headerlink" title="1ï¼Œæ¦‚è¿°"></a>1ï¼Œæ¦‚è¿°</h3><p>ç±»åŠ è½½å™¨æ˜¯JVMæ‰§è¡Œç±»åŠ è½½æœºåˆ¶çš„å‰æã€‚</p>
<p><strong>ClassLoaderçš„ä½œç”¨ï¼š</strong></p>
<p>ClassLoaderæ˜¯Javaçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰€æœ‰çš„Classéƒ½æ˜¯ç”±ClassLoaderè¿›è¡ŒåŠ è½½çš„ï¼Œ<strong>ClassLoaderè´Ÿè´£é€šè¿‡å„ç§æ–¹å¼å°†Classä¿¡æ¯çš„äºŒè¿›åˆ¶æ•°æ®æµè¯»å…¥JVMå†…éƒ¨ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªä¸ç›®æ ‡ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡å®ä¾‹ã€‚ç„¶åäº¤ç»™Javaè™šæ‹Ÿæœºè¿›è¡Œé“¾æ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œã€‚</strong>å› æ­¤ï¼ŒClassLoaderåœ¨æ•´ä¸ªè£…è½½é˜¶æ®µï¼Œåªèƒ½å½±å“åˆ°ç±»çš„åŠ è½½ï¼Œè€Œæ— æ³•é€šè¿‡ClassLoaderå»æ”¹å˜ç±»çš„é“¾æ¥å’Œåˆå§‹åŒ–è¡Œä¸ºã€‚è‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220306180351305.png" alt="image-20220306180351305" loading="lazy"></p>
<p><strong>å¤§å‚é¢è¯•é¢˜</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">èš‚èšé‡‘æœï¼š</span><br><span class="line"> </span><br><span class="line">æ·±å…¥åˆ†æClassLoaderï¼ŒåŒäº²å§”æ´¾æœºåˆ¶</span><br><span class="line"> </span><br><span class="line">ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿä¸€é¢ï¼šåŒäº²å§”æ´¾æœºåˆ¶åŠä½¿ç”¨åŸå› </span><br><span class="line"> </span><br><span class="line">ç™¾åº¦ï¼š</span><br><span class="line"> </span><br><span class="line">éƒ½æœ‰å“ªäº›ç±»åŠ è½½å™¨ï¼Œè¿™äº›ç±»åŠ è½½å™¨éƒ½åŠ è½½å“ªäº›æ–‡ä»¶ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">æ‰‹å†™ä¸€ä¸ªç±»åŠ è½½å™¨Demo</span><br><span class="line"> </span><br><span class="line">Classçš„forNameï¼ˆâ€œjava.lang.Stringâ€ï¼‰å’ŒClassçš„getClassLoaderï¼ˆï¼‰çš„Loadclassï¼ˆâ€œjava.lang.Stringâ€ï¼‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">è…¾è®¯ï¼š</span><br><span class="line"> </span><br><span class="line">ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">å°ç±³ï¼š</span><br><span class="line"> </span><br><span class="line">åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»ä¸€ä¸‹</span><br><span class="line"> </span><br><span class="line">æ»´æ»´ï¼š</span><br><span class="line"> </span><br><span class="line">ç®€å•è¯´è¯´ä½ äº†è§£çš„ç±»åŠ è½½å™¨ä¸€é¢ï¼šè®²ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä»¥åŠå…¶ä¼˜ç‚¹</span><br><span class="line"> </span><br><span class="line">å­—èŠ‚è·³åŠ¨ï¼š</span><br><span class="line"> </span><br><span class="line">ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">äº¬ä¸œï¼š</span><br><span class="line"> </span><br><span class="line">ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"> </span><br><span class="line">åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥æ‰“ç ´å—ï¼Ÿä¸ºä»€ä¹ˆ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»"><a href="#1-1ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»" class="headerlink" title="1.1ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»"></a>1.1ï¼Œç±»åŠ è½½å™¨çš„åˆ†ç±»</h4><p>ç±»çš„åŠ è½½åˆ†ç±»ï¼šæ˜¾å¼åŠ è½½ vs éšå¼åŠ è½½</p>
<p>classæ–‡ä»¶çš„æ˜¾å¼åŠ è½½ä¸éšå¼åŠ è½½çš„æ–¹å¼æ˜¯æŒ‡JVMåŠ è½½classæ–‡ä»¶åˆ°å†…å­˜çš„æ–¹å¼ã€‚</p>
<ul>
<li><p>æ˜¾å¼åŠ è½½æŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­é€šè¿‡è°ƒç”¨ClassLoaderåŠ è½½classå¯¹è±¡ï¼Œå¦‚ç›´æ¥ä½¿ç”¨Class.forName(name)æˆ–this.getClass().getClassLoader().loadClass()åŠ è½½classå¯¹è±¡ã€‚</p>
</li>
<li><p>éšå¼åŠ è½½åˆ™æ˜¯ä¸ç›´æ¥åœ¨ä»£ç ä¸­è°ƒç”¨ClassLoaderçš„æ–¹æ³•åŠ è½½classå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡è™šæ‹Ÿæœºè‡ªåŠ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚åœ¨åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼Œè¯¥ç±»çš„classæ–‡ä»¶ä¸­å¼•ç”¨äº†å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œæ­¤æ—¶é¢å¤–å¼•ç”¨çš„ç±»å°†é€šè¿‡JVMè‡ªåŠ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
</li>
</ul>
<p>åœ¨æ—¥å¸¸å¼€å‘ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸€èˆ¬ä¼šæ··åˆä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éšå¼åŠ è½½</span></span><br><span class="line">User user=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="comment">//æ˜¾å¼åŠ è½½ï¼Œå¹¶åˆå§‹åŒ–</span></span><br><span class="line">Class clazz=Class.forName(<span class="string">&quot;com.test.java.User&quot;</span>);</span><br><span class="line"><span class="comment">//æ˜¾å¼åŠ è½½ï¼Œä½†ä¸åˆå§‹åŒ–</span></span><br><span class="line">ClassLoader.getSystemClassLoader().loadClass(<span class="string">&quot;com.test.java.Parent&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2ï¼Œç±»åŠ è½½å™¨çš„å¿…è¦æ€§"><a href="#1-2ï¼Œç±»åŠ è½½å™¨çš„å¿…è¦æ€§" class="headerlink" title="1.2ï¼Œç±»åŠ è½½å™¨çš„å¿…è¦æ€§"></a>1.2ï¼Œç±»åŠ è½½å™¨çš„å¿…è¦æ€§</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJavaå¼€å‘äººå‘˜å¹¶ä¸éœ€è¦åœ¨ç¨‹åºä¸­æ˜¾å¼åœ°ä½¿ç”¨ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯äº†è§£ç±»åŠ è½½å™¨çš„åŠ è½½æœºåˆ¶å´æ˜¾å¾—è‡³å…³é‡è¦ã€‚ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¯´ï¼š</p>
<ul>
<li><p>é¿å…åœ¨å¼€å‘ä¸­é‡åˆ°java.lang.ClassNotFoundExceptionå¼‚å¸¸æˆ–java.lang.NoClassDefFoundErrorå¼‚å¸¸æ—¶ï¼Œæ‰‹è¶³æ— æªã€‚åªæœ‰äº†è§£ç±»åŠ è½½å™¨çš„ åŠ è½½æœºåˆ¶æ‰èƒ½å¤Ÿåœ¨å‡ºç°å¼‚å¸¸çš„æ—¶å€™å¿«é€Ÿåœ°æ ¹æ®é”™è¯¯å¼‚å¸¸æ—¥å¿—å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜</p>
</li>
<li><p>éœ€è¦æ”¯æŒç±»çš„åŠ¨æ€åŠ è½½æˆ–éœ€è¦å¯¹ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶è¿›è¡ŒåŠ è§£å¯†æ“ä½œæ—¶ï¼Œå°±éœ€è¦ä¸ç±»åŠ è½½å™¨æ‰“äº¤é“äº†ã€‚</p>
</li>
<li><p>å¼€å‘äººå‘˜å¯ä»¥åœ¨ç¨‹åºä¸­ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥é‡æ–°å®šä¹‰ç±»çš„åŠ è½½è§„åˆ™ï¼Œä»¥ä¾¿å®ç°ä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ã€‚</p>
</li>
</ul>
<h4 id="1-3ï¼Œå‘½åç©ºé—´"><a href="#1-3ï¼Œå‘½åç©ºé—´" class="headerlink" title="1.3ï¼Œå‘½åç©ºé—´"></a>1.3ï¼Œå‘½åç©ºé—´</h4><p><strong>ä½•ä¸ºç±»çš„å”¯ä¸€æ€§ï¼Ÿ</strong></p>
<ul>
<li>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦æœ‰åŠ è½½ä»–çš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®è®¤å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ã€‚æ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç©ºé—´ã€‚</li>
<li>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯æœ‰åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ã€‚å¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æºè‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½ä»–ä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¿…å®šä¸åŒã€‚</li>
</ul>
<p><strong>å‘½åç©ºé—´</strong></p>
<ul>
<li><p> æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çš„çˆ¶åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆ </p>
</li>
<li><p> åœ¨åŒä¸€å‘½åç©ºé—´ä¸­ï¼Œä¸ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±» </p>
</li>
<li><p> åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±» </p>
</li>
</ul>
<p>åœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€å€ŸåŠ©è¿™ä¸€ç‰¹æ€§ï¼Œæ¥è¿è¡ŒåŒä¸€ä¸ªç±»çš„ä¸åŒç‰ˆæœ¬ã€‚</p>
<h4 id="1-4ï¼Œç±»åŠ è½½æœºåˆ¶çš„åŸºæœ¬ç‰¹å¾"><a href="#1-4ï¼Œç±»åŠ è½½æœºåˆ¶çš„åŸºæœ¬ç‰¹å¾" class="headerlink" title="1.4ï¼Œç±»åŠ è½½æœºåˆ¶çš„åŸºæœ¬ç‰¹å¾"></a>1.4ï¼Œç±»åŠ è½½æœºåˆ¶çš„åŸºæœ¬ç‰¹å¾</h4><p>åŒäº²å§”æ´¾æ¨¡å‹ã€‚ä½†ä¸æ˜¯æ‰€æœ‰ç±»åŠ è½½éƒ½éµå®ˆè¿™ä¸ªæ¨¡å‹ï¼Œæœ‰çš„æ—¶å€™ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»å‹ï¼Œæ˜¯å¯èƒ½è¦åŠ è½½ç”¨æˆ·ä»£ç çš„ï¼Œæ¯”å¦‚JDKå†…éƒ¨çš„ServiceProvider/ServiceLoaderæœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ ‡å‡†APIæ¡†æ¶ä¸Šï¼Œæä¾›è‡ªå·±çš„å®ç°ï¼ŒJDKä¹Ÿéœ€è¦æä¾›äº›é»˜è®¤çš„å‚è€ƒå®ç°ã€‚ä¾‹å¦‚ï¼ŒJavaä¸­JNDIã€JDBCã€æ–‡ä»¶ç³»ç»Ÿã€Cipherç­‰å¾ˆå¤šæ–¹é¢ï¼Œéƒ½æ˜¯åˆ©ç”¨çš„è¿™ç§æœºåˆ¶ï¼Œè¿™ç§æƒ…å†µå°±ä¸ä¼šç”¨åŒäº²å§”æ´¾æ¨¡å‹å»åŠ è½½ï¼Œè€Œæ˜¯åˆ©ç”¨æ‰€è°“çš„ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€‚</p>
<p>å¯è§æ€§ï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥è®¿é—®çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»å‹ï¼Œä½†æ˜¯åè¿‡æ¥æ˜¯ä¸å…è®¸çš„ã€‚ä¸ç„¶ï¼Œå› ä¸ºç¼ºå°‘å¿…è¦çš„éš”ç¦»ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•åˆ©ç”¨ç±»åŠ è½½å™¨å»å®ç°å®¹å™¨çš„é€»è¾‘ã€‚</p>
<p>å•ä¸€æ€§ï¼Œç”±äºçˆ¶åŠ è½½å™¨çš„ç±»å‹å¯¹äºå­åŠ è½½å™¨æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥çˆ¶åŠ è½½å™¨ä¸­åŠ è½½è¿‡çš„ç±»å‹ï¼Œå°±ä¸ä¼šåœ¨å­åŠ è½½å™¨ä¸­é‡å¤åŠ è½½ã€‚ä½†æ˜¯æ³¨æ„ï¼Œç±»åŠ è½½å™¨â€œé‚»å±…â€é—´ï¼ŒåŒä¸€ç±»å‹ä»ç„¶å¯ä»¥è¢«åŠ è½½å¤šæ¬¡ï¼Œå› ä¸ºäº’ç›¸å¹¶ä¸å¯è§ã€‚</p>
<h4 id="1-5ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»"><a href="#1-5ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»" class="headerlink" title="1.5ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»"></a>1.5ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»</h4><p>Launcherç±»æ ¸å¿ƒä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Launcher.ExtClassLoader var1;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var1 = Launcher.ExtClassLoader.getExtClassLoader();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException var10) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InternalError</span>(<span class="string">&quot;Could not create extension class loader&quot;</span>, var10);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.loader = Launcher.AppClassLoader.getAppClassLoader(var1);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException var9) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InternalError</span>(<span class="string">&quot;Could not create application class loader&quot;</span>, var9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Thread.currentThread().setContextClassLoader(<span class="built_in">this</span>.loader);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p> <strong>ExtClassLoaderçš„Parentç±»æ˜¯null</strong> </p>
</li>
<li><p> <strong>AppClassLoaderçš„Parentç±»æ˜¯ExtClassLoader</strong> </p>
</li>
<li><p> <strong>å½“å‰çº¿ç¨‹çš„ClassLoaderæ˜¯AppClassLoader</strong> </p>
</li>
</ul>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„Parentç±»å¹¶ä¸æ˜¯JAVAè¯­è¨€æ„ä¹‰ä¸Šçš„ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯ä¸€ç§åŒ…å«å…³ç³»ã€‚</p>
<h3 id="2ï¼Œç±»çš„åŠ è½½å™¨åˆ†ç±»"><a href="#2ï¼Œç±»çš„åŠ è½½å™¨åˆ†ç±»" class="headerlink" title="2ï¼Œç±»çš„åŠ è½½å™¨åˆ†ç±»"></a>2ï¼Œç±»çš„åŠ è½½å™¨åˆ†ç±»</h3><p>JVMæ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ï¼Œåˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰ã€‚</p>
<p>ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨ç»“æ„ä¸»è¦æ˜¯å¦‚ä¸‹æƒ…å†µï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220306184115840.png" alt="image-20220306184115840" loading="lazy"></p>
<ul>
<li><p>é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„â€œçˆ¶ç±»â€åŠ æˆŸå™¨ã€‚</p>
</li>
<li><p>ä¸åŒç±»åŠ è½½å™¨çœ‹ä¼¼æ˜¯ç»§æ‰¿ï¼ˆInheritanceï¼‰å…³ç³»ï¼Œå®é™…ä¸Šæ˜¯åŒ…å«å…³ç³»ã€‚åœ¨ä¸‹å±‚åŠ è½½å™¨ä¸­ï¼ŒåŒ…å«ç€ä¸Šå±‚åŠ è½½å™¨çš„å¼•ç”¨ã€‚</p>
</li>
</ul>
<p>çˆ¶ç±»åŠ è½½å™¨å’Œå­ç±»åŠ è½½å™¨çš„å…³ç³»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    ClassLoader parent;<span class="comment">//çˆ¶ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ClassLoader</span><span class="params">(ClassLoader parent)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParentClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ParentClassLoader</span><span class="params">(ClassLoader parent)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildClassLoader</span><span class="params">(ClassLoader parent)</span>&#123; <span class="comment">//parent = new ParentClassLoader();</span></span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ­£æ˜¯ç”±äºå­ç±»åŠ è½½å™¨ä¸­åŒ…å«ç€çˆ¶ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å­ç±»åŠ è½½å™¨çš„æ–¹æ³•è·å–å¯¹åº”çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¯åŠ¨ç±»åŠ è½½å™¨é€šè¿‡C/C++è¯­è¨€ç¼–å†™ï¼Œè€Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨éƒ½æ˜¯ç”±Javaè¯­è¨€ç¼–å†™çš„ï¼Œè™½ç„¶æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ˜¯è¢«jdkå¼€å‘äººå‘˜ä½¿ç”¨javaè¯­è¨€æ¥ç¼–å†™çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ç”±javaè¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</p>
<h4 id="2-1ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨"><a href="#2-1ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨" class="headerlink" title="2.1ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨"></a>2.1ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨</h4><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBootstrap ClassLoaderï¼‰</p>
<ul>
<li><p> è¿™ä¸ªç±»åŠ è½½ä½¿ç”¨C/C++è¯­è¨€å®ç°çš„ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨ã€‚ </p>
</li>
<li><p> å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆJAVAHOME/jre/lib/rt.jaræˆ–sun.boot.class.pathè·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ã€‚ç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»ã€‚ </p>
</li>
<li><p> å¹¶ä¸ç»§æ‰¿è‡ªjava.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚ </p>
</li>
<li><p> å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€javaxã€sunç­‰å¼€å¤´çš„ç±» </p>
</li>
<li><p> åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220306190055540.png" alt="image-20220306190055540" loading="lazy"></p>
<ul>
<li>ä½¿ç”¨-XX:+TraceClassLoadingå‚æ•°å¾—åˆ°ã€‚ </li>
</ul>
<p>å¯åŠ¨ç±»åŠ è½½å™¨ä½¿ç”¨C++ç¼–å†™çš„ï¼ŸYesï¼</p>
<ul>
<li><p>C/C++ï¼šæŒ‡é’ˆå‡½æ•°&amp;å‡½æ•°æŒ‡é’ˆã€C++æ”¯æŒå¤šç»§æ‰¿ã€æ›´åŠ é«˜æ•ˆ</p>
</li>
<li><p>Javaï¼šç”±Cæ¼”å˜è€Œæ¥ï¼Œï¼ˆCï¼‰â€“ç‰ˆï¼Œå•ç»§æ‰¿</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šå¯åŠ¨ç±»åŠ è½½å™¨ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š&quot;</span>);</span><br><span class="line"><span class="comment">// è·å–BootstrapclassLoaderèƒ½å¤ŸåŠ è½½çš„apiçš„è·¯å¾„</span></span><br><span class="line">URL[] urLs = sun.misc.Launcher.getBootstrapcLassPath().getURLs();</span><br><span class="line"><span class="keyword">for</span> (URL element : urLs) &#123;</span><br><span class="line">    System.out.println(element.toExternalForm());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»ä¸Šé¢çš„è·¯å¾„ä¸­éšæ„é€‰æ‹©ä¸€ä¸ªç±»ï¼Œæ¥çœ‹çœ‹ä»–çš„ç±»åŠ è½½å™¨æ˜¯ä»€ä¹ˆï¼šå¼•å¯¼ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> java.security.Provider.class.getClassLoader();</span><br><span class="line">System.out.println(classLoader);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>
<p><img src="/2022/04/18/JVM/image-20220306190156726.png" alt="image-20220306190156726" loading="lazy"></p>
<h4 id="2-2ï¼Œæ‰©å±•ç±»åŠ è½½å™¨"><a href="#2-2ï¼Œæ‰©å±•ç±»åŠ è½½å™¨" class="headerlink" title="2.2ï¼Œæ‰©å±•ç±»åŠ è½½å™¨"></a>2.2ï¼Œæ‰©å±•ç±»åŠ è½½å™¨</h4><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</p>
<ul>
<li><p> Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚ </p>
</li>
<li><p> ç»§æ‰¿äºClassLoaderç±» </p>
</li>
<li><p> çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ </p>
</li>
<li><p> ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„jre/lib/extå­ç›®å½•ä¸‹åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„JARæ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/image-20220306190234681.png" alt="image-20220306190234681" loading="lazy"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šæ‰©å±•ç±»åŠ è½½å™¨ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">extDirs</span> <span class="operator">=</span>System.getProperty(<span class="string">&quot;java.ext.dirs&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String path :extDirs.split( regex:<span class="string">&quot;;&quot;</span>))&#123;</span><br><span class="line">    System.out.println(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»ä¸Šé¢çš„è·¯å¾„ä¸­éšæ„é€‰æ‹©ä¸€ä¸ªç±»ï¼Œæ¥çœ‹çœ‹ä»–çš„ç±»åŠ è½½å™¨æ˜¯ä»€ä¹ˆï¼šæ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="type">lassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> sun.security.ec.CurveDB.class.getClassLoader();</span><br><span class="line">System.out.print1n(classLoader1); <span class="comment">//sun.misc. Launcher$ExtCLassLoader@1540e19d</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>
<p><img src="/2022/04/18/JVM/image-20220306190300948.png" alt="image-20220306190300948" loading="lazy"></p>
<h4 id="2-3ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨"><a href="#2-3ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨" class="headerlink" title="2.3ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨"></a>2.3ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨</h4><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰</p>
<ul>
<li><p>javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$AppClassLoaderå®ç°</p>
</li>
<li><p>ç»§æ‰¿äºClassLoaderç±»</p>
</li>
<li><p>çˆ¶ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨</p>
</li>
<li><p>å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡classpathæˆ–ç³»ç»Ÿå±æ€§java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“</p>
</li>
<li><p><strong>åº”ç”¨ç¨‹åºä¸­çš„ç±»åŠ è½½å™¨é»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨</strong></p>
</li>
<li><p>å®ƒæ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„é»˜è®¤çˆ¶åŠ è½½å™¨</p>
</li>
<li><p>é€šè¿‡ClassLoaderçš„getSystemClassLoader()æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/19dd9595afeb6543593ef14161fc1bb8.png" alt="img" loading="lazy"></p>
<h4 id="2-4ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#2-4ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="2.4ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>2.4ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</p>
<ul>
<li><p>åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ã€‚åœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚</p>
</li>
<li><p>ä½“ç°Javaè¯­è¨€å¼ºå¤§ç”Ÿå‘½åŠ›å’Œå·¨å¤§é­…åŠ›çš„å…³é”®å› ç´ ä¹‹ä¸€ä¾¿æ˜¯ï¼ŒJavaå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ç±»åº“çš„åŠ¨æ€åŠ è½½ï¼ŒåŠ è½½æºå¯ä»¥æ˜¯æœ¬åœ°çš„JARåŒ…ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œä¸Šçš„è¿œç¨‹èµ„æºã€‚</p>
</li>
<li><p>é€šè¿‡ç±»åŠ è½½å™¨å¯ä»¥å®ç°éå¸¸å·§å¦™çš„æ’ä»¶æœºåˆ¶ï¼Œè¿™æ–¹é¢çš„å®é™…åº”ç”¨æ¡ˆä¾‹ä¸¾ä¸èƒœä¸¾ã€‚ä¾‹å¦‚ï¼Œè‘—åçš„OSGIç»„ä»¶æ¡†æ¶ï¼Œå†å¦‚Eclipseçš„æ’ä»¶æœºåˆ¶ã€‚ç±»åŠ è½½å™¨ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ç§åŠ¨æ€å¢åŠ æ–°åŠŸèƒ½çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶æ— é¡»é‡æ–°æ‰“åŒ…å‘å¸ƒåº”ç”¨ç¨‹åºå°±èƒ½å®ç°ã€‚</p>
</li>
<li><p>åŒæ—¶ï¼Œè‡ªå®šä¹‰åŠ è½½å™¨èƒ½å¤Ÿå®ç°åº”ç”¨éš”ç¦»ï¼Œä¾‹å¦‚Tomcatï¼ŒSpringç­‰ä¸­é—´ä»¶å’Œç»„ä»¶æ¡†æ¶éƒ½åœ¨å†…éƒ¨å®ç°äº†è‡ªå®šä¹‰çš„åŠ è½½å™¨ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰åŠ è½½å™¨éš”ç¦»ä¸åŒçš„ç»„ä»¶æ¨¡å—ã€‚è¿™ç§æœºåˆ¶æ¯”C/Cç¨‹åºè¦å¥½å¤ªå¤šï¼Œæƒ³ä¸ä¿®æ”¹C/Cç¨‹åºå°±èƒ½ä¸ºå…¶æ–°å¢åŠŸèƒ½ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ï¼Œä»…ä»…ä¸€ä¸ªå…¼å®¹æ€§ä¾¿èƒ½é˜»æŒ¡ä½æ‰€æœ‰ç¾å¥½çš„è®¾æƒ³ã€‚</p>
</li>
<li><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨é€šå¸¸éœ€è¦ç»§æ‰¿äºClassLoaderã€‚</p>
</li>
</ul>
<h3 id="3ï¼Œæµ‹è¯•ä¸åŒçš„ç±»çš„åŠ è½½å™¨"><a href="#3ï¼Œæµ‹è¯•ä¸åŒçš„ç±»çš„åŠ è½½å™¨" class="headerlink" title="3ï¼Œæµ‹è¯•ä¸åŒçš„ç±»çš„åŠ è½½å™¨"></a>3ï¼Œæµ‹è¯•ä¸åŒçš„ç±»çš„åŠ è½½å™¨</h3><p>æ¯ä¸ªClasså¯¹è±¡éƒ½ä¼šåŒ…å«ä¸€ä¸ªå®šä¹‰å®ƒçš„ClassLoaderçš„ä¸€ä¸ªå¼•ç”¨ã€‚<br><strong>è·å–ClassLoaderçš„é€”å¾„</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—å½“å‰ç±»çš„ClassLoader</span></span><br><span class="line">clazz.getClassLoader()</span><br><span class="line"><span class="comment">// è·å¾—å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ClassLoader</span></span><br><span class="line">Thread.currentThread().getContextClassLoader()</span><br><span class="line"><span class="comment">// è·å¾—ç³»ç»Ÿçš„ClassLoader</span></span><br><span class="line">ClassLoader.getSystemClassLoader()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><p>ç«™åœ¨ç¨‹åºçš„è§’åº¦çœ‹ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨ä¸å¦å¤–ä¸¤ç§ç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨å’Œæ‰©å±•ç±»åŠ è½½å™¨ï¼‰å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡æ„ä¹‰ä¸Šçš„åŠ è½½å™¨ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ä½¿ç”¨C++è¯­è¨€ç¼–å†™è€Œæˆçš„ï¼Œè€Œå¦å¤–ä¸¤ç§ç±»åŠ è½½å™¨åˆ™æ˜¯ä½¿ç”¨Javaè¯­è¨€ç¼–å†™è€Œæˆçš„ã€‚ç”±äºå¼•å¯¼ç±»åŠ è½½å™¨å‹æ ¹å„¿å°±ä¸æ˜¯ä¸€ä¸ªJavaç±»ï¼Œå› æ­¤åœ¨Javaç¨‹åºä¸­åªèƒ½æ‰“å°å‡ºç©ºå€¼ã€‚</p>
</li>
<li><p>æ•°ç»„ç±»çš„Classå¯¹è±¡ï¼Œä¸æ˜¯ç”±ç±»åŠ è½½å™¨å»åˆ›å»ºçš„ï¼Œè€Œæ˜¯åœ¨Javaè¿è¡ŒæœŸJVMæ ¹æ®éœ€è¦è‡ªåŠ¨åˆ›å»ºçš„ã€‚å¯¹äºæ•°ç»„ç±»çš„ç±»åŠ è½½å™¨æ¥è¯´ï¼Œæ˜¯é€šè¿‡Class.getClassLoader()è¿”å›çš„ï¼Œä¸æ•°ç»„å½“ä¸­å…ƒç´ ç±»å‹çš„ç±»åŠ è½½å™¨æ˜¯ä¸€æ ·çš„ï¼›å¦‚æœæ•°ç»„å½“ä¸­çš„å…ƒç´ ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ•°ç»„ç±»æ˜¯æ²¡æœ‰ç±»åŠ è½½å™¨çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼šnull</span></span><br><span class="line">String[] strArr = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">6</span>];</span><br><span class="line">System.out.println(strArr.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼šsunï¼miscï¼Launcherï¼„AppCLassLoaderï¼ 18b4aac2</span></span><br><span class="line">ClassLoaderTest[] test=<span class="keyword">new</span> <span class="title class_">ClassLoaderTest</span>[<span class="number">1</span>];</span><br><span class="line">System.out.println(test.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼šnull</span></span><br><span class="line"><span class="type">int</span>[]ints =<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">System.out.println(ints.getClass().getClassLoader());</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 15:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç³»ç»Ÿè¯¥ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line">        <span class="comment">//è·å–æ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extClassLoader</span> <span class="operator">=</span> systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line">        <span class="comment">//è¯•å›¾è·å–å¼•å¯¼ç±»åŠ è½½å™¨ï¼šå¤±è´¥</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapClassLoader</span> <span class="operator">=</span> extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//###########################</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>).getClassLoader();</span><br><span class="line">            System.out.println(classLoader);</span><br><span class="line">            <span class="comment">//è‡ªå®šä¹‰çš„ç±»é»˜è®¤ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.atguigu.java.ClassLoaderTest1&quot;</span>).getClassLoader();</span><br><span class="line">            System.out.println(classLoader1);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å…³äºæ•°ç»„ç±»å‹çš„åŠ è½½:ä½¿ç”¨çš„ç±»çš„åŠ è½½å™¨ä¸æ•°ç»„å…ƒç´ çš„ç±»çš„åŠ è½½å™¨ç›¸åŒ</span></span><br><span class="line">            String[] arrStr = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">10</span>];</span><br><span class="line">            System.out.println(arrStr.getClass().getClassLoader());<span class="comment">//null:è¡¨ç¤ºä½¿ç”¨çš„æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨</span></span><br><span class="line"></span><br><span class="line">            ClassLoaderTest1[] arr1 = <span class="keyword">new</span> <span class="title class_">ClassLoaderTest1</span>[<span class="number">10</span>];</span><br><span class="line">            System.out.println(arr1.getClass().getClassLoader());<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">            <span class="type">int</span>[] arr2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">            System.out.println(arr2.getClass().getClassLoader());<span class="comment">//null:ä¸éœ€è¦ç±»çš„åŠ è½½å™¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getContextClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4ï¼ŒClassLoaderæºç è§£æ"><a href="#4ï¼ŒClassLoaderæºç è§£æ" class="headerlink" title="4ï¼ŒClassLoaderæºç è§£æ"></a>4ï¼ŒClassLoaderæºç è§£æ</h3><p><img src="/2022/04/18/JVM/image-20220306204441546.png" alt="image-20220306204441546" loading="lazy"></p>
<p>é™¤äº†ä»¥ä¸Šè™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥å®šåˆ¶è‡ªå·±çš„ç±»åŠ è½½å™¨ã€‚Javaæä¾›äº†æŠ½è±¡ç±»java.lang.ClassLoaderï¼Œæ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨éƒ½åº”è¯¥ç»§æ‰¿ClassLoaderç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="comment">//resolve:true -åŠ è½½classçš„åŒæ—¶è¿›è¡Œè§£æ</span></span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123; <span class="comment">//åŒæ­¥æ“ä½œï¼Œä¿è¯åªèƒ½åŠ è½½ä¸€æ¬¡</span></span><br><span class="line">        <span class="comment">// é¦–å…ˆï¼Œåœ¨ç¼“å­˜ä¸­åˆ¤æ–­æ˜¯å¦å·²ç»åŠ è½½è¿‡ç±»åäº†ã€‚å¦‚æœæ²¡æœ‰åŠ è½½è¿‡å°±è¿”å›null</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªä¸ºfindLoadedClassçš„æ ¸å¿ƒä»£ç å®ç°</span></span><br><span class="line"><span class="comment">        if (!checkName(name))</span></span><br><span class="line"><span class="comment">            return null;</span></span><br><span class="line"><span class="comment">        return findLoadedClass0(name);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è·å–å½“å‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœçˆ¶ç±»åŠ è½½å™¨å­˜åœ¨ï¼Œè°ƒç”¨çˆ¶ç±»åŠ è½½å™¨è¿›è¡Œç±»çš„åŠ è½½</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//parentä¸ºnullï¼šçˆ¶ç±»åŠ è½½å™¨ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰ç±»çš„åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ä¸ºèƒ½åŠ è½½æ­¤ç±» or å½“å‰ç±»è®°è½½å™¨æœªèƒ½åŠ è½½æ­¤ç±»</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="comment">//å»æ‰§è¡ŒfindClass</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-1ï¼ŒClassLoaderçš„ä¸»è¦æ–¹æ³•"><a href="#4-1ï¼ŒClassLoaderçš„ä¸»è¦æ–¹æ³•" class="headerlink" title="4.1ï¼ŒClassLoaderçš„ä¸»è¦æ–¹æ³•"></a>4.1ï¼ŒClassLoaderçš„ä¸»è¦æ–¹æ³•</h4><p>æŠ½è±¡ç±»ClassLoaderçš„ä¸»è¦æ–¹æ³•ï¼šï¼ˆå†…éƒ¨æ²¡æœ‰æŠ½è±¡æ–¹æ³•ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ClassLoader <span class="title function_">getParent</span><span class="params">()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿”å›è¯¥ç±»åŠ è½½å™¨çš„è¶…ç±»åŠ è½½å™¨ï¼Œæ˜¯åŒäº²å§”æ´¾æœºåˆ¶å®ç°çš„é‡è¦æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åŠ è½½åç§°ä¸ºnameçš„ç±»ï¼Œè¿”å›ç»“æœä¸ºjava.lang.Classç±»çš„å®ä¾‹ã€‚å¦‚æœæ‰¾ä¸åˆ°ç±»ï¼Œåˆ™è¿”å› ClassNotFoundExceptionå¼‚å¸¸ã€‚è¯¥æ–¹æ³•ä¸­çš„é€»è¾‘å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾äºŒè¿›åˆ¶åç§°ä¸ºnameçš„ç±»ï¼Œè¿”å›ç»“æœä¸ºjava.lang.Classç±»çš„å®ä¾‹ã€‚è¿™æ˜¯ä¸€ä¸ªå—ä¿æŠ¤çš„æ–¹æ³•ï¼ŒJVMé¼“åŠ±æˆ‘ä»¬é‡å†™æ­¤æ–¹æ³•ï¼Œéœ€è¦è‡ªå®šä¹‰åŠ è½½å™¨éµå¾ªåŒäº²å§”æ‰˜æœºåˆ¶ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ£€æŸ¥å®Œçˆ¶ç±»åŠ è½½å™¨ä¹‹åè¢«loadClass()æ–¹æ³•è°ƒç”¨ã€‚</p>
<ul>
<li><p> åœ¨JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ClassLoaderç±»å¹¶é‡å†™loadClassæ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ã€‚ä½†æ˜¯åœ¨JDK1.2ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›–loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨findClass()æ–¹æ³•ä¸­ï¼Œä»å‰é¢çš„åˆ†æå¯çŸ¥ï¼Œ<strong>findClass()æ–¹æ³•æ˜¯åœ¨loadClass()æ–¹æ³•ä¸­è¢«è°ƒç”¨çš„ï¼Œå½“loadClass()æ–¹æ³•ä¸­çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥åï¼Œåˆ™ä¼šè°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®Œæˆç±»åŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¹Ÿç¬¦åˆåŒäº²å§”æ‰˜æ¨¡å¼ã€‚</strong> </p>
</li>
<li><p> éœ€è¦æ³¨æ„çš„æ˜¯ClassLoaderç±»ä¸­å¹¶æ²¡æœ‰å®ç°findClass()æ–¹æ³•çš„å…·ä½“ä»£ç é€»è¾‘ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼ŒåŒæ—¶åº”è¯¥çŸ¥é“çš„æ˜¯findClassæ–¹æ³•é€šå¸¸æ˜¯å’ŒdefineClassæ–¹æ³•ä¸€èµ·ä½¿ç”¨çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ˜¯ï¼Œä¼šç›´æ¥è¦†ç›–æ‰ClassLoaderçš„findClassï¼ˆï¼‰æ–¹æ³•å¹¶ç¼–å†™åŠ è½½è§„åˆ™ï¼Œå–å¾—è¦åŠ è½½ç±»çš„å­—èŠ‚ç åè½¬åŒ–æˆæµï¼Œç„¶åè°ƒç”¨defineClassï¼ˆï¼‰æ–¹æ³•ç”Ÿæˆç±»çš„Classå¯¹è±¡ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="type">byte</span>[] b,<span class="type">int</span> off,<span class="type">int</span> len)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ç»™å®šçš„å­—èŠ‚æ•°ç»„bè½¬æ¢ä¸ºClassçš„å®ä¾‹ï¼Œoffå’Œlenå‚æ•°è¡¨ç¤ºå®é™…Classä¿¡æ¯åœ¨byteæ•°ç»„ä¸­çš„ä½ç½®å’Œé•¿åº¦ï¼Œå…¶ä¸­byteæ•°ç»„bæ˜¯ClassLoaderä»å¤–éƒ¨è·å–çš„ã€‚è¿™æ˜¯å—ä¿æŠ¤çš„æ–¹æ³•ï¼Œåªæœ‰åœ¨è‡ªå®šä¹‰ClassLoaderå­ç±»ä¸­å¯ä»¥ä½¿ç”¨ã€‚</p>
<ul>
<li> defineClass()æ–¹æ³•æ˜¯ç”¨æ¥å°†byteå­—èŠ‚æµè§£ææˆJVMèƒ½å¤Ÿè¯†åˆ«çš„Classå¯¹è±¡ï¼ˆClassLoaderä¸­å·²å®ç°è¯¥æ–¹æ³•é€»è¾‘ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ä¸ä»…èƒ½å¤Ÿé€šè¿‡classæ–‡ä»¶å®ä¾‹åŒ–classå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å®ä¾‹åŒ–classå¯¹è±¡ï¼Œå¦‚é€šè¿‡ç½‘ç»œæ¥æ”¶ä¸€ä¸ªç±»çš„å­—èŠ‚ç ï¼Œç„¶åè½¬æ¢ä¸ºbyteå­—èŠ‚æµåˆ›å»ºå¯¹åº”çš„Classå¯¹è±¡ã€‚ </li>
<li> defineClass()æ–¹æ³•é€šå¸¸ä¸findClass()æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œä¼šè¦†ç›–ClassLoaderçš„findClass()æ–¹æ³•å¹¶ç¼–å†™åŠ è½½è§„åˆ™ï¼Œå–å¾—è¦åŠ è½½ç±»çš„å­—èŠ‚ç åè½¬æ¢æˆæµï¼Œç„¶åè°ƒç”¨defineClass()æ–¹æ³•ç”Ÿæˆç±»çš„classå¯¹è±¡ã€‚</li>
</ul>
<p><strong>ç®€å•ä¸¾ä¾‹ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="comment">// è·å–ç±»çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line">    <span class="type">byte</span>[] classData =getClassData(name);</span><br><span class="line">    <span class="keyword">if</span> (classData == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨defineClassç”Ÿæˆclasså¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> defineClass(name,classData,Î¸,classData.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>é“¾æ¥æŒ‡å®šçš„ä¸€ä¸ªJavaç±»ã€‚ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ä½¿ç”¨ç±»çš„Classå¯¹è±¡åˆ›å»ºå®Œæˆçš„åŒæ—¶ä¹Ÿè¢«è§£æã€‚å‰é¢æˆ‘ä»¬è¯´é“¾æ¥é˜¶æ®µä¸»è¦æ˜¯å¯¹å­—èŠ‚ç è¿›è¡ŒéªŒè¯ï¼Œä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼åŒæ—¶å°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">resolveClass</span><span class="params">(Class&lt;?&gt; c)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾åç§°ä¸ºnameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›ç»“æœä¸ºjava.lang.Classç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯finalæ–¹æ³•ï¼Œæ— æ³•è¢«ä¿®æ”¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; findLoadedClass(String name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®ƒä¹Ÿæ˜¯ä¸€ä¸ªClassLoaderçš„å®ä¾‹ï¼Œè¿™ä¸ªå­—æ®µæ‰€è¡¨ç¤ºçš„ClassLoaderä¹Ÿç§°ä¸ºè¿™ä¸ªClassLoaderçš„åŒäº²ã€‚åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼ŒClassLoaderå¯èƒ½ä¼šå°†æŸäº›è¯·æ±‚äº¤äºˆè‡ªå·±çš„åŒäº²å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2ï¼ŒSecureClassLoaderä¸URLClassLoader"><a href="#4-2ï¼ŒSecureClassLoaderä¸URLClassLoader" class="headerlink" title="4.2ï¼ŒSecureClassLoaderä¸URLClassLoader"></a>4.2ï¼ŒSecureClassLoaderä¸URLClassLoader</h4><p>æ¥ç€SecureClassLoaderæ‰©å±•äº†ClassLoaderï¼Œæ–°å¢äº†å‡ ä¸ªä¸ä½¿ç”¨ç›¸å…³çš„ä»£ç æºï¼ˆå¯¹ä»£ç æºçš„ä½ç½®åŠå…¶è¯ä¹¦çš„éªŒè¯ï¼‰å’Œæƒé™å®šä¹‰ç±»éªŒè¯ï¼ˆä¸»è¦æŒ‡å¯¹classæºç çš„è®¿é—®æƒé™ï¼‰çš„æ–¹æ³•ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç›´æ¥è·Ÿè¿™ä¸ªç±»æ‰“äº¤é“ï¼Œæ›´å¤šæ˜¯ä¸å®ƒçš„å­ç±»URLClassLoaderæœ‰æ‰€å…³è”ã€‚</p>
<p>å‰é¢è¯´è¿‡ï¼ŒClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¾ˆå¤šæ–¹æ³•æ˜¯ç©ºçš„æ²¡æœ‰å®ç°ï¼Œæ¯”å¦‚findClass()ã€findResource()ç­‰ã€‚è€ŒURLClassLoaderè¿™ä¸ªå®ç°ç±»ä¸ºè¿™äº›æ–¹æ³•æä¾›äº†å…·ä½“çš„å®ç°ã€‚å¹¶æ–°å¢äº†URLClassPathç±»ååŠ©å–å¾—Classå­—èŠ‚ç æµç­‰åŠŸèƒ½ã€‚</p>
<p>åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿URLClassLoaderç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™findClass()æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œæ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´ç®€æ´ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220306213800101.png" alt="image-20220306213800101" loading="lazy"></p>
<h4 id="4-3ï¼ŒExtClassLoaderä¸AppClassLoader"><a href="#4-3ï¼ŒExtClassLoaderä¸AppClassLoader" class="headerlink" title="4.3ï¼ŒExtClassLoaderä¸AppClassLoader"></a>4.3ï¼ŒExtClassLoaderä¸AppClassLoader</h4><p>äº†è§£å®ŒURLClassLoaderåæ¥ç€çœ‹çœ‹å‰©ä½™çš„ä¸¤ä¸ªç±»åŠ è½½å™¨ï¼Œå³æ‹“å±•ç±»åŠ è½½å™¨ExtClassLoaderå’Œç³»ç»Ÿç±»åŠ è½½å™¨AppClassLoaderï¼Œè¿™ä¸¤ä¸ªç±»éƒ½ç»§æ‰¿è‡ªURLClassLoaderï¼Œæ˜¯sun.misc.Launcherçš„é™æ€å†…éƒ¨ç±»ã€‚</p>
<p>sun.misc.Launcherä¸»è¦è¢«ç³»ç»Ÿç”¨äºå¯åŠ¨ä¸»åº”ç”¨ç¨‹åºï¼ŒExtClassLoaderå’ŒAppClassLoaderéƒ½æ˜¯ç”±sun.misc.Launcheråˆ›å»ºçš„ï¼Œå…¶ç±»ä¸»è¦ç±»ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220306213917640.png" alt="image-20220306213917640" loading="lazy"></p>
<p>æˆ‘ä»¬å‘ç°ExtClassLoaderå¹¶æ²¡æœ‰é‡å†™loadClass()æ–¹æ³•ï¼Œè¿™è¶³çŸ£è¯´æ˜å…¶éµå¾ªåŒäº²å§”æ´¾æ¨¡å¼ï¼Œè€ŒAppClassLoaderé‡è½½äº†loadClass()æ–¹æ³•ï¼Œä½†æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯çˆ¶ç±»loadClass()æ–¹æ³•ï¼Œå› æ­¤ä¾ç„¶éµå®ˆåŒäº²å§”æ´¾æ¨¡å¼ã€‚</p>
<h4 id="4-4ï¼ŒClass-forName-ä¸ClassLoader-loadClass"><a href="#4-4ï¼ŒClass-forName-ä¸ClassLoader-loadClass" class="headerlink" title="4.4ï¼ŒClass.forName()ä¸ClassLoader.loadClass()"></a>4.4ï¼ŒClass.forName()ä¸ClassLoader.loadClass()</h4><p><strong>Class.forName()</strong></p>
<ul>
<li><p> Class.forName()ï¼šæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯Class.forName(String className); </p>
</li>
<li><p> æ ¹æ®ä¼ å…¥çš„ç±»çš„å…¨é™å®šåè¿”å›ä¸€ä¸ªClasså¯¹è±¡ã€‚è¯¥æ–¹æ³•åœ¨å°†Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜çš„åŒæ—¶ï¼Œä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ã€‚  </p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.atguigu.java.Helloworld&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ClassLoader.loadClass()</strong></p>
<ul>
<li><p> ClassLoader.loadClass()ï¼šè¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ªClassLoaderå¯¹è±¡æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚ </p>
</li>
<li><p> è¯¥æ–¹æ³•å°†Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼Œç›´åˆ°è¿™ä¸ªç±»ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚è¯¥æ–¹æ³•å› ä¸ºéœ€è¦å¾—åˆ°ä¸€ä¸ªClassLoaderå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®éœ€è¦æŒ‡å®šä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨ã€‚ </p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Classloader</span> <span class="variable">cl</span> <span class="operator">=</span> ......; cl.loadClass(<span class="string">&quot;com.atguigu.java.Helloworld&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹"><a href="#5ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="5ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹"></a>5ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹</h3><h4 id="5-1ï¼Œå®šä¹‰ä¸æœ¬è´¨"><a href="#5-1ï¼Œå®šä¹‰ä¸æœ¬è´¨" class="headerlink" title="5.1ï¼Œå®šä¹‰ä¸æœ¬è´¨"></a>5.1ï¼Œå®šä¹‰ä¸æœ¬è´¨</h4><p>ç±»åŠ è½½å™¨ç”¨æ¥æŠŠç±»åŠ è½½åˆ°Javaè™šæ‹Ÿæœºä¸­ã€‚ä»JDK1.2ç‰ˆæœ¬å¼€å§‹ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹é‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶èƒ½æ›´å¥½åœ°ä¿è¯Javaå¹³å°çš„å®‰å…¨ã€‚</p>
<p><strong>å®šä¹‰</strong></p>
<p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡é€’å½’ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ã€‚åªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡æ—¶ï¼Œæ‰è‡ªå·±å»åŠ è½½ã€‚</p>
<p><strong>æœ¬è´¨</strong></p>
<p>è§„å®šäº†ç±»åŠ è½½çš„é¡ºåºæ˜¯ï¼šå¼•å¯¼ç±»åŠ è½½å™¨å…ˆåŠ è½½ï¼Œè‹¥åŠ è½½ä¸åˆ°ï¼Œç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ï¼Œè‹¥è¿˜åŠ è½½ä¸åˆ°ï¼Œæ‰ä¼šç”±ç³»ç»Ÿç±»åŠ è½½å™¨æˆ–è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220306215023595.png" alt="image-20220306215023595" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220306215035243.png" alt="image-20220306215035243" loading="lazy"></p>
<h4 id="5-2ï¼Œä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#5-2ï¼Œä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="5.2ï¼Œä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>5.2ï¼Œä¼˜åŠ¿ä¸åŠ£åŠ¿</h4><p><strong>åŒäº²å§”æ´¾æœºåˆ¶ä¼˜åŠ¿</strong></p>
<ul>
<li><p>é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œç¡®ä¿ä¸€ä¸ªç±»çš„å…¨å±€å”¯ä¸€æ€§</p>
<p>Javaç±»éšç€å®ƒçš„åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚æ¬¡å…³ç³»å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»å·²ç»åŠ è½½äº†è¯¥ç±»æ˜¯ï¼Œå°±æ²¡æœ‰å¿…è¦å­ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚</p>
</li>
<li><p>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹</p>
</li>
</ul>
<p><strong>ä»£ç æ”¯æŒ</strong></p>
<p>åŒäº²å§”æ´¾æœºåˆ¶åœ¨java.lang.ClassLoader.loadClass(Stringï¼Œboolean)æ¥å£ä¸­ä½“ç°ã€‚è¯¥æ¥å£çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å…ˆåœ¨å½“å‰åŠ è½½å™¨çš„ç¼“å­˜ä¸­æŸ¥æ‰¾æœ‰æ— ç›®æ ‡ç±»ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ã€‚</p>
<p>ï¼ˆ2ï¼‰åˆ¤æ–­å½“å‰åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨parent.loadClass(nameï¼Œfalse)æ¥å£è¿›è¡ŒåŠ è½½ã€‚</p>
<p>ï¼ˆ3ï¼‰åä¹‹ï¼Œå¦‚æœå½“å‰åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™è°ƒç”¨findBootstrapClassorNull(name)æ¥å£ï¼Œè®©å¼•å¯¼ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚</p>
<p>ï¼ˆ4ï¼‰å¦‚æœé€šè¿‡ä»¥ä¸Š3æ¡è·¯å¾„éƒ½æ²¡èƒ½æˆåŠŸåŠ è½½ï¼Œåˆ™è°ƒç”¨findClass(name)æ¥å£è¿›è¡ŒåŠ è½½ã€‚è¯¥æ¥å£æœ€ç»ˆä¼šè°ƒç”¨java.lang.ClassLoaderæ¥å£çš„defineClassç³»åˆ—çš„nativeæ¥å£åŠ è½½ç›®æ ‡Javaç±»ã€‚</p>
<p>åŒäº²å§”æ´¾çš„æ¨¡å‹å°±éšè—åœ¨è¿™ç¬¬2å’Œç¬¬3æ­¥ä¸­ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong></p>
<p>å‡è®¾å½“å‰åŠ è½½çš„æ˜¯java.lang.Objectè¿™ä¸ªç±»ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¯¥ç±»å±äºJDKä¸­æ ¸å¿ƒå¾—ä¸èƒ½å†æ ¸å¿ƒçš„ä¸€ä¸ªç±»ï¼Œå› æ­¤ä¸€å®šåªèƒ½ç”±å¼•å¯¼ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚å½“]VMå‡†å¤‡åŠ è½½javaJang.Objectæ—¶ï¼ŒJVMé»˜è®¤ä¼šä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨å»åŠ è½½ï¼ŒæŒ‰ç…§ä¸Šé¢4æ­¥åŠ è½½çš„é€»è¾‘ï¼Œåœ¨ç¬¬1æ­¥ä»ç³»ç»Ÿç±»çš„ç¼“å­˜ä¸­è‚¯å®šæŸ¥æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œäºæ˜¯è¿›å…¥ç¬¬2æ­¥ã€‚ç”±äºä»ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œäºæ˜¯æ‰©å±•ç±»åŠ è½½å™¨ç»§ç»­ä»ç¬¬1æ­¥å¼€å§‹é‡å¤ã€‚ç”±äºæ‰©å±•ç±»åŠ è½½å™¨çš„ç¼“å­˜ä¸­ä¹Ÿä¸€å®šæŸ¥æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œå› æ­¤è¿›å…¥ç¬¬2æ­¥ã€‚æ‰©å±•ç±»çš„çˆ¶åŠ è½½å™¨æ˜¯nullï¼Œå› æ­¤ç³»ç»Ÿè°ƒç”¨findClassï¼ˆStringï¼‰ï¼Œæœ€ç»ˆé€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚</p>
<p><strong>æ€è€ƒ</strong></p>
<p>å¦‚æœåœ¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸­é‡å†™java.lang.ClassLoader.loadClass(String)æˆ–java.lang.ClassLoader.loadclass(Stringï¼Œboolean)æ–¹æ³•ï¼ŒæŠ¹å»å…¶ä¸­çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä»…ä¿ç•™ä¸Šé¢è¿™4æ­¥ä¸­çš„ç¬¬læ­¥ä¸ç¬¬4æ­¥ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å°±èƒ½å¤ŸåŠ è½½æ ¸å¿ƒç±»åº“äº†å‘¢ï¼Ÿ</p>
<p>è¿™ä¹Ÿä¸è¡Œï¼å› ä¸ºJDKè¿˜ä¸ºæ ¸å¿ƒç±»åº“æä¾›äº†ä¸€å±‚ä¿æŠ¤æœºåˆ¶ã€‚ä¸ç®¡æ˜¯è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨æŠ‘æˆ–æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæœ€ç»ˆéƒ½å¿…é¡»è°ƒç”¨ java.lang.ClassLoader.defineclass(Stringï¼Œbyte[]ï¼Œintï¼Œintï¼ŒProtectionDomain)æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¼šæ‰§è¡ŒpreDefineClass()æ¥å£ï¼Œè¯¥æ¥å£ä¸­æä¾›äº†å¯¹JDKæ ¸å¿ƒç±»åº“çš„ä¿æŠ¤ã€‚</p>
<p><strong>å¼Šç«¯</strong></p>
<p>æ£€æŸ¥ç±»æ˜¯å¦åŠ è½½çš„å§”æ‰˜è¿‡ç¨‹æ˜¯å•å‘çš„ï¼Œè¿™ä¸ªæ–¹å¼è™½ç„¶ä»ç»“æ„ä¸Šè¯´æ¯”è¾ƒæ¸…æ™°ï¼Œä½¿å„ä¸ªClassLoaderçš„èŒè´£éå¸¸æ˜ç¡®ï¼Œä½†æ˜¯åŒæ—¶ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå³é¡¶å±‚çš„ClassLoaderæ— æ³•è®¿é—®åº•å±‚çš„ClassLoaderæ‰€åŠ è½½çš„ç±»ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ä¸­çš„ç±»ä¸ºç³»ç»Ÿæ ¸å¿ƒç±»ï¼ŒåŒ…æ‹¬ä¸€äº›é‡è¦çš„ç³»ç»Ÿæ¥å£ï¼Œè€Œåœ¨åº”ç”¨ç±»åŠ è½½å™¨ä¸­ï¼Œä¸ºåº”ç”¨ç±»ã€‚æŒ‰ç…§è¿™ç§æ¨¡å¼ï¼Œ<strong>åº”ç”¨ç±»è®¿é—®ç³»ç»Ÿç±»è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç³»ç»Ÿç±»è®¿é—®åº”ç”¨ç±»å°±ä¼šå‡ºç°é—®é¢˜ã€‚</strong>æ¯”å¦‚åœ¨ç³»ç»Ÿç±»ä¸­æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£éœ€è¦åœ¨åº”ç”¨ç±»ä¸­å¾—ä»¥å®ç°ï¼Œè¯¥æ¥å£è¿˜ç»‘å®šä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºè¯¥æ¥å£çš„å®ä¾‹ï¼Œè€Œæ¥å£å’Œå·¥å‚æ–¹æ³•éƒ½åœ¨å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ã€‚è¿™æ—¶ï¼Œå°±ä¼šå‡ºç°è¯¥å·¥å‚æ–¹æ³•æ— æ³•åˆ›å»ºç”±åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½çš„åº”ç”¨å®ä¾‹çš„é—®é¢˜ã€‚</p>
<p><strong>ç»“è®º</strong></p>
<p>ç”±äºJavaè™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚ç±»åŠ è½½å™¨çš„æœºåˆ¶ä¸€å®šè¦ä½¿ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œåªæ˜¯å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼è€Œå·²ã€‚</p>
<p>æ¯”å¦‚åœ¨Tomcatä¸­ï¼Œç±»åŠ è½½å™¨æ‰€é‡‡ç”¨çš„åŠ è½½æœºåˆ¶å°±å’Œä¼ ç»Ÿçš„åŒäº²å§”æ´¾æ¨¡å‹æœ‰ä¸€å®šåŒºåˆ«ï¼Œå½“ç¼ºçœçš„ç±»åŠ è½½å™¨æ¥æ”¶åˆ°ä¸€ä¸ªç±»çš„åŠ è½½ä»»åŠ¡æ—¶ï¼Œé¦–å…ˆä¼šç”±å®ƒè‡ªè¡ŒåŠ è½½ï¼Œå½“å®ƒåŠ è½½å¤±è´¥æ—¶ï¼Œæ‰ä¼šå°†ç±»çš„åŠ è½½ä»»åŠ¡å§”æ´¾ç»™å®ƒçš„è¶…ç±»åŠ è½½å™¨å»æ‰§è¡Œï¼Œè¿™åŒæ—¶ä¹Ÿæ˜¯Seryletè§„èŒƒæ¨èçš„ä¸€ç§åšæ³•ã€‚</p>
<h4 id="5-3ï¼Œç ´ååŒäº²å§”æ´¾æœºåˆ¶"><a href="#5-3ï¼Œç ´ååŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="5.3ï¼Œç ´ååŒäº²å§”æ´¾æœºåˆ¶"></a>5.3ï¼Œç ´ååŒäº²å§”æ´¾æœºåˆ¶</h4><p>åŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ä¸ªå…·æœ‰å¼ºåˆ¶æ€§çº¦æŸçš„æ¨¡å‹ï¼Œè€Œæ˜¯Javaè®¾è®¡è€…æ¨èç»™å¼€å‘è€…ä»¬çš„ç±»åŠ è½½å™¨å®ç°æ–¹å¼ã€‚</p>
<p>åœ¨Javaçš„ä¸–ç•Œä¸­å¤§éƒ¨åˆ†çš„ç±»åŠ è½½å™¨éƒ½éµå¾ªè¿™ä¸ªæ¨¡å‹ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼Œç›´åˆ°Javaæ¨¡å—åŒ–å‡ºç°ä¸ºæ­¢ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä¸»è¦å‡ºç°è¿‡3æ¬¡è¾ƒå¤§è§„æ¨¡â€œè¢«ç ´åâ€çš„æƒ…å†µã€‚</p>
<p><strong>ç¬¬ä¸€æ¬¡ç ´ååŒäº²å§”æ´¾æœºåˆ¶</strong></p>
<p>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰ä¸€â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£ã€‚</p>
<p>ç”±äºåŒäº²å§”æ´¾æ¨¡å‹åœ¨JDK 1.2ä¹‹åæ‰è¢«å¼•å…¥ï¼Œä½†æ˜¯ç±»åŠ è½½å™¨çš„æ¦‚å¿µå’ŒæŠ½è±¡ç±»java.lang.ClassLoaderåˆ™åœ¨Javaçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­å°±å·²ç»å­˜åœ¨ï¼Œé¢å¯¹ç»å­˜åœ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„ä»£ç ï¼ŒJavaè®¾è®¡è€…ä»¬å¼•å…¥åŒäº²å§”æ´¾æ¨¡å‹æ—¶ä¸å¾—ä¸åšå‡ºä¸€äº›å¦¥åï¼Œä¸ºäº†å…¼å®¹è¿™äº›å·²æœ‰çš„ä»£ç ï¼Œ<strong>æ— æ³•åœ¨ä»¥æŠ€æœ¯æ‰‹æ®µé¿å…loadClass()è¢«å­ç±»è¦†ç›–çš„å¯èƒ½æ€§</strong>ï¼Œåªèƒ½åœ¨JDK1.2ä¹‹åçš„java.lang.ClassLoaderä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„protectedæ–¹æ³•findClass()ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç¼–å†™çš„ç±»åŠ è½½é€»è¾‘æ—¶å°½å¯èƒ½å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨loadClass()ä¸­ç¼–å†™ä»£ç ã€‚ä¸ŠèŠ‚æˆ‘ä»¬å·²ç»åˆ†æè¿‡loadClass()æ–¹æ³•ï¼ŒåŒäº²å§”æ´¾çš„å…·ä½“é€»è¾‘å°±å®ç°åœ¨è¿™é‡Œé¢ï¼ŒæŒ‰ç…§loadClass()æ–¹æ³•çš„é€»è¾‘ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®ŒæˆåŠ è½½ï¼Œè¿™æ ·æ—¢ä¸å½±å“ç”¨æˆ·æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å»åŠ è½½ç±»ï¼Œåˆå¯ä»¥ä¿è¯æ–°å†™å‡ºæ¥çš„ç±»åŠ è½½å™¨æ˜¯ç¬¦åˆåŒäº²å§”æ´¾è§„åˆ™çš„ã€‚</p>
<p><strong>ç¬¬äºŒæ¬¡ç ´ååŒäº²å§”æ´¾æœºåˆ¶ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</strong></p>
<p>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„ï¼ŒåŒäº²å§”æ´¾å¾ˆå¥½åœ°è§£å†³äº†å„ä¸ªç±»åŠ è½½å™¨åä½œæ—¶åŸºç¡€ç±»å‹çš„ä¸€è‡´æ€§é—®é¢˜ï¼ˆ<u>è¶ŠåŸºç¡€çš„ç±»è¶Šç”±ä¸Šå±‚çš„åŠ è½½å™¨è¿›è¡ŒåŠ è½½</u>ï¼‰ï¼ŒåŸºç¡€ç±»å‹ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€œåŸºç¡€â€ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ€»æ˜¯ä½œä¸ºè¢«ç”¨æˆ·ä»£ç ç»§æ‰¿ã€è°ƒç”¨çš„APIå­˜åœ¨ï¼Œä½†ç¨‹åºè®¾è®¡å¾€å¾€æ²¡æœ‰ç»å¯¹ä¸å˜çš„å®Œç¾è§„åˆ™ï¼Œ<u>å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨ä¼šç”¨æˆ·çš„ä»£ç é‚£è¯¥æ€ä¹ˆåŠå‘¢</u></p>
<p>è¿™å¹¶éæ˜¯ä¸å¯èƒ½å‡ºç°çš„äº‹æƒ…ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­ä¾¿æ˜¯JNDIæœåŠ¡ï¼ŒJNDIç°åœ¨å·²ç»æ˜¯Javaçš„æ ‡å‡†æœåŠ¡ï¼Œå®ƒçš„ä»£ç ç”±å¯åŠ¨ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼ˆåœ¨JDK 1.3æ—¶åŠ å…¥åˆ°rt.jarçš„ï¼‰ï¼Œè‚¯å®šå±äºJavaä¸­å¾ˆåŸºç¡€çš„ç±»å‹äº†ã€‚ä½†JNDIå­˜åœ¨çš„ç›®çš„å°±æ˜¯å¯¹èµ„æºè¿›è¡ŒæŸ¥æ‰¾å’Œé›†ä¸­ç®¡ç†ï¼Œå®ƒéœ€è¦è°ƒç”¨ç”±å…¶ä»–å‚å•†å®ç°å¹¶éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„ClassPathä¸‹çš„JNDIæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService Provider Interfaceï¼ŒSPIï¼‰çš„ä»£ç ï¼Œç°åœ¨é—®é¢˜æ¥äº†ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç»å¯¹ä¸å¯èƒ½è®¤è¯†åŠ è½½è¿™äº›ä»£ç çš„ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿï¼ˆSPIï¼šåœ¨Javaå¹³å°ä¸­ï¼Œé€šå¸¸æŠŠæ ¸å¿ƒç±»rt.jarä¸­æä¾›å¤–éƒ¨æœåŠ¡ã€å¯ç”±åº”ç”¨å±‚è‡ªè¡Œå®ç°çš„æ¥å£ç§°ä¸ºSPIï¼‰</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªå›°å¢ƒï¼ŒJavaçš„è®¾è®¡å›¢é˜Ÿåªå¥½å¼•å…¥äº†ä¸€ä¸ªä¸å¤ªä¼˜é›…çš„è®¾è®¡ï¼š<u>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context Classloaderï¼‰</u>ã€‚è¿™ä¸ªç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡java.lang.Threadç±»çš„setContextClassLoader()æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æ—¶è¿˜æœªè®¾ç½®ï¼Œå®ƒå°†ä¼šä»çˆ¶çº¿ç¨‹ä¸­ç»§æ‰¿ä¸€ä¸ªï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºçš„å…¨å±€èŒƒå›´å†…éƒ½æ²¡æœ‰è®¾ç½®è¿‡çš„è¯ï¼Œé‚£è¿™ä¸ªç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚</p>
<p>æœ‰äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œç¨‹åºå°±å¯ä»¥åšä¸€äº›â€œèˆå¼Šâ€çš„äº‹æƒ…äº†ã€‚JNDIæœåŠ¡ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»åŠ è½½æ‰€éœ€çš„SPIæœåŠ¡ä»£ç ï¼Œè¿™æ˜¯ä¸€ç§çˆ¶ç±»åŠ è½½å™¨å»è¯·æ±‚ä¸€ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½çš„è¡Œä¸ºï¼ŒæŒ‡é’ˆè¡Œä¸ºå®é™…ä¸Šæ˜¯é€šè¿‡äº†åŒäº²å§”æ´¾æ¨¡å‹å±‚æ¬¡ç»“æ„æ¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ï¼Œä»¥ä¸ºè¢«äº†åŒäº²å§”æ´¾æ¨¡å‹çš„ä¸€èˆ¬æ€§åŸåˆ™ï¼Œä½†ä¹Ÿæ˜¯æ— å¯å¥ˆä½•çš„äº‹æƒ…ã€‚ ï¼Œä¾‹å¦‚JNDIã€JDBCã€JCEã€JAXBå’ŒJBIç­‰ã€‚ä¸è¿‡ï¼Œå½“SPIçš„æœåŠ¡æä¾›è€…å¤šäºä¸€ä¸ªçš„æ—¶å€™ï¼Œä»£ç å°±åªèƒ½æ ¹æ®å…·ä½“æä¾›è€…çš„ç±»å‹æ¥ç¡¬ç¼–ç åˆ¤æ–­ï¼Œä¸ºäº†æ¶ˆé™¤è¿™ç§æä¸ä¼˜é›…çš„å®ç°æ–¹å¼ï¼Œåœ¨JDK6æ—¶ï¼ŒJDKæä¾›äº†java.util.ServiceLoaderç±»ï¼Œä»¥META-INF/servicesä¸­çš„é…ç½®ä¿¡æ¯ï¼Œè¾…ä»¥è´£ä»»é“¾æ¨¡å¼ï¼Œè¿™æ‰ç®—æ˜¯ç»™SPIçš„åŠ è½½æä¾›äº†ä¸€ç§ç›¸å¯¹åˆç†çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="/2022/04/18/JVM/image-20220306221419020.png" alt="image-20220306221419020" loading="lazy"></p>
<p><strong>ç¬¬ä¸‰æ¬¡ç ´ååŒäº²å§”æ´¾æœºåˆ¶</strong></p>
<p>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„ã€‚å¦‚ï¼š**ä»£ç çƒ­æ›¿æ¢(Hot Swap)ã€æ¨¡å—çƒ­éƒ¨ç½²(Hot Deployment)**ç­‰</p>
<p>IBMå…¬å¸ä¸»å¯¼çš„JSR-291(å³OSGiR4.2)å®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ï¼Œæ¯ä¸€ä¸ªç¨‹åºæ¨¡å—(osGiä¸­ç§°ä¸ºBundle)éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ªBundleæ—¶ï¼Œå°±æŠŠBund1eè¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚åœ¨oSGiç¯å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†åŒäº²å§”æ´¾æ¨¡å‹æ¨èçš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ã€‚</p>
<p>å½“æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼ŒOSGiå°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¿›è¡Œç±»æœç´¢ï¼š</p>
<p>1ï¼‰å°†ä»¥java.*å¼€å¤´ç±»ï¼Œå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>2ï¼‰å¦åˆ™ï¼Œå°†å§”æ´¾åˆ—è¡¨åå•å†…éƒ¨çš„ç±»ï¼Œå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>3ï¼‰å¦åˆ™ï¼Œå°†Importåˆ—è¡¨ä¸­çš„ç±»ï¼Œå§”æ´¾ç»™Exportè¿™ä¸ªç±»çš„Bundleçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>4ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰Bundleçš„ClassPathï¼Œä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>5ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾ç±»æ˜¯å¦åœ¨è‡ªå·±çš„Fragment Bundleä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™å§”æ´¾ç»™Fragment Bundleçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>6ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾Dynamic Importåˆ—è¡¨çš„Bundleï¼Œå§”æ´¾ç»™å¯¹åº”Bund1eçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<p>7ï¼‰å¦åˆ™ï¼Œç±»æŸ¥æ‰¾å¤±è´¥ã€‚</p>
<p>è¯´æ˜ï¼šåªæœ‰å¼€å¤´ä¸¤ç‚¹ä»ç„¶ç¬¦åˆåŒäº²å§”æ´¾æ¨¡å‹çš„åŸåˆ™ï¼Œå…¶ä½™çš„ç±»æŸ¥æ‰¾éƒ½æ˜¯åœ¨å¹³çº§çš„ç±»åŠ è½½å™¨ä¸­è¿›è¡Œçš„</p>
<p>å°ç»“ï¼šè¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†â€œè¢«ç ´åâ€è¿™ä¸ªè¯æ¥å½¢å®¹ä¸Šè¿°ä¸ç¬¦åˆåŒäº²å§”æ´¾æ¨¡å‹åŸåˆ™çš„è¡Œä¸ºï¼Œä½†è¿™é‡Œâ€œè¢«ç ´åâ€å¹¶ä¸ä¸€å®šæ˜¯å¸¦æœ‰è´¬ä¹‰çš„ã€‚åªè¦æœ‰æ˜ç¡®çš„ç›®çš„å’Œå……åˆ†çš„ç†ç”±ï¼Œçªç ´æ—§æœ‰åŸåˆ™æ— ç–‘æ˜¯ä¸€ç§åˆ›æ–°ã€‚</p>
<p>æ­£å¦‚ï¼šOSGiä¸­çš„ç±»åŠ è½½å™¨çš„è®¾è®¡ä¸ç¬¦åˆä¼ ç»Ÿçš„åŒäº²å§”æ´¾çš„ç±»åŠ è½½å™¨æ¶æ„ï¼Œä¸”ä¸šç•Œå¯¹å…¶ä¸ºäº†å®ç°çƒ­éƒ¨ç½²è€Œå¸¦æ¥çš„é¢å¤–çš„é«˜å¤æ‚åº¦è¿˜å­˜åœ¨ä¸å°‘äº‰è®®ï¼Œä½†å¯¹è¿™æ–¹é¢æœ‰äº†è§£çš„æŠ€æœ¯äººå‘˜åŸºæœ¬è¿˜æ˜¯èƒ½è¾¾æˆä¸€ä¸ªå…±è¯†ï¼Œè®¤ä¸º<strong>OSGiä¸­å¯¹ç±»åŠ è½½å™¨çš„è¿ç”¨æ˜¯å€¼å¾—å­¦ä¹ çš„ï¼Œå®Œå…¨å¼„æ‡‚äº†OSGiçš„å®ç°ï¼Œå°±ç®—æ˜¯æŒæ¡äº†ç±»åŠ è½½å™¨çš„ç²¾ç²¹ã€‚</strong></p>
<h4 id="5-4ï¼Œçƒ­æ›¿æ¢çš„å®ç°"><a href="#5-4ï¼Œçƒ­æ›¿æ¢çš„å®ç°" class="headerlink" title="5.4ï¼Œçƒ­æ›¿æ¢çš„å®ç°"></a>5.4ï¼Œçƒ­æ›¿æ¢çš„å®ç°</h4><p>çƒ­æ›¿æ¢æ˜¯æŒ‡åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸åœæ­¢æœåŠ¡ï¼Œåªé€šè¿‡æ›¿æ¢ç¨‹åºæ–‡ä»¶æ¥ä¿®æ”¹ç¨‹åºçš„è¡Œä¸ºã€‚<strong>çƒ­æ›¿æ¢çš„å…³é”®éœ€æ±‚åœ¨äºæœåŠ¡ä¸èƒ½ä¸­æ–­ï¼Œä¿®æ”¹å¿…é¡»ç«‹å³è¡¨ç°æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿä¹‹ä¸Š</strong>ã€‚åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†è„šæœ¬è¯­è¨€éƒ½æ˜¯å¤©ç”Ÿæ”¯æŒçƒ­æ›¿æ¢çš„ï¼Œæ¯”å¦‚ï¼šPHPï¼Œåªè¦æ›¿æ¢äº†PHPæºæ–‡ä»¶ï¼Œè¿™ç§æ”¹åŠ¨å°±ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ— éœ€é‡å¯WebæœåŠ¡å™¨ã€‚</p>
<p>ä½†å¯¹Javaæ¥è¯´ï¼Œçƒ­æ›¿æ¢å¹¶éå¤©ç”Ÿå°±æ”¯æŒï¼Œ<u>å¦‚æœä¸€ä¸ªç±»å·²ç»åŠ è½½åˆ°ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä¿®æ”¹ç±»æ–‡ä»¶ï¼Œå¹¶æ— æ³•è®©ç³»ç»Ÿå†æ¥åŠ è½½å¹¶é‡å®šä¹‰è¿™ä¸ªç±»ã€‚</u>å› æ­¤ï¼Œåœ¨Javaä¸­å®ç°è¿™ä¸€åŠŸèƒ½çš„ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•å°±æ˜¯çµæ´»è¿ç”¨ClassLoaderã€‚</p>
<p>æ³¨æ„ï¼šç”±ä¸åŒClassLoaderåŠ è½½çš„åŒåç±»å±äºä¸åŒçš„ç±»å‹ï¼Œä¸èƒ½ç›¸äº’è½¬æ¢å’Œå…¼å®¹ã€‚å³ä¸¤ä¸ªä¸åŒçš„ClassLoaderåŠ è½½åŒä¸€ä¸ªç±»ï¼Œåœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œä¼šè®¤ä¸ºè¿™2ä¸ªç±»æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿçƒ­æ›¿æ¢çš„å®ç°ï¼ŒåŸºæœ¬æ€è·¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220306222130901.png" alt="image-20220306222130901" loading="lazy"></p>
<h3 id="6ï¼Œæ²™ç®±å®‰å…¨æœºåˆ¶"><a href="#6ï¼Œæ²™ç®±å®‰å…¨æœºåˆ¶" class="headerlink" title="6ï¼Œæ²™ç®±å®‰å…¨æœºåˆ¶"></a>6ï¼Œæ²™ç®±å®‰å…¨æœºåˆ¶</h3><p>æ²™ç®±å®‰å…¨æœºåˆ¶</p>
<ul>
<li><p>ä¿è¯ç¨‹åºå®‰å…¨</p>
</li>
<li><p>ä¿æŠ¤JavaåŸç”Ÿçš„JDKä»£ç </p>
</li>
</ul>
<p>Javaå®‰å…¨æ¨¡å‹çš„æ ¸å¿ƒå°±æ˜¯Javaæ²™ç®±ï¼ˆsandboxï¼‰ã€‚ä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿæ²™ç®±æ˜¯ä¸€ä¸ªé™åˆ¶ç¨‹åºè¿è¡Œçš„ç¯å¢ƒã€‚</p>
<p>æ²™ç®±æœºåˆ¶å°±æ˜¯å°†Javaä»£ç é™å®šåœ¨è™šæ‹Ÿæœºç‰¹å®šçš„è¿è¡ŒèŒƒå›´ä¸­ï¼Œå¹¶ä¸”ä¸¥æ ¼é™åˆ¶ä»£ç å¯¹æœ¬åœ°ç³»ç»Ÿèµ„æºçš„è®¿é—®ã€‚é€šè¿‡è¿™æ ·çš„æªæ–½æ¥ä¿è¯å¯¹ä»£ç çš„æœ‰é™éš”ç¦»ï¼Œé˜²æ­¢å¯¹æœ¬åœ°ç³»ç»Ÿé€ æˆç ´åã€‚</p>
<p>æ²™ç®±ä¸»è¦é™åˆ¶ç³»ç»Ÿèµ„æºè®¿é—®ï¼Œé‚£ç³»ç»Ÿèµ„æºåŒ…æ‹¬ä»€ä¹ˆï¼ŸCPUã€å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€‚ä¸åŒçº§åˆ«çš„æ²™ç®±å¯¹è¿™äº›èµ„æºè®¿é—®çš„é™åˆ¶ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ã€‚</p>
<p>æ‰€æœ‰çš„Javaç¨‹åºè¿è¡Œéƒ½å¯ä»¥æŒ‡å®šæ²™ç®±ï¼Œå¯ä»¥å®šåˆ¶å®‰å…¨ç­–ç•¥ã€‚</p>
<h4 id="6-1ï¼ŒJDK1-0æ—¶æœŸ"><a href="#6-1ï¼ŒJDK1-0æ—¶æœŸ" class="headerlink" title="6.1ï¼ŒJDK1.0æ—¶æœŸ"></a>6.1ï¼ŒJDK1.0æ—¶æœŸ</h4><p>åœ¨Javaä¸­å°†æ‰§è¡Œç¨‹åºåˆ†æˆæœ¬åœ°ä»£ç å’Œè¿œç¨‹ä»£ç ä¸¤ç§ï¼Œæœ¬åœ°ä»£ç é»˜è®¤è§†ä¸ºå¯ä¿¡ä»»çš„ï¼Œè€Œè¿œç¨‹ä»£ç åˆ™è¢«çœ‹ä½œæ˜¯ä¸å—ä¿¡çš„ã€‚å¯¹äºæˆä¿¡çš„æœ¬åœ°ä»£ç ï¼Œå¯ä»¥è®¿é—®ä¸€åˆ‡æœ¬åœ°èµ„æºã€‚è€Œå¯¹äºéæˆä¿¡çš„è¿œç¨‹ä»£ç åœ¨æ—©æœŸçš„Javaå®ç°ä¸­ï¼Œå®‰å…¨ä¾èµ–äº<strong>æ²™ç®±ï¼ˆSandboxï¼‰æœºåˆ¶</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºJDK1.0å®‰å…¨æ¨¡å‹</p>
<p><img src="/2022/04/18/JVM/image-20220306223124134.png" alt="image-20220306223124134" loading="lazy"></p>
<h4 id="6-2ï¼ŒJDK1-1æ—¶æœŸ"><a href="#6-2ï¼ŒJDK1-1æ—¶æœŸ" class="headerlink" title="6.2ï¼ŒJDK1.1æ—¶æœŸ"></a>6.2ï¼ŒJDK1.1æ—¶æœŸ</h4><p>JDK1.0ä¸­å¦‚æ­¤ä¸¥æ ¼çš„å®‰å…¨æœºåˆ¶ä¹Ÿç»™ç¨‹åºçš„åŠŸèƒ½æ‰©å±•å¸¦æ¥éšœç¢ï¼Œæ¯”å¦‚å½“ç”¨æˆ·å¸Œæœ›è¿œç¨‹ä»£ç è®¿é—®æœ¬åœ°ç³»ç»Ÿçš„æ–‡ä»¶æ—¶å€™ï¼Œå°±æ— æ³•å®ç°ã€‚</p>
<p>å› æ­¤åœ¨åç»­çš„Java1.1ç‰ˆæœ¬ä¸­ï¼Œé’ˆå¯¹å®‰å…¨æœºåˆ¶åšäº†æ”¹è¿›ï¼Œå¢åŠ äº†<strong>å®‰å…¨ç­–ç•¥</strong>ã€‚å…è®¸ç”¨æˆ·æŒ‡å®šä»£ç å¯¹æœ¬åœ°èµ„æºçš„è®¿é—®æƒé™ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºJDK1.1å®‰å…¨æ¨¡å‹</p>
<p><img src="/2022/04/18/JVM/image-20220306223330913.png" alt="image-20220306223330913" loading="lazy"></p>
<h4 id="6-3ï¼ŒJDK1-2æ—¶æœŸ"><a href="#6-3ï¼ŒJDK1-2æ—¶æœŸ" class="headerlink" title="6.3ï¼ŒJDK1.2æ—¶æœŸ"></a>6.3ï¼ŒJDK1.2æ—¶æœŸ</h4><p>åœ¨Java1.2ç‰ˆæœ¬ä¸­ï¼Œå†æ¬¡æ”¹è¿›äº†å®‰å…¨æœºåˆ¶ï¼Œå¢åŠ äº†<strong>ä»£ç ç­¾å</strong>ã€‚ä¸è®ºæœ¬åœ°ä»£ç æˆ–æ˜¯è¿œç¨‹ä»£ç ï¼Œéƒ½ä¼šæŒ‰ç…§ç”¨æˆ·çš„å®‰å…¨ç­–ç•¥è®¾å®šï¼Œç”±ç±»åŠ è½½å™¨åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­æƒé™ä¸åŒçš„è¿è¡Œç©ºé—´ï¼Œæ¥å®ç°å·®å¼‚åŒ–çš„ä»£ç æ‰§è¡Œæƒé™æ§åˆ¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºJDK1.2å®‰å…¨æ¨¡å‹ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220306223352568.png" alt="image-20220306223352568" loading="lazy"></p>
<h4 id="6-4ï¼ŒJDK1-6æ—¶æœŸ"><a href="#6-4ï¼ŒJDK1-6æ—¶æœŸ" class="headerlink" title="6.4ï¼ŒJDK1.6æ—¶æœŸ"></a>6.4ï¼ŒJDK1.6æ—¶æœŸ</h4><p>å½“å‰æœ€æ–°çš„å®‰å…¨æœºåˆ¶å®ç°ï¼Œåˆ™å¼•å…¥äº†<strong>åŸŸï¼ˆDomainï¼‰</strong>çš„æ¦‚å¿µã€‚</p>
<p>è™šæ‹Ÿæœºä¼šæŠŠæ‰€æœ‰ä»£ç åŠ è½½åˆ°ä¸åŒçš„ç³»ç»ŸåŸŸå’Œåº”ç”¨åŸŸã€‚<strong>ç³»ç»ŸåŸŸéƒ¨åˆ†ä¸“é—¨è´Ÿè´£ä¸å…³é”®èµ„æºè¿›è¡Œäº¤äº’</strong>ï¼Œè€Œå„ä¸ªåº”ç”¨åŸŸéƒ¨åˆ†åˆ™é€šè¿‡ç³»ç»ŸåŸŸçš„éƒ¨åˆ†ä»£ç†æ¥å¯¹å„ç§éœ€è¦çš„èµ„æºè¿›è¡Œè®¿é—®ã€‚è™šæ‹Ÿæœºä¸­ä¸åŒçš„å—ä¿æŠ¤åŸŸï¼ˆProtected Domainï¼‰ï¼Œå¯¹åº”ä¸ä¸€æ ·çš„æƒé™ï¼ˆPermissionï¼‰ã€‚å­˜åœ¨äºä¸åŒåŸŸä¸­çš„ç±»æ–‡ä»¶å°±å…·æœ‰äº†å½“å‰åŸŸçš„å…¨éƒ¨æƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ€æ–°çš„å®‰å…¨æ¨¡å‹ï¼ˆjdk1.6ï¼‰</p>
<p><img src="/2022/04/18/JVM/image-20220306223509597.png" alt="image-20220306223509597" loading="lazy"></p>
<h3 id="7ï¼Œè‡ªå®šä¹‰ç±»çš„åŠ è½½å™¨"><a href="#7ï¼Œè‡ªå®šä¹‰ç±»çš„åŠ è½½å™¨" class="headerlink" title="7ï¼Œè‡ªå®šä¹‰ç±»çš„åŠ è½½å™¨"></a>7ï¼Œè‡ªå®šä¹‰ç±»çš„åŠ è½½å™¨</h3><h4 id="7-1ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ"><a href="#7-1ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ" class="headerlink" title="7.1ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ"></a>7.1ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</h4><ul>
<li><p>éš”ç¦»åŠ è½½ç±»</p>
<p>åœ¨æŸäº›æ¡†æ¶å†…è¿›è¡Œä¸­é—´ä»¶ä¸åº”ç”¨çš„æ¨¡å—éš”ç¦»ï¼ŒæŠŠç±»åŠ è½½åˆ°ä¸åŒçš„ç¯å¢ƒã€‚æ¯”å¦‚:é˜¿é‡Œå†…æŸå®¹å™¨æ¡†æ¶é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¡®ä¿åº”ç”¨ä¸­ä¾èµ–çš„jaråŒ…ä¸ä¼šå½±å“åˆ°ä¸­é—´ä»¶è¿è¡Œæ—¶ä½¿ç”¨çš„jaråŒ…ã€‚å†æ¯”å¦‚:Tomcatè¿™ç±»Webåº”ç”¨æœåŠ¡å™¨ï¼Œå†…éƒ¨è‡ªå®šä¹‰äº†å¥½å‡ ç§ç±»åŠ è½½å™¨ï¼Œç”¨äºéš”ç¦»åŒä¸€ä¸ªWebåº”ç”¨æœåŠ¡å™¨ä¸Šçš„ä¸åŒåº”ç”¨ç¨‹åºã€‚</p>
</li>
<li><p>ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼</p>
<p>ç±»çš„åŠ è½½æ¨¡å‹å¹¶éå¼ºåˆ¶ï¼Œé™¤Bootstrapå¤–ï¼Œå…¶ä»–çš„åŠ è½½å¹¶éä¸€å®šè¦å¼•å…¥ï¼Œæˆ–è€…æ ¹æ®å®é™…æƒ…å†µåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿›è¡ŒæŒ‰éœ€è¿›è¡ŒåŠ¨æ€åŠ è½½ </p>
</li>
<li><p>æ‰©å±•åŠ è½½æº</p>
<p>æ¯”å¦‚ä»æ•°æ®åº“ã€ç½‘ç»œã€ç”šè‡³æ˜¯ç”µè§†æœºæœºé¡¶ç›’è¿›è¡ŒåŠ è½½ </p>
</li>
<li><p>é˜²æ­¢ä»£ç æ³„éœ²</p>
<p>Javaä»£ç å®¹æ˜“è¢«ç¼–è¯‘å’Œç¯¡æ”¹ï¼Œå¯ä»¥è¿›è¡Œç¼–è¯‘åŠ å¯†ã€‚é‚£ä¹ˆç±»åŠ è½½ä¹Ÿéœ€è¦è‡ªå®šä¹‰ï¼Œè¿˜åŸåŠ å¯†çš„å­—èŠ‚ç ã€‚ </p>
</li>
</ul>
<p><strong>å¸¸è§çš„åœºæ™¯</strong></p>
<ul>
<li><p>å®ç°ç±»ä¼¼è¿›ç¨‹å†…éš”ç¦»ï¼Œç±»åŠ è½½å™¨å®é™…ä¸Šç”¨ä½œä¸åŒçš„å‘½åç©ºé—´ï¼Œä»¥æä¾›ç±»ä¼¼å®¹å™¨ã€æ¨¡å—åŒ–çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªæ¨¡å—ä¾èµ–äºæŸä¸ªç±»åº“çš„ä¸åŒç‰ˆæœ¬ï¼Œå¦‚æœåˆ†åˆ«è¢«ä¸åŒçš„å®¹å™¨åŠ è½½ï¼Œå°±å¯ä»¥äº’ä¸å¹²æ‰°ã€‚è¿™ä¸ªæ–¹é¢çš„é›†å¤§æˆè€…æ˜¯JavaEEå’ŒOSGIã€JPMSç­‰æ¡†æ¶ã€‚</p>
</li>
<li><p>åº”ç”¨éœ€è¦ä»ä¸åŒçš„æ•°æ®æºè·å–ç±»å®šä¹‰ä¿¡æ¯ï¼Œä¾‹å¦‚ç½‘ç»œæ•°æ®æºï¼Œè€Œä¸æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚æˆ–è€…æ˜¯éœ€è¦è‡ªå·±æ“çºµå­—èŠ‚ç ï¼ŒåŠ¨æ€ä¿®æ”¹æˆ–è€…ç”Ÿæˆç±»å‹ã€‚</p>
</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å»åŠ è½½ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œä¼šæé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¶‰åŠJavaç±»å‹è½¬æ¢ï¼Œåˆ™åŠ è½½å™¨åè€Œå®¹æ˜“äº§ç”Ÿä¸ç¾å¥½çš„äº‹æƒ…ã€‚åœ¨åšJavaç±»å‹è½¬æ¢æ—¶ï¼Œåªæœ‰ä¸¤ä¸ªç±»å‹éƒ½æ˜¯ç”±åŒä¸€ä¸ªåŠ è½½å™¨æ‰€åŠ è½½ï¼Œæ‰èƒ½è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¦åˆ™è½¬æ¢æ—¶ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p>
<h4 id="7-2ï¼Œå®ç°æ–¹å¼"><a href="#7-2ï¼Œå®ç°æ–¹å¼" class="headerlink" title="7.2ï¼Œå®ç°æ–¹å¼"></a>7.2ï¼Œå®ç°æ–¹å¼</h4><p>Javaæä¾›äº†æŠ½è±¡ç±»java.lang.ClassLoaderï¼Œæ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨éƒ½åº”è¯¥ç»§æ‰¿ClassLoaderç±»ã€‚</p>
<p>åœ¨è‡ªå®šä¹‰ClassLoaderçš„å­ç±»æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸è§çš„ä¼šæœ‰ä¸¤ç§åšæ³•:</p>
<ul>
<li>æ–¹å¼ä¸€:é‡å†™loadClass()æ–¹æ³•</li>
<li>æ–¹å¼äºŒ:é‡å†™findclass()æ–¹æ³•</li>
</ul>
<p><strong>å¯¹æ¯”</strong></p>
<ul>
<li>è¿™ä¸¤ç§æ–¹æ³•æœ¬è´¨ä¸Šå·®ä¸å¤šï¼Œæ¯•ç«ŸloadClass()ä¹Ÿä¼šè°ƒç”¨findClass()ï¼Œä½†æ˜¯ä»é€»è¾‘ä¸Šè®²æˆ‘ä»¬æœ€å¥½ä¸è¦ç›´æ¥ä¿®æ”¹loadClass()çš„å†…éƒ¨é€»è¾‘ã€‚å»ºè®®çš„åšæ³•æ˜¯åªåœ¨findClass()é‡Œé‡å†™è‡ªå®šä¹‰ç±»çš„åŠ è½½æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°æŒ‡å®šç±»çš„åå­—ï¼Œè¿”å›å¯¹åº”çš„Classå¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>loadclass()è¿™ä¸ªæ–¹æ³•æ˜¯å®ç°åŒäº²å§”æ´¾æ¨¡å‹é€»è¾‘çš„åœ°æ–¹ï¼Œæ“…è‡ªä¿®æ”¹è¿™ä¸ªæ–¹æ³•ä¼šå¯¼è‡´æ¨¡å‹è¢«ç ´åï¼Œå®¹æ˜“é€ æˆé—®é¢˜ã€‚<strong>å› æ­¤æˆ‘ä»¬æœ€å¥½æ˜¯åœ¨åŒäº²å§”æ´¾æ¨¡å‹æ¡†æ¶å†…è¿›è¡Œå°èŒƒå›´çš„æ”¹åŠ¨ï¼Œä¸ç ´ååŸæœ‰çš„ç¨³å®šç»“æ„</strong>ã€‚åŒæ—¶ï¼Œä¹Ÿé¿å…äº†è‡ªå·±é‡å†™loadClass()æ–¹æ³•çš„è¿‡ç¨‹ä¸­å¿…é¡»å†™åŒäº²å§”æ‰˜çš„é‡å¤ä»£ç ï¼Œä»ä»£ç çš„å¤ç”¨æ€§æ¥çœ‹ï¼Œä¸ç›´æ¥ä¿®æ”¹è¿™ä¸ªæ–¹æ³•å§‹ç»ˆæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</li>
<li>å½“ç¼–å†™å¥½è‡ªå®šä¹‰ç±»åŠ è½½å™¨åï¼Œä¾¿å¯ä»¥åœ¨ç¨‹åºä¸­è°ƒç”¨loadClass()æ–¹æ³•æ¥å®ç°ç±»åŠ è½½æ“ä½œã€‚</li>
</ul>
<p><strong>è¯´æ˜</strong></p>
<ul>
<li>å…¶çˆ¶ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨</li>
<li>JVMä¸­çš„æ‰€æœ‰ç±»åŠ è½½éƒ½ä¼šä½¿ç”¨java.lang.ClassLoader.loadClass(String)æ¥å£(è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¹¶é‡å†™java.lang.ClassLoader.loadClass(String)æ¥å£çš„é™¤å¤–)ï¼Œè¿JDKçš„æ ¸å¿ƒç±»åº“ä¹Ÿä¸èƒ½ä¾‹å¤–ã€‚</li>
</ul>
<p><strong>ä»£ç å®ç°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 15:20</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ClassLoader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String byteCodePath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClassLoader</span><span class="params">(String byteCodePath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.byteCodePath = byteCodePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClassLoader</span><span class="params">(ClassLoader parent, String byteCodePath)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">        <span class="built_in">this</span>.byteCodePath = byteCodePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String className) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–å­—èŠ‚ç æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> byteCodePath + className + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">            <span class="comment">//è·å–ä¸€ä¸ªè¾“å…¥æµ</span></span><br><span class="line">            bis = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fileName));</span><br><span class="line">            <span class="comment">//è·å–ä¸€ä¸ªè¾“å‡ºæµ</span></span><br><span class="line">            baos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="comment">//å…·ä½“è¯»å…¥æ•°æ®å¹¶å†™å‡ºçš„è¿‡ç¨‹</span></span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((len = bis.read(data)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                baos.write(data, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–å†…å­˜ä¸­çš„å®Œæ•´çš„å­—èŠ‚æ•°ç»„çš„æ•°æ®</span></span><br><span class="line">            <span class="type">byte</span>[] byteCodes = baos.toByteArray();</span><br><span class="line">            <span class="comment">//è°ƒç”¨defineClass()ï¼Œå°†å­—èŠ‚æ•°ç»„çš„æ•°æ®è½¬æ¢ä¸ºClassçš„å®ä¾‹ã€‚</span></span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> defineClass(<span class="literal">null</span>, byteCodes, <span class="number">0</span>, byteCodes.length);</span><br><span class="line">            <span class="keyword">return</span> clazz;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (baos != <span class="literal">null</span>) &#123;</span><br><span class="line">                    baos.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (bis != <span class="literal">null</span>) &#123;</span><br><span class="line">                    bis.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 15:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClassLoader</span>(<span class="string">&quot;d:/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> loader.loadClass(<span class="string">&quot;Demo1&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ è½½æ­¤ç±»çš„ç±»çš„åŠ è½½å™¨ä¸ºï¼š&quot;</span> + clazz.getClassLoader().getClass().getName());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ è½½å½“å‰Demo1ç±»çš„ç±»çš„åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ä¸ºï¼š&quot;</span> + clazz.getClassLoader().getParent().getClass().getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8ï¼ŒJava9æ–°ç‰¹æ€§"><a href="#8ï¼ŒJava9æ–°ç‰¹æ€§" class="headerlink" title="8ï¼ŒJava9æ–°ç‰¹æ€§"></a>8ï¼ŒJava9æ–°ç‰¹æ€§</h3><p>ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼ŒJDK9æ²¡æœ‰ä»æ ¹æœ¬ä¸Šæ”¹å˜ä¸‰å±‚ç±»åŠ è½½å™¨æ¶æ„å’ŒåŒäº²å§”æ´¾æ¨¡å‹ï¼Œä½†ä¸ºäº†æ¨¡å—åŒ–ç³»ç»Ÿçš„é¡ºåˆ©è¿è¡Œï¼Œä»ç„¶å‘ç”Ÿäº†ä¸€äº›å€¼å¾—è¢«æ³¨æ„çš„å˜åŠ¨ã€‚</p>
<ol>
<li>æ‰©å±•æœºåˆ¶è¢«ç§»é™¤ï¼Œæ‰©å±•ç±»åŠ è½½å™¨ç”±äºå‘åå…¼å®¹æ€§çš„åŸå› è¢«ä¿ç•™ï¼Œä¸è¿‡è¢«é‡å‘½åä¸ºå¹³å°ç±»åŠ è½½å™¨(platform class loader)ã€‚å¯ä»¥é€šè¿‡classLoaderçš„æ–°æ–¹æ³•getPlatformClassLoader()æ¥è·å–ã€‚<br> JDK9æ—¶åŸºäºæ¨¡å—åŒ–è¿›è¡Œæ„å»º(åŸæ¥çš„rt.jarå’Œtools.jarè¢«æ‹†åˆ†æˆæ•°åä¸ªJMODæ–‡ä»¶)ï¼Œå…¶ä¸­çš„Javaç±»åº“å°±å·²å¤©ç„¶åœ°æ»¡è¶³äº†å¯æ‰©å±•çš„éœ€æ±‚ï¼Œé‚£è‡ªç„¶æ— é¡»å†ä¿ç•™<JAVA_HOME>\lib\extç›®å½•ï¼Œæ­¤å‰ä½¿ç”¨è¿™ä¸ªç›®å½•æˆ–è€…java.ext.dirsç³»ç»Ÿå˜é‡æ¥æ‰©å±•JDKåŠŸèƒ½çš„æœºåˆ¶å·²ç»æ²¡æœ‰ç»§ç»­å­˜åœ¨çš„ä»·å€¼äº†ã€‚ </JAVA_HOME></li>
<li>å¹³å°ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨éƒ½ä¸å†ç»§æ‰¿è‡ªjava.net.URLClassLoaderã€‚<br> ç°åœ¨å¯åŠ¨ç±»åŠ è½½å™¨ã€å¹³å°ç±»åŠ è½½å™¨ã€åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å…¨éƒ½ç»§æ‰¿äºjdk.internal.loader.BuiltinClassLoaderã€‚ </li>
</ol>
<p><img src="/2022/04/18/JVM/image-20220306225506006.png" alt="image-20220306225506006" loading="lazy"></p>
<p>å¦‚æœæœ‰ç¨‹åºç›´æ¥ä¾èµ–äº†è¿™ç§ç»§æ‰¿å…³ç³»ï¼Œæˆ–è€…ä¾èµ–äº†URLClassLoaderç±»çš„ç‰¹å®šæ–¹æ³•ï¼Œé‚£ä»£ç å¾ˆå¯èƒ½ä¼šåœ¨JDK9åŠæ›´é«˜ç‰ˆæœ¬çš„JDKä¸­å´©æºƒã€‚</p>
<ol start="3">
<li>åœ¨Java9ä¸­ï¼Œç±»åŠ è½½å™¨æœ‰äº†åç§°ã€‚è¯¥åç§°åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šï¼Œå¯ä»¥é€šè¿‡getName()æ–¹æ³•æ¥è·å–ã€‚å¹³å°ç±»åŠ è½½å™¨çš„åç§°æ˜¯platformï¼Œåº”ç”¨ç±»åŠ è½½å™¨çš„åç§°æ˜¯appã€‚ç±»åŠ è½½å™¨çš„åç§°åœ¨è°ƒè¯•ä¸ç±»åŠ è½½å™¨ç›¸å…³çš„é—®é¢˜æ—¶ä¼šéå¸¸æœ‰ç”¨ã€‚</li>
<li>å¯åŠ¨ç±»åŠ è½½å™¨ç°åœ¨æ˜¯åœ¨jvmå†…éƒ¨å’Œjavaç±»åº“å…±åŒåä½œå®ç°çš„ç±»åŠ è½½å™¨ï¼ˆä»¥å‰æ˜¯C++å®ç°ï¼‰ï¼Œä½†ä¸ºäº†ä¸ä¹‹å‰ä»£ç å…¼å®¹ï¼Œåœ¨è·å–å¯åŠ¨ç±»åŠ è½½å™¨çš„åœºæ™¯ä¸­ä»ç„¶ä¼šè¿”å›nullï¼Œè€Œä¸ä¼šå¾—åˆ°BootClassLoaderå®ä¾‹ã€‚</li>
<li>ç±»åŠ è½½çš„å§”æ´¾å…³ç³»ä¹Ÿå‘ç”Ÿäº†å˜åŠ¨ã€‚å½“å¹³å°åŠåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œè¦å…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚</li>
</ol>
<p><img src="/2022/04/18/JVM/image-20220306225650298.png" alt="image-20220306225650298" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220306230336464.png" alt="image-20220306230336464" loading="lazy"></p>
<p><strong>ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassLoaderTest.class.getClassLoader());</span><br><span class="line">        System.out.println(ClassLoaderTest.class.getClassLoader().getParent());</span><br><span class="line">        System.out.println(ClassLoaderTest.class.getClassLoader().getParent().getParent());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ç³»ç»Ÿç±»åŠ è½½å™¨</span></span><br><span class="line">        System.out.println(ClassLoader.getSystemClassLoader());</span><br><span class="line">        <span class="comment">//è·å–å¹³å°ç±»åŠ è½½å™¨</span></span><br><span class="line">        System.out.println(ClassLoader.getPlatformClassLoader());</span><br><span class="line">        <span class="comment">//è·å–ç±»çš„åŠ è½½å™¨çš„åç§°</span></span><br><span class="line">        System.out.println(ClassLoaderTest.class.getClassLoader().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜"><a href="#æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜" class="headerlink" title="æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜"></a>æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜</h1><h2 id="ä¸€ï¼Œæ¦‚è¿°ç¯‡"><a href="#ä¸€ï¼Œæ¦‚è¿°ç¯‡" class="headerlink" title="ä¸€ï¼Œæ¦‚è¿°ç¯‡"></a>ä¸€ï¼Œæ¦‚è¿°ç¯‡</h2><h3 id="1ï¼Œå¤§å‚é¢è¯•é¢˜"><a href="#1ï¼Œå¤§å‚é¢è¯•é¢˜" class="headerlink" title="1ï¼Œå¤§å‚é¢è¯•é¢˜"></a>1ï¼Œå¤§å‚é¢è¯•é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">æ”¯ä»˜å®ï¼š</span><br><span class="line"> </span><br><span class="line">æ”¯ä»˜å®ä¸‰é¢ï¼šJVMæ€§èƒ½è°ƒä¼˜éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</span><br><span class="line"> </span><br><span class="line">å°ç±³ï¼š</span><br><span class="line"> </span><br><span class="line">æœ‰åšè¿‡JVMå†…å­˜ä¼˜åŒ–å—ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">ä»SQLã€JVMã€æ¶æ„ã€æ•°æ®åº“å››ä¸ªæ–¹é¢è®²è®²ä¼˜åŒ–æ€è·¯</span><br><span class="line"> </span><br><span class="line">èš‚èšé‡‘æœï¼š</span><br><span class="line"> </span><br><span class="line">JVMçš„ç¼–è¯‘ä¼˜åŒ–</span><br><span class="line"> </span><br><span class="line">jvmæ€§èƒ½è°ƒä¼˜éƒ½åšäº†ä»€ä¹ˆ</span><br><span class="line"> </span><br><span class="line">JVMè¯Šæ–­è°ƒä¼˜å·¥å…·ç”¨è¿‡å“ªäº›ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">äºŒé¢ï¼šjvmæ€æ ·è°ƒä¼˜ï¼Œå †å†…å­˜ã€æ ˆç©ºé—´è®¾ç½®å¤šå°‘åˆé€‚</span><br><span class="line"> </span><br><span class="line">ä¸‰é¢ï¼šJVMç›¸å…³çš„åˆ†æå·¥å…·ä½¿ç”¨è¿‡çš„æœ‰å“ªäº›ï¼Ÿå…·ä½“çš„æ€§èƒ½è°ƒä¼˜æ­¥éª¤å¦‚ä½•</span><br><span class="line"> </span><br><span class="line">é˜¿é‡Œï¼š</span><br><span class="line"> </span><br><span class="line">å¦‚ä½•è¿›è¡ŒJVMè°ƒä¼˜ï¼Ÿæœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">å¦‚ä½•ç†è§£å†…å­˜æ³„æ¼é—®é¢˜ï¼Ÿæœ‰å“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">å­—èŠ‚è·³åŠ¨ï¼š</span><br><span class="line"> </span><br><span class="line">ä¸‰é¢ï¼šJVMå¦‚ä½•è°ƒä¼˜ã€å‚æ•°æ€ä¹ˆè°ƒï¼Ÿ</span><br><span class="line"> </span><br><span class="line">æ‹¼å¤šå¤šï¼š</span><br><span class="line"> </span><br><span class="line">ä»SQLã€JVMã€æ¶æ„ã€æ•°æ®åº“å››ä¸ªæ–¹é¢è®²è®²ä¼˜åŒ–æ€è·¯</span><br><span class="line"> </span><br><span class="line">äº¬ä¸œï¼š</span><br><span class="line"> </span><br><span class="line">JVMè¯Šæ–­è°ƒä¼˜å·¥å…·ç”¨è¿‡å“ªäº›ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">æ¯ç§’å‡ åä¸‡å¹¶å‘çš„ç§’æ€ç³»ç»Ÿä¸ºä»€ä¹ˆä¼šé¢‘ç¹å‘ç”ŸGCï¼Ÿ</span><br><span class="line"> </span><br><span class="line">æ—¥å‡ç™¾ä¸‡çº§äº¤æ˜“ç³»ç»Ÿå¦‚ä½•ä¼˜åŒ–JVMï¼Ÿ</span><br><span class="line"> </span><br><span class="line">çº¿ä¸Šç”Ÿäº§ç³»ç»ŸOOMå¦‚ä½•ç›‘æ§åŠå®šä½ä¸è§£å†³ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">é«˜å¹¶å‘ç³»ç»Ÿå¦‚ä½•åŸºäºG1åƒåœ¾å›æ”¶å™¨ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼ŒèƒŒæ™¯è¯´æ˜"><a href="#2ï¼ŒèƒŒæ™¯è¯´æ˜" class="headerlink" title="2ï¼ŒèƒŒæ™¯è¯´æ˜"></a>2ï¼ŒèƒŒæ™¯è¯´æ˜</h3><p><strong>ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜</strong></p>
<ul>
<li><p>ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å†…å­˜æº¢å‡ºè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
</li>
<li><p>ç”Ÿäº§ç¯å¢ƒåº”è¯¥ç»™æœåŠ¡å™¨åˆ†é…å¤šå°‘å†…å­˜åˆé€‚ï¼Ÿ</p>
</li>
<li><p>å¦‚ä½•å¯¹åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½è¿›è¡Œè°ƒä¼˜ï¼Ÿ</p>
</li>
<li><p>ç”Ÿäº§ç¯å¢ƒCPUè´Ÿè½½é£™é«˜è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
</li>
<li><p>ç”Ÿäº§ç¯å¢ƒåº”è¯¥ç»™åº”ç”¨åˆ†é…å¤šå°‘çº¿ç¨‹åˆé€‚ï¼Ÿ</p>
</li>
<li><p>ä¸åŠ logï¼Œå¦‚ä½•ç¡®å®šè¯·æ±‚æ˜¯å¦æ‰§è¡Œäº†æŸä¸€è¡Œä»£ç ï¼Ÿ</p>
</li>
<li><p>ä¸åŠ logï¼Œå¦‚ä½•å®æ—¶æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„å…¥å‚ä¸è¿”å›å€¼ï¼Ÿ</p>
</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¦è°ƒä¼˜</strong></p>
<ul>
<li><p>é˜²æ­¢å‡ºç°OOM</p>
</li>
<li><p>è§£å†³OOM</p>
</li>
<li><p>å‡å°‘Full GCå‡ºç°çš„é¢‘ç‡</p>
</li>
</ul>
<p><strong>ä¸åŒé˜¶æ®µçš„è€ƒè™‘</strong></p>
<ul>
<li><p>ä¸Šçº¿å‰</p>
</li>
<li><p>é¡¹ç›®è¿è¡Œé˜¶æ®µ</p>
</li>
<li><p>çº¿ä¸Šå‡ºç°OOM</p>
</li>
</ul>
<h3 id="3ï¼Œè°ƒä¼˜æ¦‚è¿°"><a href="#3ï¼Œè°ƒä¼˜æ¦‚è¿°" class="headerlink" title="3ï¼Œè°ƒä¼˜æ¦‚è¿°"></a>3ï¼Œè°ƒä¼˜æ¦‚è¿°</h3><p><strong>ç›‘æ§çš„ä¾æ®</strong></p>
<ul>
<li><p>è¿è¡Œæ—¥å¿—</p>
</li>
<li><p>å¼‚å¸¸å †æ ˆ</p>
</li>
<li><p>GCæ—¥å¿—</p>
</li>
<li><p>çº¿ç¨‹å¿«ç…§</p>
</li>
<li><p>å †è½¬å‚¨å¿«ç…§</p>
</li>
</ul>
<p><strong>è°ƒä¼˜çš„å¤§æ–¹å‘</strong></p>
<ul>
<li><p>åˆç†åœ°ç¼–å†™ä»£ç </p>
</li>
<li><p>å……åˆ†å¹¶åˆç†çš„ä½¿ç”¨ç¡¬ä»¶èµ„æº</p>
</li>
<li><p>åˆç†åœ°è¿›è¡ŒJVMè°ƒä¼˜</p>
</li>
</ul>
<h3 id="4ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰"><a href="#4ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="4ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰"></a>4ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤ï¼ˆé‡ç‚¹ï¼‰</h3><p><strong>ç¬¬1æ­¥ï¼šæ€§èƒ½ç›‘æ§</strong></p>
<ul>
<li><p>GCé¢‘ç¹</p>
</li>
<li><p>cpu loadè¿‡é«˜</p>
</li>
<li><p>OOM</p>
</li>
<li><p>å†…å­˜æ³„éœ²</p>
</li>
<li><p>æ­»é”</p>
</li>
<li><p>ç¨‹åºå“åº”æ—¶é—´è¾ƒé•¿</p>
</li>
</ul>
<p><strong>ç¬¬2æ­¥ï¼šæ€§èƒ½åˆ†æ</strong></p>
<ul>
<li><p>æ‰“å°GCæ—¥å¿—ï¼Œé€šè¿‡GCvieweræˆ–è€… <a target="_blank" rel="noopener" href="http://gceasy.io/">http://gceasy.io</a> æ¥åˆ†æå¼‚å¸¸ä¿¡æ¯</p>
</li>
<li><p>çµæ´»è¿ç”¨å‘½ä»¤è¡Œå·¥å…·ã€jstackã€jmapã€jinfoç­‰</p>
</li>
<li><p>dumpå‡ºå †æ–‡ä»¶ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…·åˆ†ææ–‡ä»¶</p>
</li>
<li><p>ä½¿ç”¨é˜¿é‡ŒArthasã€jconsoleã€JVisualVMæ¥å®æ—¶æŸ¥çœ‹JVMçŠ¶æ€</p>
</li>
<li><p>jstackæŸ¥çœ‹å †æ ˆä¿¡æ¯</p>
</li>
</ul>
<p><strong>ç¬¬3æ­¥ï¼šæ€§èƒ½è°ƒä¼˜</strong></p>
<ul>
<li><p>é€‚å½“å¢åŠ å†…å­˜ï¼Œæ ¹æ®ä¸šåŠ¡èƒŒæ™¯é€‰æ‹©åƒåœ¾å›æ”¶å™¨</p>
</li>
<li><p>ä¼˜åŒ–ä»£ç ï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨</p>
</li>
<li><p>å¢åŠ æœºå™¨ï¼Œåˆ†æ•£èŠ‚ç‚¹å‹åŠ›</p>
</li>
<li><p>åˆç†è®¾ç½®çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡</p>
</li>
<li><p>ä½¿ç”¨ä¸­é—´ä»¶æé«˜ç¨‹åºæ•ˆç‡ï¼Œæ¯”å¦‚ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰</p>
</li>
<li><p>å…¶ä»–â€¦â€¦</p>
</li>
</ul>
<h3 id="5ï¼Œæ€§èƒ½è¯„ä»·-æµ‹è¯•æŒ‡æ ‡"><a href="#5ï¼Œæ€§èƒ½è¯„ä»·-æµ‹è¯•æŒ‡æ ‡" class="headerlink" title="5ï¼Œæ€§èƒ½è¯„ä»·/æµ‹è¯•æŒ‡æ ‡"></a>5ï¼Œæ€§èƒ½è¯„ä»·/æµ‹è¯•æŒ‡æ ‡</h3><p><strong>åœé¡¿æ—¶é—´ï¼ˆæˆ–å“åº”æ—¶é—´ï¼‰</strong></p>
<p>æäº¤è¯·æ±‚å’Œè¿”å›è¯¥è¯·æ±‚çš„å“åº”ä¹‹é—´ä½¿ç”¨çš„æ—¶é—´ï¼Œä¸€èˆ¬æ¯”è¾ƒå…³æ³¨å¹³å‡å“åº”æ—¶é—´ã€‚å¸¸ç”¨æ“ä½œçš„å“åº”æ—¶é—´åˆ—è¡¨ï¼š</p>
<p><img src="/2022/04/18/JVM/image-20220309174131120.png" alt="image-20220309174131120" loading="lazy"></p>
<p>åœ¨åƒåœ¾å›æ”¶ç¯èŠ‚ä¸­ï¼š</p>
<ul>
<li><p>æš‚åœæ—¶é—´ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚</p>
</li>
<li><p>-XX:MaxGCPauseMillis</p>
</li>
</ul>
<p><strong>ååé‡</strong></p>
<ul>
<li><p>å¯¹å•ä½æ—¶é—´å†…å®Œæˆçš„å·¥ä½œé‡ï¼ˆè¯·æ±‚ï¼‰çš„é‡åº¦</p>
</li>
<li><p>åœ¨GCä¸­ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„äº‹ä»¶å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ï¼ˆæ€»è¿è¡Œæ—¶é—´ï¼šç¨‹åºçš„è¿è¡Œæ—¶é—´+å†…å­˜å›æ”¶çš„æ—¶é—´ï¼‰</p>
</li>
<li><p>ååé‡ä¸º1-1/(1+n)ï¼Œå…¶ä¸­-XX::GCTimeRatio=n</p>
</li>
</ul>
<p><strong>å¹¶å‘æ•°</strong></p>
<ul>
<li>åŒä¸€æ—¶åˆ»ï¼Œå¯¹æœåŠ¡å™¨æœ‰å®é™…äº¤äº’çš„è¯·æ±‚æ•°</li>
</ul>
<p><strong>å†…å­˜å ç”¨</strong></p>
<ul>
<li>Javaå †åŒºæ‰€å çš„å†…å­˜å¤§å°</li>
</ul>
<p><strong>ç›¸äº’é—´çš„å…³ç³»</strong></p>
<p>ä»¥é«˜é€Ÿå…¬è·¯é€šè¡ŒçŠ¶å†µä¸ºä¾‹</p>
<ul>
<li><p>ååé‡ï¼šæ¯å¤©é€šè¿‡é«˜é€Ÿå…¬è·¯æ”¶è´¹ç«™çš„è½¦è¾†çš„æ•°æ®</p>
</li>
<li><p>å¹¶å‘æ•°ï¼šé«˜é€Ÿå…¬è·¯ä¸Šæ­£åœ¨è¡Œé©¶çš„è½¦è¾†çš„æ•°ç›®</p>
</li>
<li><p>å“åº”æ—¶é—´ï¼šè½¦é€Ÿ</p>
</li>
</ul>
<h2 id="äºŒï¼ŒJVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡"><a href="#äºŒï¼ŒJVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡" class="headerlink" title="äºŒï¼ŒJVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡"></a>äºŒï¼ŒJVMç›‘æ§åŠè¯Šæ–­å·¥å…·-å‘½ä»¤è¡Œç¯‡</h2><h3 id="1ï¼Œæ¦‚è¿°-3"><a href="#1ï¼Œæ¦‚è¿°-3" class="headerlink" title="1ï¼Œæ¦‚è¿°"></a>1ï¼Œæ¦‚è¿°</h3><p>æ€§èƒ½è¯Šæ–­æ˜¯è½¯ä»¶å·¥ç¨‹å¸ˆåœ¨æ—¥å¸¸å·¥ä½œä¸­éœ€è¦ç»å¸¸é¢å¯¹å’Œè§£å†³çš„é—®é¢˜ï¼Œåœ¨ç”¨æˆ·ä½“éªŒè‡³ä¸Šçš„ä»Šå¤©ï¼Œè§£å†³å¥½åº”ç”¨çš„æ€§èƒ½é—®é¢˜èƒ½å¸¦æ¥éå¸¸å¤§çš„æ”¶ç›Šã€‚</p>
<p>Java ä½œä¸ºæœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œå…¶åº”ç”¨æ€§èƒ½è¯Šæ–­ä¸€ç›´å—åˆ°ä¸šç•Œå¹¿æ³›å…³æ³¨ã€‚å¯èƒ½é€ æˆ Java åº”ç”¨å‡ºç°æ€§èƒ½é—®é¢˜çš„å› ç´ éå¸¸å¤šï¼Œä¾‹å¦‚çº¿ç¨‹æ§åˆ¶ã€ç£ç›˜è¯»å†™ã€æ•°æ®åº“è®¿é—®ã€ç½‘ç»œI/Oã€åƒåœ¾æ”¶é›†ç­‰ã€‚æƒ³è¦å®šä½è¿™äº›é—®é¢˜ï¼Œä¸€æ¬¾ä¼˜ç§€çš„æ€§èƒ½è¯Šæ–­å·¥å…·å¿…ä¸å¯å°‘ã€‚</p>
<p>ä½“ä¼š1ï¼š<strong>ä½¿ç”¨æ•°æ®è¯´æ˜é—®é¢˜ï¼Œä½¿ç”¨çŸ¥è¯†åˆ†æé—®é¢˜ï¼Œä½¿ç”¨å·¥å…·å¤„ç†é—®é¢˜ã€‚</strong></p>
<p>ä½“ä¼š2ï¼š<strong>æ— ç›‘æ§ã€ä¸è°ƒä¼˜ï¼</strong></p>
<p><strong>ç®€å•å‘½ä»¤è¡Œå·¥å…·</strong></p>
<p>åœ¨æˆ‘ä»¬åˆšæ¥è§¦javaå­¦ä¹ çš„æ—¶å€™ï¼Œå¤§å®¶è‚¯å®šæœ€å…ˆäº†è§£çš„ä¸¤ä¸ªå‘½ä»¤å°±æ˜¯javacï¼Œjavaï¼Œé‚£ä¹ˆé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å‘½ä»¤å¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿›å…¥åˆ°å®‰è£…jdkçš„binç›®å½•ï¼Œå‘ç°è¿˜æœ‰ä¸€ç³»åˆ—è¾…åŠ©å·¥å…·ã€‚è¿™äº›è¾…åŠ©å·¥å…·ç”¨æ¥è·å–ç›®æ ‡ JVM ä¸åŒæ–¹é¢ã€ä¸åŒå±‚æ¬¡çš„ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¾ˆå¥½åœ°è§£å†³Javaåº”ç”¨ç¨‹åºçš„ä¸€äº›ç–‘éš¾æ‚ç—‡</p>
<p><img src="/2022/04/18/JVM/image-20220310152722836.png" alt="image-20220310152722836" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/image-20220310152734479.png" alt="image-20220310152734479" loading="lazy"></p>
<p>å®˜æ–¹æºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk/jdk11/file/1ddf9a99e4ad/src/jdk.jcmd/share/classes/sun/tools">http://hg.openjdk.java.net/jdk/jdk11/file/1ddf9a99e4ad/src/jdk.jcmd/share/classes/sun/tools</a></p>
<h3 id="2ï¼Œjpsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹"><a href="#2ï¼Œjpsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹" class="headerlink" title="2ï¼Œjpsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹"></a>2ï¼Œjpsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹</h3><p>jps(Java Process Status)ï¼šæ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ï¼ˆæŸ¥çœ‹è™šæ‹Ÿæœºè¿›ç¨‹ä¿¡æ¯ï¼‰ï¼Œ<strong>å¯ç”¨äºæŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹</strong>ã€‚</p>
<p>è¯´æ˜ï¼šå¯¹äºæœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹æ¥è¯´ï¼Œè¿›ç¨‹çš„æœ¬åœ°è™šæ‹ŸæœºIDä¸æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹IDæ˜¯ä¸€è‡´çš„ï¼Œæ˜¯å”¯ä¸€çš„ã€‚</p>
<p>åŸºæœ¬ä½¿ç”¨è¯­æ³•ä¸ºï¼šjps [options] [hostid]</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è¿½åŠ å‚æ•°ï¼Œæ¥æ‰“å°é¢å¤–çš„ä¿¡æ¯ã€‚</p>
<p><strong>optionså‚æ•°</strong></p>
<ul>
<li><p>-qï¼šä»…ä»…æ˜¾ç¤ºLVMIDï¼ˆlocal virtual machine idï¼‰ï¼Œå³æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€idã€‚ä¸æ˜¾ç¤ºä¸»ç±»çš„åç§°ç­‰</p>
</li>
<li><p>-lï¼šè¾“å‡ºåº”ç”¨ç¨‹åºä¸»ç±»çš„å…¨ç±»å æˆ– å¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯jaråŒ…ï¼Œåˆ™è¾“å‡ºjarå®Œæ•´è·¯å¾„</p>
</li>
<li><p>-mï¼šè¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main()çš„å‚æ•°</p>
</li>
<li><p>-vï¼šåˆ—å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶çš„JVMå‚æ•°ã€‚æ¯”å¦‚ï¼š-Xms20m -Xmx50mæ˜¯å¯åŠ¨ç¨‹åºæŒ‡å®šçš„jvmå‚æ•°ã€‚</p>
</li>
</ul>
<p>è¯´æ˜ï¼šä»¥ä¸Šå‚æ•°å¯ä»¥ç»¼åˆä½¿ç”¨ã€‚</p>
<p>è¡¥å……ï¼šå¦‚æœæŸ Java è¿›ç¨‹å…³é—­äº†é»˜è®¤å¼€å¯çš„UsePerfDataå‚æ•°ï¼ˆå³ä½¿ç”¨å‚æ•°-XXï¼š-UsePerfDataï¼‰ï¼Œé‚£ä¹ˆjpså‘½ä»¤ï¼ˆä»¥åŠä¸‹é¢ä»‹ç»çš„jstatï¼‰å°†æ— æ³•æ¢çŸ¥è¯¥Java è¿›ç¨‹ã€‚</p>
<p><strong>hostidå‚æ•°</strong></p>
<p>RMIæ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„ä¸»æœºåã€‚å¦‚æœæƒ³è¦è¿œç¨‹ç›‘æ§ä¸»æœºä¸Šçš„ java ç¨‹åºï¼Œéœ€è¦å®‰è£… jstatdã€‚</p>
<p>å¯¹äºå…·æœ‰æ›´ä¸¥æ ¼çš„å®‰å…¨å®è·µçš„ç½‘ç»œåœºæ‰€è€Œè¨€ï¼Œå¯èƒ½ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ç­–ç•¥æ–‡ä»¶æ¥æ˜¾ç¤ºå¯¹ç‰¹å®šçš„å¯ä¿¡ä¸»æœºæˆ–ç½‘ç»œçš„è®¿é—®ï¼Œå°½ç®¡è¿™ç§æŠ€æœ¯å®¹æ˜“å—åˆ°IPåœ°å€æ¬ºè¯ˆæ”»å‡»ã€‚</p>
<p>å¦‚æœå®‰å…¨é—®é¢˜æ— æ³•ä½¿ç”¨ä¸€ä¸ªå®šåˆ¶çš„ç­–ç•¥æ–‡ä»¶æ¥å¤„ç†ï¼Œé‚£ä¹ˆæœ€å®‰å…¨çš„æ“ä½œæ˜¯ä¸è¿è¡ŒjstatdæœåŠ¡å™¨ï¼Œè€Œæ˜¯åœ¨æœ¬åœ°ä½¿ç”¨jstatå’Œjpså·¥å…·ã€‚</p>
<h3 id="3ï¼Œjstatï¼šæŸ¥çœ‹JVMç»Ÿè®¡ä¿¡æ¯"><a href="#3ï¼Œjstatï¼šæŸ¥çœ‹JVMç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="3ï¼Œjstatï¼šæŸ¥çœ‹JVMç»Ÿè®¡ä¿¡æ¯"></a>3ï¼Œjstatï¼šæŸ¥çœ‹JVMç»Ÿè®¡ä¿¡æ¯</h3><p>jstatï¼ˆJVM Statistics Monitoring Toolï¼‰ï¼š<strong>ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·</strong>ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚åœ¨æ²¡æœ‰GUIå›¾å½¢ç•Œé¢ï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚<strong>å¸¸ç”¨äºæ£€æµ‹åƒåœ¾å›æ”¶é—®é¢˜ä»¥åŠå†…å­˜æ³„æ¼é—®é¢˜ã€‚</strong></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html</a></p>
<p>åŸºæœ¬ä½¿ç”¨è¯­æ³•ä¸ºï¼šjstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]</count></interval></vmid></lines></option></p>
<p><strong>intervalå‚æ•°ï¼š</strong> ç”¨äºæŒ‡å®šè¾“å‡ºç»Ÿè®¡æ•°æ®çš„å‘¨æœŸï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚å³ï¼šæŸ¥è¯¢é—´éš”</p>
<p><img src="/2022/04/18/JVM/image-20220310154212495.png" alt="image-20220310154212495" loading="lazy"></p>
<p><strong>countå‚æ•°ï¼š</strong> ç”¨äºæŒ‡å®šæŸ¥è¯¢çš„æ€»æ¬¡æ•°</p>
<p><img src="/2022/04/18/JVM/image-20220310154233987.png" alt="image-20220310154233987" loading="lazy"></p>
<p><strong>-tå‚æ•°ï¼š</strong> å¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯å‰åŠ ä¸Šä¸€ä¸ªTimestampåˆ—ï¼Œæ˜¾ç¤ºç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚å•ä½ï¼šç§’</p>
<p><img src="/2022/04/18/JVM/image-20220310154300163.png" alt="image-20220310154300163" loading="lazy"></p>
<p><strong>-hå‚æ•°ï¼š</strong> å¯ä»¥åœ¨å‘¨æœŸæ€§æ•°æ®è¾“å‡ºæ—¶ï¼Œè¾“å‡ºå¤šå°‘è¡Œæ•°æ®åè¾“å‡ºä¸€ä¸ªè¡¨å¤´ä¿¡æ¯</p>
<p><img src="/2022/04/18/JVM/image-20220310154313555.png" alt="image-20220310154313555" loading="lazy"></p>
<p><strong>optionå‚æ•°</strong></p>
<p>é€‰é¡¹optionå¯ä»¥ç”±ä»¥ä¸‹å€¼æ„æˆã€‚</p>
<p>ç±»è£…è½½ç›¸å…³çš„ï¼š</p>
<ul>
<li>-classï¼šæ˜¾ç¤ºClassLoaderçš„ç›¸å…³ä¿¡æ¯ï¼šç±»çš„è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ã€ç±»è£…è½½æ‰€æ¶ˆè€—çš„æ—¶é—´ç­‰</li>
</ul>
<p>åƒåœ¾å›æ”¶ç›¸å…³çš„ï¼š</p>
<ul>
<li><p>-gcï¼šæ˜¾ç¤ºä¸GCç›¸å…³çš„å †ä¿¡æ¯ã€‚åŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li><p>-gccapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</p>
</li>
<li><p>-gcutilï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ã€‚</p>
</li>
<li><p>-gccauseï¼šä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´æœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„GCäº§ç”Ÿçš„åŸå› ã€‚</p>
</li>
<li><p>-gcnewï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£GCçŠ¶å†µ</p>
</li>
<li><p>-gcnewcapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</p>
</li>
<li><p>-geoldï¼šæ˜¾ç¤ºè€å¹´ä»£GCçŠ¶å†µ</p>
</li>
<li><p>-gcoldcapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</p>
</li>
<li><p>-gcpermcapacityï¼šæ˜¾ç¤ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</p>
</li>
</ul>
<p>JITç›¸å…³çš„ï¼š</p>
<ul>
<li><p>-compilerï¼šæ˜¾ç¤ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯</p>
</li>
<li><p>-printcompilationï¼šè¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•</p>
</li>
</ul>
<blockquote>
<p>è£…è½½ç±»ç›¸å…³</p>
</blockquote>
<p><strong>jstat -classï¼šæ˜¾ç¤ºClassLoaderçš„ç›¸å…³ä¿¡æ¯ï¼šç±»çš„è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ã€ç±»è£…è½½æ‰€æ¶ˆè€—çš„æ—¶é—´ç­‰</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310154455916.png" alt="image-20220310154455916" loading="lazy"></p>
<blockquote>
<p>JITç›¸å…³</p>
</blockquote>
<p><strong>jstat -compilerï¼šæ˜¾ç¤ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310154832855.png" alt="image-20220310154832855" loading="lazy"></p>
<p><strong>jstat -printcompilationï¼šè¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310154847531.png" alt="image-20220310154847531" loading="lazy"></p>
<blockquote>
<p>åƒåœ¾å›æ”¶ç›¸å…³</p>
</blockquote>
<p><strong>jstat -gcï¼šæ˜¾ç¤ºä¸GCç›¸å…³çš„å †ä¿¡æ¯ã€‚åŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310161532424.png" alt="image-20220310161532424" loading="lazy"></p>
<p><strong>jstat -gccapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310161906341.png" alt="image-20220310161906341" loading="lazy"></p>
<p><strong>jstat -gcutilï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310161604595.png" alt="image-20220310161604595" loading="lazy"></p>
<p><strong>jstat -gccauseï¼šä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´æœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„GCäº§ç”Ÿçš„åŸå› ã€‚</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162056547.png" alt="image-20220310162056547" loading="lazy"></p>
<p><strong>jstat -gcnewï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£GCçŠ¶å†µ</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162129023.png" alt="image-20220310162129023" loading="lazy"></p>
<p><strong>jstat -gcnewcapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162239498.png" alt="image-20220310162239498" loading="lazy"></p>
<p><strong>jstat -gcoldï¼šæ˜¾ç¤ºè€å¹´ä»£GCçŠ¶å†µ</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162255366.png" alt="image-20220310162255366" loading="lazy"></p>
<p><strong>jstat -gcoldcapacityï¼šæ˜¾ç¤ºå†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162354591.png" alt="image-20220310162354591" loading="lazy"></p>
<p><strong>jstat -t</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162313378.png" alt="image-20220310162313378" loading="lazy"></p>
<p><strong>jstat -t -h</strong></p>
<p><img src="/2022/04/18/JVM/image-20220310162327955.png" alt="image-20220310162327955" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/QQ%E6%88%AA%E5%9B%BE20220310162733.png" alt="QQæˆªå›¾20220310162733" loading="lazy"></p>
<p><strong>å…³äº-tçš„ç»éªŒ</strong></p>
<p>æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒJavaè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ä»¥åŠæ€»GCæ—¶é—´ï¼ˆGCTåˆ—ï¼‰ï¼Œæˆ–è€…ä¸¤æ¬¡æµ‹é‡çš„æ—¶é—´é—´éš”ä»¥åŠæ€»GCæ—¶é—´çš„å¢é‡ï¼Œæ¥å¾—åˆ°GCæ—¶é—´å è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€‚</p>
<p>å¦‚æœè¯¥æ¯”ä¾‹è¶…è¿‡20%ï¼Œåˆ™è¯´æ˜ç›®å‰å †çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œè¦æ˜¯è¶…è¶Š90%ï¼Œåˆ™è¯´æ˜å †é‡Œå‡ ä¹æ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œéšæ—¶éƒ½å¯èƒ½æŠ›å‡ºOOMå¼‚å¸¸ã€‚</p>
<p><strong>è¡¥å……ï¼š</strong> jstatè¿˜å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦å‡ºç°å†…å­˜æ³„æ¼ã€‚</p>
<p>ç¬¬1æ­¥ï¼šåœ¨é•¿æ—¶é—´è¿è¡Œçš„ Java ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œjstatå‘½ä»¤è¿ç»­è·å–å¤šè¡Œæ€§èƒ½æ•°æ®ï¼Œå¹¶å–è¿™å‡ è¡Œæ•°æ®ä¸­ OU åˆ—ï¼ˆå³å·²å ç”¨çš„è€å¹´ä»£å†…å­˜ï¼‰çš„æœ€å°å€¼ã€‚</p>
<p>ç¬¬2æ­¥ï¼šç„¶åï¼Œæˆ‘ä»¬æ¯éš”ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´é‡å¤ä¸€æ¬¡ä¸Šè¿°æ“ä½œï¼Œæ¥è·å¾—å¤šç»„ OU æœ€å°å€¼ã€‚å¦‚æœè¿™äº›å€¼å‘ˆä¸Šæ¶¨è¶‹åŠ¿ï¼Œåˆ™è¯´æ˜è¯¥ Java ç¨‹åºçš„è€å¹´ä»£å†…å­˜å·²ä½¿ç”¨é‡åœ¨ä¸æ–­ä¸Šæ¶¨ï¼Œè¿™æ„å‘³ç€æ— æ³•å›æ”¶çš„å¯¹è±¡åœ¨ä¸æ–­å¢åŠ ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</p>
<h3 id="4ï¼Œjinfoï¼šå®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹JVMé…ç½®å‚æ•°"><a href="#4ï¼Œjinfoï¼šå®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹JVMé…ç½®å‚æ•°" class="headerlink" title="4ï¼Œjinfoï¼šå®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹JVMé…ç½®å‚æ•°"></a>4ï¼Œjinfoï¼šå®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹JVMé…ç½®å‚æ•°</h3><p>jinfo(Configuration Info for Java)ï¼šæŸ¥çœ‹è™šæ‹Ÿæœºé…ç½®å‚æ•°ä¿¡æ¯ï¼Œä¹Ÿå¯ç”¨äºè°ƒæ•´è™šæ‹Ÿæœºçš„é…ç½®å‚æ•°ã€‚åœ¨å¾ˆå¤šæƒ…å†µå¡ï¼ŒJavaåº”ç”¨ç¨‹åºä¸ä¼šæŒ‡å®šæ‰€æœ‰çš„Javaè™šæ‹Ÿæœºå‚æ•°ã€‚è€Œæ­¤æ—¶ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸çŸ¥é“æŸä¸€ä¸ªå…·ä½“çš„Javaè™šæ‹Ÿæœºå‚æ•°çš„é»˜è®¤å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é€šè¿‡æŸ¥æ‰¾æ–‡æ¡£è·å–æŸä¸ªå‚æ•°çš„é»˜è®¤å€¼ã€‚è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å¯èƒ½æ˜¯éå¸¸è‰°éš¾çš„ã€‚ä½†æœ‰äº†jinfoå·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰¾åˆ°Javaè™šæ‹Ÿæœºå‚æ•°çš„å½“å‰å€¼ã€‚</p>
<p>åŸºæœ¬ä½¿ç”¨è¯­æ³•ä¸ºï¼šjinfo [options] pid</p>
<p>è¯´æ˜ï¼šjava è¿›ç¨‹IDå¿…é¡»è¦åŠ ä¸Š</p>
<p><img src="/2022/04/18/JVM/1647071253080.png" alt="1647071253080" loading="lazy"></p>
<p><strong>jinfo -sysprops</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -sysprops</span></span><br><span class="line">jboss.modules.system.pkgs = com.intellij.rt</span><br><span class="line">java.vendor = Oracle Corporation</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">catalina.useNaming = true</span><br><span class="line">os.name = Windows 10</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>jinfo -flags</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flags 25592</span></span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=4 -XX:InitialHeapSize=333447168 -XX:MaxHeapSize=5324668928 -XX:MaxNewSize=1774714880 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=111149056 -XX:OldSize=222298112 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC</span><br><span class="line">Command line:  -agentlib:jdwp=transport=dt_socket,address=127.0.0.1:8040,suspend=y,server=n -Drebel.base=C:\Users\Vector\.jrebel -Drebel.env.ide.plugin.version=2021.1.2 -Drebel.env.ide.version=2020.3.3 -Drebel.env.ide.product=IU -Drebel.env.ide=intellij -Drebel.notification.url=http://localhost:7976 -agentpath:C:\Users\Vector\AppData\Roaming\JetBrains\IntelliJIdea2020.3\plugins\jr-ide-idea\lib\jrebel6\lib\jrebel64.dll -Dmaven.home=D:\eclipse\env\maven -Didea.modules.paths.file=C:\Users\Vector\AppData\Local\JetBrains\IntelliJIdea2020.3\Maven\idea-projects-state-596682c7.properties -Dclassworlds.conf=C:\Users\Vector\AppData\Local\Temp\idea-6755-mvn.conf -Dmaven.ext.class.path=D:\IDEA\plugins\maven\lib\maven-event-listener.jar -javaagent:D:\IDEA\plugins\java\lib\rt\debugger-agent.jar -Dfile.encoding=UTF-8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>jinfo -flag</strong> <strong>name</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flag UseParallelGC 25592</span></span><br><span class="line">-XX:+UseParallelGC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flag UseG1GC 25592</span></span><br><span class="line">-XX:-UseG1GC</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>jinfo -flag [+-]name</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flag PrintGCDetails 25592</span></span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flag -PrintGCDetails 25592</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jinfo -flag PrintGCDetails 25592</span></span><br><span class="line">-XX:-PrintGCDetails</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼š</p>
<ul>
<li><p>java -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰JVMå‚æ•°å¯åŠ¨çš„åˆå§‹å€¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Global flags]</span><br><span class="line">     intx ActiveProcessorCount                      = -1                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  &#123;product&#125;</span><br><span class="line">    uintx AdaptiveSizePausePolicy                   = 0                                   &#123;product&#125;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>java -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰JVMå‚æ•°çš„æœ€ç»ˆå€¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Global flags]</span><br><span class="line">     intx ActiveProcessorCount                      = -1                                  &#123;product&#125;</span><br><span class="line">...</span><br><span class="line">     intx CICompilerCount                          := 4                                   &#123;product&#125;</span><br><span class="line">    uintx InitialHeapSize                          := 333447168                           &#123;product&#125;</span><br><span class="line">    uintx MaxHeapSize                              := 1029701632                          &#123;product&#125;</span><br><span class="line">    uintx MaxNewSize                               := 1774714880                          &#123;product&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>java -XX:+PrintCommandLineFlags æŸ¥çœ‹å“ªäº›å·²ç»è¢«ç”¨æˆ·æˆ–è€…JVMè®¾ç½®è¿‡çš„è¯¦ç»†çš„XXå‚æ•°çš„åç§°å’Œå€¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:InitialHeapSize=332790016 -XX:MaxHeapSize=5324640256 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5ï¼Œjmapï¼šå¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶-amp-å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#5ï¼Œjmapï¼šå¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶-amp-å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="5ï¼Œjmapï¼šå¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶&amp;å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>5ï¼Œjmapï¼šå¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶&amp;å†…å­˜ä½¿ç”¨æƒ…å†µ</h3><p>jmapï¼ˆJVM Memory Mapï¼‰ï¼šä½œç”¨ä¸€æ–¹é¢æ˜¯è·å–dumpæ–‡ä»¶ï¼ˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œå®ƒè¿˜å¯ä»¥è·å–ç›®æ ‡Javaè¿›ç¨‹çš„å†…å­˜ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬Javaå †å„åŒºåŸŸçš„ä½¿ç”¨æƒ…å†µã€å †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ã€ç±»åŠ è½½ä¿¡æ¯ç­‰ã€‚å¼€å‘äººå‘˜å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è¾“å…¥å‘½ä»¤â€œjmap -helpâ€æŸ¥é˜…jmapå·¥å…·çš„å…·ä½“ä½¿ç”¨æ–¹å¼å’Œä¸€äº›æ ‡å‡†é€‰é¡¹é…ç½®ã€‚</p>
<p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html">https://docs.oracle.com/en/java/javase/11/tools/jmap.html</a></p>
<p>åŸºæœ¬ä½¿ç”¨è¯­æ³•ä¸ºï¼š</p>
<ul>
<li><p>jmap [option] <pid></pid></p>
</li>
<li><p>jmap [option] &lt;executable <core></core></p>
</li>
<li><p>jmap [option] [server_id@] <remote server ip or hostname></remote></p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/1647072036736.png" alt="1647072036736" loading="lazy"></p>
<p>è¯´æ˜ï¼šè¿™äº›å‚æ•°å’Œlinuxä¸‹è¾“å…¥æ˜¾ç¤ºçš„å‘½ä»¤å¤šå°‘ä¼šæœ‰ä¸åŒï¼ŒåŒ…æ‹¬ä¹Ÿå—jdkç‰ˆæœ¬çš„å½±å“ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jmap -dump:format=b,file=&lt;filename.hprof&gt; &lt;pid&gt;</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">jmap -dump:live,format=b,file=&lt;filename.hprof&gt; &lt;pid&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç”±äºjmapå°†è®¿é—®å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸ºäº†ä¿è¯åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸è¢«åº”ç”¨çº¿ç¨‹å¹²æ‰°ï¼Œjmapéœ€è¦å€ŸåŠ©å®‰å…¨ç‚¹æœºåˆ¶ï¼Œè®©æ‰€æœ‰çº¿ç¨‹åœç•™åœ¨ä¸æ”¹å˜å †ä¸­æ•°æ®çš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±jmapå¯¼å‡ºçš„å †å¿«ç…§å¿…å®šæ˜¯å®‰å…¨ç‚¹ä½ç½®çš„ã€‚è¿™å¯èƒ½å¯¼è‡´åŸºäºè¯¥å †å¿«ç…§çš„åˆ†æç»“æœå­˜åœ¨åå·®ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾åœ¨ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç ä¸­ï¼ŒæŸäº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåœ¨ä¸¤ä¸ªå®‰å…¨ç‚¹ä¹‹é—´ï¼Œé‚£ä¹ˆ:liveé€‰é¡¹å°†æ— æ³•æ¢çŸ¥åˆ°è¿™äº›å¯¹è±¡ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹é•¿æ—¶é—´æ— æ³•è·‘åˆ°å®‰å…¨ç‚¹ï¼Œjmapå°†ä¸€ç›´ç­‰ä¸‹å»ã€‚ä¸å‰é¢è®²çš„jstatåˆ™ä¸åŒï¼Œåƒåœ¾å›æ”¶å™¨ä¼šä¸»åŠ¨å°†jstatæ‰€éœ€è¦çš„æ‘˜è¦æ•°æ®ä¿å­˜è‡³å›ºå®šä½ç½®ä¹‹ä¸­ï¼Œè€Œjstatåªéœ€ç›´æ¥è¯»å–å³å¯ã€‚</p>
<h3 id="6ï¼Œjhatï¼šJDKè‡ªå¸¦å †åˆ†æå·¥å…·"><a href="#6ï¼Œjhatï¼šJDKè‡ªå¸¦å †åˆ†æå·¥å…·" class="headerlink" title="6ï¼Œjhatï¼šJDKè‡ªå¸¦å †åˆ†æå·¥å…·"></a>6ï¼Œjhatï¼šJDKè‡ªå¸¦å †åˆ†æå·¥å…·</h3><p>jhat(JVM Heap Analysis Tool)ï¼šSun JDKæä¾›çš„jhatå‘½ä»¤ä¸jmapå‘½ä»¤æ­é…ä½¿ç”¨ï¼Œç”¨äºåˆ†æjmapç”Ÿæˆçš„heap dumpæ–‡ä»¶ï¼ˆå †è½¬å‚¨å¿«ç…§ï¼‰ã€‚jhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpæ–‡ä»¶çš„åˆ†æç»“æœåï¼Œç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆ†æç»“æœï¼ˆåˆ†æè™šæ‹Ÿæœºè½¬å‚¨å¿«ç…§ä¿¡æ¯ï¼‰ã€‚</p>
<p>ä½¿ç”¨äº†jhatå‘½ä»¤ï¼Œå°±å¯åŠ¨äº†ä¸€ä¸ªhttpæœåŠ¡ï¼Œç«¯å£æ˜¯7000ï¼Œå³<a target="_blank" rel="noopener" href="http://localhost:7000/%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8C%E5%88%86%E6%9E%90%E3%80%82">http://localhost:7000/ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨é‡Œåˆ†æã€‚</a></p>
<p>è¯´æ˜ï¼šjhatå‘½ä»¤åœ¨JDK9ã€JDK10ä¸­å·²ç»è¢«åˆ é™¤ï¼Œå®˜æ–¹å»ºè®®ç”¨VisualVMä»£æ›¿ã€‚</p>
<p>åŸºæœ¬é€‚ç”¨è¯­æ³•ï¼šjhat <option> <dumpfile></dumpfile></option></p>
<p><img src="/2022/04/18/JVM/1647095960051.png" alt="1647095960051" loading="lazy"></p>
<h3 id="7ï¼Œjstackï¼šæ‰“å°JVMä¸­çº¿ç¨‹å¿«ç…§"><a href="#7ï¼Œjstackï¼šæ‰“å°JVMä¸­çº¿ç¨‹å¿«ç…§" class="headerlink" title="7ï¼Œjstackï¼šæ‰“å°JVMä¸­çº¿ç¨‹å¿«ç…§"></a>7ï¼Œjstackï¼šæ‰“å°JVMä¸­çº¿ç¨‹å¿«ç…§</h3><p>jstackï¼ˆJVM Stack Traceï¼‰ï¼šç”¨äºç”Ÿæˆè™šæ‹ŸæœºæŒ‡å®šè¿›ç¨‹å½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆè™šæ‹Ÿæœºå †æ ˆè·Ÿè¸ªï¼‰ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æŒ‡å®šè¿›ç¨‹çš„æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚</p>
<p>ç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä½œç”¨ï¼šå¯ç”¨äºå®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰é—®é¢˜ã€‚è¿™äº›éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚å½“çº¿ç¨‹å‡ºç°åœé¡¿æ—¶ï¼Œå°±å¯ä»¥ç”¨jstackæ˜¾ç¤ºå„ä¸ªçº¿ç¨‹è°ƒç”¨çš„å †æ ˆæƒ…å†µã€‚</p>
<p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html">https://docs.oracle.com/en/java/javase/11/tools/jstack.html</a></p>
<p>åœ¨thread dumpä¸­ï¼Œè¦ç•™æ„ä¸‹é¢å‡ ç§çŠ¶æ€</p>
<ul>
<li><p>æ­»é”ï¼ŒDeadlockï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</p>
</li>
<li><p>ç­‰å¾…èµ„æºï¼ŒWaiting on conditionï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</p>
</li>
<li><p>ç­‰å¾…è·å–ç›‘è§†å™¨ï¼ŒWaiting on monitor entryï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</p>
</li>
<li><p>é˜»å¡ï¼ŒBlockedï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</p>
</li>
<li><p>æ‰§è¡Œä¸­ï¼ŒRunnable</p>
</li>
<li><p>æš‚åœï¼ŒSuspended</p>
</li>
<li><p>å¯¹è±¡ç­‰å¾…ä¸­ï¼ŒObject.wait() æˆ– TIMEDï¼¿WAITING</p>
</li>
<li><p>åœæ­¢ï¼ŒParked</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/1647096897591.png" alt="1647096897591" loading="lazy"></p>
<h3 id="8ï¼Œjcmdï¼šå¤šåŠŸèƒ½å‘½ä»¤è¡Œ"><a href="#8ï¼Œjcmdï¼šå¤šåŠŸèƒ½å‘½ä»¤è¡Œ" class="headerlink" title="8ï¼Œjcmdï¼šå¤šåŠŸèƒ½å‘½ä»¤è¡Œ"></a>8ï¼Œjcmdï¼šå¤šåŠŸèƒ½å‘½ä»¤è¡Œ</h3><p>åœ¨JDK 1.7ä»¥åï¼Œæ–°å¢äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·jcmdã€‚å®ƒæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å®ç°å‰é¢é™¤äº†jstatä¹‹å¤–æ‰€æœ‰å‘½ä»¤çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šç”¨å®ƒæ¥å¯¼å‡ºå †ã€å†…å­˜ä½¿ç”¨ã€æŸ¥çœ‹Javaè¿›ç¨‹ã€å¯¼å‡ºçº¿ç¨‹ä¿¡æ¯ã€æ‰§è¡ŒGCã€JVMè¿è¡Œæ—¶é—´ç­‰ã€‚</p>
<p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jcmd.html">https://docs.oracle.com/en/java/javase/11/tools/jcmd.html</a></p>
<p>jcmdæ‹¥æœ‰jmapçš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨Oracleçš„å®˜æ–¹ç½‘ç«™ä¸Šä¹Ÿæ¨èä½¿ç”¨jcmdå‘½ä»¤ä»£jmapå‘½ä»¤</p>
<p><strong>jcmd -lï¼š</strong>åˆ—å‡ºæ‰€æœ‰çš„JVMè¿›ç¨‹</p>
<p><strong>jcmd è¿›ç¨‹å· helpï¼š</strong>é’ˆå¯¹æŒ‡å®šçš„è¿›ç¨‹ï¼Œåˆ—å‡ºæ”¯æŒçš„æ‰€æœ‰å…·ä½“å‘½ä»¤</p>
<p><img src="/2022/04/18/JVM/1647097094692.png" alt="1647097094692" loading="lazy"></p>
<p><strong>jcmd è¿›ç¨‹å· å…·ä½“å‘½ä»¤ï¼š</strong>æ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹çš„æŒ‡ä»¤å‘½ä»¤çš„æ•°æ®</p>
<ul>
<li><p>Thread.print å¯ä»¥æ›¿æ¢ jstackæŒ‡ä»¤</p>
</li>
<li><p>GC.class_histogram å¯ä»¥æ›¿æ¢ jmapä¸­çš„-histoæ“ä½œ</p>
</li>
<li><p>GC.heap_dump å¯ä»¥æ›¿æ¢ jmapä¸­çš„-dumpæ“ä½œ</p>
</li>
<li><p>GC.run å¯ä»¥æŸ¥çœ‹GCçš„æ‰§è¡Œæƒ…å†µ</p>
</li>
<li><p>VM.uptime å¯ä»¥æŸ¥çœ‹ç¨‹åºçš„æ€»æ‰§è¡Œæ—¶é—´ï¼Œå¯ä»¥æ›¿æ¢jstatæŒ‡ä»¤ä¸­çš„-tæ“ä½œ</p>
</li>
<li><p>VM.system_properties å¯ä»¥æ›¿æ¢ jinfo -sysprops è¿›ç¨‹id</p>
</li>
<li><p>VM.flags å¯ä»¥è·å–JVMçš„é…ç½®å‚æ•°ä¿¡æ¯</p>
</li>
</ul>
<h3 id="9ï¼Œjstatdï¼šè¿œç¨‹ä¸»æœºä¿¡æ¯æ”¶é›†"><a href="#9ï¼Œjstatdï¼šè¿œç¨‹ä¸»æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="9ï¼Œjstatdï¼šè¿œç¨‹ä¸»æœºä¿¡æ¯æ”¶é›†"></a>9ï¼Œjstatdï¼šè¿œç¨‹ä¸»æœºä¿¡æ¯æ”¶é›†</h3><p>ä¹‹å‰çš„æŒ‡ä»¤åªæ¶‰åŠåˆ°ç›‘æ§æœ¬æœºçš„Javaåº”ç”¨ç¨‹åºï¼Œè€Œåœ¨è¿™äº›å·¥å…·ä¸­ï¼Œä¸€äº›ç›‘æ§å·¥å…·ä¹Ÿæ”¯æŒå¯¹è¿œç¨‹è®¡ç®—æœºçš„ç›‘æ§ï¼ˆå¦‚jpsã€jstatï¼‰ã€‚ä¸ºäº†å¯ç”¨è¿œç¨‹ç›‘æ§ï¼Œåˆ™éœ€è¦é…åˆä½¿ç”¨jstatd å·¥å…·ã€‚å‘½ä»¤jstatdæ˜¯ä¸€ä¸ªRMIæœåŠ¡ç«¯ç¨‹åºï¼Œå®ƒçš„ä½œç”¨ç›¸å½“äºä»£ç†æœåŠ¡å™¨ï¼Œå»ºç«‹æœ¬åœ°è®¡ç®—æœºä¸è¿œç¨‹ç›‘æ§å·¥å…·çš„é€šä¿¡ã€‚jstatdæœåŠ¡å™¨å°†æœ¬æœºçš„Javaåº”ç”¨ç¨‹åºä¿¡æ¯ä¼ é€’åˆ°è¿œç¨‹è®¡ç®—æœºã€‚</p>
<p><img src="/2022/04/18/JVM/1647098707541.png" alt="1647098707541" loading="lazy"></p>
<h2 id="ä¸‰ï¼Œ-JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡"><a href="#ä¸‰ï¼Œ-JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡" class="headerlink" title="ä¸‰ï¼Œ JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡"></a>ä¸‰ï¼Œ <strong>JVMç›‘æ§åŠè¯Šæ–­å·¥å…·-GUIç¯‡</strong></h2><h3 id="1ï¼Œå·¥å…·æ¦‚è¿°"><a href="#1ï¼Œå·¥å…·æ¦‚è¿°" class="headerlink" title="1ï¼Œå·¥å…·æ¦‚è¿°"></a>1ï¼Œå·¥å…·æ¦‚è¿°</h3><p>ä½¿ç”¨ä¸Šä¸€ç« å‘½ä»¤è¡Œå·¥å…·æˆ–ç»„åˆèƒ½å¸®æ‚¨è·å–ç›®æ ‡Javaåº”ç”¨æ€§èƒ½ç›¸å…³çš„åŸºç¡€ä¿¡æ¯ï¼Œä½†å®ƒä»¬å­˜åœ¨ä¸‹åˆ—å±€é™ï¼š</p>
<ul>
<li><p>æ— æ³•è·å–æ–¹æ³•çº§åˆ«çš„åˆ†ææ•°æ®ï¼Œå¦‚æ–¹æ³•é—´çš„è°ƒç”¨å…³ç³»ã€å„æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç­‰ï¼ˆè¿™å¯¹å®šä½åº”ç”¨æ€§èƒ½ç“¶é¢ˆè‡³å…³é‡è¦ï¼‰ã€‚</p>
</li>
<li><p>è¦æ±‚ç”¨æˆ·ç™»å½•åˆ°ç›®æ ‡ Java åº”ç”¨æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šï¼Œä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</p>
</li>
<li><p>åˆ†ææ•°æ®é€šè¿‡ç»ˆç«¯è¾“å‡ºï¼Œç»“æœå±•ç¤ºä¸å¤Ÿç›´è§‚ã€‚</p>
</li>
</ul>
<p>ä¸ºæ­¤ï¼ŒJDKæä¾›äº†ä¸€äº›å†…å­˜æ³„æ¼çš„åˆ†æå·¥å…·ï¼Œå¦‚jconsoleï¼Œjvisualvmç­‰ï¼Œç”¨äºè¾…åŠ©å¼€å‘äººå‘˜å®šä½é—®é¢˜ï¼Œä½†æ˜¯è¿™äº›å·¥å…·å¾ˆå¤šæ—¶å€™å¹¶ä¸è¶³ä»¥æ»¡è¶³å¿«é€Ÿå®šä½çš„éœ€æ±‚ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä»‹ç»çš„å·¥å…·ç›¸å¯¹å¤šä¸€äº›ã€ä¸°å¯Œä¸€äº›ã€‚</p>
<p><strong>JDKè‡ªå¸¦çš„å·¥å…·</strong></p>
<ul>
<li><p> jconsoleï¼šJDKè‡ªå¸¦çš„å¯è§†åŒ–ç›‘æ§å·¥å…·ã€‚æŸ¥çœ‹Javaåº”ç”¨ç¨‹åºçš„è¿è¡Œæ¦‚å†µã€ç›‘æ§å †ä¿¡æ¯ã€æ°¸ä¹…åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰ä½¿ç”¨æƒ…å†µã€ç±»åŠ è½½æƒ…å†µç­‰ </p>
</li>
<li><p> Visual VMï¼šVisual VMæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯è§†ç•Œé¢ï¼Œç”¨äºæŸ¥çœ‹Javaè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„åŸºäºJavaæŠ€æœ¯çš„åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚ </p>
</li>
<li><p> JMCï¼šJava Mission Controlï¼Œå†…ç½®Java Flight Recorderã€‚èƒ½å¤Ÿä»¥æä½çš„æ€§èƒ½å¼€é”€æ”¶é›†Javaè™šæ‹Ÿæœºçš„æ€§èƒ½æ•°æ®ã€‚ </p>
</li>
</ul>
<p><strong>ç¬¬ä¸‰æ–¹å·¥å…·</strong></p>
<ul>
<li><p> MATï¼šMATï¼ˆMemory Analyzer Toolï¼‰æ˜¯åŸºäºEclipseçš„å†…å­˜åˆ†æå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå¿«é€Ÿã€åŠŸèƒ½ä¸°å¯Œçš„Java heapåˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾å†…å­˜æ³„æ¼å’Œå‡å°‘å†…å­˜æ¶ˆè€— </p>
</li>
<li><p> JProfilerï¼šå•†ä¸šè½¯ä»¶ï¼Œéœ€è¦ä»˜è´¹ã€‚åŠŸèƒ½å¼ºå¤§ã€‚ </p>
</li>
</ul>
<h3 id="2ï¼ŒJConsole"><a href="#2ï¼ŒJConsole" class="headerlink" title="2ï¼ŒJConsole"></a>2ï¼ŒJConsole</h3><p>jconsoleï¼šä»Java5å¼€å§‹ï¼Œåœ¨JDKä¸­è‡ªå¸¦çš„javaç›‘æ§å’Œç®¡ç†æ§åˆ¶å°ã€‚ç”¨äºå¯¹JVMä¸­å†…å­˜ã€çº¿ç¨‹å’Œç±»ç­‰çš„ç›‘æ§ï¼Œæ˜¯ä¸€ä¸ªåŸºäºJMXï¼ˆjava management extensionsï¼‰çš„GUIæ€§èƒ½ç›‘æ§å·¥å…·ã€‚</p>
<p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/guides/management/jconsole.html">https://docs.oracle.com/javase/7/docs/technotes/guides/management/jconsole.html</a></p>
<p><strong>å¯åŠ¨çš„æ–¹å¼</strong></p>
<p><img src="/2022/04/18/JVM/1647163199435.png" alt="1647163199435" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/QQ%E6%88%AA%E5%9B%BE20220313172057.png" loading="lazy"></p>
<h3 id="3ï¼ŒVisual-VM"><a href="#3ï¼ŒVisual-VM" class="headerlink" title="3ï¼ŒVisual VM"></a>3ï¼ŒVisual VM</h3><p>Visual VMæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¤šåˆä¸€æ•…éšœè¯Šæ–­å’Œæ€§èƒ½ç›‘æ§çš„å¯è§†åŒ–å·¥å…·ã€‚å®ƒé›†æˆäº†å¤šä¸ªJDKå‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨Visual VMå¯ç”¨äºæ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹åŠè¿›ç¨‹çš„é…ç½®å’Œç¯å¢ƒä¿¡æ¯ï¼ˆjpsï¼Œjinfoï¼‰ï¼Œç›‘è§†åº”ç”¨ç¨‹åºçš„CPUã€GCã€å †ã€æ–¹æ³•åŒºåŠçº¿ç¨‹çš„ä¿¡æ¯ï¼ˆjstatã€jstackï¼‰ç­‰ï¼Œç”šè‡³ä»£æ›¿JConsoleã€‚åœ¨JDK 6 Update 7ä»¥åï¼ŒVisual VMä¾¿ä½œä¸ºJDKçš„ä¸€éƒ¨åˆ†å‘å¸ƒï¼ˆVisualVM åœ¨JDKï¼binç›®å½•ä¸‹ï¼‰å³ï¼šå®ƒå®Œå…¨å…è´¹ã€‚</p>
<p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong></p>
<ul>
<li><p>1.ç”Ÿæˆ/è¯»å–å †å†…å­˜/çº¿ç¨‹å¿«ç…§</p>
</li>
<li><p>2.æŸ¥çœ‹JVMå‚æ•°å’Œç³»ç»Ÿå±æ€§</p>
</li>
<li><p>3.æŸ¥çœ‹è¿è¡Œä¸­çš„è™šæ‹Ÿæœºè¿›ç¨‹</p>
</li>
<li><p>4.ç¨‹åºèµ„æºçš„å®æ—¶ç›‘æ§</p>
</li>
<li><p>5.JMXä»£ç†è¿æ¥ã€è¿œç¨‹ç¯å¢ƒç›‘æ§ã€CPUåˆ†æå’Œå†…å­˜åˆ†æ</p>
</li>
</ul>
<p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://visualvm.github.io/index.html">https://visualvm.github.io/index.html</a></p>
<p><strong>æ‰“å¼€æ–¹å¼ï¼š</strong></p>
<ul>
<li>é€šè¿‡å‘½ä»¤è¡ŒJvisual</li>
<li>åœ¨jdkä¸­æ‰¾åˆ°è¿™ä¸ªç¨‹åºè¿›è¡Œå¯åŠ¨</li>
<li>åœ¨IDEAä¸­ä¸‹è½½è¿™ä¸ªæ’ä»¶ï¼Œå¹¶è¿›è¡Œé…ç½®ï¼Œä¸€ä¸ªæ˜¯è¦é€‰è¿™ä¸ªè½¯ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œä¸€ä¸ªæ˜¯jdkæ‰€åœ¨çš„ä½ç½®ã€‚</li>
</ul>
<p><strong>ä¸‹è½½æ’ä»¶çš„æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<p>æ­£å¸¸ç°åœ¨ä¸€èˆ¬æ˜¯ä¸‹ä¸äº†çš„ï¼Œéœ€è¦è¿›è¡Œåˆ«çš„è®¾ç½®ã€‚</p>
<p><img src="/2022/04/18/JVM/1647166459779.png" alt="1647166459779" loading="lazy"></p>
<p>å¦‚æœè¿˜æ²¡æœ‰åŠæ³•ä¸‹è½½ï¼Œå¯ä»¥å»å®˜ç½‘æ‰¾åˆ°å…·ä½“çš„ä¸‹è½½ä½ç½®ã€‚ <a target="_blank" rel="noopener" href="https://visualvm.github.io/uc/8u131/updates.html">Update Center documentation (visualvm.github.io)</a> </p>
<p><img src="/2022/04/18/JVM/1647166518246.png" alt="1647166518246" loading="lazy"></p>
<p>åœ¨ä¸Šé¢è¿›è¡Œä¸‹è½½ï¼Œä¸‹è½½å¥½åè¿›è¡Œä»¥ä¸‹æ“ä½œã€‚</p>
<p><img src="/2022/04/18/JVM/1647166583084.png" alt="1647166583084" loading="lazy"></p>
<p><strong>è½¯ä»¶å†…éƒ¨çš„å…·ä½“æƒ…å†µ</strong></p>
<p><img src="/2022/04/18/JVM/1647166617778.png" alt="1647166617778" loading="lazy"></p>
<h3 id="4ï¼ŒEclipse-MAT"><a href="#4ï¼ŒEclipse-MAT" class="headerlink" title="4ï¼ŒEclipse MAT"></a>4ï¼ŒEclipse MAT</h3><p>MATï¼ˆMemory Analyzer Toolï¼‰å·¥å…·æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„Javaå †å†…å­˜åˆ†æå™¨ã€‚å¯ä»¥ç”¨äºæŸ¥æ‰¾å†…å­˜æ³„æ¼ä»¥åŠæŸ¥çœ‹å†…å­˜æ¶ˆè€—æƒ…å†µã€‚MATæ˜¯åŸºäºEclipseå¼€å‘çš„ï¼Œä¸ä»…å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œè¿˜å¯ä»¥ä½œä¸ºæ’ä»¶çš„å½¢å¼åµŒå…¥åœ¨Eclipseä¸­ä½¿ç”¨ã€‚æ˜¯ä¸€æ¬¾å…è´¹çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p>
<p>MATå¯ä»¥åˆ†æheap dumpæ–‡ä»¶ã€‚åœ¨è¿›è¡Œå†…å­˜åˆ†ææ—¶ï¼Œåªè¦è·å¾—äº†åæ˜ å½“å‰è®¾å¤‡å†…å­˜æ˜ åƒçš„hprofæ–‡ä»¶ï¼Œé€šè¿‡MATæ‰“å¼€å°±å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å½“å‰çš„å†…å­˜ä¿¡æ¯ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œè¿™äº›å†…å­˜ä¿¡æ¯åŒ…å«ï¼š</p>
<ul>
<li><p>æ‰€æœ‰çš„å¯¹è±¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯¹è±¡å®ä¾‹ã€æˆå‘˜å˜é‡ã€å­˜å‚¨äºæ ˆä¸­çš„åŸºæœ¬ç±»å‹å€¼å’Œå­˜å‚¨äºå †ä¸­çš„å…¶ä»–å¯¹è±¡çš„å¼•ç”¨å€¼ã€‚</p>
</li>
<li><p>æ‰€æœ‰çš„ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬classloaderã€ç±»åç§°ã€çˆ¶ç±»ã€é™æ€å˜é‡ç­‰</p>
</li>
<li><p>GCRootåˆ°æ‰€æœ‰çš„è¿™äº›å¯¹è±¡çš„å¼•ç”¨è·¯å¾„</p>
</li>
<li><p>çº¿ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„è°ƒç”¨æ ˆåŠæ­¤çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡ï¼ˆTLSï¼‰</p>
</li>
</ul>
<p>MAT ä¸æ˜¯ä¸€ä¸ªä¸‡èƒ½å·¥å…·ï¼Œå®ƒå¹¶ä¸èƒ½å¤„ç†æ‰€æœ‰ç±»å‹çš„å †å­˜å‚¨æ–‡ä»¶ã€‚ä½†æ˜¯æ¯”è¾ƒä¸»æµçš„å‚å®¶å’Œæ ¼å¼ï¼Œä¾‹å¦‚Sunï¼ŒHPï¼ŒSAP æ‰€é‡‡ç”¨çš„ HPROF äºŒè¿›åˆ¶å †å­˜å‚¨æ–‡ä»¶ï¼Œä»¥åŠ IBMçš„ PHD å †å­˜å‚¨æ–‡ä»¶ç­‰éƒ½èƒ½è¢«å¾ˆå¥½çš„è§£æã€‚</p>
<p>æœ€å¸å¼•äººçš„è¿˜æ˜¯èƒ½å¤Ÿå¿«é€Ÿä¸ºå¼€å‘äººå‘˜ç”Ÿæˆå†…å­˜æ³„æ¼æŠ¥è¡¨ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜å’Œåˆ†æé—®é¢˜ã€‚è™½ç„¶MATæœ‰å¦‚æ­¤å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†æ˜¯å†…å­˜åˆ†æä¹Ÿæ²¡æœ‰ç®€å•åˆ°ä¸€é”®å®Œæˆçš„ç¨‹åº¦ï¼Œå¾ˆå¤šå†…å­˜é—®é¢˜è¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä»MATå±•ç°ç»™æˆ‘ä»¬çš„ä¿¡æ¯å½“ä¸­é€šè¿‡ç»éªŒå’Œç›´è§‰æ¥åˆ¤æ–­æ‰èƒ½å‘ç°ã€‚</p>
<p>å®˜æ–¹åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://www.eclipse.org/mat/downloads.php">https://www.eclipse.org/mat/downloads.php</a></p>
<h3 id="5ï¼ŒJProfiler"><a href="#5ï¼ŒJProfiler" class="headerlink" title="5ï¼ŒJProfiler"></a>5ï¼ŒJProfiler</h3><p>åœ¨è¿è¡ŒJavaçš„æ—¶å€™æœ‰æ—¶å€™æƒ³æµ‹è¯•è¿è¡Œæ—¶å ç”¨å†…å­˜æƒ…å†µï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨æµ‹è¯•å·¥å…·æŸ¥çœ‹äº†ã€‚åœ¨eclipseé‡Œé¢æœ‰ Eclipse Memory Analyzer toolï¼ˆMATï¼‰æ’ä»¶å¯ä»¥æµ‹è¯•ï¼Œè€Œåœ¨IDEAä¸­ä¹Ÿæœ‰è¿™ä¹ˆä¸€ä¸ªæ’ä»¶ï¼Œå°±æ˜¯JProfilerã€‚JProfiler æ˜¯ç”± ej-technologies å…¬å¸å¼€å‘çš„ä¸€æ¬¾ Java åº”ç”¨æ€§èƒ½è¯Šæ–­å·¥å…·ã€‚åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯æ”¶è´¹ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><p>ä½¿ç”¨æ–¹ä¾¿ã€ç•Œé¢æ“ä½œå‹å¥½ï¼ˆç®€å•ä¸”å¼ºå¤§ï¼‰</p>
</li>
<li><p>å¯¹è¢«åˆ†æçš„åº”ç”¨å½±å“å°ï¼ˆæä¾›æ¨¡æ¿ï¼‰</p>
</li>
<li><p>CPUï¼ŒThreadï¼ŒMemoryåˆ†æåŠŸèƒ½å°¤å…¶å¼ºå¤§</p>
</li>
<li><p>æ”¯æŒå¯¹jdbcï¼ŒnoSqlï¼Œjspï¼Œservletï¼Œsocketç­‰è¿›è¡Œåˆ†æ</p>
</li>
<li><p>æ”¯æŒå¤šç§æ¨¡å¼ï¼ˆç¦»çº¿ï¼Œåœ¨çº¿ï¼‰çš„åˆ†æ</p>
</li>
<li><p>æ”¯æŒç›‘æ§æœ¬åœ°ã€è¿œç¨‹çš„JVM</p>
</li>
<li><p>è·¨å¹³å°ï¼Œæ‹¥æœ‰å¤šç§æ“ä½œç³»ç»Ÿçš„å®‰è£…ç‰ˆæœ¬</p>
</li>
</ul>
<p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong></p>
<ul>
<li><p>1-æ–¹æ³•è°ƒç”¨ï¼šå¯¹æ–¹æ³•è°ƒç”¨çš„åˆ†æå¯ä»¥å¸®åŠ©æ‚¨äº†è§£åº”ç”¨ç¨‹åºæ­£åœ¨åšä»€ä¹ˆï¼Œå¹¶æ‰¾åˆ°æé«˜å…¶æ€§èƒ½çš„æ–¹æ³•</p>
</li>
<li><p>2-å†…å­˜åˆ†é…ï¼šé€šè¿‡åˆ†æå †ä¸Šå¯¹è±¡ã€å¼•ç”¨é“¾å’Œåƒåœ¾æ”¶é›†èƒ½å¸®æ‚¨ä¿®å¤å†…å­˜æ³„éœ²é—®é¢˜ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨</p>
</li>
<li><p>3-çº¿ç¨‹å’Œé”ï¼šJProfileræä¾›å¤šç§é’ˆå¯¹çº¿ç¨‹å’Œé”çš„åˆ†æè§†å›¾åŠ©æ‚¨å‘ç°å¤šçº¿ç¨‹é—®é¢˜</p>
</li>
<li><p>4-é«˜çº§å­ç³»ç»Ÿï¼šè®¸å¤šæ€§èƒ½é—®é¢˜éƒ½å‘ç”Ÿåœ¨æ›´é«˜çš„è¯­ä¹‰çº§åˆ«ä¸Šã€‚ä¾‹å¦‚ï¼Œå¯¹äºJDBCè°ƒç”¨ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ‰¾å‡ºæ‰§è¡Œæœ€æ…¢çš„SQLè¯­å¥ã€‚JProfileræ”¯æŒå¯¹è¿™äº›å­ç³»ç»Ÿè¿›è¡Œé›†æˆåˆ†æ</p>
</li>
</ul>
<p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.ej-technologies.com/products/jprofiler/overview.html">https://www.ej-technologies.com/products/jprofiler/overview.html</a></p>
<p><strong>æ•°æ®é‡‡é›†æ–¹å¼ï¼š</strong></p>
<p>JProfieræ•°æ®é‡‡é›†æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼šSamplingï¼ˆæ ·æœ¬é‡‡é›†ï¼‰å’ŒInstrumentationï¼ˆé‡æ„æ¨¡å¼ï¼‰</p>
<p><strong>Instrumentation</strong>ï¼šè¿™æ˜¯JProfilerå…¨åŠŸèƒ½æ¨¡å¼ã€‚åœ¨classåŠ è½½ä¹‹å‰ï¼ŒJProfieræŠŠç›¸å…³åŠŸèƒ½ä»£ç å†™å…¥åˆ°éœ€è¦åˆ†æçš„classçš„bytecodeä¸­ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„jvmæœ‰ä¸€å®šå½±å“ã€‚</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§ã€‚åœ¨æ­¤è®¾ç½®ä¸­ï¼Œè°ƒç”¨å †æ ˆä¿¡æ¯æ˜¯å‡†ç¡®çš„ã€‚</p>
</li>
<li><p>ç¼ºç‚¹ï¼šè‹¥è¦åˆ†æçš„classè¾ƒå¤šï¼Œåˆ™å¯¹åº”ç”¨çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒCPUå¼€é”€å¯èƒ½å¾ˆé«˜ï¼ˆå–å†³äºFilterçš„æ§åˆ¶ï¼‰ã€‚å› æ­¤ä½¿ç”¨æ­¤æ¨¡å¼ä¸€èˆ¬é…åˆFilterä½¿ç”¨ï¼Œåªå¯¹ç‰¹å®šçš„ç±»æˆ–åŒ…è¿›è¡Œåˆ†æ</p>
</li>
</ul>
<p><strong>Sampling</strong>ï¼šç±»ä¼¼äºæ ·æœ¬ç»Ÿè®¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´ï¼ˆ5msï¼‰å°†æ¯ä¸ªçº¿ç¨‹æ ˆä¸­æ–¹æ³•æ ˆä¸­çš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ã€‚</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼šå¯¹CPUçš„å¼€é”€éå¸¸ä½ï¼Œå¯¹åº”ç”¨å½±å“å°ï¼ˆå³ä½¿ä½ ä¸é…ç½®ä»»ä½•Filterï¼‰</p>
</li>
<li><p>ç¼ºç‚¹ï¼šä¸€äº›æ•°æ®ï¼ç‰¹æ€§ä¸èƒ½æä¾›ï¼ˆä¾‹å¦‚ï¼šæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ï¼‰</p>
</li>
</ul>
<p>æ³¨ï¼šJProfileræœ¬èº«æ²¡æœ‰æŒ‡å‡ºæ•°æ®çš„é‡‡é›†ç±»å‹ï¼Œè¿™é‡Œçš„é‡‡é›†ç±»å‹æ˜¯é’ˆå¯¹æ–¹æ³•è°ƒç”¨çš„é‡‡é›†ç±»å‹ã€‚å› ä¸ºJProfilerçš„ç»å¤§å¤šæ•°æ ¸å¿ƒåŠŸèƒ½éƒ½ä¾èµ–æ–¹æ³•è°ƒç”¨é‡‡é›†çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¤ä¸ºæ˜¯JProfilerçš„æ•°æ®é‡‡é›†ç±»å‹ã€‚</p>
<p><strong>é¥æ„Ÿç›‘æµ‹ Telemetries</strong></p>
<p><img src="/2022/04/18/JVM/1647506127278.png" alt="1647506127278" loading="lazy"></p>
<p><img src="/2022/04/18/JVM/1647506185868.png" alt="1647506185868" loading="lazy"></p>
<h3 id="6ï¼ŒArthas"><a href="#6ï¼ŒArthas" class="headerlink" title="6ï¼ŒArthas"></a>6ï¼ŒArthas</h3><p>ä¸Šè¿°å·¥å…·éƒ½å¿…é¡»åœ¨æœåŠ¡ç«¯é¡¹ç›®è¿›ç¨‹ä¸­é…ç½®ç›¸å…³çš„ç›‘æ§å‚æ•°ï¼Œç„¶åå·¥å…·é€šè¿‡è¿œç¨‹è¿æ¥åˆ°é¡¹ç›®è¿›ç¨‹ï¼Œè·å–ç›¸å…³çš„æ•°æ®ã€‚è¿™æ ·å°±ä¼šå¸¦æ¥ä¸€äº›ä¸ä¾¿ï¼Œæ¯”å¦‚çº¿ä¸Šç¯å¢ƒçš„ç½‘ç»œæ˜¯éš”ç¦»çš„ï¼Œæœ¬åœ°çš„ç›‘æ§å·¥å…·æ ¹æœ¬è¿ä¸ä¸Šçº¿ä¸Šç¯å¢ƒã€‚å¹¶ä¸”ç±»ä¼¼äºJprofilerè¿™æ ·çš„å•†ä¸šå·¥å…·ï¼Œæ˜¯éœ€è¦ä»˜è´¹çš„ã€‚</p>
<p>æ²¡æœ‰ä¸€æ¬¾å·¥å…·ä¸éœ€è¦è¿œç¨‹è¿æ¥ï¼Œä¹Ÿä¸éœ€è¦é…ç½®ç›‘æ§å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸°å¯Œçš„æ€§èƒ½ç›‘æ§æ•°æ®å‘¢ï¼Ÿ</p>
<p>é˜¿é‡Œå·´å·´å¼€æºçš„æ€§èƒ½åˆ†æç¥å™¨Arthasåº”è¿è€Œç”Ÿã€‚</p>
<p>Arthasæ˜¯Alibabaå¼€æºçš„Javaè¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚åœ¨çº¿æ’æŸ¥é—®é¢˜ï¼Œæ— éœ€é‡å¯ï¼›åŠ¨æ€è·Ÿè¸ªJavaä»£ç ï¼›å®æ—¶ç›‘æ§JVMçŠ¶æ€ã€‚Arthas æ”¯æŒJDK 6ï¼‹ï¼Œæ”¯æŒLinuxï¼Macï¼Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚å½“ä½ é‡åˆ°ä»¥ä¸‹ç±»ä¼¼é—®é¢˜è€ŒæŸæ‰‹æ— ç­–æ—¶ï¼ŒArthaså¯ä»¥å¸®åŠ©ä½ è§£å†³ï¼š</p>
<ul>
<li><p>è¿™ä¸ªç±»ä»å“ªä¸ª jar åŒ…åŠ è½½çš„ï¼Ÿä¸ºä»€ä¹ˆä¼šæŠ¥å„ç§ç±»ç›¸å…³çš„ Exceptionï¼Ÿ</p>
</li>
<li><p>æˆ‘æ”¹çš„ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œåˆ°ï¼Ÿéš¾é“æ˜¯æˆ‘æ²¡ commitï¼Ÿåˆ†æ”¯æé”™äº†ï¼Ÿ</p>
</li>
<li><p>é‡åˆ°é—®é¢˜æ— æ³•åœ¨çº¿ä¸Š debugï¼Œéš¾é“åªèƒ½é€šè¿‡åŠ æ—¥å¿—å†é‡æ–°å‘å¸ƒå—ï¼Ÿ</p>
</li>
<li><p>çº¿ä¸Šé‡åˆ°æŸä¸ªç”¨æˆ·çš„æ•°æ®å¤„ç†æœ‰é—®é¢˜ï¼Œä½†çº¿ä¸ŠåŒæ ·æ— æ³• debugï¼Œçº¿ä¸‹æ— æ³•é‡ç°ï¼</p>
</li>
<li><p>æ˜¯å¦æœ‰ä¸€ä¸ªå…¨å±€è§†è§’æ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Ÿ</p>
</li>
<li><p>æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç›‘æ§åˆ°JVMçš„å®æ—¶è¿è¡ŒçŠ¶æ€ï¼Ÿ</p>
</li>
<li><p>æ€ä¹ˆå¿«é€Ÿå®šä½åº”ç”¨çš„çƒ­ç‚¹ï¼Œç”Ÿæˆç«ç„°å›¾ï¼Ÿ</p>
</li>
</ul>
<p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/quick-start.html">https://arthas.aliyun.com/doc/quick-start.html</a></p>
<p>å®‰è£…æ–¹å¼ï¼šå¦‚æœé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥å°è¯•å›½å†…çš„ç äº‘Giteeä¸‹è½½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://io/arthas/arthas-boot.jar</span><br><span class="line">wget https://arthas/gitee/io/arthas-boot.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Arthasåªæ˜¯ä¸€ä¸ªjavaç¨‹åºï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨java -jarè¿è¡Œã€‚</p>
<p>é™¤äº†åœ¨å‘½ä»¤è¡ŒæŸ¥çœ‹å¤–ï¼ŒArthasç›®å‰è¿˜æ”¯æŒ Web Consoleã€‚åœ¨æˆåŠŸå¯åŠ¨è¿æ¥è¿›ç¨‹ä¹‹åå°±å·²ç»è‡ªåŠ¨å¯åŠ¨,å¯ä»¥ç›´æ¥è®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:8563/">http://127.0.0.1:8563/</a> è®¿é—®ï¼Œé¡µé¢ä¸Šçš„æ“ä½œæ¨¡å¼å’Œæ§åˆ¶å°å®Œå…¨ä¸€æ ·ã€‚</p>
<p><strong>åŸºç¡€æŒ‡ä»¤</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">quit/exit é€€å‡ºå½“å‰ Arthaså®¢æˆ·ç«¯ï¼Œå…¶ä»– Arthaså–œæˆ·ç«¯ä¸å—å½±å“</span><br><span class="line">stop/shutdown å…³é—­ ArthasæœåŠ¡ç«¯ï¼Œæ‰€æœ‰ Arthaså®¢æˆ·ç«¯å…¨éƒ¨é€€å‡º</span><br><span class="line">help æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯</span><br><span class="line">cat æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œå’Œlinuxé‡Œçš„catå‘½ä»¤ç±»ä¼¼</span><br><span class="line">echo æ‰“å°å‚æ•°ï¼Œå’Œlinuxé‡Œçš„echoå‘½ä»¤ç±»ä¼¼</span><br><span class="line">grep åŒ¹é…æŸ¥æ‰¾ï¼Œå’Œlinuxé‡Œçš„gepå‘½ä»¤ç±»ä¼¼</span><br><span class="line">tee å¤åˆ¶æ ‡éš¹è¾“å…¥åˆ°æ ‡å‡†è¾“å‡ºå’ŒæŒ‡å®šçš„æ–‡ä»¶ï¼Œå’Œlinuxé‡Œçš„teeå‘½ä»¤ç±»ä¼¼</span><br><span class="line">pwd è¿”å›å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå’Œlinuxå‘½ä»¤ç±»ä¼¼</span><br><span class="line">cls æ¸…ç©ºå½“å‰å±å¹•åŒºåŸŸ</span><br><span class="line">session æŸ¥çœ‹å½“å‰ä¼šè¯çš„ä¿¡æ¯</span><br><span class="line">reset é‡ç½®å¢å¼ºç±»ï¼Œå°†è¢« Arthaså¢å¼ºè¿‡çš„ç±»å…¨éƒ¨è¿˜åŸ, ArthasæœåŠ¡ç«¯å…³é—­æ—¶ä¼šé‡ç½®æ‰€æœ‰å¢å¼ºè¿‡çš„ç±»</span><br><span class="line">version è¾“å‡ºå½“å‰ç›®æ ‡Javaè¿›ç¨‹æ‰€åŠ è½½çš„ Arthasç‰ˆæœ¬å·</span><br><span class="line">history æ‰“å°å‘½ä»¤å†å²</span><br><span class="line">keymap Arthaså¿«æ·é”®åˆ—è¡¨åŠè‡ªå®šä¹‰å¿«æ·é”®</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>jvmç›¸å…³</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dashboard å½“å‰ç³»ç»Ÿçš„å®æ—¶æ•°æ®é¢æ¿</span><br><span class="line">thread æŸ¥çœ‹å½“å‰JVMçš„çº¿ç¨‹å †æ ˆä¿¡æ¯</span><br><span class="line">jvm æŸ¥çœ‹å½“å‰JVMçš„ä¿¡æ¯</span><br><span class="line">sysprop æŸ¥çœ‹å’Œä¿®æ”¹JVMçš„ç³»ç»Ÿå±æ€§</span><br><span class="line">sysem æŸ¥çœ‹JVMçš„ç¯å¢ƒå˜é‡</span><br><span class="line">vmoption æŸ¥çœ‹å’Œä¿®æ”¹JVMé‡Œè¯Šæ–­ç›¸å…³çš„option</span><br><span class="line">perfcounter æŸ¥çœ‹å½“å‰JVMçš„ Perf Counterä¿¡æ¯</span><br><span class="line">logger æŸ¥çœ‹å’Œä¿®æ”¹logger</span><br><span class="line">getstatic æŸ¥çœ‹ç±»çš„é™æ€å±æ€§</span><br><span class="line">ognl æ‰§è¡Œognlè¡¨è¾¾å¼</span><br><span class="line">mbean æŸ¥çœ‹ Mbeançš„ä¿¡æ¯</span><br><span class="line">heapdump dump java heapï¼Œç±»ä¼¼jmapå‘½ä»¤çš„ heap dumpåŠŸèƒ½</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>class/classloaderç›¸å…³</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sc æŸ¥çœ‹JVMå·²åŠ è½½çš„ç±»ä¿¡æ¯</span><br><span class="line">	-d è¾“å‡ºå½“å‰ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªç±»æ‰€åŠ è½½çš„åŸå§‹æ–‡ä»¶æ¥æºã€ç±»çš„å£°æ˜ã€åŠ è½½çš„Classloaderç­‰è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœä¸€ä¸ªç±»è¢«å¤šä¸ªClassloaderæ‰€åŠ è½½ï¼Œåˆ™ä¼šå‡ºç°å¤šæ¬¡</span><br><span class="line">	-E å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</span><br><span class="line">	-f è¾“å‡ºå½“å‰ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼ˆéœ€è¦é…åˆå‚æ•°-dä¸€èµ·ä½¿ç”¨ï¼‰</span><br><span class="line">	-X æŒ‡å®šè¾“å‡ºé™æ€å˜é‡æ—¶å±æ€§çš„éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º0ï¼Œå³ç›´æ¥ä½¿ç”¨toStringè¾“å‡º</span><br><span class="line">sm æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</span><br><span class="line">	-d å±•ç¤ºæ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">	-E å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…,é»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</span><br><span class="line">jad åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç </span><br><span class="line">mc å†…å­˜ç¼–è¯‘å™¨ï¼Œå†…å­˜ç¼–è¯‘.javaæ–‡ä»¶ä¸º.classæ–‡ä»¶</span><br><span class="line">retransform åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶, retransformåˆ°JVMé‡Œ</span><br><span class="line">redefine åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œredefineåˆ°JVMé‡Œ</span><br><span class="line">dump dumpå·²åŠ è½½ç±»çš„byte codeåˆ°ç‰¹å®šç›®å½•</span><br><span class="line">classloader æŸ¥çœ‹classloaderçš„ç»§æ‰¿æ ‘ï¼Œurtsï¼Œç±»åŠ è½½ä¿¡æ¯ï¼Œä½¿ç”¨classloaderå»getResource</span><br><span class="line">	-t æŸ¥çœ‹classloaderçš„ç»§æ‰¿æ ‘</span><br><span class="line">	-l æŒ‰ç±»åŠ è½½å®ä¾‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">	-c ç”¨classloaderå¯¹åº”çš„hashcodeæ¥æŸ¥çœ‹å¯¹åº”çš„ Jar urls</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>monitor/watch/traceç›¸å…³</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">monitor æ–¹æ³•æ‰§è¡Œç›‘æ§ï¼Œè°ƒç”¨æ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ã€å¤±è´¥ç‡</span><br><span class="line">	-c ç»Ÿè®¡å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º120ç§’</span><br><span class="line">watch æ–¹æ³•æ‰§è¡Œè§‚æµ‹ï¼Œèƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™groovyè¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹</span><br><span class="line">	-b åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰è§‚å¯Ÿ(é»˜è®¤å…³é—­)</span><br><span class="line">	-e åœ¨æ–¹æ³•å¼‚å¸¸ä¹‹åè§‚å¯Ÿ(é»˜è®¤å…³é—­)</span><br><span class="line">	-s åœ¨æ–¹æ³•è¿”å›ä¹‹åè§‚å¯Ÿ(é»˜è®¤å…³é—­)</span><br><span class="line">	-f åœ¨æ–¹æ³•ç»“æŸä¹‹å(æ­£å¸¸è¿”å›å’Œå¼‚å¸¸è¿”å›)è§‚å¯Ÿ(é»˜è®¤å¼€å¯)</span><br><span class="line">	-x æŒ‡å®šè¾“å²€ç»“æœçš„å±æ€§éå†æ·±åº¦,é»˜è®¤ä¸º0</span><br><span class="line">trace æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„,å¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</span><br><span class="line">	-n æ‰§è¡Œæ¬¡æ•°é™åˆ¶</span><br><span class="line">stack è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</span><br><span class="line">tt æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“,è®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯,å¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å…¶ä»–</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jobs åˆ—å‡ºæ‰€æœ‰job</span><br><span class="line">kill å¼ºåˆ¶ç»ˆæ­¢ä»»åŠ¡</span><br><span class="line">fg å°†æš‚åœçš„ä»»åŠ¡æ‹‰åˆ°å‰å°æ‰§è¡Œ</span><br><span class="line">bg å°†æš‚åœçš„ä»»åŠ¡æ”¾åˆ°åå°æ‰§è¡Œ</span><br><span class="line">grep æœç´¢æ»¡è¶³æ¡ä»¶çš„ç»“æœ</span><br><span class="line">plaintext å°†å‘½ä»¤çš„ç»“æœå»é™¤ANSIé¢œè‰²</span><br><span class="line">wc æŒ‰è¡Œç»Ÿè®¡è¾“å‡ºç»“æœ</span><br><span class="line">options æŸ¥çœ‹æˆ–è®¾ç½®Arthaså…¨å±€å¼€å…³</span><br><span class="line">profiler ä½¿ç”¨async-profilerå¯¹åº”ç”¨é‡‡æ ·ï¼Œç”Ÿæˆç«ç„°å›¾</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7ï¼ŒJava-Misssion-Control"><a href="#7ï¼ŒJava-Misssion-Control" class="headerlink" title="7ï¼ŒJava Misssion Control"></a>7ï¼ŒJava Misssion Control</h3><p>åœ¨Oracleæ”¶è´­Sunä¹‹å‰ï¼ŒOracleçš„JRockitè™šæ‹Ÿæœºæä¾›äº†ä¸€æ¬¾å«åš JRockit Mission Control çš„è™šæ‹Ÿæœºè¯Šæ–­å·¥å…·ã€‚</p>
<p>åœ¨Oracleæ”¶è´­sunä¹‹åï¼ŒOracleå…¬å¸åŒæ—¶æ‹¥æœ‰äº†Hotspotå’Œ JRockit ä¸¤æ¬¾è™šæ‹Ÿæœºã€‚æ ¹æ®Oracleå¯¹äºJavaçš„æˆ˜ç•¥ï¼Œåœ¨ä»Šåçš„å‘å±•ä¸­ï¼Œä¼šå°†JRokitçš„ä¼˜ç§€ç‰¹æ€§ç§»æ¤åˆ°Hotspotä¸Šã€‚å…¶ä¸­ä¸€ä¸ªé‡è¦çš„æ”¹è¿›å°±æ˜¯åœ¨Sunçš„JDKä¸­åŠ å…¥äº†JRockitçš„æ”¯æŒã€‚</p>
<p>åœ¨Oracle JDK 7u40ä¹‹åï¼ŒMission Controlè¿™æ¬¾å·¥å…·å·±ç»ç»‘å®šåœ¨Oracle JDKä¸­å‘å¸ƒã€‚</p>
<p>è‡ªJava11å¼€å§‹ï¼Œæœ¬èŠ‚ä»‹ç»çš„JFRå·±ç»å¼€æºã€‚ä½†åœ¨ä¹‹å‰çš„Javaç‰ˆæœ¬ï¼ŒJFRå±äºCommercial Featureé€šè¿‡Javaè™šæ‹Ÿæœºå‚æ•°-XX:+UnlockCommercialFeatures å¼€å¯ã€‚</p>
<p>Java Mission Controlï¼ˆç®€ç§°JMC) ï¼Œ Javaå®˜æ–¹æä¾›çš„æ€§èƒ½å¼ºåŠ²çš„å·¥å…·ï¼Œæ˜¯ä¸€ä¸ªç”¨äºå¯¹ Javaåº”ç”¨ç¨‹åºè¿›è¡Œç®¡ç†ã€ç›‘è§†ã€æ¦‚è¦åˆ†æå’Œæ•…éšœæ’é™¤çš„å·¥å…·å¥—ä»¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªGUIå®¢æˆ·ç«¯ä»¥åŠä¼—å¤šç”¨æ¥æ”¶é›†Javaè™šæ‹Ÿæœºæ€§èƒ½æ•°æ®çš„æ’ä»¶å¦‚ JMX Consoleï¼ˆèƒ½å¤Ÿè®¿é—®ç”¨æ¥å­˜æ”¾è™šæ‹Ÿæœºé½ä¸ªäºç³»ç»Ÿè¿è¡Œæ•°æ®çš„MXBeansï¼‰ä»¥åŠè™šæ‹Ÿæœºå†…ç½®çš„é«˜æ•ˆ profiling å·¥å…· Java Flight Recorderï¼ˆJFRï¼‰ã€‚</p>
<p>JMCçš„å¦ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ï¼šé‡‡ç”¨å–æ ·ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ä»£ç æ¤å…¥æŠ€æœ¯ï¼Œå¯¹åº”ç”¨æ€§èƒ½çš„å½±å“éå¸¸éå¸¸å°ï¼Œå®Œå…¨å¯ä»¥å¼€ç€JMCæ¥åšå‹æµ‹ï¼ˆå”¯ä¸€å½±å“å¯èƒ½æ˜¯ full gc å¤šäº†ï¼‰ã€‚</p>
<p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/JDKMissionControl/jmc">https://github.com/JDKMissionControl/jmc</a></p>
<p><img src="/2022/04/18/JVM/1647506359883.png" alt="1647506359883" loading="lazy"></p>
<p><strong>Java Flight Recorder</strong></p>
<p>Java Flight Recorderæ˜¯JMCçš„å…¶ä¸­ä¸€ä¸ªç»„ä»¶ï¼Œèƒ½å¤Ÿä»¥æä½çš„æ€§èƒ½å¼€é”€æ”¶é›†Javaè™šæ‹Ÿæœºçš„æ€§èƒ½æ•°æ®ã€‚ä¸å…¶ä»–å·¥å…·ç›¸æ¯”ï¼ŒJFRçš„æ€§èƒ½å¼€é”€å¾ˆå°ï¼Œåœ¨é»˜è®¤é…ç½®ä¸‹å¹³å‡ä½äº1%ã€‚JFRèƒ½å¤Ÿç›´æ¥è®¿é—®è™šæ‹Ÿæœºå†…çš„æ•Œæ®å¹¶ä¸”ä¸ä¼šå½±å“è™šæ‹Ÿæœºçš„ä¼˜åŒ–ã€‚å› æ­¤å®ƒéå¸¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒä¸‹æ»¡è´Ÿè·è¿è¡Œçš„Javaç¨‹åºã€‚</p>
<p>Java Flight Recorder å’Œ JDK Mission Controlå…±åŒåˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„å·¥å…·é“¾ã€‚JDK Mission Control å¯å¯¹ Java Flight Recorder è¿ç»­æ”¶é›†ä½æ°´å¹³å’Œè¯¦ç»†çš„è¿è¡Œæ—¶ä¿¡æ¯è¿›è¡Œé«˜æ•ˆã€è¯¦ç»†çš„åˆ†æã€‚</p>
<p>å½“å¯ç”¨æ—¶ JFRå°†è®°å½•è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ã€‚å…¶ä¸­åŒ…æ‹¬Javaå±‚é¢çš„äº‹ä»¶å¦‚çº¿ç¨‹äº‹ä»¶ã€é”äº‹ä»¶ï¼Œä»¥åŠJavaè™šæ‹Ÿæœºå†…éƒ¨çš„äº‹ä»¶ï¼Œå¦‚æ–°å»ºå¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å’Œå³æ—¶ç¼–è¯‘äº‹ä»¶ã€‚æŒ‰ç…§å‘ç”Ÿæ—¶æœºä»¥åŠæŒç»­æ—¶é—´æ¥åˆ’åˆ†ï¼ŒJFRçš„äº‹ä»¶å…±æœ‰å››ç§ç±»å‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li><p> ç¬æ—¶äº‹ä»¶ï¼ˆInstant Event) ï¼Œç”¨æˆ·å…³å¿ƒçš„æ˜¯å®ƒä»¬å‘ç”Ÿä¸å¦ï¼Œä¾‹å¦‚å¼‚å¸¸ã€çº¿ç¨‹å¯åŠ¨äº‹ä»¶ã€‚ </p>
</li>
<li><p> æŒç»­äº‹ä»¶(Duration Event) ï¼Œç”¨æˆ·å…³å¿ƒçš„æ˜¯å®ƒä»¬çš„æŒç»­æ—¶é—´ï¼Œä¾‹å¦‚åƒåœ¾å›æ”¶äº‹ä»¶ã€‚ </p>
</li>
<li><p> è®¡æ—¶äº‹ä»¶(Timed Event) ï¼Œæ˜¯æ—¶é•¿è¶…å‡ºæŒ‡å®šé˜ˆå€¼çš„æŒç»­äº‹ä»¶ã€‚ </p>
</li>
<li><p> å–æ ·äº‹ä»¶ï¼ˆSample Event)ï¼Œæ˜¯å‘¨æœŸæ€§å–æ ·çš„äº‹ä»¶ã€‚ </p>
</li>
</ul>
<p>å–æ ·äº‹ä»¶çš„å…¶ä¸­ä¸€ä¸ªå¸¸è§ä¾‹å­ä¾¿æ˜¯æ–¹æ³•æŠ½æ ·ï¼ˆMethod Samplingï¼‰ï¼Œå³æ¯éš”ä¸€æ®µæ—¶é—®ç»Ÿè®¡å„ä¸ªçº¿ç¨‹çš„æ ˆè½¨è¿¹ã€‚å¦‚æœåœ¨è¿™äº›æŠ½æ ·å–å¾—çš„æ ˆè½¨è¿¹ä¸­å­˜åœ¨ä¸€ä¸ªåå¤å‡ºç°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨æµ‹è¯¥æ–¹æ³•æ˜¯çƒ­ç‚¹æ–¹æ³•</p>
<p><img src="/2022/04/18/JVM/1647506408862.png" alt="1647506408862" loading="lazy"></p>
<h3 id="8ï¼Œå…¶ä»–å·¥å…·"><a href="#8ï¼Œå…¶ä»–å·¥å…·" class="headerlink" title="8ï¼Œå…¶ä»–å·¥å…·"></a>8ï¼Œå…¶ä»–å·¥å…·</h3><p><strong>Flame Graphsï¼ˆç«ç„°å›¾ï¼‰</strong></p>
<p>åœ¨è¿½æ±‚æè‡´æ€§èƒ½çš„åœºæ™¯ä¸‹ï¼Œäº†è§£ä½ çš„ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­cpuåœ¨å¹²ä»€ä¹ˆå¾ˆé‡è¦ï¼Œç«ç„°å›¾å°±æ˜¯ä¸€ç§éå¸¸ç›´è§‚çš„å±•ç¤ºCPUåœ¨ç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­æ—¶é—´åˆ†é…çš„å·¥å…·ã€‚ç«ç„°å›¾å¯¹äºç°ä»£çš„ç¨‹åºå‘˜ä¸åº”è¯¥é™Œç”Ÿï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥éå¸¸ç›´è§‚çš„æ˜¾ç¤ºå‡ºè°ƒç”¨æ‰¾ä¸­çš„CPUæ¶ˆè€—ç“¶é¢ˆã€‚</p>
<p>ç½‘ä¸Šçš„å…³äºJavaç«ç„°å›¾çš„è®²è§£å¤§éƒ¨åˆ†æ¥è‡ªäºBrenden Greggçš„åšå®¢ <a target="_blank" rel="noopener" href="http://new.brendangregg.com/flamegraphs.html">http://new.brendangregg.com/flamegraphs.html </a></p>
<p><img src="/2022/04/18/JVM/1647506488619.png" alt="1647506488619" loading="lazy"></p>
<p>ç«ç„°å›¾ï¼Œç®€å•é€šè¿‡xè½´æ¨ªæ¡å®½åº¦æ¥åº¦é‡æ—¶é—´æŒ‡æ ‡ï¼Œyè½´ä»£è¡¨çº¿ç¨‹æ ˆçš„å±‚æ¬¡ã€‚</p>
<p><strong>Tprofiler</strong></p>
<p>æ¡ˆä¾‹ï¼š ä½¿ç”¨JDKè‡ªèº«æä¾›çš„å·¥å…·è¿›è¡ŒJVMè°ƒä¼˜å¯ä»¥å°†ä¸‹ TPS ç”±2.5æå‡åˆ°20ï¼ˆæå‡äº†7å€ï¼‰ï¼Œå¹¶å‡†ç¡® å®šä½ç³»ç»Ÿç“¶é¢ˆã€‚</p>
<p>ç³»ç»Ÿç“¶é¢ˆæœ‰ï¼šåº”ç”¨é‡Œé‡Šæ€å¯¹è±¡ä¸æ˜¯å¤ªå¤šã€æœ‰å¤§é‡çš„ä¸šåŠ¡çº¿ç¨‹åœ¨é¢‘ç¹åˆ›å»ºä¸€äº›ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿çš„ä¸´æ—¶å¯¹è±¡ï¼Œä»£ç é‡Œæœ‰é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨æµ·é‡ä¸šåŠ¡ä»£ç é‡Œè¾¹å‡†ç¡®å®šä½è¿™äº›æ€§èƒ½ä»£ç ï¼Ÿè¿™é‡Œä½¿ç”¨é˜¿é‡Œå¼€æºå·¥å…· Tprofiler æ¥å®šä½ è¿™äº›æ€§èƒ½ä»£ç ï¼ŒæˆåŠŸè§£å†³æ‰äº†GC è¿‡äºé¢‘ç¹çš„æ€§èƒ½ç“¶é¢„ï¼Œå¹¶æœ€ç»ˆåœ¨ä¸Šæ¬¡ä¼˜åŒ–çš„åŸºç¡€ä¸Šå°† TPS å†æå‡äº†4å€ï¼Œå³æå‡åˆ°100ã€‚</p>
<ul>
<li><p>Tprofileré…ç½®éƒ¨ç½²ã€è¿œç¨‹æ“ä½œã€ æ—¥å¿—é˜…è°ˆéƒ½ä¸å¤ªå¤æ‚ï¼Œæ“ä½œè¿˜æ˜¯å¾ˆç®€å•çš„ã€‚ä½†æ˜¯å…¶å´æ˜¯èƒ½å¤Ÿ èµ·åˆ°ä¸€é’ˆè§è¡€ã€ç«‹ç«¿è§å½±çš„æ•ˆæœï¼Œå¸®æˆ‘ä»¬è§£å†³äº†GCè¿‡äºé¢‘ç¹çš„æ€§èƒ½ç“¶é¢„ã€‚</p>
</li>
<li><p>Tprofileræœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯èƒ½å¤Ÿç»Ÿæ±å‡ºä½ æŒ‡å®šæ—¶é—´æ®µå†… JVM çš„ top method è¿™äº› top method ææœ‰å¯èƒ½å°±æ˜¯é€ æˆä½  JVM æ€§èƒ½ç“¶é¢ˆçš„å…ƒå‡¶ã€‚è¿™æ˜¯å…¶ä»–å¤§å¤šæ•° JVM è°ƒä¼˜å·¥å…·æ‰€ä¸å…·å¤‡çš„ï¼ŒåŒ…æ‹¬ JRockit Mission Controlã€‚JRokit é¦–å¸­å¼€å‘è€… Marcus Hirt åœ¨å…¶ç§äººåšå®¢ã€Š Lom Overhead Method Profiling cith Java Mission Controlã€‹ä¸‹çš„è¯„è®ºä¸­æ›¾æ˜ç¡®æŒ‡å‡º  JRMC äº•ä¸æ”¯æŒ TOP æ–¹æ³•çš„ç»Ÿè®¡ã€‚</p>
</li>
</ul>
<p>å®˜æ–¹åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://github.com/alibaba/Tprofiler">http://github.com/alibaba/Tprofiler</a></p>
<p><strong>Btrace</strong></p>
<p>å¸¸è§çš„åŠ¨æ€è¿½è¸ªå·¥å…·æœ‰BTraceã€HouseHDï¼ˆè¯¥é¡¹ç›®å·±ç»åœæ­¢å¼€å‘ï¼‰ã€Greys-Anatomyï¼ˆå›½äººå¼€å‘ ä¸ªäººå¼€å‘è€…ï¼‰ã€Bytemanï¼ˆJBosså‡ºå“ï¼‰ï¼Œæ³¨æ„Javaè¿è¡Œæ—¶è¿½è¸ªå·¥å…·äº•ä¸é™å¹²è¿™å‡ ç§ï¼Œä½†æ˜¯è¿™å‡ ä¸ªæ˜¯ç›¸å¯¹æ¯”è¾ƒå¸¸ç”¨çš„ã€‚</p>
<p>BTraceæ˜¯SUN Kenai äº‘è®¡ç®—å¼€å‘å¹³å°ä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨ä¸ºjavaæä¾›å®‰å…¨å¯é çš„åŠ¨æ€è·Ÿè¸ªåˆ†æå·¥å…·ã€‚å…ˆçœ‹ä¸€åœæ—¥Traceçš„å®˜æ–¹å®šä¹‰ï¼š</p>
<p><img src="/2022/04/18/JVM/1647506515702.png" alt="1647506515702" loading="lazy"></p>
<p>å¤§æ¦‚æ„æ€æ˜¯ä¸€ä¸ª Java å¹³å°çš„å®‰å…¨çš„åŠ¨æ€è¿½è¸ªå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åŠ¨æ€åœ°è¿½è¸ªä¸€ä¸ªè¿è¡Œçš„ Java ç¨‹åºã€‚BTraceåŠ¨æ€è°ƒæ•´ç›®æ ‡åº”ç”¨ç¨‹åºçš„ç±»ä»¥æ³¨å…¥è·Ÿè¸ªä»£ç ï¼ˆâ€œå­—èŠ‚ç è·Ÿè¸ªâ€œï¼‰ã€‚</p>
<p><strong>YourKit</strong></p>
<p><strong>JProbe</strong></p>
<p><strong>Spring Insight</strong></p>
<h2 id="å››ï¼Œ-JVMè¿è¡Œæ—¶å‚æ•°"><a href="#å››ï¼Œ-JVMè¿è¡Œæ—¶å‚æ•°" class="headerlink" title="å››ï¼Œ JVMè¿è¡Œæ—¶å‚æ•°"></a>å››ï¼Œ <strong>JVMè¿è¡Œæ—¶å‚æ•°</strong></h2><h3 id="1ï¼Œ-JVMè¿è¡Œæ—¶å‚æ•°"><a href="#1ï¼Œ-JVMè¿è¡Œæ—¶å‚æ•°" class="headerlink" title="1ï¼Œ JVMè¿è¡Œæ—¶å‚æ•°"></a>1ï¼Œ <strong>JVMè¿è¡Œæ—¶å‚æ•°</strong></h3><p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html</a></p>
<h4 id="1-1ï¼Œç±»å‹ä¸€ï¼šæ ‡å‡†å‚æ•°é€‰é¡¹"><a href="#1-1ï¼Œç±»å‹ä¸€ï¼šæ ‡å‡†å‚æ•°é€‰é¡¹" class="headerlink" title="1.1ï¼Œç±»å‹ä¸€ï¼šæ ‡å‡†å‚æ•°é€‰é¡¹"></a>1.1ï¼Œç±»å‹ä¸€ï¼šæ ‡å‡†å‚æ•°é€‰é¡¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">java -<span class="built_in">help</span></span></span><br><span class="line">ç”¨æ³•: java [-options] class [args...]</span><br><span class="line">           (æ‰§è¡Œç±»)</span><br><span class="line">   æˆ–  java [-options] -jar jarfile [args...]</span><br><span class="line">           (æ‰§è¡Œ jar æ–‡ä»¶)</span><br><span class="line">å…¶ä¸­é€‰é¡¹åŒ…æ‹¬:</span><br><span class="line">    -d32          ä½¿ç”¨ 32 ä½æ•°æ®æ¨¡å‹ (å¦‚æœå¯ç”¨)</span><br><span class="line">    -d64          ä½¿ç”¨ 64 ä½æ•°æ®æ¨¡å‹ (å¦‚æœå¯ç”¨)</span><br><span class="line">    -server       é€‰æ‹© &quot;server&quot; VM</span><br><span class="line">                  é»˜è®¤ VM æ˜¯ server.</span><br><span class="line"></span><br><span class="line">    -cp &lt;ç›®å½•å’Œ zip/jar æ–‡ä»¶çš„ç±»æœç´¢è·¯å¾„&gt;</span><br><span class="line">    -classpath &lt;ç›®å½•å’Œ zip/jar æ–‡ä»¶çš„ç±»æœç´¢è·¯å¾„&gt;</span><br><span class="line">                  ç”¨ ; åˆ†éš”çš„ç›®å½•, JAR æ¡£æ¡ˆ</span><br><span class="line">                  å’Œ ZIP æ¡£æ¡ˆåˆ—è¡¨, ç”¨äºæœç´¢ç±»æ–‡ä»¶ã€‚</span><br><span class="line">    -D&lt;åç§°&gt;=&lt;å€¼&gt;</span><br><span class="line">                  è®¾ç½®ç³»ç»Ÿå±æ€§</span><br><span class="line">    -verbose:[class|gc|jni]</span><br><span class="line">                  å¯ç”¨è¯¦ç»†è¾“å‡º</span><br><span class="line">    -version      è¾“å‡ºäº§å“ç‰ˆæœ¬å¹¶é€€å‡º</span><br><span class="line">    -version:&lt;å€¼&gt;</span><br><span class="line">                  è­¦å‘Š: æ­¤åŠŸèƒ½å·²è¿‡æ—¶, å°†åœ¨</span><br><span class="line">                  æœªæ¥å‘è¡Œç‰ˆä¸­åˆ é™¤ã€‚</span><br><span class="line">                  éœ€è¦æŒ‡å®šçš„ç‰ˆæœ¬æ‰èƒ½è¿è¡Œ</span><br><span class="line">    -showversion  è¾“å‡ºäº§å“ç‰ˆæœ¬å¹¶ç»§ç»­</span><br><span class="line">    -jre-restrict-search | -no-jre-restrict-search</span><br><span class="line">                  è­¦å‘Š: æ­¤åŠŸèƒ½å·²è¿‡æ—¶, å°†åœ¨</span><br><span class="line">                  æœªæ¥å‘è¡Œç‰ˆä¸­åˆ é™¤ã€‚</span><br><span class="line">                  åœ¨ç‰ˆæœ¬æœç´¢ä¸­åŒ…æ‹¬/æ’é™¤ç”¨æˆ·ä¸“ç”¨ JRE</span><br><span class="line">    -? -help      è¾“å‡ºæ­¤å¸®åŠ©æ¶ˆæ¯</span><br><span class="line">    -X            è¾“å‡ºéæ ‡å‡†é€‰é¡¹çš„å¸®åŠ©</span><br><span class="line">    -ea[:&lt;packagename&gt;...|:&lt;classname&gt;]</span><br><span class="line">    -enableassertions[:&lt;packagename&gt;...|:&lt;classname&gt;]</span><br><span class="line">                  æŒ‰æŒ‡å®šçš„ç²’åº¦å¯ç”¨æ–­è¨€</span><br><span class="line">    -da[:&lt;packagename&gt;...|:&lt;classname&gt;]</span><br><span class="line">    -disableassertions[:&lt;packagename&gt;...|:&lt;classname&gt;]</span><br><span class="line">                  ç¦ç”¨å…·æœ‰æŒ‡å®šç²’åº¦çš„æ–­è¨€</span><br><span class="line">    -esa | -enablesystemassertions</span><br><span class="line">                  å¯ç”¨ç³»ç»Ÿæ–­è¨€</span><br><span class="line">    -dsa | -disablesystemassertions</span><br><span class="line">                  ç¦ç”¨ç³»ç»Ÿæ–­è¨€</span><br><span class="line">    -agentlib:&lt;libname&gt;[=&lt;é€‰é¡¹&gt;]</span><br><span class="line">                  åŠ è½½æœ¬æœºä»£ç†åº“ &lt;libname&gt;, ä¾‹å¦‚ -agentlib:hprof</span><br><span class="line">                  å¦è¯·å‚é˜… -agentlib:jdwp=help å’Œ -agentlib:hprof=help</span><br><span class="line">    -agentpath:&lt;pathname&gt;[=&lt;é€‰é¡¹&gt;]</span><br><span class="line">                  æŒ‰å®Œæ•´è·¯å¾„ååŠ è½½æœ¬æœºä»£ç†åº“</span><br><span class="line">    -javaagent:&lt;jarpath&gt;[=&lt;é€‰é¡¹&gt;]</span><br><span class="line">                  åŠ è½½ Java ç¼–ç¨‹è¯­è¨€ä»£ç†, è¯·å‚é˜… java.lang.instrument</span><br><span class="line">    -splash:&lt;imagepath&gt;</span><br><span class="line">                  ä½¿ç”¨æŒ‡å®šçš„å›¾åƒæ˜¾ç¤ºå¯åŠ¨å±å¹•</span><br><span class="line">æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜… http://www.oracle.com/technetwork/java/javase/documentation/index.htmlã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Serveræ¨¡å¼å’ŒClientæ¨¡å¼</strong></p>
<p>Hotspot JVMæœ‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯serverå’Œclientï¼Œåˆ†åˆ«é€šè¿‡-serverå’Œ-clientæ¨¡å¼è®¾ç½®</p>
<ul>
<li><p>32ä½ç³»ç»Ÿä¸Šï¼Œé»˜è®¤ä½¿ç”¨Clientç±»å‹çš„JVMã€‚è¦æƒ³ä½¿ç”¨Serveræ¨¡å¼ï¼Œæœºå™¨é…ç½®è‡³å°‘æœ‰2ä¸ªä»¥ä¸Šçš„CPUå’Œ2Gä»¥ä¸Šçš„ç‰©ç†å†…å­˜ã€‚clientæ¨¡å¼é€‚ç”¨äºå¯¹å†…å­˜è¦æ±‚è¾ƒå°çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œé»˜è®¤ä½¿ç”¨Serialä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</p>
</li>
<li><p>64ä½ç³»ç»Ÿä¸Šï¼Œåªæ”¯æŒserveræ¨¡å¼çš„JVMï¼Œé€‚ç”¨äºéœ€è¦å¤§å†…å­˜çš„åº”ç”¨ç¨‹åºï¼Œé»˜è®¤ä½¿ç”¨å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</p>
</li>
</ul>
<p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/server-class.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/server-class.html</a></p>
<p>å¦‚ä½•çŸ¥é“ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ˜¯é‚£ç§æ¨¡å¼å‘¢ï¼Ÿ</p>
<p>é€šè¿‡java -versionå‘½ä»¤ï¼šå¯ä»¥çœ‹åˆ°Server VMå­—æ ·ï¼Œä»£è¡¨å½“å‰ç³»ç»Ÿä½¿ç”¨æ˜¯Serveræ¨¡å¼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">java -version</span></span><br><span class="line">java version &quot;1.8.0_201&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_201-b09)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2ï¼Œç±»å‹äºŒï¼š-Xå‚æ•°é€‰é¡¹"><a href="#1-2ï¼Œç±»å‹äºŒï¼š-Xå‚æ•°é€‰é¡¹" class="headerlink" title="1.2ï¼Œç±»å‹äºŒï¼š-Xå‚æ•°é€‰é¡¹"></a>1.2ï¼Œç±»å‹äºŒï¼š-Xå‚æ•°é€‰é¡¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">java -X</span></span><br><span class="line">    -Xmixed           æ··åˆæ¨¡å¼æ‰§è¡Œ (é»˜è®¤)</span><br><span class="line">    -Xint             ä»…è§£é‡Šæ¨¡å¼æ‰§è¡Œ</span><br><span class="line">    -Xbootclasspath:&lt;ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶&gt;</span><br><span class="line">                      è®¾ç½®æœç´¢è·¯å¾„ä»¥å¼•å¯¼ç±»å’Œèµ„æº</span><br><span class="line">    -Xbootclasspath/a:&lt;ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶&gt;</span><br><span class="line">                      é™„åŠ åœ¨å¼•å¯¼ç±»è·¯å¾„æœ«å°¾</span><br><span class="line">    -Xbootclasspath/p:&lt;ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶&gt;</span><br><span class="line">                      ç½®äºå¼•å¯¼ç±»è·¯å¾„ä¹‹å‰</span><br><span class="line">    -Xdiag            æ˜¾ç¤ºé™„åŠ è¯Šæ–­æ¶ˆæ¯</span><br><span class="line">    -Xnoclassgc       ç¦ç”¨ç±»åƒåœ¾æ”¶é›†</span><br><span class="line">    -Xincgc           å¯ç”¨å¢é‡åƒåœ¾æ”¶é›†</span><br><span class="line">    -Xloggc:&lt;file&gt;    å°† GC çŠ¶æ€è®°å½•åœ¨æ–‡ä»¶ä¸­ (å¸¦æ—¶é—´æˆ³)</span><br><span class="line">    -Xbatch           ç¦ç”¨åå°ç¼–è¯‘</span><br><span class="line">    -Xms&lt;size&gt;        è®¾ç½®åˆå§‹ Java å †å¤§å°</span><br><span class="line">    -Xmx&lt;size&gt;        è®¾ç½®æœ€å¤§ Java å †å¤§å°</span><br><span class="line">    -Xss&lt;size&gt;        è®¾ç½® Java çº¿ç¨‹å †æ ˆå¤§å°</span><br><span class="line">    -Xprof            è¾“å‡º cpu é…ç½®æ–‡ä»¶æ•°æ®</span><br><span class="line">    -Xfuture          å¯ç”¨æœ€ä¸¥æ ¼çš„æ£€æŸ¥, é¢„æœŸå°†æ¥çš„é»˜è®¤å€¼</span><br><span class="line">    -Xrs              å‡å°‘ Java/VM å¯¹æ“ä½œç³»ç»Ÿä¿¡å·çš„ä½¿ç”¨ (è¯·å‚é˜…æ–‡æ¡£)</span><br><span class="line">    -Xcheck:jni       å¯¹ JNI å‡½æ•°æ‰§è¡Œå…¶ä»–æ£€æŸ¥</span><br><span class="line">    -Xshare:off       ä¸å°è¯•ä½¿ç”¨å…±äº«ç±»æ•°æ®</span><br><span class="line">    -Xshare:auto      åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨å…±äº«ç±»æ•°æ® (é»˜è®¤)</span><br><span class="line">    -Xshare:on        è¦æ±‚ä½¿ç”¨å…±äº«ç±»æ•°æ®, å¦åˆ™å°†å¤±è´¥ã€‚</span><br><span class="line">    -XshowSettings    æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®å¹¶ç»§ç»­</span><br><span class="line">    -XshowSettings:all</span><br><span class="line">                      æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®å¹¶ç»§ç»­</span><br><span class="line">    -XshowSettings:vm æ˜¾ç¤ºæ‰€æœ‰ä¸ vm ç›¸å…³çš„è®¾ç½®å¹¶ç»§ç»­</span><br><span class="line">    -XshowSettings:properties</span><br><span class="line">                      æ˜¾ç¤ºæ‰€æœ‰å±æ€§è®¾ç½®å¹¶ç»§ç»­</span><br><span class="line">    -XshowSettings:locale</span><br><span class="line">                      æ˜¾ç¤ºæ‰€æœ‰ä¸åŒºåŸŸè®¾ç½®ç›¸å…³çš„è®¾ç½®å¹¶ç»§ç»­</span><br><span class="line"></span><br><span class="line">-X é€‰é¡¹æ˜¯éæ ‡å‡†é€‰é¡¹, å¦‚æœ‰æ›´æ”¹, æ•ä¸å¦è¡Œé€šçŸ¥ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•çŸ¥é“JVMé»˜è®¤ä½¿ç”¨çš„æ˜¯æ··åˆæ¨¡å¼å‘¢ï¼Ÿ</p>
<p>åŒæ ·åœ°ï¼Œé€šè¿‡java -versionå‘½ä»¤ï¼šå¯ä»¥çœ‹åˆ° mixed mode å­—æ ·ï¼Œä»£è¡¨å½“å‰ç³»ç»Ÿä½¿ç”¨çš„æ˜¯æ··åˆæ¨¡å¼</p>
<h4 id="1-3ï¼Œç±»å‹ä¸‰ï¼š-XXå‚æ•°é€‰é¡¹"><a href="#1-3ï¼Œç±»å‹ä¸‰ï¼š-XXå‚æ•°é€‰é¡¹" class="headerlink" title="1.3ï¼Œç±»å‹ä¸‰ï¼š-XXå‚æ•°é€‰é¡¹"></a>1.3ï¼Œç±»å‹ä¸‰ï¼š-XXå‚æ•°é€‰é¡¹</h4><p><strong>Booleanç±»å‹æ ¼å¼</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+&lt;option&gt;  å¯ç”¨optionå±æ€§</span><br><span class="line">-XX:-&lt;option&gt;  ç¦ç”¨optionå±æ€§</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>éBooleanç±»å‹æ ¼å¼</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:&lt;option&gt;=&lt;number&gt;  è®¾ç½®optionæ•°å€¼ï¼Œå¯ä»¥å¸¦å•ä½å¦‚k/K/m/M/g/G</span><br><span class="line">-XX:&lt;option&gt;=&lt;string&gt;  è®¾ç½®optionå­—ç¬¦å€¼</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼Œæ·»åŠ JVMå‚æ•°é€‰é¡¹"><a href="#2ï¼Œæ·»åŠ JVMå‚æ•°é€‰é¡¹" class="headerlink" title="2ï¼Œæ·»åŠ JVMå‚æ•°é€‰é¡¹"></a>2ï¼Œæ·»åŠ JVMå‚æ•°é€‰é¡¹</h3><p>eclipseå’Œideaä¸­é…ç½®ä¸å¿…å¤šè¯´ï¼Œåœ¨Run Configurationsä¸­VM Optionsä¸­é…ç½®å³å¯ï¼Œå¤§åŒå°å¼‚</p>
<p><strong>è¿è¡ŒjaråŒ…</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -Xms100m -Xmx100m -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -jar demo.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Tomcatè¿è¡ŒwaråŒ…</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">linuxä¸‹catalina.shæ·»åŠ </span></span><br><span class="line">JAVA_OPTS=&quot;-Xms512M -Xmx1024M&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">windowsä¸‹catalina.batæ·»åŠ </span></span><br><span class="line">set &quot;JAVA_OPTS=-Xms512M -Xmx1024M&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ç¨‹åºè¿è¡Œä¸­</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®Booleanç±»å‹å‚æ•°</span></span><br><span class="line">jinfo -flag [+|-]&lt;name&gt; &lt;pid&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®éBooleanç±»å‹å‚æ•°</span></span><br><span class="line">jinfo -flag &lt;name&gt;=&lt;value&gt; &lt;pid&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹"><a href="#3ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹" class="headerlink" title="3ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹"></a>3ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹</h3><h4 id="3-1ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹"><a href="#3-1ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹" class="headerlink" title="3.1ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹"></a>3.1ï¼Œå¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintCommandLineFlags ç¨‹åºè¿è¡Œæ—¶JVMé»˜è®¤è®¾ç½®æˆ–ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®çš„XXé€‰é¡¹</span><br><span class="line">-XX:+PrintFlagsInitial æ‰“å°æ‰€æœ‰XXé€‰é¡¹çš„é»˜è®¤å€¼</span><br><span class="line">-XX:+PrintFlagsFinal æ‰“å°æ‰€æœ‰XXé€‰é¡¹çš„å®é™…å€¼</span><br><span class="line">-XX:+PrintVMOptions æ‰“å°JVMçš„å‚æ•°</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®"><a href="#3-2ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®" class="headerlink" title="3.2ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®"></a>3.2ï¼Œå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ˆ</span></span><br><span class="line">-Xss128k &lt;==&gt; -XX:ThreadStackSize=128k è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°ä¸º128K</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å †</span></span><br><span class="line">-Xms2048m &lt;==&gt; -XX:InitialHeapSize=2048m è®¾ç½®JVMåˆå§‹å †å†…å­˜ä¸º2048M</span><br><span class="line">-Xmx2048m &lt;==&gt; -XX:MaxHeapSize=2048m è®¾ç½®JVMæœ€å¤§å †å†…å­˜ä¸º2048M</span><br><span class="line">-Xmn2g &lt;==&gt; -XX:NewSize=2g -XX:MaxNewSize=2g è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2G</span><br><span class="line">-XX:SurvivorRatio=8 è®¾ç½®EdenåŒºä¸SurvivoråŒºçš„æ¯”å€¼ï¼Œé»˜è®¤ä¸º8</span><br><span class="line">-XX:NewRatio=2 è®¾ç½®è€å¹´ä»£ä¸å¹´è½»ä»£çš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º2</span><br><span class="line">-XX:+UseAdaptiveSizePolicy è®¾ç½®å¤§å°æ¯”ä¾‹è‡ªé€‚åº”ï¼Œé»˜è®¤å¼€å¯</span><br><span class="line">-XX:PretenureSizeThreadshold=1024 è®¾ç½®è®©å¤§äºæ­¤é˜ˆå€¼çš„å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ï¼Œåªå¯¹Serialã€ParNewæ”¶é›†å™¨æœ‰æ•ˆ</span><br><span class="line">-XX:MaxTenuringThreshold=15 è®¾ç½®æ–°ç”Ÿä»£æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é™åˆ¶ï¼Œé»˜è®¤ä¸º15</span><br><span class="line">-XX:TargetSurvivorRatio è®¾ç½®MinorGCç»“æŸåSurvivoråŒºå ç”¨ç©ºé—´çš„æœŸæœ›æ¯”ä¾‹</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–¹æ³•åŒº</span></span><br><span class="line">-XX:MetaspaceSize / -XX:PermSize=256m è®¾ç½®å…ƒç©ºé—´/æ°¸ä¹…ä»£åˆå§‹å€¼ä¸º256M</span><br><span class="line">-XX:MaxMetaspaceSize / -XX:MaxPermSize=256m è®¾ç½®å…ƒç©ºé—´/æ°¸ä¹…ä»£æœ€å¤§å€¼ä¸º256M</span><br><span class="line">-XX:+UseCompressedOops ä½¿ç”¨å‹ç¼©å¯¹è±¡</span><br><span class="line">-XX:+UseCompressedClassPointers ä½¿ç”¨å‹ç¼©ç±»æŒ‡é’ˆ</span><br><span class="line">-XX:CompressedClassSpaceSize è®¾ç½®Klass Metaspaceçš„å¤§å°ï¼Œé»˜è®¤1G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›´æ¥å†…å­˜</span></span><br><span class="line">-XX:MaxDirectMemorySize æŒ‡å®šDirectMemoryå®¹é‡ï¼Œé»˜è®¤ç­‰äºJavaå †æœ€å¤§å€¼</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-3ï¼ŒOutOfMemoryç›¸å…³çš„é€‰é¡¹"><a href="#3-3ï¼ŒOutOfMemoryç›¸å…³çš„é€‰é¡¹" class="headerlink" title="3.3ï¼ŒOutOfMemoryç›¸å…³çš„é€‰é¡¹"></a>3.3ï¼ŒOutOfMemoryç›¸å…³çš„é€‰é¡¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-XX:+HeapDumpOnOutMemoryError å†…å­˜å‡ºç°OOMæ—¶ç”ŸæˆHeapè½¬å‚¨æ–‡ä»¶ï¼Œä¸¤è€…äº’æ–¥</span><br><span class="line">-XX:+HeapDumpBeforeFullGC å‡ºç°FullGCæ—¶ç”ŸæˆHeapè½¬å‚¨æ–‡ä»¶ï¼Œä¸¤è€…äº’æ–¥</span><br><span class="line">-XX:HeapDumpPath=&lt;path&gt; æŒ‡å®šheapè½¬å‚¨æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å½“å‰ç›®å½•</span><br><span class="line">-XX:OnOutOfMemoryError=&lt;path&gt; æŒ‡å®šå¯è¡Œæ€§ç¨‹åºæˆ–è„šæœ¬çš„è·¯å¾„ï¼Œå½“å‘ç”ŸOOMæ—¶æ‰§è¡Œè„šæœ¬</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-4ï¼Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹"><a href="#3-4ï¼Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹" class="headerlink" title="3.4ï¼Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹"></a>3.4ï¼Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹</h4><p>é¦–å…ˆéœ€äº†è§£åƒåœ¾æ”¶é›†å™¨ä¹‹é—´çš„æ­é…ä½¿ç”¨å…³ç³»</p>
<ul>
<li><p>çº¢è‰²è™šçº¿è¡¨ç¤ºåœ¨jdk8æ—¶è¢«Deprecateï¼Œjdk9æ—¶è¢«åˆ é™¤</p>
</li>
<li><p>ç»¿è‰²è™šçº¿è¡¨ç¤ºåœ¨jdk14æ—¶è¢«Deprecate</p>
</li>
<li><p>ç»¿è‰²è™šæ¡†è¡¨ç¤ºåœ¨jdk9æ—¶è¢«Deprecateï¼Œjdk14æ—¶è¢«åˆ é™¤</p>
</li>
</ul>
<p><img src="/2022/04/18/JVM/1647506905752.png" alt="1647506905752" loading="lazy"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Serialå›æ”¶å™¨</span></span><br><span class="line">-XX:+UseSerialGC  å¹´è½»ä»£ä½¿ç”¨Serial GCï¼Œ è€å¹´ä»£ä½¿ç”¨Serial Old GC</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ParNewå›æ”¶å™¨</span></span><br><span class="line">-XX:+UseParNewGC  å¹´è½»ä»£ä½¿ç”¨ParNew GC</span><br><span class="line">-XX:ParallelGCThreads  è®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚</span><br><span class="line">	ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸CPUæ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/1647506927155.png" alt="1647506927155" loading="lazy"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Parallelå›æ”¶å™¨</span></span><br><span class="line">-XX:+UseParallelGC  å¹´è½»ä»£ä½¿ç”¨ Parallel Scavenge GCï¼Œäº’ç›¸æ¿€æ´»</span><br><span class="line">-XX:+UseParallelOldGC  è€å¹´ä»£ä½¿ç”¨ Parallel Old GCï¼Œäº’ç›¸æ¿€æ´»</span><br><span class="line">-XX:ParallelGCThreads</span><br><span class="line">-XX:MaxGCPauseMillis  è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STWçš„æ—¶é—´ï¼‰ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</span><br><span class="line">	ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨MaxGCPauseMillsä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´Javaå †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚</span><br><span class="line">	å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ï¼›ä½†æ˜¯æœåŠ¡å™¨ç«¯æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡ã€‚</span><br><span class="line">	æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆParallelï¼Œè¿›è¡Œæ§åˆ¶ã€‚è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…ã€‚</span><br><span class="line">-XX:GCTimeRatio  åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼ˆ1 / (Nï¼‹1)ï¼‰ï¼Œç”¨äºè¡¡é‡ååé‡çš„å¤§å°</span><br><span class="line">	å–å€¼èŒƒå›´ï¼ˆ0,100ï¼‰ï¼Œé»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡1ï¼…ã€‚</span><br><span class="line">	ä¸å‰ä¸€ä¸ª-XXï¼šMaxGCPauseMilliså‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ã€‚æš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadioå‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚</span><br><span class="line">-XX:+UseAdaptiveSizePolicy  è®¾ç½®Parallel Scavengeæ”¶é›†å™¨å…·æœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</span><br><span class="line">	åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Edenå’ŒSurvivorçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œä»¥è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚</span><br><span class="line">	åœ¨æ‰‹åŠ¨è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ï¼ˆGCTimeRatioï¼‰å’Œåœé¡¿æ—¶é—´ï¼ˆMaxGCPauseMillsï¼‰ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMSå›æ”¶å™¨</span></span><br><span class="line">-XX:+UseConcMarkSweepGC  å¹´è½»ä»£ä½¿ç”¨CMS GCã€‚</span><br><span class="line">	å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†-XXï¼šï¼‹UseParNewGCæ‰“å¼€ã€‚å³ï¼šParNewï¼ˆYoungåŒºï¼‰+ CMSï¼ˆOldåŒºï¼‰+ Serial Oldçš„ç»„åˆ</span><br><span class="line">-XX:CMSInitiatingOccupanyFraction  è®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼ŒDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92ï¼…ã€‚</span><br><span class="line">	å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ï¼Œå¤§çš„é˜ˆå€¼å¯ä»¥æœ‰æ•ˆé™ä½CMSçš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</span><br><span class="line">	åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚</span><br><span class="line">	å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½Fu1l GCçš„æ‰§è¡Œæ¬¡æ•°ã€‚</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly  æ˜¯å¦åŠ¨æ€å¯è°ƒï¼Œä½¿CMSä¸€ç›´æŒ‰CMSInitiatingOccupancyFractionè®¾å®šçš„å€¼å¯åŠ¨</span><br><span class="line">-XX:+UseCMSCompactAtFullCollection  ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®ŒFull GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†</span><br><span class="line">	ä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚ä¸è¿‡ç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿äº†ã€‚</span><br><span class="line">-XX:CMSFullGCsBeforeCompaction  è®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡Full GCåå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ã€‚</span><br><span class="line">-XX:ParallelCMSThreads  è®¾ç½®CMSçš„çº¿ç¨‹æ•°é‡ã€‚</span><br><span class="line">	CMS é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯(ParallelGCThreadsï¼‹3)/4ï¼ŒParallelGCThreads æ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚</span><br><span class="line">	å½“CPU èµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ°CMSæ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚</span><br><span class="line">-XX:ConcGCThreads  è®¾ç½®å¹¶å‘åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤è¯¥å€¼æ˜¯åŸºäºParallelGCThreadsè®¡ç®—å‡ºæ¥çš„</span><br><span class="line">-XX:+CMSScavengeBeforeRemark  å¼ºåˆ¶hotspotåœ¨cms remarké˜¶æ®µä¹‹å‰åšä¸€æ¬¡minor gcï¼Œç”¨äºæé«˜remarké˜¶æ®µçš„é€Ÿåº¦</span><br><span class="line">-XX:+CMSClassUnloadingEnable  å¦‚æœæœ‰çš„è¯ï¼Œå¯ç”¨å›æ”¶Perm åŒºï¼ˆJDK8ä¹‹å‰ï¼‰</span><br><span class="line">-XX:+CMSParallelInitialEnabled  ç”¨äºå¼€å¯CMS initial-marké˜¶æ®µé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼è¿›è¡Œæ ‡è®°</span><br><span class="line">	ç”¨äºæé«˜æ ‡è®°é€Ÿåº¦ï¼Œåœ¨Java8å¼€å§‹å·²ç»é»˜è®¤å¼€å¯</span><br><span class="line">-XX:+CMSParallelRemarkEnabled  ç”¨æˆ·å¼€å¯CMS remarké˜¶æ®µé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼è¿›è¡Œé‡æ–°æ ‡è®°ï¼Œé»˜è®¤å¼€å¯</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses</span><br><span class="line">	è¿™ä¸¤ä¸ªå‚æ•°ç”¨æˆ·æŒ‡å®šhotspotè™šæ‹Ÿåœ¨æ‰§è¡ŒSystem.gc()æ—¶ä½¿ç”¨CMSå‘¨æœŸ</span><br><span class="line">-XX:+CMSPrecleaningEnabled  æŒ‡å®šCMSæ˜¯å¦éœ€è¦è¿›è¡ŒPre cleaningé˜¶æ®µ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">G1å›æ”¶å™¨</span></span><br><span class="line">-XX:+UseG1GC æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨G1æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</span><br><span class="line">-XX:G1HeapRegionSize è®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ã€‚</span><br><span class="line">	å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„Javaå †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„1/2000ã€‚</span><br><span class="line">-XX:MaxGCPauseMillis  è®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡ï¼ˆJVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°ï¼‰ã€‚é»˜è®¤å€¼æ˜¯200ms</span><br><span class="line">-XX:ParallelGCThread  è®¾ç½®STWæ—¶GCçº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º8</span><br><span class="line">-XX:ConcGCThreads  è®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°†nè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼ˆParallelGCThreadsï¼‰çš„1/4å·¦å³ã€‚</span><br><span class="line">-XX:InitiatingHeapOccupancyPercent è®¾ç½®è§¦å‘å¹¶å‘GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCã€‚é»˜è®¤å€¼æ˜¯45ã€‚</span><br><span class="line">-XX:G1NewSizePercent  æ–°ç”Ÿä»£å ç”¨æ•´ä¸ªå †å†…å­˜çš„æœ€å°ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤5ï¼…ï¼‰</span><br><span class="line">-XX:G1MaxNewSizePercent  æ–°ç”Ÿä»£å ç”¨æ•´ä¸ªå †å†…å­˜çš„æœ€å¤§ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤60ï¼…ï¼‰</span><br><span class="line">-XX:G1ReservePercent=10  ä¿ç•™å†…å­˜åŒºåŸŸï¼Œé˜²æ­¢ to spaceï¼ˆSurvivorä¸­çš„toåŒºï¼‰æº¢å‡º</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ€ä¹ˆé€‰æ‹©åƒåœ¾å›æ”¶å™¨ï¼Ÿ</p>
<ul>
<li><p>ä¼˜å…ˆè®©JVMè‡ªé€‚åº”ï¼Œè°ƒæ•´å †çš„å¤§å°</p>
</li>
<li><p>ä¸²è¡Œæ”¶é›†å™¨ï¼šå†…å­˜å°äº100Mï¼›å•æ ¸ã€å•æœºç¨‹åºï¼Œå¹¶ä¸”æ²¡æœ‰åœé¡¿æ—¶é—´çš„è¦æ±‚</p>
</li>
<li><p>å¹¶è¡Œæ”¶é›†å™¨ï¼šå¤šCPUã€é«˜ååé‡ã€å…è®¸åœé¡¿æ—¶é—´è¶…è¿‡1ç§’</p>
</li>
<li><p>å¹¶å‘æ”¶é›†å™¨ï¼šå¤šCPUã€è¿½æ±‚ä½åœé¡¿æ—¶é—´ã€å¿«é€Ÿå“åº”ï¼ˆæ¯”å¦‚å»¶è¿Ÿä¸èƒ½è¶…è¿‡1ç§’ï¼Œå¦‚äº’è”ç½‘åº”ç”¨ï¼‰</p>
</li>
<li><p>å®˜æ–¹æ¨èG1ï¼Œæ€§èƒ½é«˜ã€‚ç°åœ¨äº’è”ç½‘çš„é¡¹ç›®ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨G1</p>
</li>
</ul>
<p>ç‰¹åˆ«è¯´æ˜ï¼š</p>
<ul>
<li><p>æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨ï¼Œæ›´æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†å™¨</p>
</li>
<li><p>è°ƒä¼˜æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ã€ç‰¹å®šéœ€æ±‚ï¼Œä¸å­˜åœ¨ä¸€åŠ³æ°¸é€¸çš„æ”¶é›†å™¨</p>
</li>
</ul>
<h4 id="3-5ï¼ŒGCæ—¥å¿—ç›¸å…³é€‰é¡¹"><a href="#3-5ï¼ŒGCæ—¥å¿—ç›¸å…³é€‰é¡¹" class="headerlink" title="3.5ï¼ŒGCæ—¥å¿—ç›¸å…³é€‰é¡¹"></a>3.5ï¼ŒGCæ—¥å¿—ç›¸å…³é€‰é¡¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintGC &lt;==&gt; -verbose:gc  æ‰“å°ç®€è¦æ—¥å¿—ä¿¡æ¯</span><br><span class="line">-XX:+PrintGCDetails            æ‰“å°è¯¦ç»†æ—¥å¿—ä¿¡æ¯</span><br><span class="line">-XX:+PrintGCTimeStamps  æ‰“å°ç¨‹åºå¯åŠ¨åˆ°GCå‘ç”Ÿçš„æ—¶é—´ï¼Œæ­é…-XX:+PrintGCDetailsä½¿ç”¨</span><br><span class="line">-XX:+PrintGCDateStamps  æ‰“å°GCå‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ï¼Œæ­é…-XX:+PrintGCDetailsä½¿ç”¨</span><br><span class="line">-XX:+PrintHeapAtGC  æ‰“å°GCå‰åçš„å †ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾</span><br><span class="line">-Xloggc:&lt;file&gt; è¾“å‡ºGCå¯¼æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸­</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/1647507011648.png" alt="1647507011648" loading="lazy"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-XX:+TraceClassLoading  ç›‘æ§ç±»çš„åŠ è½½</span><br><span class="line">-XX:+PrintGCApplicationStoppedTime  æ‰“å°GCæ—¶çº¿ç¨‹çš„åœé¡¿æ—¶é—´</span><br><span class="line">-XX:+PrintGCApplicationConcurrentTime  æ‰“å°åƒåœ¾æ”¶é›†ä¹‹å‰åº”ç”¨æœªä¸­æ–­çš„æ‰§è¡Œæ—¶é—´</span><br><span class="line">-XX:+PrintReferenceGC æ‰“å°å›æ”¶äº†å¤šå°‘ç§ä¸åŒå¼•ç”¨ç±»å‹çš„å¼•ç”¨</span><br><span class="line">-XX:+PrintTenuringDistribution  æ‰“å°JVMåœ¨æ¯æ¬¡MinorGCåå½“å‰ä½¿ç”¨çš„Survivorä¸­å¯¹è±¡çš„å¹´é¾„åˆ†å¸ƒ</span><br><span class="line">-XX:+UseGCLogFileRotation å¯ç”¨GCæ—¥å¿—æ–‡ä»¶çš„è‡ªåŠ¨è½¬å‚¨</span><br><span class="line">-XX:NumberOfGCLogFiles=1  è®¾ç½®GCæ—¥å¿—æ–‡ä»¶çš„å¾ªç¯æ•°ç›®</span><br><span class="line">-XX:GCLogFileSize=1M  è®¾ç½®GCæ—¥å¿—æ–‡ä»¶çš„å¤§å°</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-6ï¼Œå…¶ä»–å‚æ•°"><a href="#3-6ï¼Œå…¶ä»–å‚æ•°" class="headerlink" title="3.6ï¼Œå…¶ä»–å‚æ•°"></a>3.6ï¼Œå…¶ä»–å‚æ•°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-XX:+DisableExplicitGC  ç¦ç”¨hotspotæ‰§è¡ŒSystem.gc()ï¼Œé»˜è®¤ç¦ç”¨</span><br><span class="line">-XX:ReservedCodeCacheSize=&lt;n&gt;[g|m|k]ã€-XX:InitialCodeCacheSize=&lt;n&gt;[g|m|k]  æŒ‡å®šä»£ç ç¼“å­˜çš„å¤§å°</span><br><span class="line">-XX:+UseCodeCacheFlushing  æ”¾å¼ƒä¸€äº›è¢«ç¼–è¯‘çš„ä»£ç ï¼Œé¿å…ä»£ç ç¼“å­˜è¢«å æ»¡æ—¶JVMåˆ‡æ¢åˆ°interpreted-onlyçš„æƒ…å†µ</span><br><span class="line">-XX:+DoEscapeAnalysis  å¼€å¯é€ƒé€¸åˆ†æ</span><br><span class="line">-XX:+UseBiasedLocking  å¼€å¯åå‘é”</span><br><span class="line">-XX:+UseLargePages  å¼€å¯ä½¿ç”¨å¤§é¡µé¢</span><br><span class="line">-XX:+PrintTLAB  æ‰“å°TLABçš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line">-XX:TLABSize  è®¾ç½®TLABå¤§å°</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4ï¼Œé€šè¿‡Javaä»£ç è·å–JVMå‚æ•°"><a href="#4ï¼Œé€šè¿‡Javaä»£ç è·å–JVMå‚æ•°" class="headerlink" title="4ï¼Œé€šè¿‡Javaä»£ç è·å–JVMå‚æ•°"></a>4ï¼Œé€šè¿‡Javaä»£ç è·å–JVMå‚æ•°</h3><p>Javaæä¾›äº†java.lang.managementåŒ…ç”¨äºç›‘è§†å’Œç®¡ç†Javaè™šæ‹Ÿæœºå’ŒJavaè¿è¡Œæ—¶ä¸­çš„å…¶ä»–ç»„ä»¶ï¼Œå®ƒå…è®¸æœ¬åœ°æˆ–è¿œç¨‹ç›‘æ§å’Œç®¡ç†è¿è¡Œçš„Javaè™šæ‹Ÿæœºã€‚å…¶ä¸­ManagementFactoryç±»è¾ƒä¸ºå¸¸ç”¨ï¼Œå¦å¤–Runtimeç±»å¯è·å–å†…å­˜ã€CPUæ ¸æ•°ç­‰ç›¸å…³çš„æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›apiï¼Œå¯ä»¥ç›‘æ§åº”ç”¨æœåŠ¡å™¨çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè®¾ç½®ä¸€äº›é˜ˆå€¼è¿›è¡ŒæŠ¥è­¦ç­‰å¤„ç†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class MemoryMonitor &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        MemoryMXBean memorymbean = ManagementFactory.getMemoryMXBean();</span><br><span class="line">        MemoryUsage usage = memorymbean.getHeapMemoryUsage();</span><br><span class="line">        System.out.println(&quot;INIT HEAP: &quot; + usage.getInit() / 1024 / 1024 + &quot;m&quot;);</span><br><span class="line">        System.out.println(&quot;MAX HEAP: &quot; + usage.getMax() / 1024 / 1024 + &quot;m&quot;);</span><br><span class="line">        System.out.println(&quot;USE HEAP: &quot; + usage.getUsed() / 1024 / 1024 + &quot;m&quot;);</span><br><span class="line">        System.out.println(&quot;\nFull Information:&quot;);</span><br><span class="line">        System.out.println(&quot;Heap Memory Usage: &quot; + memorymbean.getHeapMemoryUsage());</span><br><span class="line">        System.out.println(&quot;Non-Heap Memory Usage: &quot; + memorymbean.getNonHeapMemoryUsage());</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;=======================é€šè¿‡javaæ¥è·å–ç›¸å…³ç³»ç»ŸçŠ¶æ€============================ &quot;);</span><br><span class="line">        System.out.println(&quot;å½“å‰å †å†…å­˜å¤§å°totalMemory &quot; + (int) Runtime.getRuntime().totalMemory() / 1024 / 1024 + &quot;m&quot;);// å½“å‰å †å†…å­˜å¤§å°</span><br><span class="line">        System.out.println(&quot;ç©ºé—²å †å†…å­˜å¤§å°freeMemory &quot; + (int) Runtime.getRuntime().freeMemory() / 1024 / 1024 + &quot;m&quot;);// ç©ºé—²å †å†…å­˜å¤§å°</span><br><span class="line">        System.out.println(&quot;æœ€å¤§å¯ç”¨æ€»å †å†…å­˜maxMemory &quot; + Runtime.getRuntime().maxMemory() / 1024 / 1024 + &quot;m&quot;);// æœ€å¤§å¯ç”¨æ€»å †å†…å­˜å¤§å°</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="äº”ï¼Œ-åˆ†æGCæ—¥å¿—"><a href="#äº”ï¼Œ-åˆ†æGCæ—¥å¿—" class="headerlink" title="äº”ï¼Œ åˆ†æGCæ—¥å¿—"></a>äº”ï¼Œ <strong>åˆ†æGCæ—¥å¿—</strong></h2><h3 id="1ï¼ŒGCåˆ†ç±»"><a href="#1ï¼ŒGCåˆ†ç±»" class="headerlink" title="1ï¼ŒGCåˆ†ç±»"></a>1ï¼ŒGCåˆ†ç±»</h3><p>é’ˆå¯¹HotSpot VMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCæŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼Œä¸€ç§æ˜¯æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰</p>
<ul>
<li><p> éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š </p>
</li>
<li><ul>
<li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£ï¼ˆEden / S0, S1ï¼‰çš„åƒåœ¾æ”¶é›†</li>
</ul>
</li>
<li><ul>
<li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰ï¼Œåªæœ‰CMS GCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™Major GCä¼šå’ŒFull GCæ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li>
</ul>
</li>
<li><p> æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰ï¼Œåªæœ‰G1 GCä¼šæœ‰è¿™ç§è¡Œä¸º </p>
</li>
<li><p> æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªjavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</p>
</li>
</ul>
<h3 id="2ï¼ŒGCæ—¥å¿—åˆ†ç±»"><a href="#2ï¼ŒGCæ—¥å¿—åˆ†ç±»" class="headerlink" title="2ï¼ŒGCæ—¥å¿—åˆ†ç±»"></a>2ï¼ŒGCæ—¥å¿—åˆ†ç±»</h3><p> <strong>MinorGC</strong></p>
<p>MinorGCï¼ˆæˆ–young GCæˆ–YGCï¼‰æ—¥å¿—ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 31744K-&gt;2192K (36864K) ] 31744K-&gt;2200K (121856K), <span class="number">0.0139308</span> secs] [Times: user=<span class="number">0.05</span> sys=<span class="number">0.01</span>, real=<span class="number">0.01</span> secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/1647507172690.png" alt="1647507172690" loading="lazy"></p>
<p><strong>FullGC</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Metadata GC Threshold)</span> [PSYoungGen: 5104K-&gt;0K (132096K) ] [Par01dGen: 416K-&gt;5453K (50176K) ]5520K-&gt;5453K (182272K), [Metaspace: 20637K-&gt;20637K (1067008K) ], <span class="number">0.0245883</span> secs] [Times: user=<span class="number">0.06</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/18/JVM/1647507204683.png" alt="1647507204683" loading="lazy"></p>
<h3 id="3ï¼ŒGCæ—¥å¿—ç»“æ„å‰–æ"><a href="#3ï¼ŒGCæ—¥å¿—ç»“æ„å‰–æ" class="headerlink" title="3ï¼ŒGCæ—¥å¿—ç»“æ„å‰–æ"></a>3ï¼ŒGCæ—¥å¿—ç»“æ„å‰–æ</h3><p><strong>é€è¿‡æ—¥å¿—çœ‹åƒåœ¾æ”¶é›†å™¨</strong></p>
<ul>
<li><p> Serialæ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£æ˜¾ç¤º â€œ[DefNewâ€ï¼Œå³ Default New Generation </p>
</li>
<li><p> ParNewæ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£æ˜¾ç¤º â€œ[ParNewâ€ï¼Œå³ Parallel New Generation </p>
</li>
<li><p> Parallel Scavengeæ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£æ˜¾ç¤ºâ€[PSYoungGenâ€ï¼ŒJDK1.7ä½¿ç”¨çš„å³PSYoungGen </p>
</li>
<li><p> Parallel Oldæ”¶é›†å™¨ï¼šè€å¹´ä»£æ˜¾ç¤ºâ€[ParoldGenâ€ </p>
</li>
<li><p> G1æ”¶é›†å™¨ï¼šæ˜¾ç¤ºâ€garbage-first heapâ€œ </p>
</li>
</ul>
<p><strong>é€è¿‡æ—¥å¿—çœ‹GCåŸå› </strong></p>
<ul>
<li><p>Allocation Failureï¼šè¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºæ–°ç”Ÿä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„åŒºåŸŸå­˜æ”¾éœ€è¦åˆ†é…çš„æ•°æ®</p>
</li>
<li><p>Metadata GCThresholdï¼šMetaspaceåŒºä¸å¤Ÿç”¨äº†</p>
</li>
<li><p>FErgonomicsï¼šJVMè‡ªé€‚åº”è°ƒæ•´å¯¼è‡´çš„GC</p>
</li>
<li><p>Systemï¼šè°ƒç”¨äº†System.gc()æ–¹æ³•</p>
</li>
</ul>
<p><strong>é€è¿‡æ—¥å¿—çœ‹GCå‰åæƒ…å†µ</strong></p>
<p>é€šè¿‡å›¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°GCæ—¥å¿—æ ¼å¼çš„è§„å¾‹ä¸€èˆ¬éƒ½æ˜¯ï¼šGCå‰å†…å­˜å ç”¨-ï¼GCåå†…å­˜å ç”¨ï¼ˆè¯¥åŒºåŸŸå†…å­˜æ€»å¤§å°ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[PSYoungGen: 5986K-&gt;696K (8704K) ] 5986K-&gt;704K (9216K)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¸­æ‹¬å·å†…ï¼šGCå›æ”¶å‰å¹´è½»ä»£å †å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å †æ€»å¤§å°ï¼‰ </p>
</li>
<li><p>æ‹¬å·å¤–ï¼šGCå›æ”¶å‰å¹´è½»ä»£å’Œè€å¹´ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å’Œè€å¹´ä»£æ€»å¤§å°ï¼‰ </p>
</li>
</ul>
<p>æ³¨æ„ï¼šMinor GCå †å†…å­˜æ€»å®¹é‡ = 9/10 å¹´è½»ä»£ + è€å¹´ä»£ã€‚åŸå› æ˜¯SurvivoråŒºåªè®¡ç®—froméƒ¨åˆ†ï¼Œè€ŒJVMé»˜è®¤å¹´è½»ä»£ä¸­EdenåŒºå’ŒSurvivoråŒºçš„æ¯”ä¾‹å…³ç³»ï¼ŒEden:S0:S1=8:1:1ã€‚</p>
<p><strong>é€è¿‡æ—¥å¿—çœ‹GCæ—¶é—´</strong></p>
<p>GCæ—¥å¿—ä¸­æœ‰ä¸‰ä¸ªæ—¶é—´ï¼šuserï¼Œsyså’Œreal</p>
<ul>
<li><p>userï¼šè¿›ç¨‹æ‰§è¡Œç”¨æˆ·æ€ä»£ç ï¼ˆæ ¸å¿ƒä¹‹å¤–ï¼‰æ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚è¿™æ˜¯æ‰§è¡Œæ­¤è¿›ç¨‹æ‰€ä½¿ç”¨çš„å®é™…CPU æ—¶é—´ï¼Œå…¶ä»–è¿›ç¨‹å’Œæ­¤è¿›ç¨‹é˜»å¡çš„æ—¶é—´å¹¶ä¸åŒ…æ‹¬åœ¨å†…ã€‚åœ¨åƒåœ¾æ”¶é›†çš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºGCçº¿ç¨‹æ‰§è¡Œæ‰€ä½¿ç”¨çš„ CPU æ€»æ—¶é—´ã€‚</p>
</li>
<li><p>sysï¼šè¿›ç¨‹åœ¨å†…æ ¸æ€æ¶ˆè€—çš„ CPU æ—¶é—´ï¼Œå³åœ¨å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æˆ–ç­‰å¾…ç³»ç»Ÿäº‹ä»¶æ‰€ä½¿ç”¨çš„CPU æ—¶é—´</p>
</li>
<li><p>realï¼šç¨‹åºä»å¼€å§‹åˆ°ç»“æŸæ‰€ç”¨çš„æ—¶é’Ÿæ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´åŒ…æ‹¬å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„æ—¶é—´ç‰‡å’Œè¿›ç¨‹é˜»å¡çš„æ—¶é—´ï¼ˆæ¯”å¦‚ç­‰å¾… I/O å®Œæˆï¼‰ã€‚å¯¹äºå¹¶è¡Œgcï¼Œè¿™ä¸ªæ•°å­—åº”è¯¥æ¥è¿‘ï¼ˆç”¨æˆ·æ—¶é—´ï¼‹ç³»ç»Ÿæ—¶é—´ï¼‰é™¤ä»¥åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚</p>
</li>
</ul>
<p>ç”±äºå¤šæ ¸çš„åŸå› ï¼Œä¸€èˆ¬çš„GCäº‹ä»¶ä¸­ï¼Œreal timeæ˜¯å°äºsys timeï¼‹user timeçš„ï¼Œå› ä¸ºä¸€èˆ¬æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„å»åšGCï¼Œæ‰€ä»¥real timeæ˜¯è¦å°äºsysï¼‹user timeçš„ã€‚å¦‚æœrealï¼sysï¼‹userçš„è¯ï¼Œåˆ™ä½ çš„åº”ç”¨å¯èƒ½å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼šIOè´Ÿè½½éå¸¸é‡æˆ–CPUä¸å¤Ÿç”¨ã€‚</p>
<h3 id="4ï¼Œ-GCæ—¥å¿—åˆ†æå·¥å…·"><a href="#4ï¼Œ-GCæ—¥å¿—åˆ†æå·¥å…·" class="headerlink" title="4ï¼Œ GCæ—¥å¿—åˆ†æå·¥å…·"></a>4ï¼Œ GCæ—¥å¿—åˆ†æå·¥å…·</h3><p><strong>GCEasy</strong></p>
<p>GCEasyæ˜¯ä¸€æ¬¾åœ¨çº¿çš„GCæ—¥å¿—åˆ†æå™¨ï¼Œå¯ä»¥é€šè¿‡GCæ—¥å¿—åˆ†æè¿›è¡Œå†…å­˜æ³„éœ²æ£€æµ‹ã€GCæš‚åœåŸå› åˆ†æã€JVMé…ç½®å»ºè®®ä¼˜åŒ–ç­‰åŠŸèƒ½ï¼Œå¤§å¤šæ•°åŠŸèƒ½æ˜¯å…è´¹çš„ã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://gceasy.io/">https://gceasy.io/</a></p>
<p><strong>GCViewer</strong></p>
<p>GCVieweræ˜¯ä¸€æ¬¾ç¦»çº¿çš„GCæ—¥å¿—åˆ†æå™¨ï¼Œç”¨äºå¯è§†åŒ–Java VMé€‰é¡¹ -verbose:gc å’Œ .NETç”Ÿæˆçš„æ•°æ® -Xloggc:<file>ã€‚è¿˜å¯ä»¥è®¡ç®—ä¸åƒåœ¾å›æ”¶ç›¸å…³çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆååé‡ã€ç´¯ç§¯çš„æš‚åœã€æœ€é•¿çš„æš‚åœç­‰ï¼‰ã€‚å½“é€šè¿‡æ›´æ”¹ä¸–ä»£å¤§å°æˆ–è®¾ç½®åˆå§‹å †å¤§å°æ¥è°ƒæ•´ç‰¹å®šåº”ç”¨ç¨‹åºçš„åƒåœ¾å›æ”¶æ—¶ï¼Œæ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚</file></p>
<p>æºç ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://github.com/chewiebug/GCViewer">https://github.com/chewiebug/GCViewer</a></p>
<p>è¿è¡Œç‰ˆæœ¬ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://github.com/chewiebug/GCViewer/wiki/Changelog">https://github.com/chewiebug/GCViewer/wiki/Changelog</a></p>
<p><strong>GChisto</strong></p>
<ul>
<li><p>å®˜ç½‘ä¸Šæ²¡æœ‰ä¸‹è½½çš„åœ°æ–¹ï¼Œéœ€è¦è‡ªå·±ä»SVNä¸Šæ‹‰ä¸‹æ¥ç¼–è¯‘</p>
</li>
<li><p>ä¸è¿‡è¿™ä¸ªå·¥å…·ä¼¼ä¹æ²¡æ€ä¹ˆç»´æŠ¤äº†ï¼Œå­˜åœ¨ä¸å°‘bug</p>
</li>
</ul>
<p><strong>HPjmeter</strong></p>
<ul>
<li><p>å·¥å…·å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åªèƒ½æ‰“å¼€ç”±ä»¥ä¸‹å‚æ•°ç”Ÿæˆçš„GC logï¼Œ-verbose:gc  -Xloggc:gc.logã€‚æ·»åŠ å…¶ä»–å‚æ•°ç”Ÿæˆçš„gc.logæ— æ³•æ‰“å¼€</p>
</li>
<li><p>HPjmeteré›†æˆäº†ä»¥å‰çš„HPjtuneåŠŸèƒ½ï¼Œå¯ä»¥åˆ†æåœ¨HPæœºå™¨ä¸Šäº§ç”Ÿçš„åƒåœ¾å›æ”¶æ—¥å¿—æ–‡ä»¶</p>
</li>
</ul>
<h2 id="è¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²"><a href="#è¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²" class="headerlink" title="è¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²"></a>è¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²</h2><h3 id="1ï¼Œè¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²"><a href="#1ï¼Œè¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²" class="headerlink" title="1ï¼Œè¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²"></a>1ï¼Œè¡¥å……ï¼šæµ…å †æ·±å †ä¸å†…å­˜æ³„éœ²</h3><p>æµ…å †æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡æ‰€æ¶ˆè€—çš„å†…å­˜ã€‚åœ¨32ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä¼šå æ®4ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªintç±»å‹ä¼šå æ®4ä¸ªå­—èŠ‚ï¼Œlongå‹å˜é‡ä¼šå æ®8ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå¯¹è±¡å¤´éœ€è¦å ç”¨8ä¸ªå­—èŠ‚ã€‚æ ¹æ®å †å¿«ç…§æ ¼å¼ä¸åŒï¼Œå¯¹è±¡çš„å¤§å°å¯èƒ½ä¼šåŒ8å­—èŠ‚è¿›è¡Œå¯¹é½ã€‚</p>
<p>ä»¥Stringä¸ºä¾‹ï¼š2ä¸ªintå€¼å…±å 8å­—èŠ‚ï¼Œå¯¹è±¡å¼•ç”¨å ç”¨4å­—èŠ‚ï¼Œå¯¹è±¡å¤´8å­—èŠ‚ï¼Œåˆè®¡20å­—èŠ‚ï¼Œå‘8å­—èŠ‚å¯¹é½ï¼Œæ•…å 24å­—èŠ‚ã€‚ï¼ˆjdk7ä¸­ï¼‰</p>
<p><img src="/2022/04/18/JVM/1647507361880.png" alt="1647507361880" loading="lazy"></p>
<h3 id="2ï¼Œä¿ç•™é›†ï¼ˆRetained-Setï¼‰"><a href="#2ï¼Œä¿ç•™é›†ï¼ˆRetained-Setï¼‰" class="headerlink" title="2ï¼Œä¿ç•™é›†ï¼ˆRetained Setï¼‰"></a>2ï¼Œä¿ç•™é›†ï¼ˆRetained Setï¼‰</h3><p>å¯¹è±¡Açš„ä¿ç•™é›†æŒ‡å½“å¯¹è±¡Aè¢«åƒåœ¾å›æ”¶åï¼Œå¯ä»¥è¢«é‡Šæ”¾çš„æ‰€æœ‰çš„å¯¹è±¡é›†åˆï¼ˆåŒ…æ‹¬å¯¹è±¡Aæœ¬èº«ï¼‰ï¼Œå³å¯¹è±¡Açš„ä¿ç•™é›†å¯ä»¥è¢«è®¤ä¸ºæ˜¯åªèƒ½é€šè¿‡å¯¹è±¡Aè¢«ç›´æ¥æˆ–é—´æ¥è®¿é—®åˆ°çš„æ‰€æœ‰å¯¹è±¡çš„é›†åˆã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯æŒ‡ä»…è¢«å¯¹è±¡Aæ‰€æŒæœ‰çš„å¯¹è±¡çš„é›†åˆã€‚</p>
<h3 id="3ï¼Œæ·±å †ï¼ˆRetained-Heapï¼‰"><a href="#3ï¼Œæ·±å †ï¼ˆRetained-Heapï¼‰" class="headerlink" title="3ï¼Œæ·±å †ï¼ˆRetained Heapï¼‰"></a>3ï¼Œæ·±å †ï¼ˆRetained Heapï¼‰</h3><p>æ·±å †æ˜¯æŒ‡å¯¹è±¡çš„ä¿ç•™é›†ä¸­æ‰€æœ‰çš„å¯¹è±¡çš„æµ…å †å¤§å°ä¹‹å’Œã€‚</p>
<p>æ³¨æ„ï¼šæµ…å †æŒ‡å¯¹è±¡æœ¬èº«å ç”¨çš„å†…å­˜ï¼Œä¸åŒ…æ‹¬å…¶å†…éƒ¨å¼•ç”¨å¯¹è±¡çš„å¤§å°ã€‚ä¸€ä¸ªå¯¹è±¡çš„æ·±å †æŒ‡åªèƒ½é€šè¿‡è¯¥å¯¹è±¡è®¿é—®åˆ°çš„ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰æ‰€æœ‰å¯¹è±¡çš„æµ…å †ä¹‹å’Œï¼Œå³å¯¹è±¡è¢«å›æ”¶åï¼Œå¯ä»¥é‡Šæ”¾çš„çœŸå®ç©ºé—´ã€‚</p>
<h3 id="4ï¼Œå¯¹è±¡çš„å®é™…å¤§å°"><a href="#4ï¼Œå¯¹è±¡çš„å®é™…å¤§å°" class="headerlink" title="4ï¼Œå¯¹è±¡çš„å®é™…å¤§å°"></a>4ï¼Œå¯¹è±¡çš„å®é™…å¤§å°</h3><p>è¿™é‡Œï¼Œå¯¹è±¡çš„å®é™…å¤§å°å®šä¹‰ä¸ºä¸€ä¸ªå¯¹è±¡æ‰€èƒ½è§¦åŠçš„æ‰€æœ‰å¯¹è±¡çš„æµ…å †å¤§å°ä¹‹å’Œï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šæˆ‘ä»¬è¯´çš„å¯¹è±¡å¤§å°ã€‚ä¸æ·±å †ç›¸æ¯”ï¼Œä¼¼ä¹è¿™ä¸ªåœ¨æ—¥å¸¸å¼€å‘ä¸­æ›´ä¸ºç›´è§‚å’Œè¢«äººæ¥å—ï¼Œä½†å®é™…ä¸Šï¼Œè¿™ä¸ªæ¦‚å¿µå’Œåƒåœ¾å›æ”¶æ— å…³ã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„å¯¹è±¡å¼•ç”¨å…³ç³»å›¾ï¼Œå¯¹è±¡Aå¼•ç”¨äº†Cå’ŒDï¼Œå¯¹è±¡Bå¼•ç”¨äº†Cå’ŒEã€‚é‚£ä¹ˆå¯¹è±¡Açš„æµ…å †å¤§å°åªæ˜¯Aæœ¬èº«ï¼Œä¸å«Cå’ŒDï¼Œè€ŒAçš„å®é™…å¤§å°ä¸ºAã€Cã€Dä¸‰è€…ä¹‹å’Œã€‚è€ŒAçš„æ·±å †å¤§å°ä¸ºAä¸Dä¹‹å’Œï¼Œç”±äºå¯¹è±¡Cè¿˜å¯ä»¥é€šè¿‡å¯¹è±¡Bè®¿é—®åˆ°ï¼Œå› æ­¤ä¸åœ¨å¯¹è±¡Açš„æ·±å †èŒƒå›´å†…ã€‚</p>
<p><img src="/2022/04/18/JVM/1647507471781.png" alt="1647507471781" loading="lazy"></p>
<h3 id="5ï¼Œæ”¯é…æ ‘ï¼ˆDominator-Treeï¼‰"><a href="#5ï¼Œæ”¯é…æ ‘ï¼ˆDominator-Treeï¼‰" class="headerlink" title="5ï¼Œæ”¯é…æ ‘ï¼ˆDominator Treeï¼‰"></a>5ï¼Œæ”¯é…æ ‘ï¼ˆDominator Treeï¼‰</h3><p>æ”¯é…æ ‘çš„æ¦‚å¿µæºè‡ªå›¾è®ºã€‚MATæä¾›äº†ä¸€ä¸ªç§°ä¸ºæ”¯é…æ ‘ï¼ˆDominator Treeï¼‰çš„å¯¹è±¡å›¾ã€‚æ”¯é…æ ‘ä½“ç°äº†å¯¹è±¡å®ä¾‹é—´çš„æ”¯é…å…³ç³»ã€‚åœ¨å¯¹è±¡å¼•ç”¨å›¾ä¸­ï¼Œæ‰€æœ‰æŒ‡å‘å¯¹è±¡Bçš„è·¯å¾„éƒ½ç»è¿‡å¯¹è±¡Aï¼Œåˆ™è®¤ä¸ºå¯¹è±¡Aæ”¯é…å¯¹è±¡Bã€‚å¦‚æœå¯¹è±¡Aæ˜¯ç¦»å¯¹è±¡Bæœ€è¿‘çš„ä¸€ä¸ªæ”¯é…å¯¹è±¡ï¼Œåˆ™è®¤ä¸ºå¯¹è±¡Aä¸ºå¯¹è±¡Bçš„ç›´æ¥æ”¯é…è€…ã€‚æ”¯é…æ ‘æ˜¯åŸºäºå¯¹è±¡é—´çš„å¼•ç”¨å›¾æ‰€å»ºç«‹çš„ï¼Œå®ƒæœ‰ä»¥ä¸‹åŸºæœ¬æ€§è´¨ï¼š</p>
<ul>
<li><p>å¯¹è±¡Açš„å­æ ‘ï¼ˆæ‰€æœ‰è¢«å¯¹è±¡Aæ”¯é…çš„å¯¹è±¡é›†åˆï¼‰è¡¨ç¤ºå¯¹è±¡Açš„ä¿ç•™é›†ï¼ˆretained setï¼‰ï¼Œå³æ·±å †ã€‚</p>
</li>
<li><p>å¦‚æœå¯¹è±¡Aæ”¯é…å¯¹è±¡Bï¼Œé‚£ä¹ˆå¯¹è±¡Açš„ç›´æ¥æ”¯é…è€…ä¹Ÿæ”¯é…å¯¹è±¡Bã€‚</p>
</li>
<li><p>æ”¯é…æ ‘çš„è¾¹ä¸å¯¹è±¡å¼•ç”¨å›¾çš„è¾¹ä¸ç›´æ¥å¯¹åº”ã€‚</p>
</li>
</ul>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå·¦å›¾è¡¨ç¤ºå¯¹è±¡å¼•ç”¨å›¾ï¼Œå³å›¾è¡¨ç¤ºå·¦å›¾æ‰€å¯¹åº”çš„æ”¯é…æ ‘ã€‚å¯¹è±¡Aå’ŒBç”±æ ¹å¯¹è±¡ç›´æ¥æ”¯é…ï¼Œç”±äºåœ¨åˆ°å¯¹è±¡Cçš„è·¯å¾„ä¸­ï¼Œå¯ä»¥ç»è¿‡Aï¼Œä¹Ÿå¯ä»¥ç»è¿‡Bï¼Œå› æ­¤å¯¹è±¡Cçš„ç›´æ¥æ”¯é…è€…ä¹Ÿæ˜¯æ ¹å¯¹è±¡ã€‚å¯¹è±¡Fä¸å¯¹è±¡Dç›¸äº’å¼•ç”¨ï¼Œå› ä¸ºåˆ°å¯¹è±¡Fçš„æ‰€æœ‰è·¯å¾„å¿…ç„¶ç»è¿‡å¯¹è±¡Dï¼Œå› æ­¤ï¼Œå¯¹è±¡Dæ˜¯å¯¹è±¡Fçš„ç›´æ¥æ”¯é…è€…ã€‚è€Œåˆ°å¯¹è±¡Dçš„æ‰€æœ‰è·¯å¾„ä¸­ï¼Œå¿…ç„¶ç»è¿‡å¯¹è±¡Cï¼Œå³ä½¿æ˜¯ä»å¯¹è±¡Fåˆ°å¯¹è±¡Dçš„å¼•ç”¨ï¼Œä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œä¹Ÿæ˜¯ç»è¿‡å¯¹è±¡Cçš„ï¼Œæ‰€ä»¥ï¼Œå¯¹è±¡Dçš„ç›´æ¥æ”¯é…è€…ä¸ºå¯¹è±¡Cã€‚åŒç†ï¼Œå¯¹è±¡Eæ”¯é…å¯¹è±¡Gã€‚åˆ°è¾¾å¯¹è±¡Hçš„å¯ä»¥é€šè¿‡å¯¹è±¡Dï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡Eï¼Œå› æ­¤å¯¹è±¡Då’ŒEéƒ½ä¸èƒ½æ”¯é…å¯¹è±¡Hï¼Œè€Œç»è¿‡å¯¹è±¡Cæ—¢å¯ä»¥åˆ°è¾¾Dä¹Ÿå¯ä»¥åˆ°è¾¾Eï¼Œå› æ­¤å¯¹è±¡Cä¸ºå¯¹è±¡Hçš„ç›´æ¥æ”¯é…è€…ã€‚</p>
<h3 id="6ï¼Œå†…å­˜æ³„æ¼ï¼ˆmemory-leakï¼‰"><a href="#6ï¼Œå†…å­˜æ³„æ¼ï¼ˆmemory-leakï¼‰" class="headerlink" title="6ï¼Œå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰"></a>6ï¼Œå†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰</h3><p>å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œæœ¬è´¨éƒ½æ˜¯åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜è¢«å¼•ç”¨ã€‚é‚£ä¹ˆå¯¹äºè¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºä»£ç çš„å®ç°ä¸åŒå°±ä¼šå‡ºç°å¾ˆå¤šç§å†…å­˜æ³„æ¼é—®é¢˜ï¼ˆè®©JVMè¯¯ä»¥ä¸ºæ­¤å¯¹è±¡è¿˜åœ¨å¼•ç”¨ä¸­ï¼Œæ— æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼‰ã€‚</p>
<p>ï¼ æ˜¯å¦è¿˜è¢«ä½¿ç”¨ï¼Ÿæ˜¯</p>
<p>ï¼ æ˜¯å¦è¿˜è¢«éœ€è¦ï¼Ÿå¦</p>
<p><img src="/2022/04/18/JVM/1647507594805.png" alt="1647507594805" loading="lazy"></p>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œåªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´00Mï¼Œä¹Ÿå¯ä»¥å«åšå®½æ³›æ„ä¹‰ä¸Šçš„â€œå†…å­˜æ³„æ¼â€ã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œå½“Yç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™ï¼ŒXä¾ç„¶å¼•ç”¨ç€Yï¼Œè¿™æ—¶å€™ï¼Œåƒåœ¾å›æ”¶æœŸæ˜¯ä¸ä¼šå›æ”¶å¯¹è±¡Yçš„ï¼›å¦‚æœå¯¹è±¡Xè¿˜å¼•ç”¨ç€ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­çš„Aã€Bã€Cï¼Œå¯¹è±¡Aåˆå¼•ç”¨ç€å¯¹è±¡ aã€bã€cï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆå¤§é‡æ— ç”¨çš„å¯¹è±¡ä¸èƒ½è¢«å›æ”¶ï¼Œè¿›è€Œå æ®äº†å†…å­˜èµ„æºï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼Œç›´åˆ°å†…å­˜æº¢å‡ºã€‚</p>
<p><img src="/2022/04/18/JVM/1647507612016.png" alt="1647507612016" loading="lazy"></p>
<p>ç”³è¯·äº†å†…å­˜ç”¨å®Œäº†ä¸é‡Šæ”¾ï¼Œæ¯”å¦‚ä¸€å…±æœ‰1024Mçš„å†…å­˜ï¼Œåˆ†é…äº†512Mçš„å†…å­˜ä¸€ç›´ä¸å›æ”¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨çš„å†…å­˜åªæœ‰512Mäº†ï¼Œä»¿ä½›æ³„éœ²æ‰äº†ä¸€éƒ¨åˆ†ï¼›é€šä¿—ä¸€ç‚¹è®²çš„è¯ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯ã€å ç€èŒ…å‘ä¸æ‹‰shiã€‘</p>
<h3 id="7ï¼Œå†…å­˜æº¢å‡ºï¼ˆout-of-memoryï¼‰"><a href="#7ï¼Œå†…å­˜æº¢å‡ºï¼ˆout-of-memoryï¼‰" class="headerlink" title="7ï¼Œå†…å­˜æº¢å‡ºï¼ˆout of memoryï¼‰"></a>7ï¼Œå†…å­˜æº¢å‡ºï¼ˆout of memoryï¼‰</h3><p>ç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ä»¥ä½¿ç”¨ï¼›é€šä¿—ä¸€ç‚¹å„¿è®²ï¼Œä¸€ä¸ªå•æ‰€å°±ä¸‰ä¸ªå‘ï¼Œæœ‰ä¸¤ä¸ªç«™ç€èŒ…å‘ä¸èµ°çš„ï¼ˆå†…å­˜æ³„æ¼ï¼‰ï¼Œå‰©ä¸‹æœ€åä¸€ä¸ªå‘ï¼Œå•æ‰€è¡¨ç¤ºæ¥å¾…å‹åŠ›å¾ˆå¤§ï¼Œè¿™æ—¶å€™ä¸€ä¸‹å­æ¥äº†ä¸¤ä¸ªäººï¼Œå‘ä½ï¼ˆå†…å­˜ï¼‰å°±ä¸å¤Ÿäº†ï¼Œå†…å­˜æ³„æ¼å˜æˆå†…å­˜æº¢å‡ºäº†ã€‚å¯è§ï¼Œå†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„å…³ç³»ï¼šå†…å­˜æ³„æ¼çš„å¢å¤šï¼Œæœ€ç»ˆä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p>
<p>æ³„æ¼çš„åˆ†ç±»</p>
<ul>
<li><p>ç»å¸¸å‘ç”Ÿï¼šå‘ç”Ÿå†…å­˜æ³„éœ²çš„ä»£ç ä¼šè¢«å¤šæ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œï¼Œæ³„éœ²ä¸€å—å†…å­˜ï¼›</p>
</li>
<li><p>å¶ç„¶å‘ç”Ÿï¼šåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿ</p>
</li>
<li><p>ä¸€æ¬¡æ€§ï¼šå‘ç”Ÿå†…å­˜æ³„éœ²çš„æ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼›</p>
</li>
<li><p>éšå¼æ³„æ¼ï¼šä¸€ç›´å ç€å†…å­˜ä¸é‡Šæ”¾ï¼Œç›´åˆ°æ‰§è¡Œç»“æŸï¼›ä¸¥æ ¼çš„è¯´è¿™ä¸ªä¸ç®—å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæœ€ç»ˆé‡Šæ”¾æ‰äº†ï¼Œä½†æ˜¯å¦‚æœæ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å†…å­˜è€—å°½ã€‚</p>
</li>
</ul>
<h3 id="8ï¼ŒJavaä¸­å†…å­˜æ³„éœ²çš„8ç§æƒ…å†µ"><a href="#8ï¼ŒJavaä¸­å†…å­˜æ³„éœ²çš„8ç§æƒ…å†µ" class="headerlink" title="8ï¼ŒJavaä¸­å†…å­˜æ³„éœ²çš„8ç§æƒ…å†µ"></a>8ï¼ŒJavaä¸­å†…å­˜æ³„éœ²çš„8ç§æƒ…å†µ</h3><h4 id="8-1ï¼Œé™æ€é›†åˆç±»"><a href="#8-1ï¼Œé™æ€é›†åˆç±»" class="headerlink" title="8.1ï¼Œé™æ€é›†åˆç±»"></a>8.1ï¼Œé™æ€é›†åˆç±»</h4><p>é™æ€é›†åˆç±»ï¼Œå¦‚HashMapã€LinkedListç­‰ç­‰ã€‚å¦‚æœè¿™äº›å®¹å™¨ä¸ºé™æ€çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸JVMç¨‹åºä¸€è‡´ï¼Œåˆ™å®¹å™¨ä¸­çš„å¯¹è±¡åœ¨ç¨‹åºç»“æŸä¹‹å‰å°†ä¸èƒ½è¢«é‡Šæ”¾ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚ç®€å•è€Œè¨€ï¼Œé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryLeak</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oomTests</span><span class="params">()</span>&#123;</span><br><span class="line">        Object objï¼<span class="keyword">new</span> <span class="title class_">Object</span>();<span class="comment">//å±€éƒ¨å˜é‡</span></span><br><span class="line">        list.add(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-2ï¼Œå•ä¾‹æ¨¡å¼"><a href="#8-2ï¼Œå•ä¾‹æ¨¡å¼" class="headerlink" title="8.2ï¼Œå•ä¾‹æ¨¡å¼"></a>8.2ï¼Œå•ä¾‹æ¨¡å¼</h4><p>å•ä¾‹æ¨¡å¼ï¼Œå’Œé™æ€é›†åˆå¯¼è‡´å†…å­˜æ³„éœ²çš„åŸå› ç±»ä¼¼ï¼Œå› ä¸ºå•ä¾‹çš„é™æ€ç‰¹æ€§ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œ JVM çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œæ‰€ä»¥å¦‚æœå•ä¾‹å¯¹è±¡å¦‚æœæŒæœ‰å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡ä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<h4 id="8-3ï¼Œå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»"><a href="#8-3ï¼Œå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»" class="headerlink" title="8.3ï¼Œå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»"></a>8.3ï¼Œå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»</h4><p>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»ï¼Œå¦‚æœä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡çš„æ–¹æ³•è¿”å›äº†ä¸€ä¸ªå†…éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ã€‚è¿™ä¸ªå†…éƒ¨ç±»å¯¹è±¡è¢«é•¿æœŸå¼•ç”¨äº†ï¼Œå³ä½¿é‚£ä¸ªå¤–éƒ¨ç±»å®ä¾‹å¯¹è±¡ä¸å†è¢«ä½¿ç”¨ï¼Œä½†ç”±äºå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¤–éƒ¨ç±»å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œè¿™ä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<h4 id="8-4ï¼Œå„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰"><a href="#8-4ï¼Œå„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰" class="headerlink" title="8.4ï¼Œå„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰"></a>8.4ï¼Œå„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰</h4><p>åœ¨å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆéœ€è¦å»ºç«‹ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œå½“ä¸å†ä½¿ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨closeæ–¹æ³•æ¥é‡Šæ”¾ä¸æ•°æ®åº“çš„è¿æ¥ã€‚åªæœ‰è¿æ¥è¢«å…³é—­åï¼Œåƒåœ¾å›æ”¶å™¨æ‰ä¼šå›æ”¶å¯¹åº”çš„å¯¹è±¡ã€‚å¦åˆ™ï¼Œå¦‚æœåœ¨è®¿é—®æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹Connectionã€Statementæˆ–ResultSetä¸æ˜¾æ€§åœ°å…³é—­ï¼Œå°†ä¼šé€ æˆå¤§é‡çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        conn =DriverManager.getConnection(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span>conn.createStatement();</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span>stmt.executeQuery(<span class="string">&quot;....&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>ï¼ˆException eï¼‰&#123;<span class="comment">//å¼‚å¸¸æ—¥å¿—</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 1ï¼å…³é—­ç»“æœé›† Statement</span></span><br><span class="line">        <span class="comment">// 2ï¼å…³é—­å£°æ˜çš„å¯¹è±¡ ResultSet</span></span><br><span class="line">        <span class="comment">// 3ï¼å…³é—­è¿æ¥ Connection</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-5ï¼Œå˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ"><a href="#8-5ï¼Œå˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ" class="headerlink" title="8.5ï¼Œå˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ"></a>8.5ï¼Œå˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ</h4><p> å˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªå˜é‡çš„å®šä¹‰çš„ä½œç”¨èŒƒå›´å¤§äºå…¶ä½¿ç”¨èŒƒå›´ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶åœ°æŠŠå¯¹è±¡è®¾ç½®ä¸ºnullï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class UsingRandom &#123;</span><br><span class="line">    private String msg;</span><br><span class="line">    public void receiveMsg()&#123;</span><br><span class="line">        readFromNet();//ä»ç½‘ç»œä¸­æ¥å—æ•°æ®ä¿å­˜åˆ°msgä¸­</span><br><span class="line">        saveDB();//æŠŠmsgä¿å­˜åˆ°æ•°æ®åº“ä¸­</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šé¢è¿™ä¸ªä¼ªä»£ç ï¼Œé€šè¿‡readFromNetæ–¹æ³•æŠŠæ¥å—çš„æ¶ˆæ¯ä¿å­˜åœ¨å˜é‡msgä¸­ï¼Œç„¶åè°ƒç”¨saveDBæ–¹æ³•æŠŠmsgçš„å†…å®¹ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ­¤æ—¶msgå·²ç»å°±æ²¡ç”¨äº†ï¼Œç”±äºmsgçš„ç”Ÿå‘½å‘¨æœŸä¸å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ­¤æ—¶msgè¿˜ä¸èƒ½å›æ”¶ï¼Œå› æ­¤é€ æˆäº†å†…å­˜æ³„æ¼ã€‚å®é™…ä¸Šè¿™ä¸ªmsgå˜é‡å¯ä»¥æ”¾åœ¨receiveMsgæ–¹æ³•å†…éƒ¨ï¼Œå½“æ–¹æ³•ä½¿ç”¨å®Œï¼Œé‚£ä¹ˆmsgçš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±ç»“æŸï¼Œæ­¤æ—¶å°±å¯ä»¥å›æ”¶äº†ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨å®Œmsgåï¼ŒæŠŠmsgè®¾ç½®ä¸ºnullï¼Œè¿™æ ·åƒåœ¾å›æ”¶å™¨ä¹Ÿä¼šå›æ”¶msgçš„å†…å­˜ç©ºé—´ã€‚</p>
<h4 id="8-6ï¼Œæ”¹å˜å“ˆå¸Œå€¼"><a href="#8-6ï¼Œæ”¹å˜å“ˆå¸Œå€¼" class="headerlink" title="8.6ï¼Œæ”¹å˜å“ˆå¸Œå€¼"></a>8.6ï¼Œæ”¹å˜å“ˆå¸Œå€¼</h4><p>æ”¹å˜å“ˆå¸Œå€¼ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å­˜å‚¨è¿›HashSeté›†åˆä¸­ä»¥åï¼Œå°±ä¸èƒ½ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„é‚£äº›å‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—æ®µäº†ã€‚</p>
<p>å¦åˆ™ï¼Œå¯¹è±¡ä¿®æ”¹åçš„å“ˆå¸Œå€¼ä¸æœ€åˆå­˜å‚¨è¿›HashSeté›†åˆä¸­æ—¶çš„å“ˆå¸Œå€¼å°±ä¸åŒäº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿åœ¨containsæ–¹æ³•ä½¿ç”¨è¯¥å¯¹è±¡çš„å½“å‰å¼•ç”¨ä½œä¸ºçš„å‚æ•°å»HashSeté›†åˆä¸­æ£€ç´¢å¯¹è±¡ï¼Œä¹Ÿå°†è¿”å›æ‰¾ä¸åˆ°å¯¹è±¡çš„ç»“æœï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ— æ³•ä»HashSeté›†åˆä¸­å•ç‹¬åˆ é™¤å½“å‰å¯¹è±¡ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ String ä¸ºä»€ä¹ˆè¢«è®¾ç½®æˆäº†ä¸å¯å˜ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°æŠŠ String å­˜å…¥ HashSetï¼Œæˆ–è€…æŠŠString å½“åš HashMap çš„ key å€¼ï¼›</p>
<p>å½“æˆ‘ä»¬æƒ³æŠŠè‡ªå·±å®šä¹‰çš„ç±»ä¿å­˜åˆ°æ•£åˆ—è¡¨çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯å¯¹è±¡çš„ hashCode ä¸å¯å˜ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ä¾‹1</span><br><span class="line"> */</span><br><span class="line">public class ChangeHashCode &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        HashSet set = new HashSet();</span><br><span class="line">        Person p1 = new Person(1001, &quot;AA&quot;);</span><br><span class="line">        Person p2 = new Person(1002, &quot;BB&quot;);</span><br><span class="line"></span><br><span class="line">        set.add(p1);</span><br><span class="line">        set.add(p2);</span><br><span class="line"></span><br><span class="line">        p1.name = &quot;CC&quot;;//å¯¼è‡´äº†å†…å­˜çš„æ³„æ¼</span><br><span class="line">        set.remove(p1); //åˆ é™¤å¤±è´¥</span><br><span class="line"></span><br><span class="line">        System.out.println(set);</span><br><span class="line"></span><br><span class="line">        set.add(new Person(1001, &quot;CC&quot;));</span><br><span class="line">        System.out.println(set);</span><br><span class="line"></span><br><span class="line">        set.add(new Person(1001, &quot;AA&quot;));</span><br><span class="line">        System.out.println(set);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person &#123;</span><br><span class="line">    int id;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    public Person(int id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (this == o) return true;</span><br><span class="line">        if (!(o instanceof Person)) return false;</span><br><span class="line"></span><br><span class="line">        Person person = (Person) o;</span><br><span class="line"></span><br><span class="line">        if (id != person.id) return false;</span><br><span class="line">        return name != null ? name.equals(person.name) : person.name == null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        int result = id;</span><br><span class="line">        result = 31 * result + (name != null ? name.hashCode() : 0);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Person&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¾‹2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangeHashCode1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        HashSet&lt;Point&gt; hs = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Point&gt;();</span><br><span class="line">        <span class="type">Point</span> <span class="variable">cc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>();</span><br><span class="line">        cc.setX(<span class="number">10</span>);<span class="comment">//hashCode = 41</span></span><br><span class="line">        hs.add(cc);</span><br><span class="line"></span><br><span class="line">        cc.setX(<span class="number">20</span>);<span class="comment">//hashCode = 51  æ­¤è¡Œä¸ºå¯¼è‡´äº†å†…å­˜çš„æ³„æ¼</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;hs.remove = &quot;</span> + hs.remove(cc));<span class="comment">//false</span></span><br><span class="line">        hs.add(cc);</span><br><span class="line">        System.out.println(<span class="string">&quot;hs.size = &quot;</span> + hs.size());<span class="comment">//size = 2</span></span><br><span class="line"></span><br><span class="line">        System.out.println(hs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setX</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        result = prime * result + x;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Point</span> <span class="variable">other</span> <span class="operator">=</span> (Point) obj;</span><br><span class="line">        <span class="keyword">if</span> (x != other.x) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Point&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;x=&quot;</span> + x +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8-7ï¼Œç¼“å­˜æ³„éœ²"><a href="#8-7ï¼Œç¼“å­˜æ³„éœ²" class="headerlink" title="8.7ï¼Œç¼“å­˜æ³„éœ²"></a>8.7ï¼Œç¼“å­˜æ³„éœ²</h4><p>å†…å­˜æ³„æ¼çš„å¦ä¸€ä¸ªå¸¸è§æ¥æºæ˜¯ç¼“å­˜ï¼Œä¸€æ—¦ä½ æŠŠå¯¹è±¡å¼•ç”¨æ”¾å…¥åˆ°ç¼“å­˜ä¸­ï¼Œä»–å°±å¾ˆå®¹æ˜“é—å¿˜ã€‚æ¯”å¦‚ï¼šä¹‹å‰é¡¹ç›®åœ¨ä¸€æ¬¡ä¸Šçº¿çš„æ—¶å€™ï¼Œåº”ç”¨å¯åŠ¨å¥‡æ…¢ç›´åˆ°å¤¯æ­»ï¼Œå°±æ˜¯å› ä¸ºä»£ç ä¸­ä¼šåŠ è½½ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åˆ°ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œæµ‹è¯•ç¯å¢ƒåªæœ‰å‡ ç™¾æ¡æ•°æ®ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒæœ‰å‡ ç™¾ä¸‡çš„æ•°æ®ã€‚</p>
<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨WeakHashMapä»£è¡¨ç¼“å­˜ï¼Œæ­¤ç§Mapçš„ç‰¹ç‚¹æ˜¯ï¼Œå½“é™¤äº†è‡ªèº«æœ‰å¯¹keyçš„å¼•ç”¨å¤–ï¼Œæ­¤keyæ²¡æœ‰å…¶ä»–å¼•ç”¨é‚£ä¹ˆæ­¤mapä¼šè‡ªåŠ¨ä¸¢å¼ƒæ­¤å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Map</span> <span class="variable">wMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeakHashMap</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        init();</span><br><span class="line">        testWeakHashMap();</span><br><span class="line">        testHashMap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ref1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ref2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct2&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ref3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct3&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ref4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct4&quot;</span>);</span><br><span class="line">        wMap.put(ref1, <span class="string">&quot;cacheObject1&quot;</span>);</span><br><span class="line">        wMap.put(ref2, <span class="string">&quot;cacheObject2&quot;</span>);</span><br><span class="line">        map.put(ref3, <span class="string">&quot;cacheObject3&quot;</span>);</span><br><span class="line">        map.put(ref4, <span class="string">&quot;cacheObject4&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Stringå¼•ç”¨ref1ï¼Œref2ï¼Œref3ï¼Œref4 æ¶ˆå¤±&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWeakHashMap</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;WeakHashMap GCä¹‹å‰&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object o : wMap.entrySet()) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.gc();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;WeakHashMap GCä¹‹å&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object o : wMap.entrySet()) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testHashMap</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HashMap GCä¹‹å‰&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object o : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.gc();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;HashMap GCä¹‹å&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object o : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç å’Œå›¾ç¤ºä¸»æ¼”æ¼”ç¤ºWeakHashMapå¦‚ä½•è‡ªåŠ¨é‡Šæ”¾ç¼“å­˜å¯¹è±¡ï¼Œå½“initå‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå±€éƒ¨å˜é‡å­—ç¬¦ä¸²å¼•ç”¨weakd1ï¼Œweakd2ï¼Œd1ï¼Œd2éƒ½ä¼šæ¶ˆå¤±ï¼Œæ­¤æ—¶åªæœ‰é™æ€mapä¸­ä¿å­˜ä¸­å¯¹å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨gcä¹‹åï¼ŒHashMapçš„æ²¡æœ‰è¢«å›æ”¶ï¼Œè€ŒWeakHashMapé‡Œé¢çš„ç¼“å­˜è¢«å›æ”¶äº†ã€‚</p>
<h4 id="8-8ï¼Œç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒ"><a href="#8-8ï¼Œç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒ" class="headerlink" title="8.8ï¼Œç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒ"></a>8.8ï¼Œç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒ</h4><p>å†…å­˜æ³„æ¼ç¬¬ä¸‰ä¸ªå¸¸è§æ¥æºæ˜¯ç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨ä½ å®ç°çš„APIä¸­æ³¨å†Œå›è°ƒï¼Œå´æ²¡æœ‰æ˜¾ç¤ºçš„å–æ¶ˆï¼Œé‚£ä¹ˆå°±ä¼šç§¯èšã€‚</p>
<p>éœ€è¦ç¡®ä¿å›è°ƒç«‹å³è¢«å½“ä½œåƒåœ¾å›æ”¶çš„æœ€ä½³æ–¹æ³•æ˜¯åªä¿å­˜å®ƒçš„å¼±å¼•ç”¨ï¼Œä¾‹å¦‚å°†ä»–ä»¬ä¿å­˜æˆä¸ºWeakHashMapä¸­çš„é”®ã€‚</p>
<h3 id="9ï¼Œå†…å­˜æ³„éœ²æ¡ˆä¾‹åˆ†æ"><a href="#9ï¼Œå†…å­˜æ³„éœ²æ¡ˆä¾‹åˆ†æ" class="headerlink" title="9ï¼Œå†…å­˜æ³„éœ²æ¡ˆä¾‹åˆ†æ"></a>9ï¼Œå†…å­˜æ³„éœ²æ¡ˆä¾‹åˆ†æ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Stack &#123;</span><br><span class="line">    private Object[] elements;</span><br><span class="line">    private int size = 0;</span><br><span class="line">    private static final int DEFAULT_INITIAL_CAPACITY = 16;</span><br><span class="line"></span><br><span class="line">    public Stack() &#123;</span><br><span class="line">        elements = new Object[DEFAULT_INITIAL_CAPACITY];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void push(Object e) &#123; //å…¥æ ˆ</span><br><span class="line">        ensureCapacity();</span><br><span class="line">        elements[size++] = e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Object pop() &#123; //å‡ºæ ˆ</span><br><span class="line">        if (size == 0)</span><br><span class="line">            throw new EmptyStackException();</span><br><span class="line">        return elements[--size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensureCapacity() &#123;</span><br><span class="line">        if (elements.length == size)</span><br><span class="line">            elements = Arrays.copyOf(elements, 2 * size + 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ç¨‹åºå¹¶æ²¡æœ‰æ˜æ˜¾çš„é”™è¯¯ï¼Œä½†æ˜¯è¿™æ®µç¨‹åºæœ‰ä¸€ä¸ªå†…å­˜æ³„æ¼ï¼Œéšç€GCæ´»åŠ¨çš„å¢åŠ ï¼Œæˆ–è€…å†…å­˜å ç”¨çš„ä¸æ–­å¢åŠ ï¼Œç¨‹åºæ€§èƒ½çš„é™ä½å°±ä¼šè¡¨ç°å‡ºæ¥ï¼Œä¸¥é‡æ—¶å¯å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯è¿™ç§å¤±è´¥æƒ…å†µç›¸å¯¹è¾ƒå°‘ã€‚</p>
<p>ä»£ç çš„ä¸»è¦é—®é¢˜åœ¨popå‡½æ•°ï¼Œä¸‹é¢é€šè¿‡è¿™å¼ å›¾ç¤ºå±•ç°ã€‚å‡è®¾è¿™ä¸ªæ ˆä¸€ç›´å¢é•¿ï¼Œå¢é•¿åå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/04/18/JVM/1647507959227.png" alt="1647507959227" loading="lazy"></p>
<p>å½“è¿›è¡Œå¤§é‡çš„popæ“ä½œæ—¶ï¼Œç”±äºå¼•ç”¨æœªè¿›è¡Œç½®ç©ºï¼Œgcæ˜¯ä¸ä¼šé‡Šæ”¾çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/04/18/JVM/1647507984156.png" alt="1647507984156" loading="lazy"></p>
<p>ä»ä¸Šå›¾ä¸­çœ‹ä»¥çœ‹å‡ºï¼Œå¦‚æœæ ˆå…ˆå¢é•¿ï¼Œå†æ”¶ç¼©ï¼Œé‚£ä¹ˆä»æ ˆä¸­å¼¹å‡ºçš„å¯¹è±¡å°†ä¸ä¼šè¢«å½“ä½œåƒåœ¾å›æ”¶ï¼Œå³ä½¿ç¨‹åºä¸å†ä½¿ç”¨æ ˆä¸­çš„è¿™äº›é˜Ÿè±¡ï¼Œä»–ä»¬ä¹Ÿä¸ä¼šå›æ”¶ï¼Œå› ä¸ºæ ˆä¸­ä»ç„¶ä¿å­˜è¿™å¯¹è±¡çš„å¼•ç”¨ï¼Œä¿—ç§°è¿‡æœŸå¼•ç”¨ï¼Œè¿™ä¸ªå†…å­˜æ³„éœ²å¾ˆéšè”½ã€‚</p>
<p>å°†ä»£ç ä¸­çš„pop()æ–¹æ³•å˜æˆå¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmptyStackException</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> elements[--size];</span><br><span class="line">    elements[size] = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦å¼•ç”¨è¿‡æœŸï¼Œæ¸…ç©ºè¿™äº›å¼•ç”¨ï¼Œå°†å¼•ç”¨ç½®ç©ºã€‚</p>
<p><img src="/2022/04/18/JVM/1647508012108.png" alt="1647508012108" loading="lazy"></p>
<h2 id="è¡¥å……ï¼šä½¿ç”¨OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯"><a href="#è¡¥å……ï¼šä½¿ç”¨OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯" class="headerlink" title="è¡¥å……ï¼šä½¿ç”¨OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯"></a>è¡¥å……ï¼šä½¿ç”¨OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯</h2><p>MATæ”¯æŒä¸€ç§ç±»ä¼¼äºSQLçš„æŸ¥è¯¢è¯­è¨€OQLï¼ˆObject Query Languageï¼‰ã€‚OQLä½¿ç”¨ç±»SQLè¯­æ³•ï¼Œå¯ä»¥åœ¨å †ä¸­è¿›è¡Œå¯¹è±¡çš„æŸ¥æ‰¾å’Œç­›é€‰ã€‚</p>
<h3 id="1ï¼ŒSELECTå­å¥"><a href="#1ï¼ŒSELECTå­å¥" class="headerlink" title="1ï¼ŒSELECTå­å¥"></a>1ï¼ŒSELECTå­å¥</h3><p>åœ¨MATä¸­ï¼ŒSelectå­å¥çš„æ ¼å¼ä¸SQLåŸºæœ¬ä¸€è‡´ï¼Œç”¨äºæŒ‡å®šè¦æ˜¾ç¤ºçš„åˆ—ã€‚Selectå­å¥ä¸­å¯ä»¥ä½¿ç”¨â€œï¼Šâ€ï¼ŒæŸ¥çœ‹ç»“æœå¯¹è±¡çš„å¼•ç”¨å®ä¾‹ï¼ˆç›¸å½“äºoutgoing referencesï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> java.util.Vector v</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨â€œOBJECTSâ€å…³é”®å­—ï¼Œå¯ä»¥å°†è¿”å›ç»“æœé›†ä¸­çš„é¡¹ä»¥å¯¹è±¡çš„å½¢å¼æ˜¾ç¤ºã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> objects v.elementData <span class="keyword">FROM</span> java.util.Vector v</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> OBJECTS s.value <span class="keyword">FROM</span> java.lang.String s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨Selectå­å¥ä¸­ï¼Œä½¿ç”¨â€œAS RETAINED SETâ€å…³é”®å­—å¯ä»¥å¾—åˆ°æ‰€å¾—å¯¹è±¡çš„ä¿ç•™é›†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT AS RETAINED SET *FROM com.atguigu.mat.Student</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> â€œDISTINCTâ€å…³é”®å­—ç”¨äºåœ¨ç»“æœé›†ä¸­å»é™¤é‡å¤å¯¹è±¡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> OBJECTS classof(s) <span class="keyword">FROM</span> java.lang.String s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼ŒFROMå­å¥"><a href="#2ï¼ŒFROMå­å¥" class="headerlink" title="2ï¼ŒFROMå­å¥"></a>2ï¼ŒFROMå­å¥</h3><p>Fromå­å¥ç”¨äºæŒ‡å®šæŸ¥è¯¢èŒƒå›´ï¼Œå®ƒå¯ä»¥æŒ‡å®šç±»åã€æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…å¯¹è±¡åœ°å€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM java.lang.String s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé™å®šæœç´¢èŒƒå›´ï¼Œè¾“å‡ºæ‰€æœ‰com.atguiguåŒ…ä¸‹æ‰€æœ‰ç±»çš„å®ä¾‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> &quot;com\.atguigu\..*&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç±»çš„åœ°å€è¿›è¡Œæœç´¢ã€‚ä½¿ç”¨ç±»çš„åœ°å€çš„å¥½å¤„æ˜¯å¯ä»¥åŒºåˆ†è¢«ä¸åŒClassLoaderåŠ è½½çš„åŒä¸€ç§ç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from <span class="number">0x37a0b4d</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3ï¼ŒWHEREå­å¥"><a href="#3ï¼ŒWHEREå­å¥" class="headerlink" title="3ï¼ŒWHEREå­å¥"></a>3ï¼ŒWHEREå­å¥</h3><p>Whereå­å¥ç”¨äºæŒ‡å®šOQLçš„æŸ¥è¯¢æ¡ä»¶ã€‚OQLæŸ¥è¯¢å°†åªè¿”å›æ»¡è¶³Whereå­å¥æŒ‡å®šæ¡ä»¶çš„å¯¹è±¡ã€‚Whereå­å¥çš„æ ¼å¼ä¸ä¼ ç»ŸSQLæä¸ºç›¸ä¼¼ã€‚</p>
<p>è¿”å›é•¿åº¦å¤§äº10çš„charæ•°ç»„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span><span class="keyword">FROM</span> Ichar[] s <span class="keyword">WHERE</span> s.<span class="variable">@length</span><span class="operator">&gt;</span><span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿”å›åŒ…å«â€œjavaâ€å­å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œä½¿ç”¨â€œLIKEâ€æ“ä½œç¬¦ï¼Œâ€œLIKEâ€æ“ä½œç¬¦çš„æ“ä½œå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> java.lang.String s <span class="keyword">WHERE</span> toString(s) <span class="keyword">LIKE</span> &quot;.*java.*&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿”å›æ‰€æœ‰valueåŸŸä¸ä¸ºnullçš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨â€œï¼â€æ“ä½œç¬¦ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> java.lang.String s <span class="keyword">where</span> s.value<span class="operator">!=</span><span class="keyword">null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿”å›æ•°ç»„é•¿åº¦å¤§äº15ï¼Œå¹¶ä¸”æ·±å †å¤§äº1000å­—èŠ‚çš„æ‰€æœ‰Vectorå¯¹è±¡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> java.util.Vector v <span class="keyword">WHERE</span> v.elementData.<span class="variable">@length</span><span class="operator">&gt;</span><span class="number">15</span> <span class="keyword">AND</span> v.<span class="variable">@retainedHeapSize</span><span class="operator">&gt;</span><span class="number">1000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4ï¼Œå†…ç½®å¯¹è±¡ä¸æ–¹æ³•"><a href="#4ï¼Œå†…ç½®å¯¹è±¡ä¸æ–¹æ³•" class="headerlink" title="4ï¼Œå†…ç½®å¯¹è±¡ä¸æ–¹æ³•"></a>4ï¼Œå†…ç½®å¯¹è±¡ä¸æ–¹æ³•</h3><p>OQLä¸­å¯ä»¥è®¿é—®å †å†…å¯¹è±¡çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è®¿é—®å †å†…ä»£ç†å¯¹è±¡çš„å±æ€§ã€‚è®¿é—®å †å†…å¯¹è±¡çš„å±æ€§æ—¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼Œå…¶ä¸­aliasä¸ºå¯¹è±¡åç§°ï¼š</p>
<p>[ <alias>. ] <field> . <field>. <field></field></field></field></alias></p>
<p>è®¿é—®java.io.Fileå¯¹è±¡çš„pathå±æ€§ï¼Œå¹¶è¿›ä¸€æ­¥è®¿é—®pathçš„valueå±æ€§ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> toString(f.path.value) <span class="keyword">FROM</span> java.io.File f</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºStringå¯¹è±¡çš„å†…å®¹ã€objectidå’ŒobjectAddressã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.toString(),s.@objectId, s.@objectAddress FROM java.lang.String s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºjava.util.Vectorå†…éƒ¨æ•°ç»„çš„é•¿åº¦ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> v.elementData.<span class="variable">@length</span> <span class="keyword">FROM</span> java.util.Vector v</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºæ‰€æœ‰çš„java.util.Vectorå¯¹è±¡åŠå…¶å­ç±»å‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> INSTANCEOF java.util.Vector</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.jpg"><img loading="lazy" src="/images/alipay.jpg" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wechatpay.png"><img loading="lazy" src="/images/wechatpay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ç¿”ä»”</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://example.com/2022/04/18/JVM/" title="JVM">http://example.com/2022/04/18/JVM/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2022/04/22/MySQL/" rel="prev" title="MySQL"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">MySQL</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/04/14/java%E5%AE%B9%E5%99%A8/" rel="next" title="javaå®¹å™¨"><span class="post-nav-text">javaå®¹å™¨</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2022 </span><span class="with-love" id="animate" title="äº‘æ¸¸å›çš„èµåŠ©è€…ä»¬"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ç¿”ä»”</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.2</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.8.11</span></div><div class="live-time"><span>æœ¬åšå®¢å·²è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2022-04-10T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>