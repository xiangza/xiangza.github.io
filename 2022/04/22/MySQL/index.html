<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="ç¿”ä»”"><meta name="copyright" content="ç¿”ä»”"><meta name="generator" content="Hexo 5.4.2"><meta name="theme" content="hexo-theme-yun"><title>MySQL | ç¿”ä»”çš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"ç¿”ä»”çš„å°ç«™","version":"1.8.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="MySQLMySQLåŸºç¡€ å…³ç³»å‹æ•°æ®åº“ä»‹ç»  MySQLâ€“å…³ç³»å‹æ•°æ®åº“ï¼Œå³ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ï¼Œ æ•°æ®è¢«å­˜æ”¾åœ¨æ•°æ®è¡¨ä¸­ï¼Œè¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®å­˜æ”¾ä¸€æ¡è®°å½•    å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“   MySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ â€¦â€¦ã€‚  é€»è¾‘æ¶æ„ æŸ¥çœ‹MySQLæä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“  1mysql&amp;gt">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="http://example.com/2022/04/22/MySQL/index.html">
<meta property="og:site_name" content="ç¿”ä»”çš„åšå®¢">
<meta property="og:description" content="MySQLMySQLåŸºç¡€ å…³ç³»å‹æ•°æ®åº“ä»‹ç»  MySQLâ€“å…³ç³»å‹æ•°æ®åº“ï¼Œå³ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ï¼Œ æ•°æ®è¢«å­˜æ”¾åœ¨æ•°æ®è¡¨ä¸­ï¼Œè¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®å­˜æ”¾ä¸€æ¡è®°å½•    å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“   MySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ â€¦â€¦ã€‚  é€»è¾‘æ¶æ„ æŸ¥çœ‹MySQLæä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“  1mysql&amp;gt">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/5e3c1a71724a38245aa43b02_99bf70d46cc247be878de9d3a88f0c44.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/mysql-engines.png">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650617400745.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652518964447.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1646898016786.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652519977029.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1646898307983.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652535888245.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652537418134.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652537586450.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652537735170.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652537967648.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538635126.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538678438.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538722505.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538795661.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538956398.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652538998937.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652539048751.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652539426761.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652539642752.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652539903395.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652540277507.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652544675225.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545083419.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545182764.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545241033.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545268118.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545631906.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545439062.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545506354.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545518977.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652545974710.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652546085128.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652546094715.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652546136658.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652546669589.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652547231676.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652547658710.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652547780982.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652547840923.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652548090555.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652548155147.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652548376384.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652580291130.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652580474560.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652581226906.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652581401199.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652581514453.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652582611080.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1646899331303.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652583833418.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652584043939.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652601775640.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652601959138.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652602035735.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652602831329.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652602890257.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652602954239.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652602987860.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652603092286.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652623845882.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652623892480.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652624631062.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652625722770.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652626601115.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652626823498.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652630395998.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652634143064.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652634751504.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652666059987.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652666132342.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652666508855.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652666747479.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652667131942.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652667421274.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652668413960.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652670533312.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652670685945.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652670738442.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652671186210.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652671531627.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652671628560.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652671861644.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652684705791.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652685135597.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652685189189.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652685275523.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652686027723.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652686141568.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652690582106.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652690678410.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652690811034.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652713242250.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652713829189.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652713862370.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652714131616.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652714405177.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652714434090.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652714567371.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652714712614.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715009226.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715210828.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715257722.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715332857.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715357719.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652715501264.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652720607329.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652720629046.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652720704825.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652720880325.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652720942195.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652755737778.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756053065.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756211837.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756235603.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756264542.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756283342.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756304291.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756667403.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756765892.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756802677.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756880490.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756899448.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652756906743.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652757900281.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652774108868.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652775351558.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652775498796.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652776009979.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652776358602.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652800805940.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652800859612.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652800937751.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652800975163.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801077419.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801501352.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801658998.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801777563.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801800349.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801837932.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652801918870.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802126122.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802431996.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802493533.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802512011.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802543296.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802659696.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652802988135.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652803226505.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652803421497.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652804981666.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652805311416.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652805357832.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652805409873.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652805437849.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652805709800.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653095427721.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653095561908.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653095842869.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653096704579.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653096838285.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653096886918.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653096956683.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653096975431.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653097396890.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653097545054.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653098304861.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653099167641.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653098552304.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653099157786.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653099265336.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653099413713.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1653099546460.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652691435656.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652691326064.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652691645599.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652692705943.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652692754560.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323233373932352e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/640-20201207160554677.png">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231303433373032332e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651305961834.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651306388108.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313734343234342e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313932303336382e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323130323031302e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323133343330362e706e67.png">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-31-1%E8%84%8F%E8%AF%BB(%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4)%E5%AE%9E%E4%BE%8B.jpg">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-31-2%E8%AF%BB%E5%B7%B2%E6%8F%90%E4%BA%A4%E5%AE%9E%E4%BE%8B.jpg">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-32-1%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%AE%9E%E4%BE%8B.jpg">
<meta property="og:image" content="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-33-2%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB.jpg">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/phantom_read.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650873846555.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650875129562.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650875207176.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650897393027.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650898012282.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650900198762.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650900288062.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650900546538.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650957070916.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650957504388.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650957883071.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650959125776.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650959522543.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650960042591.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1650960214857.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651153649950.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651153842808.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651153977055.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651154063137.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651154092511.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651154127091.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651155157883.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157169184.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157557490.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157569892.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157708035.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651217991131.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651218067477.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157886841.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157909096.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157929374.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651157994414.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651158015821.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651158032322.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651158117353.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652081406202.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652081470079.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652082843720.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652086149005.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652086201026.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652086806953.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652086850681.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652087407447.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652169004023.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652169192227.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652170474789.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652170745354.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173036069.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173276644.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173558534.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173592799.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173669364.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173708240.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173731122.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173783442.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173794633.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173831831.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652173949806.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652174650001.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652174882766.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652174991719.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652342298513.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652342452791.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652342593186.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652344319600.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652344953665.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652345215447.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652345400446.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652345657788.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652345739133.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652345887656.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652346900849.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652346954347.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231333532333737372e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231343434323638372e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232303434303435312e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232303833313834332e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313331333831392e706e67.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651307939016.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651307988699.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651307996814.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651308003294.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651320185635.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651393998025.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651395019178.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651415857990.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651481620005.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651481862505.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651481874818.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651482155999.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651741342257.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651741901928.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651483798762.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651497441083.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651758403654.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651758478245.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651497979915.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651498396421.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651499248866.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651558597258.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651558603939.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651558638351.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651558648806.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651559606567.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651560453447.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651561526629.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651561876661.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562209398.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562471166.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562707743.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562819770.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562846169.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651562944756.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651563249209.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651827877071.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651828065888.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651828226607.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651886095147.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651886137530.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651886935823.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651888551880.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651888559444.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651890657023.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651908943761.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651909261231.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651911811794.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651911900429.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912021363.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912164535.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912356028.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912394286.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912445005.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912521199.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912610232.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912651986.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912669153.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912961466.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912972253.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912982025.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651912991132.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913001481.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913014989.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913025657.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913181475.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913282692.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913320851.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913686382.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1651913783543.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652348444218.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652429016082.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652430305898.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652431025956.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652431463999.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652462253464.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652443319986.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652443344519.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652450290525.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652495493057.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652495571131.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652495968713.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652496020652.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652496079386.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652496104951.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652496322341.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652496673385.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652497523655.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652498741807.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652515436179.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516168388.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516682376.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516907424.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516948614.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516956893.png">
<meta property="og:image" content="http://example.com/2022/04/22/MySQL/1652516971520.png">
<meta property="article:published_time" content="2022-04-22T08:38:55.000Z">
<meta property="article:modified_time" content="2022-07-23T13:29:06.215Z">
<meta property="article:author" content="ç¿”ä»”">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/04/22/MySQL/5e3c1a71724a38245aa43b02_99bf70d46cc247be878de9d3a88f0c44.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="ç¿”ä»”"><img width="96" loading="lazy" src="/images/tx.jpg" alt="ç¿”ä»”"><span class="site-author-status" title="ä¸æƒ³ä¸Šå­¦">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">ç¿”ä»”</a></div><span class="site-name">ç¿”ä»”çš„åšå®¢</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="æˆ‘çš„ä¸»é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">28</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=910426929&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="985391895@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL"><span class="toc-number">1.</span> <span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.</span> <span class="toc-text">MySQLåŸºç¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">é€»è¾‘æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyISAM%E4%B8%8EInnoDB%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.1.</span> <span class="toc-text">MyISAMä¸InnoDBçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E6%9C%BA%E5%88%B6%E4%B8%8EInnoDB%E9%94%81%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.3.</span> <span class="toc-text">mysqlé€»è¾‘æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E5%89%96%E6%9E%90"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1.é€»è¾‘æ¶æ„å‰–æ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">1.1æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2Connectors"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">1.2Connectors</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9A%E8%BF%9E%E6%8E%A5%E5%B1%82"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">1.3ç¬¬ä¸€å±‚ï¼šè¿æ¥å±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4%E7%AC%AC%E4%BA%8C%E5%B1%82%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%B1%82"><span class="toc-number">1.2.3.1.4.</span> <span class="toc-text">1.4ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5%E7%AC%AC%E4%B8%89%E5%B1%82%EF%BC%9A%E5%BC%95%E6%93%8E%E5%B1%82"><span class="toc-number">1.2.3.1.5.</span> <span class="toc-text">1.5ç¬¬ä¸‰å±‚ï¼šå¼•æ“å±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6%E7%AC%AC%E5%9B%9B%E5%B1%82%EF%BC%9A%E5%AD%98%E5%82%A8%E5%B1%82"><span class="toc-number">1.2.3.1.6.</span> <span class="toc-text">1.6ç¬¬å››å±‚ï¼šå­˜å‚¨å±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-7%E5%B0%8F%E7%BB%93"><span class="toc-number">1.2.3.1.7.</span> <span class="toc-text">1.7å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-SQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.SQLæ‰§è¡Œæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1MySQl%E4%B8%AD%E7%9A%84SQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">2.1MySQlä¸­çš„SQLæ‰§è¡Œæµç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2MySQL8%E4%B8%ADSQL%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">2.2MySQL8ä¸­SQLæ‰§è¡ŒåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E7%A1%AE%E8%AE%A4profiling%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF"><span class="toc-number">1.2.3.2.2.1.</span> <span class="toc-text">1.ç¡®è®¤profilingæ˜¯å¦å¼€å¯</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%E7%9B%B8%E5%90%8CSQL%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.2.2.2.</span> <span class="toc-text">2.å¤šæ¬¡æ‰§è¡Œç›¸åŒSQLæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8Bprofiles"><span class="toc-number">1.2.3.2.2.3.</span> <span class="toc-text">3.æŸ¥çœ‹profiles</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3MySQL5-7%E4%B8%ADSQL%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">2.3MySQL5.7ä¸­SQLæ‰§è¡ŒåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%80%E5%90%AF%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="toc-number">1.2.3.2.3.1.</span> <span class="toc-text">1.é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E9%87%8D%E5%90%AFmysql%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.3.2.3.2.</span> <span class="toc-text">2.é‡å¯mysqlæœåŠ¡</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E5%BC%80%E5%90%AF%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">1.2.3.2.3.3.</span> <span class="toc-text">3.å¼€å¯æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%E4%B8%A4%E6%AC%A1"><span class="toc-number">1.2.3.2.3.4.</span> <span class="toc-text">4.æ‰§è¡Œè¯­å¥ä¸¤æ¬¡</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8Bprofiles"><span class="toc-number">1.2.3.2.3.5.</span> <span class="toc-text">5.æŸ¥çœ‹profiles</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-%E6%9F%A5%E7%9C%8Bprofile"><span class="toc-number">1.2.3.2.3.6.</span> <span class="toc-text">6.æŸ¥çœ‹profile</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4SQL%E8%AF%AD%E6%B3%95%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">2.4SQLè¯­æ³•é¡ºåº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%86%B2%E6%B1%A0-buffer-pool"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">3.æ•°æ®åº“ç¼“å†²æ± (buffer pool)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E7%BC%93%E5%86%B2%E6%B1%A0-VS-%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="toc-number">1.2.3.3.1.</span> <span class="toc-text">3.1ç¼“å†²æ±  VS æŸ¥è¯¢ç¼“å­˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E7%BC%93%E5%86%B2%E6%B1%A0%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.3.3.2.</span> <span class="toc-text">3.2ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E6%9F%A5%E7%9C%8B-%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%86%B2%E6%B1%A0%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.2.3.3.3.</span> <span class="toc-text">3.3æŸ¥çœ‹&#x2F;è®¾ç½®ç¼“å†²æ± çš„å¤§å°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4%E5%A4%9A%E4%B8%AABuffer-Pool%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.2.3.3.4.</span> <span class="toc-text">3.4å¤šä¸ªBuffer Poolå®ä¾‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5%E5%BC%95%E7%94%B3%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.3.3.5.</span> <span class="toc-text">3.5å¼•ç”³é—®é¢˜</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.</span> <span class="toc-text">å­˜å‚¨å¼•æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.æŸ¥çœ‹å­˜å‚¨å¼•æ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AE%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%8C%87%E5%AE%9A%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">3.1åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">3.2ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.å¼•æ“ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1InnoDB%E5%BC%95%E6%93%8E%EF%BC%9A%E5%85%B7%E5%A4%87%E5%A4%96%E9%94%AE%E6%94%AF%E6%8C%81%E5%8A%9F%E8%83%BD%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">4.1InnoDBå¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2MyIASM%E5%BC%95%E6%93%8E%EF%BC%9A%E4%B8%BB%E8%A6%81%E7%9A%84%E9%9D%9E%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">4.2MyIASMå¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E5%BC%95%E6%93%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">4.3å¼•æ“å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-MyIASM%E5%92%8CInnoDB"><span class="toc-number">1.3.5.</span> <span class="toc-text">5.MyIASMå’ŒInnoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%98%BF%E9%87%8C%E3%80%81%E6%B7%98%E5%AE%9D%E7%94%A8%E5%93%AA%E4%B8%AA"><span class="toc-number">1.3.6.</span> <span class="toc-text">6.é˜¿é‡Œã€æ·˜å®ç”¨å“ªä¸ª</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%A1%A5%E5%85%85"><span class="toc-number">1.3.7.</span> <span class="toc-text">7.è¡¥å……</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-InnoDB%E8%A1%A8%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">1.InnoDBè¡¨çš„ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-InnoDb%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">2.InnoDbæ¶æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E6%80%A7%E8%83%BD%E4%B8%8B%E9%99%8D%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.3.8.</span> <span class="toc-text">sqlæ€§èƒ½ä¸‹é™çš„åŸå› </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E7%A7%8Djoin%E7%90%86%E8%AE%BA"><span class="toc-number">1.3.9.</span> <span class="toc-text">ä¸ƒç§joinç†è®º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.</span> <span class="toc-text">ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">ç´¢å¼•çš„æ•°æ®ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%8F%8A%E5%85%B6%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB%E4%B8%AD%E7%B4%A2%E5%BC%95%E7%9A%84%E6%8E%A8%E6%BC%94"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%B9%8B%E5%89%8D%E7%9A%84%E6%9F%A5%E6%89%BE"><span class="toc-number">1.4.1.3.1.</span> <span class="toc-text">ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8%E4%B8%80%E4%B8%AA%E9%A1%B5%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE"><span class="toc-number">1.4.1.3.1.1.</span> <span class="toc-text">åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8%E5%BE%88%E5%A4%9A%E9%A1%B5%E4%B8%AD%E6%9F%A5%E6%89%BE"><span class="toc-number">1.4.1.3.1.2.</span> <span class="toc-text">åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.3.2.</span> <span class="toc-text">è®¾è®¡ç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.1.3.2.1.</span> <span class="toc-text">ç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#InnoDB%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.1.3.2.2.</span> <span class="toc-text">InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%B4%A2%E5%BC%95%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.1.3.3.</span> <span class="toc-text">å¸¸è§çš„ç´¢å¼•æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.3.3.1.</span> <span class="toc-text">èšç°‡ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%EF%BC%88%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E3%80%81%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">1.4.1.3.3.2.</span> <span class="toc-text">äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.3.4.</span> <span class="toc-text">è”åˆç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#InnoDB%E7%9A%84B-%E6%A0%91%E7%B4%A2%E5%BC%95%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.4.1.3.4.1.</span> <span class="toc-text">InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyISAM%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#MyISAM%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.4.0.1.</span> <span class="toc-text">MyISAMç´¢å¼•çš„åŸç†</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MyISAM%E4%B8%8EInnoDb%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.1.4.0.2.</span> <span class="toc-text">MyISAMä¸InnoDbå¯¹æ¯”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BB%A3%E4%BB%B7"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">ç´¢å¼•çš„ä»£ä»·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%80%89%E6%8B%A9%E7%9A%84%E5%90%88%E7%90%86%E6%80%A7"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E8%A1%A8%E9%81%8D%E5%8E%86"><span class="toc-number">1.4.1.6.1.</span> <span class="toc-text">å…¨è¡¨éå†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hash%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.1.6.2.</span> <span class="toc-text">Hashç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91"><span class="toc-number">1.4.1.6.3.</span> <span class="toc-text">äºŒå‰æœç´¢æ ‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AVL%E6%A0%91"><span class="toc-number">1.4.1.6.4.</span> <span class="toc-text">AVLæ ‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-Tree"><span class="toc-number">1.4.1.6.5.</span> <span class="toc-text">B-Tree</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#B-Tree-1"><span class="toc-number">1.4.1.6.6.</span> <span class="toc-text">B+Tree</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#R%E6%A0%91"><span class="toc-number">1.4.1.6.7.</span> <span class="toc-text">Ræ ‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.1.6.8.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.4.2.</span> <span class="toc-text">ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%A3%B0%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1.ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.2.1.1.</span> <span class="toc-text">1.1ç´¢å¼•çš„åˆ†ç±»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.1.2.</span> <span class="toc-text">1.2åˆ›å»ºç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.1.2.1.</span> <span class="toc-text">1.åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%9C%A8%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E8%A1%A8%E4%B8%8A%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.1.2.2.</span> <span class="toc-text">2.åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MySQL8-0%E7%B4%A2%E5%BC%95%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E6%94%AF%E6%8C%81%E9%99%8D%E5%BA%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">2.1æ”¯æŒé™åºç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E9%9A%90%E8%97%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.2.2.</span> <span class="toc-text">2.2éšè—ç´¢å¼•</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3.ç´¢å¼•çš„è®¾è®¡åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E9%80%82%E5%90%88%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.</span> <span class="toc-text">3.1å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%AD%97%E6%AE%B5%E7%9A%84%E6%95%B0%E5%80%BC%E6%9C%89%E5%94%AF%E4%B8%80%E6%80%A7%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.4.2.3.1.1.</span> <span class="toc-text">1.å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E9%A2%91%E7%B9%81%E4%BD%9C%E4%B8%BAwhere%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">1.4.2.3.1.2.</span> <span class="toc-text">2.é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E7%BB%8F%E5%B8%B8-GROUP-BY-%E5%92%8C-ORDER-BY-%E7%9A%84%E5%88%97"><span class="toc-number">1.4.2.3.1.3.</span> <span class="toc-text">3. ç»å¸¸ GROUP BY å’Œ ORDER BY çš„åˆ—</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-UPDATE%E3%80%81DELETE%E7%9A%84-WHERE-%E6%9D%A1%E4%BB%B6%E5%88%97"><span class="toc-number">1.4.2.3.1.4.</span> <span class="toc-text">4. UPDATEã€DELETEçš„ WHERE æ¡ä»¶åˆ—</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-DISTINCT%E5%AD%97%E6%AE%B5%E9%9C%80%E8%A6%81%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.5.</span> <span class="toc-text">5.DISTINCTå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-%E5%A4%9A%E8%A1%A8JOIN%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9C%E6%97%B6%EF%BC%8C%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.4.2.3.1.6.</span> <span class="toc-text">6.å¤šè¡¨JOINè¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#7-%E4%BD%BF%E7%94%A8%E5%88%97%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%B0%8F%E7%9A%84%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.7.</span> <span class="toc-text">7.ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#8-%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%89%8D%E7%BC%80%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.8.</span> <span class="toc-text">8.ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#9-%E5%8C%BA%E5%88%86%E5%BA%A6%E9%AB%98-%E6%95%A3%E5%88%97%E6%80%A7%E9%AB%98-%E7%9A%84%E5%88%97%E9%80%82%E5%90%88%E4%BD%9C%E4%B8%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.9.</span> <span class="toc-text">9.åŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#10-%E4%BD%BF%E7%94%A8%E6%9C%80%E9%A2%91%E7%B9%81%E7%9A%84%E5%88%97%E6%94%BE%E5%88%B0%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%9A%84%E5%B7%A6%E4%BE%A7"><span class="toc-number">1.4.2.3.1.10.</span> <span class="toc-text">10.ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#11-%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E9%83%BD%E8%A6%81%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E4%BC%98%E4%BA%8E%E5%8D%95%E5%80%BC%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.1.11.</span> <span class="toc-text">11.åœ¨å¤šä¸ªå­—æ®µéƒ½è¦å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E9%99%90%E5%88%B6%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E7%9B%AE"><span class="toc-number">1.4.2.3.2.</span> <span class="toc-text">3.2é™åˆ¶ç´¢å¼•çš„æ•°ç›®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8D%E9%80%82%E5%90%88%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.</span> <span class="toc-text">3.3å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%9C%A8where%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%88%B0%E7%9A%84%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%B8%8D%E8%A6%81%E8%AE%BE%E7%BD%AE%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.1.</span> <span class="toc-text">1.åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E9%87%8F%E5%B0%8F%E7%9A%84%E8%A1%A8%E6%9C%80%E5%A5%BD%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.2.</span> <span class="toc-text">2.æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E6%9C%89%E5%A4%A7%E9%87%8F%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%97%E4%B8%8A%E4%B8%8D%E8%A6%81%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.3.</span> <span class="toc-text">3.æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E9%81%BF%E5%85%8D%E5%AF%B9%E7%BB%8F%E5%B8%B8%E6%9B%B4%E6%96%B0%E7%9A%84%E8%A1%A8%E5%88%9B%E5%BB%BA%E8%BF%87%E5%A4%9A%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.4.</span> <span class="toc-text">4.é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-%E4%B8%8D%E5%BB%BA%E8%AE%AE%E7%94%A8%E6%97%A0%E5%BA%8F%E7%9A%84%E5%80%BC%E4%BD%9C%E4%B8%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.5.</span> <span class="toc-text">5.ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-%E5%88%A0%E9%99%A4%E4%B8%8D%E5%86%8D%E4%BD%BF%E7%94%A8%E6%88%96%E5%BE%88%E5%B0%91%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.6.</span> <span class="toc-text">6.åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#7-%E4%B8%8D%E8%A6%81%E5%AE%9A%E4%B9%89%E5%86%97%E4%BD%99%E6%88%96%E9%87%8D%E5%A4%8D%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.3.3.7.</span> <span class="toc-text">7.ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.2.3.4.</span> <span class="toc-text">3.4å°ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.3.</span> <span class="toc-text">æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%BC%98%E5%8C%96%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">1.æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">2.æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%9F%E8%AE%A1SQL%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%88%90%E6%9C%AC%EF%BC%9Alast-query-cost"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">3.ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9A%E4%BD%8D%E6%89%A7%E8%A1%8C%E6%85%A2%E7%9A%84SQL%EF%BC%9A%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">4.å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1%E5%BC%80%E5%90%AF%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.4.1.</span> <span class="toc-text">4.1å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%BC%80%E5%90%AFslow-query-log"><span class="toc-number">1.4.3.4.1.1.</span> <span class="toc-text">1.å¼€å¯slow_query_log</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9long-query-time%E9%98%88%E5%80%BC"><span class="toc-number">1.4.3.4.1.2.</span> <span class="toc-text">2.ä¿®æ”¹long_query_timeé˜ˆå€¼</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E6%9F%A5%E7%9C%8B%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%95%B0%E7%9B%AE"><span class="toc-number">1.4.3.4.2.</span> <span class="toc-text">4.2æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">1.4.3.4.3.</span> <span class="toc-text">4.3æ¡ˆä¾‹æ¼”ç¤º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4%E6%B5%8B%E8%AF%95%E5%8F%8A%E5%88%86%E6%9E%90"><span class="toc-number">1.4.3.4.4.</span> <span class="toc-text">4.4æµ‹è¯•åŠåˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%9Amysqldumpslow"><span class="toc-number">1.4.3.4.5.</span> <span class="toc-text">4.5æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-6%E5%85%B3%E9%97%AD%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.4.6.</span> <span class="toc-text">4.6å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-7%E5%88%A0%E9%99%A4%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.4.7.</span> <span class="toc-text">4.7åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8BSQL%E6%89%A7%E8%A1%8C%E6%88%90%E6%9C%AC%EF%BC%9ASHOW-PROFILE"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">5.æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%86%E6%9E%90%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%EF%BC%9AEXPLAIN"><span class="toc-number">1.4.3.6.</span> <span class="toc-text">6.åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1%E6%A6%82%E8%BF%B0"><span class="toc-number">1.4.3.6.1.</span> <span class="toc-text">6.1æ¦‚è¿°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.4.3.6.2.</span> <span class="toc-text">6.2åŸºæœ¬è¯­æ³•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.4.3.6.3.</span> <span class="toc-text">6.3æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4EXPLAIN%E5%90%84%E5%88%97%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.3.6.4.</span> <span class="toc-text">6.4EXPLAINå„åˆ—ä½œç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-table"><span class="toc-number">1.4.3.6.4.1.</span> <span class="toc-text">1.table</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-id"><span class="toc-number">1.4.3.6.4.2.</span> <span class="toc-text">2.id</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-select-type"><span class="toc-number">1.4.3.6.4.3.</span> <span class="toc-text">3.select_type</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-partitions"><span class="toc-number">1.4.3.6.4.4.</span> <span class="toc-text">4.partitions</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-type%E2%98%86"><span class="toc-number">1.4.3.6.4.5.</span> <span class="toc-text">5.typeâ˜†</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6-possible-keys%E5%92%8Ckey"><span class="toc-number">1.4.3.6.4.6.</span> <span class="toc-text">6.possible_keyså’Œkey</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#7-key-len%E2%98%86"><span class="toc-number">1.4.3.6.4.7.</span> <span class="toc-text">7.key_lenâ˜†</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#8-ref"><span class="toc-number">1.4.3.6.4.8.</span> <span class="toc-text">8.ref</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#9-rows%E2%98%86"><span class="toc-number">1.4.3.6.4.9.</span> <span class="toc-text">9.rowsâ˜†</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#10-filtered"><span class="toc-number">1.4.3.6.4.10.</span> <span class="toc-text">10.filtered</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#11-Extra%E2%98%86"><span class="toc-number">1.4.3.6.4.11.</span> <span class="toc-text">11.Extraâ˜†</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">InnoDBæ•°æ®å­˜å‚¨ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%EF%BC%9A%E9%A1%B5"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E7%A3%81%E7%9B%98%E4%B8%8E%E5%86%85%E5%AD%98%E4%BA%A4%E4%BA%92%E5%9F%BA%E6%9C%AC%E5%8D%95%E4%BD%8D"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">1.1ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E9%A1%B5%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">1.2é¡µç»“æ„æ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E9%A1%B5%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">1.3é¡µçš„å¤§å°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%E9%A1%B5%E7%9A%84%E4%B8%8A%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">1.4é¡µçš„ä¸Šå±‚ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A1%B5%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.é¡µçš„å†…éƒ¨ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9AFile-Header-%E6%96%87%E4%BB%B6%E5%A4%B4%E9%83%A8-%E5%92%8CFile-Trailer-%E6%96%87%E4%BB%B6%E5%B0%BE%E9%83%A8"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">ç¬¬ä¸€éƒ¨åˆ†ï¼šFile Header(æ–‡ä»¶å¤´éƒ¨)å’ŒFile Trailer(æ–‡ä»¶å°¾éƒ¨)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.</span> <span class="toc-text">äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">åŸºæœ¬æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%EF%BC%9F"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E7%89%A9"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">æ•°æ®åº“äº‹ç‰©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84ACID"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">æ•°æ®åº“çš„ACID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">äº‹ç‰©å®ç°åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">äº‹åŠ¡çš„çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.2.</span> <span class="toc-text">ä½¿ç”¨äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%98%BE%E7%A4%BA%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1.æ˜¾ç¤ºäº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%9A%90%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2.éšå¼äº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%9A%90%E5%BC%8F%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">3.éšå¼æäº¤æ•°æ®çš„æƒ…å†µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E7%89%A9%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.</span> <span class="toc-text">äº‹ç‰©çš„éš”ç¦»çº§åˆ«</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">éš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL%E9%BB%98%E8%AE%A4%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">MySQLé»˜è®¤éš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">è®¾ç½®éš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E6%BC%94%E7%A4%BA"><span class="toc-number">1.6.3.5.</span> <span class="toc-text">å®é™…æƒ…å†µæ¼”ç¤º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%B8%B8%E8%A7%81%E5%88%86%E7%B1%BB"><span class="toc-number">1.6.4.</span> <span class="toc-text">äº‹åŠ¡çš„å¸¸è§åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.</span> <span class="toc-text">MySQLäº‹åŠ¡æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-redo%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">1.redoæ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81redo-log"><span class="toc-number">1.6.5.1.1.</span> <span class="toc-text">1.1ä¸ºä»€ä¹ˆéœ€è¦redo log</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2redo-log%E7%9A%84%E5%A5%BD%E5%A4%84%E3%80%81%E7%89%B9%E7%82%B9"><span class="toc-number">1.6.5.1.2.</span> <span class="toc-text">1.2redo logçš„å¥½å¤„ã€ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3redo%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">1.6.5.1.3.</span> <span class="toc-text">1.3redoçš„ç»„æˆ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4redo%E7%9A%84%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.5.1.4.</span> <span class="toc-text">1.4redoçš„æ•´ä½“æµç¨‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5redo-log%E5%88%B7%E7%9B%98%E7%AD%96%E7%95%A5-redo-log-buffer-gt-redo-log-file"><span class="toc-number">1.6.5.1.5.</span> <span class="toc-text">1.5redo logåˆ·ç›˜ç­–ç•¥(redo log buffer -&gt; redo log file)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6%E4%B8%8D%E5%90%8C%E5%88%B7%E7%9B%98%E7%AD%96%E7%95%A5%E6%BC%94%E7%A4%BA"><span class="toc-number">1.6.5.1.6.</span> <span class="toc-text">1.6ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-7%E5%86%99%E5%85%A5redo-log-buffer%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.5.1.7.</span> <span class="toc-text">1.7å†™å…¥redo log bufferè¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E8%A1%A5%E5%85%85%E6%A6%82%E5%BF%B5%EF%BC%9AMini-Transaction"><span class="toc-number">1.6.5.1.7.1.</span> <span class="toc-text">1.è¡¥å……æ¦‚å¿µï¼šMini-Transaction</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-redo%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5log-buffer"><span class="toc-number">1.6.5.1.7.2.</span> <span class="toc-text">2.redoæ—¥å¿—å†™å…¥log buffer</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-redo-log-block%E7%9A%84%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-number">1.6.5.1.7.3.</span> <span class="toc-text">3.redo log blockçš„ç»“æ„å›¾</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-8redo-log-file"><span class="toc-number">1.6.5.1.8.</span> <span class="toc-text">1.8redo log file</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-9redo-log%E5%B0%8F%E7%BB%93"><span class="toc-number">1.6.5.1.9.</span> <span class="toc-text">1.9redo logå°ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Undo%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">Undoæ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3Undo%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.2.1.</span> <span class="toc-text">1.å¦‚ä½•ç†è§£Undoæ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Undo%E6%97%A5%E5%BF%97%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.6.5.2.2.</span> <span class="toc-text">2.Undoæ—¥å¿—çš„ä½œç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-undo%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.6.5.2.3.</span> <span class="toc-text">3.undoçš„å­˜å‚¨ç»“æ„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4undo%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.5.2.4.</span> <span class="toc-text">4undoçš„ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-undo-log%E7%9A%84%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F"><span class="toc-number">1.6.5.2.5.</span> <span class="toc-text">5.undo logçš„å£°æ˜å‘¨æœŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6%E5%B0%8F%E7%BB%93"><span class="toc-number">1.6.5.2.6.</span> <span class="toc-text">6å°ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.</span> <span class="toc-text">å…¶ä»–æ•°æ®åº“æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E6%94%AF%E6%8C%81%E7%9A%84%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">1.MySQLæ”¯æŒçš„æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E6%97%A5%E5%BF%97%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.6.1.1.</span> <span class="toc-text">1.1æ—¥å¿—ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E6%97%A5%E5%BF%97%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-number">1.6.6.1.2.</span> <span class="toc-text">1.2æ—¥å¿—çš„å¼Šç«¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%9A%E7%94%A8%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97-general-query-log"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">2.é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.6.2.1.</span> <span class="toc-text">2.1é—®é¢˜åœºæ™¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.6.2.2.</span> <span class="toc-text">2.2æŸ¥çœ‹å½“å‰çŠ¶æ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3%E5%90%AF%E5%8A%A8%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.2.3.</span> <span class="toc-text">2.3å¯åŠ¨æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.2.4.</span> <span class="toc-text">2.4æŸ¥çœ‹æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5%E5%81%9C%E6%AD%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.2.5.</span> <span class="toc-text">2.5åœæ­¢æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6%E5%88%A0%E9%99%A4-%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.2.6.</span> <span class="toc-text">2.6åˆ é™¤&#x2F;åˆ·æ–°æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%EF%BC%88error-log%EF%BC%89"><span class="toc-number">1.6.6.3.</span> <span class="toc-text">3.é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E5%90%AF%E5%8A%A8%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.3.1.</span> <span class="toc-text">3.1å¯åŠ¨æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.3.2.</span> <span class="toc-text">3.2æŸ¥çœ‹æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E5%88%A0%E9%99%A4-%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.3.3.</span> <span class="toc-text">3.3åˆ é™¤&#x2F;åˆ·æ–°æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4MySQL8-0%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.6.6.3.4.</span> <span class="toc-text">3.4MySQL8.0æ–°ç‰¹æ€§</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%EF%BC%88bin-log%EF%BC%89"><span class="toc-number">1.6.6.4.</span> <span class="toc-text">4.äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1%E6%9F%A5%E7%9C%8B%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5"><span class="toc-number">1.6.6.4.1.</span> <span class="toc-text">4.1æŸ¥çœ‹é»˜è®¤æƒ…å†µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E6%97%A5%E5%BF%97%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.6.6.4.2.</span> <span class="toc-text">4.2æ—¥å¿—å‚æ•°è®¾ç½®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.4.3.</span> <span class="toc-text">4.3æŸ¥çœ‹æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.6.4.4.</span> <span class="toc-text">4.4ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5%E5%88%A0%E9%99%A4%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.4.5.</span> <span class="toc-text">4.5åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-6%E5%85%B6%E4%BB%96%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.6.4.6.</span> <span class="toc-text">4.6å…¶ä»–åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89%E5%86%8D%E8%B0%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97-binlog"><span class="toc-number">1.6.6.5.</span> <span class="toc-text">5.ï¼ˆé‡ç‚¹ï¼‰å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1%E5%86%99%E5%85%A5%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.6.5.1.</span> <span class="toc-text">5.1å†™å…¥æœºåˆ¶</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2binlog%E4%B8%8Eredolog%E5%AF%B9%E6%AF%94"><span class="toc-number">1.6.6.5.2.</span> <span class="toc-text">5.2binlogä¸redologå¯¹æ¯”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4"><span class="toc-number">1.6.6.5.3.</span> <span class="toc-text">5.3ä¸¤é˜¶æ®µæäº¤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%B8%AD%E7%BB%A7%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.6.</span> <span class="toc-text">6.ä¸­ç»§æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.6.6.1.</span> <span class="toc-text">6.1ä»‹ç»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2%E6%9F%A5%E7%9C%8B%E4%B8%AD%E7%BB%A7%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.6.6.2.</span> <span class="toc-text">6.2æŸ¥çœ‹ä¸­ç»§æ—¥å¿—</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3%E6%81%A2%E5%A4%8D%E7%9A%84%E5%85%B8%E5%9E%8B%E9%94%99%E8%AF%AF"><span class="toc-number">1.6.6.6.3.</span> <span class="toc-text">6.3æ¢å¤çš„å…¸å‹é”™è¯¯</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E9%94%81"><span class="toc-number">1.7.</span> <span class="toc-text">å°é”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.</span> <span class="toc-text">é”ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">å°é”åè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E9%9A%90%E5%BC%8F%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%94%81%E5%AE%9A"><span class="toc-number">1.7.3.</span> <span class="toc-text">MySQLéšå¼ä¸æ˜¾ç¤ºé”å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.7.4.</span> <span class="toc-text">1.æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MySQL%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E8%AE%BF%E9%97%AE%E7%9B%B8%E5%90%8C%E8%AE%B0%E5%BD%95"><span class="toc-number">1.7.5.</span> <span class="toc-text">2.MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E8%AF%BB-%E8%AF%BB%E6%83%85%E5%86%B5"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">2.1è¯»-è¯»æƒ…å†µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E5%86%99-%E5%86%99%E6%83%85%E5%86%B5"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">2.2å†™-å†™æƒ…å†µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E8%AF%BB-%E5%86%99%E6%88%96%E5%86%99-%E8%AF%BB%E6%83%85%E5%86%B5"><span class="toc-number">1.7.5.3.</span> <span class="toc-text">2.3è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.5.4.</span> <span class="toc-text">2.4å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%94%81%E7%9A%84%E4%B8%8D%E5%90%8C%E8%A7%92%E5%BA%A6%E5%88%86%E7%B1%BB"><span class="toc-number">1.7.6.</span> <span class="toc-text">3.é”çš„ä¸åŒè§’åº¦åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%88%92%E5%88%86-%E8%AF%BB%E9%94%81%E3%80%81%E5%86%99%E9%94%81"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">3.1ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†:è¯»é”ã€å†™é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E7%9A%84%E7%B2%92%E5%BA%A6%E4%B8%8A%E5%88%92%E5%88%86%EF%BC%9A%E8%A1%A8%E7%BA%A7%E9%94%81%E3%80%81%E8%A1%8C%E7%BA%A7%E9%94%81%E3%80%81%E9%A1%B5%E7%BA%A7%E9%94%81"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">3.2ä»æ•°æ®æ“ä½œçš„ç²’åº¦ä¸Šåˆ’åˆ†ï¼šè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%A1%A8%E9%94%81%EF%BC%88Table-Lock%EF%BC%89"><span class="toc-number">1.7.6.2.1.</span> <span class="toc-text">1.è¡¨é”ï¼ˆTable Lockï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-InnoDB%E8%A1%8C%E9%94%81"><span class="toc-number">1.7.6.2.2.</span> <span class="toc-text">2.InnoDBè¡Œé”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%A1%B5%E9%94%81"><span class="toc-number">1.7.6.2.3.</span> <span class="toc-text">3.é¡µé”</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E4%BB%8E%E5%AF%B9%E9%94%81%E7%9A%84%E6%80%81%E5%BA%A6%E5%88%92%E5%88%86%EF%BC%9A%E4%B9%90%E8%A7%82%E9%94%81%E3%80%81%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">1.7.6.3.</span> <span class="toc-text">3.3ä»å¯¹é”çš„æ€åº¦åˆ’åˆ†ï¼šä¹è§‚é”ã€æ‚²è§‚é”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">1.7.6.3.1.</span> <span class="toc-text">1.æ‚²è§‚é”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.7.6.3.2.</span> <span class="toc-text">2.ä¹è§‚é”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%B8%A4%E7%A7%8D%E9%94%81%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.6.3.3.</span> <span class="toc-text">3.ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%E6%8C%89%E5%8A%A0%E9%94%81%E6%96%B9%E5%BC%8F%E5%88%92%E5%88%86%EF%BC%9A%E6%98%BE%E7%A4%BA%E9%94%81%E3%80%81%E9%9A%90%E5%BC%8F%E9%94%81"><span class="toc-number">1.7.6.4.</span> <span class="toc-text">3.4æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼šæ˜¾ç¤ºé”ã€éšå¼é”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E9%9A%90%E5%BC%8F%E9%94%81"><span class="toc-number">1.7.6.4.1.</span> <span class="toc-text">1.éšå¼é”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%98%BE%E7%A4%BA%E9%94%81"><span class="toc-number">1.7.6.4.2.</span> <span class="toc-text">2.æ˜¾ç¤ºé”</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%E5%85%B6%E4%BB%96%E9%94%81%E4%B9%8B%EF%BC%9A%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">1.7.6.5.</span> <span class="toc-text">3.5å…¶ä»–é”ä¹‹ï¼šå…¨å±€é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%E5%85%B6%E4%BB%96%E9%94%81%E4%B9%8B%EF%BC%9A%E6%AD%BB%E9%94%81"><span class="toc-number">1.7.6.6.</span> <span class="toc-text">3.6å…¶ä»–é”ä¹‹ï¼šæ­»é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%94%81%E7%9A%84%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.7.</span> <span class="toc-text">4.é”çš„å†…å­˜ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E3%80%81%E9%94%81%E7%9B%91%E6%8E%A7"><span class="toc-number">1.7.8.</span> <span class="toc-text">5.ã€é”ç›‘æ§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%97%B4%E6%AD%87%E9%94%81%E5%8A%A0%E9%94%81%E8%A7%84%E5%88%99%EF%BC%8811%E6%A1%88%E4%BE%8B%EF%BC%89"><span class="toc-number">1.7.9.</span> <span class="toc-text">6.é—´æ­‡é”åŠ é”è§„åˆ™ï¼ˆ11æ¡ˆä¾‹ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E7%AD%89%E5%80%BC%E6%9F%A5%E8%AF%A2%E9%97%B4%E6%AD%87%E9%94%81"><span class="toc-number">1.7.9.1.</span> <span class="toc-text">æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´æ­‡é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E9%9D%9E%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E7%AD%89%E5%80%BC%E6%9F%A5%E8%AF%A2%E9%94%81"><span class="toc-number">1.7.9.2.</span> <span class="toc-text">æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E9%94%81"><span class="toc-number">1.7.9.3.</span> <span class="toc-text">æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%9A%E9%9D%9E%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E9%94%81"><span class="toc-number">1.7.9.4.</span> <span class="toc-text">æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%94%EF%BC%9A%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2-bug"><span class="toc-number">1.7.9.5.</span> <span class="toc-text">æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ bug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%85%AD%EF%BC%9A%E9%9D%9E%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E4%B8%8A%E5%AD%98%E5%9C%A8%E2%80%9C%E7%AD%89%E5%80%BC%E2%80%9D%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">1.7.9.6.</span> <span class="toc-text">æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨â€œç­‰å€¼â€çš„ä¾‹å­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%83%EF%BC%9Alimit%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81"><span class="toc-number">1.7.9.7.</span> <span class="toc-text">æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%85%AB%EF%BC%9A%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">1.7.9.8.</span> <span class="toc-text">æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B9%9D%EF%BC%9Aorder-by%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F%E7%9A%84%E9%97%B4%E6%AD%87%E9%94%811"><span class="toc-number">1.7.9.9.</span> <span class="toc-text">æ¡ˆä¾‹ä¹ï¼šorder byç´¢å¼•æ’åºçš„é—´æ­‡é”1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%8D%81%EF%BC%9Aorder-by%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F%E7%9A%84%E9%97%B4%E9%9A%99%E9%94%812"><span class="toc-number">1.7.9.10.</span> <span class="toc-text">æ¡ˆä¾‹åï¼šorder byç´¢å¼•æ’åºçš„é—´éš™é”2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%8D%81%E4%B8%80%EF%BC%9Aupdate%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BE%8B%E5%AD%90-%E5%85%88%E6%8F%92%E5%85%A5%E5%90%8E%E5%88%A0%E9%99%A4"><span class="toc-number">1.7.9.11.</span> <span class="toc-text">æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.</span> <span class="toc-text">å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%89%8D%E6%8F%90%E6%A6%82%E8%A6%81"><span class="toc-number">1.8.1.</span> <span class="toc-text">1.å‰ææ¦‚è¦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFMVCC%EF%BC%9F"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">1.ä»€ä¹ˆæ˜¯MVCCï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BD%93%E5%89%8D%E8%AF%BB%E5%92%8C%E5%BF%AB%E7%85%A7%E8%AF%BB"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">2.å½“å‰è¯»å’Œå¿«ç…§è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1%E5%BF%AB%E7%85%A7%E8%AF%BB"><span class="toc-number">1.8.1.2.1.</span> <span class="toc-text">2.1å¿«ç…§è¯»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2%E5%BD%93%E5%89%8D%E8%AF%BB"><span class="toc-number">1.8.1.2.2.</span> <span class="toc-text">2.2å½“å‰è¯»</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BD%93%E5%89%8D%E8%AF%BB%E3%80%81%E5%BF%AB%E7%85%A7%E8%AF%BB%E5%92%8CMVCCC%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">3.å½“å‰è¯»ã€å¿«ç…§è¯»å’ŒMVCCCçš„å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MVCC%E8%83%BD%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F%E5%A5%BD%E5%A4%84%EF%BC%9F"><span class="toc-number">1.8.2.</span> <span class="toc-text">2.MVCCèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå¥½å¤„ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-MVCC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.3.</span> <span class="toc-text">3.MVCCå®ç°åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AF%86"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">3.1å‰æçŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%86%8D%E8%B0%88%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.8.3.1.1.</span> <span class="toc-text">1.å†è°ˆéš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5%E3%80%81undo-log%E7%89%88%E6%9C%AC%E9%93%BE"><span class="toc-number">1.8.3.1.2.</span> <span class="toc-text">2.éšè—å­—æ®µã€undo logç‰ˆæœ¬é“¾</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BReadView"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">3.2å®ç°åŸç†ä¹‹ReadView</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFReadView"><span class="toc-number">1.8.3.2.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯ReadView</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">1.8.3.2.2.</span> <span class="toc-text">è®¾è®¡æ€è·¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ReadView%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">1.8.3.2.3.</span> <span class="toc-text">ReadViewçš„è§„åˆ™</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.3.3.</span> <span class="toc-text">3.3æ•´ä½“æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">1.8.4.</span> <span class="toc-text">4.ä¸¾ä¾‹è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1READ-COMITED%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">4.1READ COMITEDéš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2REPEATABLE-READ%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">4.2REPEATABLE READéš”ç¦»çº§åˆ«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB"><span class="toc-number">1.8.5.</span> <span class="toc-text">5.å¦‚ä½•è§£å†³å¹»è¯»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-MVCC%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.6.</span> <span class="toc-text">6.MVCCç›¸å…³é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RR%E5%A6%82%E4%BD%95%E5%9C%A8RC%E5%9F%BA%E7%A1%80%E4%B8%8A%E8%A7%A3%E5%86%B3%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%EF%BC%9F"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">RRå¦‚ä½•åœ¨RCåŸºç¡€ä¸Šè§£å†³ä¸å¯é‡å¤è¯»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RC%E3%80%81RR%E7%BA%A7%E5%88%AB%E4%B8%8B%E7%9A%84InnoDB%E5%BF%AB%E7%85%A7%E8%AF%BB%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">RCã€RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.7.</span> <span class="toc-text">7.æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.9.</span> <span class="toc-text">ä¸»ä»å¤åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0-1"><span class="toc-number">1.9.1.</span> <span class="toc-text">1.æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E5%A6%82%E4%BD%95%E6%8F%90%E5%8D%87%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%8F%91%E8%83%BD%E5%8A%9B"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">1.1å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">1.2ä¸»ä»å¤åˆ¶çš„ä½œç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.2.</span> <span class="toc-text">2.ä¸»ä»å¤åˆ¶çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">2.1åŸç†å‰–æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E5%A4%8D%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">2.2å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E%E6%9E%B6%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">1.9.3.</span> <span class="toc-text">3.ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">3.1å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">3.2ä¸»æœºé…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E4%BB%8E%E6%9C%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">3.3.ä»æœºé…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%E4%B8%BB%E6%9C%BA%EF%BC%9A%E5%BB%BA%E7%AB%8B%E8%B4%A6%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="toc-number">1.9.3.4.</span> <span class="toc-text">3.4ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%E4%BB%8E%E6%9C%BA%EF%BC%9A%E9%85%8D%E7%BD%AE%E9%9C%80%E8%A6%81%E5%A4%8D%E5%88%B6%E7%9A%84%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.9.3.5.</span> <span class="toc-text">3.5ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.3.6.</span> <span class="toc-text">3.6æµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7%E5%81%9C%E6%AD%A2%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5"><span class="toc-number">1.9.3.7.</span> <span class="toc-text">3.7åœæ­¢ä¸»ä»åŒæ­¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8%E5%90%8E%E7%BB%AD"><span class="toc-number">1.9.3.8.</span> <span class="toc-text">3.8åç»­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.4.</span> <span class="toc-text">4.åŒæ­¥æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E7%90%86%E8%A7%A3%E4%B8%BB%E4%BB%8E%E5%BB%B6%E8%BF%9F%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">4.1ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E4%B8%BB%E4%BB%8E%E5%BB%B6%E8%BF%9F%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">4.2ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E4%B8%BB%E4%BB%8E%E5%BB%B6%E8%BF%9F"><span class="toc-number">1.9.4.3.</span> <span class="toc-text">4.3å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.4.4.</span> <span class="toc-text">4.4å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%9F%A5%E8%AF%86%E5%BB%B6%E4%BC%B8"><span class="toc-number">1.9.5.</span> <span class="toc-text">5.çŸ¥è¯†å»¶ä¼¸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">1.10.</span> <span class="toc-text">æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%89%A9%E7%90%86%E5%A4%87%E4%BB%BD%E4%B8%8E%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD"><span class="toc-number">1.10.1.</span> <span class="toc-text">1.ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-mysqldump%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD"><span class="toc-number">1.10.2.</span> <span class="toc-text">2.mysqldumpå®ç°é€»è¾‘å¤‡ä»½</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2022/04/22/MySQL/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="ç¿”ä»”"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ç¿”ä»”çš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MySQL</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-22 16:38:55" itemprop="dateCreated datePublished" datetime="2022-04-22T16:38:55+08:00">2022-04-22</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-07-23 21:29:06" itemprop="dateModified" datetime="2022-07-23T21:29:06+08:00">2022-07-23</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æ•°æ®åº“</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/MySQL/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">MySQL</span></a></span></div><div class="post-author"><span class="author-name">ç¿”ä»”</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="MySQLåŸºç¡€"><a href="#MySQLåŸºç¡€" class="headerlink" title="MySQLåŸºç¡€"></a>MySQLåŸºç¡€</h2><blockquote>
<p>å…³ç³»å‹æ•°æ®åº“ä»‹ç»</p>
</blockquote>
<p>MySQLâ€“å…³ç³»å‹æ•°æ®åº“ï¼Œå³ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ï¼Œ</p>
<p>æ•°æ®è¢«å­˜æ”¾åœ¨æ•°æ®è¡¨ä¸­ï¼Œè¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®å­˜æ”¾ä¸€æ¡è®°å½• <img src="/2022/04/22/MySQL/5e3c1a71724a38245aa43b02_99bf70d46cc247be878de9d3a88f0c44.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“</p>
</blockquote>
<p> MySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ â€¦â€¦ã€‚ </p>
<h2 id="é€»è¾‘æ¶æ„"><a href="#é€»è¾‘æ¶æ„" class="headerlink" title="é€»è¾‘æ¶æ„"></a>é€»è¾‘æ¶æ„</h2><blockquote>
<p>æŸ¥çœ‹MySQLæä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> engines;</span><br></pre></td></tr></table></figure>

<p> <img src="/2022/04/22/MySQL/mysql-engines.png" alt="æŸ¥çœ‹MySQLæä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“" loading="lazy"> </p>
<p> ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å‡º MySQL å½“<strong>å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDB</strong>ï¼Œå¹¶ä¸”åœ¨ 5.7 ç‰ˆæœ¬æ‰€æœ‰çš„å­˜å‚¨å¼•æ“ä¸­åªæœ‰ InnoDB æ˜¯äº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ <strong>InnoDB æ”¯æŒäº‹åŠ¡ã€‚</strong> </p>
<blockquote>
<p>æŸ¥çœ‹MySQLå½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> &quot;table_name&quot;;</span><br></pre></td></tr></table></figure>

<p> <img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.png" alt="æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“" loading="lazy"> </p>
<h3 id="MyISAMä¸InnoDBçš„åŒºåˆ«"><a href="#MyISAMä¸InnoDBçš„åŒºåˆ«" class="headerlink" title="MyISAMä¸InnoDBçš„åŒºåˆ«"></a>MyISAMä¸InnoDBçš„åŒºåˆ«</h3><p><img src="/2022/04/22/MySQL/1650617400745.png" alt="1650617400745" loading="lazy"></p>
<p>1.æ˜¯å¦æ”¯æŒè¡Œçº§é”</p>
<p>MyISAMåªæœ‰è¡¨çº§é”ï¼Œè€ŒInnoDBæ”¯æŒè¡Œçº§é”å’Œè¡¨çº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”</p>
<p>2.æ˜¯å¦æ”¯æŒäº‹ç‰©</p>
<p>MyISAMä¸æ”¯æŒäº‹ç‰©</p>
<p>InnoDBæä¾›äº‹ç‰©æ”¯æŒï¼Œå…·æœ‰æäº¤(commit)å’Œå›æ»š(rollback)äº‹ç‰©çš„èƒ½åŠ›</p>
<p>3.æ˜¯å¦æ”¯æŒå¤–é”®</p>
<p>MyISAMä¸æ”¯æŒï¼ŒInnoDBæ”¯æŒ</p>
<p><strong>è¡¥å……ï¼š</strong>ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨å¤–é”®ï¼Œåº”ç”¨å±‚é¢å¯ä»¥è§£å†³</p>
<p>4.æ˜¯å¦æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤</p>
<p>MyISAMä¸æ”¯æŒï¼ŒInnoDBæ”¯æŒ</p>
<p>ä½¿ç”¨InnoDBçš„æ•°æ®åº“å†å¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨ä¼šä¿è¯æ•°æ®æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ï¼Œä¾èµ–äºredo log</p>
<p><strong>è¡¥å……ï¼š</strong></p>
<ul>
<li>InnoDBä½¿ç”¨redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ä¿è¯äº‹ç‰©çš„æŒä¹…æ€§ï¼Œä½¿ç”¨undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ä¿è¯äº‹ç‰©çš„åŸå­æ€§</li>
<li>InnoDBé€šè¿‡é”æœºåˆ¶ã€MVCCç­‰æ‰‹æ®µæ¥ä¿è¯äº‹ç‰©çš„éš”ç¦»æ€§(é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong><code>REPEATABLE-READ</code></strong> å¯é‡å¤è¯»)</li>
<li>ä¿è¯äº†äº‹ç‰©çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿è¯</li>
</ul>
<p>5.æ˜¯å¦æ”¯æŒMVCC</p>
<p>MyISAMä¸æ”¯æŒï¼ŒInnoDBæ”¯æŒ</p>
<h3 id="é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"><a href="#é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•" class="headerlink" title="é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"></a>é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•</h3><blockquote>
<p>MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”</p>
</blockquote>
<ul>
<li>MyISAMé‡‡ç”¨è¡¨çº§é”</li>
<li>InnoDBé‡‡ç”¨è¡Œçº§é”å’Œè¡¨çº§é”ï¼Œé»˜è®¤è¡Œçº§é”</li>
</ul>
<blockquote>
<p>è¡¨çº§é”ä¸è¡Œçº§é”å¯¹æ¯”</p>
</blockquote>
<ul>
<li>è¡¨çº§é”ï¼šé”ç²’åº¦æœ€å¤§ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—å°‘ï¼ŒåŠ é”å—ï¼Œä¸ä¼šå‡ºç°æ­»é”ï¼Œé”å†²çªæ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦ä½</li>
<li>è¡Œçº§é”ï¼šé”ç²’åº¦æœ€å°ï¼Œå®ç°å¤æ‚ã€‚èµ„æºæ¶ˆè€—å¤§ï¼Œä¼šå‡ºç°æ­»é”ï¼ŒåŠ é”æ…¢ï¼Œé”å†²çªæ¦‚ç‡ä½ï¼Œå¹¶å‘åº¦é«˜</li>
</ul>
<blockquote>
<p>InnoDBå­˜å‚¨çš„å¼•æ“çš„é”çš„ç®—æ³•</p>
</blockquote>
<ul>
<li>Record lockï¼šè®°å½•é”ï¼Œå½“ä¸ªè¡Œè®°å½•ä¸Šçš„é”</li>
<li>Gap lockï¼šé—´æ­‡é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</li>
<li>Next-key lockï¼šrecord+gapä¸´é”®é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…æ‹¬è®°å½•æœ¬èº«</li>
</ul>
<h3 id="mysqlé€»è¾‘æ¶æ„"><a href="#mysqlé€»è¾‘æ¶æ„" class="headerlink" title="mysqlé€»è¾‘æ¶æ„"></a>mysqlé€»è¾‘æ¶æ„</h3><h4 id="1-é€»è¾‘æ¶æ„å‰–æ"><a href="#1-é€»è¾‘æ¶æ„å‰–æ" class="headerlink" title="1.é€»è¾‘æ¶æ„å‰–æ"></a>1.é€»è¾‘æ¶æ„å‰–æ</h4><h5 id="1-1æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚"><a href="#1-1æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚" class="headerlink" title="1.1æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚"></a>1.1æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</h5><p>é¦–å…ˆMySQLæ˜¯å…¸å‹çš„C/Sæ¶æ„ï¼Œå³Client/Serveræ¶æ„ï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºä½¿ç”¨çš„<strong>mysqld</strong>ã€‚</p>
<p>ä¸è®ºå®¢æˆ·ç«¯è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹æ˜¯é‡‡ç”¨å“ªç§æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæœ€åå®ç°çš„æ•ˆæœéƒ½æ˜¯ï¼š**å®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡å™¨è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬(sqlè¯­å¥)ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¤„ç†åå†å‘å®¢æˆ·ç«¯è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬(å¤„ç†ç»“æœ)**ã€‚</p>
<p>é‚£æœåŠ¡å™¨è¿›ç¨‹å¯¹å®¢æˆ·ç«¯è¿›ç¨‹å‘é€çš„è¯·æ±‚åšäº†ä»€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½äº§ç”Ÿæœ€åçš„å¤„ç†ç»“æœå‘¢ï¼Ÿè¿™é‡Œä»¥æŸ¥è¯¢è¯·æ±‚ä¸ºä¾‹å±•ç¤ºï¼š<img src="/2022/04/22/MySQL/1652518964447.png" alt="1652518964447" loading="lazy"></p>
<p>ä¸‹é¢å…·ä½“å±•å¼€ä¸€ä¸‹ï¼š</p>
<p><img src="/2022/04/22/MySQL/1646898016786.png" alt="1646898016786" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652519977029.png" alt="1652519977029" loading="lazy"></p>
<p>mysqlåœ¨å­˜å‚¨å¼•æ“çš„æ¶æ„ä¸Šé‡‡ç”¨ <strong>æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„å°†æŸ¥è¯¢å¤„ç†å’Œå…¶ä»–çš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–ç›¸åˆ†ç¦»</strong> ã€‚è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€æ±‚é€‰æ‹©æ ¸å®çš„å­˜å‚¨å¼•æ“</p>
<p><strong>é€»è¾‘æ¶æ„åˆ†å±‚</strong></p>
<p><img src="/2022/04/22/MySQL/1646898307983.png" alt="1646898307983" loading="lazy"></p>
<h5 id="1-2Connectors"><a href="#1-2Connectors" class="headerlink" title="1.2Connectors"></a>1.2Connectors</h5><p>Connectorsï¼ŒæŒ‡çš„æ˜¯ä¸åŒè¯­è¨€ä¸­ä¸SQLçš„äº¤äº’ã€‚MySQLé¦–å…ˆæ˜¯ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œåœ¨TCPä¹‹ä¸Šå®šä¹‰äº†è‡ªå·±çš„åº”ç”¨å±‚åè®®ã€‚æ‰€ä»¥è¦ä½¿ç”¨MySQLï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç ï¼Œè·ŸMySQL Serverâ€™å»ºç«‹TCPè¿æ¥â€™,ä¹‹åæŒ‰ç…§å…¶å®šä¹‰å¥½çš„åè®®è¿›è¡Œäº¤äº’ã€‚æˆ–è€…æ¯”è¾ƒæ–¹ä¾¿çš„åŠæ³•æ˜¯è°ƒç”¨SDKï¼Œæ¯”å¦‚Native c APIã€JDBCã€PHPç­‰å„ç§è¯­è¨€MySQL Connectorï¼Œæˆ–è€…é€šè¿‡ODBCã€‚ä½†é€šè¿‡SDKæ¥è®¿é—®MySQLï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨TCPè¿æ¥ä¸Š<strong>é€šè¿‡MySQLåè®®è·ŸMySQLè¿›è¡Œäº¤äº’ã€‚</strong></p>
<h5 id="1-3ç¬¬ä¸€å±‚ï¼šè¿æ¥å±‚"><a href="#1-3ç¬¬ä¸€å±‚ï¼šè¿æ¥å±‚" class="headerlink" title="1.3ç¬¬ä¸€å±‚ï¼šè¿æ¥å±‚"></a>1.3ç¬¬ä¸€å±‚ï¼šè¿æ¥å±‚</h5><p>æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œè¿æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°socké€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äºtcplipçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</p>
<p>ç³»ç»Ÿï¼ˆå®¢æˆ·ç«¯ï¼‰è®¿é—® MySQL æœåŠ¡å™¨å‰ï¼Œåšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»ºç«‹ TCP è¿æ¥ã€‚ </p>
<p>ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æˆåŠŸåï¼Œ MySQL æœåŠ¡å™¨å¯¹ TCP ä¼ è¾“è¿‡æ¥çš„è´¦å·å¯†ç åšèº«ä»½è®¤è¯ã€æƒé™è·å–ã€‚ </p>
<ul>
<li><p><strong>ç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä¼šæ”¶åˆ°ä¸€ä¸ªAccess denied for useré”™è¯¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œ</strong> </p>
</li>
<li><p><strong>ç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œä¼šä»æƒé™è¡¨æŸ¥å‡ºè´¦å·æ‹¥æœ‰çš„æƒé™ä¸è¿æ¥å…³è”ï¼Œä¹‹åçš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™</strong> </p>
</li>
</ul>
<p><strong>TCP</strong> è¿æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¿…é¡»è¦åˆ†é…ç»™ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„äº¤äº’ã€‚æ‰€ä»¥è¿˜ä¼šæœ‰ä¸ªçº¿ç¨‹æ± ï¼Œå»èµ°åé¢çš„æµç¨‹ã€‚æ¯ä¸€ä¸ªè¿æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹ï¼Œçœå»äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚ </p>
<p><strong>æ€è€ƒï¼š</strong>ä¸€ä¸ªç³»ç»Ÿåªä¼šå’ŒMySQLæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªè¿æ¥å—åªèƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿå’ŒMySQLæœåŠ¡å™¨å»ºç«‹è¿æ¥å—ï¼Ÿ</p>
<p>å½“ç„¶ä¸æ˜¯ï¼Œå¤šä¸ªç³»ç»Ÿéƒ½å¯ä»¥å’ŒMySQLæœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œæ¯ä¸ªç³»ç»Ÿå»ºç«‹çš„è¿æ¥è‚¯å®šä¸æ­¢ä¸€ä¸ªã€‚æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³TCPæ— é™åˆ›å»ºä¸TCPé¢‘ç¹åˆ›å»ºé”€æ¯å¸¦æ¥çš„èµ„æºè€—å°½ã€æ€§èƒ½ä¸‹é™é—®é¢˜ã€‚MySQLæœåŠ¡å™¨é‡Œæœ‰ä¸“é—¨çš„<strong>TCPè¿æ¥æ± </strong>é™åˆ¶è¿æ¥æ•°ï¼Œé‡‡ç”¨<strong>é•¿è¿æ¥æ¨¡å¼</strong>å¤ç”¨TCPè¿æ¥ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚<img src="/2022/04/22/MySQL/1652535888245.png" alt="1652535888245" loading="lazy"></p>
<p>TCPè¿æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¿…é¡»è¦åˆ†é…ç»™ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ä¸è¿™ä¸ªå®¢æˆ·ç«¯çš„äº¤äº’ã€‚æ‰€ä»¥è¿˜ä¼šæœ‰ä¸ªçº¿ç¨‹æ± ï¼Œå»èµ°åé¢çš„æµç¨‹ã€‚æ¯ä¸ªè¿æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹ï¼Œçœå»äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚</p>
<p>è¿™äº›å†…å®¹éƒ½å½’çº³åˆ°MySQLçš„è¿æ¥ç®¡ç†ç»„ä»¶ä¸­ã€‚</p>
<p>æ‰€ä»¥<strong>è¿æ¥ç®¡ç†</strong>çš„èŒè´£æ˜¯è´Ÿè´£è®¤è¯ã€ç®¡ç†è¿æ¥ã€è·å–æƒé™ä¿¡æ¯ã€‚</p>
<h5 id="1-4ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚"><a href="#1-4ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚" class="headerlink" title="1.4ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚"></a>1.4ç¬¬äºŒå±‚ï¼šæœåŠ¡å±‚</h5><p>ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šå°‘çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–åŠéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šæŸ¥è¯¢è¡¨çš„é¡ºåºæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ˜¯selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ã€‚å¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
<p>ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–åŠéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚</p>
<p>åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºå†…éƒ¨çš„è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–ï¼šå¦‚ç¡®å®šæŸ¥è¯¢è¡¨çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œæœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚</p>
<p>å¦‚æœæ˜¯SELECTè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ã€‚å¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
<ul>
<li><p><strong>SQL Interface: SQLæ¥å£</strong></p>
<ul>
<li>æ¥æ”¶ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚SELECT â€¦ FROMå°±æ˜¯è°ƒç”¨SQL Interface </li>
<li>MySQLæ”¯æŒDMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰ã€DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰ã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ã€è‡ªå®šä¹‰å‡½æ•°ç­‰å¤šç§SQLè¯­è¨€æ¥å£ </li>
</ul>
</li>
<li><p><strong>Parser:</strong> <strong>è§£æå™¨</strong> </p>
<ul>
<li>åœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€‚å°†SQLè¯­å¥åˆ†è§£æˆæ•°æ®ç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ä¼ é€’åˆ°åç»­æ­¥éª¤ï¼Œä»¥åSQLè¯­å¥çš„ä¼ é€’å’Œå¤„ç†å°±æ˜¯åŸºäºè¿™ä¸ªç»“æ„çš„ã€‚å¦‚æœåœ¨åˆ†è§£æ„æˆä¸­é‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªSQLè¯­å¥æ˜¯ä¸åˆç†çš„ã€‚ </li>
<li>åœ¨SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æï¼Œå¹¶ä¸ºå…¶åˆ›å»º <strong>è¯­æ³•æ ‘</strong> ï¼Œå¹¶æ ¹æ®æ•°æ®å­—å…¸ä¸°å¯ŒæŸ¥è¯¢è¯­æ³•æ ‘ï¼Œä¼š <strong>éªŒè¯è¯¥å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡Œè¯¥æŸ¥è¯¢çš„æƒé™</strong> ã€‚åˆ›å»ºå¥½è¯­æ³•æ ‘åï¼ŒMySQLè¿˜ä¼šå¯¹SQlæŸ¥è¯¢è¿›è¡Œè¯­æ³•ä¸Šçš„ä¼˜åŒ–ï¼Œè¿›è¡ŒæŸ¥è¯¢é‡å†™ã€‚ </li>
</ul>
</li>
<li><p><strong>Optimizerï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨</strong></p>
<ul>
<li><p>SQLè¯­å¥åœ¨è¯­æ³•è§£æä¹‹åã€æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œç”Ÿæˆä¸€ä¸ª<strong>æ‰§è¡Œè®¡åˆ’</strong> ã€‚ </p>
</li>
<li><p>è¿™ä¸ªæ‰§è¡Œè®¡åˆ’è¡¨æ˜åº”è¯¥ <strong>ä½¿ç”¨å“ªäº›ç´¢å¼•</strong> è¿›è¡ŒæŸ¥è¯¢ï¼ˆå…¨è¡¨æ£€ç´¢è¿˜æ˜¯ä½¿ç”¨ç´¢å¼•æ£€ç´¢ï¼‰ï¼Œè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºå¦‚ä½•ï¼Œæœ€åä¼šæŒ‰ç…§æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤è°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ–¹æ³•æ¥çœŸæ­£çš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p>
</li>
<li><p>å®ƒä½¿ç”¨â€œ <strong>é€‰å–-æŠ•å½±-è¿æ¥</strong> â€ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT idï¼Œname FROM student WHERE gender = &#x27;å¥³&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®WHEREè¯­å¥è¿›è¡Œ é€‰å– ï¼Œè€Œä¸æ˜¯å°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ä»¥åå†è¿›è¡Œgenderè¿‡æ»¤ã€‚ è¿™ä¸ªSELECTæŸ¥è¯¢å…ˆæ ¹æ®idå’Œnameè¿›è¡Œå±æ€§ æŠ•å½± ï¼Œè€Œä¸æ˜¯å°†å±æ€§å…¨éƒ¨å–å‡ºä»¥åå†è¿›è¡Œè¿‡æ»¤ï¼Œå°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶ è¿æ¥ èµ·æ¥ç”Ÿæˆæœ€ç»ˆæŸ¥è¯¢ç»“æœã€‚</p>
</li>
</ul>
</li>
<li><p><strong>Caches &amp; Buffers****ï¼š æŸ¥è¯¢ç¼“å­˜ç»„ä»¶</strong> </p>
<ul>
<li>MySQLå†…éƒ¨ç»´æŒç€ä¸€äº›Cacheå’ŒBufferï¼Œæ¯”å¦‚Query Cacheç”¨æ¥ç¼“å­˜ä¸€æ¡SELECTè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœèƒ½å¤Ÿåœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ç»“æœï¼Œé‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡ŒæŸ¥è¯¢è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œç›´æ¥å°†ç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚ </li>
<li>è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰ ã€‚</li>
<li>è¿™ä¸ªæŸ¥è¯¢ç¼“å­˜å¯ä»¥åœ¨ <strong>ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº«</strong> ã€‚</li>
<li>ä»MySQL5.7.20å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶åœ¨MySQL8.0ä¸­åˆ é™¤</li>
</ul>
</li>
</ul>
<h5 id="1-5ç¬¬ä¸‰å±‚ï¼šå¼•æ“å±‚"><a href="#1-5ç¬¬ä¸‰å±‚ï¼šå¼•æ“å±‚" class="headerlink" title="1.5ç¬¬ä¸‰å±‚ï¼šå¼•æ“å±‚"></a>1.5ç¬¬ä¸‰å±‚ï¼šå¼•æ“å±‚</h5><p>å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚</p>
<hr>
<p>å’Œå…¶å®ƒæ•°æ®åº“ç›¸æ¯”ï¼ŒMysQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œå®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨ï¼Œä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“çš„æ¶æ„ä¸Šï¼Œ<strong>æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„</strong>å°†æŸ¥è¯¢å¤„ç†å’Œå…¶å®ƒçš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–ç›¸åˆ†ç¦»ã€‚è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚åŒæ—¶å¼€æºçš„MySQLè¿˜å…è®¸<strong>å¼€å‘äººå‘˜è®¾ç½®è‡ªå·±çš„å­˜å‚¨å¼•æ“</strong>ã€‚</p>
<p>è¿™ç§é«˜æ•ˆçš„æ¨¡å—åŒ–æ¶æ„ä¸ºé‚£äº›å¸Œæœ›ä¸“é—¨é’ˆå¯¹ç‰¹å®šåº”ç”¨ç¨‹åºéœ€æ±‚ï¼ˆä¾‹å¦‚æ•°æ®ä»“åº“ã€äº‹åŠ¡å¤„ç†æˆ–é«˜å¯ç”¨æ€§æƒ…å†µ)çš„äººæä¾›äº†å·¨å¤§çš„å¥½å¤„ï¼ŒåŒæ—¶äº«å—ä½¿ç”¨ä¸€ç»„ç‹¬ç«‹äºä»»ä½•æ¥å£å’ŒæœåŠ¡çš„ä¼˜åŠ¿å­˜å‚¨å¼•æ“ã€‚</p>
<p>æ’ä»¶å¼å­˜å‚¨å¼•æ“å±‚ï¼ˆ </p>
<p>Storage Enginesï¼‰ï¼Œ<strong>çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«ç»´æŠ¤çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œ</strong>ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦è¿›è¡Œé€‰å–ã€‚</p>
<p>MySQL8.0.25é»˜è®¤æ”¯æŒçš„å­˜å‚¨å¼•æ“å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652537418134.png" alt="1652537418134" loading="lazy"></p>
<h5 id="1-6ç¬¬å››å±‚ï¼šå­˜å‚¨å±‚"><a href="#1-6ç¬¬å››å±‚ï¼šå­˜å‚¨å±‚" class="headerlink" title="1.6ç¬¬å››å±‚ï¼šå­˜å‚¨å±‚"></a>1.6ç¬¬å››å±‚ï¼šå­˜å‚¨å±‚</h5><p>æ‰€æœ‰çš„æ•°æ®ï¼Œæ•°æ®åº“ã€è¡¨çš„å®šä¹‰ï¼Œè¡¨çš„æ¯ä¸€è¡Œçš„å†…å®¹ï¼Œç´¢å¼•ï¼Œéƒ½æ˜¯å­˜åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ä¸Šï¼Œä»¥<strong>æ–‡ä»¶</strong>çš„æ–¹å¼å­˜åœ¨çš„ï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚å½“ç„¶æœ‰äº›å­˜å‚¨å¼•æ“æ¯”å¦‚InnoDBï¼Œä¹Ÿæ”¯æŒä¸ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿç›´æ¥ç®¡ç†è£¸è®¾å¤‡ï¼Œä½†ç°ä»£æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä½¿å¾—è¿™æ ·åšæ²¡æœ‰å¿…è¦äº†ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç£ç›˜ï¼Œå¯ä»¥ä½¿ç”¨DASã€NASã€SANç­‰å„ç§å­˜å‚¨ç³»ç»Ÿ</p>
<h5 id="1-7å°ç»“"><a href="#1-7å°ç»“" class="headerlink" title="1.7å°ç»“"></a>1.7å°ç»“</h5><p>MySQLæ¶æ„å›¾ï¼Œä¸ºäº†ç†Ÿæ‚‰SQLæ‰§è¡Œæµç¨‹æ–¹ä¾¿ï¼Œç®€åŒ–å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652537586450.png" alt="1652537586450" loading="lazy"></p>
<p>ç®€åŒ–ä¸ºä¸‰å±‚ç»“æ„ï¼š </p>
<ol>
<li><p>è¿æ¥å±‚ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ SQL è‡³æœåŠ¡å™¨ç«¯ï¼› </p>
</li>
<li><p>SQL å±‚ï¼ˆæœåŠ¡å±‚ï¼‰ï¼šå¯¹ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›ä¸æ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼æ— å…³ï¼› </p>
</li>
<li><p>å­˜å‚¨å¼•æ“å±‚ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ã€‚ </p>
</li>
</ol>
<h4 id="2-SQLæ‰§è¡Œæµç¨‹"><a href="#2-SQLæ‰§è¡Œæµç¨‹" class="headerlink" title="2.SQLæ‰§è¡Œæµç¨‹"></a>2.SQLæ‰§è¡Œæµç¨‹</h4><h5 id="2-1MySQlä¸­çš„SQLæ‰§è¡Œæµç¨‹"><a href="#2-1MySQlä¸­çš„SQLæ‰§è¡Œæµç¨‹" class="headerlink" title="2.1MySQlä¸­çš„SQLæ‰§è¡Œæµç¨‹"></a>2.1MySQlä¸­çš„SQLæ‰§è¡Œæµç¨‹<img src="/2022/04/22/MySQL/1652537735170.png" alt="1652537735170" loading="lazy"></h5><p><strong>MySQLçš„æŸ¥è¯¢æµç¨‹ï¼š</strong></p>
<p><strong>1.æŸ¥è¯¢ç¼“å­˜ï¼š</strong>Serverå¦‚æœåœ¨æŸ¥è¯¢ç¼“å­˜ä¸­å‘ç°äº†è¿™æ¡SQLè¯­å¥ï¼Œå°±ä¼šç›´æ¥å°†ç»“æœè¿”å›å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±è¿›å…¥è§£æå™¨é˜¶æ®µï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜çš„æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥åœ¨MySQL8.0ä¹‹åå°±æŠ›å¼ƒäº†ç¼“å­˜<img src="/2022/04/22/MySQL/1652537967648.png" alt="1652537967648" loading="lazy"></p>
<p>MysQLæ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹ï¼Œä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚<strong>ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥key-valueå¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­</strong>ã€‚key æ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ°keyï¼Œé‚£ä¹ˆè¿™ä¸ªvalueå°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚<strong>æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­</strong>ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŸ¥è¯¢å‘½ä¸­ç¼“å­˜ï¼ŒMySQL ä¸éœ€è¦æ‰§è¡Œåé¢çš„å¤æ‚æ“ä½œï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¸ª<strong>æ•ˆç‡ä¼šå¾ˆé«˜ã€‚</strong></p>
<p><strong>å¤§å¤šæ•°æƒ…å†µä¸‹æŸ¥è¯¢ç¼“å­˜å°±æ˜¯é¸¡è‚‹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<p>æŸ¥è¯¢ç¼“å­˜æ˜¯æå‰æŠŠæŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨MySQLä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚è¿™å°±æ„å‘³ç€æŸ¥è¯¢åŒ¹é…çš„é²æ£’æ€§å¤§å¤§é™ä½ï¼Œåªæœ‰<strong>ç›¸åŒçš„æŸ¥è¯¢æ“ä½œæ‰ä¼šå‘½ä¸­æŸ¥è¯¢ç¼“å­˜</strong>ã€‚ä¸¤ä¸ªæŸ¥è¯¢è¯·æ±‚åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚:ç©ºæ ¼ã€æ³¨é‡Šã€å¤§å°å†™)ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚å› æ­¤MySQLçš„<strong>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜</strong>ã€‚</p>
<p>åŒæ—¶ï¼Œå¦‚æœæŸ¥è¯¢è¯·æ±‚ä¸­åŒ…å«æŸäº›ç³»ç»Ÿå‡½æ•°ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡å’Œå‡½æ•°ã€ä¸€äº›ç³»ç»Ÿè¡¨ï¼Œå¦‚mysql ã€information_schemaã€performance_schemaæ•°æ®åº“ä¸­çš„è¡¨ï¼Œé‚£è¿™ä¸ªè¯·æ±‚å°±ä¸ä¼šè¢«ç¼“å­˜ã€‚ä»¥æŸäº›ç³»ç»Ÿå‡½æ•°ä¸¾ä¾‹ï¼Œå¯èƒ½åŒæ ·çš„å‡½æ•°çš„ä¸¤æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿä¸ä¸€æ ·çš„ç»“æœï¼Œæ¯”å¦‚å‡½æ•°NOWï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šäº§ç”Ÿæœ€æ–°çš„å½“å‰æ—¶é—´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä¸­è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£å³ä½¿æŸ¥è¯¢è¯·æ±‚çš„æ–‡æœ¬ä¿¡æ¯éƒ½ä¸€æ ·ï¼Œé‚£ä¸åŒæ—¶é—´çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹Ÿåº”è¯¥å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å°±ç¼“å­˜äº†ï¼Œé‚£ç¬¬äºŒæ¬¡æŸ¥è¯¢çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœå°±æ˜¯é”™è¯¯çš„!</p>
<p>æ­¤å¤–ï¼Œæ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£å°±æœ‰å®ƒ<strong>ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™</strong>ã€‚MySQLçš„ç¼“å­˜ç³»ç»Ÿä¼šç›‘æµ‹æ¶‰åŠåˆ°çš„æ¯å¼ è¡¨ï¼Œåªè¦è¯¥è¡¨çš„ç»“æ„æˆ–è€…æ•°æ®è¢«ä¿®æ”¹ï¼Œå¦‚å¯¹è¯¥è¡¨ä½¿ç”¨äº†<strong>INSERTã€UPDATEã€DELETEã€TRUNCATE TABLEã€ALTER TABLEã€DROP TABLEæˆ– DROP DATABASEè¯­å¥</strong>ï¼Œé‚£ä½¿ç”¨è¯¥è¡¨çš„æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆå¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤!å¯¹äº<strong>æ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“</strong>æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚</p>
<p><strong>æ€»ä¹‹ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹</strong></p>
<p>ä¸€èˆ¬å»ºè®®å¤§å®¶åœ¨é™æ€è¡¨é‡Œä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä»€ä¹ˆå«<strong>é™æ€è¡¨</strong>å‘¢?å°±æ˜¯ä¸€èˆ¬æˆ‘ä»¬æå°‘æ›´æ–°çš„è¡¨ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ã€å­—å…¸è¡¨ï¼Œè¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚å¥½åœ¨MysQLä¹Ÿæä¾›äº†è¿™ç§Â°æŒ‰éœ€ä½¿ç”¨â€çš„æ–¹å¼ã€‚ä½ å¯ä»¥å°†my.cnfå‚æ•°query_cache_typeè®¾ç½®æˆDEMANDï¼Œä»£è¡¨å½“sqlè¯­å¥ä¸­æœ‰sQL_CACHEå…³é”®è¯æ—¶æ‰ç¼“å­˜ã€‚æ¯”å¦‚:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#query_cache_typeæœ‰3ä¸ªå€¼ 0ä»£è¡¨å…³é—­æŸ¥è¯¢ç¼“å­˜OFFã€1ä»£è¡¨å¼€å¯ONã€2(DEMAND)</span></span><br><span class="line"><span class="attr">query_cache_type</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¯¹äºé»˜è®¤çš„SQLè¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚è€Œå¯¹äºç¡®å®šçš„éœ€è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ï¼Œå¯ä»¥æ˜¾ç¤ºå¯åŠ¨ã€‚å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select SQL_CACHE * from test where ID=5;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å½“å‰mysqlå®ä¾‹æ˜¯å¦å¼€å¯ç¼“å­˜æœºåˆ¶<img src="/2022/04/22/MySQL/1652538635126.png" alt="1652538635126" loading="lazy"></p>
<p>ç›‘æ§æŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like&#x27;%Qcache%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652538678438.png" alt="1652538678438" loading="lazy"></p>
<p>è¿è¡Œç»“æœè§£æï¼š<img src="/2022/04/22/MySQL/1652538722505.png" alt="1652538722505" loading="lazy"></p>
<p><strong>2.è§£æå™¨ï¼š</strong>åœ¨è§£æå™¨ä¸­å¯¹SQLè¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æ<img src="/2022/04/22/MySQL/1652538795661.png" alt="1652538795661" loading="lazy"></p>
<p>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMysQLéœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹sQLè¯­å¥åšè§£æã€‚SQLè¯­å¥çš„åˆ†æåˆ†ä¸ºè¯æ³•åˆ†æä¸è¯­æ³•åˆ†æã€‚</p>
<p>åˆ†æå™¨å…ˆåšâ€œ<strong>è¯æ³•åˆ†æ</strong>â€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡sQLè¯­å¥ï¼ŒMySQLéœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚</p>
<p>MySQLä»ä½ è¾“å…¥çš„â€selectâ€è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨åTâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ—IDâ€ã€‚</p>
<p>æ¥ç€ï¼Œè¦åšâ€œ<strong>è¯­æ³•åˆ†æ</strong>â€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨(æ¯”å¦‚: Bisonï¼‰ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªsQLè¯­å¥æ˜¯å¦<strong>æ»¡è¶³MySQLè¯­æ³•ã€‚</strong></p>
<p>å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°â€You have an error in your SQL syntaxâ€çš„é”™è¯¯æé†’ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥fromå†™æˆäº†â€româ€ã€‚<img src="/2022/04/22/MySQL/1652538956398.png" alt="1652538956398" loading="lazy"></p>
<p>å¦‚æœSQLè¯­å¥æ­£ç¡®ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè¯­æ³•æ ‘ï¼š<img src="/2022/04/22/MySQL/1652538998937.png" alt="1652538998937" loading="lazy"></p>
<p>ä¸‹å›¾æ˜¯SQLè¯æ³•åˆ†æçš„è¿‡ç¨‹æ­¥éª¤ï¼š<img src="/2022/04/22/MySQL/1652539048751.png" alt="1652539048751" loading="lazy"></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬è§£æå™¨çš„å·¥ä½œä»»åŠ¡åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥è¿›å…¥ä¼˜åŒ–å™¨ã€‚</p>
<p><strong>3.ä¼˜åŒ–å™¨ï¼š</strong>åœ¨ä¼˜åŒ–å™¨ä¸­ä¼šç¡®å®šSQLè¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®<strong>å…¨è¡¨æ£€ç´¢</strong>ï¼Œè¿˜æ˜¯æ ¹æ®<strong>ç´¢å¼•æ£€ç´¢</strong>ç­‰ã€‚</p>
<p>ç»è¿‡äº†ä¼˜åŒ–å™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ï¼Œåœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦ç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚ä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¾ˆå¤šç§æ‰§è¡Œæ–¹å¼ï¼Œæœ€åéƒ½è¿”å›ç›¸åŒçš„ç»“æœã€‚ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ã€‚<img src="/2022/04/22/MySQL/1652539426761.png" alt="1652539426761" loading="lazy"></p>
<p>æ¯”å¦‚ï¼šä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¾ˆå¤šè¡¨å…³è”(join)çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºï¼Œè¿˜æœ‰è¡¨è¾¾å¼ç®€åŒ–ã€å­æŸ¥è¯¢è½¬ä¸ºè¿æ¥ã€å¤–è¿æ¥è½¬ä¸ºå†…è¿æ¥ç­‰ã€‚</p>
<p>ä¸¾ä¾‹ï¼šå¦‚ä¸‹è¯­å¥æ˜¯æ‰§è¡Œè¿ä¸ªè¡¨çš„joinï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test1 join test2 using(ID) where test1.name=&#x27;zhangwei&#x27; and test2.name=&#x27;mysqlé«˜çº§è¯¾ç¨‹&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652539642752.png" alt="1652539642752" loading="lazy"></p>
<p>åœ¨æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸­ï¼Œå¯ä»¥åˆ†ä¸º<strong>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å’Œç‰©ç†æŸ¥è¯¢ä¼˜åŒ–</strong>é˜¶æ®µ</p>
<p>é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–å°±æ˜¯é€šè¿‡æ”¹å˜sQLè¯­å¥çš„å†…å®¹æ¥ä½¿å¾—sQLæŸ¥è¯¢æ›´é«˜æ•ˆï¼ŒåŒæ—¶ä¸ºç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æä¾›æ›´å¤šçš„å€™é€‰æ‰§è¡Œè®¡åˆ’ã€‚é€šå¸¸é‡‡ç”¨çš„æ–¹å¼æ˜¯å¯¹sQLè¯­å¥è¿›è¡Œ<strong>ç­‰ä»·å˜æ¢</strong>ï¼Œå¯¹æŸ¥è¯¢è¿›è¡Œ<strong>é‡å†™</strong>ï¼Œè€ŒæŸ¥è¯¢é‡å†™çš„æ•°å­¦åŸºç¡€å°±æ˜¯å…³ç³»ä»£æ•°ã€‚å¯¹æ¡ä»¶è¡¨è¾¾å¼è¿›è¡Œç­‰ä»·è°“è¯é‡å†™ã€æ¡ä»¶ç®€åŒ–ï¼Œå¯¹è§†å›¾è¿›è¡Œé‡å†™ï¼Œå¯¹å­æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œå¯¹è¿æ¥è¯­ä¹‰è¿›è¡Œäº†å¤–è¿æ¥æ¶ˆé™¤ã€åµŒå¥—è¿æ¥æ¶ˆé™¤ç­‰ã€‚</p>
<p>ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–æ˜¯åŸºäºå…³ç³»ä»£æ•°è¿›è¡Œçš„æŸ¥è¯¢é‡å†™ï¼Œè€Œå…³ç³»ä»£æ•°çš„æ¯ä¸€æ­¥éƒ½å¯¹åº”ç€ç‰©ç†è®¡ç®—ï¼Œè¿™äº›ç‰©ç†è®¡ç®—å¾€å¾€å­˜åœ¨å¤šç§ç®—æ³•ï¼Œå› æ­¤éœ€è¦è®¡ç®—å„ç§ç‰©ç†è·¯å¾„çš„ä»£ä»·ï¼Œä»ä¸­é€‰æ‹©ä»£ä»·æœ€å°çš„ä½œä¸ºæ‰§è¡Œè®¡åˆ’ã€‚åœ¨è¿™ä¸ªé˜¶æ®µé‡Œå¯¹äºå•è¡¨å’Œå¤šè¡¨è¿æ¥çš„æ“ä½œï¼Œéœ€è¦é«˜æ•ˆåœ°ä½¿ç”¨ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p><strong>4.æ‰§è¡Œå™¨ï¼š</strong></p>
<p>æˆªæ­¢åˆ°ç°åœ¨ï¼Œè¿˜æ²¡æœ‰å»è¯»å†™çœŸå®çš„è¡¨ï¼Œä»…ä»…åªæ˜¯äº§å‡ºäº†ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œå°±è¿›å…¥äº†<strong>æ‰§è¡Œå™¨é˜¶æ®µ</strong><img src="/2022/04/22/MySQL/1652539903395.png" alt="1652539903395" loading="lazy"></p>
<p>åœ¨æ‰§è¡Œä¹‹å‰éœ€è¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦<strong>å…·æœ‰æƒé™</strong>ã€‚å¦‚æœæ²¡æœ‰ï¼Œä¼šè¿”å›æƒé™é”™è¯¯ï¼Œå¦‚æœæœ‰ï¼Œå°±æ‰§è¡ŒSQLæŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚åœ¨MySQL8.0ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¦‚æœè®¾ç½®äº†æŸ¥è¯¢ç¼“å­˜ï¼Œè¿™æ—¶ä¼šå°†æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“APIå¯¹è¡¨è¿›è¡Œçš„è¯»å†™ã€‚å­˜å‚¨å¼•æ“APIåªæ˜¯æŠ½è±¡æ¥å£ï¼Œä¸‹é¢è¿˜æœ‰ä¸ª<strong>å­˜å‚¨å¼•æ“å±‚</strong>ï¼Œå…·ä½“å®ç°è¿˜æ˜¯è¦çœ‹è¡¨é€‰æ‹©çš„å­˜å‚¨å¼•æ“ã€‚</p>
<p>æ¯”å¦‚è¡¨testä¸­ï¼ŒIDå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨ InnoDB å¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­ ID å€¼æ˜¯ä¸æ˜¯1ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼› è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚ </span><br><span class="line"></span><br><span class="line">æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œæˆã€‚å¯¹äºæœ‰ç´¢å¼•çš„è¡¨ï¼Œé€»è¾‘ä¹Ÿå·®ä¸å¤šã€‚</p>
<p>SQLè¯­å¥åœ¨MySQLä¸­çš„æµç¨‹æ˜¯ï¼š<img src="/2022/04/22/MySQL/1652540277507.png" alt="1652540277507" loading="lazy"></p>
<h5 id="2-2MySQL8ä¸­SQLæ‰§è¡ŒåŸç†"><a href="#2-2MySQL8ä¸­SQLæ‰§è¡ŒåŸç†" class="headerlink" title="2.2MySQL8ä¸­SQLæ‰§è¡ŒåŸç†"></a>2.2MySQL8ä¸­SQLæ‰§è¡ŒåŸç†</h5><p>å‰é¢çš„ç»“æ„å›¾å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦æŠ“å–æœ€æ ¸å¿ƒçš„éƒ¨åˆ†:sQLçš„æ‰§è¡ŒåŸç†ã€‚ä¸åŒçš„DBMSçš„SQLçš„æ‰§è¡ŒåŸç†æ˜¯ç›¸é€šçš„ï¼Œåªæ˜¯åœ¨ä¸åŒçš„è½¯ä»¶ä¸­ï¼Œå„æœ‰å„çš„å®ç°è·¯å¾„ã€‚</p>
<p>æ—¢ç„¶ä¸€æ¡SQLè¯­å¥ä¼šç»å†ä¸åŒçš„æ¨¡å—ï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ï¼Œåœ¨ä¸åŒçš„æ¨¡å—ä¸­ï¼ŒSQLæ‰§è¡Œæ‰€ä½¿ç”¨çš„èµ„æº(æ—¶é—´ï¼‰æ˜¯æ€æ ·çš„ã€‚å¦‚ä½•åœ¨MySQLä¸­å¯¹ä¸€æ¡sQLè¯­å¥çš„æ‰§è¡Œæ—¶é—´è¿›è¡Œåˆ†æã€‚</p>
<h6 id="1-ç¡®è®¤profilingæ˜¯å¦å¼€å¯"><a href="#1-ç¡®è®¤profilingæ˜¯å¦å¼€å¯" class="headerlink" title="1.ç¡®è®¤profilingæ˜¯å¦å¼€å¯"></a>1.ç¡®è®¤profilingæ˜¯å¦å¼€å¯</h6><p>äº†è§£æŸ¥è¯¢è¯­å¥åº•å±‚æ‰§è¡Œçš„è¿‡ç¨‹ï¼š<strong>select @@profiling;æˆ–è€…show variables like â€™%profiling%â€˜</strong>æŸ¥çœ‹æ˜¯å¦å¼€å¯è®¡åˆ’ã€‚å¼€å…¶ä»–å¯ä»¥è®©MySQLæ”¶é›†åœ¨SQLæ‰§è¡Œæ—¶æ‰€ä½¿ç”¨çš„èµ„æºæƒ…å†µï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@profiling;</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#x27;profiling&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652544675225.png" alt="1652544675225" loading="lazy"></p>
<p>profiling=0ä»£è¡¨å…³é—­ï¼Œéœ€è¦æŠŠprofilingæ‰“å¼€ï¼Œå³è®¾ç½®ä¸º1ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set profiling=1;</span><br></pre></td></tr></table></figure>

<p>profilingåŠŸèƒ½ç”±MySQLä¼šè¯å˜é‡ï¼šprofilingæ§åˆ¶ï¼Œé»˜è®¤æ˜¯OFFï¼ˆå…³é—­çŠ¶æ€ï¼‰ã€‚</p>
<h6 id="2-å¤šæ¬¡æ‰§è¡Œç›¸åŒSQLæŸ¥è¯¢"><a href="#2-å¤šæ¬¡æ‰§è¡Œç›¸åŒSQLæŸ¥è¯¢" class="headerlink" title="2.å¤šæ¬¡æ‰§è¡Œç›¸åŒSQLæŸ¥è¯¢"></a>2.å¤šæ¬¡æ‰§è¡Œç›¸åŒSQLæŸ¥è¯¢</h6><p>æ‰§è¡Œä¸€ä¸ªSQLæŸ¥è¯¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from employees;</span><br></pre></td></tr></table></figure>

<h6 id="3-æŸ¥çœ‹profiles"><a href="#3-æŸ¥çœ‹profiles" class="headerlink" title="3.æŸ¥çœ‹profiles"></a>3.æŸ¥çœ‹profiles</h6><p>æŸ¥çœ‹å½“å‰ä¼šè¯æ‰€äº§ç”Ÿçš„æ‰€æœ‰profilesï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profiles; # æ˜¾ç¤ºæœ€è¿‘çš„å‡ æ¬¡æŸ¥è¯¢</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545083419.png" alt="1652545083419" loading="lazy"></p>
<p>4.æŸ¥çœ‹profile</p>
<p>æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹ç¨‹åºçš„æ‰§è¡Œæ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545182764.png" alt="1652545182764" loading="lazy"></p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŸ¥è¯¢æŒ‡å®šçš„ Query IDï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 7;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ SQL çš„æ‰§è¡Œæ—¶é—´ç»“æœå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚ </p>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢æ›´ä¸°å¯Œçš„å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile cpu,block io for query 6;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545241033.png" alt="1652545241033" loading="lazy"></p>
<p>ç»§ç»­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile cpu,block io for query 7;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545268118.png" alt="1652545268118" loading="lazy"></p>
<p>1.é™¤äº†æŸ¥çœ‹CPUã€ioé˜»å¡ç­‰å‚æ•°æƒ…å†µï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ä¸‹åˆ—å‚æ•°çš„åˆ©ç”¨æƒ…å†µã€‚<img src="/2022/04/22/MySQL/1652545631906.png" alt="1652545631906" loading="lazy"></p>
<p>2.å‘ç°ä¸¤æ¬¡æŸ¥è¯¢å½“å‰æƒ…å†µéƒ½ä¸€è‡´ï¼Œè¯´æ˜æ²¡æœ‰ç¼“å­˜ä¸€è¯´ã€‚</p>
<p><strong>åœ¨8.0ç‰ˆæœ¬ä¹‹åï¼ŒMySQLä¸å†æ”¯æŒç¼“å­˜çš„æŸ¥è¯¢</strong>ã€‚ä¸€æ—¦æœ‰æ•°æ®è¡¨æ›´æ–°ï¼Œç¼“å­˜éƒ½å°†æ¸…ç©ºï¼Œå› æ­¤åªæœ‰æ•°æ®è¡¨æ˜¯é™æ€æ—¶ï¼Œæˆ–è€…æ•°æ®è¡¨å¾ˆå°‘å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨ç¼“å­˜æŸ¥è¯¢æ‰æœ‰ä»·å€¼ï¼Œå¦åˆ™å¦‚æœæ•°æ®è¡¨ç»å¸¸æ›´æ–°ï¼Œåè€Œå¢åŠ äº†æŸ¥è¯¢æ—¶é—´</p>
<h5 id="2-3MySQL5-7ä¸­SQLæ‰§è¡ŒåŸç†"><a href="#2-3MySQL5-7ä¸­SQLæ‰§è¡ŒåŸç†" class="headerlink" title="2.3MySQL5.7ä¸­SQLæ‰§è¡ŒåŸç†"></a>2.3MySQL5.7ä¸­SQLæ‰§è¡ŒåŸç†</h5><p>ä¸Šè¿°æ“ä½œåœ¨MySQL5.7ä¸­æµ‹è¯•ï¼Œå‘ç°å‰åä¸¤æ¬¡ç›¸åŒçš„sqlè¯­å¥ï¼Œæ‰§è¡Œçš„æŸ¥è¯¢è¿‡ç¨‹ä»ç„¶æ˜¯ç›¸åŒçš„ã€‚ä¸æ˜¯ä¼šä½¿ç”¨ ç¼“å­˜å—ï¼Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦ <strong>æ˜¾å¼å¼€å¯æŸ¥è¯¢ç¼“å­˜æ¨¡å¼</strong> ã€‚åœ¨MySQL5.7ä¸­å¦‚ä¸‹è®¾ç½®ï¼š</p>
<h6 id="1-é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜"><a href="#1-é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="1.é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜"></a>1.é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜</h6><p>åœ¨etc/my/cnfä¸­æ–°å¢ä¸€è¡Œï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">query_cache_type</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>

<h6 id="2-é‡å¯mysqlæœåŠ¡"><a href="#2-é‡å¯mysqlæœåŠ¡" class="headerlink" title="2.é‡å¯mysqlæœåŠ¡"></a>2.é‡å¯mysqlæœåŠ¡</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<h6 id="3-å¼€å¯æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’"><a href="#3-å¼€å¯æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’" class="headerlink" title="3.å¼€å¯æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’"></a>3.å¼€å¯æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</h6><p>ç”±äºé‡å¯è¿‡æœåŠ¡ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå¼€å¯profiling</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set profiling=1;</span><br></pre></td></tr></table></figure>

<h6 id="4-æ‰§è¡Œè¯­å¥ä¸¤æ¬¡"><a href="#4-æ‰§è¡Œè¯­å¥ä¸¤æ¬¡" class="headerlink" title="4.æ‰§è¡Œè¯­å¥ä¸¤æ¬¡"></a>4.æ‰§è¡Œè¯­å¥ä¸¤æ¬¡</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from locations; </span><br><span class="line">mysql&gt; select * from locations;</span><br></pre></td></tr></table></figure>

<h6 id="5-æŸ¥çœ‹profiles"><a href="#5-æŸ¥çœ‹profiles" class="headerlink" title="5.æŸ¥çœ‹profiles"></a>5.æŸ¥çœ‹profiles</h6><p><img src="/2022/04/22/MySQL/1652545439062.png" alt="1652545439062" loading="lazy"></p>
<h6 id="6-æŸ¥çœ‹profile"><a href="#6-æŸ¥çœ‹profile" class="headerlink" title="6.æŸ¥çœ‹profile"></a>6.æŸ¥çœ‹profile</h6><p>æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹ç¨‹åºçš„æ‰§è¡Œæ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 1;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545506354.png" alt="1652545506354" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 2;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652545518977.png" alt="1652545518977" loading="lazy"></p>
<p>ç»“è®ºä¸è¨€è€Œå–»ã€‚æ‰§è¡Œç¼–å·2æ—¶ï¼Œæ¯”æ‰§è¡Œç¼–å·1æ—¶å°‘äº†å¾ˆå¤šä¿¡æ¯ï¼Œä»æˆªå›¾ä¸­å¯ä»¥çœ‹å‡ºæŸ¥è¯¢è¯­å¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚ </p>
<ul>
<li><p>æ³¨æ„1ï¼šSQLå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™ï¼Œä¸èƒ½å‘½ä¸­ç¼“å­˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#è™½ç„¶æŸ¥è¯¢ç»“æœä¸€è‡´ï¼Œä½†å¹¶æ²¡æœ‰å‘½ä¸­ç¼“å­˜</span><br><span class="line">select * from mydb.mytbl where id=2;</span><br><span class="line">select * from mydb,mydbl where id&gt;1 and id&lt;3;</span><br></pre></td></tr></table></figure></li>
<li><p>æ³¨æ„2ï¼š</p>
<p>åŒæ ·çš„å¼€å¯ç¼“å­˜çš„é…ç½®ä¿¡æ¯å¦‚æœåœ¨MySQL8.0ä¸­æ·»åŠ ã€‚é‡å¯æœåŠ¡ä¼šæŠ¥é”™<img src="/2022/04/22/MySQL/1652545974710.png" alt="1652545974710" loading="lazy"></p>
</li>
</ul>
<p>åˆ†åˆ«åœ¨MySQL5.7å’Œ MySQL8.0æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%query_cache%&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>5.7:</p>
<p><img src="/2022/04/22/MySQL/1652546085128.png" alt="1652546085128" loading="lazy"></p>
</li>
<li><p>8.0:</p>
<p><img src="/2022/04/22/MySQL/1652546094715.png" alt="1652546094715" loading="lazy"></p>
</li>
</ul>
<h5 id="2-4SQLè¯­æ³•é¡ºåº"><a href="#2-4SQLè¯­æ³•é¡ºåº" class="headerlink" title="2.4SQLè¯­æ³•é¡ºåº"></a>2.4SQLè¯­æ³•é¡ºåº</h5><p>éšç€Mysqlç‰ˆæœ¬çš„æ›´æ–°æ¢ä»£ï¼Œå…¶ä¼˜åŒ–å™¨ä¹Ÿåœ¨ä¸æ–­çš„å‡çº§ï¼Œä¼˜åŒ–å™¨ä¼šåˆ†æä¸åŒæ‰§è¡Œé¡ºåºäº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ä¸åŒè€ŒåŠ¨æ€è°ƒæ•´æ‰§è¡Œé¡ºåºã€‚ </p>
<p>éœ€æ±‚ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨å¹´é¾„é«˜äº20å²çš„äººæ•°ä¸”é«˜äº20å²äººæ•°ä¸èƒ½å°‘äº2äººï¼Œæ˜¾ç¤ºäººæ•°æœ€å¤šçš„ç¬¬ä¸€åéƒ¨é—¨ä¿¡æ¯ </p>
<p>ä¸‹é¢æ˜¯ç»å¸¸å‡ºç°çš„æŸ¥è¯¢é¡ºåºï¼š <img src="/2022/04/22/MySQL/1652546136658.png" alt="1652546136658" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#7   select</span><br><span class="line">#1   from</span><br><span class="line">#3   join</span><br><span class="line">#2   on</span><br><span class="line">#4   where</span><br><span class="line">#5   group by</span><br><span class="line">#6   having</span><br><span class="line">#8   distinct</span><br><span class="line">#9   order by</span><br><span class="line">#10  limit</span><br></pre></td></tr></table></figure>

<h4 id="3-æ•°æ®åº“ç¼“å†²æ± -buffer-pool"><a href="#3-æ•°æ®åº“ç¼“å†²æ± -buffer-pool" class="headerlink" title="3.æ•°æ®åº“ç¼“å†²æ± (buffer pool)"></a>3.æ•°æ®åº“ç¼“å†²æ± (buffer pool)</h4><p><strong>InnoDB</strong> å­˜å‚¨å¼•æ“æ˜¯ä»¥é¡µä¸ºå•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬è¿›è¡Œçš„å¢åˆ æ”¹æŸ¥æ“ä½œå…¶å®æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨è®¿é—®é¡µé¢ï¼ˆåŒ…æ‹¬è¯»é¡µé¢ã€å†™é¡µé¢ã€åˆ›å»ºæ–°é¡µé¢ç­‰æ“ä½œï¼‰ã€‚è€Œç£ç›˜ I/O éœ€è¦æ¶ˆè€—çš„æ—¶é—´å¾ˆå¤šï¼Œè€Œåœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡åˆ™ä¼šé«˜å¾ˆå¤šï¼Œä¸ºäº†èƒ½è®©æ•°æ®è¡¨æˆ–è€…ç´¢å¼•ä¸­çš„æ•°æ®éšæ—¶è¢«æˆ‘ä»¬æ‰€ç”¨ï¼ŒDBMS ä¼šç”³è¯· <strong>å ç”¨å†…å­˜æ¥ä½œä¸ºæ•°æ®ç¼“å†²æ± </strong> ï¼Œåœ¨çœŸæ­£è®¿é—®é¡µé¢ä¹‹å‰ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„ <strong>Buffer Pool</strong> ä¹‹åæ‰å¯ä»¥è®¿ é—®ã€‚ </p>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è®©ç£ç›˜æ´»åŠ¨æœ€å°åŒ–ï¼Œä»è€Œ <strong>å‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´</strong> ã€‚è¦çŸ¥é“ï¼Œè¿™ç§ç­–ç•¥å¯¹æå‡ SQL è¯­å¥çš„æŸ¥è¯¢æ€§èƒ½æ¥è¯´è‡³å…³é‡è¦ã€‚å¦‚æœç´¢å¼•çš„æ•°æ®åœ¨ç¼“å†²æ± é‡Œï¼Œé‚£ä¹ˆè®¿é—®çš„æˆæœ¬å°±ä¼šé™ä½å¾ˆå¤šã€‚</p>
<h5 id="3-1ç¼“å†²æ± -VS-æŸ¥è¯¢ç¼“å­˜"><a href="#3-1ç¼“å†²æ± -VS-æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="3.1ç¼“å†²æ±  VS æŸ¥è¯¢ç¼“å­˜"></a>3.1ç¼“å†²æ±  VS æŸ¥è¯¢ç¼“å­˜</h5><p><strong>ç¼“å†²æ± å’ŒæŸ¥è¯¢ç¼“å­˜æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿä¸æ˜¯ã€‚</strong> </p>
<p><strong>1.</strong> <strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong> </p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œç¼“å†²æ± éƒ½åŒ…æ‹¬äº†å“ªäº›ã€‚ </p>
<p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­æœ‰ä¸€éƒ¨åˆ†æ•°æ®ä¼šæ”¾åˆ°å†…å­˜ä¸­ï¼Œç¼“å†²æ± åˆ™å äº†è¿™éƒ¨åˆ†å†…å­˜çš„å¤§éƒ¨åˆ†ï¼Œå®ƒç”¨æ¥å­˜å‚¨å„ç§æ•°æ®çš„ç¼“å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/2022/04/22/MySQL/1652546669589.png" alt="1652546669589" loading="lazy"></p>
<p>ä»å›¾ä¸­ï¼Œä½ èƒ½çœ‹åˆ° InnoDB ç¼“å†²æ± åŒ…æ‹¬äº†æ•°æ®é¡µã€ç´¢å¼•é¡µã€æ’å…¥ç¼“å†²ã€é”ä¿¡æ¯ã€è‡ªé€‚åº” Hash å’Œæ•°æ®å­—å…¸ä¿¡æ¯ç­‰ã€‚ </p>
<p><strong>ç¼“å†²æ± çš„é‡è¦æ€§ï¼š</strong></p>
<p>å¯¹äº<strong>ä½¿ç”¨InnoDB</strong>ä½œä¸ºå­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œä¸ç®¡æ˜¯ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®çš„ç´¢å¼•ï¼ˆåŒ…æ‹¬èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•)ï¼Œè¿˜æ˜¯å„ç§ç³»ç»Ÿæ•°æ®ï¼Œéƒ½æ˜¯ä»¥<strong>é¡µ</strong>çš„å½¢å¼å­˜æ”¾åœ¨<strong>è¡¨ç©ºé—´</strong>ä¸­çš„ï¼Œè€Œæ‰€è°“çš„è¡¨ç©ºé—´åªä¸è¿‡æ˜¯InnoDBå¯¹æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€ä¸ªæˆ–å‡ ä¸ªå®é™…æ–‡ä»¶çš„æŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ•°æ®è¯´åˆ°åº•è¿˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ã€‚ä½†æ˜¯å„ä½ä¹Ÿéƒ½çŸ¥é“ï¼Œç£ç›˜çš„é€Ÿåº¦æ…¢çš„è·Ÿä¹Œé¾Ÿä¸€æ ·ï¼Œæ€ä¹ˆèƒ½é…å¾—ä¸Šâ€œå¿«å¦‚é£ï¼Œç–¾å¦‚ç”µâ€çš„CPUå‘¢?è¿™é‡Œï¼Œç¼“å†²æ± å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤cPUå’Œç£ç›˜ä¹‹é—´çš„é¸¿æ²Ÿã€‚æ‰€ä»¥InnoDBå­˜å‚¨å¼•æ“åœ¨å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œå½“éœ€è¦è®¿é—®æŸä¸ªé¡µçš„æ•°æ®æ—¶ï¼Œå°±ä¼š<strong>æŠŠå®Œæ•´çš„é¡µçš„æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬åªéœ€è¦è®¿é—®ä¸€ä¸ªé¡µçš„ä¸€æ¡è®°å½•ï¼Œé‚£ä¹Ÿéœ€è¦å…ˆæŠŠæ•´ä¸ªé¡µçš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å°†æ•´ä¸ªé¡µåŠ è½½åˆ°å†…å­˜ä¸­åå°±å¯ä»¥è¿›è¡Œè¯»å†™è®¿é—®äº†ï¼Œåœ¨è¿›è¡Œå®Œè¯»å†™è®¿é—®ä¹‹åå¹¶ä¸ç€æ€¥æŠŠè¯¥é¡µå¯¹åº”çš„å†…å­˜ç©ºé—´é‡Šæ”¾æ‰ï¼Œè€Œæ˜¯å°†å…¶ç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·å°†æ¥æœ‰è¯·æ±‚å†æ¬¡è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œå°±å¯ä»¥<strong>çœå»ç£ç›˜IO</strong>çš„å¼€é”€äº†ã€‚</p>
<p><strong>ç¼“å­˜åŸåˆ™ï¼š</strong></p>
<p>â€œ <strong>ä½ç½® * é¢‘æ¬¡</strong> â€è¿™ä¸ªåŸåˆ™ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¯¹ I/O è®¿é—®æ•ˆç‡è¿›è¡Œä¼˜åŒ–ã€‚ </p>
<p>é¦–å…ˆï¼Œä½ç½®å†³å®šæ•ˆç‡ï¼Œæä¾›ç¼“å†²æ± å°±æ˜¯ä¸ºäº†åœ¨å†…å­˜ä¸­å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®ã€‚ </p>
<p>å…¶æ¬¡ï¼Œé¢‘æ¬¡å†³å®šä¼˜å…ˆçº§é¡ºåºã€‚å› ä¸ºç¼“å†²æ± çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ç£ç›˜æœ‰ 200Gï¼Œä½†æ˜¯å†…å­˜åªæœ‰ 16Gï¼Œç¼“å†²æ± å¤§å°åªæœ‰ 1Gï¼Œå°±æ— æ³•å°†æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°ç¼“å†²æ± é‡Œï¼Œè¿™æ—¶å°±æ¶‰åŠåˆ°ä¼˜å…ˆçº§é¡ºåºï¼Œä¼š <strong>ä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½ ã€‚</strong></p>
<p><strong>ç¼“å†²æ± çš„é¢„è¯»ç‰¹æ€§ï¼š</strong></p>
<p>äº†è§£äº†ç¼“å†²æ± çš„ä½œç”¨ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ç¼“å†²æ± çš„å¦ä¸€ä¸ªç‰¹æ€§:<strong>é¢„è¯»ã€‚</strong><br>ç¼“å†²æ± çš„ä½œç”¨å°±æ˜¯æå‡I/Oæ•ˆç‡ï¼Œè€Œæˆ‘ä»¬è¿›è¡Œè¯»å–æ•°æ®çš„æ—¶å€™å­˜åœ¨ä¸€ä¸ªâ€œå±€éƒ¨æ€§åŸç†â€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›æ•°æ®ï¼Œ<strong>å¤§æ¦‚ç‡è¿˜ä¼šä½¿ç”¨å®ƒå‘¨å›´çš„ä¸€äº›æ•°æ®</strong>ï¼Œå› æ­¤é‡‡ç”¨â€œé¢„è¯»â€çš„æœºåˆ¶æå‰åŠ è½½ï¼Œå¯ä»¥å‡å°‘æœªæ¥å¯èƒ½çš„ç£ç›˜â…£/Oæ“ä½œã€‚</p>
<p><strong>2.æŸ¥è¯¢ç¼“å­˜</strong></p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜å‘¢?</p>
<p>æŸ¥è¯¢ç¼“å­˜æ˜¯æå‰æŠŠ<strong>æŸ¥è¯¢ç»“æœç¼“å­˜</strong>èµ·æ¥ï¼Œè¿™æ ·ä¸‹æ¬¡ä¸éœ€è¦æ‰§è¡Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç»“æœã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨MySQLä¸­çš„æŸ¥è¯¢ç¼“å­˜ï¼Œä¸æ˜¯ç¼“å­˜æŸ¥è¯¢è®¡åˆ’ï¼Œè€Œæ˜¯æŸ¥è¯¢å¯¹åº”çš„ç»“æœã€‚å› ä¸ºå‘½ä¸­æ¡ä»¶è‹›åˆ»ï¼Œè€Œä¸”åªè¦æ•°æ®è¡¨å‘ç”Ÿå˜åŒ–ï¼ŒæŸ¥è¯¢ç¼“å­˜å°±ä¼šå¤±æ•ˆï¼Œå› æ­¤å‘½ä¸­ç‡ä½ã€‚</p>
<p>ç¼“å†²æ± æœåŠ¡äºæ•°æ®åº“æ•´ä½“çš„I/oæ“ä½œï¼Œå®ƒä»¬çš„å…±åŒç‚¹éƒ½æ˜¯é€šè¿‡ç¼“å­˜çš„æœºåˆ¶æ¥æå‡æ•ˆç‡ã€‚</p>
<h5 id="3-2ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®"><a href="#3-2ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®" class="headerlink" title="3.2ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®"></a>3.2ç¼“å†²æ± å¦‚ä½•è¯»å–æ•°æ®</h5><p>ç¼“å†²æ± ç®¡ç†å™¨ä¼šå°½é‡å°†ç»å¸¸ä½¿ç”¨çš„æ•°æ®ä¿å­˜èµ·æ¥ï¼Œåœ¨æ•°æ®åº“è¿›è¡Œé¡µé¢è¯»æ“ä½œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¯¥é¡µé¢æ˜¯å¦åœ¨ä¹å†²æ± ä¸­ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¯»å–ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šé€šè¿‡å†…å­˜æˆ–ç£ç›˜å°†é¡µé¢å­˜æ”¾åˆ°ç¼“å†²æ± ä¸­å†è¿›è¡Œè¯»å–ã€‚</p>
<p>ç¼“å­˜åœ¨æ•°æ®åº“ä¸­çš„ç»“æ„å’Œä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652547231676.png" alt="1652547231676" loading="lazy"></p>
<p><strong>å¦‚æœæˆ‘ä»¬æ‰§è¡ŒSQLè¯­å¥çš„æ—¶å€™æ›´æ–°äº†ç¼“å†²æ± ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šé©¬ä¸Š åŒæ­¥åˆ°ç£ç›˜ä¸Šå—</strong></p>
<p>å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬å¯¹æ•°æ®åº“ä¸­çš„è®°å½•è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä¿®æ”¹ç¼“å†²æ± ä¸­é¡µé‡Œé¢çš„è®°å½•ä¿¡æ¯ï¼Œç„¶åæ•°æ®åº“ä¼š<strong>ä»¥ä¸€å®šçš„é¢‘ç‡åˆ·æ–°</strong>åˆ°ç£ç›˜ä¸Šã€‚æ³¨æ„å¹¶ä¸æ˜¯æ¯æ¬¡å‘ç”Ÿæ›´æ–°æ“ä½œï¼Œéƒ½ä¼šç«‹åˆ»è¿›è¡Œç£ç›˜å›å†™ã€‚ç¼“å†²æ± ä¼šé‡‡ç”¨ä¸€ç§å«åš<strong>checkpointçš„æœºåˆ¶</strong>å°†æ•°æ®å›å†™åˆ°ç£ç›˜ä¸Šï¼ŒIè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æå‡äº†æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½ã€‚</p>
<p>æ¯”å¦‚ï¼Œå½“<strong>ç¼“å†²æ± ä¸å¤Ÿç”¨</strong>æ—¶ï¼Œéœ€è¦é‡Šæ”¾æ‰ä¸€äº›ä¸å¸¸ç”¨çš„é¡µï¼Œæ­¤æ—¶å°±å¯ä»¥å¼ºè¡Œé‡‡ç”¨checkpoint çš„æ–¹å¼ï¼Œå°†ä¸å¸¸ç”¨çš„è„é¡µå›å†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶åå†ä»ç¼“å†²æ± ä¸­å°†è¿™äº›é¡µé‡Šæ”¾æ‰ã€‚è¿™é‡Œè„é¡µ(dirty page)æŒ‡çš„æ˜¯ç¼“å†²æ± ä¸­è¢«ä¿®æ”¹è¿‡çš„é¡µï¼Œä¸ç£ç›˜ä¸Šçš„æ•°æ®é¡µä¸ä¸€è‡´ã€‚</p>
<h5 id="3-3æŸ¥çœ‹-è®¾ç½®ç¼“å†²æ± çš„å¤§å°"><a href="#3-3æŸ¥çœ‹-è®¾ç½®ç¼“å†²æ± çš„å¤§å°" class="headerlink" title="3.3æŸ¥çœ‹/è®¾ç½®ç¼“å†²æ± çš„å¤§å°"></a>3.3æŸ¥çœ‹/è®¾ç½®ç¼“å†²æ± çš„å¤§å°</h5><p>å¦‚æœä½¿ç”¨çš„æ˜¯MySQL MyISAMå­˜å‚¨å¼•æ“ï¼Œå®ƒç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜æ•°æ®ï¼Œå¯¹åº”çš„é”®ç¼“å­˜å‚æ•°ä¸º<strong>key_buffer_size</strong>ï¼Œå¯ä»¥ç”¨å®ƒè¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯MySQL InnoDBå­˜å‚¨å¼•æ“ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹<strong>innodb_buffer)pool_size</strong>å˜é‡æ¥æŸ¥çœ‹ç¼“å†²æ± å¤§å°ã€‚å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;innodb_buffer_poll_size&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652547658710.png" alt="1652547658710" loading="lazy"></p>
<p>èƒ½çœ‹åˆ°æ­¤æ—¶InnoDBçš„ç¼“å†²æ± å¤§å°åªæœ‰134217728/1024=128MBã€‚å¯ä»¥ä¿®æ”¹ç¼“å†²æ± å¤§å°ï¼Œæ¯”å¦‚æ”¹ä¸º256MBï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global innodb_buffer_pool_size =  268435456;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652547780982.png" alt="1652547780982" loading="lazy"></p>
<p>æˆ–è€…ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="string">268435456</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹ä¸‹ä¿®æ”¹åçš„ç¼“å†²æ± å¤§å°ï¼Œæ­¤æ—¶å·²æˆåŠŸä¿®æ”¹<img src="/2022/04/22/MySQL/1652547840923.png" alt="1652547840923" loading="lazy"></p>
<h5 id="3-4å¤šä¸ªBuffer-Poolå®ä¾‹"><a href="#3-4å¤šä¸ªBuffer-Poolå®ä¾‹" class="headerlink" title="3.4å¤šä¸ªBuffer Poolå®ä¾‹"></a>3.4å¤šä¸ªBuffer Poolå®ä¾‹</h5><p>Buffer Poolæœ¬è´¨æ˜¯InnoDBå‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€å—<strong>è¿ç»­çš„å†…å­˜ç©ºé—´</strong>ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè®¿é—®Buffer Poolä¸­çš„æ•°æ®éƒ½éœ€è¦<strong>åŠ é”</strong>å¤„ç†ã€‚åœ¨Buffer Poolç‰¹åˆ«å¤§è€Œä¸”å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ç‰¹åˆ«é«˜çš„æƒ…å†µä¸‹ï¼Œå•ä¸€çš„Buffer Poolå¯èƒ½ä¼šå½±å“è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ã€‚æ‰€ä»¥åœ¨Buffer Poolç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬<strong>æ‹†åˆ†æˆè‹¥å¹²ä¸ªå°çš„Buffer Pool</strong>ï¼Œæ¯ä¸ªBuffer Pooléƒ½ç§°ä¸ºä¸€ä¸ª<strong>å®ä¾‹</strong>ï¼Œå®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç‹¬ç«‹çš„å»ç”³è¯·å†…å­˜ç©ºé—´ï¼Œç‹¬ç«‹çš„ç®¡ç†å„ç§é“¾è¡¨ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®æ—¶å¹¶ä¸ä¼šç›¸äº’å½±å“ï¼Œä»è€Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™é€šè¿‡è®¾ç½®<strong>innodb_buffer_pool_instances</strong>çš„å€¼æ¥ä¿®æ”¹Buffer Poolå®ä¾‹çš„ä¸ªæ•°ï¼Œæ¯”æ–¹è¯´è¿™æ ·:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_instances</span> = <span class="string">2</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±è¡¨æ˜è¦åˆ›å»ºä¸¤ä¸ª<strong>Buffer Pool</strong>å®ä¾‹</p>
<p>æŸ¥çœ‹ç¼“å†²æ± çš„ä¸ªæ•°ï¼Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;innodb_buffer_pool_instacnces&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652548090555.png" alt="1652548090555" loading="lazy"></p>
<p>é‚£æ¯ä¸ª<strong>Buffer Pool</strong>å®ä¾‹å®é™…å å¤šå°‘å†…å­˜ç©ºé—´ï¼Ÿä½¿ç”¨è¿™ä¸ªå…¬å¼ç®—å‡ºæ¥ï¼š<img src="/2022/04/22/MySQL/1652548155147.png" alt="1652548155147" loading="lazy"></p>
<p>ä¹Ÿå°±æ˜¯æ€»å…±çš„å¤§å°é™¤ä»¥å®ä¾‹çš„ä¸ªæ•°ï¼Œç»“æœå°±æ˜¯æ¯ä¸ª<strong>Buffer Pool</strong>å®ä¾‹å ç”¨çš„å¤§å°ã€‚</p>
<p>ä¸è¿‡ä¹Ÿä¸æ˜¯è¯´Buffer Poolå®ä¾‹åˆ›å»ºçš„è¶Šå¤šè¶Šå¥½ï¼Œåˆ†åˆ«<strong>ç®¡ç†å„ä¸ªBuffer Poolä¹Ÿæ˜¯éœ€è¦æ€§èƒ½å¼€é”€çš„</strong>,InnoDBè§„å®š:å½“innodb_buffer_pool_sizeçš„å€¼å°äº1Gçš„æ—¶å€™è®¾ç½®å¤šä¸ªå®ä¾‹æ˜¯æ— æ•ˆçš„ï¼ŒInnoDBä¼šé»˜è®¤æŠŠinnodb_buffer_pool_instancesçš„å€¼ä¿®æ”¹ä¸º1ã€‚è€Œæˆ‘ä»¬é¼“åŠ±åœ¨Buffer Poolå¤§äºæˆ–ç­‰äº1Gçš„æ—¶å€™è®¾ç½®å¤šä¸ªBuffer Poolå®ä¾‹ã€‚</p>
<h5 id="3-5å¼•ç”³é—®é¢˜"><a href="#3-5å¼•ç”³é—®é¢˜" class="headerlink" title="3.5å¼•ç”³é—®é¢˜"></a>3.5å¼•ç”³é—®é¢˜</h5><p>Buffer Poolæ˜¯MySQLå†…å­˜ç»“æ„ä¸­çš„æ ¸å¿ƒçš„ä¸€ä¸ªç»„æˆï¼Œå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªé»‘ç›’å­ã€‚</p>
<p><strong>é»‘ç›’å­ä¸‹çš„æ›´æ–°æ•°æ®æµç¨‹</strong></p>
<p>å½“æˆ‘ä»¬æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆå»Buffer Poolä¸­æŸ¥è¯¢ã€‚å¦‚æœBuffer Poolä¸­ä¸å­˜åœ¨ï¼Œå­˜å‚¨å¼•æ“ä¼šå…ˆå°†æ•°æ®ä»ç£ç›˜åŠ è½½åˆ°Buffer Poolä¸­ï¼Œç„¶åå°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯;åŒç†ï¼Œå½“æˆ‘ä»¬æ›´æ–°æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨äºBufferPoolï¼ŒåŒæ ·ä¼šå…ˆæ•°æ®åŠ è½½è¿›æ¥ï¼Œç„¶åä¿®æ”¹ä¿®æ”¹å†…å­˜çš„æ•°æ®ã€‚è¢«ä¿®æ”¹è¿‡çš„æ•°æ®ä¼šåœ¨ä¹‹åç»Ÿä¸€åˆ·å…¥ç£ç›˜ã€‚<img src="/2022/04/22/MySQL/1652548376384.png" alt="1652548376384" loading="lazy"></p>
<p>è¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼æ²¡å•¥é—®é¢˜ï¼Œå®åˆ™æ˜¯æœ‰é—®é¢˜çš„ã€‚å‡è®¾æˆ‘ä»¬ä¿®æ”¹Buffer Poolä¸­çš„æ•°æ®æˆåŠŸï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠå°†æ•°æ®åˆ·å…¥ç£ç›˜MySQLå°±æŒ‚äº†æ€ä¹ˆåŠ?æŒ‰ç…§ä¸Šå›¾çš„é€»è¾‘ï¼Œæ­¤æ—¶æ›´æ–°ä¹‹åçš„æ•°æ®åªå­˜åœ¨äºBuffer Poolä¸­ï¼Œå¦‚æœæ­¤æ—¶MysQLå®•æœºäº†ï¼Œè¿™éƒ¨åˆ†æ•°æ®å°†ä¼šæ°¸ä¹…åœ°ä¸¢å¤±;<br>å†è€…ï¼Œæˆ‘æ›´æ–°åˆ°ä¸€åŠçªç„¶å‘ç”Ÿé”™è¯¯äº†ï¼Œæƒ³è¦å›æ»šåˆ°æ›´æ–°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¯¥æ€ä¹ˆåŠ?è¿æ•°æ®æŒä¹…åŒ–çš„ä¿è¯ã€äº‹åŠ¡å›æ»šéƒ½åšä¸åˆ°è¿˜è°ˆä»€ä¹ˆå´©æºƒæ¢å¤?ï¼ˆredo log &amp; undo logï¼‰</p>
<h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œäººä»¬æŠŠ<strong>è¿æ¥ç®¡ç†ã€æŸ¥è¯¢ç¼“å­˜ã€è¯­æ³•è§£æã€æŸ¥è¯¢ä¼˜åŒ–</strong>è¿™äº›å¹¶ä¸æ¶‰åŠçœŸå®æ•°æ®å­˜å‚¨çš„åŠŸèƒ½åˆ’åˆ†ä¸º<strong>MySQL server</strong>çš„åŠŸèƒ½ï¼ŒæŠŠçœŸå®å­˜å–æ•°æ®çš„åŠŸèƒ½åˆ’åˆ†ä¸º<strong>å­˜å‚¨å¼•æ“</strong>çš„åŠŸèƒ½ã€‚æ‰€ä»¥åœ¨<strong>MySQL server</strong>å®Œæˆäº†æŸ¥è¯¢ä¼˜åŒ–åï¼Œåªéœ€æŒ‰ç…§ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’è°ƒç”¨åº•å±‚å­˜å‚¨å¼•æ“æä¾›çš„APIï¼Œè·å–åˆ°æ•°æ®åè¿”å›ç»™å®¢æˆ·ç«¯å°±å¥½äº†ã€‚</p>
<p>MysQLä¸­æåˆ°äº†å­˜å‚¨å¼•æ“çš„æ¦‚å¿µã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>å­˜å‚¨å¼•æ“å°±æ˜¯æŒ‡è¡¨çš„ç±»å‹</strong>ã€‚å…¶å®å­˜å‚¨å¼•æ“ä»¥å‰å«åš<strong>è¡¨å¤„ç†å™¨</strong>ï¼Œåæ¥æ”¹åä¸ºå­˜å‚¨å¼•æ“ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯æ¥æ”¶ä¸Šå±‚ä¼ ä¸‹æ¥çš„æŒ‡ä»¤ï¼Œç„¶åå¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–æˆ–å†™å…¥æ“ä½œã€‚</p>
<h3 id="1-æŸ¥çœ‹å­˜å‚¨å¼•æ“"><a href="#1-æŸ¥çœ‹å­˜å‚¨å¼•æ“" class="headerlink" title="1.æŸ¥çœ‹å­˜å‚¨å¼•æ“"></a>1.æŸ¥çœ‹å­˜å‚¨å¼•æ“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engines  #æŸ¥è¯¢mysqlæ”¯æŒçš„å­˜å‚¨å¼•æ“</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652580291130.png" alt="1652580291130" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engines \G;</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*************************** 1. row *************************** Engine: InnoDB Support: DEFAULT Comment: Supports transactions, row-level locking, and foreign keys Transactions: YES XA: YES Savepoints: YES *************************** 2. row *************************** Engine: MRG_MYISAM Support: YES Comment: Collection of identical MyISAM tables Transactions: NO XA: NO Savepoints: NO *************************** 3. row *************************** Engine: MEMORY Support: YES Comment: Hash based, stored in memory, useful for temporary tables Transactions: NO XA: NO Savepoints: NO *************************** 4. row *************************** Engine: BLACKHOLE Support: YES Comment: /dev/null storage engine (anything you write to it disappears) Transactions: NO XA: NO</span><br><span class="line">2. è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“</span><br><span class="line">æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼š</span><br><span class="line">Savepoints: NO *************************** 5. row *************************** Engine: MyISAM Support: YES Comment: MyISAM storage engine Transactions: NO XA: NO Savepoints: NO *************************** 6. row *************************** Engine: CSV Support: YES Comment: CSV storage engine Transactions: NO XA: NO Savepoints: NO *************************** 7. row *************************** Engine: ARCHIVE Support: YES Comment: Archive storage engine Transactions: NO XA: NO Savepoints: NO *************************** 8. row *************************** Engine: PERFORMANCE_SCHEMA Support: YES Comment: Performance Schema Transactions: NO XA: NO Savepoints: NO *************************** 9. row *************************** Engine: FEDERATED Support: NO Comment: Federated MySQL storage engine Transactions: NULL XA: NULL Savepoints: NULL</span><br></pre></td></tr></table></figure>

<h3 id="2-è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“"><a href="#2-è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“" class="headerlink" title="2.è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“"></a>2.è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“</h3><ul>
<li><p>æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%storage_engine%&#x27;; </span><br><span class="line">#æˆ–</span><br><span class="line">SELECT @@default_storage_engine;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652580474560.png" alt="1652580474560" loading="lazy"></p>
</li>
<li><p>ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“</p>
</li>
</ul>
<p>å¦‚æœåœ¨åˆ›å»ºè¡¨çš„è¯­å¥ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œé‚£å°±ä¼šé»˜è®¤ä½¿ç”¨ InnoDB ä½œä¸ºè¡¨çš„å­˜å‚¨å¼•æ“ã€‚ </p>
<p>å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™å¯åŠ¨æœåŠ¡å™¨çš„å‘½ä»¤è¡Œï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET DEFAULT_STORAGE_ENGINE=MyISAM;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä¿®æ”¹my.cnfæ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">MyISAM</span></span><br><span class="line"><span class="comment"># é‡å¯æœåŠ¡ </span></span><br><span class="line"><span class="attr">systemctl</span> <span class="string">restart mysqld.service</span></span><br></pre></td></tr></table></figure>

<h3 id="3-è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#3-è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="3.è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“"></a>3.è®¾ç½®è¡¨çš„å­˜å‚¨å¼•æ“</h3><p>å­˜å‚¨å¼•æ“æ˜¯è´Ÿè´£å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæå–å’Œå†™å…¥å·¥ä½œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º <strong>ä¸åŒçš„è¡¨è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“</strong> ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„è¡¨å¯ä»¥æœ‰ä¸åŒçš„ç‰©ç†å­˜å‚¨ç»“æ„ï¼Œä¸åŒçš„æå–å’Œå†™å…¥æ–¹å¼ã€‚</p>
<h4 id="3-1åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“"><a href="#3-1åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“" class="headerlink" title="3.1åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“"></a>3.1åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</h4><p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºè¡¨çš„è¯­å¥éƒ½æ²¡æœ‰æŒ‡å®šè¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å°±ä¼šä½¿ç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜¾å¼çš„æŒ‡å®šä¸€ä¸‹è¡¨çš„å­˜å‚¨å¼•æ“ï¼Œé‚£å¯ä»¥è¿™ä¹ˆå†™ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE è¡¨å( </span><br><span class="line">    å»ºè¡¨è¯­å¥; </span><br><span class="line">) ENGINE = å­˜å‚¨å¼•æ“åç§°;</span><br></pre></td></tr></table></figure>

<h4 id="3-2ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“"><a href="#3-2ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="3.2ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“"></a>3.2ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“</h4><p>å¦‚æœè¡¨å·²ç»å»ºå¥½äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹è¾¹è¿™ä¸ªè¯­å¥æ¥ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE è¡¨å ENGINE = å­˜å‚¨å¼•æ“åç§°;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ <strong>engine_demo_table</strong> è¡¨çš„å­˜å‚¨å¼•æ“ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE engine_demo_table ENGINE = InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec) </span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹ engine_demo_table çš„è¡¨ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE engine_demo_table\G *************************** 1. row *************************** </span><br><span class="line">Table: engine_demo_table </span><br><span class="line">Create Table: CREATE TABLE `engine_demo_table` ( `i` int(11) DEFAULT NULL </span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<h3 id="4-å¼•æ“ä»‹ç»"><a href="#4-å¼•æ“ä»‹ç»" class="headerlink" title="4.å¼•æ“ä»‹ç»"></a>4.å¼•æ“ä»‹ç»</h3><h4 id="4-1InnoDBå¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“"><a href="#4-1InnoDBå¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“" class="headerlink" title="4.1InnoDBå¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“"></a>4.1InnoDBå¼•æ“ï¼šå…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å­˜å‚¨å¼•æ“</h4><ul>
<li><p>MySQLä»3.23.34aå¼€å§‹å°±åŒ…å«InnoDBå­˜å‚¨å¼•æ“ã€‚ å¤§äºç­‰äº5.5ä¹‹åï¼Œé»˜è®¤é‡‡ç”¨InnoDBå¼•æ“ ã€‚ </p>
</li>
<li><p>InnoDBæ˜¯MySQLçš„ é»˜è®¤äº‹åŠ¡å‹å¼•æ“ ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡ã€‚å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤(Commit)å’Œå›æ»š(Rollback)ã€‚ </p>
</li>
<li><p>é™¤äº†å¢åŠ å’ŒæŸ¥è¯¢å¤–ï¼Œè¿˜éœ€è¦æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆï¼Œåº”ä¼˜å…ˆé€‰æ‹©InnoDBå­˜å‚¨å¼•æ“ã€‚ </p>
</li>
<li><p><strong>é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘<strong><strong>InnoDB</strong></strong>å¼•æ“ã€‚</strong> </p>
</li>
<li><p>æ•°æ®æ–‡ä»¶ç»“æ„ï¼šï¼ˆåœ¨ã€Šç¬¬02ç« _MySQLæ•°æ®ç›®å½•ã€‹ç« èŠ‚å·²è®²ï¼‰ </p>
<ul>
<li><p>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„ï¼ˆMySQL8.0æ—¶ï¼Œåˆå¹¶åœ¨è¡¨å.ibdä¸­ï¼‰ </p>
</li>
<li><p>è¡¨å.ibd å­˜å‚¨æ•°æ®å’Œç´¢å¼• </p>
</li>
</ul>
</li>
<li><p>InnoDBæ˜¯ <strong>ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ã€‚</strong> </p>
<ul>
<li>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ•°æ®ä»¥å…ƒæ•°æ®æ–‡ä»¶ã€éäº‹åŠ¡è¡¨ç­‰æ¥å­˜å‚¨ã€‚ç°åœ¨è¿™äº›å…ƒæ•°æ®æ–‡ä»¶è¢«åˆ é™¤ äº†ã€‚æ¯”å¦‚ï¼š .frm ï¼Œ .par ï¼Œ .trn ï¼Œ .isl ï¼Œ .db.opt ç­‰éƒ½åœ¨MySQL8.0ä¸­ä¸å­˜åœ¨äº†ã€‚ </li>
</ul>
</li>
<li><p>å¯¹æ¯”MyISAMçš„å­˜å‚¨å¼•æ“ï¼Œ InnoDBå†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº› ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿å­˜æ•°æ®å’Œ ç´¢å¼•ã€‚ </p>
</li>
<li><p>MyISAMåªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ®ï¼›InnoDBä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œ <strong>å¯¹å†…å­˜è¦æ±‚è¾ƒé«˜</strong> ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ã€‚ </p>
</li>
</ul>
<h4 id="4-2MyIASMå¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“"><a href="#4-2MyIASMå¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“" class="headerlink" title="4.2MyIASMå¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“"></a>4.2MyIASMå¼•æ“ï¼šä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</h4><ul>
<li><p>MyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†MyISAM <strong>ä¸æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®</strong> ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯ <strong>å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤</strong> ã€‚ </p>
</li>
<li><p><strong>5.5ä¹‹å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“</strong> </p>
</li>
<li><p>ä¼˜åŠ¿æ˜¯è®¿é—®çš„ é€Ÿåº¦å¿« ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨ </p>
</li>
<li><p>é’ˆå¯¹æ•°æ®ç»Ÿè®¡æœ‰é¢å¤–çš„å¸¸æ•°å­˜å‚¨ã€‚æ•…è€Œ count(*) çš„æŸ¥è¯¢æ•ˆç‡å¾ˆé«˜ </p>
</li>
<li><p>æ•°æ®æ–‡ä»¶ç»“æ„ï¼šï¼ˆåœ¨ã€Šç¬¬02ç« _MySQLæ•°æ®ç›®å½•ã€‹ç« èŠ‚å·²è®²ï¼‰ </p>
<ul>
<li>è¡¨å.frm å­˜å‚¨è¡¨ç»“æ„ </li>
<li>è¡¨å.MYD å­˜å‚¨æ•°æ® (MYData) </li>
<li>è¡¨å.MYI å­˜å‚¨ç´¢å¼• (MYIndex) </li>
</ul>
</li>
<li><p>åº”ç”¨åœºæ™¯ï¼šåªè¯»åº”ç”¨æˆ–è€…ä»¥è¯»ä¸ºä¸»çš„ä¸šåŠ¡ </p>
</li>
</ul>
<h4 id="4-3å¼•æ“å¯¹æ¯”"><a href="#4-3å¼•æ“å¯¹æ¯”" class="headerlink" title="4.3å¼•æ“å¯¹æ¯”"></a>4.3å¼•æ“å¯¹æ¯”</h4><p><img src="/2022/04/22/MySQL/1652581226906.png" alt="1652581226906" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652581401199.png" alt="1652581401199" loading="lazy"></p>
<h3 id="5-MyIASMå’ŒInnoDB"><a href="#5-MyIASMå’ŒInnoDB" class="headerlink" title="5.MyIASMå’ŒInnoDB"></a>5.MyIASMå’ŒInnoDB</h3><p>MySQL5.5ä¹‹å‰é»˜è®¤æ˜¯MyIAMï¼Œä¹‹åæ˜¯InnoDB</p>
<p>é¦–å…ˆå¯¹äºInnoDBå­˜å‚¨å¼•æ“ï¼Œæä¾›äº†è‰¯å¥½çš„äº‹åŠ¡ç®¡ç†ã€å´©æºƒæ¢å¤å’Œå¹¶å‘æ§åˆ¶ã€‚å› ä¸ºInnoDbå­˜å‚¨å¼•æ“<strong>æ”¯æŒäº‹åŠ¡</strong>ï¼Œæ‰€ä»¥å¯¹äºè¦æ±‚äº‹åŠ¡å®Œæ•´æ€§çš„åœºåˆéœ€è¦é€‰æ‹©InnoDBï¼Œæ¯”å¦‚æ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢å¤–è¿˜åŒ…å«å¾ˆå¤šæ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œåƒè´¢åŠ¡ç³»ç»Ÿç­‰å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿã€‚ç¼ºç‚¹æ˜¯<strong>è¯»å†™æ•ˆç‡å·®ï¼Œå ç”¨å†…å­˜ç©ºé—´ç›¸å¯¹æ¯”è¾ƒå¤§</strong>ã€‚</p>
<p>å…¶æ¬¡å¯¹äºMyISAMå­˜å‚¨å¼•æ“ï¼Œå¦‚æœæ˜¯<strong>å°å‹åº”ç”¨</strong>ï¼Œç³»ç»Ÿä»¥<strong>è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»</strong>ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œåˆ™å¯ä»¥é€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“ã€‚MyISAMå­˜å‚¨å¼•æ“çš„ä¼˜åŠ¿åœ¨äº<strong>å ç”¨ç©ºé—´å°ï¼Œå¤„ç†é€Ÿåº¦å¿«</strong>;ç¼ºç‚¹æ˜¯<strong>ä¸æ”¯æŒäº‹åŠ¡çš„å®Œæ•´æ€§å’Œå¹¶å‘æ€§ã€‚</strong></p>
<p><strong>innobdå’Œmyisamå¯¹æ¯”</strong><img src="/2022/04/22/MySQL/1652581514453.png" alt="1652581514453" loading="lazy"></p>
<h3 id="6-é˜¿é‡Œã€æ·˜å®ç”¨å“ªä¸ª"><a href="#6-é˜¿é‡Œã€æ·˜å®ç”¨å“ªä¸ª" class="headerlink" title="6.é˜¿é‡Œã€æ·˜å®ç”¨å“ªä¸ª"></a>6.é˜¿é‡Œã€æ·˜å®ç”¨å“ªä¸ª</h3><p><img src="/2022/04/22/MySQL/1652582611080.png" alt="1652582611080" loading="lazy"></p>
<ul>
<li><strong>Percona</strong> ä¸º MySQL æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œäº†æ”¹è¿›ï¼Œåœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šè¾ƒ MySQL æœ‰å¾ˆæ˜¾è‘—çš„æå‡ã€‚ </li>
<li>è¯¥ç‰ˆæœ¬æå‡äº†åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹çš„ InnoDB çš„æ€§èƒ½ã€ä¸º DBA æä¾›ä¸€äº›éå¸¸æœ‰ç”¨çš„æ€§èƒ½è¯Šæ–­å·¥å…·ï¼›å¦å¤–æœ‰æ›´å¤šçš„å‚æ•°å’Œå‘½ä»¤æ¥æ§åˆ¶æœåŠ¡å™¨è¡Œä¸ºã€‚ </li>
<li>è¯¥å…¬å¸æ–°å»ºäº†ä¸€æ¬¾å­˜å‚¨å¼•æ“å« Xtradb å®Œå…¨å¯ä»¥æ›¿ä»£ Innodb ï¼Œå¹¶ä¸”åœ¨æ€§èƒ½å’Œå¹¶å‘ä¸Šåšå¾—æ›´å¥½ </li>
<li>é˜¿é‡Œå·´å·´å¤§éƒ¨åˆ†mysqlæ•°æ®åº“å…¶å®ä½¿ç”¨çš„perconaçš„åŸå‹åŠ ä»¥ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="7-è¡¥å……"><a href="#7-è¡¥å……" class="headerlink" title="7.è¡¥å……"></a>7.è¡¥å……</h3><h4 id="1-InnoDBè¡¨çš„ä¼˜åŠ¿"><a href="#1-InnoDBè¡¨çš„ä¼˜åŠ¿" class="headerlink" title="1.InnoDBè¡¨çš„ä¼˜åŠ¿"></a>1.InnoDBè¡¨çš„ä¼˜åŠ¿</h4><p>InnoDBå­˜å‚¨å¼•æ“åœ¨å®é™…åº”ç”¨ä¸­æ‹¥æœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚æ“ä½œä¾¿åˆ©ã€æé«˜äº†æ•°æ®åº“çš„æ€§èƒ½ã€ç»´æŠ¤æˆæœ¬ä½ç­‰ã€‚å¦‚æœç”±äºç¡¬ä»¶æˆ–è½¯ä»¶çš„åŸå› å¯¼è‡´æœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆåœ¨é‡å¯æœåŠ¡å™¨ä¹‹åä¸éœ€è¦è¿›è¡Œé¢å¤–çš„æ“ä½œã€‚InnoDBå´©æºƒæ¢å¤åŠŸèƒ½è‡ªåŠ¨å°†ä¹‹å‰æäº¤çš„å†…å®¹å®šå‹ï¼Œç„¶åæ’¤é”€æ²¡æœ‰æäº¤çš„è¿›ç¨‹ï¼Œé‡å¯ä¹‹åç»§ç»­ä»å´©æºƒç‚¹å¼€å§‹æ‰§è¡Œã€‚ InnoDBå­˜å‚¨å¼•æ“åœ¨ä¸»å†…å­˜ä¸­ç»´æŠ¤ç¼“å†²æ± ï¼Œé«˜é¢‘ç‡ä½¿ç”¨çš„æ•°æ®å°†åœ¨å†…å­˜ä¸­ç›´æ¥è¢«å¤„ç†ã€‚è¿™ç§ç¼“å­˜æ–¹å¼åº”ç”¨äºå¤šç§ä¿¡æ¯ï¼ŒåŠ é€Ÿäº†å¤„ç†è¿›ç¨‹ã€‚</p>
<p>åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œç‰©ç†å†…å­˜ä¸­é«˜è¾¾80%çš„éƒ¨åˆ†è¢«åº”ç”¨äºç¼“å†²æ± ã€‚å¦‚æœéœ€è¦å°†æ•°æ®æ’å…¥ä¸åŒçš„è¡¨ä¸­ï¼Œå¯ä»¥è®¾ç½®å¤–é”®åŠ å¼ºæ•°æ®çš„å®Œæ•´æ€§ã€‚æ›´æ–°æˆ–è€…åˆ é™¤æ•°æ®ï¼Œå…³è”æ•°æ®å°†ä¼šè¢«è‡ªåŠ¨æ›´æ–°æˆ–åˆ é™¤ã€‚å¦‚æœè¯•å›¾å°†æ•°æ®æ’å…¥ä»è¡¨ï¼Œä½†åœ¨ä¸»è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œæ’å…¥çš„æ•°æ®å°†è¢«è‡ªåŠ¨ç§»é™¤ã€‚å¦‚æœç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®å‡ºç°å´©æºƒï¼Œåœ¨ä½¿ç”¨è„æ•°æ®ä¹‹å‰ï¼Œæ ¡éªŒå’Œæœºåˆ¶ä¼šå‘å‡ºè­¦å‘Šã€‚å½“æ¯ä¸ªè¡¨çš„ä¸»é”®éƒ½è®¾ç½®åˆç†æ—¶ï¼Œä¸è¿™äº›åˆ—æœ‰å…³çš„æ“ä½œä¼šè¢«è‡ªåŠ¨ä¼˜åŒ–ã€‚æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œé€šè¿‡åšæ”¹å˜ç¼“å†²è‡ªåŠ¨æœºåˆ¶è¿›è¡Œä¼˜åŒ–ã€‚ <strong>InnoDBä¸ä»…æ”¯æŒå½“å‰è¯»å†™ï¼Œä¹Ÿä¼š ç¼“å†²æ”¹å˜çš„æ•°æ®åˆ°æ•°æ®æµç£ç›˜ ã€‚</strong> </p>
<p>InnoDBçš„æ€§èƒ½ä¼˜åŠ¿ä¸åªå­˜åœ¨äºé•¿æ—¶è¿è¡ŒæŸ¥è¯¢çš„å¤§å‹è¡¨ã€‚åœ¨åŒä¸€åˆ—å¤šæ¬¡è¢«æŸ¥è¯¢æ—¶ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ä¼šæé«˜æŸ¥è¯¢çš„é€Ÿåº¦ã€‚ä½¿ç”¨InnoDBå¯ä»¥å‹ç¼©è¡¨å’Œç›¸å…³çš„ç´¢å¼•ï¼Œå¯ä»¥ <strong>åœ¨ä¸å½±å“æ€§èƒ½å’Œå¯ç”¨æ€§çš„æƒ…å†µä¸‹åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•</strong> ã€‚å¯¹äºå¤§å‹æ–‡æœ¬å’ŒBLOBæ•°æ®ï¼Œä½¿ç”¨åŠ¨æ€è¡Œå½¢å¼ï¼Œè¿™ç§å­˜å‚¨å¸ƒå±€æ›´é«˜æ•ˆã€‚é€šè¿‡æŸ¥è¯¢INFORMATION_SCHEMAåº“ä¸­çš„è¡¨å¯ä»¥ç›‘æ§å­˜å‚¨å¼•æ“çš„å†…éƒ¨å·¥ä½œã€‚åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­ï¼ŒInnoDBè¡¨å¯ä»¥ä¸å…¶ä»–å­˜å‚¨å¼•æ“è¡¨æ··ç”¨ã€‚å³ä½¿æœ‰äº›æ“ä½œç³»ç»Ÿé™åˆ¶æ–‡ä»¶å¤§å°ä¸º2GBï¼ŒInnoDBä»ç„¶å¯ä»¥å¤„ç†ã€‚ <strong>å½“å¤„ç†å¤§æ•°æ®é‡æ—¶ï¼ŒInnoDBå…¼é¡¾CPUï¼Œä»¥è¾¾åˆ°æœ€å¤§æ€§èƒ½ ã€‚</strong></p>
<h4 id="2-InnoDbæ¶æ„"><a href="#2-InnoDbæ¶æ„" class="headerlink" title="2.InnoDbæ¶æ„"></a>2.InnoDbæ¶æ„</h4><p><strong>1.ç¼“å†²æ± </strong>ç¼“å†²æ± æ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œç”¨æ¥ç¼“å­˜å·²ä½¿ç”¨çš„è¡¨å’Œç´¢å¼•æ•°æ®ã€‚ç¼“å†²æ± ä½¿å¾—ç»å¸¸è¢«ä½¿ç”¨çš„æ•°æ®èƒ½å¤Ÿç›´æ¥åœ¨å†…å­˜ä¸­è·å¾—ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚</p>
<p><strong>2.æ›´æ”¹ç¼“å­˜</strong>æ›´æ”¹ç¼“å­˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå½“å—å½±å“çš„ç´¢å¼•é¡µä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæ›´æ”¹ç¼“å­˜ä¼šç¼“å­˜è¾…åŠ©ç´¢å¼•é¡µçš„æ›´æ”¹ã€‚ç´¢å¼•é¡µè¢«å…¶ä»–è¯»å–æ“ä½œæ—¶ä¼šåŠ è½½åˆ°ç¼“å­˜æ± ï¼Œç¼“å­˜çš„æ›´æ”¹å†…å®¹å°±ä¼šè¢«åˆå¹¶ã€‚ä¸åŒäºé›†ç¾¤ç´¢ å¼•ï¼Œè¾…åŠ©ç´¢å¼•å¹¶éç‹¬ä¸€æ— äºŒçš„ã€‚å½“ç³»ç»Ÿå¤§éƒ¨åˆ†é—²ç½®æ—¶ï¼Œæ¸…é™¤æ“ä½œä¼šå®šæœŸè¿è¡Œï¼Œå°†æ›´æ–°çš„ç´¢å¼•é¡µåˆ·å…¥ç£ ç›˜ã€‚æ›´æ–°ç¼“å­˜åˆå¹¶æœŸé—´ï¼Œå¯èƒ½ä¼šå¤§å¤§é™ä½æŸ¥è¯¢çš„æ€§èƒ½ã€‚åœ¨å†…å­˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜å ç”¨ä¸€éƒ¨åˆ†InnoDBç¼“å†²æ± ã€‚åœ¨ç£ç›˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚æ›´æ–°ç¼“å­˜çš„æ•°æ®ç±»å‹ç”±innodb_change_bufferingé…ç½®é¡¹ç®¡ç†ã€‚</p>
<p><strong>3.è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>  </p>
<p>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å°†è´Ÿè½½å’Œè¶³å¤Ÿçš„å†…å­˜ç»“åˆèµ·æ¥ï¼Œä½¿å¾—InnoDBåƒå†…å­˜æ•°æ®åº“ä¸€æ ·è¿è¡Œï¼Œä¸éœ€è¦é™ä½äº‹åŠ¡ä¸Šçš„æ€§èƒ½æˆ–å¯é æ€§ã€‚è¿™ä¸ªç‰¹æ€§é€šè¿‡innodb_adaptive_hash_indexé€‰é¡¹é…ç½®ï¼Œæˆ–è€…é€šè¿‡â€“skip-innodb_adaptive_hash_indexå‘½ä»¤è¡Œåœ¨æœåŠ¡å¯åŠ¨æ—¶å…³é—­ã€‚</p>
<p><strong>4.é‡åšæ—¥å¿—ç¼“å­˜</strong>é‡åšæ—¥å¿—ç¼“å­˜å­˜æ”¾è¦æ”¾å…¥é‡åšæ—¥å¿—çš„æ•°æ®ã€‚é‡åšæ—¥å¿—ç¼“å­˜å¤§å°é€šè¿‡innodb_log_buffer_sizeé…ç½®é¡¹é…ç½®ã€‚é‡åšæ—¥å¿—ç¼“å­˜ä¼šå®šæœŸåœ°å°†æ—¥å¿—æ–‡ä»¶åˆ·å…¥ç£ç›˜ã€‚å¤§å‹çš„é‡åšæ—¥å¿—ç¼“å­˜ ä½¿å¾—å¤§å‹äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œè€Œä¸éœ€è¦å†™å…¥ç£ç›˜ã€‚ </p>
<p><strong>5.ç³»ç»Ÿè¡¨ç©ºé—´</strong>ç³»ç»Ÿè¡¨ç©ºé—´åŒ…æ‹¬InnoDBæ•°æ®å­—å…¸ã€åŒå†™ç¼“å­˜ã€æ›´æ–°ç¼“å­˜å’Œæ’¤é”€æ—¥å¿—ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬è¡¨å’Œç´¢å¼•æ•°æ®ã€‚å¤šè¡¨å…±äº«ï¼Œç³»ç»Ÿè¡¨ç©ºé—´è¢«è§†ä¸ºå…±äº«è¡¨ç©ºé—´ã€‚ </p>
<p><strong>6.åŒå†™ç¼“å­˜</strong>åŒå†™ç¼“å­˜ä½äºç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œç”¨äºå†™å…¥ä»ç¼“å­˜æ± åˆ·æ–°çš„æ•°æ®é¡µã€‚åªæœ‰åœ¨åˆ·æ–°å¹¶å†™å…¥åŒå†™ç¼“å­˜åï¼ŒInnoDBæ‰ä¼šå°†æ•°æ®é¡µå†™å…¥åˆé€‚çš„ä½ç½®ã€‚</p>
<p><strong>7.æ’¤é”€æ—¥å¿—</strong>æ’¤é”€æ—¥å¿—æ˜¯ä¸€ç³»åˆ—ä¸äº‹åŠ¡ç›¸å…³çš„æ’¤é”€è®°å½•çš„é›†åˆï¼ŒåŒ…å«å¦‚ä½•æ’¤é”€äº‹åŠ¡æœ€è¿‘çš„æ›´æ”¹ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡è¦æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œå¯ä»¥ä»æ’¤é”€æ—¥å¿—è®°å½•ä¸­è¿½æº¯æœªæ›´æ”¹çš„æ•°æ®ã€‚æ’¤é”€æ—¥å¿—å­˜åœ¨äºæ’¤é”€æ—¥å¿—ç‰‡æ®µä¸­ï¼Œè¿™äº›ç‰‡æ®µåŒ…å«äºå›æ»šç‰‡æ®µä¸­ã€‚</p>
<p><strong>8.æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´</strong>æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´æ˜¯æŒ‡æ¯ä¸ªå•ç‹¬çš„è¡¨ç©ºé—´åˆ›å»ºåœ¨è‡ªèº«çš„æ•°æ®æ–‡ä»¶ä¸­ï¼Œ </p>
<p>è€Œä¸æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡innodb_file_per_tableé…ç½®é¡¹å¼€å¯ã€‚æ¯ä¸ªè¡¨ç©ºé—´ç”±ä¸€ä¸ªå•ç‹¬çš„.ibdæ•°æ®æ–‡ä»¶ä»£è¡¨ï¼Œè¯¥æ–‡ä»¶é»˜è®¤è¢«åˆ›å»ºåœ¨æ•°æ®åº“ç›®å½•ä¸­ã€‚ </p>
<p><strong>9.é€šç”¨è¡¨ç©ºé—´</strong>ä½¿ç”¨CREATE TABLESPACEè¯­æ³•åˆ›å»ºå…±äº«çš„InnoDBè¡¨ç©ºé—´ã€‚é€šç”¨è¡¨ç©ºé—´å¯ä»¥åˆ›å»ºåœ¨MySQLæ•°æ®ç›®å½•ä¹‹å¤–èƒ½å¤Ÿç®¡ç†å¤šä¸ªè¡¨å¹¶æ”¯æŒæ‰€æœ‰è¡Œæ ¼å¼çš„è¡¨ã€‚</p>
<p><strong>10.æ’¤é”€è¡¨ç©ºé—´</strong>æ’¤é”€è¡¨ç©ºé—´ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«æ’¤é”€æ—¥å¿—çš„æ–‡ä»¶ç»„æˆã€‚æ’¤é”€è¡¨ç©ºé—´çš„æ•°é‡ç”± innodb_undo_tablespacesé…ç½®é¡¹é…ç½®ã€‚</p>
<p><strong>11.ä¸´æ—¶è¡¨ç©ºé—´</strong> ç”¨æˆ·åˆ›å»ºçš„ä¸´æ—¶è¡¨ç©ºé—´å’ŒåŸºäºç£ç›˜çš„å†…éƒ¨ä¸´æ—¶è¡¨éƒ½åˆ›å»ºäºä¸´æ—¶è¡¨ç©ºé—´ã€‚innodb_temp_data_file_pathé…ç½®é¡¹å®šä¹‰äº†ç›¸å…³çš„è·¯å¾„ã€åç§°ã€å¤§å°å’Œå±æ€§ã€‚å¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œé»˜è®¤ä¼šåœ¨innodb_data_home_dirå˜é‡æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ‰©å±•çš„æ•°æ®æ–‡ä»¶ã€‚ </p>
<p><strong>12.é‡åšæ—¥å¿—</strong>é‡åšæ—¥å¿—æ˜¯åŸºäºç£ç›˜çš„æ•°æ®ç»“æ„ï¼Œåœ¨å´©æºƒæ¢å¤æœŸé—´ä½¿ç”¨ï¼Œç”¨æ¥çº æ­£æ•°æ®ã€‚æ­£å¸¸æ“ä½œæœŸé—´ï¼Œé‡åšæ—¥å¿—ä¼šå°†è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œè¿™äº›è¯·æ±‚ä¼šæ”¹å˜InnoDBè¡¨æ•°æ®ã€‚é‡åˆ°æ„å¤–å´©æºƒåï¼Œæœªå®Œæˆçš„æ›´æ”¹ä¼šè‡ªåŠ¨åœ¨åˆå§‹åŒ–æœŸé—´é‡æ–°è¿›è¡Œã€‚</p>
<h3 id="sqlæ€§èƒ½ä¸‹é™çš„åŸå› "><a href="#sqlæ€§èƒ½ä¸‹é™çš„åŸå› " class="headerlink" title="sqlæ€§èƒ½ä¸‹é™çš„åŸå› "></a>sqlæ€§èƒ½ä¸‹é™çš„åŸå› </h3><ul>
<li>æŸ¥è¯¢è¯­å¥å†™çš„å·®</li>
<li>ç´¢å¼•å¤±æ•ˆï¼šç´¢å¼•å»ºäº†ï¼Œä½†æ²¡ç”¨ä¸Š</li>
<li>å…³è”æŸ¥è¯¢å¤ªå¤šjoinï¼ˆè®¾è®¡ç¼ºé™·æˆ–ä¸å¾—å·²éœ€æ±‚ï¼‰</li>
<li>æœåŠ¡å™¨è°ƒä¼˜ä»¥åŠå„ä¸ªå‚æ•°çš„è®¾ç½®ï¼ˆç¼“å†²ã€çº¿ç¨‹æ•°ï¼‰</li>
</ul>
<h3 id="ä¸ƒç§joinç†è®º"><a href="#ä¸ƒç§joinç†è®º" class="headerlink" title="ä¸ƒç§joinç†è®º"></a>ä¸ƒç§joinç†è®º</h3><p><img src="/2022/04/22/MySQL/1646899331303.png" alt="1646899331303" loading="lazy">ä¸Šå›¾ä¸­ç¬¬6ä¸ªçš„å®ç° å¯ä»¥é€šè¿‡å¦‚ä¸‹ï¼š</p>
<p>ç”±äºæœ‰äº›mysqlä¸èƒ½ä½¿ç”¨full joinï¼Œä¸è¿‡å¯ä»¥æ¢ç§æ–¹æ³•è¡¨ç¤º<br><code>A çš„ç‹¬æœ‰ + AB å…±æœ‰ + Bçš„ç‹¬æœ‰</code><br>unionæœ¬èº«å°±å¯ä»¥å»é‡<br>æ‰€ä»¥å¯ä»¥è¿™æ ·ä½¿ç”¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp a <span class="keyword">left</span> <span class="keyword">join</span> tbl_dept b <span class="keyword">on</span> a.deptId <span class="operator">=</span> b.id</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp a <span class="keyword">right</span> <span class="keyword">join</span> tbl_dept b <span class="keyword">on</span> a.deptId <span class="operator">=</span> b.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> ä¸Šå›¾ä¸­ç¬¬7ä¸ªçš„å®ç°å¯ä»¥é€šè¿‡å¦‚ä¸‹ï¼š<br>ä¹Ÿå°±æ˜¯Açš„ç‹¬æœ‰+ Bçš„ç‹¬æœ‰<br>ä¹‹åé€šè¿‡unionè¿›è¡Œåˆå¹¶ </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp a <span class="keyword">left</span> <span class="keyword">join</span> tbl_dept b <span class="keyword">on</span> a.deptId <span class="operator">=</span> b.id <span class="keyword">where</span> b.id <span class="keyword">is</span> <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_emp a <span class="keyword">right</span> <span class="keyword">join</span> tbl_dept b <span class="keyword">on</span> a.deptId <span class="operator">=</span> b.id <span class="keyword">where</span> a.deptId <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„</h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•</h4><p>ç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“ç”¨äºå¿«é€Ÿæ‰¾åˆ°æ•°æ®è®°å½•çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±å¥½æ¯”ä¸€æœ¬æ•™è¯¾ä¹¦çš„ç›®å½•éƒ¨åˆ†ï¼Œé€šè¿‡ç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”æ–‡ç« çš„é¡µç ï¼Œä¾¿å¯å¿«é€Ÿå®šä½åˆ°éœ€è¦çš„æ–‡ç« ã€‚MySQLä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œè¿›è¡Œæ•°æ®æŸ¥æ‰¾æ—¶ï¼Œé¦–å…ˆæŸ¥çœ‹æŸ¥è¯¢æ¡ä»¶æ˜¯å¦å‘½ä¸­æŸæ¡ç´¢å¼•ï¼Œç¬¦åˆåˆ™é€šè¿‡ç´¢å¼•æŸ¥æ‰¾ç›¸å…³æ•°æ®ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™éœ€è¦å…¨è¡¨æ‰«æï¼Œå³éœ€è¦ä¸€æ¡ä¸€æ¡åœ°æŸ¥æ‰¾è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸æ¡ä»¶ç¬¦åˆçš„è®°å½•ã€‚<img src="/2022/04/22/MySQL/1652583833418.png" alt="1652583833418" loading="lazy"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•°æ®åº“æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ•°æ®<strong>åˆ†å¸ƒåœ¨ç¡¬ç›˜ä¸åŒçš„ä½ç½®ä¸Šé¢</strong>ï¼Œè¯»å–æ•°æ®æ—¶ï¼Œæ‘†è‡‚éœ€è¦å‰åæ‘†åŠ¨æŸ¥æ‰¾æ•°æ®ï¼Œè¿™æ ·æ“ä½œéå¸¸æ¶ˆè€—æ—¶é—´ã€‚å¦‚æœ<strong>æ•°æ®é¡ºåºæ‘†æ”¾</strong>ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦ä»1åˆ°6è¡ŒæŒ‰é¡ºåºè¯»å–ï¼Œè¿™æ ·å°±ç›¸å½“äºè¿›è¡Œäº†6æ¬¡Ioæ“ä½œï¼Œ<strong>ä¾æ—§éå¸¸è€—æ—¶</strong>ã€‚å¦‚æœæˆ‘ä»¬ä¸å€ŸåŠ©ä»»ä½•ç´¢å¼•ç»“æ„å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æ•°æ®çš„è¯ï¼Œæˆ‘ä»¬æŸ¥æ‰¾Col 2= 89è¿™æ¡è®°å½•ï¼Œå°±è¦é€è¡Œå»æŸ¥æ‰¾ã€å»æ¯”è¾ƒã€‚ä»Col2=34å¼€å§‹ï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œå‘ç°ä¸æ˜¯ï¼Œç»§ç»­ä¸‹ä¸€è¡Œã€‚æˆ‘ä»¬å½“å‰çš„è¡¨åªæœ‰ä¸åˆ°10è¡Œæ•°æ®ï¼Œä½†å¦‚æœè¡¨å¾ˆå¤§çš„è¯ï¼Œæœ‰<strong>ä¸Šåƒä¸‡æ¡æ•°æ®</strong>ï¼Œå°±æ„å‘³ç€è¦åšå¾ˆå¤šå¾ˆ<strong>å¤šæ¬¡ç£ç›˜I/0</strong>æ‰èƒ½æ‰¾åˆ°ã€‚ç°åœ¨è¦æŸ¥æ‰¾col2=89è¿™æ¡è®°å½•ã€‚CPUå¿…é¡»å…ˆå»ç£ç›˜æŸ¥æ‰¾è¿™æ¡è®°å½•ï¼Œæ‰¾åˆ°ä¹‹ååŠ è½½åˆ°å†…å­˜ï¼Œå†å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚è¿™ä¸ªè¿‡ç¨‹æœ€è€—æ—¶é—´çš„å°±æ˜¯ç£ç›˜l/o(æ¶‰åŠåˆ°ç£ç›˜çš„æ—‹è½¬æ—¶é—´ï¼ˆ(é€Ÿåº¦è¾ƒå¿«ï¼‰ã€ç£å¤´çš„å¯»é“æ—¶é—´(é€Ÿåº¦æ…¢ã€è´¹æ—¶))</p>
<p>å‡å¦‚ç»™æ ‘ä½¿ç”¨äºŒå‰æ ‘è¿™æ ·çš„æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œå¦‚å›¾<img src="/2022/04/22/MySQL/1652584043939.png" alt="1652584043939" loading="lazy"></p>
<p>å¯¹å­—æ®µCol2æ·»åŠ äº†ç´¢å¼•ï¼Œå°±ç›¸å½“äºåœ¨ç¡¬ç›˜ä¸Šä¸ºcol 2ç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œå³è¿™ä¸ª<strong>äºŒå‰æœç´¢æ ‘</strong>ã€‚äºŒå‰æœç´¢æ ‘çš„æ¯ä¸ªç»“ç‚¹å­˜å‚¨çš„æ˜¯<strong>ã€ˆKï¼ŒV)ç»“æ„</strong>ï¼Œkeyæ˜¯Col 2ï¼Œ valdeæ˜¯è¯¥key æ‰€åœ¨è¡Œçš„æ–‡ä»¶æŒ‡é’ˆ(åœ°å€)ã€‚æ¯”å¦‚:è¯¥äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯:ï¼ˆ34,0x07)ã€‚ç°åœ¨å¯¹Col 2æ·»åŠ äº†ç´¢å¼•ï¼Œè¿™æ—¶å†å»æŸ¥æ‰¾Col2=89è¿™æ¡è®°å½•çš„æ—¶å€™ä¼šå…ˆå»æŸ¥æ‰¾è¯¥äºŒå‰æœç´¢æ ‘ï¼ˆäºŒå‰æ ‘çš„éå†æŸ¥æ‰¾)ã€‚è¯»34åˆ°å†…å­˜ï¼Œ89&gt;34;ç»§ç»­å³ä¾§æ•°æ®ï¼Œè¯»89åˆ°å†…å­˜ï¼Œ89.=- 89;æ‰¾åˆ°æ•°æ®è¿”å›ã€‚æ‰¾åˆ°ä¹‹åå°±æ ¹æ®å½“å‰ç»“ç‚¹çš„valueå¿«é€Ÿå®šä½åˆ°è¦æŸ¥æ‰¾çš„è®°å½•å¯¹åº”çš„åœ°å€ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåªéœ€è¦<strong>æŸ¥æ‰¾ä¸¤æ¬¡</strong>å°±å¯ä»¥å®šä½åˆ°è®°å½•çš„åœ°å€ï¼ŒæŸ¥è¯¢é€Ÿåº¦å°±æé«˜äº†ã€‚</p>
<p>è¿™å°±æ˜¯å»ºç«‹ç´¢å¼•çš„ç›®çš„ï¼š<strong>å‡å°‘ç£ç›˜IOçš„æ¬¡æ•°ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿç‡</strong></p>
<h4 id="ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹"><a href="#ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹" class="headerlink" title="ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹"></a>ç´¢å¼•åŠå…¶ä¼˜ç¼ºç‚¹</h4><blockquote>
<p>ä»€ä¹ˆæ˜¯ç´¢å¼•</p>
</blockquote>
<p>ç´¢å¼•æ˜¯<strong>æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„</strong>ï¼Œæ˜¯æ•°æ®åº“ç»´æŠ¤çš„ä¸€ä¸ªæ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•</p>
<p><strong>é‡ç‚¹</strong>ï¼šç´¢å¼•ä¼šå½±å“åˆ°<strong>mysqlæŸ¥æ‰¾</strong>ï¼ˆWHEREçš„æŸ¥è¯¢æ¡ä»¶ï¼‰ã€<strong>æ’åº</strong>ï¼ˆORDER BYï¼‰ä¸¤å¤§åŠŸèƒ½</p>
<p>ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤å¾€å¾€å­˜å‚¨åœ¨ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Š</p>
<p>å¹³æ—¶æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œéƒ½ä½¿æŒ‡Bæ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰ï¼‰ï¼Œç»“æ„ç»„ç»‡çš„ç´¢å¼•ï¼Œå…¶ä¸­èšé›†ç´¢å¼•ã€æ¬¡è¦ç´¢å¼•ã€è¦†ç›–ç´¢å¼•ã€å¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•é»˜è®¤ä½¿ç”¨B+æ ‘ç´¢å¼•ï¼Œç»Ÿç§°ç´¢å¼•ï¼Œé™¤äº†<strong>B+æ ‘</strong>è¿™ç§æ•°æ®ç»“æ„çš„ç´¢å¼•å¤–ï¼Œè¿˜æœ‰<strong>å“ˆå¸Œç´¢å¼•</strong></p>
<p><strong>ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°çš„ï¼Œ</strong>å› æ­¤æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•ä¸ä¸€å®šå®Œå…¨ç›¸åŒã€‚å‹ã€‚åŒæ—¶ï¼Œå­˜å‚¨å¼•æ“å¯ä»¥å®šä¹‰æ¯ä¸ªè¡¨çš„æœ€å¤§ç´¢å¼•æ•°å’Œæœ€å¤§ç´¢å¼•é•¿åº¦ã€‚æ‰€æœ‰å­˜å‚¨å¼•æ“æ”¯æŒæ¯ä¸ªè¡¨è‡³å°‘16ä¸ªç´¢å¼•ï¼Œæ€»ç´¢å¼•é•¿åº¦è‡³å°‘ä¸º256å­—èŠ‚ã€‚æœ‰äº›å­˜å‚¨å¼•æ“æ”¯æŒæ›´å¤šçš„ç´¢å¼•æ•°å’Œæ›´å¤§çš„ç´¢å¼•é•¿åº¦ã€‚</p>
<blockquote>
<p>ç´¢å¼•çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿</p>
</blockquote>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>â€‹    <strong>æŸ¥æ‰¾</strong>ï¼šç±»ä¼¼äºå¤§å­¦å›¾ä¹¦é¦†ï¼Œæé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œ<strong>é™ä½æ•°æ®åº“ioæˆæœ¬</strong></li>
<li>â€‹    <strong>æ’åº</strong>ï¼šé€šè¿‡ç´¢å¼•å¯¹æ•°æ®æ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½cpuæ¶ˆè€—</li>
<li>é€šè¿‡åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œ<strong>æ•°æ®å”¯ä¸€æ€§</strong></li>
<li>åœ¨å®ç°æ ‘çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ï¼Œå¯ä»¥åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºä¾èµ–å…³ç³»çš„å­è¡¨å’Œçˆ¶è¡¨è”åˆæŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦</li>
<li>åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥<strong>æ˜¾è‘—å‡å°‘æŸ¥è¯¢æ—¶åˆ†ç»„å’Œæ’åºçš„æ—¶é—´</strong>ï¼Œé™ä½äº†CPUæ¶ˆè€—</li>
</ul>
<p>åŠ£åŠ¿ï¼š</p>
<ul>
<li>ç´¢å¼•å®é™…ä¸Šä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œç´¢å¼•ç´¢å¼•ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„</li>
<li>è™½ç„¶ç´¢å¼•ä¼šæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ä¼šé™ä½è¡¨çš„æ›´æ–°é€Ÿåº¦ï¼Œå› ä¸ºæ›´æ–°è¡¨æ—¶ï¼Œä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ç»´æŠ¤ç´¢å¼•è¡¨çš„ä¿¡æ¯å˜åŒ–</li>
<li>ç´¢å¼•çŸ¥è¯†æé«˜æ•ˆç‡çš„ä¸€ä¸ªå› ç´ ï¼Œå¦‚æœæœ‰å¤§æ•°æ®é‡çš„è¡¨ï¼Œå°±è¦èŠ±æ—¶é—´ç ”ç©¶å»ºç«‹æœ€ä¼˜ç§€çš„ç´¢å¼•</li>
<li>åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦<strong>è€—è´¹æ—¶é—´</strong>ä¸”éšç€æ•°æ®é‡å¢å¤§ï¼Œæ—¶é—´å¢åŠ </li>
<li>ç´¢å¼•éœ€è¦å ç£ç›˜ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå¦‚æœæœ‰å¤§é‡çš„ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶å°±å¯èƒ½æ¯”æ•°æ®æ–‡ä»¶æ›´å¿«è¾¾åˆ°æœ€å¤§æ–‡ä»¶å°ºå¯¸ã€‚</li>
</ul>
<blockquote>
<p>æç¤ºï¼š</p>
<p>ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šå½±å“æ’å…¥è®°å½•çš„é€Ÿåº¦ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å…ˆåˆ é™¤è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åå†æ’å…¥æ•°æ®ï¼Œç„¶åå†åˆ›å»ºç´¢å¼• </p>
</blockquote>
<h4 id="InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”"><a href="#InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”" class="headerlink" title="InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”"></a>InnoDBä¸­ç´¢å¼•çš„æ¨æ¼”</h4><h5 id="ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾"><a href="#ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾" class="headerlink" title="ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾"></a>ç´¢å¼•ä¹‹å‰çš„æŸ¥æ‰¾</h5><p>å…ˆæ¥çœ‹ä¸€ä¸ªç²¾ç¡®åŒ¹é…çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT [åˆ—ååˆ—è¡¨] FROM è¡¨æ˜ WHERE åˆ—å = xxx;</span><br></pre></td></tr></table></figure>

<h6 id="åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾"><a href="#åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾" class="headerlink" title="åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾"></a>åœ¨ä¸€ä¸ªé¡µä¸­çš„æŸ¥æ‰¾</h6><p>å‡è®¾ç›®å‰è¡¨ä¸­çš„è®°å½•æ¯”è¾ƒå°‘ï¼Œæ‰€æœ‰çš„è®°å½•å¯ä»¥è¢«å­˜åˆ°ä¸€ä¸ªé¡µä¸­ï¼Œåœ¨æŸ¥æ‰¾è®°å½•æ—¶å¯ä»¥æ ¹æ®æœç´¢æ¡ä»¶çš„ä¸åŒåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li><p>ä»¥ä¸»é”®ä¸ºæœç´¢æ¡ä»¶</p>
<p>å¯ä»¥åœ¨é¡µç›®å½•ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•</p>
</li>
<li><p>ä»¥å…¶ä»–åˆ—ä¸ºæœç´¢æ¡ä»¶</p>
<p>å› ä¸ºåœ¨æ•°æ®é¡µä¸­å¹¶æ²¡æœ‰å¯¹éä¸»é”®åˆ—å»ºç«‹æ‰€è°“çš„é¡µç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½ç›¸åº”çš„æ§½ã€‚<br>è¿™ç§æƒ…å†µä¸‹åªèƒ½ä»<strong>æœ€å°è®°å½•</strong>å¼€å§‹<strong>ä¾æ¬¡éå†</strong>å•é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œç„¶åå¯¹æ¯”æ¯æ¡è®°å½•æ˜¯ä¸æ˜¯ç¬¦åˆæœç´¢æ¡ä»¶ã€‚å¾ˆæ˜¾ç„¶,è¿™ç§æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚</p>
</li>
</ul>
<h6 id="åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾"><a href="#åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾" class="headerlink" title="åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾"></a>åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾</h6><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬è¡¨ä¸­å­˜æ”¾çš„è®°å½•éƒ½æ˜¯éå¸¸å¤šçš„ï¼Œéœ€è¦å¥½å¤šçš„æ•°æ®é¡µæ¥å­˜å‚¨è¿™äº›è®°å½•ã€‚åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾è®°å½•çš„è¯å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<p>1.å®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µ</p>
<p>2.ä»æ‰€åœ¨çš„é¡µå†…ä¸­æŸ¥æ‰¾ç›¸åº”çš„è®°å½•</p>
<p>åœ¨æ²¡æœ‰ç´¢å¼•æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯æ ¹æ®ä¸»é”®åˆ—æˆ–å…¶ä»–åˆ—çš„å€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œç”±äºå¹¶ä¸èƒ½å¿«é€Ÿå®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µï¼Œæ‰€ä»¥åªèƒ½ä»<strong>ç¬¬ä¸€ä¸ªé¡µ</strong>æ²¿ç€<strong>åŒå‘é“¾è¡¨</strong>ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œåœ¨æ¯ä¸€ä¸ªé¡µä¸­æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„æŸ¥æ‰¾æ–¹å¼å»æŸ¥æ‰¾è®°å½•ã€‚å› ä¸ºè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¾ç¤º<strong>è¶…çº§è€—æ—¶</strong>çš„ï¼Œå› æ­¤è¯ç”Ÿäº†ç´¢å¼•ã€‚</p>
<h5 id="è®¾è®¡ç´¢å¼•"><a href="#è®¾è®¡ç´¢å¼•" class="headerlink" title="è®¾è®¡ç´¢å¼•"></a>è®¾è®¡ç´¢å¼•</h5><p>å»ºä¸€ä¸ªè¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE index_demo(</span><br><span class="line">	-&gt; c1 INT,</span><br><span class="line">    -&gt; c2 INT,</span><br><span class="line">    -&gt; c3 CHAR(1),</span><br><span class="line">    -&gt; PRIMARY KEY(c1)</span><br><span class="line">	-&gt; ) ROW_FORMAT = Compact;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–°å»ºçš„index_demoè¡¨ä¸­æœ‰2ä¸ªINTç±»å‹çš„ã€‚1ä¸ªCHAR(1)ç±»å‹çš„åˆ—ï¼Œè€Œä¸”è§„å®šäº†c1åˆ—æ˜¯ä¸»é”®ï¼Œè¿™ä¸ªè¡¨ä½¿ç”¨Compactè¡Œæ ¼å¼æ¥å®é™…å­˜å‚¨è®°å½•çš„ã€‚è¿™é‡Œç®€åŒ–äº†index_demoè¡¨çš„è¡Œæ ¼å¼ç¤ºæ„å›¾ï¼š<img src="/2022/04/22/MySQL/1652601775640.png" alt="1652601775640" loading="lazy"></p>
<p>æˆ‘ä»¬åªåœ¨ç¤ºæ„å›¾é‡Œå±•ç¤ºè®°å½•çš„è¿™å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>record_type ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ï¼Œ 0 è¡¨ç¤ºæ™®é€šè®°å½•ã€ 2 è¡¨ç¤ºæœ€å°è®°å½•ã€ 3 è¡¨ç¤ºæœ€å¤§è®°å½•ã€ 1 æš‚æ—¶è¿˜æ²¡ç”¨è¿‡ï¼Œä¸‹é¢è®²ã€‚ </li>
<li>next_record ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡åœ°å€ç›¸å¯¹äºæœ¬æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œæˆ‘ä»¬ç”¨ç®­å¤´æ¥è¡¨æ˜ä¸‹ä¸€æ¡è®°å½•æ˜¯è°ã€‚ </li>
<li>å„ä¸ªåˆ—çš„å€¼ ï¼šè¿™é‡Œåªè®°å½•åœ¨ index_demo è¡¨ä¸­çš„ä¸‰ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯ c1 ã€ c2 å’Œ c3 ã€‚ </li>
<li>å…¶ä»–ä¿¡æ¯ ï¼šé™¤äº†ä¸Šè¿°3ç§ä¿¡æ¯ä»¥å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–éšè—åˆ—çš„å€¼ä»¥åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ã€‚</li>
</ul>
<p>å°†è®°å½•æ ¼å¼ç¤ºæ„å›¾çš„å…¶ä»–ä¿¡æ¯é¡¹æš‚æ—¶å»æ‰å¹¶æŠŠå®ƒç«–èµ·æ¥çš„æ•ˆæœï¼š<img src="/2022/04/22/MySQL/1652601959138.png" alt="1652601959138" loading="lazy"></p>
<p>æŠŠä¸€äº›è®°å½•æ”¾åˆ°é¡µé‡Œçš„ç¤ºæ„å›¾ï¼š<img src="/2022/04/22/MySQL/1652602035735.png" alt="1652602035735" loading="lazy"></p>
<h6 id="ç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ"><a href="#ç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="ç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ"></a>ç®€å•çš„ç´¢å¼•è®¾è®¡æ–¹æ¡ˆ</h6><p>æˆ‘ä»¬åœ¨æ ¹æ®æŸä¸ªæœç´¢æ¡ä»¶æŸ¥æ‰¾ä¸€äº›è®°å½•æ—¶ä¸ºä»€ä¹ˆè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µå‘¢ï¼Ÿå› ä¸ºå„ä¸ªé¡µä¸­çš„è®°å½•å¹¶æ²¡æœ‰è§„å¾‹ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„æœç´¢æ¡ä»¶åŒ¹é…å“ªäº›é¡µä¸­çš„è®°å½•ï¼Œæ‰€ä»¥ä¸å¾—ä¸ä¾æ¬¡éå†æ‰€æœ‰çš„æ•°æ®é¡µã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬ <strong>æƒ³å¿«é€Ÿçš„å®šä½åˆ°éœ€è¦æŸ¥æ‰¾çš„è®°å½•åœ¨å“ªäº›æ•°æ®é¡µ</strong> ä¸­è¯¥å’‹åŠï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œ <strong>å»ºç«‹ä¸€ä¸ªç›®å½•</strong> ï¼Œå»ºè¿™ä¸ªç›®å½•å¿…é¡»å®Œæˆä¸‹è¾¹è¿™äº›äº‹ï¼š</p>
<ul>
<li><p>ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼</p>
<p>å‡è®¾:æ¯ä¸ªæ•°æ®é¡µæœ€å¤šèƒ½å­˜æ”¾3æ¡è®°å½•(å®é™…ä¸Šä¸€ä¸ªæ•°æ®é¡µéå¸¸å¤§ï¼Œå¯ä»¥å­˜æ”¾ä¸‹å¥½å¤šè®°å½•)ã€‚æœ‰äº†è¿™ä¸ªå‡è®¾ä¹‹åæˆ‘ä»¬å‘index_demoè¡¨æ’å…¥3æ¡è®°å½•:<img src="/2022/04/22/MySQL/1652602831329.png" alt="1652602831329" loading="lazy"></p>
<p>é‚£ä¹ˆè¿™äº›è®°å½•å·²ç»æŒ‰ç…§é€æ¸çŸ¥é“å¤§å°ä¸²è”æˆä¸€ä¸ªå•é¡¹é“¾è¡¨ï¼Œå¦‚å›¾ï¼š<img src="/2022/04/22/MySQL/1652602890257.png" alt="1652602890257" loading="lazy"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œindex_demoè¡¨ä¸­çš„3æ¡ä»¶è®°å½•éƒ½è¢«æ’å…¥åˆ°ç¼–å·ä¸º10çš„æ•°æ®é¡¹ä¸­ï¼Œæ­¤æ—¶å†æ’å…¥ä¸€æ¡è®°å½•ï¼š<img src="/2022/04/22/MySQL/1652602954239.png" alt="1652602954239" loading="lazy"></p>
<p>å› ä¸ºé¡µ10æœ€å¤šåªèƒ½æ”¾3æ¡è®°å½•ï¼Œæ‰€ä»¥ä¸å¾—ä¸å†åˆ†ä¸€ä¸ªæ–°é¡µï¼š<img src="/2022/04/22/MySQL/1652602987860.png" alt="1652602987860" loading="lazy"></p>
<p>æ³¨æ„ï¼Œæ–°åˆ†é…çš„<strong>æ•°æ®é¡µç¼–å·</strong>å¯èƒ½å¹¶ä¸æ˜¯è¿ç»­çš„ã€‚å®ƒä»¬åªæ˜¯é€šè¿‡ç»´æŠ¤ç€ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·è€Œå»ºç«‹äº†<strong>é“¾è¡¨</strong>å…³ç³»ã€‚å¦å¤–ï¼Œé¡µ10ä¸­ç”¨æˆ·è®°å½•æœ€å¤§çš„ä¸»é”®å€¼æ˜¯5ï¼Œè€Œé¡µ28ä¸­æœ‰ä¸€æ¡è®°å½•çš„ä¸»é”®å€¼æ˜¯4ï¼Œå› ä¸º<strong>5&gt;4</strong>ï¼Œæ‰€ä»¥è¿™å°±ä¸ç¬¦åˆä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼çš„è¦æ±‚ï¼Œæ‰€ä»¥åœ¨æ’å…¥ä¸»é”®å€¼ä¸º4çš„è®°å½•çš„æ—¶å€™éœ€è¦ä¼´éšç€ä¸€æ¬¡<strong>è®°å½•ç§»åŠ¨</strong>ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸»é”®å€¼ä¸º5çš„è®°å½•ç§»åŠ¨åˆ°é¡µ28ä¸­ï¼Œç„¶åå†æŠŠä¸»é”®å€¼ä¸º4çš„è®°å½•æ’å…¥åˆ°é¡µ10ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹:<img src="/2022/04/22/MySQL/1652603092286.png" alt="1652603092286" loading="lazy"></p>
<p>è¿™ä¸ªè¿‡ç¨‹è¡¨æ˜äº†åœ¨å¯¹é¡µä¸­çš„è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€äº›è¯¸å¦‚<strong>è®°å½•ç§»åŠ¨</strong>çš„æ“ä½œæ¥å§‹ç»ˆä¿è¯è¿™ä¸ªçŠ¶æ€ä¸€ç›´æˆç«‹:ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¸º<strong>é¡µåˆ†è£‚</strong>ã€‚</p>
</li>
<li><p>ç»™æ‰€æœ‰é¡µå»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ã€‚</p>
<p>ç”±äº<strong>æ•°æ®é¡µçš„ç¼–å·å¯èƒ½ä¸æ˜¯è¿ç»­</strong>çš„ï¼Œæ‰€ä»¥åœ¨å‘index_demoè¡¨ä¸­æ’å…¥è®¸å¤šè®°å½•åï¼Œæ˜¯è¿™æ ·çš„ï¼š<img src="/2022/04/22/MySQL/1652623845882.png" alt="1652623845882" loading="lazy"></p>
<p>å› ä¸ºè¿™äº›16KBçš„é¡µåœ¨ç‰©ç†å­˜å‚¨ä¸Šæ˜¯<strong>ä¸è¿ç»­</strong>çš„ï¼Œæ‰€ä»¥å¦‚æœæƒ³ä»è¿™ä¹ˆå¤šé¡µä¸­æ ¹æ®ä¸»é”®å€¼<strong>å¿«é€Ÿå®šä½æŸäº›è®°å½•æ‰€åœ¨çš„é¡µ</strong>ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬åšä¸ªç›®å½•ï¼Œæ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…æ‹¬ä¸‹è¾¹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>é¡µçš„ç”¨æˆ·è®°å½•ä¸­æœ€å°çš„ä¸»é”®å€¼ï¼Œæˆ‘ä»¬ç”¨keyæ¥è¡¨ç¤ºã€‚</li>
<li>é¡µå·ï¼Œæˆ‘ä»¬ç”¨page_noè¡¨ç¤º</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸ºä¸Šè¾¹å‡ ä¸ªé¡µåšå¥½çš„ç›®å½•å°±åƒè¿™æ ·ï¼š<img src="/2022/04/22/MySQL/1652623892480.png" alt="1652623892480" loading="lazy"></p>
<p>ä»¥<strong>é¡µ28</strong>ä¸ºä¾‹ï¼Œå®ƒå¯¹åº”<strong>ç›®å½•é¡¹2</strong>ï¼Œè¿™ä¸ªç›®å½•é¡¹ä¸­åŒ…å«ç€è¯¥é¡µçš„é¡µå· 28 ä»¥åŠè¯¥é¡µä¸­ç”¨æˆ·è®°å½•çš„æœ€å°ä¸»é”®å€¼ 5 ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå‡ ä¸ªç›®å½•é¡¹åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼ˆæ¯”å¦‚ï¼šæ•°ç»„ï¼‰ï¼Œå°±å¯ä»¥å®ç°æ ¹æ®ä¸»é”®å€¼å¿«é€ŸæŸ¥æ‰¾æŸæ¡è®°å½•çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šæŸ¥æ‰¾ä¸»é”®å€¼ä¸º20çš„è®°å½•ï¼Œå…·ä½“æŸ¥æ‰¾è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>å…ˆä»ç›®å½•é¡¹ä¸­æ ¹æ®äºŒåˆ†æ³•å¿«é€Ÿç¡®å®šå‡ºä¸»é”®å€¼ä¸º20çš„è®°å½•åœ¨ç›®å½•é¡¹3ä¸­ï¼Œå®ƒå¯¹åº”çš„é¡µæ˜¯é¡µ9</li>
<li>å†æ ¹æ®å‰è¾¹è¯´çš„åœ¨é¡µä¸­æŸ¥æ‰¾è®°å½•çš„æ–¹æ³•å»é¡µ9ä¸­å®šä½è®°å½•</li>
</ol>
</li>
</ul>
<p>è‡³æ­¤ï¼Œé’ˆå¯¹æ•°æ®é¡µåšçš„ç®€æ˜“ç›®å½•å°±å®Œæˆï¼Œè¿™ä¸ªç›®å½•ä¹Ÿå°±æ˜¯<strong>ç´¢å¼•</strong>ã€‚</p>
<h6 id="InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"><a href="#InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ" class="headerlink" title="InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"></a>InnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</h6><p><strong>1.è¿­ä»£ä¸€æ¬¡ï¼šç›®å½•é¡¹è®°å½•çš„é¡µ</strong></p>
<p>ä¸Šè¾¹ç§°ä¸ºä¸€ä¸ªç®€æ˜“çš„ç´¢å¼•æ–¹æ¡ˆï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºäº†åœ¨æ ¹æ®ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶ä½¿ç”¨<strong>äºŒåˆ†æ³•</strong>å¿«é€Ÿå®šä½å…·ä½“çš„ç›®å½•é¡¹è€Œ<strong>å‡è®¾</strong>æ‰€æœ‰ç›®å½•é¡¹éƒ½å¯ä»¥åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Š<strong>è¿ç»­å­˜å‚¨</strong>ï¼Œä½†æ˜¯è¿™æ ·åšæœ‰å‡ ä¸ªé—®é¢˜:</p>
<ul>
<li>InnoDBæ˜¯ä½¿ç”¨é¡µæ¥ä½œä¸ºç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œæœ€å¤šèƒ½ä¿è¯16KBçš„è¿ç»­å­˜å‚¨ç©ºé—´ï¼Œè€Œéšç€è¡¨ä¸­è®°å½•æ•°é‡çš„å¢å¤šï¼Œéœ€è¦éå¸¸å¤§çš„è¿ç»­çš„å­˜å‚¨ç©ºé—´æ‰èƒ½æŠŠæ‰€æœ‰çš„ç›®å½•é¡¹éƒ½æ”¾ä¸‹ï¼Œè¿™å¯¹è®°å½•æ•°é‡éå¸¸å¤šçš„è¡¨æ˜¯ä¸ç°å®çš„ã€‚</li>
<li>æˆ‘ä»¬æ—¶å¸¸ä¼šå¯¹è®°å½•è¿›è¡Œå¢åˆ ï¼Œå‡è®¾æˆ‘ä»¬æŠŠé¡µ28ä¸­çš„è®°å½•åˆ é™¤äº†ï¼Œé‚£æ„å‘³ç€ç›®å½•é¡¹2ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œè¿™å°±éœ€è¦æŠŠç›®å½•é¡¹2åçš„ç›®å½•é¡¹éƒ½å‘å‰ç§»åŠ¨ä¸€ä¸‹ï¼Œè¿™æ ·æ“ä½œçš„æ•ˆç‡å¾ˆå·®ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å¯ä»¥<strong>çµæ´»ç®¡ç†æ‰€æœ‰ç›®å½•é¡¹</strong>çš„æ–¹å¼ã€‚æˆ‘ä»¬å‘ç°ç›®å½•é¡¹å…¶å®é•¿å¾—è·Ÿæˆ‘ä»¬çš„ç”¨æˆ·è®°å½•å·®ä¸å¤šï¼Œåªä¸è¿‡ç›®å½•é¡¹ä¸­çš„ä¸¤ä¸ªåˆ—æ˜¯<strong>ä¸»é”®å’Œé¡µå·</strong>è€Œå·²ï¼Œä¸ºäº†å’Œç”¨æˆ·è®°å½•åšä¸€ä¸‹åŒºåˆ†ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ç”¨æ¥è¡¨ç¤ºç›®å½•é¡¹çš„è®°å½•ç§°ä¸º<strong>ç›®å½•é¡¹è®°å½•</strong>ã€‚é‚£InnoDBæ€ä¹ˆåŒºåˆ†ä¸€æ¡è®°å½•æ˜¯æ™®é€šçš„ç”°å°¸è®°å½•è¿˜æ˜¯ç›®å½•é¡¹å·±å½•å‘¢?ä½¿ç”¨è®°å½•å¤´ä¿¡æ¯é‡Œçš„<br><strong>rcord_type</strong>å±æ€§ï¼Œå®ƒçš„å„ä¸ªå–å€¼ä»£è¡¨çš„æ„æ€å¦‚ä¸‹:</p>
<ul>
<li>0ï¼šæ™®é€šç”¨æˆ·è®°å½•</li>
<li>1ï¼šç›®å½•é¡¹è®°å½•</li>
<li>2ï¼šæœ€å°è®°å½•</li>
<li>3ï¼šæœ€å¤§è®°å½•</li>
</ul>
<p>æŠŠå‰è¾¹ä½¿ç”¨åˆ°çš„ç›®å½•é¡¹æ”¾åˆ°æ•°æ®é¡µä¸­çš„æ ·å­å°±æ˜¯è¿™æ ·ï¼š<img src="/2022/04/22/MySQL/1652624631062.png" alt="1652624631062" loading="lazy"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ã€‚æˆ‘ä»¬æ–°åˆ†é…ä¸€ä¸ªç¼–å·ä¸º30çš„é¡µæ¥ä¸“é—¨å­˜å‚¨ç›®å½•é¡¹è®°å½•ã€‚è¿™é‡Œå†æ¬¡å¼ºè°ƒ<strong>ç›®å½•é¡¹è®°å½•</strong>å’Œæ™®é€šçš„<strong>ç”¨æˆ·è®°å½•</strong>çš„ä¸åŒç‚¹ï¼š</p>
<ul>
<li><strong>ç›®å½•é¡¹è®°å½•</strong>çš„<strong>record_type</strong>å€¼æ˜¯1ï¼Œè€Œ<strong>æ™®é€šç”¨æˆ·è®°å½•</strong>çš„<strong>record_type</strong>å€¼æ˜¯0</li>
<li>ç›®å½•é¡¹è®°å½•åªæœ‰<strong>ä¸»é”®å’Œé¡µå·</strong>ä¸¤ä¸ªåˆ—ï¼Œè€Œæ™®é€šç”¨æˆ·è®°å½•çš„åˆ—æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œå¯èƒ½åŒ…å«å¾ˆå¤šåˆ—ï¼Œå¦å¤–è¿˜æœ‰InnoDBè‡ªå·±æ·»åŠ çš„éšè—åˆ—</li>
<li>äº†è§£ï¼šè®°å½•å¤´ä¿¡æ¯é‡Œè¿˜æœ‰ä¸€ä¸ªå«min_rec_maskçš„å±æ€§ï¼Œåªæœ‰åœ¨<strong>å­˜å‚¨ç›®å½•é¡¹è®°å½•</strong>çš„é¡µä¸­çš„ä¸»é”®å€¼æœ€å°çš„ç›®å½•é¡¹è®°å½•çš„min_rec_maskå€¼ä¸º1ï¼Œå…¶å®ƒçš„è®°å½•min_rec_maskçš„å€¼ä¸º0</li>
</ul>
<p>ç›¸åŒç‚¹ï¼šä¸¤è€…ç”¨çš„æ˜¯ä¸€æ ·çš„æ•°æ®é¡µï¼Œéƒ½ä¼šä¸ºä¸»é”®å€¼ç”Ÿæˆ<strong>Page Directory</strong>ï¼ˆé¡µç›®å½•ï¼‰ï¼Œä»è€Œåœ¨æŒ‰ç…§ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>ç°åœ¨ä»¥æŸ¥æ‰¾ä¸»é”®ä¸º20çš„è®°å½•ä¸ºä¾‹ï¼Œæ ¹æ®æŸä¸ªä¸»é”®å€¼å»æŸ¥æ‰¾è®°å½•çš„æ­¥éª¤å°±å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‹è¾¹ä¸¤æ­¥ï¼š</p>
<ol>
<li>å…ˆåˆ°å­˜å‚¨<strong>ç›®å½•é¡¹è®°å½•</strong>çš„é¡µï¼Œä¹Ÿå°±æ˜¯é¡µ30ä¸­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”ç›®å½•é¡¹ï¼Œå› ä¸º12&lt;20&lt;209ï¼Œæ‰€ä»¥å®šä½åˆ°å¯¹åº”çš„è®°å½•æ‰€åœ¨çš„é¡µå°±æ˜¯é¡µ9</li>
<li>å†åˆ°å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µ9ä¸­æ ¹æ®äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ä¸»é”®å€¼ä¸º20çš„ç”¨æˆ·è®°å½•ã€‚</li>
</ol>
<p><strong>2.è¿­ä»£2æ¬¡ï¼šå¤šä¸ªç›®å½•é¡¹è®°å½•çš„é¡µ</strong></p>
<p>è™½ç„¶è¯´<strong>ç›®å½•é¡¹è®°å½•</strong>ä¸­åªå­˜å‚¨ä¸»é”®å€¼å’Œå¯¹åº”çš„é¡µå·ï¼Œæ¯”ç”¨æˆ·è®°å½•éœ€è¦çš„å­˜å‚¨ç©ºé—´å°å¤šäº†ï¼Œä½†æ˜¯ä¸è®ºæ€ä¹ˆè¯´ä¸€ä¸ªé¡µåªæœ‰<strong>16KB</strong>å¤§å°ï¼Œèƒ½å­˜æ”¾çš„<strong>ç›®å½•é¡¹è®°å½•</strong>ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œé‚£å¦‚æœè¡¨ä¸­çš„æ•°æ®å¤ªå¤šï¼Œä»¥è‡³äºä¸€ä¸ªæ•°æ®é¡µä¸è¶³ä»¥å­˜æ”¾æ‰€æœ‰çš„<strong>ç›®å½•é¡¹è®°å½•</strong>ï¼Œå¦‚ä½•å¤„ç†å‘¢?</p>
<p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ<strong>æœ€å¤šåªèƒ½å­˜æ”¾4æ¡ç›®å½•é¡¹è®°å½•</strong>ï¼Œæ‰€ä»¥å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†å‘ä¸Šå›¾ä¸­æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º320çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œé‚£å°±éœ€è¦åˆ†é…ä¸€ä¸ª<strong>æ–°çš„å­˜å‚¨ç›®å½•é¡¹è®°å½•</strong>çš„é¡µ:<img src="/2022/04/22/MySQL/1652625722770.png" alt="1652625722770" loading="lazy"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ’å…¥äº†ä¸€æ¡ä¸»é”®ä¸º320çš„ç”¨æˆ·è®°å½•ä¹‹åéœ€è¦ä¸¤ä¸ªæ–°çš„æ•°æ®é¡µï¼š</p>
<ul>
<li>ä¸ºå­˜å‚¨è¯¥ç”¨æˆ·è®°å½•è€Œæ–°ç”Ÿæˆäº†é¡µ31</li>
<li>å› ä¸ºåŸå…ˆå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ30å®¹é‡å·²æ»¡ï¼ˆå‡è®¾åªèƒ½å­˜å‚¨4æ¡è®°å½•ï¼‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸éœ€è¦ä¸€ä¸ªæ–°çš„é¡µ32æ¥å­˜æ”¾é¡µ31å¯¹åº”çš„ç›®å½•é¡¹</li>
</ul>
<p>ç°åœ¨å› ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µä¸æ­¢ä¸€ä¸ªï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¦æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾ä¸€æ¡ç”¨æˆ·è®°å½•å¤§è‡´éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>ç¡®å®š<strong>ç›®å½•é¡¹è®°å½•é¡µ</strong></p>
<p>æˆ‘ä»¬ç°åœ¨çš„å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µæœ‰ä¸¤ä¸ªï¼Œå³é¡µ30å’Œé¡µ32ï¼Œåˆå› ä¸ºé¡µ30è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼çš„èŒƒå›´æ˜¯[1,320)ï¼Œé¡µ32è¡¨ç¤ºçš„ç›®å½•é¡¹çš„ä¸»é”®å€¼ä¸å°äº320ï¼Œæ‰€ä»¥ä¸»é”®å€¼ä¸º20çš„è®°å½•å¯¹åº”çš„ç›®å½•é¡¹è®°å½•åœ¨é¡µ30ä¸­ã€‚</p>
</li>
<li><p>é€šè¿‡ç›®å½•é¡¹è®°å½•é¡µç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µ</p>
<p>åœ¨ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µä¸­é€šè¿‡ä¸»é”®å€¼å®šä½ä¸€æ¡ç›®å½•é¡¹è®°å½•çš„æ–¹å¼</p>
</li>
<li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“è®°å½•</p>
</li>
</ol>
<p><strong>3.è¿­ä»£3æ¬¡ï¼šç›®å½•é¡¹è®°å½•é¡µçš„ç›®å½•é¡µ</strong></p>
<p>é—®é¢˜æ¥äº†ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢æ­¥éª¤çš„ç¬¬1æ­¥ä¸­æˆ‘ä»¬éœ€è¦å®šä½å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µï¼Œä½†æ˜¯<strong>è¿™äº›é¡µæ˜¯ä¸è¿ç»­çš„</strong>ï¼Œå¦‚æœæˆ‘ä»¬è¡¨ä¸­çš„æ•°æ®éå¸¸å¤šåˆ™ä¼š<strong>äº§ç”Ÿå¾ˆå¤šå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ</strong>ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µå‘¢?é‚£å°±ä¸ºè¿™äº›å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µå†ç”Ÿæˆä¸€ä¸ª<strong>æ›´é«˜çº§çš„ç›®å½•</strong>ï¼Œå°±åƒæ˜¯ä¸€ä¸ªå¤šçº§ç›®å½•ä¸€æ ·ï¼Œ<strong>å¤§ç›®å½•é‡ŒåµŒå¥—å°ç›®å½•</strong>ï¼Œå°ç›®å½•é‡Œæ‰æ˜¯å®é™…çš„æ•°æ®ï¼Œæ‰€ä»¥ç°åœ¨å„ä¸ªé¡µçš„ç¤ºæ„å›¾å°±æ˜¯è¿™æ ·å­:<img src="/2022/04/22/MySQL/1652626601115.png" alt="1652626601115" loading="lazy"></p>
<p>å¦‚å›¾ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªå­˜å‚¨æ›´é«˜çº§ç›®å½•é¡¹çš„<strong>é¡µ33</strong>ï¼Œè¿™ä¸ªé¡µä¸­çš„ä¸¤æ¡è®°å½•åˆ†åˆ«ä»£è¡¨é¡µ3oå’Œé¡µ32ï¼Œå¦‚æœç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼åœ¨**[1ï¼Œ320)<strong>ä¹‹é—´ï¼Œåˆ™åˆ°é¡µ30ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ï¼Œå¦‚æœä¸»é”®å€¼</strong>ä¸å°äº320**çš„è¯ï¼Œå°±åˆ°é¡µ32ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹è®°å½•ã€‚</p>
<p>éšç€è¡¨ä¸­è®°å½•çš„å¢åŠ ï¼Œè¿™ä¸ªç›®å½•çš„å±‚çº§ä¼šç»§ç»­å¢åŠ ï¼Œå¦‚æœç®€åŒ–ä¸€ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªå›¾æ¥æè¿°å®ƒ:<img src="/2022/04/22/MySQL/1652626823498.png" alt="1652626823498" loading="lazy"></p>
<p>è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒçš„åç§°æ˜¯B+æ ‘</p>
<p><strong>B+Tree</strong></p>
<p>ä¸è®ºæ˜¯å­˜æ”¾<strong>ç”¨æˆ·è®°å½•</strong>çš„æ•°æ®é¡µï¼Œè¿˜æ˜¯å­˜æ”¾<strong>ç›®å½•é¡¹è®°å½•</strong>çš„æ•°æ®é¡µï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒä»¬å­˜æ”¾åˆ°B+æ ‘è¿™ä¸ªæ•°æ®ç»“æ„ä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™äº›æ•°æ®é¡µä¸º<strong>èŠ‚ç‚¹</strong>ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„å®é™…ç”¨æˆ·è®°å½•å…¶å®éƒ½å­˜æ”¾åœ¨B+æ ‘çš„æœ€åº•å±‚çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿè¢«ç§°ä¸º<strong>å¶å­èŠ‚ç‚¹</strong>ï¼Œå…¶ä½™ç”¨æ¥å­˜æ”¾ç›®å½•é¡¹çš„èŠ‚ç‚¹ç§°ä¸º<strong>éå¶å­èŠ‚ç‚¹æˆ–è€…å†…èŠ‚ç‚¹</strong>ï¼Œå…¶ä¸­B+æ ‘æœ€ä¸Šè¾¹çš„é‚£ä¸ªèŠ‚ç‚¹ä¹Ÿç§°ä¸ºæ ¹èŠ‚ç‚¹ã€‚</p>
<p>ä¸€ä¸ªB+æ ‘çš„èŠ‚ç‚¹å…¶å®å¯ä»¥åˆ†æˆå¥½å¤šå±‚ï¼Œè§„å®šæœ€ä¸‹è¾¹çš„é‚£å±‚ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾æˆ‘ä»¬<strong>ç”¨æˆ·è®°å½•çš„é‚£å±‚ä¸ºç¬¬0å±‚</strong>ï¼Œä¹‹åä¾æ¬¡å¾€ä¸ŠåŠ ã€‚ä¹‹å‰æˆ‘ä»¬åšäº†ä¸€ä¸ªéå¸¸æç«¯çš„å‡è®¾:å­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µ<strong>æœ€å¤šå­˜æ”¾3æ¡è®°å½•</strong>ï¼Œå­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µ<strong>æœ€å¤šå­˜æ”¾4æ¡è®°å½•</strong>ã€‚å…¶å®çœŸå®ç¯å¢ƒä¸­ä¸€ä¸ªé¡µå­˜æ”¾çš„è®°å½•æ•°é‡æ˜¯éå¸¸å¤§çš„ï¼Œå‡è®¾æ‰€æœ‰å­˜æ”¾ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥<strong>å­˜æ”¾100æ¡ç”¨æˆ·è®°å½•</strong>ï¼Œæ‰€æœ‰å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥<strong>å­˜æ”¾1000æ¡ç›®å½•é¡¹è®°å½•</strong>ï¼Œé‚£ä¹ˆ:</p>
<ul>
<li>å¦‚æœB+æ ‘åªæœ‰1å±‚ï¼Œä¹Ÿå°±æ˜¯åªæœ‰1ä¸ªç”¨äºå­˜æ”¾ç”¨æˆ·è®°å½•çš„èŠ‚ç‚¹ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 100 æ¡è®°å½•ã€‚</li>
<li>å¦‚æœB+æ ‘æœ‰2å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾1000Ã—100=10,0000 æ¡è®°å½•ã€‚ </li>
<li>å¦‚æœB+æ ‘æœ‰3å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾ 1000Ã—1000Ã—100=1,0000,0000 æ¡è®°å½•ã€‚ </li>
<li>å¦‚æœB+æ ‘æœ‰4å±‚ï¼Œæœ€å¤šèƒ½å­˜æ”¾1000Ã—1000Ã—1000Ã—100=1000,0000,0000 æ¡è®°å½•ã€‚ç›¸å½“å¤šçš„è®° å½•ï¼ï¼ï¼ </li>
</ul>
<p>ä½ çš„è¡¨é‡Œèƒ½å­˜æ”¾ <strong>100000000000</strong> æ¡è®°å½•å—ï¼Ÿæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ ç”¨åˆ°çš„B+æ ‘<strong>éƒ½ä¸ä¼šè¶…è¿‡4å±‚</strong> ï¼Œé‚£æˆ‘ä»¬é€šè¿‡ä¸»é”®å€¼å»æŸ¥æ‰¾æŸæ¡è®°å½•æœ€å¤šåªéœ€è¦åš4ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾3ä¸ªç›®å½•é¡¹é¡µå’Œä¸€ä¸ªç”¨æˆ·è®°å½•é¡µï¼‰ï¼Œåˆå› ä¸ºåœ¨æ¯ä¸ªé¡µé¢å†…æœ‰æ‰€è°“çš„ <strong>Page Directory</strong> ï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨é¡µé¢å†…ä¹Ÿå¯ä»¥é€šè¿‡ <strong>äºŒåˆ†æ³•</strong> å®ç°å¿«é€Ÿå®šä½è®°å½•ã€‚ </p>
<h5 id="å¸¸è§çš„ç´¢å¼•æ¦‚å¿µ"><a href="#å¸¸è§çš„ç´¢å¼•æ¦‚å¿µ" class="headerlink" title="å¸¸è§çš„ç´¢å¼•æ¦‚å¿µ"></a>å¸¸è§çš„ç´¢å¼•æ¦‚å¿µ</h5><p>ç´¢å¼•æŒ‰ç…§ç‰©ç†å®ç°æ–¹å¼ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º2ç§ï¼šèšç°‡ç´¢å¼•ï¼ˆèšé›†ï¼‰å’Œéèšç°‡ï¼ˆéèšé›†ï¼‰ç´¢å¼•ã€‚æˆ‘ä»¬æŠŠéèšé›†ç´¢å¼•ç§°ä¸ºäºŒçº§ç´¢å¼•æˆ–è€…è¾…åŠ©ç´¢å¼•ã€‚</p>
<h6 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h6><p><strong>èšç°‡ç´¢å¼•</strong>å¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼ˆæ‰€æœ‰çš„ç”¨æˆ·è®°å½•å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•</strong></p>
<blockquote>
<p>æœ¯è¯­â€œèšç°‡â€è¡¨ç¤ºæ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼èšç°‡çš„å­˜å‚¨åœ¨ä¸€èµ·</p>
</blockquote>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><p>ä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼Œè¿™åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š </p>
<ul>
<li>é¡µå†… çš„è®°å½•æ˜¯æŒ‰ç…§ä¸»é”®çš„å¤§å°é¡ºåºæ’æˆä¸€ä¸ª å•å‘é“¾è¡¨ ã€‚ </li>
<li>å„ä¸ªå­˜æ”¾ ç”¨æˆ·è®°å½•çš„é¡µ ä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª åŒå‘é“¾è¡¨ ã€‚ </li>
<li>å­˜æ”¾ ç›®å½•é¡¹è®°å½•çš„é¡µ åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œåœ¨åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ª åŒå‘é“¾è¡¨ ã€‚ </li>
</ul>
</li>
<li><p>B+æ ‘çš„ <strong>å¶å­èŠ‚ç‚¹</strong> å­˜å‚¨çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚</p>
<p>æ‰€è°“å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ã€‚</p>
</li>
</ol>
<p>æˆ‘ä»¬æŠŠå…·æœ‰è¿™ä¸¤ç§ç‰¹æ€§çš„B+æ ‘ç§°ä¸º<strong>èšç°‡ç´¢å¼•</strong>ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨è¿™ä¸ª<strong>èšç°‡ç´¢å¼•</strong>çš„å¶å­èŠ‚ç‚¹ã€‚è¿™ç§èšç°‡ç´¢å¼•å¹¶ä¸éœ€è¦æˆ‘ä»¬åœ¨MySQLè¯­å¥ç§æ˜¾å¼çš„ä½¿ç”¨<strong>INDEX</strong>è¯­å¥å»åˆ›å»ºï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼š<strong>è‡ªåŠ¨</strong>ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼•ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®è®¿é—®æ›´å¿«</strong> ï¼Œå› ä¸ºèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB+æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿« </li>
<li>èšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„ <strong>æ’åºæŸ¥æ‰¾</strong> å’Œ <strong>èŒƒå›´æŸ¥æ‰¾</strong> é€Ÿåº¦éå¸¸å¿« </li>
<li>æŒ‰ç…§èšç°‡ç´¢å¼•æ’åˆ—é¡ºåºï¼ŒæŸ¥è¯¢æ˜¾ç¤ºä¸€å®šèŒƒå›´æ•°æ®çš„æ—¶å€™ï¼Œç”±äºæ•°æ®éƒ½æ˜¯ç´§å¯†ç›¸è¿ï¼Œæ•°æ®åº“ä¸ç”¨ä»å¤šä¸ªæ•°æ®å—ä¸­æå–æ•°æ®ï¼Œæ‰€ä»¥ <strong>èŠ‚çœäº†å¤§é‡çš„ioæ“ä½œ</strong> ã€‚ </li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåº ï¼ŒæŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå¦åˆ™å°†ä¼šå‡ºç°é¡µåˆ†è£‚ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª<strong>è‡ªå¢çš„IDåˆ—ä¸ºä¸»é”®</strong> </p>
<p><strong>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜</strong> ï¼Œå› ä¸ºå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ã€‚å› æ­¤ï¼Œå¯¹äºInnoDBè¡¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬å®šä¹‰<strong>ä¸»é”®ä¸ºä¸å¯æ›´æ–°</strong> </p>
<p><strong>é™åˆ¶ï¼š</strong></p>
<ul>
<li>å¯¹äºMySQLæ•°æ®åº“ç›®å‰åªæœ‰InnoDBæ•°æ®å¼•æ“æ”¯æŒèšç°‡ç´¢å¼•ï¼Œè€ŒMyIASMå¹¶ä¸æ”¯æŒèšç°‡ç´¢å¼•ã€‚</li>
<li>ç”±äºæ•°æ®ç‰©ç†å­˜å‚¨æ’åºæ–¹å¼åªèƒ½æœ‰ä¸€ç§ï¼Œæ‰€ä»¥MySQLçš„è¡¨<strong>åªæœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</strong>ã€‚ä¸€èˆ¬æ˜¯è¯¥è¡¨çš„ä¸»é”®</li>
<li>å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©<strong>éç©ºçš„å”¯ä¸€ç´¢å¼•</strong>ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnoDBä¼šéšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•</li>
<li>ä¸ºäº†å……åˆ†åˆ©ç”¨èšç°‡ç´¢å¼•çš„ç‰¹æ€§ï¼Œæ‰€ä»¥InnoDBè¡¨çš„ä¸»é”®åˆ—å°½é‡<strong>é€‰ç”¨æœ‰åºçš„é¡ºåºid</strong>ï¼Œè€Œä¸å»ºè®®ç”¨æ— åºçš„idï¼Œæ¯”å¦‚UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®æ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿</li>
</ul>
<h6 id="äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰"><a href="#äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰" class="headerlink" title="äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰"></a>äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼‰</h6><p>ä¸Šè¾¹ä»‹ç»çš„<strong>èšç°‡ç´¢å¼•</strong>åªèƒ½åœ¨æœç´¢æ¡ä»¶æ˜¯<strong>ä¸»é”®</strong>æ—¶æ‰å‘æŒ¥ä½œç”¨ï¼Œå› ä¸ºB+æ ‘ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®è¿›è¡Œæ’åºçš„ã€‚é‚£ä¹ˆå¦‚æœæƒ³ä»¥åˆ«çš„åˆ—ä½œä¸ºæœç´¢æ¡ä»¶è¯¥æ€ä¹ˆåŠï¼Ÿè‚¯å®šä¸èƒ½ä»å¤´åˆ°å°¾æ²¿ç€é“¾è¡¨ä¾æ¬¡éå†ä¸€é</p>
<p>ç­”æ¡ˆï¼šæˆ‘ä»¬å¯ä»¥<strong>å¤šå»ºå‡ é¢—B+æ ‘</strong>ï¼Œä¸åŒçš„B+æ ‘ä¸­çš„æ•°æ®é‡‡ç”¨ä¸åŒçš„æ’åºè§„åˆ™ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬ç”¨c2åˆ—çš„å¤§å°ä½œä¸ºæ•°æ®é¡µã€é¡µä¸­è®°å½•çš„æ’åºè§„åˆ™ï¼Œå†å»ºä¸€é¢—B+æ ‘ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652630395998.png" alt="1652630395998" loading="lazy"></p>
<p>è¿™ä¸ªB+æ ‘ä¸ä¸Šè¾¹ä»‹ç»çš„èšç°‡ç´¢å¼•æœ‰å‡ å¤„ä¸åŒï¼š</p>
<ul>
<li><p>ä½¿ç”¨è®°å½•c2åˆ—çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åºï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„å«ä¹‰ï¼š</p>
<ul>
<li>ä¸šå†…çš„è®°å½•æ˜¯æŒ‰ç…§c2åˆ—çš„å¤§å°é¡ºåºæ’åºæˆä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong></li>
<li>å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­è®°å½•çš„c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong></li>
<li>å­˜æ”¾<strong>ç›®å½•é¡¹è®°å½•çš„é¡µ</strong>åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œå†åŒä¸€å±‚æ¬¡ä¸­çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç›®å½•é¡¹è®°å½•çš„c2åˆ—å¤§å°æ’åºæ’æˆä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong></li>
</ul>
</li>
<li><p>B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å¹¶ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œåªæ˜¯<strong>c2åˆ—+ä¸»é”®</strong>è¿™ä¸¤ä¸ªåˆ—çš„å€¼</p>
</li>
<li><p>ç›®å½•é¡¹è®°å½•ä¸­ä¸å†æ˜¯<strong>ä¸»é”®+é¡µå·</strong>çš„æ­é…ï¼Œè€Œå˜æˆäº†<strong>c2åˆ—+é¡µå·</strong>çš„æ­é…</p>
</li>
</ul>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡c2åˆ—çš„å€¼æŸ¥æ‰¾æŸäº›è®°å½•çš„è¯å°±å¯ä»¥ä½¿ç”¨åˆšåˆšé”®å¥½çš„B+æ ‘ã€‚ä»¥æŸ¥æ‰¾c2åˆ—çš„å€¼ä¸º4çš„è®°å½•ä¸ºä¾‹ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>ç¡®å®š<strong>ç›®å½•é¡¹è®°å½•é¡µ</strong></p>
<p>æ ¹æ®<strong>æ ¹é¡µé¢</strong>ï¼Œä¹Ÿå°±æ˜¯é¡µ44ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®å½•é¡¹æ‰€åœ¨çš„é¡µä¸ºé¡µ42ï¼ˆ2&lt;4&lt;9ï¼‰ã€‚</p>
</li>
<li><p>é€šè¿‡<strong>ç›®å½•é¡¹è®°å½•é¡µ</strong>ç¡®å®šç”¨æˆ·è®°å½•çœŸå®æ‰€åœ¨çš„é¡µ</p>
<p>åœ¨é¡µ42ä¸­å¯ä»¥å¿«é€Ÿå®šä½åˆ°å®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µï¼Œä½†æ˜¯ç”±äºc2åˆ—å¹¶æ²¡æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥c2åˆ—å€¼ä¸º4çš„è®°å½•å¯èƒ½åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®é¡µä¸­ï¼Œåˆå› ä¸º<strong>2&lt; 4â‰¤4</strong>ï¼Œæ‰€ä»¥ç¡®å®šå®é™…å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µåœ¨é¡µ34å’Œé¡µ35ä¸­ã€‚</p>
</li>
<li><p>åœ¨çœŸå®å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p>
<p>åˆ°é¡µ34å’Œé¡µ35ä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•ã€‚</p>
</li>
<li><p>ä½†æ˜¯è¿™ä¸ªB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•åªå­˜å‚¨äº†c2å’Œc1ï¼ˆä¹Ÿå°±æ˜¯ä¸»é”®ï¼‰ä¸¤ä¸ªåˆ—ï¼Œæ‰€ä»¥å¿…é¡»å†æ¬¡æ ¹æ®ä¸»é”®å€¼å»èšç°‡ç´¢å¼•åœ¨æŸ¥æ‰¾ä¸€éå®Œæ•´çš„ç”¨æˆ·è®°å½•</p>
</li>
</ol>
<p><strong>æ¦‚å¿µï¼šå›è¡¨</strong></p>
<p>æˆ‘ä»¬æ ¹æ®è¿™ä¸ªä»¥c2åˆ—å¤§å°æ’åºçš„B+æ ‘åªèƒ½ç¡®å®šæˆ‘ä»¬è¦æŸ¥æ‰¾è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®c2åˆ—çš„å€¼æŸ¥æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¯ï¼Œä»ç„¶éœ€è¦åˆ°<strong>èšç°‡ç´¢å¼•</strong>ä¸­å†æŸ¥ä¸€éï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>å›è¡¨</strong>ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®c2åˆ—çš„å€¼æŸ¥è¯¢ä¸€æ¡å®Œæ•´çš„ç”¨æˆ·è®°å½•éœ€è¦ä½¿ç”¨åˆ°<strong>2</strong>æ£µB+æ ‘!</p>
<p><strong>é—®é¢˜ï¼š</strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸€æ¬¡å›è¡¨æ“ä½œï¼Ÿç›´æ¥æŠŠå®Œæ•´è®°å½•æ”¾è¿›å¶å­èŠ‚ç‚¹ä¸è¡Œå—ï¼Ÿ</p>
<p><strong>å›ç­”ï¼š</strong></p>
<p>å¦‚æœæŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°å¶å­èŠ‚ç‚¹æ˜¯å¯ä»¥ä¸ç”¨å›è¡¨ã€‚ä½†æ˜¯å¤ªå åœ°æ–¹äº†ï¼Œç›¸å½“äºæ¯å»ºç«‹ä¸€æ£µB+æ ‘éƒ½éœ€è¦æŠŠæ‰€æœ‰çš„ç”¨æˆ·è®°å½•å†éƒ½æ‹·è´ä¸€éï¼Œè¿™å°±æœ‰ç‚¹<strong>å¤ªæµªè´¹å­˜å‚¨ç©ºé—´</strong>äº†ã€‚</p>
<p>å› ä¸ºè¿™ç§æŒ‰ç…§<strong>éä¸»é”®åˆ—</strong>å»ºç«‹çš„B+æ ‘éœ€è¦ä¸€æ¬¡å›è¡¨æ“ä½œæ‰å¯ä»¥å®šä½åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥è¿™ç§B+æ ‘ä¹Ÿè¢«ç§°ä¸º<strong>äºŒçº§ç´¢å¼•</strong>(è‹±æ–‡åsecondary index )ï¼Œæˆ–è€…<strong>è¾…åŠ©ç´¢å¼•</strong>ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯c2åˆ—çš„å¤§å°ä½œä¸ºB+æ ‘çš„æ’åºè§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™ä¸ªB+æ ‘æ˜¯ä¸ºc2åˆ—å»ºç«‹çš„ç´¢å¼•ã€‚</p>
<p>éèšç°‡ç´¢å¼•çš„å­˜åœ¨ä¸å½±å“æ•°æ®åœ¨èšç°‡ç´¢å¼•ä¸­çš„ç»„ç»‡ï¼Œæ‰€ä»¥ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ã€‚<img src="/2022/04/22/MySQL/1652634143064.png" alt="1652634143064" loading="lazy"></p>
<p>å°ç»“ï¼šèšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•çš„åŸç†ä¸åŒï¼Œåœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€äº›åŒºåˆ«ï¼š</p>
<ul>
<li>èšç°‡ç´¢å¼•çš„<strong>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å°±æ˜¯æˆ‘ä»¬çš„æ•°æ®è®°å½•</strong>ï¼Œéèšç°‡ç´¢å¼•çš„<strong>å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æ•°æ®ä½ç½®</strong>ã€‚éèšç°‡ç´¢å¼•ä¸ä¼šå½±å“æ•°æ®è¡¨çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚</li>
<li>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ç§æ’åºå­˜å‚¨çš„æ–¹å¼ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç´¢å¼•ç›®å½•æä¾›æ•°æ®æ£€ç´¢</li>
<li>ä½¿ç”¨èšç°‡ç´¢å¼•çš„æ—¶å€™ï¼Œæ•°æ®çš„<strong>æŸ¥è¯¢æ•ˆç‡é«˜</strong>ï¼Œä½†å¦‚æœå¯¹æ•°æ®è¿›è¡Œæ’å…¥ï¼Œåˆ é™¤ï¼Œæ›´æ–°ç­‰æ“ä½œï¼Œæ•ˆç‡ä¼šæ¯”éèšç°‡ç´¢å¼•ä½</li>
</ul>
<h5 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h5><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æƒ³è®©B+æ ‘æŒ‰ç…§<strong>c2å’Œc3</strong>åˆ—çš„å¤§å°è¿›è¡Œæ’åºï¼Œè¿™ä¸ªåŒ…å«ä¸¤å±‚å«ä¹‰:</p>
<ul>
<li>å…ˆæŠŠå„ä¸ªè®°å½•å’Œé¡µæŒ‰ç…§c2åˆ—è¿›è¡Œæ’åº</li>
<li>åœ¨è®°å½•çš„c2åˆ—ç›¸åŒæƒ…å†µä¸‹ï¼Œé‡‡ç”¨c3åˆ—è¿›è¡Œæ’åº</li>
</ul>
<p>ä¸ºc2å’Œc3åˆ—å»ºç«‹çš„ç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652634751504.png" alt="1652634751504" loading="lazy"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>æ¯æ¡ç›®å½•é¡¹è®°å½•éƒ½ç”±c2ã€c3ã€é¡µå·è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå„æ¡è®°å½•å…ˆæŒ‰ç…§c2åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœè®°å½•çš„c2åˆ—ç›¸åŒï¼Œåˆ™æŒ‰ç…§c3åˆ—çš„å€¼è¿›è¡Œæ’åº</li>
<li>B+æ ‘å¶å­èŠ‚ç‚¹å¤„çš„ç”¨æˆ·è®°å½•ç”±c2ã€c3å’Œä¸»é”®c1åˆ—ç»„æˆ</li>
</ul>
<p>æ³¨æ„ä¸€ç‚¹ï¼Œä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹çš„B+æ ‘ç§°ä¸º<strong>è”åˆç´¢å¼•</strong>ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ã€‚ä»–çš„æ„æ€æ˜¯ä¸åˆ†åˆ«ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•çš„è¡¨è¿°ä¸åŒï¼Œä¸åŒç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å»ºç«‹è”åˆç´¢å¼•åªä¼šå»ºç«‹å¦‚ä¸Šå›¾ä¸€æ ·çš„B+æ ‘</li>
<li>ä¸ºc2å’Œc3åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•ä¼šåˆ†åˆ«ä»¥c2å’Œc3åˆ—å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹2æ£µB+æ ‘</li>
</ul>
<h6 id="InnoDBçš„B-æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"><a href="#InnoDBçš„B-æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"></a>InnoDBçš„B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</h6><p><strong>æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨çª</strong></p>
<p>æˆ‘ä»¬å‰è¾¹ä»‹ç»B+æ ‘ç´¢å¼•çš„æ—¶å€™ï¼Œä¸ºäº†å¤§å®¶ç†è§£ä¸Šçš„æ–¹ä¾¿ï¼Œå…ˆæŠŠå­˜å‚¨ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹éƒ½ç”»å‡ºæ¥ï¼Œç„¶åæ¥ç€ç”»å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ï¼Œå®é™…ä¸ŠB+æ ‘çš„å½¢æˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„:</p>
<ul>
<li>æ¯å½“ä¸ºæŸä¸ªè¡¨åˆ›å»ºä¸€ä¸ªB+æ ‘ç´¢å¼•(èšç°‡ç´¢å¼•ä¸æ˜¯äººä¸ºåˆ›å»ºçš„ï¼Œé»˜è®¤å°±æœ‰ï¼‰çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸ºè¿™ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ª<strong>æ ¹èŠ‚ç‚¹é¡µé¢</strong>ã€‚æœ€å¼€å§‹è¡¨ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ªB+æ ‘ç´¢å¼•å¯¹åº”çš„<strong>æ ¹èŠ‚ç‚¹</strong>ä¸­æ—¢æ²¡æœ‰ç”¨æˆ·è®°å½•ï¼Œä¹Ÿæ²¡æœ‰ç›®å½•é¡¹è®°å½•ã€‚</li>
<li>éšåå‘è¡¨ä¸­æ’å…¥ç”¨æˆ·è®°å½•ï¼Œå…ˆæŠŠç”¨æˆ·è®°å½•å­˜å‚¨åˆ°è¿™ä¸ª<strong>æ ¹èŠ‚ç‚¹</strong>ä¸­</li>
<li>å½“æ ¹èŠ‚ç‚¹ä¸­çš„<strong>å¯ç”¨ç©ºé—´ç”¨å®Œ</strong>æ—¶ç»§ç»­æ’å…¥è®°å½•ï¼Œæ­¤æ—¶ä¼šå°†æ ¹èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰è®°å½•å¤åˆ¶åˆ°ä¸€ä¸ªæ–°åˆ†é…çš„é¡µ<br>æ¯”å¦‚é¡µaä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªæ–°é¡µè¿›è¡Œ<strong>é¡µåˆ†è£‚</strong>çš„æ“ä½œï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ–°é¡µï¼Œæ¯”å¦‚é¡µbã€‚è¿™æ—¶æ–°æ’å…¥çš„è®°å½•æ ¹æ®é”®å€¼ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ä¸­çš„ä¸»é”®å€¼ï¼ŒäºŒçº§ç´¢å¼•ä¸­å¯¹åº”çš„ç´¢å¼•åˆ—çš„å€¼ï¼‰çš„å¤§å°å°±ä¼šè¢«åˆ†é…åˆ°é¡µaæˆ–è€…bä¸­ï¼Œè€Œ<strong>æ ¹èŠ‚ç‚¹</strong>ä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µã€‚</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹ç‰¹åˆ«æ³¨æ„çš„æ˜¯:ä¸€ä¸ªB+æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œä¾¿ä¸ä¼šå†ç§»åŠ¨ã€‚è¿™æ ·åªè¦æˆ‘ä»¬å¯¹æŸä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„æ ¹èŠ‚ç‚¹çš„é¡µå·ä¾¿ä¼šè¢«è®°å½•åˆ°æŸä¸ªåœ°æ–¹ï¼Œç„¶åå‡¡æ˜¯<strong>InnoDB</strong>å­˜å‚¨å¼•æ“éœ€è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•lçš„æ—¶å€™ï¼Œéƒ½ä¼šä»é‚£ä¸ªå›ºå®šçš„åœ°æ–¹å–å‡ºæ ¹èŠ‚ç‚¹çš„é¡µå·ï¼Œä»è€Œæ¥è®¿é—®è¿™ä¸ªç´¢å¼•ã€‚</p>
<p><strong>å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§</strong></p>
<p>æˆ‘ä»¬çŸ¥é“B+æ ‘ç´¢å¼•çš„å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹æ˜¯<strong>ç´¢å¼•åˆ—+é¡µå·</strong>çš„æ­é…ï¼Œä½†æ˜¯è¿™ä¸ªæ­é…å¯¹äºäºŒçº§ç´¢å¼•æ¥è¯´æœ‰ç‚¹ä¸ä¸¥è°¨ã€‚è¿˜æ‹¿index_demoè¡¨ä¸ºä¾‹<img src="/2022/04/22/MySQL/1652666059987.png" alt="1652666059987" loading="lazy"></p>
<p>å¦‚æœäºŒçº§ç´¢å¼•ä¸­ç›®å½•é¡¹è®°å½•çš„å†…å®¹åªæ˜¯<strong>ç´¢å¼•åˆ—+é¡µå·</strong>çš„æ­é…çš„è¯ï¼Œé‚£ä¹ˆä¸ºc2åˆ—å»ºç«‹ç´¢å¼•åçš„B+æ ‘åº”è¯¥æ˜¯ï¼š<img src="/2022/04/22/MySQL/1652666132342.png" alt="1652666132342" loading="lazy"></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³æ–°æ’å…¥ä¸€è¡Œè®°å½•ï¼Œå…¶ä¸­<strong>c1ã€c2ã€c3</strong>çš„å€¼åˆ†åˆ«æ˜¯:9ã€1ã€ â€˜câ€™ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹è¿™ä¸ªä¸ºc2åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•å¯¹åº”çš„B+æ ‘æ—¶ä¾¿ç¢°åˆ°äº†ä¸ªå¤§é—®é¢˜:ç”±äºé¡µ3ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±c2åˆ—ï¼‹é¡µå·çš„å€¼æ„æˆçš„ï¼Œé¡µ3ä¸­çš„ä¸¤æ¡ç›®å½•é¡¹è®°å½•å¯¹åº”çš„c2åˆ—çš„å€¼éƒ½æ˜¯1ï¼Œè€Œæˆ‘ä»¬æ–°æ’å…¥çš„è¿™æ¡è®°å½•çš„c2åˆ—çš„å€¼ä¹Ÿæ˜¯1ï¼Œé‚£æˆ‘ä»¬è¿™æ¡æ–°æ’å…¥çš„è®°å½•åˆ°åº•åº”è¯¥æ”¾åˆ°é¡µ4ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ”¾åˆ°é¡µ5ä¸­å•Š?ç­”æ¡ˆæ˜¯:å¯¹ä¸èµ·ï¼Œæ‡µäº†ã€‚</p>
<p>ä¸ºäº†è®©æ–°æ’å…¥è®°å½•èƒ½æ‰¾åˆ°è‡ªå·±åœ¨å“ªä¸ªé¡µé‡Œï¼Œæˆ‘ä»¬éœ€è¦<strong>ä¿è¯åœ¨B+æ ‘çš„åŒä¸€å±‚å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•é™¤äº†é¡µå·è¿™ä¸ªå­—æ®µä»¥å¤–æ˜¯å”¯ä¸€çš„</strong>ã€‚æ‰€ä»¥å¯¹äºäºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•çš„å†…å®¹å®é™…ä¸Šæ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼š</p>
<ul>
<li>ç´¢å¼•åˆ—çš„å€¼</li>
<li>ä¸»é”®å€¼</li>
<li>é¡µå·</li>
</ul>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æŠŠä¸»é”®å€¼ä¹Ÿæ·»åŠ åˆ°äºŒçº§ç´¢å¼•å†…èŠ‚ç‚¹ä¸­çš„ç›®å½•é¡¹è®°å½•ï¼Œè¿™æ ·å°±èƒ½ä¿è¯B+æ ‘æ¯ä¸€å±‚èŠ‚ç‚¹ä¸­å„æ¡ç›®å½•é¡¹è®°å½•é™¤é¡µå·è¿™ä¸ªå­—æ®µå¤–æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸ºc2åˆ—å»ºç«‹ç´¢å¼•åæ˜¯ï¼š<img src="/2022/04/22/MySQL/1652666508855.png" alt="1652666508855" loading="lazy"></p>
<p>è¿™æ ·æˆ‘ä»¬å†æ’å…¥è®°å½•**(9ï¼Œ1ï¼Œ â€˜câ€™)<strong>æ—¶ï¼Œç”±äºé¡µ3ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±</strong>c2åˆ—ï¼‹ä¸»é”®ï¼‹é¡µå·<strong>çš„å€¼æ„æˆçš„ï¼Œå¯ä»¥å…ˆæŠŠæ–°è®°å½•çš„c2åˆ—çš„å€¼å’Œé¡µ3ä¸­å„ç›®å½•é¡¹è®°å½•çš„c2åˆ—çš„å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœc2åˆ—çš„å€¼ç›¸åŒçš„è¯ï¼Œå¯ä»¥æ¥ç€æ¯”è¾ƒä¸»é”®å€¼ï¼Œå› ä¸ºB+æ ‘åŒä¸€å±‚ä¸­ä¸åŒç›®å½•é¡¹è®°å½•çš„</strong>c2åˆ—ï¼‹ä¸»é”®**çš„å€¼è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€åè‚¯å®šèƒ½å®šä½å”¯ä¸€çš„ä¸€æ¡ç›®å½•é¡¹è®°å½•ï¼Œåœ¨æœ¬ä¾‹ä¸­æœ€åç¡®å®šæ–°è®°å½•åº”è¯¥è¢«æ’å…¥åˆ°é¡µ5ä¸­ã€‚</p>
<p><strong>ä¸€ä¸ªé¡µé¢æœ€å°‘å­˜å‚¨2æ¡è®°å½•</strong></p>
<p>ä¸€ä¸ªB+æ ‘åªéœ€è¦å¾ˆå°‘çš„å±‚çº§å°±å¯ä»¥è½»æ¾å­˜å‚¨æ•°äº¿æ¡è®°å½•ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç›¸å½“ä¸é”™! è¿™æ˜¯å› ä¸ºB+æ ‘æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¤§çš„å¤šå±‚çº§ç›®å½•ï¼Œæ¯ç»è¿‡ä¸€ä¸ªç›®å½•æ—¶éƒ½ä¼šè¿‡æ»¤æ‰è®¸å¤šæ— æ•ˆçš„å­ç›®å½•ï¼Œç›´åˆ°æœ€åè®¿é—®åˆ°å­˜å‚¨çœŸå®æ•°æ®çš„ç›®å½•ã€‚é‚£å¦‚æœä¸€ä¸ªå¤§çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€ä¸ªå­ç›®å½•æ˜¯ä¸ªå•¥æ•ˆæœå‘¢?é‚£å°±æ˜¯ç›®å½•å±‚çº§éå¸¸éå¸¸éå¸¸å¤šï¼Œè€Œä¸”æœ€åçš„é‚£ä¸ªå­˜æ”¾çœŸå®æ•°æ®çš„ç›®å½•ä¸­åªèƒ½å­˜æ”¾ä¸€æ¡è®°å½•ã€‚è´¹äº†åŠå¤©åŠ²åªèƒ½å­˜æ”¾ä¸€æ¡çœŸå®çš„ç”¨æˆ·è®°å½•?æ‰€ä»¥<strong>InnoDBçš„ä¸€ä¸ªæ•°æ®é¡µè‡³å°‘å¯ä»¥å­˜æ”¾ä¸¤æ¡è®°å½•ã€‚</strong></p>
<h4 id="MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"><a href="#MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ" class="headerlink" title="MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ"></a>MyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆ</h4><p><strong>Bæ ‘ç´¢å¼•é€‚ç”¨å­˜å‚¨å¼•æ“å¦‚è¡¨æ‰€ç¤ºï¼š</strong><img src="/2022/04/22/MySQL/1652666747479.png" alt="1652666747479" loading="lazy"></p>
<p>å³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“æ”¯æŒåŒä¸€ç§ç±»å‹çš„ç´¢å¼•ï¼Œä½†æ˜¯ä»–ä»¬çš„å®ç°åŸç†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚Innodbå’ŒMylSAMé»˜è®¤çš„ç´¢å¼•æ˜¯Btreeç´¢å¼•;è€ŒMemoryé»˜è®¤çš„ç´¢å¼•æ˜¯Hashç´¢å¼•ã€‚</p>
<p>MylSAMå¼•æ“ä½¿ç”¨<strong>B+Tree</strong>ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯<strong>æ•°æ®è®°å½•çš„åœ°å€ã€‚</strong></p>
<h6 id="MyISAMç´¢å¼•çš„åŸç†"><a href="#MyISAMç´¢å¼•çš„åŸç†" class="headerlink" title="MyISAMç´¢å¼•çš„åŸç†"></a>MyISAMç´¢å¼•çš„åŸç†</h6><p>ä¸‹å›¾æ˜¯MyISAMç´¢å¼•çš„åŸç†å›¾</p>
<p>æˆ‘ä»¬çŸ¥é“<strong>InnoDBä¸­ç´¢å¼•å³æ•°æ®</strong>ï¼Œä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•çš„é‚£æ£µB+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­å·²ç»æŠŠæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½åŒ…å«äº†ï¼Œè€Œ<strong>MyISAM</strong>çš„ç´¢å¼•æ–¹æ¡ˆè™½ç„¶ä¹Ÿä½¿ç”¨æ ‘å½¢ç»“æ„ï¼Œä½†æ˜¯å´<strong>å°†ç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜å‚¨:</strong></p>
<ul>
<li>å°†è¡¨ä¸­çš„è®°å½•<strong>æŒ‰ç…§è®°å½•çš„æ’å…¥é¡ºåº</strong>å•ç‹¬å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç§°ä¹‹ä¸º<strong>æ•°æ®æ–‡ä»¶</strong>ã€‚è¿™ä¸ªæ–‡ä»¶å¹¶ä¸åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ•°æ®é¡µï¼Œæœ‰å¤šå°‘è®°å½•å°±å¾€è¿™ä¸ªæ–‡ä»¶ä¸­å¡å¤šå°‘è®°å½•å°±æˆäº†ã€‚ç”±äºåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™å¹¶<strong>æ²¡æœ‰åˆ»æ„æŒ‰ç…§ä¸»é”®å¤§å°æ’åº</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™äº›æ•°æ®ä¸Šä½¿ç”¨äºŒåˆ†æ³•è¿›è¡ŒæŸ¥æ‰¾ã€‚</li>
<li>ä½¿ç”¨<strong>MyISAM</strong>å­˜å‚¨å¼•æ“çš„è¡¨ä¼šæŠŠç´¢å¼•ä¿¡æ¯å¦å¤–å­˜å‚¨åˆ°ä¸€ä¸ªç§°ä¸º<strong>ç´¢å¼•æ–‡ä»¶</strong>çš„å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚<strong>MyISAM</strong>ä¼šå•ç‹¬ä¸ºè¡¨çš„ä¸»é”®åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåªä¸è¿‡åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œæ˜¯<strong>ä¸»é”®å€¼ï¼‹æ•°æ®è®°å½•åœ°å€</strong>çš„ç»„åˆã€‚</li>
</ul>
<p><img src="/2022/04/22/MySQL/1652667131942.png" alt="1652667131942" loading="lazy"></p>
<p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥col1ä¸ºä¸»é”®ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•(Primary key)ç¤ºæ„å¯ä»¥çœ‹å‡º<strong>MylISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€</strong>ã€‚åœ¨MylSAMä¸­ï¼Œä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•(Secondary key)åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»é”®ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€ŒäºŒçº§ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚å¦‚æœæˆ‘ä»¬åœ¨col2ä¸Šå»ºç«‹ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652667421274.png" alt="1652667421274" loading="lazy"></p>
<p>åŒæ ·ä¹Ÿæ˜¯ä¸€æ£µB+Tree,dataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸º:é¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p>
<h6 id="MyISAMä¸InnoDbå¯¹æ¯”"><a href="#MyISAMä¸InnoDbå¯¹æ¯”" class="headerlink" title="MyISAMä¸InnoDbå¯¹æ¯”"></a>MyISAMä¸InnoDbå¯¹æ¯”</h6><p><strong>MyISAMçš„ç´¢å¼•æ–¹å¼éƒ½æ˜¯â€éèšç°‡â€œçš„ï¼Œä¸InnoDBåŒ…å«ä¸€ä¸ªèšç°‡ç´¢å¼•ä¸åŒï¼Œå°ç»“ä¸¤ç§å¼•æ“ä¸­ç´¢å¼•çš„åŒºåˆ«ï¼š</strong></p>
<p>1.åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹<strong>èšç°‡ç´¢å¼•</strong>è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨MyISAM:å´éœ€è¦æ ¹æ®å¶å­èŠ‚ç‚¹çš„æ•°æ®åœ°å€å»è·å–æ•°æ®è®°å½•ã€‚</p>
<p> 2.InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯<strong>åˆ†ç¦»çš„</strong>ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚</p>
<p>3.InnoDBçš„éèšç°‡ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•<strong>ä¸»é”®çš„å€¼</strong>ï¼Œè€ŒMyISAMç´¢å¼•è®°å½•çš„æ˜¯<strong>åœ°å€</strong>ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚</p>
<p>4.MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†å¿«é€Ÿçš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚</p>
<p><strong>å°ç»“ï¼š</strong></p>
<p>äº†è§£ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ã€‚æ¯”å¦‚:</p>
<p>ä¸¾ä¾‹1:çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½<strong>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®</strong>ï¼Œå› ä¸ºæ‰€æœ‰äºŒçº§ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»é”®ç´¢å¼•ä¼šä»¤äºŒçº§ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚</p>
<p>ä¸¾ä¾‹2:ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€æ£µB+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œæ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚<img src="/2022/04/22/MySQL/1652668413960.png" alt="1652668413960" loading="lazy"></p>
<h4 id="ç´¢å¼•çš„ä»£ä»·"><a href="#ç´¢å¼•çš„ä»£ä»·" class="headerlink" title="ç´¢å¼•çš„ä»£ä»·"></a>ç´¢å¼•çš„ä»£ä»·</h4><p>ç´¢å¼•æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œä½†ä¸èƒ½ä¹±å»ºï¼Œå®ƒåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½ä¼šæœ‰æ¶ˆè€—ï¼š</p>
<ul>
<li><p><strong>ç©ºé—´ä¸Šçš„ä»£ä»·</strong></p>
<p>æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½è¦ä¸ºå®ƒå»ºç«‹ä¸€æ£µB+æ ‘ï¼Œæ¯ä¸€æ£µB+æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼Œä¸€ä¸ªé¡µé»˜è®¤ä¼šå ç”¨16KBçš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ£µå¾ˆå¤§çš„B+æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆï¼Œé‚£å°±æ˜¯å¾ˆå¤§çš„ä¸€ç‰‡å­˜å‚¨ç©ºé—´ã€‚</p>
</li>
<li><p>æ—¶é—´ä¸Šçš„ä»£ä»·</p>
<p>æ¯æ¬¡å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œ<strong>å¢ã€åˆ ã€æ”¹æ“ä½œ</strong>æ—¶ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹å„ä¸ªB+æ ‘ç´¢å¼•ã€‚è€Œä¸”æˆ‘ä»¬è®²è¿‡ï¼ŒB+æ ‘æ¯å±‚èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼<strong>ä»å°åˆ°å¤§çš„é¡ºåº</strong>æ’åºè€Œç»„æˆäº†<strong>åŒå‘é“¾è¡¨</strong>ã€‚ä¸è®ºæ˜¯å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ï¼Œè¿˜æ˜¯å†…èŠ‚ç‚¹ä¸­çš„è®°å½•(ä¹Ÿå°±æ˜¯ä¸è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼‰éƒ½æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºè€Œå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚è€Œå¢ã€åˆ ã€æ”¹æ“ä½œå¯èƒ½ä¼šå¯¹èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºé€ æˆç ´åï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“éœ€è¦é¢å¤–çš„æ—¶é—´è¿›è¡Œä¸€äº›<strong>è®°å½•ç§»ä½</strong><br><strong>é¡µé¢åˆ†è£‚ã€é¡µé¢å›æ”¶</strong>ç­‰æ“ä½œæ¥ç»´æŠ¤å¥½èŠ‚ç‚¹å’Œè®°å½•çš„æ’åºã€‚å¦‚æœæˆ‘ä»¬å»ºäº†è®¸å¤šç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•å¯¹åº”çš„B+æ ‘éƒ½è¦è¿›è¡Œç›¸å…³çš„ç»´æŠ¤æ“ä½œï¼Œä¼šç»™æ€§èƒ½æ‹–åè…¿ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¸€ä¸ªè¡¨ä¸Šç´¢å¼•é”®çš„è¶Šå¤šï¼Œå°±ä¼šå ç”¨è¶Šå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å¢åˆ æ”¹è®°å½•çš„æ—¶å€™æ€§èƒ½å°±è¶Šå·®ã€‚ä¸ºäº†èƒ½å»ºç«‹åˆå¥½åˆå°‘çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¾—å­¦ä¼šè¿™äº›ç´¢å¼•åœ¨å“ªäº›æ¡ä»¶ä¸‹èµ·ä½œç”¨</p>
</blockquote>
<h4 id="MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§"><a href="#MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§" class="headerlink" title="MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§"></a>MySQLæ•°æ®ç»“æ„é€‰æ‹©çš„åˆç†æ€§</h4><p>ä»MySQLçš„è§’åº¦è®²ï¼Œä¸å¾—ä¸è€ƒè™‘ä¸€ä¸ªç°å®é—®é¢˜å°±æ˜¯ç£ç›˜loã€‚å¦‚æœæˆ‘ä»¬èƒ½è®©ç´¢å¼•çš„æ•°æ®ç»“æ„å°½é‡å‡å°‘ç¡¬ç›˜çš„IOæ“ä½œï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šå°ã€‚å¯ä»¥è¯´ï¼Œ<strong>ç£ç›˜çš„I/Oæ“ä½œæ¬¡æ•°</strong>å¯¹ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡è‡³å…³é‡è¦ã€‚</p>
<p>æŸ¥æ‰¾éƒ½æ˜¯ç´¢å¼•æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ç´¢å¼•éå¸¸å¤§ï¼Œå°¤å…¶æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œå½“æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œç´¢å¼•çš„å¤§å°æœ‰å¯èƒ½å‡ ä¸ªGç”šè‡³æ›´å¤šï¼Œä¸ºäº†å‡å°‘ç´¢å¼•åœ¨å†…å­˜çš„å ç”¨ï¼Œ<strong>æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜</strong>ä¸Šçš„ã€‚å½“æˆ‘ä»¬åˆ©ç”¨ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¸å¯èƒ½æŠŠæ•´ä¸ªç´¢å¼•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œåªèƒ½é€ä¸€åŠ è½½ï¼Œé‚£ä¹ˆ<strong>MysQLè¡¡é‡æŸ¥è¯¢æ•ˆç‡çš„æ ‡å‡†å°±æ˜¯ç£ç›˜loæ¬¡æ•°ã€‚</strong></p>
<h5 id="å…¨è¡¨éå†"><a href="#å…¨è¡¨éå†" class="headerlink" title="å…¨è¡¨éå†"></a>å…¨è¡¨éå†</h5><p>æ˜¾è€Œæ˜“è§ï¼Œæ•ˆç‡éå¸¸å·®</p>
<h5 id="Hashç´¢å¼•"><a href="#Hashç´¢å¼•" class="headerlink" title="Hashç´¢å¼•"></a>Hashç´¢å¼•</h5><p>Hashæœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆè¢«ç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤§å¹…æå‡æ£€ç´¢æ•°æ®çš„æ•ˆç‡ã€‚</p>
<p>Hashç®—æ³•æ˜¯é€šè¿‡æŸç§ç¡®å®šæ€§çš„ç®—æ³•(æ¯”å¦‚MD5ã€SHA1ã€SHA2ã€SHA3ï¼‰å°†è¾“å…¥è½¬å˜ä¸ºè¾“å‡ºã€‚<strong>ç›¸åŒçš„è¾“å…¥æ°¸è¿œå¯ä»¥å¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œ</strong>å‡è®¾è¾“å…¥å†…å®¹æœ‰å¾®å°åå·®ï¼Œåœ¨è¾“å‡ºä¸­é€šå¸¸ä¼šæœ‰ä¸åŒçš„ç»“æœã€‚</p>
<p>ä¸¾ä¾‹:å¦‚æœä½ æƒ³è¦éªŒè¯ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦æŠŠä¸¤ä»½æ–‡ä»¶ç›´æ¥æ‹¿æ¥æ¯”å¯¹ï¼Œåªéœ€è¦è®©å¯¹æ–¹æŠŠHash å‡½æ•°è®¡ç®—å¾—åˆ°çš„ç»“æœå‘Šè¯‰ä½ å³å¯ï¼Œç„¶ååœ¨æœ¬åœ°åŒæ ·å¯¹æ–‡ä»¶è¿›è¡ŒHashå‡½æ•°çš„è¿ç®—ï¼Œæœ€åé€šè¿‡æ¯”è¾ƒè¿™ä¸¤ä¸ªHash å‡½æ•°çš„ç»“æœæ˜¯å¦ç›¸åŒï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒã€‚</p>
<p><strong>åŠ é€ŸæŸ¥æ‰¾é€Ÿåº¦çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„æœ‰ä¸¤ç±»</strong>:</p>
<ul>
<li>æ ‘ï¼Œä¾‹å¦‚å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log2N)</li>
<li>å“ˆå¸Œï¼Œä¾‹å¦‚HashMapï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)<img src="/2022/04/22/MySQL/1652670533312.png" alt="1652670533312" loading="lazy"></li>
</ul>
<p>é‡‡ç”¨Hashè¿›è¡Œæ£€ç´¢æ•ˆç‡éå¸¸é«˜ï¼ŒåŸºæœ¬ä¸Šä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥æ‰¾åˆ°æ•°æ®ï¼Œè€ŒB+æ ‘éœ€è¦è‡ªé¡¶å‘ä¸‹ä¾æ¬¡æŸ¥æ‰¾å¤šæ¬¡è®¿é—®èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°æ•°æ®ï¼Œä¸­é—´éœ€è¦å¤šæ¬¡Ioæ“ä½œï¼Œ<strong>ä»æ•ˆç‡æ¥è¯´ Hashæ¯” B+æ ‘æ›´å¿«ã€‚</strong></p>
<p>åœ¨å“ˆå¸Œçš„æ–¹å¼ä¸‹ï¼Œä¸€ä¸ªå…ƒç´ kå¤„äºh(k)ä¸­ï¼Œå³åˆ©ç”¨å“ˆå¸Œå‡½æ•°hï¼Œæ ¹æ®å…³é”®å­—kè®¡ç®—å‡ºæ§½çš„ä½ç½®ã€‚å‡½æ•°hå°†å…³é”®å­—åŸŸæ˜ å°„åˆ°å“ˆå¸Œè¡¨T[oâ€¦m-1]çš„æ§½ä½ä¸Šã€‚<img src="/2022/04/22/MySQL/1652670685945.png" alt="1652670685945" loading="lazy"></p>
<p>ä¸Šå›¾ä¸­å“ˆå¸Œå‡½æ•°hæœ‰å¯èƒ½å°†ä¸¤ä¸ªä¸åŒçš„å…³é”®å­—æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¿™å«åš<strong>ç¢°æ’</strong>ï¼Œåœ¨æ•°æ®åº“ä¸­ä¸€èˆ¬é‡‡ç”¨<strong>é“¾æ¥æ³•</strong>æ¥è§£å†³ã€‚åœ¨é“¾æ¥æ³•ä¸­ï¼Œå°†æ•£åˆ—åˆ°åŒä¸€æ§½ä½çš„å…ƒç´ æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652670738442.png" alt="1652670738442" loading="lazy"></p>
<p>å®éªŒï¼šä½“ä¼šæ•°ç»„å’Œhashè¡¨æŸ¥æ‰¾æ–¹é¢çš„æ•ˆç‡åŒºåˆ«</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®—æ³•å¤æ‚åº¦ä¸º O(n) </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123; </span><br><span class="line">    <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100000</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; arr.length;i++)&#123;</span><br><span class="line">        arr[i] = i + <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;=<span class="number">100000</span>;j++)&#123; </span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> j;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; arr.length;i++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(temp == arr[i])&#123; </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis(); 			System.out.println(<span class="string">&quot;timeï¼š &quot;</span> + (end - start)); 	  <span class="comment">//timeï¼š 823 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®—æ³•å¤æ‚åº¦ä¸º O(1) </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(<span class="number">100000</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">100000</span>;i++)&#123; </span><br><span class="line">        set.add(i + <span class="number">1</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;=<span class="number">100000</span>;j++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> j; </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contains</span> <span class="operator">=</span> set.contains(temp); 		&#125;</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis(); 			System.out.println(<span class="string">&quot;timeï¼š &quot;</span> + (end - start)); 	  <span class="comment">//timeï¼š 5 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Hashç»“æ„æ•ˆç‡é«˜ï¼Œä¸ºä»€ä¹ˆç´¢å¼•ç»“æ„è¦è®¾è®¡æˆæ ‘å‹ï¼Ÿ</strong></p>
<p>åŸå› 1: Hashç´¢å¼•ä»…èƒ½æ»¡è¶³(=)(â—‡)å’ŒINæŸ¥è¯¢ã€‚å¦‚æœè¿›è¡Œ<strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼Œå“ˆå¸Œå‹çš„ç´¢å¼•ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸ºo(n);è€Œæ ‘å‹çš„â€œæœ‰åºâ€â€ç‰¹æ€§ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒo(log2N)çš„é«˜æ•ˆç‡ã€‚</p>
<p>åŸå› 2: Hashç´¢å¼•è¿˜æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œæ•°æ®çš„å­˜å‚¨<strong>æ˜¯æ²¡æœ‰é¡ºåºçš„</strong>ï¼Œåœ¨ORDER BYçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨Hashç´¢å¼•è¿˜éœ€è¦å¯¹æ•°æ®é‡æ–°æ’åºã€‚</p>
<p>åŸå› 3âˆ¶å¯¹äºè”åˆç´¢å¼•çš„æƒ…å†µï¼ŒHashå€¼æ˜¯å°†è”åˆç´¢å¼•é”®åˆå¹¶åä¸€èµ·æ¥è®¡ç®—çš„ï¼Œæ— æ³•å¯¹å•ç‹¬çš„ä¸€ä¸ªé”®æˆ–è€…å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>åŸå› 4:å¯¹äºç­‰å€¼æŸ¥è¯¢æ¥è¯´ï¼Œé€šå¸¸Hashç´¢å¼•çš„æ•ˆç‡æ›´é«˜ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯<strong>ç´¢å¼•åˆ—çš„é‡å¤å€¼å¦‚æœå¾ˆå¤š</strong>ï¼Œ<strong>æ•ˆç‡å°±ä¼šé™ä½</strong>ã€‚è¿™æ˜¯å› ä¸ºé‡åˆ°Hash å†²çªæ—¶ï¼Œéœ€è¦éå†æ¡¶ä¸­çš„è¡ŒæŒ‡é’ˆæ¥è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾åˆ°æŸ¥è¯¢çš„å…³é”®å­—ï¼Œéå¸¸è€—æ—¶ã€‚æ‰€ä»¥ï¼Œ Hashç´¢å¼•é€šå¸¸ä¸ä¼šç”¨åˆ°é‡å¤å€¼å¤šçš„åˆ—ä¸Šï¼Œæ¯”å¦‚åˆ—ä¸ºæ€§åˆ«ã€å¹´é¾„çš„æƒ…å†µç­‰ã€‚</p>
<p><strong>Hashé€‚ç”¨å­˜å‚¨å¼•æ“å¦‚è¡¨æ‰€ç¤ºï¼š</strong><img src="/2022/04/22/MySQL/1652671186210.png" alt="1652671186210" loading="lazy"></p>
<p><strong>Hashç´¢å¼•çš„é€‚ç”¨æ€§ï¼š</strong></p>
<p>Hashç´¢å¼•å­˜åœ¨ç€å¾ˆå¤šé™åˆ¶ï¼Œç›¸æ¯”ä¹‹ä¸‹åœ¨æ•°æ®åº“ä¸­B+æ ‘ç´¢å¼•çš„ä½¿ç”¨é¢ä¼šæ›´å¹¿ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›åœºæ™¯é‡‡ç”¨Hashç´¢å¼•æ•ˆç‡æ›´é«˜ï¼Œæ¯”å¦‚åœ¨é”®å€¼å‹ï¼ˆ(Key-valueï¼‰æ•°æ®åº“ä¸­,<strong>Rediså­˜å‚¨çš„æ ¸å¿ƒå°±æ˜¯Hashè¡¨ã€‚</strong></p>
<p>MysQLä¸­çš„Memoryå­˜å‚¨å¼•æ“æ”¯æŒHashå­˜å‚¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸ¥è¯¢çš„ä¸´æ—¶è¡¨æ—¶ï¼Œå°±å¯ä»¥é€‰æ‹©Memoryå­˜å‚¨å¼•æ“ï¼ŒæŠŠæŸä¸ªå­—æ®µè®¾ç½®ä¸ºHashç´¢å¼•ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œè¿›è¡ŒHashè®¡ç®—ä¹‹åé•¿åº¦å¯ä»¥ç¼©çŸ­åˆ°å‡ ä¸ªå­—èŠ‚ã€‚å½“å­—æ®µçš„é‡å¤åº¦ä½ï¼Œè€Œä¸”ç»å¸¸éœ€è¦è¿›è¡Œ<strong>ç­‰å€¼æŸ¥è¯¢</strong>çš„æ—¶å€™ï¼Œé‡‡ç”¨Hashç´¢å¼•æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å¦å¤–ï¼ŒInnoDBæœ¬èº«ä¸æ”¯æŒ Hashç´¢å¼•ï¼Œä½†æ˜¯<strong>æä¾›è‡ªé€‚åº”Hashç´¢å¼•</strong>(Adaptive Hash Index)ã€‚ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨è‡ªé€‚åº”Hashç´¢å¼•å‘¢?å¦‚æœæŸä¸ªæ•°æ®ç»å¸¸è¢«è®¿é—®ï¼Œå½“æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šå°†è¿™ä¸ªæ•°æ®é¡µçš„åœ°å€å­˜æ”¾åˆ°Hashè¡¨ä¸­ã€‚è¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æ‰¾åˆ°è¿™ä¸ªé¡µé¢çš„æ‰€åœ¨ä½ç½®ã€‚è¿™æ ·è®©B+æ ‘ä¹Ÿå…·å¤‡äº†Hash ç´¢å¼•çš„ä¼˜ç‚¹ã€‚<img src="/2022/04/22/MySQL/1652671531627.png" alt="1652671531627" loading="lazy"></p>
<p>é‡‡ç”¨è‡ªé€‚åº” Hash ç´¢å¼•ç›®çš„æ˜¯æ–¹ä¾¿æ ¹æ® SQL çš„æŸ¥è¯¢æ¡ä»¶åŠ é€Ÿå®šä½åˆ°å¶å­èŠ‚ç‚¹ï¼Œç‰¹åˆ«æ˜¯å½“ B+ æ ‘æ¯”è¾ƒæ·±çš„æ—¶å€™ï¼Œé€šè¿‡è‡ªé€‚åº” Hash ç´¢å¼•å¯ä»¥æ˜æ˜¾æé«˜æ•°æ®çš„æ£€ç´¢æ•ˆç‡ã€‚ </p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>innodb_adaptive_hash_index</strong> å˜é‡æ¥æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†è‡ªé€‚åº” Hashï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%adaptive_hash_index&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652671628560.png" alt="1652671628560" loading="lazy"></p>
<h5 id="äºŒå‰æœç´¢æ ‘"><a href="#äºŒå‰æœç´¢æ ‘" class="headerlink" title="äºŒå‰æœç´¢æ ‘"></a>äºŒå‰æœç´¢æ ‘</h5><p>å¦‚æœæˆ‘ä»¬åˆ©ç”¨äºŒå‰æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œé‚£ä¹ˆç£ç›˜çš„IOæ¬¡æ•°å’Œç´¢å¼•æ ‘çš„é«˜åº¦æ˜¯ç›¸å…³çš„ã€‚ </p>
<p><strong>äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹</strong></p>
<ul>
<li>ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„åº¦ä¸è¶…è¿‡2</li>
<li>å·¦å­èŠ‚ç‚¹&lt;æœ¬èŠ‚ç‚¹ï¼›å³å­èŠ‚ç‚¹&gt;=æœ¬èŠ‚ç‚¹ï¼Œæ¯”æˆ‘å¤§çš„å‘å³ï¼Œæ¯”æˆ‘å°çš„å‘å·¦</li>
</ul>
<p><strong>æŸ¥æ‰¾è§„åˆ™</strong></p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€åŸºç¡€çš„äºŒå‰æœç´¢æ ‘(Binary Search Tree)ï¼Œæœç´¢æŸä¸ªèŠ‚ç‚¹å’Œæ’å…¥èŠ‚ç‚¹çš„è§„åˆ™ä¸€æ ·ï¼Œæˆ‘ä»¬å‡è®¾æœç´¢æ’å…¥çš„æ•°å€¼ä¸ºkey:</p>
<ol>
<li>å¦‚æœkeyå¤§äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å³å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾;</li>
<li>å¦‚æœkeyå°äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™åœ¨å·¦å­æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾;</li>
<li>å¦‚æœkeyç­‰äºæ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›æ ¹èŠ‚ç‚¹å³å¯ã€‚</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯¹æ•°åˆ—(34ï¼Œ22ï¼Œ89ï¼Œ5ï¼Œ23ï¼Œ77ï¼Œ91ï¼‰åˆ›é€ å‡ºæ¥çš„äºŒåˆ†æŸ¥æ‰¾æ ‘å¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652671861644.png" alt="1652671861644" loading="lazy"></p>
<p>ä½†æ˜¯å­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯æœ‰æ—¶å€™äºŒå‰æ ‘çš„æ·±åº¦éå¸¸å¤§ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»™å‡ºçš„æ•°æ®é¡ºåºæ˜¯ï¼ˆ5ï¼Œ22ï¼Œ23ï¼Œ34ï¼Œ77ï¼Œ89ï¼Œ91ï¼‰åˆ›é€ å‡ºæ¥çš„äºŒåˆ†æŸ¥æ‰¾æ ‘å¦‚å›¾æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1652684705791.png" alt="1652684705791" loading="lazy"></p>
<p>ä¸Šé¢ç¬¬äºŒæ£µæ ‘ä¹Ÿå±äºäºŒåˆ†æŸ¥æ‰¾æ ‘ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šå·²ç»é€€åŒ–æˆäº†ä¸€æ¡é“¾è¡¨ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å˜æˆ**o(n)**ã€‚ä½ èƒ½çœ‹å‡ºæ¥ç¬¬ä¸€ä¸ªæ ‘çš„æ·±åº¦æ˜¯3ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šåªéœ€3æ¬¡æ¯”è¾ƒï¼Œå°±å¯ä»¥æ‰¾åˆ°èŠ‚ç‚¹ï¼Œè€Œç¬¬äºŒä¸ªæ ‘çš„æ·±åº¦æ˜¯7ï¼Œæœ€å¤šéœ€è¦7æ¬¡æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°èŠ‚ç‚¹ã€‚</p>
<p>ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå°±éœ€è¦<strong>å‡å°‘ç£ç›˜IOæ•°</strong>ã€‚ä¸ºäº†å‡å°‘ç£ç›˜loçš„æ¬¡æ•°ï¼Œå°±éœ€è¦<strong>å°½é‡é™ä½æ ‘çš„é«˜åº¦</strong>ï¼Œéœ€è¦æŠŠåŸæ¥â€œç˜¦é«˜â€çš„æ ‘ç»“æ„å˜çš„â€œçŸ®èƒ–â€ï¼Œæ ‘çš„æ¯å±‚çš„åˆ†å‰è¶Šå¤šè¶Šå¥½ã€‚</p>
<h5 id="AVLæ ‘"><a href="#AVLæ ‘" class="headerlink" title="AVLæ ‘"></a>AVLæ ‘</h5><p>ä¸ºäº†è§£å†³ä¸Šé¢äºŒå‰æ ‘æ‰¾æ ‘é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ï¼Œäººä»¬æå‡ºäº†å¹³è¡¡äºŒå‰æ ‘ï¼ˆbalanced Binary Treeï¼‰ï¼Œåˆç§°ä¸ºAVLæ ‘ï¼ˆæœ‰åˆ«äºAVLç®—æ³•ï¼‰ï¼Œå®ƒåœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Šå¢åŠ äº†çº¦æŸï¼Œå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p>
<p><strong>å®ƒæ˜¯ä¸€é¢—ç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘</strong></p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œå¸¸è§çš„å¹³è¡¡äºŒå‰æ ‘æœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬äº†<strong>å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€çº¢é»‘æ ‘ã€æ•°å †ã€ä¼¸å±•æ ‘</strong>ã€‚å¹³è¡¡äºŒå‰æœç´¢æ ‘æ˜¯æœ€æ—©æå‡ºæ¥çš„è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œå½“æˆ‘ä»¬æåˆ°å¹³è¡¡äºŒå‰æ ‘æ—¶ä¸€èˆ¬æŒ‡çš„å°±æ˜¯å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚äº‹å®ä¸Šï¼Œç¬¬ä¸€æ£µæ ‘å°±å±äºå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæœç´¢æ—¶é—´å¤æ‚åº¦å°±æ˜¯**0( log2n)**ã€‚</p>
<p>æ•°æ®æŸ¥è¯¢çš„æ—¶é—´ä¸»è¦ä¾èµ–äºç£ç›˜I/oçš„æ¬¡æ•°ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨äºŒå‰æ ‘çš„å½¢å¼ï¼Œå³ä½¿é€šè¿‡å¹³è¡¡äºŒå‰æœç´¢æ ‘è¿›è¡Œäº†æ”¹è¿›ï¼Œæ ‘çš„æ·±åº¦ä¹Ÿæ˜¯ o(log2n)ï¼Œå½“næ¯”è¾ƒå¤§æ—¶ï¼Œæ·±åº¦ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¯”å¦‚ä¸‹å›¾çš„æƒ…å†µ:</p>
<p><img src="/2022/04/22/MySQL/1652685135597.png" alt="1652685135597" loading="lazy"></p>
<p><strong>æ¯è®¿é—®ä¸€æ¬¡èŠ‚ç‚¹å°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç£ç›˜å·¥/0æ“ä½œ</strong>ï¼Œå¯¹äºä¸Šé¢çš„æ ‘æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ5æ¬¡I/Oæ“ä½œã€‚è™½ç„¶å¹³è¡¡äºŒå‰æ ‘çš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯æ ‘çš„æ·±åº¦ä¹ŸåŒæ ·é«˜ï¼Œè¿™å°±æ„å‘³ç€ç£ç›˜I/oæ“ä½œæ¬¡æ•°å¤šï¼Œä¼šå½±å“æ•´ä½“æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p>
<p>é’ˆå¯¹åŒæ ·çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æŠŠäºŒå‰æ ‘æ”¹æˆMå‰æ ‘â€•(M&gt;2ï¼‰å‘¢?å½“M=3æ—¶ï¼ŒåŒæ ·çš„31ä¸ªèŠ‚ç‚¹å¯ä»¥ç”±ä¸‹é¢çš„ä¸‰å‰æ ‘æ¥è¿›è¡Œå­˜å‚¨:<img src="/2022/04/22/MySQL/1652685189189.png" alt="1652685189189" loading="lazy"></p>
<p>ä½ èƒ½çœ‹åˆ°æ­¤æ—¶æ ‘çš„é«˜åº¦é™ä½äº†ï¼Œå½“æ•°æ®é‡Nå¤§çš„æ—¶å€™ï¼Œä»¥åŠæ ‘çš„åˆ†å‰æ•°Må¤§çš„æ—¶å€™ï¼ŒMå‰æ ‘çš„é«˜åº¦ä¼šè¿œå°äºäºŒå‰æ ‘çš„é«˜åº¦(M &gt;2)ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<strong>æ ‘ä»â€œç˜¦é«˜â€å˜â€œçŸ®èƒ–â€</strong>ã€‚</p>
<h5 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h5><p>Bæ ‘çš„è‹±æ–‡æ˜¯Balance Treeï¼Œä¹Ÿå°±æ˜¯<strong>å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘</strong>ã€‚ç®€å†™ä¸ºB-Tree (æ³¨æ„æ¨ªæ è¡¨ç¤ºè¿™ä¸¤ä¸ªå•è¯è¿èµ·æ¥çš„æ„æ€ï¼Œä¸æ˜¯å‡å·)ã€‚å®ƒçš„é«˜åº¦è¿œå°äºå¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦ã€‚</p>
<p>Bæ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652685275523.png" alt="1652685275523" loading="lazy"></p>
<p>Bæ ‘ä½œä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå®ƒçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥åŒ…æ‹¬Mä¸ªå­èŠ‚ç‚¹ï¼Œ<strong>Mç§°ä¸ºBæ ‘çš„é˜¶</strong>ã€‚æ¯ä¸ªç£ç›˜å—ä¸­åŒ…æ‹¬äº†<strong>å…³é”®å­—å’Œå­èŠ‚ç‚¹çš„æŒ‡é’ˆ</strong>ã€‚å¦‚æœä¸€ä¸ªç£ç›˜å—ä¸­åŒ…æ‹¬äº†Ã—ä¸ªå…³é”®å­—ï¼Œé‚£ä¹ˆæŒ‡é’ˆæ•°å°±æ˜¯x+1ã€‚å¯¹äºä¸€ä¸ª100é˜¶çš„Bæ ‘æ¥è¯´ï¼Œå¦‚æœæœ‰3å±‚çš„è¯æœ€å¤šå¯ä»¥å­˜å‚¨çº¦100ä¸‡çš„ç´¢å¼•æ•°æ®ã€‚å¯¹äºå¤§é‡çš„ç´¢å¼•æ•°æ®æ¥è¯´ï¼Œé‡‡ç”¨Bæ ‘çš„ç»“æ„æ˜¯éå¸¸é€‚åˆçš„ï¼Œå› ä¸ºæ ‘çš„é«˜åº¦è¦è¿œå°äºäºŒå‰æ ‘çš„é«˜åº¦ã€‚</p>
<p>ä¸€ä¸ªMé˜¶çš„Bæ ‘ï¼ˆM&gt;2ï¼‰æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li><p>æ ¹èŠ‚ç‚¹çš„å„¿å­æ•°çš„èŒƒå›´æ˜¯ [2,M]ã€‚ </p>
</li>
<li><p>æ¯ä¸ªä¸­é—´èŠ‚ç‚¹åŒ…å« k-1 ä¸ªå…³é”®å­—å’Œ k ä¸ªå­©å­ï¼Œå­©å­çš„æ•°é‡ = å…³é”®å­—çš„æ•°é‡ +1ï¼Œk çš„å–å€¼èŒƒå›´ä¸º[ceil(M/2), M]ã€‚ </p>
</li>
<li><p>å¶å­èŠ‚ç‚¹åŒ…æ‹¬ k-1 ä¸ªå…³é”®å­—ï¼ˆå¶å­èŠ‚ç‚¹æ²¡æœ‰å­©å­ï¼‰ï¼Œk çš„å–å€¼èŒƒå›´ä¸º [ceil(M/2), M]ã€‚ </p>
</li>
<li><p>å‡è®¾ä¸­é—´èŠ‚ç‚¹èŠ‚ç‚¹çš„å…³é”®å­—ä¸ºï¼šKey[1], Key[2], â€¦, Key[k-1]ï¼Œä¸”å…³é”®å­—æŒ‰ç…§å‡åºæ’åºï¼Œå³ Key[i]&lt;Key[i+1]ã€‚æ­¤æ—¶ k-1 ä¸ªå…³é”®å­—ç›¸å½“äºåˆ’åˆ†äº† k ä¸ªèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ k ä¸ªæŒ‡é’ˆï¼Œå³ä¸ºï¼šP[1], P[2], â€¦,P[k]ï¼Œå…¶ä¸­ P[1] æŒ‡å‘å…³é”®å­—å°äº Key[1] çš„å­æ ‘ï¼ŒP[i] æŒ‡å‘å…³é”®å­—å±äº (Key[i-1], Key[i]) çš„å­æ ‘ï¼ŒP[kæŒ‡å‘å…³é”®å­—å¤§äº Key[k-1] çš„å­æ ‘ã€‚ </p>
</li>
<li><p>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä½äºåŒä¸€å±‚ã€‚ </p>
</li>
</ol>
<p>ä¸Šé¢é‚£å¼ å›¾æ‰€è¡¨ç¤ºçš„ B æ ‘å°±æ˜¯ä¸€æ£µ 3 é˜¶çš„ B æ ‘ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ç£ç›˜å— 2ï¼Œé‡Œé¢çš„å…³é”®å­—ä¸ºï¼ˆ8ï¼Œ12ï¼‰ï¼Œå®ƒ æœ‰ 3 ä¸ªå­©å­ (3ï¼Œ5)ï¼Œ(9ï¼Œ10) å’Œ (13ï¼Œ15)ï¼Œä½ èƒ½çœ‹åˆ° (3ï¼Œ5) å°äº 8ï¼Œ(9ï¼Œ10) åœ¨ 8 å’Œ 12 ä¹‹é—´ï¼Œè€Œ (13ï¼Œ15) å¤§äº 12ï¼Œåˆšå¥½ç¬¦åˆåˆšæ‰æˆ‘ä»¬ç»™å‡ºçš„ç‰¹å¾ã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ç”¨Bæ ‘è¿›è¡ŒæŸ¥æ‰¾ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„å…³é”®å­—æ˜¯9ï¼Œé‚£ä¹ˆæ­¥éª¤å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥:</p>
<p>1.æˆ‘ä»¬ä¸æ ¹èŠ‚ç‚¹çš„å…³é”®å­—(17ï¼Œ35ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œ9å°äº17é‚£ä¹ˆå¾—åˆ°æŒ‡é’ˆP1;</p>
<p>2.æŒ‰ç…§æŒ‡é’ˆP1æ‰¾åˆ°ç£ç›˜å—2ï¼Œå…³é”®å­—ä¸º(8,12)ï¼Œå› ä¸º9åœ¨8å’Œ12ä¹‹é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°æŒ‡é’ˆP2;</p>
<p>3ï¼æŒ‰ç…§æŒ‡é’ˆP2æ‰¾åˆ°ç£ç›˜å—6ï¼Œå…³é”®å­—ä¸º(9ï¼Œ10)ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å­—9ã€‚</p>
<p>ä½ èƒ½çœ‹å‡ºæ¥åœ¨Bæ ‘çš„æœç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒçš„æ¬¡æ•°å¹¶ä¸å°‘ï¼Œä½†å¦‚æœæŠŠæ•°æ®è¯»å–å‡ºæ¥ç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ä¸ªæ—¶é—´å°±æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚è€Œè¯»å–ç£ç›˜å—æœ¬èº«éœ€è¦è¿›è¡ŒI/Oæ“ä½œï¼Œæ¶ˆè€—çš„æ—¶é—´æ¯”åœ¨å†…å­˜ä¸­è¿›è¡Œæ¯”è¾ƒæ‰€éœ€è¦çš„æ—¶é—´è¦å¤šï¼Œæ˜¯æ•°æ®æŸ¥æ‰¾ç”¨æ—¶çš„é‡è¦å› ç´ ã€‚<strong>Bæ ‘ç›¸æ¯”äºå¹³è¡¡äºŒå‰æ ‘æ¥è¯´ç£ç›˜å·¥/0æ“ä½œè¦å°‘</strong>ï¼Œåœ¨æ•°æ®æŸ¥è¯¢ä¸­æ¯”å¹³è¡¡äºŒå‰æ ‘æ•ˆç‡è¦é«˜ã€‚æ‰€ä»¥<strong>åªè¦æ ‘çš„é«˜åº¦è¶³å¤Ÿä½ï¼ŒIOæ¬¡æ•°è¶³å¤Ÿå°‘ï¼Œå°±å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</strong></p>
<p><strong>å°ç»“ï¼š</strong></p>
<ol>
<li>Bæ ‘åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™å¦‚æœå¯¼è‡´æ ‘ä¸å¹³è¡¡ï¼Œå°±é€šè¿‡è‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹çš„ä½ç½®æ¥ä¿æŒæ ‘çš„è‡ªå¹³è¡¡ã€‚</li>
<li>å…³é”®å­—é›†åˆåˆ†å¸ƒåœ¨æ•´æ£µæ ‘ä¸­,å³å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®ã€‚æœç´¢æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸ</li>
<li>å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚</li>
</ol>
<p><strong>å†ä¸¾ä¾‹1ï¼š</strong><img src="/2022/04/22/MySQL/1652686027723.png" alt="1652686027723" loading="lazy"></p>
<h5 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h5><p>B+æ ‘ä¹Ÿæ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ï¼Œ<strong>åŸºäºBæ ‘åšå‡ºäº†æ”¹è¿›</strong>ï¼Œä¸»æµçš„DBMSéƒ½æ”¯æŒB+æ ‘çš„ç´¢å¼•æ–¹å¼ï¼Œæ¯”å¦‚MySQLã€‚ç›¸täºB-Treeï¼Œ<strong>B+Treeé€‚åˆæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿã€‚</strong></p>
<p><img src="/2022/04/22/MySQL/1652686141568.png" alt="1652686141568" loading="lazy"></p>
<p><strong>B+æ ‘å’ŒBæ ‘çš„å·®å¼‚åœ¨äºä»¥ä¸‹å‡ ç‚¹:</strong><br>1.æœ‰kä¸ªå­©å­çš„èŠ‚ç‚¹å°±æœ‰kä¸ªå…³é”®å­—ã€‚ä¹Ÿå°±æ˜¯å­©å­æ•°é‡=å…³é”®å­—æ•°ï¼Œè€ŒBæ ‘ä¸­ï¼Œå­©å­æ•°é‡=å…³é”®å­—æ•°+1ã€‚</p>
<p>2ï¼éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä¹Ÿä¼šåŒæ—¶å­˜åœ¨åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨å­èŠ‚ç‚¹ä¸­æ‰€æœ‰å…³é”®å­—çš„æœ€å¤§(æˆ–æœ€å°</p>
<p>3éå¶å­èŠ‚ç‚¹ä»…ç”¨äºç´¢å¼•ï¼Œä¸ä¿å­˜æ•°æ®è®°å½•ï¼Œè·Ÿè®°å½•æœ‰å…³çš„ä¿¡æ¯éƒ½æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚è€ŒBæ ‘ä¸­ï¼Œéå¶å­èŠ‚ç‚¹<strong>æ—¢ä¿å­˜ç´¢å¼•ï¼Œä¹Ÿä¿å­˜æ•°æ®è®°å½•ã€‚</strong></p>
<p>4.æ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹å‡ºç°ï¼Œå¶å­èŠ‚ç‚¹æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œè€Œä¸”å¶å­èŠ‚ç‚¹æœ¬èº«æŒ‰ç…§å…³é”®å­—çš„å¤§å°ä»å°åˆ°å¤§é¡ºåºé“¾æ¥ã€‚</p>
<p><strong>B+æ ‘ä¸­é—´èŠ‚ç‚¹å¹¶ä¸ç›´æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·çš„å¥½å¤„æœ‰ä»€ä¹ˆï¼Ÿ</strong></p>
<p>é¦–å…ˆ<strong>ï¼ŒB+æ ‘æŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®š</strong>ã€‚å› ä¸ºB+æ ‘æ¯æ¬¡åªæœ‰è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ï¼Œè€Œåœ¨Bæ ‘ä¸­ï¼Œéå¶å­èŠ‚ç‚¹ä¹Ÿä¼šå­˜å‚¨æ•°æ®ï¼Œè¿™æ ·å°±ä¼šé€ æˆæŸ¥è¯¢æ•ˆç‡ä¸ç¨³å®šçš„æƒ…å†µï¼Œæœ‰æ—¶å€™è®¿é—®åˆ°äº†éå¶å­èŠ‚ç‚¹å°±å¯ä»¥æ‰¾åˆ°å…³é”®å­—ï¼Œè€Œæœ‰æ—¶éœ€è¦è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°å…³å­—ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<strong>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜</strong>ã€‚è¿™æ˜¯å› ä¸ºé€šå¸¸B+æ ‘æ¯”Bæ ‘æ›´çŸ®èƒ–(é˜¶æ•°æ›´å¤§ï¼Œæ·±åº¦æ›´ä½)ï¼ŒæŸ¥è¯¢æ‰€éœ€è¦çš„ç£ç›˜I/o ä¹Ÿä¼šæ›´å°‘ã€‚åŒæ ·çš„ç£ç›˜é¡µå¤§å°ï¼ŒB+æ ‘å¯ä»¥å­˜å‚¨æ›´å¤šçš„èŠ‚ç‚¹å…³é”®å­—ã€‚</p>
<p>ä¸ä»…æ˜¯å¯¹å•ä¸ªå…³é”®å­—çš„æŸ¥è¯¢ä¸Šï¼Œ<strong>åœ¨æŸ¥è¯¢èŒƒå›´ä¸Šï¼ŒB+æ ‘çš„æ•ˆç‡ä¹Ÿæ¯”Bæ ‘é«˜</strong>ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´ä¼šæœ‰æŒ‡é’ˆï¼Œæ•°æ®åˆæ˜¯é€’å¢çš„ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èŒƒå›´æŸ¥æ‰¾å¯ä»¥é€šè¿‡æŒ‡é’ˆè¿æ¥æŸ¥æ‰¾ã€‚è€Œåœ¨Bæ ‘ä¸­åˆ™éœ€è¦é€šè¿‡ä¸­åºéå†æ‰èƒ½å®ŒæˆæŸ¥è¯¢èŒƒå›´çš„æŸ¥æ‰¾ï¼Œæ•ˆç‡è¦ä½å¾ˆå¤šã€‚</p>
<blockquote>
<p>B æ ‘å’Œ B+ æ ‘éƒ½å¯ä»¥ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œåœ¨ MySQL ä¸­é‡‡ç”¨çš„æ˜¯ B+ æ ‘ã€‚ </p>
<p>ä½†Bæ ‘å’ŒB+æ ‘å„æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä¸èƒ½è¯´B+æ ‘å®Œå…¨æ¯”Bæ ‘å¥½ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
</blockquote>
<p><strong>æ€è€ƒé¢˜ï¼šä¸ºäº†å‡å°‘IOï¼Œç´¢å¼•æ ‘ä¼šä¸€æ¬¡æ€§åŠ è½½å—</strong></p>
<blockquote>
<p>1ã€æ•°æ®åº“ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¿…ç„¶å¯¼è‡´ç´¢å¼•çš„å¤§å°ä¹Ÿä¼šå¾ˆå¤§ï¼Œè¶…è¿‡å‡ ä¸ªGã€‚<br>2ã€å½“æˆ‘ä»¬åˆ©ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½å°†å…¨éƒ¨å‡ ä¸ªGçš„ç´¢å¼•éƒ½åŠ è½½è¿›å†…å­˜çš„ï¼Œæˆ‘ä»¬èƒ½åšçš„åªèƒ½æ˜¯:é€ä¸€åŠ è½½æ¯ä¸€ä¸ªç£ç›˜é¡µï¼Œå› ä¸ºç£ç›˜é¡µå¯¹åº”ç€ç´¢å¼•æ ‘çš„èŠ‚ç‚¹ã€‚</p>
</blockquote>
<p><strong>æ€è€ƒé¢˜ï¼šB+æ ‘çš„å­˜å‚¨èƒ½åŠ›å¦‚ä½•ï¼Ÿä¸ºä½•è¯´ä¸€èˆ¬æŸ¥æ‰¾è¡Œè®°å½•ï¼Œæœ€å¤šåªéœ€1~3æ¬¡ç£ç›˜IO</strong></p>
<blockquote>
<p>InnoDBå­˜å‚¨å¼•æ“ä¸­é¡µçš„å¤§å°ä¸º16KBï¼Œä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸ºINT(å ç”¨4ä¸ªå­—èŠ‚ï¼‰æˆ–BIGINT(å ç”¨8ä¸ªå­—èŠ‚)ï¼ŒæŒ‡é’ˆç±»å‹ä¹Ÿä¸€èˆ¬ä¸º4æˆ–8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µï¼ˆB+Tree ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹)ä¸­å¤§æ¦‚å­˜å‚¨16KB/(8B+8B)=1Kä¸ªé”®å€¼ï¼ˆå› ä¸ºæ˜¯ä¼°å€¼ï¼Œä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œè¿™é‡Œçš„Kå–å€¼ä¸º10^3ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ·±åº¦ä¸º3çš„B+Treeç´¢å¼•å¯ä»¥ç»´æŠ¤10^3<em>10^3</em>10^3=10äº¿æ¡è®°å½•ã€‚(è¿™é‡Œå‡å®šä¸€ä¸ªæ•°æ®é¡µä¹Ÿå­˜å‚¨10^3æ¡è¡Œè®°å½•æ•°æ®äº†)å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼Œ<strong>B+Treeçš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨2~4å±‚</strong>ã€‚MysQLçš„InnoDBå­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦1~3æ¬¡ç£ç›˜I/oæ“ä½œã€‚    </p>
</blockquote>
<p><strong>æ€è€ƒï¼šä¸ºä»€ä¹ˆè¯´B+æ ‘æ¯”B-æ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç´¢å¼•å’Œæ•°æ®åº“ç´¢å¼•ï¼Ÿ</strong></p>
<blockquote>
<p>1ã€B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½<br>B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚å› æ­¤å…¶å†…éƒ¨ç»“ç‚¹ç›¸å¯¹Bæ ‘æ›´å°ã€‚å¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨ç»“ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šã€‚ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šã€‚ç›¸å¯¹æ¥è¯´Ioè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚<br>2ã€B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š<br>ç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</p>
</blockquote>
<p><strong>Hashç´¢å¼•ä¸B+æ ‘ç´¢å¼•çš„åŒºåˆ«</strong></p>
<blockquote>
<p>æˆ‘ä»¬ä¹‹å‰è®²åˆ°è¿‡B+æ ‘ç´¢å¼•çš„ç»“æ„ï¼ŒHashç´¢å¼•ç»“æ„å’ŒB+æ ‘çš„ä¸åŒï¼Œå› æ­¤åœ¨ç´¢å¼•ä½¿ç”¨ä¸Šä¹Ÿä¼šæœ‰å·®åˆ«</p>
<p>1ã€Hashç´¢å¼•<strong>ä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</strong>ï¼Œè€ŒB+æ ‘å¯ä»¥ã€‚è¿™æ˜¯å› ä¸ºHashç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œè€ŒB+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸ªæœ‰åºçš„é“¾è¡¨ã€‚</p>
<p>2ã€Hash ç´¢å¼•<strong>ä¸æ”¯æŒè”åˆç´¢å¼•çš„æœ€å·¦ä¾§åŸåˆ™</strong>(å³è”åˆç´¢å¼•çš„éƒ¨åˆ†ç´¢å¼•æ— æ³•ä½¿ç”¨)ï¼Œè€ŒB+æ ‘å¯ä»¥ã€‚å¯¹äºè”åˆç´¢å¼•æ¥è¯´ï¼ŒHashç´¢å¼•åœ¨è®¡ç®—Hashå€¼çš„æ—¶å€™æ˜¯å°†ç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®—Hashå€¼ï¼Œæ‰€ä»¥ä¸ä¼šé’ˆå¯¹æ¯ä¸ªç´¢å¼•å•ç‹¬è®¡ç®—Hashå€¼ã€‚å› æ­¤å¦‚æœç”¨åˆ°è”åˆç´¢å¼•çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªç´¢å¼•æ—¶ï¼Œè”åˆç´¢å¼•æ— æ³•è¢«åˆ©ç”¨ã€‚</p>
<p>3ã€Hashç´¢å¼•<strong>ä¸æ”¯æŒORDER BYæ’åº</strong>ï¼Œå› ä¸ºHashç´¢å¼•æŒ‡å‘çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œå› æ­¤æ— æ³•èµ·åˆ°æ’åºä¼˜åŒ–çš„ä½œç”¨ï¼Œè€ŒB+æ ‘ç´¢å¼•æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥èµ·åˆ°å¯¹è¯¥å­—æ®µORDER BYæ’åºä¼˜åŒ–çš„ä½œç”¨ã€‚åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ç”¨Hashç´¢å¼•è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œè€ŒBæ ‘ä½¿ç”¨LIKEè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢çš„æ—¶å€™ï¼ŒLIKEåé¢åæ¨¡ç³ŠæŸ¥è¯¢(æ¯”å¦‚%ç»“å°¾)çš„è¯å°±å¯ä»¥èµ·åˆ°ä¼˜åŒ–ä½œç”¨    </p>
<p>4.<strong>InnoDBä¸æ”¯æŒå“ˆå¸Œç´¢å¼•</strong></p>
</blockquote>
<p><strong>æ€è€ƒï¼šHashç´¢å¼•ä¸B+æ ‘ç´¢å¼•æ˜¯åœ¨é”®ç´¢å¼•çš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®šçš„å—ï¼Ÿ</strong></p>
<blockquote>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯MySQLçš„è¯Iæˆ‘ä»¬éœ€è¦äº†è§£MysQLçš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒå“ªäº›ç´¢å¼•ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º(å‚è€ƒæ¥æºhttps:)/dev.mysql.com/doc/refman/8.0/en/create-index.html)ã€‚å¦‚æœæ˜¯å…¶ä»–çš„DBMSï¼Œå¯ä»¥å‚è€ƒç›¸å…³çš„DBMSæ–‡æ¡£ã€‚<img src="/2022/04/22/MySQL/1652690582106.png" alt="1652690582106" loading="lazy"></p>
<p>ä½ èƒ½çœ‹åˆ°ï¼Œé’ˆå¯¹InnoDBå’ŒMyIlSAMå­˜å‚¨å¼•æ“ï¼Œéƒ½ä¼šé»˜è®¤é‡‡ç”¨B+æ ‘ç´¢å¼•ï¼Œæ— æ³•ä½¿ç”¨Hashç´¢å¼•ã€‚InnoDBæä¾›çš„è‡ªé€‚åº”Hashæ˜¯ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šçš„ã€‚å¦‚æœæ˜¯Memory/Heapå’ŒNDBå­˜å‚¨å¼•æ“ï¼Œæ˜¯å¯ä»¥è¿›è¡Œé€‰æ‹©Hashç´¢å¼•çš„ã€‚</p>
</blockquote>
<h5 id="Ræ ‘"><a href="#Ræ ‘" class="headerlink" title="Ræ ‘"></a>Ræ ‘</h5><p>R-Treeåœ¨MysQLå¾ˆå°‘ä½¿ç”¨ï¼Œä»…æ”¯æŒ<code> geometryæ•°æ®ç±»å‹</code>ï¼Œæ”¯æŒè¯¥ç±»å‹çš„å­˜å‚¨å¼•æ“åªæœ‰myisamã€bdbã€innodbã€ndbã€archiveå‡ ç§ã€‚ä¸¾ä¸ªRæ ‘åœ¨ç°å®é¢†åŸŸä¸­èƒ½å¤Ÿè§£å†³çš„ä¾‹å­:æŸ¥æ‰¾2oè‹±é‡Œä»¥å†…æ‰€æœ‰çš„é¤å…ã€‚å¦‚æœæ²¡æœ‰Ræ ‘ä½ ä¼šæ€ä¹ˆè§£å†³?ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šæŠŠé¤å…çš„åæ ‡(xy)åˆ†ä¸ºä¸¤ä¸ªå­—æ®µå­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œä¸€ä¸ªå­—æ®µè®°å½•ç»åº¦ï¼Œå¦ä¸€ä¸ªå­—æ®µè®°å½•çº¬åº¦ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦éå†æ‰€æœ‰çš„é¤å…è·å–å…¶ä½ç½®ä¿¡æ¯ï¼Œç„¶åè®¡ç®—æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚å¦‚æœä¸€ä¸ªåœ°åŒºæœ‰100å®¶é¤å…çš„è¯ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œ10oæ¬¡ä½ç½®è®¡ç®—æ“ä½œäº†ï¼Œå¦‚æœåº”ç”¨åˆ°è°·æ­Œã€ç™¾åº¦åœ°å›¾è¿™ç§è¶…å¤§æ•°æ®åº“ä¸­ï¼Œè¿™ç§æ–¹æ³•ä¾¿å¿…å®šä¸å¯è¡Œäº†ã€‚Ræ ‘å°±å¾ˆå¥½çš„<strong>è§£å†³äº†è¿™ç§é«˜ç»´ç©ºé—´æœç´¢é—®é¢˜</strong>ã€‚å®ƒæŠŠBæ ‘çš„æ€æƒ³å¾ˆå¥½çš„æ‰©å±•åˆ°äº†å¤šç»´ç©ºé—´ï¼Œé‡‡ç”¨äº†Bæ ‘åˆ†å‰²ç©ºé—´çš„æ€æƒ³ï¼Œå¹¶åœ¨æ·»åŠ ã€åˆ é™¤æ“ä½œæ—¶é‡‡ç”¨åˆå¹¶ã€åˆ†è§£ç»“ç‚¹çš„æ–¹æ³•ï¼Œä¿è¯æ ‘çš„å¹³è¡¡æ€§ã€‚å› æ­¤ï¼ŒRæ ‘å°±æ˜¯ä¸€æ£µç”¨æ¥<strong>å­˜å‚¨é«˜ç»´æ•°æ®çš„å¹³è¡¡æ ‘ã€‚</strong>ç›¸å¯¹äºB-Treeï¼ŒR-Treeçš„ä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ã€‚<img src="/2022/04/22/MySQL/1652690678410.png" alt="1652690678410" loading="lazy"></p>
<h5 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h5><p>ä½¿ç”¨ç´¢å¼•å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»æµ·é‡çš„æ•°æ®ä¸­å¿«é€Ÿå®šä½æƒ³è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œä¸è¿‡ç´¢å¼•ä¹Ÿå­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œæ¯”å¦‚å ç”¨å­˜å‚¨ç©ºé—´ã€é™ä½æ•°æ®åº“å†™æ“ä½œçš„æ€§èƒ½ç­‰ï¼Œå¦‚æœæœ‰å¤šä¸ªç´¢å¼•è¿˜ä¼šå¢åŠ ç´¢å¼•é€‰æ‹©çš„æ—¶é—´ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ç´¢å¼•æ—¶ï¼Œéœ€è¦å¹³è¡¡ç´¢å¼•çš„åˆ©(æå‡æŸ¥è¯¢æ•ˆç‡)å’Œå¼Š(ç»´æŠ¤ç´¢å¼•æ‰€éœ€çš„ä»£ä»·)ã€‚</p>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŸºäºéœ€æ±‚å’Œæ•°æ®æœ¬èº«çš„åˆ†å¸ƒæƒ…å†µæ¥ç¡®å®šæ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œå°½ç®¡<strong>ç´¢å¼•ä¸æ˜¯ä¸‡èƒ½çš„</strong>ï¼Œä½†<strong>æ•°æ®é‡å¤§çš„æ—¶å€™ä¸ä½¿ç”¨ç´¢å¼•æ˜¯ä¸å¯æƒ³è±¡çš„</strong>ï¼Œæ¯•ç«Ÿç´¢å¼•çš„æœ¬è´¨ï¼Œæ˜¯å¸®åŠ©æˆ‘ä»¬æå‡æ•°æ®æ£€ç´¢çš„æ•ˆç‡ã€‚</p>
<p><strong>é™„å½•ï¼šç®—æ³•çš„æ—¶é—´å¤æ‚åº¦</strong></p>
<p>åŒä¸€é—®é¢˜å¯ç”¨ä¸åŒç®—æ³•è§£å†³ï¼Œè€Œä¸€ä¸ªç®—æ³•çš„è´¨é‡ä¼˜åŠ£å°†å½±å“åˆ°ç®—æ³•ä¹ƒè‡³ç¨‹åºçš„æ•ˆç‡ã€‚ç®—æ³•åˆ†æçš„ç›®çš„åœ¨äºé€‰æ‹©åˆé€‚ç®—æ³•å’Œæ”¹è¿›ç®—æ³•ã€‚<img src="/2022/04/22/MySQL/1652690811034.png" alt="1652690811034" loading="lazy"></p>
<h3 id="ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"><a href="#ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™" class="headerlink" title="ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"></a>ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</h3><h4 id="1-ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨"><a href="#1-ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨" class="headerlink" title="1.ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨"></a>1.ç´¢å¼•çš„å£°æ˜ä¸ä½¿ç”¨</h4><h5 id="1-1ç´¢å¼•çš„åˆ†ç±»"><a href="#1-1ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="1.1ç´¢å¼•çš„åˆ†ç±»"></a>1.1ç´¢å¼•çš„åˆ†ç±»</h5><p>MySQLçš„ç´¢å¼•åŒ…æ‹¬æ™®é€šç´¢å¼•ã€å”¯ä¸€æ€§ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€å•åˆ—ç´¢å¼•ã€å¤šåˆ—ç´¢å¼•å’Œç©ºé—´ç´¢å¼•ç­‰ã€‚</p>
<ul>
<li>ä»åŠŸèƒ½é€»è¾‘ä¸Šè¯´ï¼Œç´¢å¼•ä¸»è¦æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€‚</li>
<li>æŒ‰ç…§ç‰©ç†å®ç°æ–¹å¼ï¼Œç´¢å¼•å¯ä»¥åˆ†ä¸º2ç§:èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚</li>
<li>æŒ‰ç…§ä½œç”¨å­—æ®µä¸ªæ•°è¿›è¡Œåˆ’åˆ†ï¼Œåˆ†æˆå•åˆ—ç´¢å¼•å’Œè”åˆç´¢å¼•ã€‚</li>
</ul>
<p><strong>1.æ™®é€šç´¢å¼•</strong></p>
<p>åœ¨åˆ›å»ºæ™®é€šç´¢å¼•æ—¶ï¼Œä¸é™„åŠ ä»»ä½•é™åˆ¶æ¡ä»¶ï¼Œåªæ˜¯ç”¨äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚è¿™ç±»ç´¢å¼•å¯ä»¥åˆ›å»ºåœ¨<strong>ä»»ä½•æ•°æ®ç±»å‹</strong>ä¸­ï¼Œå…¶å€¼æ˜¯å¦å”¯ä¸€å’Œéç©ºè¦ç”±å­—æ®µæœ¬èº«çš„å®Œæ•´çº¦æŸæ¡ä»¶å†³å®šã€‚å»ºç«‹ç´¢å¼•ä»¥åï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œåœ¨è¡¨<strong>studentçš„å­—æ®µname</strong>ä¸Šå»ºç«‹ä¸€ä¸ªæ™®é€šç´¢å¼•ï¼ŒæŸ¥è¯¢è®°å½•æ—¶å°±å¯ä»¥æ ¹æ®è¯¥ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢</p>
<p><strong>2.å”¯ä¸€æ€§ç´¢å¼•</strong></p>
<p>ä½¿ç”¨<strong>UNIQUEå‚æ•°</strong>å¯ä»¥è®¾ç½®ç´¢å¼•ä¸ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œåœ¨åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•æ—¶ï¼Œé™åˆ¶è¯¥ç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ä½†å…è®¸æœ‰ç©ºå€¼ã€‚åœ¨ä¸€å¼ æ•°æ®è¡¨é‡Œ<strong>å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚</strong></p>
<p>ä¾‹å¦‚ï¼Œåœ¨è¡¨studentçš„å­—æ®µemailä¸­åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œé‚£ä¹ˆå­—æ®µemailçš„å€¼å°±å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚é€šè¿‡å”¯ä¸€æ€§ç´¢å¼•,å¯ä»¥æ›´å¿«é€Ÿåœ°ç¡®å®šæŸæ¡è®°å½•ã€‚</p>
<p><strong>3.ä¸»é”®ç´¢å¼•</strong></p>
<p>ä¸»é”®ç´¢å¼•å°±æ˜¯<strong>ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€æ€§ç´¢å¼•</strong>ï¼Œåœ¨å”¯ä¸€ç´¢å¼•çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸ä¸ºç©ºçš„çº¦æŸï¼Œä¹Ÿå°±æ˜¯NOT NULL+UNIQUEï¼Œä¸€å¼ è¡¨é‡Œ<strong>æœ€å¤šåªæœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ã€‚</strong></p>
<p>why? è¿™æ˜¯ç”±ä¸»é”®ç´¢å¼•çš„ç‰©ç†å®ç°æ–¹å¼å†³å®šçš„ï¼Œå› ä¸ºæ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶åªèƒ½æŒ‰ç…§ä¸€ç§é¡ºåºè¿›è¡Œå­˜å‚¨ã€‚</p>
<p><strong>4.å•åˆ—ç´¢å¼•</strong></p>
<p>åœ¨è¡¨ä¸­çš„å•ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ï¼Œå•åˆ—ç´¢å¼•åªæ ¹æ®è¯¥å­—æ®µè¿›è¡Œç´¢å¼•ã€‚å•åˆ—ç´¢å¼•å¯ä»¥æ˜¯æ™®é€šç´¢å¼•å—ï¼Œä¹Ÿå¯ä»¥æ˜¯å”¯ä¸€æ€§ç´¢å¼•ï¼Œè¿˜å¯ä»¥æ˜¯å…¨æ–‡ç´¢å¼•ã€‚åªè¦ä¿è¯è¯¥ç´¢å¼•åªå¯¹åº”ä¸€ä¸ªå­—æ®µå³å¯ã€‚ä¸€ä¸ªå¯ä»¥<strong>æœ‰å¤šä¸ª</strong>å•åˆ—ç´¢å¼•ã€‚</p>
<p><strong>5.å¤šåˆ—(ç»„åˆã€è”åˆ)ç´¢å¼•</strong></p>
<p>å¤šåˆ—ç´¢å¼•æ˜¯åœ¨è¡¨çš„<strong>å¤šä¸ªå­—æ®µç»„åˆ</strong>ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚è¯¥ç´¢å¼•æŒ‡å‘åˆ›å»ºæ—¶å¯¹åº”çš„å¤šä¸ªå­—æ®µï¼Œå¯ä»¥é€šè¿‡è¿™å‡ ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯åªæœ‰æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†è¿™äº›å­—æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µæ—¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è¡¨ä¸­çš„å­—æ®µidnameå’Œgenderä¸Šå»ºç«‹ä¸€ä¸ªå¤šåˆ—ç´¢å¼•<strong>idx_id_name_gender</strong>ï¼Œåªæœ‰åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†å­—æ®µidæ—¶è¯¥ç´¢å¼•æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä½¿ç”¨ç»„åˆç´¢å¼•æ—¶<strong>éµå¾ªæœ€å·¦å‰ç¼€é›†åˆ</strong>ã€‚</p>
<p><strong>6.å…¨æ–‡ç´¢å¼•</strong></p>
<p>å…¨æ–‡ç´¢å¼•ï¼ˆä¹Ÿç§°å…¨æ–‡æ£€ç´¢)æ˜¯ç›®å‰<strong>æœç´¢å¼•æ“</strong>ä½¿ç”¨çš„ä¸€ç§å…³é”®æŠ€æœ¯ã€‚å®ƒèƒ½å¤Ÿåˆ©ç”¨ã€<strong>åˆ†è¯æŠ€æœ¯ã€‘</strong>ç­‰å¤šç§ç®—æ³•æ™ºèƒ½åˆ†æ‰å‡ºæ–‡æœ¬æ–‡å­—ä¸­å…³é”®è¯çš„é¢‘ç‡å’Œé‡è¦æ€§ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è§„åˆ™æ™ºèƒ½åœ°ç­›é€‰å‡ºæˆ‘ä»¬æƒ³è¦çš„æœç´¢ç»“æœå…¨æ–‡ç´¢å¼•éå¸¸é€‚åˆå¤§å‹æ•°æ®é›†ï¼Œå¯¹äºå°çš„æ•°æ®é›†ï¼Œå®ƒçš„ç”¨å¤„æ¯”è¾ƒå°ã€‚</p>
<p>ä½¿ç”¨å‚æ•°<strong>FULLTEXT</strong>å¯ä»¥è®¾ç½®ç´¢å¼•ä¸ºå…¨æ–‡ç´¢å¼•ã€‚åœ¨å®šä¹‰ç´¢å¼•çš„åˆ—ä¸Šæ”¯æŒå€¼çš„å…¨æ–‡æŸ¥æ‰¾ï¼Œå…è®¸åœ¨è¿™äº›ç´¢å¼•åˆ—ä¸­æ’å…¥é‡å¤å€¼å’Œç©ºå€¼ã€‚å…¨æ–‡ç´¢å¼•åªèƒ½åˆ›å»ºåœ¨<strong>CHARã€VARCHAR æˆ–TEXT</strong>ç±»å‹åŠå…¶ç³»åˆ—ç±»å‹çš„å­—æ®µä¸Šï¼Œ<strong>æŸ¥è¯¢æ•°æ®é‡è¾ƒå¤§çš„å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ—¶ï¼Œä½¿ç”¨å…¨æ–‡ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦</strong>ã€‚ä¾‹å¦‚ï¼Œè¡¨<strong>student</strong>çš„å­—æ®µ<strong>informationæ˜¯TEXT</strong>ç±»å‹è¯¥å­—æ®µåŒ…å«äº†å¾ˆå¤šæ–‡å­—ä¿¡æ¯ã€‚åœ¨å­—æ®µinformationä¸Šå»ºç«‹å…¨æ–‡ç´¢å¼•åï¼Œå¯ä»¥æé«˜æŸ¥è¯¢å­—æ®µinformationçš„é€Ÿåº¦ã€‚</p>
<p>å…¨æ–‡ç´¢å¼•å…¸å‹çš„æœ‰ä¸¤ç§ç±»å‹ï¼šè‡ªç„¶è¯­è¨€çš„å…¨æ–‡ç´¢å¼•å’Œå¸ƒå°”å…¨æ–‡ç´¢å¼•</p>
<ul>
<li>è‡ªç„¶è¯­è¨€æœç´¢å¼•æ“å°†è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡å’ŒæŸ¥è¯¢çš„ç›¸å…³åº¦ã€‚è¿™é‡Œï¼Œç›¸å…³åº¦æ˜¯åŸºäºåŒ¹é…çš„å…³é”®è¯çš„ä¸ªæ•°ï¼Œä»¥åŠå…³é”®è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚åœ¨æ•´ä¸ªç´¢å¼•ä¸­å‡ºç°æ¬¡æ•°è¶Šå°‘çš„è¯è¯­ï¼ŒåŒ¹é…æ—¶çš„ç›¸å…³åº¦å°±è¶Šé«˜ã€‚ç›¸åï¼Œéå¸¸å¸¸è§çš„å•è¯å°†ä¸ä¼šè¢«æœç´¢ï¼Œå¦‚æœä¸€ä¸ªè¯è¯­çš„åœ¨è¶…è¿‡50%çš„è®°å½•ä¸­éƒ½å‡ºç°äº†ï¼Œé‚£ä¹ˆè‡ªç„¶è¯­è¨€çš„æœç´¢å°†ä¸ä¼šæœç´¢è¿™ç±»è¯è¯­ã€‚</li>
</ul>
<p>MysQLæ•°æ®åº“ä»3.23.23ç‰ˆå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œä½†MySQL5.6.4ä»¥å‰åªæœ‰Myisamæ”¯æŒï¼Œ5.6.4ç‰ˆæœ¬ä»¥åinnodbæ‰æ”¯æŒï¼Œä½†æ˜¯<strong>å®˜æ–¹ç‰ˆæœ¬ä¸æ”¯æŒä¸­æ–‡åˆ†è¯ï¼Œ</strong>éœ€è¦ç¬¬ä¸‰æ–¹åˆ†è¯æ’ä»¶ã€‚åœ¨5.7.6ç‰ˆæœ¬ï¼ŒMySQLå†…ç½®äº†ngramå…¨æ–‡è§£æå™¨ï¼Œç”¨æ¥æ”¯æŒäºšæ´²è¯­ç§çš„åˆ†è¯ã€‚æµ‹è¯•æˆ–ä½¿ç”¨å…¨æ–‡ç´¢å¼•æ—¶ï¼Œè¦å…ˆçœ‹ä¸€ä¸‹è‡ªå·±çš„MySQLç‰ˆæœ¬ã€å­˜å‚¨å¼•æ“å’Œæ•°æ®ç±»å‹æ˜¯å¦æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</p>
<p><strong>7.è¡¥å……ï¼šç©ºé—´ç´¢å¼•</strong></p>
<p>ä½¿ç”¨<strong>å‚æ•°SPATIAL</strong>å¯ä»¥è®¾ç½®ç´¢å¼•<strong>ä¸ºç©ºé—´ç´¢å¼•</strong>ã€‚ç©ºé—´ç´¢å¼•åªèƒ½å»ºç«‹åœ¨ç©ºé—´æ•°æ®ç±»å‹ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿè·å–ç©ºé—´æ•°æ®çš„æ•ˆç‡ã€‚MySQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹åŒ…æ‹¬<strong>GEOMETRYã€POINTã€LINESTRINGå’ŒPOLYGONç­‰</strong>ã€‚ç›®å‰åªæœ‰MyISAMå­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ£€ç´¢ï¼Œè€Œä¸”ç´¢å¼•çš„å­—æ®µä¸èƒ½ä¸ºç©ºå€¼ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¿™ç±»ç´¢å¼•å¾ˆå°‘ä¼šç”¨åˆ°ã€‚</p>
<p><strong>å°ç»“:ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¹Ÿä¸ä¸€æ ·</strong></p>
<p>InnoDBï¼šæ”¯æŒB-treeã€Full-textç­‰ç´¢å¼•ï¼Œä¸æ”¯æŒHashç´¢å¼•</p>
<p>MyISAMï¼šæ”¯æŒB-treeã€Full-textç­‰ç´¢å¼•ï¼Œä¸æ”¯æŒHashç´¢å¼•</p>
<p>Memory :æ”¯æŒB-treeã€Hash ç­‰ç´¢å¼•ï¼Œä¸æ”¯æŒ Full-textç´¢å¼•</p>
<p>NDB :æ”¯æŒHashç´¢å¼•ï¼Œä¸æ”¯æŒ B-treeã€Full-textç­‰ç´¢å¼•;</p>
<p>Archive :ä¸æ”¯æŒB-treeã€Hashã€Full-textç­‰ç´¢å¼•;</p>
<h5 id="1-2åˆ›å»ºç´¢å¼•"><a href="#1-2åˆ›å»ºç´¢å¼•" class="headerlink" title="1.2åˆ›å»ºç´¢å¼•"></a>1.2åˆ›å»ºç´¢å¼•</h5><p>MySQLæ”¯æŒå¤šç§æ–¹æ³•åœ¨å•ä¸ªæˆ–å¤šä¸ªåˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼šåœ¨åˆ›å»ºè¡¨çš„å®šä¹‰è¯­å¥<strong>CREATE TABLE</strong>ä¸­æŒ‡å®šç´¢å¼•åˆ—ï¼Œä½¿ç”¨<strong>ALTER TABLE</strong>è¯­å¥åœ¨å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæˆ–è€…ä½¿ç”¨<strong>CREATE INDEX</strong>è¯­å¥åœ¨å·²å­˜åœ¨çš„è¡¨ä¸Šæ·»åŠ ç´¢å¼•</p>
<h6 id="1-åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•"><a href="#1-åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•" class="headerlink" title="1.åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•"></a><strong>1.åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼•</strong></h6><p>ä½¿ç”¨CREATE TABLEåˆ›å»ºè¡¨æ—¶ï¼Œé™¤äº†å¯ä»¥å®šä¹‰åˆ—çš„æ•°æ®ç±»å‹å¤–ï¼Œè¿˜å¯ä»¥å®šä¹‰ä¸»é”®çº¦æŸã€å¤–é”®çº¦æŸæˆ–è€…å”¯ä¸€æ€§çº¦æŸ,è€Œä¸è®ºåˆ›å»ºå“ªç§çº¦æŸï¼Œåœ¨å®šä¹‰çº¦æŸçš„åŒæ—¶ç›¸å½“äºåœ¨æŒ‡å®šåˆ—ä¸Šåˆ›å»ºäº†ä¸€ä¸ªç´¢å¼•ã€‚</p>
<p>ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652713242250.png" alt="1652713242250" loading="lazy"></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯æ˜¾å¼åˆ›å»ºè¡¨æ—¶åˆ›å»ºç´¢å¼•çš„è¯ï¼ŒåŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CRAETE TABLE table_name [col_name data_type]</span><br><span class="line">[UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name [length]) [ASC | DESC]</span><br></pre></td></tr></table></figure>

<ul>
<li>UNIQUEã€FULLTEXTå’ŒSPATIALä¸ºå¯é€‰å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼•</li>
<li>INDEXä¸KEYä¸ºåŒä¹‰è¯ï¼Œä¸¤è€…çš„ä½œç”¨ç›¸åŒï¼Œç”¨æ¥æŒ‡å®šåˆ›å»ºç´¢å¼•;</li>
<li>index_name æŒ‡å®šç´¢å¼•çš„åç§°ï¼Œä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆMySQLé»˜è®¤col_nameä¸ºç´¢å¼•å;</li>
<li>col_nameä¸ºéœ€è¦åˆ›å»ºç´¢å¼•çš„å­—æ®µåˆ—ï¼Œè¯¥åˆ—å¿…é¡»ä»æ•°æ®è¡¨ä¸­å®šä¹‰çš„å¤šä¸ªåˆ—ä¸­é€‰æ‹©;</li>
<li>lengthä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ï¼Œåªæœ‰å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ‰èƒ½æŒ‡å®šç´¢å¼•é•¿åº¦;</li>
<li>ASC æˆ– DESCæŒ‡å®šå‡åºæˆ–è€…é™åºçš„ç´¢å¼•å€¼å­˜å‚¨ã€‚</li>
</ul>
<p><strong>1.åˆ›å»ºæ™®é€šç´¢å¼•</strong></p>
<p>åœ¨bookè¡¨ä¸­çš„year_publicationå­—æ®µä¸Šå»ºç«‹æ™®é€šç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652713829189.png" alt="1652713829189" loading="lazy"></p>
<p>ä½¿ç”¨EXPLAINè¯­å¥æŸ¥çœ‹æ˜¯å¦æ­£åœ¨ä½¿ç”¨ï¼š<img src="/2022/04/22/MySQL/1652713862370.png" alt="1652713862370" loading="lazy"></p>
<p>EXPLAINè¯­å¥è¾“å‡ºç»“æœä¸»è¦å…³æ³¨ä¸¤ä¸ªå­—æ®µï¼š</p>
<p>ï¼ˆ1ï¼‰possible_keysè¡Œç»™å‡ºäº†MySQLåœ¨æœç´¢æ•°æ®è®°å½•æ—¶å¯é€‰ç”¨çš„ç´¢å¼•</p>
<p>ï¼ˆ2ï¼‰keyè¡Œæ˜¯Mæœ‰SQLå®é™…é€‰ç”¨çš„ç´¢å¼•</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œpossible_keyså’Œkeyçš„å€¼éƒ½ä¸ºyear_publicationï¼ŒæŸ¥è¯¢æ—¶ä½¿ç”¨äº†ç´¢å¼•</p>
<p><strong>2.åˆ›å»ºå”¯ä¸€ç´¢å¼•</strong></p>
<p>åˆ›å»ºå”¯ä¸€ç´¢å¼•çš„ç›®çš„ä¹Ÿæ˜¯<strong>å‡å°‘æŸ¥è¯¢ç´¢å¼•åˆ—æ“ä½œçš„æ‰§è¡Œæ—¶é—´</strong>ï¼Œå°¤å…¶æ˜¯å¯¹æ¯”è¾ƒåºå¤§çš„æ•°æ®è¡¨ã€‚å®ƒä¸å‰é¢çš„æ™®é€šç´¢å¼•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯:ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚å¦‚æœæ˜¯<strong>ç»„åˆç´¢å¼•</strong>ï¼Œåˆ™åˆ—å€¼çš„<strong>ç»„åˆå¿…é¡»å”¯ä¸€ã€‚</strong></p>
<p>ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652714131616.png" alt="1652714131616" loading="lazy"></p>
<p>è¯¥è¯­å¥æ‰§è¡Œå®Œåï¼Œä½¿ç”¨show create tableæŸ¥çœ‹è¡¨ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM test1 \G</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å„ä¸ªä¸»è¦å‚æ•°çš„å«ä¹‰ä¸º:</p>
<p>(1) Tableè¡¨ç¤ºåˆ›å»ºç´¢å¼•çš„è¡¨ã€‚</p>
<p>(2) Non_uniqueè¡¨ç¤ºç´¢å¼•éå”¯ä¸€ï¼Œ1ä»£è¡¨éå”¯ä¸€ç´¢å¼•ï¼Œoä»£è¡¨å”¯ä¸€ç´¢å¼•ã€‚</p>
<p>(3)Key_nameè¡¨ç¤ºç´¢å¼•çš„åç§°ã€‚</p>
<p>(4) Seq_in_indexè¡¨ç¤ºè¯¥å­—æ®µåœ¨ç´¢å¼•ä¸­çš„ä½ç½®ï¼Œå•åˆ—ç´¢å¼•è¯¥å€¼ä¸º1ï¼Œç»„åˆç´¢å¼•ä¸ºæ¯ä¸ªå­—æ®µåœ¨ç´¢å¼•å®šä¹‰ä¸­çš„é¡ºåºã€‚</p>
<p>(5)Column_nameè¡¨ç¤ºå®šä¹‰ç´¢å¼•çš„åˆ—å­—æ®µã€‚</p>
<p>(6) Sub_partè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ã€‚</p>
<p>(7ï¼‰Nullè¡¨ç¤ºè¯¥å­—æ®µæ˜¯å¦èƒ½ä¸ºç©ºå€¼ã€‚(8 ) Index_typeè¡¨ç¤ºç´¢å¼•ç±»å‹ã€‚</p>
<p>æœ‰ç»“æœå¯ä»¥çœ‹å‡ºï¼Œidå­—æ®µä¸Šå·²ç»æˆåŠŸå»ºç«‹äº†ä¸€ä¸ªåä¸ºuk_idx_idçš„å”¯ä¸€ç´¢å¼•ã€‚</p>
<p><strong>3.ä¸»é”®ç´¢å¼•</strong></p>
<p>è®¾å®šä¸ºä¸»é”®åæ•°æ®åº“ä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼•ï¼ŒInnoDBä¸ºèšç°‡ç´¢å¼•ï¼Œè¯­æ³•ï¼š</p>
<ul>
<li><p>éšè¡¨ä¸€èµ·é”®ç´¢å¼•ï¼š<img src="/2022/04/22/MySQL/1652714405177.png" alt="1652714405177" loading="lazy"></p>
</li>
<li><p>åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š<img src="/2022/04/22/MySQL/1652714434090.png" alt="1652714434090" loading="lazy"></p>
</li>
<li><p>ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼šå¿…é¡»å…ˆåˆ é™¤æ‰(drop)åŸç´¢å¼•ï¼Œå†æ–°å»º(add)ç´¢å¼•</p>
</li>
</ul>
<p><strong>4.åˆ›å»ºå•åˆ—ç´¢å¼•</strong></p>
<p>å•åˆ—ç´¢å¼•æ˜¯å†æ•°æ®è¡¨ä¸­çš„æŸä¸€å­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªå•åˆ—ç´¢å¼•ã€‚å‰é¢ä¾‹å­ä¸­åˆ›å»ºçš„ç´¢å¼•éƒ½ä¸ºå•åˆ—ç´¢å¼•</p>
<p>ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652714567371.png" alt="1652714567371" loading="lazy"></p>
<p>è¯¥è¯­å¥æ‰§è¡Œå®Œæ¯•åï¼Œä½¿ç”¨show create tableæŸ¥çœ‹è¡¨ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM test2 \G</span><br></pre></td></tr></table></figure>

<p>æœ‰ç»“æœå¯ä»¥çœ‹å‡ºï¼Œidå­—æ®µä¸Šå·²ç»æˆåŠŸå»ºç«‹ä¸€ä¸ªåä¸ºsingle_idx_nameçš„å•åˆ—ç´¢å¼•ï¼Œç´¢å¼•é•¿åº¦ä¸º20</p>
<p><strong>5.åˆ›å»ºç»„åˆç´¢å¼•</strong></p>
<p>ç»„åˆç´¢å¼•æ˜¯åœ¨å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•    ã€‚</p>
<p>ä¸¾ä¾‹ï¼šåˆ›å»ºè¡¨test3ï¼Œåœ¨è¡¨ä¸­çš„idã€nameå’Œageå­—æ®µä¸Šå»ºç«‹ç»„åˆç´¢å¼•ï¼š<img src="/2022/04/22/MySQL/1652714712614.png" alt="1652714712614" loading="lazy"></p>
<p>è¯¥è¯­å¥æ‰§è¡Œå®Œåï¼Œä½¿ç”¨SHOW INDEX :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM test3 \G</span><br></pre></td></tr></table></figure>

<p>ç”±ç»“æœå¯ä»¥çœ‹åˆ°;idã€nameå’Œageå­—æ®µä¸Šå·²ç»æˆåŠŸå»ºç«‹äº†ä¸€ä¸ªåä¸ºmulti_idxçš„ç»„åˆç´¢å¼•ã€‚</p>
<p>ç»„åˆç´¢å¼•å¯èµ·å‡ ä¸ªç´¢å¼•çš„ä½œç”¨ï¼Œä½†æ˜¯ä½¿ç”¨æ—¶å¹¶ä¸æ˜¯éšä¾¿æŸ¥è¯¢å“ªä¸ªå­—æ®µéƒ½å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œè€Œæ˜¯éµä»â€œæœ€å·¦å‰uâ€ã€‚ä¾‹å¦‚ï¼Œç´¢å¼•å¯ä»¥æœç´¢çš„å­—æ®µç»„åˆä¸º:ï¼ˆid, name, age) . (id,name)æˆ–è€…idã€‚è€Œ(age)æˆ–è€… (name,age)ç»„åˆä¸èƒ½ä¾¿ç”¨ç´¢å¼•æŸ¥è¯¢ã€‚</p>
<p>åœ¨test3è¡¨ä¸­ï¼ŒæŸ¥è¯¢idå’Œnameå­—æ®µï¼Œä½¿ç”¨EXPLAINè¯­å¥æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM test3 WHERE id=1 AND nam=â€zhangsanâ€œ \G</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢idå’Œnameå­—æ®µæ—¶ï¼Œä½¿ç”¨äº†åç§°ä¸ºMultildxçš„ç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢(name,age)ç»„åˆæˆ–è€…å•ç‹¬æŸ¥è¯¢nameå’Œageå­—æ®µï¼Œä¼šå‘ç°ç»“æœä¸­possible_keyså’Œkeyå€¼ä¸ºNULLï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨åœ¨t3è¡¨ä¸­åˆ›å»ºçš„ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢</p>
<p><strong>6.åˆ›å»ºå…¨æ–‡ç´¢å¼•</strong></p>
<p>FULLTEXTå…¨æ–‡ç´¢å¼•å¯ä»¥ç”¨äºå…¨æ–‡æœç´¢ï¼Œå¹¶ä¸”åªä¸ºCHARã€VARCHAR å’ŒTEXTåˆ—åˆ›å»ºç´¢å¼•ã€‚ç´¢å¼•æ€»æ˜¯å¯¹æ•´ä¸ªåˆ—è¿›è¡Œï¼Œä¸æ”¯æŒå±€éƒ¨ï¼ˆå‰ç¼€ï¼‰ç´¢å¼•ã€‚</p>
<p>ä¸¾ä¾‹1:åˆ›å»ºè¡¨test4ï¼Œåœ¨è¡¨ä¸­çš„infoå­—æ®µä¸Šå»ºç«‹å…¨æ–‡ç´¢å¼•ï¼ŒSQLè¯­å¥å¦‚ä¸‹:<img src="/2022/04/22/MySQL/1652715009226.png" alt="1652715009226" loading="lazy"></p>
<blockquote>
<p>åœ¨MySQL5.7åŠä¹‹åç‰ˆæœ¬ä¸­å¯ä»¥æŒ‡å®šæœ€åçš„ENGINEï¼Œå› ä¸ºåœ¨æ­¤ç‰ˆæœ¬ä¸­InnoDBæ”¯æŒå…¨æ–‡ç´¢å¼•</p>
</blockquote>
<p>è¯­å¥æ‰§è¡Œå®Œåï¼Œä½¿ç”¨SHOW CREATE TABLEæŸ¥çœ‹è¡¨ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM test4 \G</span><br></pre></td></tr></table></figure>

<p>æœ‰ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œinfoå­—æ®µä¸Šå·²ç»æˆåŠŸå»ºç«‹äº†ä¸€ä¸ªåä¸ºfutxt_idx_infoçš„FULLTEXTç´¢å¼•ã€‚</p>
<p>ä¸¾ä¾‹2ï¼š<img src="/2022/04/22/MySQL/1652715210828.png" alt="1652715210828" loading="lazy"></p>
<p>åˆ›å»ºäº†ä¸€ä¸ªä¸ªtitleå’Œbodyå­—æ®µæ·»åŠ å…¨æ–‡ç´¢å¼•çš„è¡¨</p>
<p>ä¸¾ä¾‹3ï¼š<img src="/2022/04/22/MySQL/1652715257722.png" alt="1652715257722" loading="lazy"></p>
<p>ä¸åŒäºlikeæ–¹å¼çš„æŸ¥è¯¢ï¼š<img src="/2022/04/22/MySQL/1652715332857.png" alt="1652715332857" loading="lazy"></p>
<p>å…¨æ–‡ç´¢å¼•ç”¨match+againstæ–¹å¼æŸ¥è¯¢ï¼š<img src="/2022/04/22/MySQL/1652715357719.png" alt="1652715357719" loading="lazy"></p>
<p>æ˜æ˜¾çš„æé«˜æŸ¥è¯¢æ•ˆç‡</p>
<blockquote>
<p>æ³¨æ„ç‚¹ï¼š</p>
<p>1.ä½¿ç”¨å…¨æ–‡ç´¢å¼•å‰ï¼Œææ¸…æ¥šç‰ˆæœ¬æ”¯æŒæƒ…å†µ;<br>2.å…¨æ–‡ç´¢å¼•æ¯”like + %å¿«Nå€ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ç²¾åº¦é—®é¢˜;<br>3ï¼å¦‚æœéœ€è¦å…¨æ–‡ç´¢å¼•çš„æ˜¯å¤§é‡æ•°æ®,å»ºè®®å…ˆæ·»åŠ æ•°æ®Iå†åˆ›å»ºç´¢å¼•ã€‚</p>
</blockquote>
<p><strong>7.åˆ›å»ºç©ºé—´ç´¢å¼•</strong></p>
<p>åˆ›å»ºç©ºé—´ç´¢å¼•ä¸­ï¼Œè¦æ±‚ç©ºé—´ç±»å‹çš„å­—æ®µå¿…é¡»éç©º</p>
<p>ä¸¾ä¾‹ï¼šåˆ›å»ºtest5ï¼Œåœ¨ç©ºé—´ç±»å‹ä¸ºGEOMETRYçš„å­—æ®µä¸Šåˆ›å»ºç©ºé—´ç´¢å¼•ï¼š<img src="/2022/04/22/MySQL/1652715501264.png" alt="1652715501264" loading="lazy"></p>
<p>è¯¥è¯­å¥æ‰§è¡Œå®Œåï¼Œä½¿ç”¨SHOW CREATE TABLEæŸ¥çœ‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM test5 \G </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œtest5è¡¨çš„geoå­—æ®µä¸Šåˆ›å»ºäº†åç§°ä¸ºspa_idx_geoçš„ç©ºé—´ç´¢å¼•ã€‚æ³¨æ„åˆ›å»ºæ—¶æŒ‡å®šç©ºé—´ç±»å‹å­—æ®µå€¼çš„éç©ºçº¦æŸï¼Œå¹¶ä¸”è¡¨çš„å­˜å‚¨å¼•æ“ä¸ºMyISAMã€‚</p>
<h6 id="2-åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•"><a href="#2-åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•" class="headerlink" title="2.åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•"></a>2.åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</h6><p>åœ¨å·²ç»å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•å¯ä»¥ä½¿ç”¨ALTER TABLEâ€¦ADDâ€¦æˆ–è€…CREATE INDEXâ€¦ONâ€¦è¯­å¥</p>
<p><strong>åŸºæœ¬è¯­æ³•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1ã€åˆ›å»ºç´¢å¼• [UNIQUE]å¯ä»¥çœç•¥</span></span><br><span class="line"><span class="comment">-- å¦‚æœåªå†™ä¸€ä¸ªå­—æ®µå°±æ˜¯å•å€¼ç´¢å¼•ï¼Œå†™å¤šä¸ªå­—æ®µå°±æ˜¯å¤åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span>] INDEX indexName <span class="keyword">ON</span> tabName(columnName(length));</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tabName <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span>] INDEX indexName (columnName(length));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2ã€åˆ é™¤ç´¢å¼•</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX [indexName] <span class="keyword">ON</span> tabName;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> INDEX index_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3ã€æŸ¥çœ‹ç´¢å¼•</span></span><br><span class="line"><span class="comment">-- åŠ ä¸Š\Gå°±å¯ä»¥ä»¥åˆ—çš„å½¢å¼æŸ¥çœ‹äº† ä¸åŠ \Gå°±æ˜¯ä»¥è¡¨çš„å½¢å¼æŸ¥çœ‹</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> tabName \G;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tabname \G;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨alterå‘½ä»¤ä¸ºæ•°æ®è¡¨æ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1ã€è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tabName <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(column_list);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2ã€è¯¥è¯­å¥åˆ›å»ºç´¢å¼•çš„é”®å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„(é™¤äº†NULLä¹‹å¤–ï¼ŒNULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tabName <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> INDEX indexName(column_list);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3ã€è¯¥è¯­å¥åˆ›å»ºæ™®é€šç´¢å¼•ï¼Œç´¢å¼•å€¼å¯ä»¥å‡ºç°å¤šæ¬¡</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tabName <span class="keyword">ADD</span> INDEX indexName(column_list);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4ã€è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸ºFULLTEXTï¼Œç”¨äºå…¨æ–‡æ£€ç´¢</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tabName <span class="keyword">ADD</span> FULLTEXT indexName(column_list);</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨createæ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#æ·»åŠ æ™®é€šç´¢å¼•</span><br><span class="line">CREATE INDEX indexname ON tabname(column_list)</span><br><span class="line"></span><br><span class="line">#æ·»åŠ å”¯ä¸€ç´¢å¼•</span><br><span class="line">CREATE UNIQUE INDEX indexname ON tabname(column_list)</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºå•åˆ—ç´¢å¼•</span><br><span class="line">CREATE INDEX indexname ON tabname(column_list(length))</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç»„åˆç´¢å¼•</span><br><span class="line">CREATE IDNEX idx_aut_info ON tabname(authors(20),info(50))</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºä¸»é”®ç´¢å¼•</span><br><span class="line">CREATE PRIMARY KEY ON tabname(column_list)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æç¤ºï¼šæ·»åŠ AUTO_INCRMENTçº¦æŸå­—æ®µçš„å”¯ä¸€ç´¢å¼•ä¸èƒ½åˆ é™¤</p>
<p>åˆ é™¤è¡¨ä¸­çš„åˆ—æ—¶ï¼Œå¦‚æœè¦åˆ é™¤çš„åˆ—ä¸ºç´¢å¼•çš„ç»„æˆéƒ¨åˆ†ï¼Œåˆ™è¯¥åˆ—ä¹Ÿä¼šä»ç´¢å¼•ä¸­åˆ é™¤ã€‚å¦‚æœç»„æˆç´¢å¼•çš„æ‰€æœ‰åˆ—éƒ½è¢«åˆ é™¤ï¼Œåˆ™æ•´ä¸ªç´¢å¼•å°†è¢«åˆ é™¤ã€‚</p>
</blockquote>
<h4 id="2-MySQL8-0ç´¢å¼•æ–°ç‰¹æ€§"><a href="#2-MySQL8-0ç´¢å¼•æ–°ç‰¹æ€§" class="headerlink" title="2.MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§"></a>2.MySQL8.0ç´¢å¼•æ–°ç‰¹æ€§</h4><h5 id="2-1æ”¯æŒé™åºç´¢å¼•"><a href="#2-1æ”¯æŒé™åºç´¢å¼•" class="headerlink" title="2.1æ”¯æŒé™åºç´¢å¼•"></a>2.1æ”¯æŒé™åºç´¢å¼•</h5><p>é™åºç´¢å¼•ä»¥é™åºå­˜å‚¨é”®å€¼ã€‚è™½ç„¶åœ¨è¯­æ³•ä¸Šï¼Œä»MySQL 4ç‰ˆæœ¬å¼€å§‹å°±å·²ç»æ”¯æŒé™åºç´¢å¼•çš„è¯­æ³•äº†ï¼Œä½†å®é™…ä¸Šè¯¥DESCå®šä¹‰æ˜¯è¢«å¿½ç•¥çš„ï¼Œç›´åˆ°MysQL 8.xç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼•(ä»…é™äºInnoDBå­˜å‚¨å¼•æ“)ã€‚</p>
<p>MySQLåœ¨<strong>8.0ç‰ˆæœ¬ä¹‹å‰åˆ›å»ºçš„ä»ç„¶æ˜¯å‡åºç´¢å¼•ï¼Œä½¿ç”¨æ—¶è¿›è¡Œåå‘æ‰«æï¼Œè¿™å¤§å¤§é™ä½äº†æ•°æ®åº“çš„æ•ˆç‡ã€‚</strong>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé™åºç´¢å¼•æ„ä¹‰é‡å¤§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢ï¼Œéœ€è¦å¯¹å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œä¸”é¡ºåºè¦æ±‚ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä½¿ç”¨é™åºç´¢å¼•å°†ä¼šé¿å…æ•°æ®åº“ä½¿ç”¨é¢å¤–çš„æ–‡ä»¶æ’åºæ“ä½œï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p>ä¸¾ä¾‹:åˆ†åˆ«åœ¨MySQL 5.7ç‰ˆæœ¬å’ŒMySQL 8.0ç‰ˆæœ¬ä¸­åˆ›å»ºæ•°æ®è¡¨ts1ï¼Œç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE ts1(a int,b int,index idx_a_b(a,b,desc));#aåä¸å†™ascé»˜è®¤æ˜¯å‡åº</span><br></pre></td></tr></table></figure>

<p>åœ¨MySQL5.7ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„ç»“æ„ï¼Œç»“æœå¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652720607329.png" alt="1652720607329" loading="lazy"></p>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç´¢å¼•ä»ç„¶æ˜¯é»˜è®¤çš„å‡åº(ä½¿ç”¨æ—¶åå‘æ‰«æ)ã€‚<br>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„ç»“æ„ï¼Œç»“æœå¦‚ä¸‹:</p>
<p><img src="/2022/04/22/MySQL/1652720629046.png" alt="1652720629046" loading="lazy"></p>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç´¢å¼•å·²ç»æ˜¯é™åºã€‚ä¸‹é¢ç»§ç»­æµ‹è¯•é™åºç´¢å¼•åœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„è¡¨ç°ã€‚</p>
<p>åˆ†åˆ«åœ¨MySQL 5.7ç‰ˆæœ¬å’ŒMySQL 8.oç‰ˆæœ¬çš„æ•°æ®è¡¨ts1ä¸­æ’å…¥800æ¡éšæœºæ•°æ®ï¼Œæ‰§è¡Œè¯­å¥å¦‚ä¸‹:<img src="/2022/04/22/MySQL/1652720704825.png" alt="1652720704825" loading="lazy"></p>
<p>åœ¨MySQL5.7ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„æ‰§è¡Œè®¡åˆ’ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM ts1 ORDER BY a,b DESC LIMIT 5;</span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ‰§è¡Œè®¡åˆ’ä¸­æ‰«ææ•°ä¸º799ï¼Œè€Œä¸”ä½¿ç”¨äº†Using filesortã€‚<img src="/2022/04/22/MySQL/1652720880325.png" alt="1652720880325" loading="lazy"></p>
<blockquote>
<p>æç¤º<br>Using filesortæ˜¯MysQLä¸­ä¸€ç§é€Ÿåº¦æ¯”è¾ƒæ…¢çš„å¤–éƒ¨æ’åºï¼Œèƒ½é¿å…æ˜¯æœ€å¥½çš„ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡ä¼˜åŒ–ç´¢å¼•æ¥å°½é‡é¿å…å‡ºç°Using filesortï¼Œä»è€Œæé«˜æ•°æ®åº“æ‰§è¡Œé€Ÿåº¦ã€‚</p>
</blockquote>
<p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­æŸ¥çœ‹æ•°æ®è¡¨ts1çš„æ‰§è¡Œè®¡åˆ’ã€‚ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ‰§è¡Œè®¡åˆ’ä¸­æ‰«ææ•°ä¸º5ï¼Œè€Œä¸”æ²¡æœ‰ä½¿ç”¨Usingfilesortã€‚</p>
<p><img src="/2022/04/22/MySQL/1652720942195.png" alt="1652720942195" loading="lazy"></p>
<blockquote>
<p>æ³¨æ„<br>é™åºç´¢å¼•åªå¯¹æŸ¥è¯¢ä¸­ç‰¹å®šçš„æ’åºé¡ºåºæœ‰æ•ˆï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œåè€ŒæŸ¥è¯¢æ•ˆç‡æ›´ä½ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°æŸ¥è¯¢æ’åºæ¡ä»¶æ”¹ä¸ºorder by a desc, b descï¼ŒMySQL 5.7çš„æ‰§è¡Œè®¡åˆ’è¦æ˜æ˜¾å¥½äºMySQL 8.0ã€‚</p>
</blockquote>
<h5 id="2-2éšè—ç´¢å¼•"><a href="#2-2éšè—ç´¢å¼•" class="headerlink" title="2.2éšè—ç´¢å¼•"></a>2.2éšè—ç´¢å¼•</h5><p>åœ¨MysQL 5.7ç‰ˆæœ¬åŠä¹‹å‰ï¼Œåªèƒ½é€šè¿‡æ˜¾å¼çš„æ–¹å¼åˆ é™¤ç´¢å¼•ã€‚æ­¤æ—¶ï¼Œå¦‚æœå‘ç°åˆ é™¤ç´¢å¼•åå‡ºç°é”™è¯¯ï¼Œåˆåªèƒ½é€šè¿‡æ˜¾å¼åˆ›å»ºç´¢å¼•çš„æ–¹å¼å°†åˆ é™¤çš„ç´¢å¼•åˆ›å»ºå›æ¥ã€‚å¦‚æœæ•°æ®è¡¨ä¸­çš„æ•°æ®é‡éå¸¸å¤§ï¼Œæˆ–è€…æ•°æ®è¡¨æœ¬èº«æ¯”è¾ƒå¤§ï¼Œè¿™ç§æ“ä½œå°±ä¼šæ¶ˆè€—ç³»ç»Ÿè¿‡å¤šçš„èµ„æºï¼Œæ“ä½œæˆæœ¬éå¸¸é«˜ã€‚</p>
<p>ä»MysQL 8.xå¼€å§‹æ”¯æŒ<strong>éšè—ç´¢å¼•(<strong>invisible indexesï¼‰ï¼Œåªéœ€è¦å°†å¾…åˆ é™¤çš„ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œä½¿æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å†ä½¿ç”¨è¿™ä¸ªç´¢å¼•(å³ä½¿ä½¿ç”¨force index(å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•)ï¼Œä¼˜åŒ–å™¨ä¹Ÿä¸ä¼šä½¿ç”¨è¯¥ç´¢å¼•)ï¼Œç¡®è®¤å°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•åç³»ç»Ÿä¸å—ä»»ä½•å“åº”ï¼Œå°±å¯ä»¥å½»åº•åˆ é™¤ç´¢å¼•ã€‚è¿™ç§é€šè¿‡</strong>å…ˆå°†ç´¢å¼•è®¾ç½®ä¸ºéšè—ç´¢å¼•ï¼Œå†åˆ é™¤ç´¢å¼•çš„æ–¹å¼å°±æ˜¯è½¯åˆ é™¤ã€‚</strong></p>
<p>åŒæ—¶ï¼Œå¦‚æœä½ æƒ³éªŒè¯<strong>æŸä¸ªç´¢å¼•åˆ é™¤ä¹‹åçš„æŸ¥è¯¢æ€§èƒ½å½±å“</strong>ï¼Œå°±å¯ä»¥æš‚æ—¶å…ˆéšè—è¯¥ç´¢å¼•ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>ä¸»é”®ä¸èƒ½è¢«è®¾ç½®ä¸ºéšè—ç´¢å¼•ã€‚å½“è¡¨ä¸­æ²¡æœ‰æ˜¾ç¤ºä¸»é”®æ—¶ï¼Œè¡¨ä¸­ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•ä¼šç§°ä¸ºéšå¼ä¸»é”®ï¼Œä¹Ÿä¸èƒ½è®¾ç½®ä¸ºéšè—ç´¢å¼•</p>
</blockquote>
<p>ç´¢å¼•é»˜è®¤æ˜¯å¯è§çš„ï¼Œåœ¨ä½¿ç”¨CREATETABLEï¼ŒCREATE INDEXæˆ–è€…ALTERTABLEç­‰è¯­å¥æ—¶å¯ä»¥é€šè¿‡<strong>VISIBLEæˆ–è€…INVISIBLE</strong>å…³é”®è¯è®¾ç½®ç´¢å¼•çš„å¯è§æ€§ã€‚</p>
<p><strong>1.åˆ›å»ºè¡¨æ—¶ç›´æ¥åˆ›å»º</strong></p>
<p>åœ¨MySQLä¸­åˆ›å»ºéšè—ç´¢å¼•é€šè¿‡SQLè¯­å¥INVISIBLEæ¥å®ç°ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652755737778.png" alt="1652755737778" loading="lazy"><br>ä¸Šè¿°è¯­å¥æ¯”æ™®é€šç´¢å¼•å¤šäº†ä¸€ä¸ªå…³é”®å­—INVISIBLEï¼Œç”¨æ¥æ ‡è®°ç´¢å¼•ä¸ºä¸å¯è§ç´¢å¼•</p>
<p>ç»ƒä¹ ï¼šåœ¨åˆ›å»ºç­çº§è¡¨classesæ—¶ï¼Œåœ¨å­—æ®µcnameä¸Šåˆ›å»ºéšè—ç´¢å¼•</p>
<p><img src="/2022/04/22/MySQL/1652756053065.png" alt="1652756053065" loading="lazy"></p>
<p>å‘è¡¨ä¸­æ·»åŠ æ•°æ®ï¼Œå¹¶é€šè¿‡explainæŸ¥çœ‹å‘ç°ï¼Œä¼˜åŒ–å™¨å¹¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œè€Œæ˜¯å…¨è¡¨æ‰«æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM classes HWERE cname = â€˜é«˜ä¸€â€™</span><br></pre></td></tr></table></figure>

<p><strong>2.åœ¨å·²å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºç´¢å¼•</strong></p>
<p>å¯ä»¥ä¸ºå·²ç»å­˜åœ¨çš„è¡¨è®¾ç½®éšè—ç´¢å¼•ï¼Œå…¶è¯­æ³•ï¼š<img src="/2022/04/22/MySQL/1652756211837.png" alt="1652756211837" loading="lazy"></p>
<p>ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652756235603.png" alt="1652756235603" loading="lazy"></p>
<p><strong>3.é€šè¿‡ALTER TABLEè¯­å¥åˆ›å»º</strong></p>
<p>è¯­æ³•ï¼š<img src="/2022/04/22/MySQL/1652756264542.png" alt="1652756264542" loading="lazy"></p>
<p>ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652756283342.png" alt="1652756283342" loading="lazy"></p>
<p><strong>4.æ¢å¤ç´¢å¼•å¯è§æ€§çŠ¶æ€</strong><img src="/2022/04/22/MySQL/1652756304291.png" alt="1652756304291" loading="lazy"></p>
<p>å¦‚æœå°†index_cnameç´¢å¼•åˆ‡æ¢æˆå¯è§çŠ¶æ€ï¼Œé€šè¿‡explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°ä¼˜åŒ–å™¨é€‰æ‹©äº†index_cnameç´¢å¼•ã€‚</p>
<blockquote>
<p>æ³¨æ„<br>å½“ç´¢å¼•è¢«éšè—æ—¶ï¼Œå®ƒçš„å†…å®¹ä»ç„¶æ˜¯å’Œæ­£å¸¸ç´¢å¼•ä¸€æ ·å®æ—¶æ›´æ–°çš„ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•éœ€è¦é•¿æœŸè¢«éšè—ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶åˆ é™¤ï¼Œå› ä¸ºç´¢å¼•çš„å­˜åœ¨ä¼šå½±å“æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„æ€§èƒ½ã€‚</p>
</blockquote>
<p>é€šè¿‡è®¾ç½®éšè—ç´¢å¼•çš„å¯è§æ€§å¯ä»¥æŸ¥çœ‹ç´¢å¼•å¯¹è°ƒä¼˜çš„å¸®åŠ©ã€‚</p>
<p><strong>5.ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§</strong></p>
<p>åœ¨MySQL 8.xç‰ˆæœ¬ä¸­ï¼Œä¸ºç´¢å¼•æä¾›äº†ä¸€ç§æ–°çš„æµ‹è¯•æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ä¸€ä¸ªå¼€å…³(use_invisible_indexes)æ¥æ‰“å¼€æŸä¸ªè®¾ç½®ï¼Œä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ã€‚å¦‚æœuse_invisible_indexes è®¾ç½®ä¸ºof(é»˜è®¤)ï¼Œä¼˜åŒ–å™¨ä¼šå¿½ç•¥éšè—ç´¢å¼•ã€‚å¦‚æœè®¾ç½®ä¸ºonï¼Œå³ä½¿éšè—ç´¢å¼•ä¸å¯è§ï¼Œä¼˜åŒ–å™¨åœ¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶ä»ä¼šè€ƒè™‘ä½¿ç”¨éšè—ç´¢å¼•ã€‚</p>
<p>ï¼ˆ1ï¼‰åœ¨MySQLå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³è®¾ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@optimizer_switch \G</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å‡ºä¿¡æ¯ä¸­æ‰¾åˆ°å¦‚ä¸‹å±æ€§é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sue_inviaible_indexes=off</span><br></pre></td></tr></table></figure>

<p>æ­¤å±æ€§é…ç½®å€¼ä¸ºoffï¼Œè¯´æ˜éšè—ç´¢å¼•é»˜è®¤å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å¯è§.</p>
<p>ï¼ˆ2ï¼‰ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ï¼Œéœ€è¦åœ¨MySQLå‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<img src="/2022/04/22/MySQL/1652756667403.png" alt="1652756667403" loading="lazy"></p>
<p>å†æ¬¡æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„å¼€å…³è®¾ç½®<img src="/2022/04/22/MySQL/1652756765892.png" alt="1652756765892" loading="lazy"></p>
<p>æ­¤æ—¶ï¼Œåœ¨è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼š<img src="/2022/04/22/MySQL/1652756802677.png" alt="1652756802677" loading="lazy"></p>
<p>è¯´æ˜ï¼Œæ­¤æ—¶éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨å¯è§ã€‚</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨EXPLAINæŸ¥çœ‹ä»¥å­—æ®µinvisible_columnä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ<img src="/2022/04/22/MySQL/1652756880490.png" alt="1652756880490" loading="lazy"></p>
<p>(4ï¼‰å¦‚æœéœ€è¦ä½¿éšè—ç´¢å¼•å¯¹æŸ¥è¯¢ä¼˜åŒ–å™¨ä¸å¯è§ï¼Œåˆ™åªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ã€‚<img src="/2022/04/22/MySQL/1652756899448.png" alt="1652756899448" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652756906743.png" alt="1652756906743" loading="lazy"></p>
<h4 id="3-ç´¢å¼•çš„è®¾è®¡åŸåˆ™"><a href="#3-ç´¢å¼•çš„è®¾è®¡åŸåˆ™" class="headerlink" title="3.ç´¢å¼•çš„è®¾è®¡åŸåˆ™"></a>3.ç´¢å¼•çš„è®¾è®¡åŸåˆ™</h4><p>ä¸ºäº†ä½¿ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¿…é¡»è€ƒè™‘åœ¨å“ªäº›å­—æ®µä¸Šåˆ›å»ºç´¢å¼•å’Œåˆ›å»ºä»€ä¹ˆç±»å‹çš„ç´¢å¼•ã€‚<strong>ç´¢å¼•è®¾è®¡ä¸åˆç†æˆ–è€…ç¼ºå°‘ç´¢å¼•éƒ½ä¼šå¯¹æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½é€ æˆéšœç¢</strong>ã€‚é«˜æ•ˆçš„ç´¢å¼•å¯¹äºé‚˜è·å¾—è‰¯å¥½çš„æ€§èƒ½éå¸¸é‡è¦ã€‚è®¾è®¡ç´¢å¼•æ—¶ï¼Œåº”è¯¥è€ƒè™‘ç›¸åº”å‡†åˆ™ã€‚</p>
<h5 id="3-1å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•"><a href="#3-1å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•" class="headerlink" title="3.1å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•"></a>3.1å“ªäº›æƒ…å†µé€‚åˆåˆ›å»ºç´¢å¼•</h5><h6 id="1-å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶"><a href="#1-å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶" class="headerlink" title="1.å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶"></a>1.<strong>å­—æ®µçš„æ•°å€¼æœ‰å”¯ä¸€æ€§çš„é™åˆ¶</strong></h6><p>ç´¢å¼•æœ¬èº«å¯ä»¥èµ·åˆ°çº¦æŸçš„ä½œç”¨ï¼Œæ¯”å¦‚å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•éƒ½æ˜¯å¯ä»¥èµ·åˆ°å”¯ä¸€æ€§çº¦æŸçš„ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„æ•°æ®è¡¨ä¸­ï¼Œå¦‚æœ<strong>æŸä¸ªå­—æ®µæ˜¯å”¯ä¸€æ€§çš„</strong>ï¼Œå°±å¯ä»¥ç›´æ¥<strong>åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œæˆ–è€…ä¸»é”®ç´¢å¼•</strong>ã€‚è¿™æ ·å¯ä»¥æ›´å¿«é€Ÿåœ°é€šè¿‡è¯¥ç´¢å¼•æ¥ç¡®å®šæŸæ¡è®°å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå­¦ç”Ÿè¡¨ä¸­å­¦å·æ˜¯å…·æœ‰å”¯ä¸€æ€§çš„å­—æ®µï¼Œä¸ºè¯¥å­—æ®µå»ºç«‹å”¯ä¸€æ€§ç´¢å¼•å¯ä»¥å¾ˆå¿«ç¡®å®šæŸä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨å§“åçš„è¯ï¼Œå¯èƒ½å­˜åœ¨åŒåç°è±¡ï¼Œä»è€Œé™ä½æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<blockquote>
<p>ä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p>
<p>è¯´æ˜ï¼šä¸è¦ä»¥ä¸ºå”¯ä¸€ç´¢å¼•å½±å“äº†inserté€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦æŸè€—å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†æé«˜æŸ¥æ‰¾é€Ÿåº¦æ˜æ˜¾</p>
</blockquote>
<h6 id="2-é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ"><a href="#2-é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ" class="headerlink" title="2.é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ"></a>2.é¢‘ç¹ä½œä¸ºwhereæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ</h6><p>æŸä¸ªå­—æ®µåœ¨SELECTè¯­å¥çš„ WHERE æ¡ä»¶ä¸­ç»å¸¸è¢«ä½¿ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•äº†ã€‚å°¤å…¶æ˜¯åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºæ™®é€šç´¢å¼•å°±å¯ä»¥å¤§å¹…æå‡æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p>
<h6 id="3-ç»å¸¸-GROUP-BY-å’Œ-ORDER-BY-çš„åˆ—"><a href="#3-ç»å¸¸-GROUP-BY-å’Œ-ORDER-BY-çš„åˆ—" class="headerlink" title="3. ç»å¸¸ GROUP BY å’Œ ORDER BY çš„åˆ—"></a><strong>3.</strong> <strong>ç»å¸¸</strong> <strong>GROUP BY</strong> <strong>å’Œ</strong> <strong>ORDER BY</strong> <strong>çš„åˆ—</strong></h6><p>ç´¢å¼•å°±æ˜¯è®©æ•°æ®æŒ‰ç…§æŸç§é¡ºåºè¿›è¡Œå­˜å‚¨æˆ–æ£€ç´¢ï¼Œå› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨ GROUP BY å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œæˆ–è€… ä½¿ç”¨ ORDER BY å¯¹æ•°æ®è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œå°±éœ€è¦ <strong>å¯¹åˆ†ç»„æˆ–è€…æ’åºçš„å­—æ®µè¿›è¡Œç´¢å¼•</strong> ã€‚å¦‚æœå¾…æ’åºçš„åˆ—æœ‰å¤š ä¸ªï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™äº›åˆ—ä¸Šå»ºç«‹ <strong>ç»„åˆç´¢å¼•</strong> ã€‚</p>
<h6 id="4-UPDATEã€DELETEçš„-WHERE-æ¡ä»¶åˆ—"><a href="#4-UPDATEã€DELETEçš„-WHERE-æ¡ä»¶åˆ—" class="headerlink" title="4. UPDATEã€DELETEçš„ WHERE æ¡ä»¶åˆ—"></a><strong>4. UPDATEã€DELETEçš„ WHERE æ¡ä»¶åˆ—</strong></h6><p>å¯¹æ•°æ®æŒ‰ç…§æŸä¸ªæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢åå†è¿›è¡Œ UPDATE æˆ– DELETE çš„æ“ä½œï¼Œå¦‚æœå¯¹ WHERE å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Œå°± <strong>èƒ½å¤§å¹…æå‡æ•ˆç‡</strong>ã€‚åŸç†æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® WHERE æ¡ä»¶åˆ—æ£€ç´¢å‡ºæ¥è¿™æ¡è®°å½•ï¼Œç„¶åå†å¯¹å®ƒè¿›è¡Œæ›´æ–°æˆ– åˆ é™¤ã€‚<strong>å¦‚æœè¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ›´æ–°çš„å­—æ®µæ˜¯éç´¢å¼•å­—æ®µï¼Œæå‡çš„æ•ˆç‡ä¼šæ›´æ˜æ˜¾ï¼Œè¿™æ˜¯å› ä¸ºéç´¢å¼•å­—æ®µæ›´æ–°ä¸éœ€è¦å¯¹ç´¢å¼•è¿›è¡Œç»´æŠ¤ã€‚</strong> </p>
<h6 id="5-DISTINCTå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•"><a href="#5-DISTINCTå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="5.DISTINCTå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•"></a>5.DISTINCTå­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•</h6><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªå­—æ®µè¿›è¡Œå»é‡ï¼Œä½¿ç”¨ DISTINCTï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¹Ÿä¼šæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<h6 id="6-å¤šè¡¨JOINè¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹"><a href="#6-å¤šè¡¨JOINè¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹" class="headerlink" title="6.å¤šè¡¨JOINè¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹"></a>6.å¤šè¡¨JOINè¿æ¥æ“ä½œæ—¶ï¼Œåˆ›å»ºç´¢å¼•æ³¨æ„äº‹é¡¹</h6><p>é¦–å…ˆï¼Œ <strong>è¿æ¥è¡¨çš„æ•°é‡å°½é‡ä¸è¦è¶…è¿‡ 3 å¼ </strong> ï¼Œå› ä¸ºæ¯å¢åŠ ä¸€å¼ è¡¨å°±ç›¸å½“äºå¢åŠ äº†ä¸€æ¬¡åµŒå¥—çš„å¾ªç¯ï¼Œæ•°é‡çº§å¢é•¿ä¼šéå¸¸å¿«ï¼Œä¸¥é‡å½±å“æŸ¥è¯¢çš„æ•ˆç‡ã€‚ </p>
<p>å…¶æ¬¡ï¼Œ <strong>å¯¹ WHERE æ¡ä»¶åˆ›å»ºç´¢å¼•</strong> ï¼Œå› ä¸º WHERE æ‰æ˜¯å¯¹æ•°æ®æ¡ä»¶çš„è¿‡æ»¤ã€‚å¦‚æœåœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ WHERE æ¡ä»¶è¿‡æ»¤æ˜¯éå¸¸å¯æ€•çš„ã€‚ </p>
<p>æœ€åï¼Œ <strong>å¯¹ç”¨äºè¿æ¥çš„å­—æ®µåˆ›å»ºç´¢å¼•</strong> ï¼Œå¹¶ä¸”è¯¥å­—æ®µåœ¨å¤šå¼ è¡¨ä¸­çš„ <strong>ç±»å‹å¿…é¡»ä¸€è‡´</strong> ã€‚æ¯”å¦‚ course_id åœ¨student_info è¡¨å’Œ course è¡¨ä¸­éƒ½ä¸º int(11) ç±»å‹ï¼Œè€Œä¸èƒ½ä¸€ä¸ªä¸º int å¦ä¸€ä¸ªä¸º varchar ç±»å‹ã€‚ </p>
<blockquote>
<p>ä¸ºä»€ä¹ˆç±»å‹å¿…é¡»ä¸€è‡´ï¼šä¾‹ï¼šâ€˜101â€™=101ï¼›</p>
<p>ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œè°ƒç”¨å‡½æ•°ï¼Œç´¢å¼•ä¼šå¤±æ•ˆ</p>
</blockquote>
<h6 id="7-ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•"><a href="#7-ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•" class="headerlink" title="7.ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•"></a>7.ä½¿ç”¨åˆ—çš„ç±»å‹å°çš„åˆ›å»ºç´¢å¼•</h6><p>æˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„<strong>ç±»å‹å¤§å°</strong>æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹è¡¨ç¤ºçš„æ•°æ®èŒƒå›´çš„å¤§å°ã€‚</p>
<p>æˆ‘ä»¬åœ¨å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™è¦æ˜¾å¼çš„æŒ‡å®šåˆ—çš„ç±»å‹ï¼Œä»¥æ•´æ•°ç±»å‹ä¸ºä¾‹ï¼Œæœ‰<strong>TINYINTã€MEDIUMINTã€INTã€</strong><br><strong>BLGINT</strong>ç­‰ï¼Œå®ƒä»¬å ç”¨çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡é€’å¢ï¼Œèƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å½“ç„¶ä¹Ÿæ˜¯ä¾æ¬¡é€’å¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æŸä¸ªæ•´æ•°åˆ—å»ºç«‹ç´¢å¼•çš„è¯ï¼Œåœ¨è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©ç´¢å¼•åˆ—ä½¿ç”¨è¾ƒå°çš„ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬èƒ½<strong>ä½¿ç”¨INTå°±ä¸è¦ä½¿ç”¨BIGINT</strong>ï¼Œèƒ½ä½¿ç”¨MEDIUMINTå°±ä¸è¦ä½¿ç”¨INTã€‚è¿™æ˜¯å› ä¸º:</p>
<ul>
<li>æ•°æ®ç±»å‹è¶Šå°ï¼Œåœ¨æŸ¥è¯¢æ—¶è¿›è¡Œçš„æ¯”è¾ƒæ“ä½œè¶Šå¿«</li>
<li>æ•°æ®ç±»å‹è¶Šå°ï¼Œç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥æ”¾ä¸‹æ›´å¤šçš„è®°å½•ï¼Œä»è€Œå‡å°‘ç£ç›˜I/0å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æŠŠæ›´å¤šçš„æ•°æ®é¡µç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€ŒåŠ å¿«è¯»å†™æ•ˆç‡ã€‚</li>
</ul>
<p>è¿™ä¸ªç±»å‹å¯¹äºè¡¨çš„<strong>ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨</strong>ï¼Œå› ä¸ºä¸ä»…æ˜¯èšç°‡ç´¢å¼•ä¼šä½¿ç”¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ï¼Œå¦‚æœä¸»é”®ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´é«˜æ•ˆçš„I/Oã€‚</p>
<h6 id="8-ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•"><a href="#8-ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•" class="headerlink" title="8.ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•"></a>8.ä½¿ç”¨å­—ç¬¦ä¸²å‰ç¼€åˆ›å»ºç´¢å¼•</h6><p>å‡è®¾å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²å°±éœ€è¦å ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²åˆ—å»ºç«‹ç´¢å¼•æ—¶ï¼Œé‚£å°±æ„å‘³ç€åœ¨å¯¹åº”çš„B+æ ‘ä¸­æœ‰è¿™ä¹ˆä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>B+æ ‘ç´¢å¼•ä¸­çš„è®°å½•éœ€è¦æŠŠè¯¥åˆ—çš„å®Œæ•´å­—ç¬¦ä¸²å­˜å‚¨èµ·æ¥ï¼Œæ›´è´¹æ—¶ã€‚è€Œä¸”å­—ç¬¦ä¸²è¶Šé•¿ï¼Œåœ¨ç´¢å¼•ä¸­å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§ã€‚</li>
<li>å¦‚æœB+æ ‘ç´¢å¼•ä¸­ç´¢å¼•åˆ—å­˜å‚¨çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£åœ¨åšå­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ä¼šå ç”¨æ›´å¤šçš„æ—¶é—´ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆªå–å­—æ®µçš„å‰é¢ä¸€éƒ¨åˆ†å†…å®¹å»ºç«‹ç´¢å¼•ï¼Œè¿™ä¸ªå°±å«<strong>å‰ç¼€ç´¢å¼•</strong>ã€‚è¿™æ ·åœ¨æŸ¥æ‰¾è®°å½•æ—¶è™½ç„¶ä¸èƒ½ç²¾ç¡®çš„å®šä½åˆ°è®°å½•çš„ä½ç½®ï¼Œä½†æ˜¯èƒ½å®šä½åˆ°ç›¸åº”å‰ç¼€æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åæ ¹æ®å‰ç¼€ç›¸åŒçš„è®°å½•çš„ä¸»é”®å€¼å›è¡¨æŸ¥è¯¢å®Œæ•´çš„å­—ç¬¦ä¸²å€¼ã€‚<strong>æ—¢èŠ‚çº¦ç©ºé—´ï¼Œåˆå‡å°‘äº†å­—ç¬¦ä¸²çš„æ¯”è¾ƒæ—¶é—´</strong>ï¼Œè¿˜å¤§ä½“èƒ½è§£å†³æ’åºçš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚TEXTå’ŒBLOGç±»å‹çš„å­—æ®µï¼Œè¿›è¡Œå…¨æ–‡æ£€ç´¢ä¼šå¾ˆæµªè´¹æ—¶é—´ï¼Œå¦‚æœåªæ£€ç´¢å­—æ®µå‰é¢çš„è‹¥å¹²å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥æé«˜æ£€ç´¢é€Ÿåº¦ã€‚</p>
<p>åˆ›å»ºä¸€å¼ å•†æˆ·è¡¨ï¼Œå› ä¸ºåœ°å€å­—æ®µæ¯”è¾ƒé•¿ï¼Œåœ¨åœ°å€å­—æ®µä¸Šå»ºç«‹å‰ç¼€ç´¢å¼• </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table shop(address varchar(120) not null); alter table shop add index(address(12));</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜æ˜¯ï¼šæˆªå–å¤šå°‘å‘¢ï¼Ÿæˆªå–å¤šäº†è¾¾ä¸åˆ°èŠ‚çœç´¢å¼•å­˜å‚¨ç©ºé—´çš„ç›®çš„ï¼›æˆªå–å¤šäº†ï¼Œé‡å¤å†…å®¹å¤ªå¤šï¼Œå­—æ®µæ•£åˆ—åº¦(é€‰æ‹©æ€§)ä¼šé™ä½ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹å­—æ®µåœ¨å…¨éƒ¨æ•°æ®ä¸­çš„é€‰æ‹©åº¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(distinct address) / count(*) from shop;</span><br></pre></td></tr></table></figure>

<p>å…¬å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*)</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š<img src="/2022/04/22/MySQL/1652757900281.png" alt="1652757900281" loading="lazy"></p>
<p>é€šè¿‡é€‰æ‹©çš„å½“å‰ç´¢å¼•çš„å‰ç¼€æŸ¥è¯¢å‡ºæ¥çš„ä¸é‡å¤çš„ä¸ªæ•° / æ€»è®°å½•æ•°</p>
<p>è¶Šå¤§é€‰æ‹©æ€§è¶Šå¥½</p>
<p><strong>å¼•ç”³å¦ä¸€ä¸ªé—®é¢˜ï¼šç´¢å¼•åˆ—å‰ç¼€å¯¹æ’åºçš„å½±å“</strong></p>
<p>å¦‚æœä½¿ç”¨äº†ç´¢å¼•åˆ—å‰ç¼€ï¼Œæ¯”æ–¹è¯´å‰è¾¹åªæŠŠaddressåˆ—çš„å‰12ä¸ªå­—ç¬¦æ”¾åˆ°äº†äºŒçº§ç´¢å¼•ä¸­ï¼Œä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM shop</span><br><span class="line">ORDER BY address</span><br><span class="line">LIMIT 12;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºäºŒçº§ç´¢å¼•ä¸­ä¸åŒ…å«å®Œæ•´çš„addressåˆ—ä¿¡æ¯ï¼Œæ‰€ä»¥æ— æ³•å¯¹å‰12ä¸ªç›¸åŒï¼Œåé¢å­—ç¬¦ä¸åŒçš„åˆ—æ’åºï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ç´¢å¼•åˆ—å‰ç¼€çš„æ–¹å¼<strong>æ— æ³•æ”¯æŒä½¿ç”¨ç´¢å¼•æ’åº</strong>ï¼Œåªèƒ½ä½¿ç”¨æ–‡ä»¶æ’åº</p>
<p><strong>æ‹“å±•ï¼šAlibabaã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</strong></p>
<p>ã€ å¼ºåˆ¶ ã€‘åœ¨ varchar å­—æ®µä¸Šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå¿…é¡»æŒ‡å®šç´¢å¼•é•¿åº¦ï¼Œæ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ®å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦ã€‚ </p>
<p>è¯´æ˜ï¼šç´¢å¼•çš„é•¿åº¦ä¸åŒºåˆ†åº¦æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œä¸€èˆ¬å¯¹å­—ç¬¦ä¸²ç±»å‹æ•°æ®ï¼Œé•¿åº¦ä¸º 20 çš„ç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä¼š é«˜è¾¾ 90% ä»¥ä¸Š ï¼Œå¯ä»¥ä½¿ç”¨ count(distinct left(åˆ—å, ç´¢å¼•åº¦))/count(*)çš„åŒºåˆ†åº¦æ¥ç¡®å®šã€‚ </p>
<h6 id="9-åŒºåˆ†åº¦é«˜-æ•£åˆ—æ€§é«˜-çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•"><a href="#9-åŒºåˆ†åº¦é«˜-æ•£åˆ—æ€§é«˜-çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•" class="headerlink" title="9.åŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•"></a>9.åŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—é€‚åˆä½œä¸ºç´¢å¼•</h6><p><strong>åˆ—çš„åŸºæ•°</strong>æŒ‡çš„æ˜¯æŸä¸€åˆ—ä¸­ä¸é‡å¤æ•°æ®çš„ä¸ªæ•°ï¼Œæ¯”æ–¹è¯´æŸä¸ªåˆ—åŒ…å«å€¼2ï¼Œ5ï¼Œ8ï¼Œ2ï¼Œ5ï¼Œ8ï¼Œ2ï¼Œ5ï¼Œ8ï¼Œè™½ç„¶æœ‰9æ¡è®°å½•ï¼Œä½†è¯¥åˆ—çš„åŸºæ•°å´æ˜¯3ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨è®°å½•è¡Œæ•°ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œåˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šåˆ†æ•£;åˆ—çš„åŸºæ•°è¶Šå°ï¼Œè¯¥åˆ—ä¸­çš„å€¼è¶Šé›†ä¸­</strong>ã€‚è¿™ä¸ªåˆ—çš„åŸºæ•°æŒ‡æ ‡éå¸¸é‡è¦ï¼Œç›´æ¥å½±å“æˆ‘ä»¬æ˜¯å¦èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ã€‚æœ€å¥½<strong>ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åˆ—å»ºç«‹ç´¢å¼•</strong>ï¼Œä¸ºåŸºæ•°å¤ªå°åˆ—çš„å»ºç«‹ç´¢å¼•æ•ˆæœå¯èƒ½ä¸å¥½ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨å…¬å¼ <strong>select count(distinct a)/count(*) from t1</strong>è®¡ç®—åŒºåˆ†åº¦ï¼Œè¶Šæ¥è¿‘1è¶Šå¥½ï¼Œä¸€èˆ¬è¶…è¿‡33%å°±ç®—æ˜¯æ¯”è¾ƒé«˜æ•ˆçš„ç´¢å¼•äº†ã€‚</p>
<p><strong>æ‹“å±•:è”åˆç´¢å¼•æŠŠåŒºåˆ†åº¦é«˜(æ•£åˆ—æ€§é«˜)çš„åˆ—æ”¾åœ¨å‰é¢ã€‚</strong></p>
<h6 id="10-ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§"><a href="#10-ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§" class="headerlink" title="10.ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§"></a>10.ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§</h6><p>è¿™æ ·ä¹Ÿå¯ä»¥è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ã€‚åŒæ—¶ï¼Œç”±äºâ€æœ€å·¦å‰ç¼€åŸåˆ™â€ï¼Œå¯ä»¥å¢åŠ è”åˆç´¢å¼•çš„ä½¿ç”¨ç‡ã€‚</p>
<h6 id="11-åœ¨å¤šä¸ªå­—æ®µéƒ½è¦å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•"><a href="#11-åœ¨å¤šä¸ªå­—æ®µéƒ½è¦å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•" class="headerlink" title="11.åœ¨å¤šä¸ªå­—æ®µéƒ½è¦å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•"></a>11.åœ¨å¤šä¸ªå­—æ®µéƒ½è¦å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼•</h6><h5 id="3-2é™åˆ¶ç´¢å¼•çš„æ•°ç›®"><a href="#3-2é™åˆ¶ç´¢å¼•çš„æ•°ç›®" class="headerlink" title="3.2é™åˆ¶ç´¢å¼•çš„æ•°ç›®"></a>3.2é™åˆ¶ç´¢å¼•çš„æ•°ç›®</h5><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„å¹³è¡¡ï¼Œç´¢å¼•çš„æ•°ç›®ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚æˆ‘ä»¬éœ€è¦é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•æ•°é‡<strong>ä¸è¶…è¿‡6</strong>ä¸ªã€‚åŸå› :<br>â‘ æ¯ä¸ªç´¢å¼•éƒ½éœ€è¦å ç”¨<strong>ç£ç›˜ç©ºé—´</strong>ï¼Œç´¢å¼•è¶Šå¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ã€‚</p>
<p>â‘¡ç´¢å¼•ä¼šå½±å“<strong>INSERTã€DELETEã€UPDATEç­‰è¯­å¥çš„æ€§èƒ½</strong>ï¼Œå› ä¸ºè¡¨ä¸­çš„æ•°æ®æ›´æ”¹çš„åŒæ—¶ï¼Œç´¢å¼•ä¹Ÿä¼šè¿›è¡Œè°ƒæ•´å’Œæ›´æ–°ï¼Œä¼šé€ æˆè´Ÿæ‹…ã€‚</p>
<p>â‘¢ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹<strong>æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°</strong>ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œä¼šå¢åŠ MySQLä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶é—´ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h5 id="3-3å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•"><a href="#3-3å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•" class="headerlink" title="3.3å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•"></a>3.3å“ªäº›æƒ…å†µä¸é€‚åˆåˆ›å»ºç´¢å¼•</h5><h6 id="1-åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•"><a href="#1-åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•" class="headerlink" title="1.åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•"></a>1.åœ¨whereä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•</h6><p>WHEREæ¡ä»¶ï¼ˆåŒ…æ‹¬GROUP BYã€ORDER BYï¼‰é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Œç´¢å¼•çš„ä»·å€¼æ˜¯å¿«é€Ÿå®šä½ï¼Œå¦‚æœèµ·ä¸åˆ°å®šä½çš„å­—æ®µé€šå¸¸æ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„ã€‚ä¸¾ä¾‹ï¼š<img src="/2022/04/22/MySQL/1652774108868.png" alt="1652774108868" loading="lazy"></p>
<p>å› ä¸ºæˆ‘ä»¬æ˜¯æŒ‰ç…§student_idæ¥è¿›è¡Œæ£€ç´¢çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦å¯¹å…¶ä»–å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå³ä½¿è¿™äº›å­—æ®µå‡ºç°åœ¨SELECTå­—æ®µä¸­ã€‚</p>
<h6 id="2-æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•"><a href="#2-æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•" class="headerlink" title="2.æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•"></a>2.æ•°æ®é‡å°çš„è¡¨æœ€å¥½ä¸è¦ä½¿ç”¨ç´¢å¼•</h6><p>å¦‚æœè¡¨è®°å½•å¤ªå°‘ï¼Œæ¯”å¦‚å°‘äº1000ä¸ªï¼Œé‚£ä¹ˆæ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•çš„ã€‚è¡¨è®°å½•å¤ªå°‘ï¼Œ<strong>æ˜¯å¦åˆ›å»ºç´¢å¼•å¯¹æŸ¥è¯¢æ•ˆç‡çš„å½±å“å¹¶ä¸å¤§</strong>ã€‚ç”šè‡³è¯´ï¼ŒæŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´å¯èƒ½æ¯”éå†ç´¢å¼•çš„æ—¶é—´è¿˜è¦çŸ­ï¼Œç´¢å¼•å¯èƒ½ä¸ä¼šäº§ç”Ÿä¼˜åŒ–æ•ˆæœã€‚</p>
<h6 id="3-æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•"><a href="#3-æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•" class="headerlink" title="3.æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•"></a>3.æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ—ä¸Šä¸è¦å»ºç«‹ç´¢å¼•</h6><p>åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ç»å¸¸ç”¨åˆ°çš„ä¸åŒå€¼è¾ƒå¤šçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œä½†å­—æ®µä¸­å¦‚æœæœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œä¹Ÿä¸ç”¨åˆ›å»ºç´¢å¼•ã€‚æ¯”å¦‚åœ¨å­¦ç”Ÿè¡¨çš„â€œ<strong>æ€§åˆ«</strong>â€œå­—æ®µä¸Šåªæœ‰â€œç”·â€ä¸â€œå¥³â€ä¸¤ä¸ªä¸åŒå€¼ï¼Œå› æ­¤æ— é¡»å»ºç«‹ç´¢å¼•ã€‚å¦‚æœå»ºç«‹ç´¢å¼•ï¼Œä¸ä½†ä¸ä¼šæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œåè€Œä¼š<strong>ä¸¥é‡é™ä½æ•°æ®æ›´æ–°é€Ÿåº¦ã€‚</strong></p>
<p>ä¸¾ä¾‹1:è¦åœ¨100ä¸‡è¡Œæ•°æ®ä¸­æŸ¥æ‰¾å…¶ä¸­çš„50ä¸‡è¡Œ(æ¯”å¦‚æ€§åˆ«ä¸ºç”·çš„æ•°æ®)ï¼Œä¸€æ—¦åˆ›å»ºäº†ç´¢å¼•ï¼Œä½ éœ€è¦å…ˆè®¿é—®50ä¸‡æ¬¡ç´¢å¼•ï¼Œç„¶åå†è®¿é—®50ä¸‡æ¬¡æ•°æ®è¡¨ï¼Œè¿™æ ·åŠ èµ·æ¥çš„å¼€é”€æ¯”ä¸ä½¿ç”¨ç´¢å¼•å¯èƒ½è¿˜è¦å¤§ã€‚</p>
<blockquote>
<p>ç»“è®ºï¼šå½“æ•°æ®é‡å¤åº¦å¤§ï¼Œæ¯”å¦‚é«˜äº10%çš„æ—¶å€™ï¼Œä¹Ÿä¸éœ€è¦å¯¹è¿™ä¸ªå­—æ®µä½¿ç”¨ç´¢å¼•</p>
</blockquote>
<h6 id="4-é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•"><a href="#4-é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•" class="headerlink" title="4.é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•"></a>4.é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•</h6><p>ç¬¬ä¸€å±‚å«ä¹‰ï¸°é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸ä¸€å®šè¦åˆ›å»ºç´¢å¼•ã€‚å› ä¸ºæ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ›´æ–°ç´¢å¼•ï¼Œå¦‚æœç´¢å¼•å¤ªå¤šï¼Œåœ¨æ›´æ–°ç´¢å¼•çš„æ—¶å€™ä¹Ÿä¼šé€ æˆè´Ÿæ‹…ï¼Œä»è€Œå½±å“æ•ˆç‡ã€‚</p>
<p>ç¬¬äºŒå±‚å«ä¹‰:é¿å…å¯¹ç»å¸¸æ›´æ–°çš„è¡¨åˆ›å»ºè¿‡å¤šçš„ç´¢å¼•ï¼Œå¹¶ä¸”ç´¢å¼•ä¸­çš„åˆ—å°½å¯èƒ½å°‘ã€‚æ­¤æ—¶ï¼Œè™½ç„¶æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ã€‚</p>
<h6 id="5-ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•"><a href="#5-ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•" class="headerlink" title="5.ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•"></a>5.ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼•</h6><p>ä¾‹å¦‚èº«ä»½è¯ã€UUID(åœ¨ç´¢å¼•æ¯”è¾ƒæ—¶éœ€è¦è½¬ä¸ºASCIIã€‚å¹¶ä¸”æ’å…¥æ—¶å¯èƒ½é€ æˆé¡µåˆ†è£‚)ã€MD5ã€HASHã€æ— åºé•¿å­—ç¬¦ä¸²ç­‰ã€‚</p>
<h6 id="6-åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•"><a href="#6-åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="6.åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•"></a>6.åˆ é™¤ä¸å†ä½¿ç”¨æˆ–å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•</h6><p>è¡¨ä¸­çš„æ•°æ®è¢«å¤§é‡æ›´æ–°ï¼Œæˆ–è€…æ•°æ®çš„ä½¿ç”¨æ–¹å¼è¢«æ”¹å˜åï¼ŒåŸæœ‰çš„ä¸€äº›ç´¢å¼•å¯èƒ½ä¸å†éœ€è¦ã€‚æ•°æ®åº“ç®¡ç†å‘˜åº”å½“å®šæœŸæ‰¾å‡ºè¿™äº›ç´¢å¼•ï¼Œå°†å®ƒä»¬åˆ é™¤ï¼Œä»è€Œå‡å°‘ç´¢å¼•å¯¹æ›´æ–°æ“ä½œçš„å½±å“ã€‚</p>
<h6 id="7-ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•"><a href="#7-ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•" class="headerlink" title="7.ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•"></a>7.ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼•</h6><p><strong>1.å†—ä½™ç´¢å¼•</strong></p>
<p>æœ‰æ—¶å€™æœ‰æ„æˆ–è€…æ— æ„çš„å°±å¯¹åŒä¸€ä¸ªåˆ—åˆ›å»ºäº†å¤šä¸ªç´¢å¼•ï¼Œæ¯”å¦‚: index(a,b,c)ç›¸å½“äºindex(a)ã€index(a,b)ã€index(a,b,c)ã€‚</p>
<p>ä¸¾ä¾‹ï¼šé”®è¡¨è¯­å¥ï¼š<img src="/2022/04/22/MySQL/1652775351558.png" alt="1652775351558" loading="lazy"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡<strong>idx_name_birthday_phone_number</strong>ç´¢å¼•å°±å¯ä»¥å¯¹<strong>name</strong>åˆ—è¿›è¡Œå¿«é€Ÿæœç´¢ï¼Œå†åˆ›å»ºä¸€ä¸ªä¸“é—¨é’ˆå¯¹nameåˆ—çš„ç´¢å¼•å°±ç®—æ˜¯ä¸€ä¸ª<strong>å†—ä½™ç´¢å¼•</strong>ï¼Œç»´æŠ¤è¿™ä¸ªç´¢å¼•åªä¼šå¢åŠ ç»´æŠ¤çš„æˆæœ¬ï¼Œå¹¶ä¸ä¼šå¯¹æœç´¢æœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p>
<p><strong>2.é‡å¤ç´¢å¼•</strong></p>
<p>å¦ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹æŸä¸ªåˆ—é‡å¤åˆ›å»ºç´¢å¼•ï¼Œ<img src="/2022/04/22/MySQL/1652775498796.png" alt="1652775498796" loading="lazy"></p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œcol1æ—¢æ˜¯ä¸»é”®ã€åˆç»™ä»–å®šä¹‰ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œè¿˜ç»™å®šä¹‰äº†æ™®é€šç´¢å¼•ï¼Œä¸»é”®æœ¬èº«å°±ä¼šç”Ÿæˆèšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥å®šä¹‰çš„å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•æ˜¯é‡å¤çš„ï¼Œè¿™ç§æƒ…å†µè¦é¿å…ã€‚</p>
<h5 id="3-4å°ç»“"><a href="#3-4å°ç»“" class="headerlink" title="3.4å°ç»“"></a>3.4å°ç»“</h5><p>ç´¢å¼•æ˜¯ä¸€æŠŠ<strong>åŒåˆƒå‰‘</strong>ï¼Œå¯æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„é€Ÿåº¦å¹¶å ç”¨ç£ç›˜ç©ºé—´ã€‚</p>
<p>é€‰æ‹©ç´¢å¼•çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†ä½¿æŸ¥è¯¢çš„é€Ÿåº¦å˜å¿«ï¼Œä¸Šé¢ç»™å‡ºçš„åŸåˆ™æ˜¯æœ€åŸºæœ¬çš„å‡†åˆ™ï¼Œä½†ä¸èƒ½æ‹˜æ³¥äºä¸Šé¢çš„å‡†åˆ™.</p>
<h3 id="æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"><a href="#æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨" class="headerlink" title="æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"></a>æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</h3><p>åœ¨æ•°æ®åº“è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯<strong>å“åº”æ—¶é—´æ›´å¿«ï¼Œååé‡æ›´å¤§</strong>ã€‚åˆ©ç”¨å®è§‚çš„ç›‘æ§å·¥å…·å’Œå¾®è§‚çš„æ—¥å¿—åˆ†æå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°è°ƒä¼˜çš„æ€è·¯å’Œæ–¹å¼ã€‚</p>
<hr>
<h4 id="1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤"><a href="#1-æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤" class="headerlink" title="1.æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤"></a>1.æ•°æ®åº“æœåŠ¡å™¨çš„ä¼˜åŒ–æ­¥éª¤</h4><p>å½“æˆ‘ä»¬é‡åˆ°æ•°æ®åº“è°ƒä¼˜é—®é¢˜çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•æ€è€ƒå‘¢?è¿™é‡ŒæŠŠæ€è€ƒçš„æµç¨‹æ•´ç†æˆä¸‹é¢è¿™å¼ å›¾ã€‚</p>
<p>æ•´ä¸ªæµç¨‹åˆ’åˆ†æˆäº†<strong>è§‚å¯Ÿ(Show statusï¼‰å’Œè¡ŒåŠ¨(Actionï¼‰</strong>ä¸¤ä¸ªéƒ¨åˆ†ã€‚å­—æ¯Sçš„éƒ¨åˆ†ä»£è¡¨è§‚å¯Ÿï¼ˆä¼šä½¿ç”¨ç›¸åº”çš„åˆ†æå·¥å…·)ï¼Œå­—æ¯Aä»£è¡¨çš„éƒ¨åˆ†æ˜¯è¡ŒåŠ¨(å¯¹åº”åˆ†æå¯ä»¥é‡‡å–çš„è¡ŒåŠ¨)ã€‚<img src="/2022/04/22/MySQL/1652776009979.png" alt="1652776009979" loading="lazy"></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿäº†è§£æ•°æ®åº“æ•´ä½“çš„è¿è¡ŒçŠ¶æ€ï¼Œé€šè¿‡æ€§èƒ½åˆ†æå·¥å…·å¯ä»¥è®©æˆ‘ä»¬äº†è§£æ‰§è¡Œæ…¢çš„SQLéƒ½æœ‰å“ªäº›ï¼ŒæŸ¥çœ‹å…·ä½“çš„sQLæ‰§è¡Œè®¡åˆ’ï¼Œç”šè‡³æ˜¯SQLæ‰§è¡Œä¸­çš„æ¯ä¸€æ­¥çš„æˆæœ¬ä»£ä»·ï¼Œè¿™æ ·æ‰èƒ½å®šä½é—®é¢˜æ‰€åœ¨ï¼Œæ‰¾åˆ°äº†é—®é¢˜ï¼Œå†é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä»¥ä¸‹å›¾ï¼š</p>
<p>é¦–å…ˆåœ¨S1éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯ŸæœåŠ¡å™¨çš„çŠ¶æ€<strong>æ˜¯å¦å­˜åœ¨å‘¨æœŸæ€§çš„æ³¢åŠ¨</strong>ã€‚å¦‚æœå­˜åœ¨å‘¨æœŸæ€§æ³¢åŠ¨ï¼Œæœ‰å¯èƒ½æ˜¯å‘¨æœŸæ€§èŠ‚ç‚¹çš„åŸå› ï¼Œæ¯”å¦‚åŒåä¸€ã€ä¿ƒé”€æ´»åŠ¨ç­‰ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡A1è¿™ä¸€æ­¥éª¤è§£å†³ï¼Œä¹Ÿå°±æ˜¯åŠ ç¼“å­˜ï¼Œæˆ–è€…æ›´æ”¹ç¼“å­˜å¤±æ•ˆç­–ç•¥ã€‚</p>
<p>å¦‚æœç¼“å­˜ç­–ç•¥æ²¡æœ‰è§£å†³ï¼Œæˆ–è€…ä¸æ˜¯å‘¨æœŸæ€§æ³¢åŠ¨çš„åŸå› ï¼Œæˆ‘ä»¬å°±éœ€è¦<strong>è¿›ä¸€æ­¥åˆ†ææŸ¥è¯¢å»¶è¿Ÿå’Œå¡é¡¿çš„åŸå› </strong>ã€‚æ¥ä¸‹æ¥è¿›å…¥S2è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯æ…¢æŸ¥è¯¢ã€‚æ…¢æŸ¥è¯¢å¯ä»¥å¸®æˆ‘ä»¬å®šä½æ‰§è¡Œæ…¢çš„SQLè¯­å¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<strong>long_query_time</strong>å‚æ•°å®šä¹‰â€œæ…¢â€çš„é˜ˆå€¼ï¼Œå¦‚æœSQLæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†long_query_timeï¼Œåˆ™ä¼šè®¤ä¸ºæ˜¯æ…¢æŸ¥è¯¢ã€‚å½“æ”¶é›†ä¸Šæ¥è¿™äº›æ…¢æŸ¥è¯¢ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åˆ†æå·¥å…·å¯¹æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†æã€‚</p>
<p>åœ¨S3è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†æ‰§è¡Œæ…¢çš„SQLï¼Œè¿™æ ·å°±å¯ä»¥é’ˆå¯¹æ€§åœ°ç”¨<strong>EXPLAIN</strong>æŸ¥çœ‹å¯¹åº”SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œæˆ–è€…ä½¿ç”¨ <strong>show profile</strong>æŸ¥çœ‹SQLä¸­æ¯ä¸€ä¸ªæ­¥éª¤çš„æ—¶é—´æˆæœ¬ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥äº†è§£sQLæŸ¥è¯¢æ…¢æ˜¯å› ä¸ºæ‰§è¡Œæ—¶é—´é•¿ï¼Œè¿˜æ˜¯ç­‰å¾…æ—¶é—´é•¿ã€‚</p>
<p>å¦‚æœæ˜¯SQLç­‰å¾…æ—¶é—´é•¿ï¼Œæˆ‘ä»¬è¿›å…¥A2æ­¥éª¤ã€‚åœ¨è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥<strong>è°ƒä¼˜æœåŠ¡å™¨çš„å‚æ•°</strong>ï¼Œæ¯”å¦‚é€‚å½“å¢åŠ æ•°æ®åº“ç¼“å†²æ± ç­‰ã€‚å¦‚æœæ˜¯SQLæ‰§è¡Œæ—¶é—´é•¿ï¼Œå°±è¿›å…¥A3æ­¥éª¤ï¼Œè¿™ä¸€æ­¥ä¸­æˆ‘ä»¬éœ€è¦è€ƒè™‘æ˜¯ç´¢å¼•è®¾è®¡çš„é—®é¢˜?è¿˜æ˜¯æŸ¥è¯¢å…³è”çš„æ•°æ®è¡¨è¿‡å¤š?è¿˜æ˜¯å› ä¸ºæ•°æ®è¡¨çš„å­—æ®µè®¾è®¡é—®é¢˜å¯¼è‡´äº†è¿™ä¸€ç°è±¡ã€‚ç„¶ååœ¨è¿™äº›ç»´åº¦ä¸Šè¿›è¡Œå¯¹åº”çš„è°ƒæ•´ã€‚</p>
<p>å¦‚æœA2å’ŒA3éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ•°æ®åº“è‡ªèº«çš„SQLæŸ¥è¯¢æ€§èƒ½<strong>æ˜¯å¦å·²ç»è¾¾åˆ°äº†ç“¶é¢ˆ</strong>ï¼Œå¦‚æœç¡®è®¤æ²¡æœ‰è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œå°±éœ€è¦é‡æ–°æ£€æŸ¥ï¼Œé‡å¤ä»¥ä¸Šçš„æ­¥éª¤ã€‚å¦‚æœ<strong>å·²ç»è¾¾åˆ°äº†æ€§èƒ½ç“¶é¢ˆ</strong>ï¼Œè¿›å…¥A4é˜¶æ®µï¼Œéœ€è¦<strong>è€ƒè™‘å¢åŠ æœåŠ¡å™¨</strong>ï¼Œ<strong>é‡‡ç”¨è¯»å†™åˆ†ç¦»çš„æ¶æ„</strong>ï¼Œæˆ–è€…è€ƒè™‘<strong>å¯¹æ•°æ®åº“è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæ¯”å¦‚å‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨å’Œæ°´å¹³åˆ†è¡¨ç­‰</strong>ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æ•°æ®åº“è°ƒä¼˜çš„æµç¨‹æ€è·¯ã€‚å¦‚æœæˆ‘ä»¬å‘ç°æ‰§è¡ŒSQLæ—¶å­˜åœ¨ä¸è§„åˆ™å»¶è¿Ÿæˆ–å¡é¡¿çš„æ—¶å€™ï¼Œå°±å¯ä»¥é‡‡ç”¨åˆ†æå·¥å…·å¸®æˆ‘ä»¬å®šä½æœ‰é—®é¢˜çš„SQLï¼Œè¿™ä¸‰ç§åˆ†æå·¥å…·ä½ å¯ä»¥ç†è§£æ˜¯sQLè°ƒä¼˜çš„ä¸‰ä¸ªæ­¥éª¤:<strong>æ…¢æŸ¥è¯¢ã€EXPLAINå’Œ SHOW PROFILINGã€‚</strong></p>
<p>å°ç»“ï¼š<img src="/2022/04/22/MySQL/1652776358602.png" alt="1652776358602" loading="lazy"></p>
<h4 id="2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°"><a href="#2-æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°" class="headerlink" title="2.æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°"></a>2.æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°</h4><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨<strong>SHOW STATUS</strong>è¯­æ³•æŸ¥è¯¢ä¸€äº›MySQLæ•°æ®åº“æœåŠ¡å™¨çš„<strong>æ€§èƒ½å‚æ•°ã€æ‰§è¡Œæ•ˆç‡</strong>ã€‚</p>
<p>SHOW STATUSè¯­å¥è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW [GLOBAL|SESSION] STATUS LIKE &#x27;å‚æ•°&#x27;;</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›å¸¸ç”¨çš„æ€§èƒ½å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>Connections:è¿æ¥MySQLæœåŠ¡å™¨çš„æ¬¡æ•°ã€‚.</li>
<li>Uptime: MySQLæœåŠ¡å™¨çš„ä¸Šçº¿æ—¶é—´ã€‚</li>
<li>Slow_queries:æ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚</li>
<li> lnnodb_rows_read: SelectæŸ¥è¯¢è¿”å›çš„è¡Œæ•°</li>
<li>lnnodb_rows_inserted:æ‰§è¡ŒINSERTæ“ä½œæ’å…¥çš„è¡Œæ•°I. </li>
<li>Innodb_rows_updated:æ‰§è¡ŒUPDATEæ“ä½œæ›´æ–°çš„è¡Œæ•°. </li>
<li>lnnodb_rows_deleted:æ‰§è¡ŒDELETEæ“ä½œåˆ é™¤çš„è¡Œæ•°. </li>
<li>com_select:æŸ¥è¯¢æ“ä½œçš„æ¬¡æ•°ã€‚</li>
<li>Com_insert:æ’å…¥æ“ä½œçš„æ¬¡æ•°ã€‚å¯¹äºæ‰¹é‡æ’å…¥çš„INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚</li>
<li>Com_update:æ›´æ–°æ“ä½œçš„æ¬¡æ•°ã€‚</li>
<li>com_delete:åˆ é™¤æ“ä½œçš„æ¬¡æ•°ã€‚</li>
</ul>
<p>æ…¢æŸ¥è¯¢æ¬¡æ•°å‚æ•°å¯ä»¥ç»“åˆæ…¢æŸ¥è¯¢æ—¥å¿—æ‰¾å‡ºæ…¢æŸ¥è¯¢è¯­å¥ï¼Œç„¶åé’ˆå¯¹æ…¢æŸ¥è¯¢è¯­å¥è¿›è¡Œ<strong>è¡¨ç»“æ„ä¼˜åŒ–æˆ–è€…æŸ¥è¯¢è¯­å¥ä¼˜åŒ–</strong></p>
<p>å†æ¯”å¦‚ï¼Œå¦‚ä¸‹çš„æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„æŒ‡ä»¤æƒ…å†µ:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW STATUS LIKE &#x27;Innodb_rows_%&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="3-ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost"><a href="#3-ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast-query-cost" class="headerlink" title="3.ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost"></a>3.ç»Ÿè®¡SQLçš„æŸ¥è¯¢æˆæœ¬ï¼šlast_query_cost</h4><p>ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥åœ¨æ‰§è¡Œå‰éœ€è¦ç¡®å®šæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœå­˜åœ¨å¤šç§æ‰§è¡Œè®¡åˆ’çš„è¯ï¼ŒMySQL ä¼šè®¡ç®—æ¯ä¸ªæ‰§è¡Œè®¡åˆ’æ‰€éœ€è¦çš„æˆæœ¬ï¼Œä»ä¸­é€‰æ‹©<strong>æˆæœ¬æœ€å°</strong>çš„ä¸€ä¸ªä½œä¸ºæœ€ç»ˆæ‰§è¡Œçš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æŸæ¡sQLè¯­å¥çš„æŸ¥è¯¢æˆæœ¬ï¼Œå¯ä»¥åœ¨æ‰§è¡Œå®Œè¿™æ¡sQLè¯­å¥ä¹‹åï¼Œé€šè¿‡æŸ¥çœ‹å½“å‰ä¼šè¯ä¸­çš„last_query_costå˜é‡å€¼æ¥å¾—åˆ°å½“å‰æŸ¥è¯¢çš„æˆæœ¬ã€‚å®ƒé€šå¸¸ä¹Ÿæ˜¯æˆ‘ä»¬<strong>è¯„ä»·ä¸€ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡çš„ä¸€ä¸ªå¸¸ç”¨æŒ‡æ ‡</strong>ã€‚è¿™ä¸ªæŸ¥è¯¢æˆæœ¬å¯¹åº”çš„æ˜¯<strong>SQLè¯­å¥æ‰€éœ€è¦è¯»å–çš„é¡µçš„æ•°é‡ã€‚</strong></p>
<p> ä¸¾ä¾‹ï¼šè¡¨student_infoï¼š<img src="/2022/04/22/MySQL/1652800805940.png" alt="1652800805940" loading="lazy"></p>
<p>å¦‚æœæƒ³æŸ¥è¯¢id=900001çš„è®°å½•ï¼Œç„¶åæŸ¥çœ‹æˆæœ¬ï¼Œå¯ä»¥ç›´æ¥åœ¨èšç°‡ç´¢å¼•ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼š<img src="/2022/04/22/MySQL/1652800859612.png" alt="1652800859612" loading="lazy"></p>
<p>è¿è¡Œç»“æœï¼ˆ1æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ä¸º0.042ç§’ï¼‰</p>
<p>ç„¶åçœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„ç‰ˆæœ¬ï¼Œå®é™…ä¸Šåªéœ€è¦æ£€ç´¢ä¸€ä¸ªé¡µ<img src="/2022/04/22/MySQL/1652800937751.png" alt="1652800937751" loading="lazy"></p>
<p>å¦‚æœæƒ³è¦æŸ¥çœ‹idåœ¨900001åˆ°9000100ä¹‹é—´çš„è®°å½•<img src="/2022/04/22/MySQL/1652800975163.png" alt="1652800975163" loading="lazy"></p>
<p>è¿è¡Œç»“æœï¼ˆ100æ¡è®°å½•ï¼Œè¿è¡Œæ—¶é—´ä¸º0.046sï¼‰</p>
<p>ç„¶åçœ‹ä¸‹æŸ¥è¯¢ä¼˜åŒ–å™¨çš„æˆæœ¬ï¼Œå¤§æ¦‚éœ€è¦è¿›è¡Œ20ä¸ªé¡µçš„æŸ¥è¯¢<img src="/2022/04/22/MySQL/1652801077419.png" alt="1652801077419" loading="lazy"></p>
<p>ä½ èƒ½çœ‹åˆ°é¡µçš„æ•°é‡æ˜¯åˆšæ‰çš„20å€ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•ˆç‡å¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œå®é™…ä¸Šè¿™ä¸¤ä¸ªsQLæŸ¥è¯¢çš„æ—¶é—´åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå°±æ˜¯å› ä¸ºé‡‡ç”¨äº†é¡ºåºè¯»å–çš„æ–¹å¼å°†é¡µé¢ä¸€æ¬¡æ€§åŠ è½½åˆ°ç¼“å†²æ± ä¸­ï¼Œç„¶åå†è¿›è¡ŒæŸ¥æ‰¾ã€‚è™½ç„¶<strong>é¡µæ•°é‡(last_query_costï¼‰å¢åŠ äº†ä¸å°‘</strong>ï¼Œä½†æ˜¯é€šè¿‡ç¼“å†²æ± çš„æœºåˆ¶,å¹¶<strong>æ²¡æœ‰å¢åŠ å¤šå°‘æŸ¥è¯¢æ—¶é—´</strong>ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>:å®ƒå¯¹äºæ¯”è¾ƒå¼€é”€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰å¥½å‡ ç§æŸ¥è¯¢æ–¹å¼å¯é€‰çš„æ—¶å€™ã€‚</p>
<blockquote>
<p>sQLæŸ¥è¯¢æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼Œä»é¡µåŠ è½½çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ç‚¹ç»“è®º:</p>
<p>1.<strong>ä½ç½®å†³å®šæ•ˆç‡</strong>ã€‚å¦‚æœé¡µå°±åœ¨<strong>æ•°æ®åº“ç¼“å†²æ± </strong>ä¸­ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå¦åˆ™è¿˜éœ€è¦ä»<strong>å†…å­˜æˆ–è€…ç£ç›˜ä¸­</strong>è¿›è¡Œè¯»å–ï¼Œå½“ç„¶é’ˆå¯¹å•ä¸ªé¡µçš„è¯»å–æ¥è¯´ï¼Œå¦‚æœé¡µå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¼šæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ•ˆç‡é«˜å¾ˆå¤šã€‚<br>2ï¼<strong>æ‰¹é‡å†³å®šæ•ˆç‡</strong>ã€‚å¦‚æœæˆ‘ä»¬ä»ç£ç›˜ä¸­å¯¹å•ä¸€é¡µè¿›è¡Œéšæœºè¯»ï¼Œé‚£ä¹ˆæ•ˆç‡æ˜¯å¾ˆä½çš„(å·®ä¸å¤š10ms) ,è€Œé‡‡ç”¨é¡ºåºè¯»å–çš„æ–¹å¼ï¼Œæ‰¹é‡å¯¹é¡µè¿›è¡Œè¯»å–ï¼Œå¹³å‡ä¸€é¡µçš„è¯»å–æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤šï¼Œç”šè‡³è¦å¿«äºå•ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­çš„éšæœºè¯»å–ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œé‡åˆ°I/Oå¹¶ä¸ç”¨æ‹…å¿ƒï¼Œæ–¹æ³•æ‰¾å¯¹äº†ï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚æˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘æ•°æ®å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœæ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®å°±è¦å°½é‡<strong>æ”¾åˆ°ç¼“å†²æ± ä¸­</strong>ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ç£ç›˜çš„ååèƒ½åŠ›ï¼Œä¸€æ¬¡æ€§æ‰¹é‡è¯»å–æ•°æ®ï¼Œè¿™æ ·å•ä¸ªé¡µçš„è¯»å–æ•ˆç‡ä¹Ÿå°±å¾—åˆ°äº†æå‡ã€‚</p>
</blockquote>
<h4 id="4-å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.å®šä½æ‰§è¡Œæ…¢çš„SQLï¼šæ…¢æŸ¥è¯¢æ—¥å¿—</h4><p>MysQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç”¨æ¥<strong>è®°å½•åœ¨MysQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥</strong>ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡<strong>long.query_time</strong>å€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„<strong>é»˜è®¤å€¼ä¸º10</strong>ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Š(ä¸å«10ç§’)çš„è¯­å¥ï¼Œè®¤ä¸ºæ˜¯è¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ã€‚</p>
<p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œå¸®åŠ©æˆ‘ä»¬å‘ç°é‚£äº›æ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿çš„SQLæŸ¥è¯¢ï¼Œå¹¶ä¸”æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚å½“æˆ‘ä»¬çš„æ•°æ®åº“æœåŠ¡å™¨å‘ç”Ÿé˜»å¡ã€è¿è¡Œå˜æ…¢çš„æ—¶å€™ï¼Œæ£€æŸ¥ä¸€ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾åˆ°é‚£äº›æ…¢æŸ¥è¯¢ï¼Œå¯¹è§£å†³é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚æ¯”å¦‚ä¸€æ¡sqlæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’çš„sqlï¼Œç»“åˆexplainè¿›è¡Œå…¨é¢åˆ†æã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“<strong>æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚<strong>å¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°</strong>ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚</p>
<p>æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶ã€‚</p>
<h5 id="4-1å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-1å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.1å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.1å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h5><h6 id="1-å¼€å¯slow-query-log"><a href="#1-å¼€å¯slow-query-log" class="headerlink" title="1.å¼€å¯slow_query_log"></a>1.å¼€å¯slow_query_log</h6><p>åœ¨ä½¿ç”¨å‰ï¼Œéœ€è¦å…ˆçœ‹ä¸‹æ…¢æŸ¥è¯¢æ˜¯å¦å·²ç»å¼€å¯ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show variables like &#x27;&amp;slow_query_log&amp;&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652801501352.png" alt="1652801501352" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°slow_query_log=OFFï¼Œå¯ä»¥æŠŠæ…¢æŸ¥è¯¢æ—¥å¿—æ‰“å¼€ï¼Œæ³¨æ„è®¾ç½®å˜é‡å€¼çš„æ—¶å€™éœ€è¦ä½¿ç”¨globalï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; set global slow_query_log=&#x27;ON&#x27;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å†æ¥çœ‹ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œä»¥åŠæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä½ç½® </p>
<p><img src="/2022/04/22/MySQL/1652801658998.png" alt="1652801658998" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—å·²ç»å¼€å¯ï¼ŒåŒæ—¶æ–‡ä»¶ä½ç½®ä¿å­˜åœ¨/var/ lib/mysql/atguigu02-slow . logæ–‡ä»¶ä¸­ã€‚</p>
<h6 id="2-ä¿®æ”¹long-query-timeé˜ˆå€¼"><a href="#2-ä¿®æ”¹long-query-timeé˜ˆå€¼" class="headerlink" title="2.ä¿®æ”¹long_query_timeé˜ˆå€¼"></a>2.ä¿®æ”¹long_query_timeé˜ˆå€¼</h6><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®æ…¢æŸ¥è¯¢çš„æ—¶é—´é˜ˆå€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show variables like &#x27;%long_query_time%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652801777563.png" alt="1652801777563" loading="lazy"></p>
<p>æ¯”å¦‚æŠŠæ—¶é—´è®¾ç½®ä¸º1ç§’ï¼š<img src="/2022/04/22/MySQL/1652801800349.png" alt="1652801800349" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652801837932.png" alt="1652801837932" loading="lazy"></p>
<p><strong>è¡¥å……ï¼šé…ç½®æ–‡ä»¶ä¸­ä¸€å¹¶è®¾ç½®å‚æ•°</strong></p>
<p>å¦‚ä¸‹çš„æ–¹å¼ç›¸è¾ƒäºå‰é¢çš„å‘½ä»¤è¡Œæ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ—¶æ°¸ä¹…è®¾ç½®çš„æ–¹å¼</p>
<p>ä¿®æ”¹my .cnf æ–‡ä»¶ï¼Œ[mysqld]ä¸‹å¢åŠ æˆ–ä¿®æ”¹å‚æ•°long_query_time ã€ slow_query_logå’Œslow_query_log_fileåï¼Œç„¶åé‡å¯MySQLæœåŠ¡å™¨ã€‚<img src="/2022/04/22/MySQL/1652801918870.png" alt="1652801918870" loading="lazy"></p>
<p>å¦‚æœä¸æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—å°†é»˜è®¤å­˜å‚¨åˆ°MySQLæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ä¸‹ã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œ é»˜è®¤æ–‡ä»¶åä¸ºhostname-slow.log</p>
<h5 id="4-2æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®"><a href="#4-2æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®" class="headerlink" title="4.2æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®"></a>4.2æŸ¥çœ‹æ…¢æŸ¥è¯¢æ•°ç›®</h5><p>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢æŸ¥è¯¢è®°å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOBAL STATUS LIKE â€˜Slow_queriesâ€™;</span><br></pre></td></tr></table></figure>

<h5 id="4-3æ¡ˆä¾‹æ¼”ç¤º"><a href="#4-3æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="4.3æ¡ˆä¾‹æ¼”ç¤º"></a>4.3æ¡ˆä¾‹æ¼”ç¤º</h5><p>æ­¥éª¤ä¸€ï¼šå»ºè¡¨<img src="/2022/04/22/MySQL/1652802126122.png" alt="1652802126122" loading="lazy"></p>
<p><strong>æ­¥éª¤äºŒï¼šè®¾ç½®å‚æ•°log_bin_trust_function_creators</strong></p>
<p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This function has none of DETERMINISTIC....</span><br></pre></td></tr></table></figure>

<ul>
<li>å‘½ä»¤å¼€å¯ï¼šå…è®¸åˆ›å»ºå‡½æ•°è®¾ç½®ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global log_bin_trust_function_creators=1;</span><br><span class="line">#ä¸åŠ globalåªæ˜¯å½“å‰ä¼šè¯æœ‰æ•ˆ</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ä¸‰ï¼šåˆ›å»ºå‡½æ•°</strong></p>
<p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²ï¼š<img src="/2022/04/22/MySQL/1652802431996.png" alt="1652802431996" loading="lazy"></p>
<p>äº§ç”Ÿéšæœºæ•°å€¼ï¼š<img src="/2022/04/22/MySQL/1652802493533.png" alt="1652802493533" loading="lazy"></p>
<p><strong>æ­¥éª¤å››ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹</strong><img src="/2022/04/22/MySQL/1652802512011.png" alt="1652802512011" loading="lazy"></p>
<p><strong>æ­¥éª¤äº”ï¼šè°ƒç”¨å­˜å‚¨è¿‡ç¨‹</strong><img src="/2022/04/22/MySQL/1652802543296.png" alt="1652802543296" loading="lazy"></p>
<h5 id="4-4æµ‹è¯•åŠåˆ†æ"><a href="#4-4æµ‹è¯•åŠåˆ†æ" class="headerlink" title="4.4æµ‹è¯•åŠåˆ†æ"></a>4.4æµ‹è¯•åŠåˆ†æ</h5><p><strong>1.æµ‹è¯•</strong><img src="/2022/04/22/MySQL/1652802659696.png" alt="1652802659696" loading="lazy"></p>
<p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿç¼–å·ä¸ºâ€œ3455655â€çš„å­¦ç”Ÿä¿¡æ¯èŠ±è´¹æ—¶é—´ä¸º2.09ç§’ã€‚æŸ¥è¯¢å­¦ç”Ÿå§“åä¸ºâ€œoQmLurçš„å­¦ç”Ÿä¿¡æ¯èŠ±è´¹æ—¶é—´ä¸º2.39ç§’ã€‚å·²ç»è¾¾åˆ°äº†ç§’çš„æ•°é‡çº§ï¼Œè¯´æ˜ç›®å‰æŸ¥è¯¢æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œä¸‹é¢çš„å°èŠ‚æˆ‘ä»¬åˆ†æä¸€ä¸‹åŸå› ã€‚</p>
<p><strong>2.åˆ†æ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#x27;slow_queries&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¡¥å……è¯´æ˜ï¼š</p>
<p>é™¤äº†long_query_timeå˜é‡å¤–ï¼Œæ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—çš„è¿˜æœ‰ä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼šmin_examined_row_limitã€‚è¿™ä¸ªå˜é‡çš„æ„æ€æ˜¯ï¼Œ<strong>æŸ¥è¯¢æ‰«æè¿‡çš„æœ€å°‘è®°å½•æ•°</strong>ã€‚è¿™ä¸ªå˜é‡å’ŒæŸ¥è¯¢æ‰§è¡Œæ—¶é—´ï¼Œå…±åŒç»„æˆäº†åˆ¤åˆ«ä¸€ä¸ªæŸ¥è¯¢æ˜¯å¦æ˜¯æ…¢æŸ¥è¯¢çš„æ¡ä»¶ã€‚å¦‚æœæŸ¥è¯¢æ‰«æè¿‡çš„è®°å½•æ•°å¤§äºç­‰äºè¿™ä¸ªå˜é‡çš„å€¼ï¼Œå¹¶ä¸”æŸ¥è¯¢æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„å€¼ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæŸ¥è¯¢å°±è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­;åä¹‹ï¼Œåˆ™ä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚<img src="/2022/04/22/MySQL/1652802988135.png" alt="1652802988135" loading="lazy"></p>
<p>è¿™ä¸ªå€¼é»˜è®¤æ˜¯0ã€‚ä¸long_query_time=10åˆåœ¨ä¸€èµ·ï¼Œè¡¨ç¤ºåªè¦æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡10ç§’é’Ÿï¼Œå“ªæ€•ä¸€ä¸ªè®°å½•ä¹Ÿæ²¡æœ‰æ‰«æè¿‡ï¼Œéƒ½è¦è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡ä¿®æ”¹â€œmy.iniâ€æ–‡ä»¶ï¼Œæ¥ä¿®æ”¹æŸ¥è¯¢æ—¶é•¿ï¼Œæˆ–è€…é€šè¿‡SET æŒ‡ä»¤ï¼Œç”¨SQLè¯­å¥ä¿®æ”¹â€œmin_examined_row_limitâ€çš„å€¼ã€‚</p>
</blockquote>
<h5 id="4-5æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow"><a href="#4-5æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow" class="headerlink" title="4.5æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow"></a>4.5æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqldumpslow</h5><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚æœè¦æ‰‹å·¥åˆ†ææ—¥å¿—ï¼ŒæŸ¥æ‰¾ã€åˆ†æSQLï¼Œæ˜¾ç„¶æ˜¯ä¸ªä½“åŠ›æ´»ï¼ŒMysQLæä¾›äº†æ—¥å¿—åˆ†æå·¥å…·<strong>mysqldumpslow</strong> ã€‚</p>
<p>æŸ¥çœ‹mysqldumpslowçš„å¸®åŠ©ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow --help</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652803226505.png" alt="1652803226505" loading="lazy"></p>
<p>mysqldumpslowå‘½ä»¤çš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>-a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS </p>
</li>
<li><p>-s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åºï¼š </p>
<ul>
<li>c: è®¿é—®æ¬¡æ•° </li>
<li>l: é”å®šæ—¶é—´ </li>
<li>r: è¿”å›è®°å½• </li>
<li><strong>t:</strong> <strong>æŸ¥è¯¢æ—¶é—´</strong> </li>
<li>al:å¹³å‡é”å®šæ—¶é—´ </li>
<li>ar:å¹³å‡è¿”å›è®°å½•æ•° </li>
<li>at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰ </li>
<li>ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•° </li>
</ul>
</li>
<li><p> -t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ®ï¼›</p>
</li>
<li><p>-g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿ</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬æƒ³è¦æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼ŒæŸ¥çœ‹å‰äº”æ¡ SQL è¯­å¥ï¼Œè¿™æ ·å†™å³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s t -t 5 /var/lib/mysql/atguigu01-slow.log</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652803421497.png" alt="1652803421497" loading="lazy"></p>
<p><strong>å·¥ä½œå¸¸ç”¨å‚è€ƒ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL </span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log </span><br><span class="line"></span><br><span class="line">#å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</span><br><span class="line">mysqldumpslow -s c -t 10 /var/lib/mysql/atguigu-slow.log </span><br><span class="line"></span><br><span class="line">#å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥ </span><br><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; /var/lib/mysql/atguigu-slow.log</span><br><span class="line"></span><br><span class="line">#å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ </span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log | more</span><br></pre></td></tr></table></figure>

<h5 id="4-6å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-6å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.6å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.6å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—</h5><p>MySQLæœåŠ¡å™¨åœæ­¢æ…¢æŸ¥è¯¢æ—¥å¿—æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p><strong>æ–¹å¼ä¸€ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p>
<p>ä¿®æ”¹my.cnfæˆ–è€…my.iniæ–‡ä»¶ï¼ŒæŠŠ[mysqld]ç»„ä¸‹çš„slow_query_logå€¼è®¾ç½®ä¸ºOFFï¼Œä¿®æ”¹ä¿å­˜åï¼Œå†é‡å¯MySQLæœåŠ¡ï¼Œå³å¯ç”Ÿæ•ˆ;</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">slow_query_log</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼ŒæŠŠslow_query_logä¸€é¡¹æ³¨é‡Šæ‰æˆ–åˆ é™¤</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#slow_query_log=OFF</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯MySQLæœåŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;%slow%&#x27;; #æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨ç›®å½•</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%long_query_time%&#x27; #æŸ¥è¯¢è¶…æ—¶æ—¶é•¿</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒMySQLç³»ç»Ÿä¸­çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å…³é—­çš„ã€‚</p>
<p><strong>æ–¹å¼äºŒï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p>
<p>ä½¿ç”¨SETè¯­å¥æ¥è®¾ç½®ã€‚</p>
<p>ï¼ˆ1ï¼‰åœæ­¢MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL slow_query_log=of;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰é‡å¯MySQLæœåŠ¡ï¼Œä½¿ç”¨SHOWè¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ä¿¡æ¯ï¼Œå…·ä½“SQLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;%slow%&#x27;;</span><br><span class="line">#ä»¥åŠ</span><br><span class="line">SHOW VARIABLES LIKE &#x27;%long_query_time%&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="4-7åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#4-7åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="4.7åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—"></a>4.7åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—</h5><p>ä½¿ç”¨SHOWè¯­å¥æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“SQLè¯­å¥å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;slow_query_log%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652804981666.png" alt="1652804981666" loading="lazy"></p>
<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•é»˜è®¤ä¸ºMysQLçš„æ•°æ®ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹<strong>æ‰‹åŠ¨åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶</strong>å³å¯ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤mysqladmin flush-logs æ¥é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼Œæ‰§è¡Œå®Œæ¯•ä¼šåœ¨æ•°æ®ç›®å½•ä¸‹é‡æ–°ç”Ÿæˆæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p flush-logs slow</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æç¤º</p>
<p>æ…¢æŸ¥è¯¢æ—¥å¿—éƒ½æ˜¯ä½¿ç”¨mysqladmin flush-logså‘½ä»¤æ¥åˆ é™¤é‡å»ºçš„ã€‚ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œä¸€æ—¦æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—éƒ½åªå­˜åœ¨æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœéœ€è¦æ—§çš„æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»äº‹å…ˆå¤‡ä»½ã€‚</p>
</blockquote>
<h4 id="5-æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE"><a href="#5-æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬ï¼šSHOW-PROFILE" class="headerlink" title="5.æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE"></a>5.æŸ¥çœ‹SQLæ‰§è¡Œæˆæœ¬ï¼šSHOW PROFILE</h4><p>Show Profileæ˜¯MySQLæä¾›çš„å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­SQLéƒ½åšäº†ä»€ä¹ˆã€æ‰§è¡Œçš„èµ„æºæ¶ˆè€—çš„æƒ…å†µå·¥å…·ï¼Œå¯ç”¨äºsqlè°ƒä¼˜çš„æµ‹é‡ã€‚<strong>é»˜è®¤æƒ…å†µä¸‹å¤„äºå…³é—­çŠ¶æ€</strong>ï¼Œå¹¶ä¿å­˜æœ€è¿‘çš„15æ¬¡è¿è¡Œç»“æœã€‚</p>
<p>å¯ä»¥åœ¨ä¼šè¯çº§åˆ«å¼€å¯è¿™ä¸ªåŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show variables like &#x27;profiling&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652805311416.png" alt="1652805311416" loading="lazy"></p>
<p>é€šè¿‡è®¾ç½®profiling=â€™ONâ€˜æ¥å¼€å¯slow profile;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; set profiling = &#x27;ON&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652805357832.png" alt="1652805357832" loading="lazy"></p>
<p>ç„¶åæ‰§è¡Œç›¸å…³æŸ¥è¯¢è¯­å¥ï¼Œæ¥ç€çœ‹ä¸‹å½“å‰ä¼šè¯éƒ½æœ‰å“ªäº› profilesï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show profiles;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652805409873.png" alt="1652805409873" loading="lazy"></p>
<p>èƒ½çœ‹åˆ°å½“å‰ä¼šè¯ä¸€å…±æœ‰ 2 ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æŸ¥è¯¢çš„å¼€é”€ï¼Œå¯ä»¥ä½¿ç”¨ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show profile;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652805437849.png" alt="1652805437849" loading="lazy"></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„Query IDçš„å¼€é”€ï¼Œæ¯”å¦‚show profile for query 2æŸ¥è¯¢ç»“æœæ˜¯ä¸€æ ·çš„ã€‚åœ¨SHOW PROFILE ä¸­å¯ä»¥æŸ¥çœ‹ä¸åŒéƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚cpuã€block.ioç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show profile cpu,block io for query 2;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652805709800.png" alt="1652805709800" loading="lazy"></p>
<p>é€šè¿‡ä¸Šé¢çš„ç»“æœï¼Œå°±å¯ä»¥å¼„æ¸…æ¥šæ¯ä¸€æ­¥è€—æ—¶ï¼Œä»¥åŠåœ¨ä¸åŒéƒ¨åˆ†ï¼Œæ¯”å¦‚CPUã€block.ioçš„æ‰§è¡Œæ—¶é—´ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºSQLåˆ°åº•æ…¢åœ¨å“ªé‡Œ</p>
<p><strong>show profileçš„å¸¸ç”¨æŸ¥è¯¢å‚æ•°ï¼š</strong> </p>
<p>â‘  ALLï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å¼€é”€ä¿¡æ¯ã€‚ â‘¡ BLOCK IOï¼šæ˜¾ç¤ºå—IOå¼€é”€ã€‚ â‘¢ CONTEXT SWITCHESï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚ â‘£ CPUï¼šæ˜¾ç¤ºCPUå¼€é”€ä¿¡æ¯ã€‚ â‘¤ IPCï¼šæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶å¼€é”€ä¿¡æ¯ã€‚ â‘¥ MEMORYï¼šæ˜¾ç¤ºå†…å­˜å¼€é”€ä¿¡ æ¯ã€‚ â‘¦ PAGE FAULTSï¼šæ˜¾ç¤ºé¡µé¢é”™è¯¯å¼€é”€ä¿¡æ¯ã€‚ â‘§ SOURCEï¼šæ˜¾ç¤ºå’ŒSource_functionï¼ŒSource_file,Source_lineç›¸å…³çš„å¼€é”€ä¿¡æ¯ã€‚ â‘¨ SWAPSï¼šæ˜¾ç¤ºäº¤æ¢æ¬¡æ•°å¼€é”€ä¿¡æ¯ã€‚ </p>
<p><strong>æ—¥å¸¸å¼€å‘éœ€æ³¨æ„çš„ç»“è®º:</strong><br>converting HEAP to MyISAM:æŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œå†…å­˜ä¸å¤Ÿï¼Œæ•°æ®å¾€ç£ç›˜ä¸Šæ¬äº†ã€‚</p>
<p>Creating tmp table:åˆ›å»ºä¸´æ—¶è¡¨ã€‚å…ˆæ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œç”¨å®Œåå†åˆ é™¤ä¸´æ—¶è¡¨ã€‚</p>
<p>Copying to tmp table on disk:æŠŠå†…å­˜ä¸­ä¸´æ—¶è¡¨å¤åˆ¶åˆ°ç£ç›˜ä¸Šï¼Œè­¦æƒ•!</p>
<p>blocked ã€‚</p>
<p>å¦‚æœåœ¨show profileè¯Šæ–­ç»“æœä¸­å‡ºç°äº†ä»¥ä¸Š4æ¡ç»“æœä¸­çš„ä»»ä½•ä¸€æ¡ï¼Œåˆ™sqlè¯­å¥éœ€è¦ä¼˜åŒ–ã€‚</p>
<p><strong>æ³¨æ„:</strong><br>ä¸è¿‡SHOW PROFILE å‘½ä»¤å°†è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»information_schema ä¸­çš„profilingæ•°æ®è¡¨è¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<h4 id="6-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN"><a href="#6-åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN" class="headerlink" title="6.åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN"></a>6.åˆ†ææŸ¥è¯¢è¯­å¥ï¼šEXPLAIN</h4><blockquote>
<p>ä»€ä¹ˆæ˜¯explainï¼Ÿ</p>
<p>å³ï¼šsqlçš„æ‰§è¡Œè®¡åˆ’ï¼Œä½¿ç”¨explainå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒsqlæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“mysqlæ˜¯å¦‚ä½•å¤„ç†sqlè¯­å¥çš„</p>
</blockquote>
<h5 id="6-1æ¦‚è¿°"><a href="#6-1æ¦‚è¿°" class="headerlink" title="6.1æ¦‚è¿°"></a>6.1æ¦‚è¿°</h5><p><strong>å®šä½äº†æŸ¥è¯¢æ…¢çš„SQLä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨EXPLAINæˆ–DESCRIBEå·¥å…·åšé’ˆå¯¹æ€§çš„åˆ†ææŸ¥è¯¢è¯­å¥ã€‚</strong>DESCRIBEè¯­å¥çš„ä½¿ç”¨æ–¹æ³•ä¸EXPLAINè¯­å¥ä¸€æ ·ï¼Œåˆ†æç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„</p>
<p>MysQLä¸­æœ‰ä¸“é—¨è´Ÿè´£ä¼˜åŒ–SELECTè¯­å¥çš„ä¼˜åŒ–å™¨æ¨¡å—ï¼Œä¸»è¦åŠŸèƒ½:é€šè¿‡è®¡ç®—åˆ†æç³»ç»Ÿä¸­æ”¶é›†åˆ°çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„Queryæä¾›å®ƒè®¤ä¸ºæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼ˆä»–è®¤ä¸ºæœ€ä¼˜çš„æ•°æ®æ£€ç´¢æ–¹å¼ï¼Œä½†ä¸è§å¾—æ˜¯DBAè®¤ä¸ºæ˜¯æœ€ä¼˜çš„ï¼Œè¿™éƒ¨åˆ†æœ€è€—è´¹æ—¶é—´)ã€‚<br>è¿™ä¸ªæ‰§è¡Œè®¡åˆ’å±•ç¤ºäº†æ¥ä¸‹æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ï¼Œæ¯”å¦‚å¤šè¡¨è¿æ¥çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Œå¯¹äºæ¯ä¸ªè¡¨é‡‡ç”¨ä»€ä¹ˆè®¿é—®æ–¹æ³•æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢ç­‰ç­‰ã€‚MySQLä¸ºæˆ‘ä»¬æä¾›äº†EXPLAINè¯­å¥æ¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹æŸä¸ªæŸ¥è¯¢è¯­å¥çš„å…·ä½“æ‰§è¡Œè®¡åˆ’ï¼Œå¤§å®¶çœ‹æ‡‚EXPLAINè¯­å¥çš„å„ä¸ªè¾“å‡ºé¡¹ï¼Œå¯ä»¥æœ‰é’ˆå¯¹æ€§çš„æå‡æˆ‘ä»¬æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ã€‚</p>
<p><strong>1.èƒ½åšä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>è¡¨çš„è¯»å–é¡ºåº</li>
<li>æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li>
<li>å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li>
<li>å“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li>
<li>è¡¨ä¹‹é—´çš„å¼•ç”¨</li>
<li>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li>
</ul>
<p><strong>2.å®˜ç½‘ä»‹ç»</strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></strong> </p>
<p><strong><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">https://dev.mysql.com/doc/refman/8.0/en/explain-output.html</a></strong> </p>
<p><img src="/2022/04/22/MySQL/1653095427721.png" alt="1653095427721" loading="lazy"></p>
<p><strong>3.ç‰ˆæœ¬æƒ…å†µ</strong></p>
<ul>
<li><p>MySQL 5.6.3ä»¥å‰åªèƒ½EXPLAIN SELECT;MYSQL 5.6.3ä»¥åå°±å¯ä»¥EXPLAIN SELECTï¼ŒUPDATE,DELETE</p>
</li>
<li><p>åœ¨5.7ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæƒ³è¦æ˜¾ç¤ºpartitionséœ€è¦ä½¿ç”¨explain partitionså‘½ä»¤;æƒ³è¦æ˜¾ç¤ºfilteredéœ€è¦ä½¿ç”¨explain extendedå‘½ä»¤ã€‚åœ¨5.7ç‰ˆæœ¬åï¼Œé»˜è®¤explainç›´æ¥æ˜¾ç¤º<strong>partitionså’Œfiltered</strong>ä¸­çš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/22/MySQL/1653095561908.png" alt="1653095561908" loading="lazy"></p>
<h5 id="6-2åŸºæœ¬è¯­æ³•"><a href="#6-2åŸºæœ¬è¯­æ³•" class="headerlink" title="6.2åŸºæœ¬è¯­æ³•"></a>6.2åŸºæœ¬è¯­æ³•</h5><p>EXPLAINæˆ–DESCSRIBEè¯­å¥çš„è¯­æ³•æ ¼å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT select_options</span><br><span class="line">#æˆ–</span><br><span class="line">DESCRIBE SELECT select_options</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³çœ‹çœ‹æŸä¸ªæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥åœ¨å…·ä½“è¯­å¥å‰åŠ explainï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; EXPLAIN SELECT 1;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1653095842869.png" alt="1653095842869" loading="lazy"></p>
<p>è¾“å‡ºçš„ä¸Šè¿°ä¿¡æ¯å°±æ˜¯æ‰€è°“çš„æ‰§è¡Œè®¡åˆ’ã€‚åœ¨è¿™ä¸ªæ‰§è¡Œè®¡åˆ’çš„è¾…åŠ©ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åº”è¯¥æ€æ ·æ”¹è¿›è‡ªå·±çš„æŸ¥è¯¢è¯­å¥ä»¥ä½¿æŸ¥è¯¢æ‰§è¡Œèµ·æ¥æ›´é«˜æ•ˆã€‚å…¶å®é™¤äº†ä»¥SELECTå¼€å¤´çš„æŸ¥è¯¢è¯­å¥ï¼Œå…¶ä½™çš„DELETEã€INSERTã€REPLACE ä»¥åŠUPDATEè¯­å¥ç­‰éƒ½å¯ä»¥åŠ ä¸ŠEXPLAINï¼Œç”¨æ¥æŸ¥çœ‹è¿™äº›è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œåªæ˜¯å¹³æ—¶æˆ‘ä»¬å¯¹SELECTè¯­å¥æ›´æ„Ÿå…´è¶£ã€‚</p>
<p>æ³¨æ„:æ‰§è¡ŒEXPLAINæ—¶å¹¶æ²¡æœ‰çœŸæ­£çš„æ‰§è¡Œè¯¥åé¢çš„è¯­å¥ï¼Œå› æ­¤å¯ä»¥å®‰å…¨çš„æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚</p>
<p>EXPLAINè¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>åˆ—å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­æ¯ä¸ªSELECTå…³é”®å­—å¯¹åº”ä¸€ä¸ª<strong>å”¯ä¸€id</strong>(è¡¨çš„è¯»å–é¡ºåº)</td>
</tr>
<tr>
<td>select_type</td>
<td>SELECTå…³é”®å­—å¯¹åº”çš„é‚£ä¸ªæŸ¥è¯¢çš„ç±»å‹</td>
</tr>
<tr>
<td>table</td>
<td>è¡¨æ˜</td>
</tr>
<tr>
<td>pertitions</td>
<td>åŒ¹é…çš„åˆ†åŒºä¿¡æ¯</td>
</tr>
<tr>
<td>type</td>
<td>é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•(è®¿é—®ç±»å‹)</td>
</tr>
<tr>
<td>possible_keys</td>
<td>å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•</td>
</tr>
<tr>
<td>key</td>
<td>å®é™…ä½¿ç”¨çš„ç´¢å¼•</td>
</tr>
<tr>
<td>key_len</td>
<td>å®é™…ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦</td>
</tr>
<tr>
<td>ref</td>
<td>å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯</td>
</tr>
<tr>
<td>rows</td>
<td>é¢„ä¼°éœ€è¦è¯»å–çš„è¡Œæ•°</td>
</tr>
<tr>
<td>filterd</td>
<td>æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>Extra</td>
<td>ä¸€äº›é¢å¤–ä¿¡æ¯</td>
</tr>
</tbody></table>
<h5 id="6-3æ•°æ®å‡†å¤‡"><a href="#6-3æ•°æ®å‡†å¤‡" class="headerlink" title="6.3æ•°æ®å‡†å¤‡"></a>6.3æ•°æ®å‡†å¤‡</h5><p><strong>1.å»ºè¡¨</strong></p>
<p><img src="/2022/04/22/MySQL/1653096704579.png" alt="1653096704579" loading="lazy"></p>
<p><strong>2.è®¾ç½®å‚æ•°log_bin_trust_function_creators</strong></p>
<p>åˆ›å»ºå‡½æ•°ï¼ŒåŠ å…¥æŠ¥é”™ï¼Œå¼€å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global log_bin_trust_function_creators; #ä¸åŠ globalåªå¯¹å½“å‰çª—å£æœ‰æ•ˆ</span><br></pre></td></tr></table></figure>

<p><strong>3.åˆ›å»ºå‡½æ•°</strong></p>
<p><img src="/2022/04/22/MySQL/1653096838285.png" alt="1653096838285" loading="lazy"></p>
<p><strong>4.åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</strong></p>
<p>åˆ›å»ºå¾€s1è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š<img src="/2022/04/22/MySQL/1653096886918.png" alt="1653096886918" loading="lazy"></p>
<p>åˆ›å»ºå¾€s2è¡¨ä¸­æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼š<img src="/2022/04/22/MySQL/1653096956683.png" alt="1653096956683" loading="lazy"></p>
<p><strong>5.è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</strong></p>
<p><img src="/2022/04/22/MySQL/1653096975431.png" alt="1653096975431" loading="lazy"></p>
<h5 id="6-4EXPLAINå„åˆ—ä½œç”¨"><a href="#6-4EXPLAINå„åˆ—ä½œç”¨" class="headerlink" title="6.4EXPLAINå„åˆ—ä½œç”¨"></a>6.4EXPLAINå„åˆ—ä½œç”¨</h5><h6 id="1-table"><a href="#1-table" class="headerlink" title="1.table"></a><strong>1.table</strong></h6><p>ä¸è®ºæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æœ‰å¤šå¤æ‚ï¼Œé‡Œè¾¹å„¿ <strong>åŒ…å«äº†å¤šå°‘ä¸ªè¡¨</strong> ï¼Œåˆ°æœ€åä¹Ÿæ˜¯éœ€è¦å¯¹æ¯ä¸ªè¡¨è¿›è¡Œ <strong>å•è¡¨è®¿é—®</strong> çš„ï¼Œæ‰€ä»¥MySQLè§„å®š<strong>EXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•</strong>ï¼Œè¯¥æ¡è®°å½•çš„tableåˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨åï¼ˆæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—ï¼Œå¯èƒ½æ˜¯ç®€ç§°ï¼‰ã€‚</p>
<h6 id="2-id"><a href="#2-id" class="headerlink" title="2.id"></a>2.id</h6><p><img src="/2022/04/22/MySQL/1653097396890.png" alt="1653097396890" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1653097545054.png" alt="1653097545054" loading="lazy"></p>
<ul>
<li>idç›¸åŒé¡ºåºæ‰§è¡Œ</li>
<li>idä¸åŒï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</li>
<li>ä¸¤ç§æƒ…å†µåŒæ—¶å­˜åœ¨ï¼Œæ°¸è¿œæ˜¯idè¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼Œidç›¸åŒé¡ºåºæ‰§è¡Œ</li>
<li><strong>å…³æ³¨ç‚¹ï¼š</strong>idå·æ¯ä¸ªå·ç ï¼Œè¡¨ç¤ºä¸€è¶Ÿç‹¬ç«‹çš„æŸ¥è¯¢, ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¶Ÿæ•°è¶Šå°‘è¶Šå¥½</li>
</ul>
<h6 id="3-select-type"><a href="#3-select-type" class="headerlink" title="3.select_type"></a>3.select_type</h6><p>ä¸€æ¡å¤§çš„æŸ¥è¯¢è¯­å¥é‡Œè¾¹å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªSELECTå…³é”®å­—ï¼Œ<strong>æ¯ä¸ªSELECTå…³é”®å­—ä»£è¡¨ç€ä¸€ä¸ªå°çš„æŸ¥è¯¢è¯­å¥</strong>ï¼Œè€Œæ¯ä¸ªSELECTå…³é”®å­—çš„FROMå­å¥ä¸­éƒ½å¯ä»¥åŒ…å«è‹¥å¹²å¼ è¡¨(è¿™äº›è¡¨ç”¨æ¥åšè¿æ¥æŸ¥è¯¢)ï¼Œ<strong>æ¯ä¸€å¼ è¡¨éƒ½å¯¹åº”ç€æ‰§è¡Œè®¡åˆ’è¾“å‡ºä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¯¹äºåœ¨åŒä¸€ä¸ªSELECTå…³é”®å­—ä¸­çš„è¡¨æ¥è¯´ï¼Œå®ƒä»¬çš„idå€¼æ˜¯ç›¸åŒçš„</strong>ã€‚</p>
<p>MysQLä¸ºæ¯ä¸€ä¸ªSELECTå…³é”®å­—ä»£è¡¨çš„å°æŸ¥è¯¢éƒ½å®šä¹‰äº†ä¸€ä¸ªç§°ä¹‹ä¸º<strong>select_type</strong>çš„å±æ€§ï¼Œæ„æ€æ˜¯æˆ‘ä»¬åªè¦çŸ¥é“äº†æŸä¸ªå°æŸ¥è¯¢çš„select_typeå±æ€§ï¼Œå°±çŸ¥é“äº†è¿™ä¸ªå°æŸ¥è¯¢åœ¨æ•´ä¸ªå¤§æŸ¥è¯¢ä¸­æ‰®æ¼”äº†ä¸€ä¸ªä»€ä¹ˆè§’è‰²ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹select_typeéƒ½èƒ½å–å“ªäº›å€¼ï¼Œè¯·çœ‹å®˜æ–¹æ–‡æ¡£:</p>
<p><img src="/2022/04/22/MySQL/1653098304861.png" alt="1653098304861" loading="lazy"></p>
<p>å…·ä½“åˆ†æï¼š</p>
<p>select_type:æŸ¥è¯¢ç±»å‹ï¼Œç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢</p>
<ul>
<li><p>SIMPLEï¼šç®€å•selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–union</p>
</li>
<li><p>PRIMARYï¼šæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚åˆ™è¢«æ ‡è®°ä¸ºprimary</p>
</li>
<li><p>SUBQUERYï¼šåœ¨selectæˆ–whereåˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ <img src="/2022/04/22/MySQL/1653099167641.png" alt="1653099167641" loading="lazy"><img src="/2022/04/22/MySQL/1653098552304.png" alt="1653098552304" loading="lazy"></p>
</li>
<li><p>DEPENDENT SUBUERY<img src="/2022/04/22/MySQL/1653099157786.png" alt="1653099157786" loading="lazy"></p>
</li>
<li><p>DERIUEDï¼šåœ¨fromåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºæ­¤(è¡ç”Ÿ)mysqlä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨</p>
</li>
<li><p>UNIONï¼šè‹¥ç¬¬äºŒä¸ªselectå‡ºç°åœ¨unionåï¼Œåˆ™è¢«æ ‡è®°ä¸ºUNIONï¼Œè‹¥unionåŒ…å«åœ¨fromå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚selectè¢«æ ‡è®°ä¸ºderivedï¼Œå¯¹äºunionæˆ–union allæ¥è¯´ï¼Œé™¤äº†æœ€å·¦è¾¹å°æŸ¥è¯¢å¤–ï¼Œå…¶ä½™çš„å°±æ˜¯union</p>
</li>
<li><p>DEPENDENT UNION<img src="/2022/04/22/MySQL/1653099265336.png" alt="1653099265336" loading="lazy"></p>
</li>
<li><p>UNION RESULTï¼šä»unionè¡¨è·å–ç»“æœçš„select(åˆå¹¶ä¹‹åçš„æŸ¥è¯¢å°±æ˜¯è¿™ä¸ªé€‰é¡¹)</p>
</li>
<li><p>MATERIALIZED<img src="/2022/04/22/MySQL/1653099413713.png" alt="1653099413713" loading="lazy"></p>
</li>
</ul>
<h6 id="4-partitions"><a href="#4-partitions" class="headerlink" title="4.partitions"></a>4.partitions</h6><p><img src="/2022/04/22/MySQL/1653099546460.png" alt="1653099546460" loading="lazy"></p>
<h6 id="5-typeâ˜†"><a href="#5-typeâ˜†" class="headerlink" title="5.typeâ˜†"></a>5.typeâ˜†</h6><p><strong>typeï¼šè®¿é—®ç±»å‹ï¼Œç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡ï¼šsystem&gt;const&gt;eq_ref&gt;ref&gt;fulltext&gt;ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_subquery&gt;range&gt;index&gt;All</strong></p>
<p>å¸¸è§æŒ‡æ ‡ä¸»è¦æœ‰ï¼šsystem&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;All,ä¸€èˆ¬åªè¦è¦è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½åˆ°ref</p>
<ul>
<li><p><strong>system</strong></p>
<p>å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•å¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚MyIASMï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨è®¿é—®æ–¹æ³•å°±æ˜¯sytem</p>
</li>
<li><p><strong>const</strong></p>
<p>å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–å”¯ä¸€çš„äºŒçº§ç´¢å¼•(unique)ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹å•è¡¨è®¿é—®æ–¹æ³•å°±æ˜¯const</p>
</li>
<li><p><strong>eq_ref</strong></p>
<p>åœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè®¿é—®ï¼ˆå¦‚æœè¯¥ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯è”åˆç´¢å¼•ï¼Œæ‰€æœ‰ç´¢å¼•åˆ—éƒ½å¿…é¡»ç­‰å€¼æ¯”è¾ƒï¼‰ï¼Œåˆ™å¯¹è¯¥è¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯eq_ref</p>
</li>
<li><p><strong>ref</strong></p>
<p>å½“é€šè¿‡æ™®é€šäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶æ¥æŸ¥è¯¢æŸä¸ªè¡¨ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±å¯èƒ½æ˜¯ref</p>
</li>
<li><p><strong>range</strong></p>
<p>å¦‚æœä½¿ç”¨ç´¢å¼•è·å–æŸäº›èŒƒå›´åŒºé—´çš„è®°å½•ï¼Œå°±å¯èƒ½ä½¿ç”¨range</p>
</li>
<li><p><strong>index</strong></p>
<p>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨è®¿é—®æ–¹æ³•æ˜¯index</p>
</li>
<li><p>all</p>
<p>å…¨è¡¨æ‰«æ</p>
</li>
</ul>
<h6 id="6-possible-keyså’Œkey"><a href="#6-possible-keyså’Œkey" class="headerlink" title="6.possible_keyså’Œkey"></a>6.possible_keyså’Œkey</h6><p>åœ¨EXPLAINè¯­å¥è¾“å‡ºçš„æ‰§è¡Œè®¡åˆ’ä¸­, possible_keysåˆ—è¡¨ç¤ºåœ¨æŸä¸ªæŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¯¹æŸä¸ªè¡¨æ‰§è¡Œå•è¡¨æŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•æœ‰å“ªäº›ã€‚ä¸€èˆ¬æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨ã€‚keyåˆ—è¡¨ç¤ºå®é™…ç”¨åˆ°çš„ç´¢å¼•æœ‰å“ªäº›ï¼Œå¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æ¯”æ–¹è¯´ä¸‹è¾¹è¿™ä¸ªæŸ¥è¯¢:</p>
<h6 id="7-key-lenâ˜†"><a href="#7-key-lenâ˜†" class="headerlink" title="7.key_lenâ˜†"></a><strong>7.key_len</strong>â˜†</h6><p>å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦ï¼ˆå³ï¼Œå­—èŠ‚æ•°ï¼‰</p>
<p>æ£€æŸ¥æ˜¯å¦å……åˆ†åˆ©ç”¨ç´¢å¼•ï¼Œå€¼è¶Šå¤§è¶Šå¥½ï¼ˆé’ˆå¯¹äºè”åˆç´¢å¼•ï¼‰</p>
<h6 id="8-ref"><a href="#8-ref" class="headerlink" title="8.ref"></a>8.ref</h6><p>å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ï¼Œæ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¸¸æ•°æˆ–æŸä¸ªåˆ—</p>
<h6 id="9-rowsâ˜†"><a href="#9-rowsâ˜†" class="headerlink" title="9.rowsâ˜†"></a>9.rowsâ˜†</h6><p>é¢„ä¼°è¯»å–çš„è®°å½•è¡Œæ•°ï¼Œå€¼è¶Šå°è¶Šå¥½</p>
<h6 id="10-filtered"><a href="#10-filtered" class="headerlink" title="10.filtered"></a>10.filtered</h6><p>æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°ä¸­åº”ç”¨åˆ°ç»“æœçš„æ¡æ•°çš„ç™¾åˆ†æ¯”</p>
<p>å¯¹äºå•è¡¨æŸ¥è¯¢æ¥è¯´ï¼Œè¿™ä¸ªfilteredåˆ—çš„å€¼æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œæˆ‘ä»¬æ›´å…³æ³¨è¿æ¥æŸ¥è¯¢ä¸­é©±åŠ¨è¡¨å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’è®°å½•çš„filteredå€¼ï¼Œå®ƒå†³å®šäº†è¢«é©±åŠ¨è¡¨è¦æ‰§è¡Œçš„æ¬¡æ•°ï¼ˆå³ï¼šrows*filteredï¼‰</p>
<h6 id="11-Extraâ˜†"><a href="#11-Extraâ˜†" class="headerlink" title="11.Extraâ˜†"></a>11.Extraâ˜†</h6><p>ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡é¢å¤–ä¿¡æ¯æ¥æ›´å‡†ç¡®çš„ç†è§£MySQLåˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥ã€‚</p>
<ul>
<li><p>no table used</p>
<p>å½“æŸ¥è¯¢è¯­å¥æ²¡æœ‰fromå­å¥æ—¶ä¼šæç¤ºè¯¥ä¿¡æ¯</p>
<blockquote>
<p>explain select 1</p>
</blockquote>
</li>
<li><p>Impossible WHERE</p>
<p>æŸ¥è¯¢è¯­å¥çš„WHEREå­å¥æ°¸è¿œä¸ºFALSEæ—¶å°†ä¼šæç¤ºè¯¥ä¿¡æ¯</p>
<blockquote>
<p>explain select * from s1 where 1ï¼=1 </p>
</blockquote>
</li>
<li><p>using where</p>
<p>(1)å½“ä½¿ç”¨å…¨è¡¨æ‰«æ(æ²¡ä½¿ç”¨ç´¢å¼•)æ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„whereå­å¥ä¸­æœ‰é’ˆå¯¹è¯¥è¡¨çš„æœç´¢æ¡ä»¶æ—¶ï¼Œä¼šæç¤ºè¯¥ä¿¡æ¯</p>
<blockquote>
<p>explain select * from s1 where common_field=â€™aâ€™</p>
</blockquote>
<p>(2)å½“ä½¿ç”¨ç´¢å¼•æ‰§è¡Œæ¥æ‰§è¡Œå¯¹æŸä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”è¯¥è¯­å¥çš„whereå­å¥ä¸­æœ‰é™¤äº†è¯¥ç´¢å¼•åŒ…å«çš„åˆ—ä¹‹å¤–çš„å…¶ä»–æœç´¢æ¡ä»¶æ—¶ï¼Œä¼šæç¤ºè¯¥ä¿¡æ¯</p>
<blockquote>
<p>explain select * from s1 where key1=â€™aâ€™ and common_field = â€˜aâ€™</p>
</blockquote>
</li>
<li><p>no matching min/max row</p>
<p>å½“æŸ¥è¯¢åˆ—è¡¨å¤„æœ‰minæˆ–maxèšåˆå‡½æ•°ï¼Œä½†è¡¨ä¸­å¹¶æ²¡æœ‰whereå­å¥ä¸­çš„æœç´¢æ¡ä»¶çš„è®°å½•æ—¶ï¼Œä¼šæç¤ºè¯¥ä¿¡æ¯</p>
<blockquote>
<p>explain select MIN(key1) from s1 where key1=â€™abcdefâ€™</p>
<p>è¡¨s1ä¸­æ²¡æœ‰abcdefè¿™ä¸€æ¡è®°å½•</p>
</blockquote>
</li>
<li><p>using index</p>
<p>å½“æŸ¥è¯¢åˆ—è¡¨ä»¥åŠæœç´¢æ¡ä»¶ä¸­åªåŒ…å«å±äºæŸä¸ªç´¢å¼•çš„åˆ—ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œåœ¨â€˜Extraâ€™åˆ—å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯ã€‚</p>
<blockquote>
<p>EXPLAIN SELECT key1 FROM s1 WHERE key1=â€™aâ€™;</p>
</blockquote>
</li>
<li><p>using index condition</p>
<p>æœ‰äº›æœç´¢æ¡ä»¶ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†å´ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•</p>
<blockquote>
<p>EXPLAIN SELECT * FROM s1 WHERE key&gt;â€™zâ€™ AND key1 LIKE â€˜%aâ€™</p>
</blockquote>
</li>
<li><p>using join buffer</p>
<p>åœ¨è¿æ¥æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œå½“è¢«é©±åŠ¨è¡¨ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•åŠ å¿«è®¿é—®é€Ÿåº¦ï¼ŒMySQLä¸€èˆ¬ä¼šä¸ºå…¶åˆ†é…ä¸€å—åå«â€œjoin bufferâ€çš„å†…å­˜å—æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦</p>
<blockquote>
<p>EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.common_field =  s2.common_field</p>
</blockquote>
</li>
</ul>
<h2 id="InnoDBæ•°æ®å­˜å‚¨ç»“æ„"><a href="#InnoDBæ•°æ®å­˜å‚¨ç»“æ„" class="headerlink" title="InnoDBæ•°æ®å­˜å‚¨ç»“æ„"></a>InnoDBæ•°æ®å­˜å‚¨ç»“æ„</h2><h3 id="1-æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ"><a href="#1-æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ" class="headerlink" title="1.æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ"></a>1.æ•°æ®åº“çš„å­˜å‚¨ç»“æ„ï¼šé¡µ</h3><p>ç´¢å¼•ç»“æ„ç»™æˆ‘ä»¬æä¾›äº†é«˜æ•ˆçš„ç´¢å¼•æ–¹å¼ï¼Œä¸è¿‡ç´¢å¼•ä¿¡æ¯ä»¥åŠæ•°æ®è®°å½•éƒ½æ˜¯ä¿å­˜åœ¨æ–‡ä»¶ä¸Šçš„ï¼Œç¡®åˆ‡è¯´æ˜¯å­˜å‚¨åœ¨é¡µç»“æ„ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°çš„ï¼ŒMySQLæœåŠ¡å™¨ä¸Šçš„<strong>å­˜å‚¨å¼•æ“</strong>è´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®çš„è¯»å–å’Œå†™å…¥å·¥ä½œã€‚ä¸åŒå­˜å‚¨å¼•æ“ä¸­<strong>å­˜æ”¾çš„æ ¼å¼</strong>ä¸€èˆ¬æ˜¯ä¸åŒçš„ï¼Œç”šè‡³æœ‰çš„å­˜å‚¨å¼•æ“æ¯”å¦‚Memoryéƒ½ä¸ç”¨ç£ç›˜æ¥å­˜å‚¨æ•°æ®ã€‚</p>
<h4 id="1-1ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½"><a href="#1-1ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½" class="headerlink" title="1.1ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½"></a>1.1ç£ç›˜ä¸å†…å­˜äº¤äº’åŸºæœ¬å•ä½</h4><p>InnoDBå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼ŒInnoDBä¸­é¡µçš„å¤§å°é»˜è®¤ä¸º<strong>16KBã€‚</strong></p>
<p>ä»¥<strong>é¡µ</strong>ä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„<strong>åŸºæœ¬å•ä½</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KBå†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨æ•°æ®åº“ä¸­ï¼Œä¸è®ºè¯»ä¸€è¡Œï¼Œè¿˜æ˜¯è¯»å¤šè¡Œï¼Œéƒ½æ˜¯å°†è¿™äº›è¡Œæ‰€åœ¨çš„é¡µè¿›è¡ŒåŠ è½½</strong>ã€‚<strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½æ˜¯é¡µ(Page)ï¼Œæ•°æ®åº“I/oæ“ä½œçš„æœ€å°å•ä½æ˜¯é¡µã€‚</strong><br>ä¸€ä¸ªé¡µä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªè¡Œè®°å½•ã€‚</p>
<blockquote>
<p>è®°å½•æ—¶æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥è¡Œä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡IOæ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½</p>
</blockquote>
<p><img src="/2022/04/22/MySQL/1652691435656.png" alt="1652691435656" loading="lazy"></p>
<h4 id="1-2é¡µç»“æ„æ¦‚è¿°"><a href="#1-2é¡µç»“æ„æ¦‚è¿°" class="headerlink" title="1.2é¡µç»“æ„æ¦‚è¿°"></a>1.2é¡µç»“æ„æ¦‚è¿°</h4><p>é¡µaã€é¡µbã€é¡µcâ€¦é¡µnè¿™äº›é¡µå¯ä»¥<strong>ä¸åœ¨ç‰©ç†ç»“æ„ä¸Šç›¸è¿</strong>ï¼Œåªè¦é€šè¿‡<strong>åŒå‘é“¾è¡¨</strong>ç›¸å…³è”å³å¯ã€‚æ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•ä¼šæŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºç»„æˆä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong>ï¼Œæ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå­˜å‚¨åœ¨å®ƒé‡Œè¾¹çš„è®°å½•ç”Ÿæˆä¸€ä¸ª<strong>é¡µç›®å½•</strong>ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨é¡µç›®å½•ä¸­<strong>ä½¿ç”¨äºŒåˆ†æ³•</strong>å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚</p>
<h4 id="1-3é¡µçš„å¤§å°"><a href="#1-3é¡µçš„å¤§å°" class="headerlink" title="1.3é¡µçš„å¤§å°"></a>1.3é¡µçš„å¤§å°</h4><p>ä¸åŒçš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆç®€ç§°DBMS ï¼‰çš„é¡µå¤§å°ä¸åŒã€‚æ¯”å¦‚åœ¨MysQLçš„InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤é¡µçš„å¤§å°æ˜¯<strong>16KB</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%innodb_page_size%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652691326064.png" alt="1652691326064" loading="lazy"></p>
<p>SQL Serverä¸­é¡µçš„å¤§å°ä¸º <strong>8KB</strong>ï¼Œè€Œåœ¨Oracleä¸­æˆ‘ä»¬ç”¨æœ¯è¯­â€œå—â€(Block)æ¥ä»£è¡¨â€œé¡µâ€ï¼ŒOralceæ”¯æŒçš„å—å¤§å°ä¸º2KBï¼Œ4KBï¼Œ8KBï¼Œ16KBï¼Œ32KBå’Œ64KBã€‚</p>
<h4 id="1-4é¡µçš„ä¸Šå±‚ç»“æ„"><a href="#1-4é¡µçš„ä¸Šå±‚ç»“æ„" class="headerlink" title="1.4é¡µçš„ä¸Šå±‚ç»“æ„"></a>1.4é¡µçš„ä¸Šå±‚ç»“æ„</h4><p>å¦å¤–åœ¨æ•°æ®åº“ä¸­ï¼Œè¿˜å­˜åœ¨ç€åŒº(Extent)ã€æ®µ(Segment)å’Œè¡¨ç©ºé—´(Tablespace)çš„æ¦‚å¿µã€‚è¡Œã€é¡µã€åŒºã€æ®µã€è¡¨ç©ºé—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652691645599.png" alt="1652691645599" loading="lazy"></p>
<p>åŒº(Extent)æ˜¯æ¯”é¡µå¤§ä¸€çº§çš„å­˜å‚¨ç»“æ„ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œ<strong>ä¸€ä¸ªåŒºä¼šåˆ†é…64ä¸ªè¿ç»­çš„é¡µ</strong>ã€‚å› ä¸ºInnoDBä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯64*16KB= 1MBã€‚</p>
<p>æ®µ(Segment)ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºåœ¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¿ç»­åˆ†é…çš„ç©ºé—´(åœ¨InnoDBä¸­æ˜¯è¿ç»­çš„64ä¸ªé¡µ)ï¼Œä¸è¿‡åœ¨æ®µä¸­ä¸è¦æ±‚åŒºä¸åŒºä¹‹é—´æ˜¯ç›¸é‚»çš„ã€‚<strong>æ®µæ˜¯æ•°æ®åº“ä¸­çš„åˆ†é…å•ä½ï¼Œä¸åŒç±»å‹çš„æ•°æ®åº“å¯¹è±¡ä»¥ä¸åŒçš„æ®µå½¢å¼å­˜åœ¨</strong>ã€‚å½“æˆ‘ä»¬åˆ›å»ºæ•°æ®è¡¨ã€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šç›¸åº”åˆ›å»ºå¯¹åº”çš„æ®µï¼Œæ¯”å¦‚åˆ›å»ºä¸€å¼ è¡¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¡¨æ®µï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªç´¢å¼•æ®µã€‚</p>
<p>è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰æ˜¯ä¸€é€»è¾‘å®¹å™¨ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ï¼Œä¹¦åº“ç”±ä¸€ä¸ªæˆ–è¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºç³»ç»Ÿè¡¨ç©ºé—´ã€ç”¨æˆ·è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ç­‰</p>
<h3 id="2-é¡µçš„å†…éƒ¨ç»“æ„"><a href="#2-é¡µçš„å†…éƒ¨ç»“æ„" class="headerlink" title="2.é¡µçš„å†…éƒ¨ç»“æ„"></a>2.é¡µçš„å†…éƒ¨ç»“æ„</h3><p>é¡µå¦‚æœæŒ‰ç±»å‹åˆ’åˆ†çš„è¯ï¼Œå¸¸è§çš„æœ‰æ•°æ®é¡µï¼ˆä¿å­˜B+æ ‘èŠ‚ç‚¹)ã€ç³»ç»Ÿé¡µã€Undoé¡µå’Œäº‹åŠ¡æ•°æ®é¡µç­‰ã€‚æ•°æ®é¡µæ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„é¡µã€‚</p>
<p>æ•°æ®é¡µçš„<strong>16KB</strong> å¤§å°çš„å­˜å‚¨ç©ºé—´è¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ–‡ä»¶å¤´(File Header)ã€é¡µå¤´(Page Header)ã€æœ€å¤§æœ€å°è®°å½•(Infimum+supremum)ã€ç”¨æˆ·è®°å½•(User Records)ã€ç©ºé—²ç©ºé—´(Free Space)ã€é¡µç›®å½•(Page Directory)å’Œæ–‡ä»¶å°¾(File Tailer) ã€‚é¡µç»“æ„çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:<img src="/2022/04/22/MySQL/1652692705943.png" alt="1652692705943" loading="lazy"></p>
<p>è¿™7ä¸ªéƒ¨åˆ†ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼Œæˆ‘ä»¬ç®€å•æ¢³ç†å¦‚ä¸‹è¡¨ç¤ºï¼š<img src="/2022/04/22/MySQL/1652692754560.png" alt="1652692754560" loading="lazy"></p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™7ä¸ªç»“æ„åˆ†æˆ3ä¸ªéƒ¨åˆ†ã€‚</p>
<h4 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šFile-Header-æ–‡ä»¶å¤´éƒ¨-å’ŒFile-Trailer-æ–‡ä»¶å°¾éƒ¨"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šFile-Header-æ–‡ä»¶å¤´éƒ¨-å’ŒFile-Trailer-æ–‡ä»¶å°¾éƒ¨" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šFile Header(æ–‡ä»¶å¤´éƒ¨)å’ŒFile Trailer(æ–‡ä»¶å°¾éƒ¨)"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šFile Header(æ–‡ä»¶å¤´éƒ¨)å’ŒFile Trailer(æ–‡ä»¶å°¾éƒ¨)</h4><p>é¦–å…ˆæ˜¯æ–‡ä»¶é€šç”¨éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶å¤´å’Œæ–‡ä»¶å°¾</p>
<h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="åŸºæœ¬æ¦‚è¿°"><a href="#åŸºæœ¬æ¦‚è¿°" class="headerlink" title="åŸºæœ¬æ¦‚è¿°"></a>åŸºæœ¬æ¦‚è¿°</h3><h4 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h4><p>æ»¡è¶³ACIDç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡Commitæäº¤ï¼Œæˆ–Rollbackå›æ»š <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323233373932352e706e67.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>ä¸¾ä¸ªæ —å­</p>
</blockquote>
<p>è½¬è´¦æ“ä½œï¼šå°æ˜è¦ç»™å°çº¢è½¬è´¦1000ï¼Œè¿™ä¸ªäº‹ç‰©æ¶‰åŠä¸¤ä¸ªæ“ä½œï¼š</p>
<ol>
<li>å°æ˜è´¦æˆ·å‡å°‘1000</li>
<li>å°çº¢è´¦æˆ·å¢åŠ 1000</li>
</ol>
<p>è€Œäº‹ç‰©ä¼šæŠŠè¿™ä¸¤ä¸ªæ“ä½œå†é€»è¾‘ä¸Šçœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</p>
<p>è¿™æ ·å› ä¸ºäº‹ç‰©çš„å­˜åœ¨å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢ä½™é¢æ²¡å˜çš„æƒ…å†µ</p>
<h4 id="æ•°æ®åº“äº‹ç‰©"><a href="#æ•°æ®åº“äº‹ç‰©" class="headerlink" title="æ•°æ®åº“äº‹ç‰©"></a>æ•°æ®åº“äº‹ç‰©</h4><blockquote>
<p>æ•°æ®åº“äº‹ç‰©çš„ä½œç”¨</p>
</blockquote>
<p>æ•°æ®åº“çš„äº‹ç‰©å¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œ(sqlè¯­å¥)æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ï¼Œè€Œè¿™ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“éœ€è¦éµå¾ªï¼š<strong>è¦ä¹ˆå…¨éƒ¨æˆåŠŸã€è¦ä¹ˆå…¨éƒ¨å¤±è´¥</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯ä¸€ä¸ªäº‹ç‰©</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"># å¤šä½™çš„<span class="keyword">sql</span>è¯­å¥</span><br><span class="line">sql1ï¼Œsql2...</span><br><span class="line"># æäº¤äº‹ç‰©</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p> <img src="/2022/04/22/MySQL/640-20201207160554677.png" alt="img" loading="lazy"> </p>
<h4 id="æ•°æ®åº“çš„ACID"><a href="#æ•°æ®åº“çš„ACID" class="headerlink" title="æ•°æ®åº“çš„ACID"></a>æ•°æ®åº“çš„ACID</h4><p> <img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7.png" alt="äº‹åŠ¡çš„ç‰¹æ€§" loading="lazy"> </p>
<ol>
<li><p>åŸå­æ€§(Atomicity)</p>
<p>äº‹ç‰©è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„ä¿®å°å•ä½ï¼Œäº‹ç‰©çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸ ï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼Œè€Œå›æ»šå¯ä»¥é€šè¿‡å›æ»šæ—¥å¿—(undo log)æ¥å®ç°</p>
</li>
<li><p>ä¸€è‡´æ€§(Consistency)</p>
<p>äº‹ç‰©åœ¨æ‰§è¡Œå‰åä¿æŒä¸€è‡´æ€§çŠ¶æ€ï¼Œä¾‹å¦‚è½¬è´¦äº‹ç‰©ä¸­ï¼Œæ— è®ºæ˜¯å¦æˆåŠŸï¼Œè½¬è´¦äººå’Œæ”¶æ¬¾äººæ€»é¢ä¸å˜</p>
</li>
<li><p>éš”ç¦»æ€§(Lsolation)</p>
<p>ä¸€ä¸ªäº‹ç‰©åœ¨æœ€ç»ˆæäº¤å‰ï¼Œå¯¹å…¶ä»–äº‹ç‰©ä¸å¯è§</p>
</li>
<li><p>æŒä¹…æ€§(Durability)</p>
<p>ä¸€æ—¦äº‹ç‰©æäº¤ï¼Œåˆ™æ‰€ä½œä¿®æ”¹æ—¶æ°¸ä¹…æ€§çš„ä¿ç•™åœ¨æ•°æ®åº“ä¸­ ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œäº‹ç‰©æ‰§è¡Œè¿‡çš„ç»“æœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ ç³»ç»Ÿå‘ç”Ÿå´©æºƒå¯ä»¥ç”¨é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰è¿›è¡Œæ¢å¤ï¼Œä»è€Œå®ç°æŒä¹…æ€§ã€‚ä¸å›æ»šæ—¥å¿—è®°å½•æ•°æ®çš„é€»è¾‘ä¿®æ”¹ä¸åŒï¼Œé‡åšæ—¥å¿—è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ã€‚ </p>
</li>
</ol>
<hr>
<p><strong>äº‹ç‰©çš„ACIDå¹¶ä¸æ˜¯ä¸€ç§å¹³çº§å…³ç³»ï¼š</strong></p>
<ul>
<li><p>åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹ç‰©çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„</p>
</li>
<li><p>åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹ç‰©ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½æ»¡è¶³ï¼Œåªéœ€è¦æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šæ»¡è¶³ä¸€è‡´æ€§</p>
</li>
<li><p>åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹ç‰©å¹¶è¡Œæ‰§è¡Œï¼Œäº‹ç‰©ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ã€è¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½ä¿è¯ä¸€è‡´æ€§</p>
</li>
<li><p>äº‹ç‰©æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹ç³»ç»Ÿå´©æºƒçš„æƒ…å†µ</p>
<p><img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231303433373032332e706e67.png" alt="img" loading="lazy"> </p>
</li>
</ul>
<h4 id="äº‹ç‰©å®ç°åŸç†"><a href="#äº‹ç‰©å®ç°åŸç†" class="headerlink" title="äº‹ç‰©å®ç°åŸç†"></a>äº‹ç‰©å®ç°åŸç†</h4><ul>
<li>InnoDBå¼•æ“é€šè¿‡ä½¿ç”¨redo log(é‡åšæ—¥å¿—)æ¥ä¿è¯äº‹ç‰©çš„æŒä¹…æ€§ï¼Œä½¿ç”¨undo log(å›æ»šæ—¥å¿—)ä¿è¯äº‹ç‰©çš„åŸå­æ€§</li>
<li>é€šè¿‡é”æœºåˆ¶ã€MVCCæ¥ä¿è¯äº‹ç‰©çš„éš”ç¦»æ€§(é»˜è®¤éš”ç¦»çº§åˆ«å¯é‡å¤è¯»)</li>
</ul>
<p>ä¿è¯äº†äº‹ç‰©çš„åŸå­æ€§ã€æŒä¹…æ€§ã€éš”ç¦»æ€§ï¼Œæ‰èƒ½ä¿è¯ä¸€è‡´æ€§</p>
<h4 id="äº‹åŠ¡çš„çŠ¶æ€"><a href="#äº‹åŠ¡çš„çŠ¶æ€" class="headerlink" title="äº‹åŠ¡çš„çŠ¶æ€"></a>äº‹åŠ¡çš„çŠ¶æ€</h4><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¯¹åº”ç€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åº“æ“ä½œï¼Œæ ¹æ®è¿™äº›æ“ä½œæ‰€æ‰§è¡Œçš„ä¸åŒé˜¶æ®µæŠŠäº‹åŠ¡å¤§è‡´åˆ†ä¸ºå‡ ä¸ªçŠ¶æ€:</p>
<ul>
<li><p>æ´»åŠ¨çš„ï¼ˆactiveï¼‰</p>
<p>äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ—¶ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨ æ´»åŠ¨çš„ çŠ¶æ€ã€‚</p>
</li>
<li><p>éƒ¨åˆ†æäº¤çš„ï¼ˆpartially comittedï¼‰</p>
<p>å½“äº‹åŠ¡ä¸­çš„æœ€åä¸€ä¸ªæ“ä½œæ‰§è¡Œå®Œæˆï¼Œä½†ç”±äºæ“ä½œéƒ½åœ¨å†…å­˜ä¸­æ‰§è¡Œï¼Œæ‰€é€ æˆçš„å½±å“å¹¶ æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜æ—¶ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨ éƒ¨åˆ†æäº¤çš„ çŠ¶æ€</p>
</li>
<li><p>å¤±è´¥çš„ï¼ˆfailedï¼‰</p>
<p>å½“äº‹åŠ¡å¤„åœ¨ æ´»åŠ¨çš„ æˆ–è€… éƒ¨åˆ†æäº¤çš„ çŠ¶æ€æ—¶ï¼Œå¯èƒ½é‡åˆ°äº†æŸäº›é”™è¯¯ï¼ˆæ•°æ®åº“è‡ªèº«çš„é”™è¯¯ã€æ“ä½œç³»ç»Ÿé”™è¯¯æˆ–è€…ç›´æ¥æ–­ç”µç­‰ï¼‰è€Œæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œæˆ–è€…äººä¸ºçš„åœæ­¢å½“å‰äº‹åŠ¡çš„æ‰§è¡Œï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨ å¤±è´¥çš„ çŠ¶æ€ã€‚</p>
</li>
<li><p>ä¸­æ­¢çš„ï¼ˆabortedï¼‰</p>
<p>å¦‚æœäº‹åŠ¡æ‰§è¡Œäº†ä¸€éƒ¨åˆ†è€Œå˜ä¸º å¤±è´¥çš„ çŠ¶æ€ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠå·²ç»ä¿®æ”¹çš„äº‹åŠ¡ä¸­çš„æ“ä½œè¿˜åŸåˆ°äº‹åŠ¡æ‰§ è¡Œå‰çš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¦æ’¤é”€å¤±è´¥äº‹åŠ¡å¯¹å½“å‰æ•°æ®åº“é€ æˆçš„å½±å“ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªæ’¤é”€çš„è¿‡ç¨‹ç§°ä¹‹ä¸º å›æ»š ã€‚å½“ å›æ»š æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“æ¢å¤åˆ°äº†æ‰§è¡Œäº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°±è¯´è¯¥äº‹åŠ¡å¤„åœ¨äº† ä¸­æ­¢çš„ çŠ¶æ€ã€‚</p>
</li>
<li><p>æäº¤çš„ï¼ˆcommittedï¼‰</p>
<p>å½“ä¸€ä¸ªå¤„åœ¨ éƒ¨åˆ†æäº¤çš„ çŠ¶æ€çš„äº‹åŠ¡å°†ä¿®æ”¹è¿‡çš„æ•°æ®éƒ½ åŒæ­¥åˆ°ç£ç›˜ ä¸Šä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´è¯¥äº‹åŠ¡å¤„åœ¨äº† æäº¤çš„ çŠ¶æ€ã€‚ </p>
</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651305961834.png" alt="1651305961834" loading="lazy"></p>
<h3 id="ä½¿ç”¨äº‹åŠ¡"><a href="#ä½¿ç”¨äº‹åŠ¡" class="headerlink" title="ä½¿ç”¨äº‹åŠ¡"></a>ä½¿ç”¨äº‹åŠ¡</h3><p>äº‹åŠ¡åˆ†ä¸ºæ˜¾ç¤ºäº‹åŠ¡å’Œéšå¼äº‹åŠ¡</p>
<h4 id="1-æ˜¾ç¤ºäº‹åŠ¡"><a href="#1-æ˜¾ç¤ºäº‹åŠ¡" class="headerlink" title="1.æ˜¾ç¤ºäº‹åŠ¡"></a>1.æ˜¾ç¤ºäº‹åŠ¡</h4><p>æ­¥éª¤ä¸€ï¼šSTART TRANSACTION æˆ– BEGIN,ä½œç”¨æ˜¯æ˜¾ç¤ºå¼€å¯ä¸€ä¸ªäº‹åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; BEGIN;</span><br><span class="line">#æˆ–è€…</span><br><span class="line">mysql&gt; START TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>START TRANSACTION è¯­å¥ç›¸è¾ƒäº BEGIN ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œåè¾¹èƒ½è·Ÿéšå‡ ä¸ª ä¿®é¥°ç¬¦ ï¼š </p>
<ol>
<li>READ ONLY:æ ‡è¯†å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ªåªè¯»äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å±äºè¯¥äº‹åŠ¡çš„æ•°æ®åº“æ“ä½œåªèƒ½è¯»å–æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®</li>
<li>READ WRITEï¼šæ ‡è¯†å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ªè¯»å†™äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å±äºè¯¥äº‹åŠ¡çš„æ•°æ®åº“æ“ä½œæ—¢å¯ä»¥è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æ•°æ®ã€‚</li>
<li>WITH CONSISTENT SNAPSHOT ï¼šå¯åŠ¨ä¸€è‡´æ€§è¯»ã€‚</li>
</ol>
<p>æ­¥éª¤äºŒï¼šä¸€ç³»åˆ—äº‹åŠ¡ä¸­çš„æ“ä½œï¼ˆä¸»è¦æ˜¯DML,ä¸å«DDLï¼‰</p>
<p>æ­¥éª¤ä¸‰ï¼šæäº¤äº‹åŠ¡æˆ–ç»ˆæ­¢äº‹åŠ¡(å³å›æ»šäº‹åŠ¡)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æäº¤äº‹åŠ¡ã€‚å½“æäº¤äº‹åŠ¡åï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ã€‚ </span><br><span class="line">mysql&gt; COMMIT;</span><br><span class="line"></span><br><span class="line"># å›æ»šäº‹åŠ¡ã€‚å³æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æ²¡æœ‰æäº¤çš„ä¿®æ”¹ </span><br><span class="line">mysql&gt; ROLLBACK; </span><br><span class="line"># å°†äº‹åŠ¡å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ã€‚ </span><br><span class="line">mysql&gt; ROLLBACK TO [SAVEPOINT]</span><br></pre></td></tr></table></figure>

<h4 id="2-éšå¼äº‹åŠ¡"><a href="#2-éšå¼äº‹åŠ¡" class="headerlink" title="2.éšå¼äº‹åŠ¡"></a>2.éšå¼äº‹åŠ¡</h4><p>MySQLä¸­æœ‰ä¸€ä¸ªç³»ç»Ÿå˜é‡autocommitï¼š<img src="/2022/04/22/MySQL/1651306388108.png" alt="1651306388108" loading="lazy"></p>
<p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å…³é—­è¿™ç§ è‡ªåŠ¨æäº¤ çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹ä¸¤ç§æ–¹æ³•ä¹‹ä¸€ï¼š </p>
<ul>
<li><p>æ˜¾å¼çš„çš„ä½¿ç”¨ START TRANSACTION æˆ–è€… BEGIN è¯­å¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ ·åœ¨æœ¬æ¬¡äº‹åŠ¡æäº¤æˆ–è€…å›æ»šå‰ä¼šæš‚æ—¶å…³é—­æ‰è‡ªåŠ¨æäº¤çš„åŠŸèƒ½ã€‚ </p>
</li>
<li><p>æŠŠç³»ç»Ÿå˜é‡ autocommit çš„å€¼è®¾ç½®ä¸º OFF ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET autocommit = OFF; </span><br><span class="line">#æˆ–</span><br><span class="line">SET autocommit = 0;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-éšå¼æäº¤æ•°æ®çš„æƒ…å†µ"><a href="#3-éšå¼æäº¤æ•°æ®çš„æƒ…å†µ" class="headerlink" title="3.éšå¼æäº¤æ•°æ®çš„æƒ…å†µ"></a>3.éšå¼æäº¤æ•°æ®çš„æƒ…å†µ</h4><ul>
<li><p>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰</p>
</li>
<li><p>éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹mysqlæ•°æ®åº“ä¸­çš„è¡¨</p>
</li>
<li><p>äº‹åŠ¡æ§åˆ¶æˆ–å…³äºé”å®šçš„è¯­å¥</p>
<p>â‘  å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æˆ–è€…å›æ»šæ—¶å°±åˆä½¿ç”¨ START TRANSACTION æˆ–è€… BEGIN è¯­å¥å¼€å¯äº† </p>
<p>å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œä¼š éšå¼çš„æäº¤ ä¸Šä¸€ä¸ªäº‹åŠ¡ã€‚å³ï¼š </p>
<p>â‘¡ å½“å‰çš„ autocommit ç³»ç»Ÿå˜é‡çš„å€¼ä¸º OFF ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠå®ƒè°ƒä¸º ON æ—¶ï¼Œä¹Ÿä¼š éšå¼çš„æäº¤ å‰è¾¹è¯­ </p>
<p>å¥æ‰€å±çš„äº‹åŠ¡ã€‚ </p>
<p>â‘¢ ä½¿ç”¨ LOCK TABLES ã€ UNLOCK TABLES ç­‰å…³äºé”å®šçš„è¯­å¥ä¹Ÿä¼š éšå¼çš„æäº¤ å‰è¾¹è¯­å¥æ‰€å±çš„äº‹ </p>
<p>åŠ¡ã€‚</p>
</li>
<li><p>åŠ è½½æ•°æ®çš„è¯­å¥</p>
</li>
<li><p>å…³äºMySQLå¤åˆ¶çš„ä¸€äº›è¯­å¥</p>
</li>
<li><p>å…¶ä»–ä¸€äº›è¯­å¥</p>
</li>
</ul>
<blockquote>
<p>å½“æˆ‘ä»¬è®¾ç½® autocommit=0 æ—¶ï¼Œä¸è®ºæ˜¯å¦é‡‡ç”¨ START TRANSACTION æˆ–è€… BEGIN çš„æ–¹å¼æ¥å¼€å¯äº‹ åŠ¡ï¼Œéƒ½éœ€è¦ç”¨ COMMIT è¿›è¡Œæäº¤ï¼Œè®©äº‹åŠ¡ç”Ÿæ•ˆï¼Œä½¿ç”¨ ROLLBACK å¯¹äº‹åŠ¡è¿›è¡Œå›æ»šã€‚ </p>
<p>å½“æˆ‘ä»¬è®¾ç½® autocommit=1 æ—¶ï¼Œæ¯æ¡ SQL è¯­å¥éƒ½ä¼šè‡ªåŠ¨è¿›è¡Œæäº¤ã€‚ ä¸è¿‡è¿™æ—¶ï¼Œå¦‚æœä½ é‡‡ç”¨ START TRANSACTION æˆ–è€… BEGIN çš„æ–¹å¼æ¥æ˜¾å¼åœ°å¼€å¯äº‹åŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡åªæœ‰åœ¨ COMMIT æ—¶æ‰ä¼šç”Ÿæ•ˆï¼Œåœ¨ ROLLBACK æ—¶æ‰ä¼šå›æ»šã€‚</p>
</blockquote>
<h3 id="äº‹ç‰©çš„éš”ç¦»çº§åˆ«"><a href="#äº‹ç‰©çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹ç‰©çš„éš”ç¦»çº§åˆ«"></a>äº‹ç‰©çš„éš”ç¦»çº§åˆ«</h3><h4 id="å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"><a href="#å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"></a>å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h4><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹ç‰©çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆå¤šå¹¶å‘ä¸€è‡´æ€§é—®é¢˜</p>
<p><strong>ä¸¢å¤±ä¿®æ”¹</strong></p>
<p>ä¸¢å¤±ä¿®æ”¹æ˜¯æŒ‡ä¸€ä¸ªäº‹ç‰©çš„æ›´æ–°æ“ä½œè¢«å¦ä¸€ä¸ªäº‹ç‰©æ›´æ–°æ“ä½œæ›¿æ¢ã€‚ä¾‹å¦‚ï¼šT1å’ŒT2ä¸¤ä¸ªäº‹ç‰©å¯¹ä¸€ä¸ªæ•°æ®ä¿®æ”¹ï¼ŒT1å…ˆä¿®æ”¹å¹¶æäº¤ç”Ÿæ•ˆï¼ŒT2éšåä¿®æ”¹ï¼ŒT2çš„ä¿®æ”¹è¦†ç›–äº†T1çš„ä¿®æ”¹ <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313734343234342e706e67.png" alt="img" loading="lazy"> </p>
<p><strong>è¯»è„æ•°æ®</strong></p>
<p>è¯»è„æ•°æ®æŒ‡åœ¨ä¸åŒäº‹ç‰©ä¸‹ï¼Œå½“å‰äº‹ç‰©è¯»å–åˆ°äº†å¦å¤–äº‹ç‰©æœªæäº¤çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼šT1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ä½†æœªæäº¤ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚  <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313932303336382e706e67.png" alt="img" loading="lazy"> </p>
<p><strong>ä¸å¯é‡å¤è¯»</strong></p>
<p>ä¸å¯é‡å¤åº¦æŒ‡ä¸€ä¸ªäº‹ç‰©å†…å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®é›†åˆï¼Œåœ¨è¿™ä¸€äº‹ç‰©è¿˜æœªç»“æŸå‰ï¼Œå¦ä¸€äº‹ç‰©ä¹Ÿè®¿é—®äº†åŒä¸€æ•°æ®é›†åˆå¹¶åšäº†ä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´ç¬¬ä¸€ä¸ªäº‹ç‰©ä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®ç»“æœä¸ä¸€è‡´ã€‚ä¾‹å¦‚ ï¼šT2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚  <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323130323031302e706e67.png" alt="img" loading="lazy"> </p>
<p><strong>å¹»å½±è¯»</strong></p>
<blockquote>
<p>æŸæ¬¡selectçš„ç»“æœä¸è¶³ä»¥æ”¯æ’‘åç»­ä¸šåŠ¡æ“ä½œ</p>
</blockquote>
<p>å¹»è¯»æœ¬è´¨ä¸Šä¹Ÿå±äºä¸å¯é‡å¤è¯»ï¼Œ T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚  <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232323133343330362e706e67.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åŒºåˆ«</p>
</blockquote>
<p>ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹ æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›åˆ—çš„å€¼è¢«ä¿®æ”¹ ï¼Œè€Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–åˆ é™¤ æ¯”å¦‚å¤šæ¬¡æŸ¥è¯¢åŒä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼ˆDQLï¼‰æ—¶ï¼Œè®°å½•å‘ç°è®°å½•å¢å¤šæˆ–å‡å°‘äº†ã€‚ </p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹ä¸€ï¼šäº‹ç‰©1ä¸­Aè¯»å–è‡ªå·±çš„å·¥èµ„1000çš„æ“ä½œè¿˜æ²¡å®Œæˆï¼Œäº‹ç‰©2çš„Bå°±ä¿®æ”¹äº†Açš„å·¥èµ„ä¸º2000ï¼Œå¯¼è‡´Aå†æ¬¡è¯»å–è‡ªå·±çš„å·¥èµ„å˜ä¸º2000ï¼›è¿™å°±æ˜¯ä¸å¯é‡å¤åº¦</span></span><br><span class="line"><span class="comment">//ä¾‹äºŒï¼šæŸå·¥èµ„å•è¡¨ä¸­è–ªèµ„å¤§äº3000çš„æœ‰4äººï¼Œäº‹ç‰©1è¯»å–äº†æ‰€æœ‰å·¥èµ„å¤§äº3000çš„äººæŸ¥åˆ°å››æ¡è®°å½•ï¼Œè¿™æ—¶äº‹ç‰©2æ’å…¥äº†ä¸€æ¡å¤§äº3000çš„è®°å½•ï¼Œäº‹ç‰©1å†æ¬¡è¯»å–å‘ç°å˜ä¸ºäº†5æ¡ï¼Œè¿™å°±æ˜¯å¹»è¯»</span></span><br></pre></td></tr></table></figure>



<hr>
<p>äº§ç”Ÿå¹¶å‘ä¸€è‡´æ€§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ç ´åäº†äº‹ç‰©çš„éš”ç¦»çº§åˆ«ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æ¥ä¿è¯éš”ç¦»æ€§ã€‚å¹¶å‘æ§åˆ¶é€šè¿‡å°é”æ¥å®ç°ï¼Œä½†å°é”æ“ä½œéœ€è¦ç”¨æˆ·æ“ä½œï¼Œæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†äº‹ç‰©çš„éš”ç¦»æ€§çº§åˆ«ï¼Œä»¥è½»æ¾æ–¹å¼å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</p>
<h4 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h4><ul>
<li><strong>æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTED</strong>ï¼‰</li>
</ul>
<p>äº‹ç‰©ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤å¯¹å…¶ä»–äº‹ç‰©ä¹Ÿæ˜¯å¯è§ã€‚å¯èƒ½ä¼šå‘ç”Ÿè„è¯»ã€å¹»è¯»ï¼Œä¸å¯é‡å¤åº¦</p>
<ul>
<li><strong>æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰</strong></li>
</ul>
<p>ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹ç‰©æ‰€ä½œçš„ä¿®æ”¹ï¼Œè§£å†³è„è¯»ï¼Œä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»</p>
<ul>
<li><strong>å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰</strong></li>
</ul>
<p>ä¿è¯åœ¨ä¸€ä¸ªäº‹ç‰©ä¸­å¤šæ¬¡è¯»å–ç»Ÿä¸€æ•°æ®çš„ç»“æœä¸€æ ·ï¼Œè§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä¼šå‘ç”Ÿå¹»è¯»</p>
<ul>
<li><strong>å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰</strong></li>
</ul>
<p>å¼ºåˆ¶äº‹ç‰©ä¸²è¡Œæ‰§è¡Œï¼Œå¤šä¸ªäº‹ç‰©äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šå‡ºç°å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>è¯¥éš”ç¦»çº§åˆ«éœ€è¦åŠ é”å®ç°ï¼Œå› ä¸ºè¦ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªäº‹ç‰©æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä¿è¯äº‹ç‰©ä¸²è¡Œæ‰§è¡Œã€‚è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td>READ-UNCOMMITTED</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>READ-COMMITTED</td>
<td>Ã—</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>REPEATABLE-READ</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
</tbody></table>
<h4 id="MySQLé»˜è®¤éš”ç¦»çº§åˆ«"><a href="#MySQLé»˜è®¤éš”ç¦»çº§åˆ«" class="headerlink" title="MySQLé»˜è®¤éš”ç¦»çº§åˆ«"></a>MySQLé»˜è®¤éš”ç¦»çº§åˆ«</h4><p>MySQL8.0é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»</p>
<hr>
<p>MySQLçš„InnoDBçš„å¯é‡å¤è¯»ï¼ŒåŠ ä¸ŠåŠ é”è¯»æ¥ä¿è¯é¿å…å¹»è¯»ã€‚è€Œè¿™ä¸ªåŠ é”è¯»çš„æœºåˆ¶æ˜¯<strong>Next-Key Locks</strong></p>
<h4 id="è®¾ç½®éš”ç¦»çº§åˆ«"><a href="#è®¾ç½®éš”ç¦»çº§åˆ«" class="headerlink" title="è®¾ç½®éš”ç¦»çº§åˆ«"></a>è®¾ç½®éš”ç¦»çº§åˆ«</h4><p><strong>é€šè¿‡ä¸€ä¸‹è¯­å¥ä¿®æ”¹äº‹ç‰©çš„éš”ç¦»çº§åˆ«</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SET [GLOBAL|SESSION] TRANSACTION IOSLATION LEVEL éš”ç¦»çº§åˆ«;</span><br><span class="line">å…¶ä¸­éš”ç¦»çº§åˆ«ï¼š</span><br><span class="line">    READ UNCOMMITTED</span><br><span class="line">    READ COMMITTED</span><br><span class="line">    REPEATABLE READ</span><br><span class="line">    SERIALIZABLE</span><br><span class="line">æˆ–è€…</span><br><span class="line">SET [GLOBAL|SESSION] TRANSACTION_ISOLATION=<span class="string">&#x27;éš”ç¦»çº§åˆ«&#x27;</span></span><br><span class="line">å…¶ä¸­éš”ç¦»çº§åˆ«ï¼š</span><br><span class="line">    READ-UNCOMMITTED</span><br><span class="line">    READ-COMMITTED</span><br><span class="line">    REPETABLE-READ</span><br><span class="line">    SERIALIZABLE</span><br></pre></td></tr></table></figure>

<p>å…³äºè®¾ç½®æ—¶ä½¿ç”¨GLOBALæˆ–SESSIONçš„å½±å“ï¼š</p>
<ul>
<li><p>ä½¿ç”¨GLOBALå…³é”®å­—ï¼ˆå…¨å±€èŒƒå›´ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"># æˆ–è€…</span><br><span class="line">SET GLOBAL TRANSACTION_ISOLATION=<span class="string">&#x27;SERIALIZABLE&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>åˆ™ï¼š</p>
<ul>
<li>å½“å‰å·²ç»å­˜åœ¨çš„ä¼šè¯æ— æ•ˆ</li>
<li>åªå¯¹æ‰§è¡Œå®Œè¯¥è¯­å¥ä¹‹åäº§ç”Ÿçš„ä¼šè¯èµ·ä½œç”¨</li>
</ul>
</li>
<li><p>ä½¿ç”¨SESSIONå…³é”®å­—ï¼ˆåœ¨ä¼šè¯èŒƒå›´å½±å“ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET SESSION TRANSCATION IOSLATION LEVEL SERIALIZABLE;</span><br><span class="line">#æˆ–è€…</span><br><span class="line">SET SESSION TRANSACTION_ISOLATION=<span class="string">&#x27;SERIALIZABLE&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ™ï¼š</p>
<ul>
<li>å¯¹å½“å‰ä¼šè¯çš„æ‰€æœ‰åç»­çš„äº‹ç‰©æœ‰æ•ˆ</li>
<li>å¦‚æœåœ¨äº‹ç‰©ä¹‹é—´æ‰§è¡Œï¼Œåˆ™å¯¹åç»­çš„äº‹ç‰©æœ‰æ•ˆ</li>
<li>è¯¥è¯­å¥å¯ä»¥åœ¨å·²ç»å¼€å¯çš„äº‹ç‰©ä¸­é—´æ‰§è¡Œï¼Œä½†ä¸ä¼šå½±å“å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹ç‰©</li>
</ul>
</li>
</ul>
<blockquote>
<p>å°ç»“ï¼šæ•°æ®åº“è§„å®šäº†å¤šç§äº‹ç‰©éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§è¶Šå¥½ï¼Œå¹¶å‘åº¦è¶Šä½</p>
</blockquote>
<h4 id="å®é™…æƒ…å†µæ¼”ç¤º"><a href="#å®é™…æƒ…å†µæ¼”ç¤º" class="headerlink" title="å®é™…æƒ…å†µæ¼”ç¤º"></a>å®é™…æƒ…å†µæ¼”ç¤º</h4><blockquote>
<p>ä½¿ç”¨2ä¸ªå‘½ä»¤è¡Œï¼Œæ¨¡æ‹Ÿå¤šçº¿ç¨‹(å¤šäº‹ç‰©)å¯¹åŒä¸€ä»½æ•°æ®çš„è„è¯»</p>
</blockquote>
<p>MySQL å‘½ä»¤è¡Œçš„é»˜è®¤é…ç½®ä¸­äº‹åŠ¡éƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œå³æ‰§è¡Œ SQL è¯­å¥åå°±ä¼šé©¬ä¸Šæ‰§è¡Œ COMMIT æ“ä½œã€‚å¦‚æœè¦æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä½¿ç”¨å‘½ä»¤ï¼š<code>START TRANSACTION</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®éš”ç¦»çº§åˆ«ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE]</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨ä¸‹é¢å®é™…æ“ä½œä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›å¹¶å‘æ§åˆ¶è¯­å¥:</p>
<ul>
<li><code>START TRANSACTION</code> |<code>BEGIN</code>ï¼šæ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</li>
<li><code>COMMIT</code>ï¼šæäº¤äº‹åŠ¡ï¼Œä½¿å¾—å¯¹æ•°æ®åº“åšçš„æ‰€æœ‰ä¿®æ”¹æˆä¸ºæ°¸ä¹…æ€§ã€‚</li>
<li><code>ROLLBACK</code>ï¼šå›æ»šä¼šç»“æŸç”¨æˆ·çš„äº‹åŠ¡ï¼Œå¹¶æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ã€‚</li>
</ul>
<p><strong>è„è¯»ï¼ˆè¯»æœªæäº¤ï¼‰</strong><img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-31-1%E8%84%8F%E8%AF%BB(%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4)%E5%AE%9E%E4%BE%8B.jpg" alt="img" loading="lazy"> </p>
<p><strong>é¿å…è„è¯»ï¼ˆè¯»å·²æäº¤ï¼‰</strong><img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-31-2%E8%AF%BB%E5%B7%B2%E6%8F%90%E4%BA%A4%E5%AE%9E%E4%BE%8B.jpg" alt="img" loading="lazy"> </p>
<p><strong>ä¸å¯é‡å¤è¯»</strong><img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-32-1%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%AE%9E%E4%BE%8B.jpg" alt="img" loading="lazy"> </p>
<p><strong>å¯é‡å¤è¯»</strong> <img src="https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-33-2%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB.jpg" alt="img" loading="lazy"> </p>
<p><strong>å¹»è¯»</strong> <img src="/2022/04/22/MySQL/phantom_read.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>è§£å†³å¹»è¯»æ–¹æ³•</p>
</blockquote>
<p>è§£å†³å¹»è¯»æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸€ä¸ªäº‹ç‰©åœ¨æ“ä½œè¿™å¼ è¡¨æ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹ç‰©ä¸å…è®¸æ–°å¢æˆ–åˆ é™¤è¿™å¼ è¡¨çš„æ•°æ®ï¼Œè§£å†³å¹»è¯»æ–¹å¼ï¼š<br>1.å°†äº‹ç‰©éš”ç¦»çº§åˆ«è°ƒæ•´ä¸ºSERIALIZABLE</p>
<p>2.åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œç»™äº‹ç‰©æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ è¡¨é”</p>
<p>3.åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œç»™äº‹ç‰©æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ Next-key Locks</p>
<blockquote>
<p>è¯´æ˜ï¼šNext-key Locks ç›¸å½“äºè¡Œé”+é—´æ­‡é”</p>
</blockquote>
<h3 id="äº‹åŠ¡çš„å¸¸è§åˆ†ç±»"><a href="#äº‹åŠ¡çš„å¸¸è§åˆ†ç±»" class="headerlink" title="äº‹åŠ¡çš„å¸¸è§åˆ†ç±»"></a>äº‹åŠ¡çš„å¸¸è§åˆ†ç±»</h3><p>ä»äº‹åŠ¡ç†è®ºè§’åº¦ï¼š</p>
<ul>
<li>æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactionsï¼‰ </li>
<li>å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactions with Savepointsï¼‰ </li>
<li>é“¾äº‹åŠ¡ï¼ˆChained Transactionsï¼‰ </li>
<li>åµŒå¥—äº‹åŠ¡ï¼ˆNested Transactionsï¼‰ </li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDistributed Transactionsï¼‰</li>
</ul>
<h3 id="MySQLäº‹åŠ¡æ—¥å¿—"><a href="#MySQLäº‹åŠ¡æ—¥å¿—" class="headerlink" title="MySQLäº‹åŠ¡æ—¥å¿—"></a>MySQLäº‹åŠ¡æ—¥å¿—</h3><p>äº‹ç‰©æœ‰å››ç§ç‰¹æ€§:åŸå­æ€§ã€éš”ç¦»æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…æ€§</p>
<ul>
<li>äº‹ç‰©çš„éš”ç¦»æ€§æ˜¯ç”±é”æœºåˆ¶å®ç°çš„</li>
<li>è€Œäº‹ç‰©çš„åŸå­æ€§ã€ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ç”±äº‹ç‰©çš„redoæ—¥å¿—å’Œundoæ—¥å¿—æ¥ä¿è¯<ul>
<li>REDO LOGæˆä¸ºé‡åšæ—¥å¿—ï¼Œæä¾›å†å†™å…¥æ“ä½œï¼Œæ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…è¡Œ</li>
<li>UNDO LOGæ—¥å¿—ç§°ä¸ºå›æ»šæ—¥å¿—ï¼Œå›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œç”¨æ¥ä¿è¯åŸå­æ€§ã€ä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
</ul>
<p>ä¸¤ç§æ—¥å¿—éƒ½å¯ä»¥è§†ä¸ºæ¢å¤æ“ä½œï¼Œä½†æ˜¯ï¼š</p>
<ul>
<li>redo logï¼šæ˜¯å­˜å‚¨å¼•æ“ï¼ˆinnodbï¼‰ç”Ÿæˆçš„æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯<strong>ç‰©ç†çº§åˆ«</strong>çš„æ—¥å¿—ï¼Œæ¯”å¦‚é¡µå·xxxã€åç§»é‡yyyå†™å…¥äº†zzzæ•°æ®ï¼Œä¸»è¦ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§</li>
<li>undo logï¼šæ˜¯å­˜å‚¨å¼•æ“ï¼ˆinnodbï¼‰ç”Ÿæˆçš„æ—¥å¿—è®°å½•çš„æ˜¯é€»è¾‘æ“ä½œæ—¥å¿—ï¼Œæ¯”å¦‚å¯¹æŸä¸€è¡Œæ•°æ®insertæ“ä½œï¼Œé‚£ä¹ˆundo logå°±è®°å½•ä¸€æ¡ä¸ä¹‹ç›¸ådeleteæ“ä½œã€‚ä¸»è¦ç”¨äºäº‹åŠ¡çš„å›æ»šå’Œä¸€è‡´æ€§éé”å®šè¯»ï¼ˆundo logå›æ»šè¡Œè®°å½•åˆ°æŸç§ç‰¹å®šç‰ˆæœ¬â€“MVCCï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</li>
</ul>
<h4 id="1-redoæ—¥å¿—"><a href="#1-redoæ—¥å¿—" class="headerlink" title="1.redoæ—¥å¿—"></a>1.redoæ—¥å¿—</h4><p>InnoDBå­˜å‚¨å¼•æ“æ˜¯ä»¥<strong>é¡µä¸ºå•ä½</strong>æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œåœ¨çœŸæ­£è®¿é—®é¡µé¢ä¹‹å‰ï¼Œéœ€è¦æŠŠ<strong>ç£ç›˜ä¸Šçš„</strong>é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„Buffer Poolä¹‹åæ‰å¯ä»¥è®¿é—®ã€‚æ‰€æœ‰çš„å˜æ›´éƒ½å¿…é¡»<strong>å…ˆæ›´æ–°ç¼“å†²æ± ä¸­çš„æ•°æ®</strong>ï¼Œç„¶åç¼“å†²æ± ä¸­çš„è„é¡µä¼šä»¥<strong>ä¸€å®šçš„é¢‘ç‡</strong>è¢«åˆ·å…¥ç£ç›˜ï¼ˆcheckPointæœºåˆ¶ï¼‰ï¼Œé€šè¿‡ç¼“å†²æ± æ¥ä¼˜åŒ–CPUå’Œç£ç›˜ä¹‹é—´çš„é¸¿æ²Ÿï¼Œè¿™æ ·æ¥ä¿è¯æ•´ä½“æ€§èƒ½ä¸‹é™å¤ªå¿«ã€‚</p>
<h5 id="1-1ä¸ºä»€ä¹ˆéœ€è¦redo-log"><a href="#1-1ä¸ºä»€ä¹ˆéœ€è¦redo-log" class="headerlink" title="1.1ä¸ºä»€ä¹ˆéœ€è¦redo log"></a>1.1ä¸ºä»€ä¹ˆéœ€è¦redo log</h5><p><strong>ä¸€æ–¹é¢ï¼Œ</strong>ç¼“å†²æ± çš„å­˜åœ¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤CPUå’Œç£ç›˜é—´çš„é¸¿æ²Ÿï¼Œcheckpointæœºåˆ¶å¯ä»¥ä¿è¯æ•°æ®çš„æœ€ç»ˆè½ç‚¹ï¼Œç„¶è€Œç”±äºcheckpointå¹¶ä¸æ˜¯æ¯æ¬¡æ•°æ®å˜æ›´éƒ½è§¦å‘ï¼Œè€Œæ˜¯ä»¥ä¸€å®šé¢‘ç‡å»å¤„ç†ã€‚æ‰€ä»¥æœ€åæƒ…å†µå°±æ˜¯äº‹åŠ¡æäº¤åï¼Œåˆšå†™å®Œç¼“å†²æ± ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™æ®µæ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p>
<p><strong>å¦ä¸€æ–¹é¢ï¼Œ</strong>äº‹åŠ¡åŒ…å«æŒä¹…æ€§ç‰¹æ€§ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå·²æäº¤çš„äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹åº”è¯¥æ˜¯æ°¸ä¹…çš„ï¼Œå³ä½¿å‘ç”Ÿå®•æœºæ‰€ä½œçš„æ›´æ”¹ä¹Ÿä¸åº”è¯¥ä¸¢å¤±ã€‚</p>
<hr>
<p>é‚£ä¹ˆï¼Œåº”è¯¥å¦‚ä½•ä¿æŒè¿™ä¸ªæŒä¹…æ€§å‘¢ï¼Ÿ<strong>ä¸€ä¸ªç®€å•çš„åšæ³•</strong>ï¼šåœ¨äº‹åŠ¡æäº¤å®Œæˆä¹‹å‰æŠŠè¯¥äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹çš„æ‰€æœ‰é¡µé¢åˆ·æ–°åˆ°ç£ç›˜ï¼Œä½†è¿™ä¸ªåšæ³•æœ‰äº›é—®é¢˜ï¼š</p>
<ul>
<li><p><strong>ä¿®æ”¹é‡ä¸åˆ·æ–°ç£ç›˜å·¥ä½œé‡ä¸¥é‡ä¸æˆæ¯”ä¾‹</strong></p>
<p>æœ‰æ—¶å€™æˆ‘ä»¬ä»…ä»…ä¿®æ”¹äº†æŸä¸ªæ•°æ®é¡µçš„ä¸€ä¸ªå­—èŠ‚ï¼Œä½†åœ¨InnoDBä¸­æ˜¯ä»¥é¡µä¸ºå•ä½æ¥è¿›è¡Œç£ç›˜IOçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨æäº¤äº‹åŠ¡æ—¶ä¸å¾—ä¸å°†ä¸€æ•´ä¸ªæ•°æ®é¡µä»å†…å­˜ä¸­åˆ·æ–°åˆ°ç£ç›˜ï¼Œè€Œä¸€ä¸ªæ•°æ®é¡µæœ‰16KBå¤§å°ï¼Œåªä¿®æ”¹ä¸€ä¸ªå­—èŠ‚å°±è¦åˆ·æ–°16KBæ•°æ®åˆ°ç£ç›˜æ˜¾å¾—å°é¢˜å¤§åš</p>
</li>
<li><p><strong>éšæœºIOåˆ·æ–°è¾ƒæ…¢</strong></p>
<p>ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«å¾ˆå¤šè¯­å¥ï¼Œå³ä½¿ä¸€æ¡è¯­å¥ä¹Ÿå¯èƒ½ä¿®æ”¹å¾ˆå¤šé¡µé¢ï¼Œå¦‚æœäº‹åŠ¡ä¿®æ”¹çš„é¡µé¢å¹¶ä¸ç›¸é‚»ï¼Œè¿™æ„å‘³ç€åœ¨å°†äº‹åŠ¡ä¿®æ”¹çš„Bufer Poolä¸­çš„é¡µé¢åˆ·æ–°åˆ°ç£ç›˜æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šéšæœºIOï¼Œè€ŒéšæœºIOè¦æ¯”é¡ºåºIOæ…¢å¾ˆå¤š</p>
</li>
</ul>
<p><strong>å¦ä¸€ä¸ªè§£å†³æ€è·¯</strong>ï¼šæˆ‘ä»¬åªæ˜¯æƒ³è®©äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹å¯¹æ•°æ®åº“æ•°æ®æ°¸ä¹…ç”Ÿæ•ˆï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œåœ¨é‡å¯åä¹Ÿèƒ½æ¢å¤è¿‡æ¥ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å†æ¯æ¬¡äº‹åŠ¡æäº¤åï¼Œå°†äº‹åŠ¡æ‰€ä½œçš„å†å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼Œè€Œæ˜¯<strong>åªéœ€è¦å°†æ‰€ä½œçš„ä¿®æ”¹è®°å½•ä¸‹æ¥å³å¯</strong>ï¼Œæ¯”å¦‚æŸä¸ªäº‹åŠ¡å°†ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ç¬¬10å·é¡µé¢ä¸­çš„åç§»é‡ä¸º100çš„å“ªä¸ªå­—èŠ‚çš„å€¼1ä¿®æ”¹ä¸º2ï¼Œæˆ‘ä»¬ç§©åªéœ€è®°å½•ä¸€ä¸‹ï¼šå°†ç¬¬10å·è¡¨ç©ºé—´çš„åç§»é‡100çš„å€¼ä¿®æ”¹ä¸º2å³å¯ã€‚</p>
<p>InnooDBå¼•æ“çš„äº‹åŠ¡é‡‡ç”¨äº†WALæŠ€æœ¯ï¼ˆWrite-Ahead Logingï¼‰ï¼Œè¿™ç§æŠ€æœ¯çš„æ€æƒ³å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ï¼Œåªæœ‰æ—¥å¿—å†™æˆåŠŸï¼Œæ‰ç®—äº‹åŠ¡æäº¤æˆåŠŸï¼Œè¿™é‡Œçš„æ—¥å¿—å°±æ˜¯redo logï¼Œå½“ç³»ç»Ÿå‘ç”Ÿå®•æœºä¸”æ•°æ®æœªåˆ·åˆ°ç£ç›˜çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡redo logæ¥æ¢å¤ï¼Œä¿è¯ACIDçš„Dï¼Œè¿™å°±æ˜¯redo logçš„ä½œç”¨ã€‚<img src="/2022/04/22/MySQL/1650873846555.png" alt="1650873846555" loading="lazy"></p>
<h5 id="1-2redo-logçš„å¥½å¤„ã€ç‰¹ç‚¹"><a href="#1-2redo-logçš„å¥½å¤„ã€ç‰¹ç‚¹" class="headerlink" title="1.2redo logçš„å¥½å¤„ã€ç‰¹ç‚¹"></a>1.2redo logçš„å¥½å¤„ã€ç‰¹ç‚¹</h5><p>1.å¥½å¤„</p>
<ul>
<li>redoæ—¥å¿—é™ä½äº†åˆ·ç›˜æ•ˆç‡</li>
<li>redoæ—¥å¿—å ç”¨çš„ç©ºé—´éå¸¸å°</li>
</ul>
<p>å­˜å‚¨è¡¨ç©ºé—´IDã€ä¹Ÿå¥½ã€åç§»é‡ä»¥åŠéœ€è¦æ›´æ–°çš„å€¼ï¼Œæ‰€éœ€çš„å­˜å‚¨ç©ºé—´æ˜¯å¾ˆå°çš„ï¼Œåˆ·ç›˜å—</p>
<p>2.ç‰¹ç‚¹</p>
<ul>
<li><p>redoæ—¥å¿—æ˜¯é¡ºåºå†™å…¥ç£ç›˜çš„</p>
<p>åœ¨æ‰§è¡Œäº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œå°±å¯èƒ½äº§ç”Ÿè‹¥å¹²æ¡redoæ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—æ˜¯æŒ‰ç…§äº§ç”Ÿçš„é¡ºåºå†™å…¥ç£ç›˜çš„</p>
</li>
<li><p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ç”±redo logä¸æ–­è®°å½•</p>
<p>redo logæ›´bing logçš„åŒºåˆ«redo logæ˜¯å­˜å‚¨å¼•æ“å±‚äº§ç”Ÿçš„ï¼Œè€Œbing logæ˜¯æ•°æ®åº“å±‚äº§ç”Ÿçš„ã€‚å‡è®¾ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯¹è¡¨åš10ä¸‡è¡Œçš„è®°å½•æ’å…¥ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€ç›´ä¸æ–­çš„å¾€redo logé‡Œé¡ºåºè®°å½•ï¼Œæˆ‘ã€è€Œbin log ä¸ä¼šè®°å½•ï¼Œç›´åˆ°äº‹åŠ¡æäº¤ï¼Œæ‰ä¼šä¸€æ¬¡å†™å…¥åˆ°bin logæ–‡ä»¶ä¸­ã€‚</p>
</li>
</ul>
<h5 id="1-3redoçš„ç»„æˆ"><a href="#1-3redoçš„ç»„æˆ" class="headerlink" title="1.3redoçš„ç»„æˆ"></a>1.3redoçš„ç»„æˆ</h5><p>redo logå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>é‡åšæ—¥å¿—çš„ç¼“å†²ï¼ˆredo log bufferï¼‰ï¼Œä¿å­˜åœ¨å†…å­˜ï¼Œæ˜“ä¸¢å¤±</p>
<p>åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€å¤§ç‰‡ç§°ä¹‹ä¸ºredo log bufferçš„è¿ç»­å†…å­˜ç©ºé—´ï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯redoæ—¥å¿—ç¼“å†²åŒºã€‚è¿™ç‰‡å†…å­˜ç©ºé—´è¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªè¿ç»­çš„redo log blockã€‚ä¸€ä¸ªredo log blockå ç”¨512å­—èŠ‚å¤§å°<img src="/2022/04/22/MySQL/1650875129562.png" alt="1650875129562" loading="lazy"></p>
<p>å‚æ•°è®¾ç½®ï¼šinnodb_log_buffer_size;</p>
<p>redo log bufferå¤§å°ï¼Œé»˜è®¤16Mï¼Œæœ€å¤§å€¼4096Mï¼Œæœ€å°å€¼1M<img src="/2022/04/22/MySQL/1650875207176.png" alt="1650875207176" loading="lazy"></p>
</li>
<li><p>é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo log fileï¼‰ï¼Œä¿å­˜åœ¨ç¡¬ç›˜ä¸­ï¼ŒæŒä¹…çš„</p>
</li>
</ul>
<h5 id="1-4redoçš„æ•´ä½“æµç¨‹"><a href="#1-4redoçš„æ•´ä½“æµç¨‹" class="headerlink" title="1.4redoçš„æ•´ä½“æµç¨‹"></a>1.4redoçš„æ•´ä½“æµç¨‹</h5><p>ä»¥ä¸€ä¸ªæ›´æ–°äº‹åŠ¡ä¸ºä¾‹ï¼Œredo logæµä¼ è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1650897393027.png" alt="1650897393027" loading="lazy"></p>
<ol>
<li>å…ˆå°†åŸå§‹æ•°æ®ä»ç£ç›˜è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œä¿®æ”¹æ•°æ®çš„å†…å­˜æ‹·è´</li>
<li>ç”Ÿæˆä¸€æ¡é‡åšæ—¥å¿—å¹¶å†™å…¥redo log bufferï¼Œè®°å½•çš„æ˜¯æ•°æ®è¢«ä¿®æ”¹åçš„å€¼</li>
<li>å½“äº‹åŠ¡commitæ—¶ï¼Œå°†redo log bufferä¸­çš„å†…å®¹åˆ·æ–°åˆ°redo log fileä¸­ï¼Œå¯¹redo log fileé‡‡ç”¨è¿½åŠ å†™æ–¹å¼</li>
<li>å®šæœŸå°†å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜</li>
</ol>
<blockquote>
<p>Write-Ahead Log(é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–)ï¼Œåœ¨æŒä¹…åŒ–ä¸€ä¸ªæ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†å†…å­˜ä¸­ç›¸åº”çš„æ—¥å¿—é¡µæŒä¹…åŒ–</p>
</blockquote>
<h5 id="1-5redo-logåˆ·ç›˜ç­–ç•¥-redo-log-buffer-gt-redo-log-file"><a href="#1-5redo-logåˆ·ç›˜ç­–ç•¥-redo-log-buffer-gt-redo-log-file" class="headerlink" title="1.5redo logåˆ·ç›˜ç­–ç•¥(redo log buffer -&gt; redo log file)"></a>1.5redo logåˆ·ç›˜ç­–ç•¥(redo log buffer -&gt; redo log file)</h5><p>redo logçš„å†™å…¥å¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼ŒInnoDBå¼•æ“ä¼šåœ¨å†™redo logçš„æ—¶å€™å…ˆå†™redo log bufferï¼Œä¹‹åä»¥ä¸€å®šé¢‘ç‡åˆ·å…¥åˆ°çœŸæ­£çš„redo log fileä¸­ã€‚è¿™é‡Œçš„<strong>é¢‘ç‡å°±æ˜¯è¦è¯´çš„åˆ·ç›˜ç­–ç•¥</strong><img src="/2022/04/22/MySQL/1650898012282.png" alt="1650898012282" loading="lazy"></p>
<p>ç†æƒ³æƒ…å†µï¼Œäº‹åŠ¡ä¸€æäº¤å°±ä¼šè¿›è¡Œåˆ·ç›˜æ“ä½œï¼Œä½†å®é™…ä¸Šï¼Œåˆ·ç›˜æ—¶æœºæ˜¯æ ¹æ®ç­–ç•¥è¿›è¡Œçš„ã€‚</p>
<blockquote>
<p>æ¯æ¡redoè®°å½•ç”±â€œè¡¨ç©ºé—´å·+æ•°æ®é¡µå·+åç§»é‡+ä¿®æ”¹æ•°æ®é•¿åº¦+å…·ä½“ä¿®æ”¹çš„æ•°æ®â€ç»„æˆ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„ï¼šredo log bufferåˆ·ç›˜åˆ°redo log fileçš„è¿‡ç¨‹å¹¶ä¸æ˜¯çœŸæ­£çš„åˆ·åˆ°ç£ç›˜ï¼Œåªæ˜¯åˆ·å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜(page cache)ä¸­(ç°ä»£ç³»ç»Ÿä¸ºäº†æé«˜æ–‡ä»¶å†™å…¥æ•ˆç‡åšçš„ä¸€ä¸ªä¼˜åŒ–)ï¼ŒçœŸæ­£çš„å†™å…¥ä¼šäº¤ç»™ç³»ç»Ÿè‡ªå·±å†³å®š(æ¯”å¦‚page cacheè¶³å¤Ÿå¤§äº†)ã€‚å¯¹äºInnoDBæ¥è¯´å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœäº¤ç»™ç³»ç»Ÿæ¥åŒæ­¥ï¼ŒåŒæ ·å¦‚æœç³»ç»Ÿå®•æœºï¼Œé‚£ä¹ˆæ•°æ®ä¹Ÿä¸¢å¤±äº†(è™½ç„¶æ•´ä¸ªç³»ç»Ÿå®•æœºçš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå°)</span></span><br></pre></td></tr></table></figure>

<p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒInnoDBç»™å‡ºinnodb_flush_logå‚æ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶commitæäº¤äº‹åŠ¡æ—¶ï¼Œå¦‚ä½•å°†redo log buferä¸­çš„æ—¥å¿—åˆ·æ–°åˆ°redo log fileä¸­ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p>
<ul>
<li>è®¾ç½®0ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œ(ç³»ç»Ÿé»˜è®¤master threadæ¯ä¸ª1sè¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„åŒæ­¥)</li>
<li>è®¾ç½®1ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡ŒåŒæ­¥ï¼Œåˆ·ç›˜æ“ä½œ(é»˜è®¤å€¼)</li>
<li>è®¾ç½®2ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠredo log bufferå†…å®¹å†™å…¥ page cacheï¼Œä¸è¿›è¡ŒåŒæ­¥ã€‚ç”±osè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶</li>
</ul>
<p><img src="/2022/04/22/MySQL/1650900198762.png" alt="1650900198762" loading="lazy"></p>
<p>å¦å¤–ï¼ŒInnoDBå­˜å‚¨å¼•æ“ç”±ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”1sï¼Œå°±ä¼šæŠŠredo log bufferä¸­çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜(page cache)ï¼Œç„¶åè°ƒç”¨åˆ·ç›˜æ“ä½œã€‚<img src="/2022/04/22/MySQL/1650900288062.png" alt="1650900288062" loading="lazy"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤äº‹åŠ¡çš„redo logè®°å½•ï¼Œä¹Ÿå¯èƒ½åˆ·ç›˜ã€‚å› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­redo logè®°å½•æ˜¯ä¼šå†™å…¥redo log bufferä¸­çš„ï¼Œè¿™äº›redo logè®°å½•ä¼šè¢«åå°çº¿ç¨‹åˆ·ç›˜<img src="/2022/04/22/MySQL/1650900546538.png" alt="1650900546538" loading="lazy"></p>
<p>é™¤äº†åå°çº¿ç¨‹æ¯ç§’1æ¬¡çš„è½®è¯¢æ“ä½œï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“redo log bufferå ç”¨ç©ºé—´å³å°†è¾¾åˆ°innodb_log_buffer_sizeï¼ˆè¿™ä¸ªå‚æ•°é»˜è®¤16Mï¼‰çš„ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨åˆ·ç›˜</p>
<h5 id="1-6ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º"><a href="#1-6ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º" class="headerlink" title="1.6ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º"></a>1.6ä¸åŒåˆ·ç›˜ç­–ç•¥æ¼”ç¤º</h5><p><strong>1.æµç¨‹å›¾</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Innodb_flush_log_at_trx_commit=1</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1650957070916.png" alt="1650957070916" loading="lazy"></p>
<blockquote>
<p>å°ç»“ï¼šInnodb_flush_log_at_trx_commit=1</p>
<p>ä¸º1æ—¶ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo logè®°å½•å°±ä¸€å®šåœ¨ç¡¬ç›˜é‡Œï¼Œä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±ã€‚</p>
<p>å¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´MySQLæŒ‚äº†æˆ–å®•æœºï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢äº†ï¼Œä½†äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ï¼Œå¯ä»¥ä¿è¯ACIDçš„Dï¼Œæ•°æ®ç»å¯¹ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯æ•ˆç‡æœ€å·®ã€‚</p>
<p>å»ºè®®ä½¿ç”¨é»˜è®¤å€¼ï¼Œè™½ç„¶æ“ä½œç³»ç»Ÿå®•æœºæ¦‚ç‡ç†è®ºå°äºæ•°æ®åº“å®•æœºæ¦‚ç‡ï¼Œä½†ä¸€èˆ¬æ—¢ç„¶ä½¿ç”¨äº†äº‹åŠ¡ï¼Œé‚£ä¹ˆæ•°æ®çš„å®‰å…¨æ›´é‡è¦äº›</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Innodb_flush_log_at_trx_commit=2</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1650957504388.png" alt="1650957504388" loading="lazy"></p>
<blockquote>
<p>å°ç»“ï¼šInnodb_flush_log_at_trx_commit=2</p>
<p>ä¸º2æ—¶ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo log bufferä¸­çš„å†…å®¹åªå†™å…¥æ–‡ä»¶ç³»ç»Ÿç¼“å­˜(page cache)</p>
<p>å¦‚æœä»…ä»…åªæ˜¯MySQLæŒ‚äº†ä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå®•æœºå¯èƒ½ä¼šæœ‰1ç§’æ•°æ®çš„ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µä¸‹æ— æ³•æ»¡è¶³ACIDä¸­çš„Dï¼Œä½†æ˜¯æ•°å€¼2æ•ˆç‡æ›´é«˜</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Innodb_flush_log_at_trx_commit=0</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1650957883071.png" alt="1650957883071" loading="lazy"></p>
<blockquote>
<p>å°ç»“ï¼šInnodb_flush_log_at_trx_commit=0</p>
<p>ä¸º0æ—¶ï¼Œmaster threadä¸­æ¯1ç§’è¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„fsyncæ“ä½œï¼Œå› æ­¤ç¤ºä¾‹crashæœ€å¤šä¸¢å¤±1ç§’çš„äº‹åŠ¡ï¼ˆmaster threadè´Ÿè´£å°†ç¼“å†²æ± ä¸­çš„æ•°æ®å¼‚æ­¥åˆ·æ–°åˆ°ç£ç›˜ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼‰</p>
<p>æ•°å€¼0çš„è¯ï¼Œæ˜¯ä¸€ç§æŠ˜ä¸­çš„åšæ³•ï¼Œå®ƒçš„æ•ˆç‡ç†è®ºé«˜äº1ï¼Œä½äº2çš„ï¼Œè¿™ç§ç­–ç•¥ä¹Ÿæœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ï¼Œä¹Ÿæ— æ³•ä¿è¯D</p>
</blockquote>
<h5 id="1-7å†™å…¥redo-log-bufferè¿‡ç¨‹"><a href="#1-7å†™å…¥redo-log-bufferè¿‡ç¨‹" class="headerlink" title="1.7å†™å…¥redo log bufferè¿‡ç¨‹"></a>1.7å†™å…¥redo log bufferè¿‡ç¨‹</h5><h6 id="1-è¡¥å……æ¦‚å¿µï¼šMini-Transaction"><a href="#1-è¡¥å……æ¦‚å¿µï¼šMini-Transaction" class="headerlink" title="1.è¡¥å……æ¦‚å¿µï¼šMini-Transaction"></a><strong>1.è¡¥å……æ¦‚å¿µï¼šMini-Transaction</strong></h6><p>MySQLæŠŠå¯¹åº•å±‚é¡µé¢ä¸­çš„ä¸€æ¬¡åŸå­è®¿é—®çš„è¿‡ç¨‹æˆä¸ºä¸€ä¸ªMini-Transactionï¼Œç®€ç§°mtrï¼Œæ¯”å¦‚å‘æŸä¸ªç´¢å¼•å¯¹åº”çš„B+æ ‘ä¸­æ’å…¥ä¸€æ¡è®°å½•çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªMini-Transactionã€‚ä¸€ä¸ªæ‰€è°“çš„mtrå¯ä»¥åŒ…å«ä¸€ç»„redoæ—¥å¿—ï¼Œåœ¨è¿›è¡Œå´©æºƒæ¢å¤æ—¶è¿™ä¸€ç»„redoæ—¥å¿—ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“</p>
<p>ä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«è‹¥å¹²æ¡è¯­å¥ï¼Œæ¯ä¸€æ¡è¯­å¥å…¶å®å¯ä»¥åŒ…å«è‹¥å¹²ä¸ªmtrï¼Œæ¯ä¸€ä¸ªmtråˆå¯ä»¥åŒ…å«è‹¥å¹²æ¡redoæ—¥å¿—ï¼Œå¦‚å›¾ï¼š<img src="/2022/04/22/MySQL/1650959125776.png" alt="1650959125776" loading="lazy"></p>
<h6 id="2-redoæ—¥å¿—å†™å…¥log-buffer"><a href="#2-redoæ—¥å¿—å†™å…¥log-buffer" class="headerlink" title="2.redoæ—¥å¿—å†™å…¥log buffer"></a><strong>2.redoæ—¥å¿—å†™å…¥log buffer</strong></h6><p>å‘log bufferä¸­å†™å…¥redoæ—¥å¿—çš„è¿‡ç¨‹æ˜¯é¡ºåºçš„ï¼Œä¹Ÿå°±æ˜¯å…ˆå¾€å‰è¾¹çš„blockä¸­å†™ï¼Œå½“è¯¥blockçš„ç©ºé—²ç©ºé—´ç”¨å®Œä¹‹åå†å¾€ä¸‹ä¸€ä¸ªblockä¸­å†™ã€‚å½“æˆ‘ä»¬æƒ³å¾€log bufferä¸­å†™å…¥æ—¥å¿—æ—¶ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°çš„é—®é¢˜æ—¶å¾€å“ªä¸ªblockä¸­çš„å“ªä¸ªåç§»é‡å¤„ï¼Œæ‰€ä»¥InnoDBçš„è®¾è®¡è€…ç‰¹æ„æä¾›äº†ä¸€ä¸ªç§°ä¹‹ä¸ºbuf_freeçš„å…¨å±€å˜é‡ï¼Œè¯¥å˜é‡æŒ‡æ˜åç»­redoæ—¥å¿—åº”è¯¥å†™å…¥åˆ°log bufferä¸­çš„å“ªä¸ªä½ç½®ï¼Œå¦‚å›¾ï¼š<img src="/2022/04/22/MySQL/1650959522543.png" alt="1650959522543" loading="lazy"></p>
<p>ä¸€ä¸ªmtræ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿè‹¥å¹²æ¡redoæ—¥å¿—ï¼Œè¿™äº›redoæ—¥å¿—æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç»„ï¼Œæ‰€ä»¥å…¶å®å¹¶ä¸æ˜¯æ¯ç”Ÿæˆä¸€æ¡redoæ—¥å¿—ï¼Œå°±å°†å…¶æ’å…¥åˆ°log bufferä¸­ï¼Œè€Œæ˜¯æ¯ä¸ªmtrè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—å…ˆæš‚æ—¶å­˜åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå½“è¯¥mtrç»“æŸçš„æ—¶å€™ï¼Œå°†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€ç»„redoæ—¥å¿—å†å…¨éƒ¨å¤åˆ¶åˆ°log buferã€‚æˆ‘ä»¬å‡è®¾ä¸¤ä¸ªåä¸ºT1ã€T2çš„äº‹åŠ¡éƒ½åŒ…å«2ä¸ªmtrï¼Œæˆ‘ä»¬ç»™è¿™å‡ ä¸ªmtrå‘½åä¸€ä¸‹ï¼š</p>
<ul>
<li>äº‹åŠ¡T1çš„ä¸¤ä¸ªmtråˆ†åˆ«ç§°ä¸ºmtr_T1_1å’Œmtr_T1_2</li>
<li>äº‹åŠ¡T2çš„ä¸¤ä¸ªmtråˆ†åˆ«ç§°ä¸ºmtr_T2_1å’Œmtr_T2_2</li>
</ul>
<p>æ¯ä¸ªmtréƒ½ä¼šäº§ç”Ÿä¸€ç»„redoæ—¥å¿—ï¼Œç”¨ç¤ºæ„å›¾æ¥æè¿°ä¸€ä¸‹è¿™äº›mträº§ç”Ÿçš„æ—¥å¿—æƒ…å†µ<img src="/2022/04/22/MySQL/1650960042591.png" alt="1650960042591" loading="lazy"></p>
<p>ä¸åŒçš„äº‹ç‰©å¯èƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæ‰€ä»¥T1ã€T2ä¹‹é—´çš„mtrå¯èƒ½æ˜¯äº¤æ›¿æ‰§è¡Œã€‚æ¯å½“ä¸€ä¸ªmtræ‰§è¡Œå®Œæˆï¼Œä¼´éšç€è¯¥mtrç”Ÿæˆçš„ä¸€ç»„redoæ—¥å¿—å°±éœ€è¦è¢«å¤åˆ¶åˆ°log bufferä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒäº‹åŠ¡çš„mtrå¯èƒ½æ˜¯äº¤æ›¿å†™å…¥log bufferçš„ï¼Œå¦‚å›¾ï¼š(å°†ä¸€ä¸ªmträ¸­çš„æ‰€æœ‰redoæ—¥å¿—å½“æˆä¸€ä¸ªæ•´ä½“æ¥ç”»)<img src="/2022/04/22/MySQL/1650960214857.png" alt="1650960214857" loading="lazy"></p>
<p>æœ‰çš„mträº§ç”Ÿçš„redoæ—¥å¿—é‡éå¸¸å¤§ï¼Œæ¯”å¦‚mtr_t1_2äº§ç”Ÿçš„redoæ—¥å¿—å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå ç”¨äº†3ä¸ªblockæ¥å­˜å‚¨</p>
<h6 id="3-redo-log-blockçš„ç»“æ„å›¾"><a href="#3-redo-log-blockçš„ç»“æ„å›¾" class="headerlink" title="3.redo log blockçš„ç»“æ„å›¾"></a><strong>3.redo log blockçš„ç»“æ„å›¾</strong></h6><p>ä¸€ä¸ªredo log blockæ˜¯ç”±æ—¥å¿—å¤´ã€æ—¥å¿—ä½“ã€æ—¥å¿—å°¾ç»„æˆã€‚æ—¥å¿—å¤´å ç”¨12å­—èŠ‚ï¼Œæ—¥å¿—å°¾å ç”¨8å­—èŠ‚ï¼Œæ‰€ä»¥ä¸€ä¸ªblockçœŸæ­£èƒ½å­˜å‚¨çš„æ•°æ®å°±æ˜¯512-12-8=492å­—èŠ‚ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸€ä¸ªblockæ˜¯512å­—èŠ‚ï¼Ÿ</p>
<p>å’Œç£ç›˜çš„æ‰‡åŒºæœ‰å…³ï¼Œæœºæ¢°ç¡¬ç›˜é»˜è®¤æ‰‡åŒºå°±æ˜¯512å­—èŠ‚ï¼Œå¦‚æœè¦å†™å…¥çš„æ•°æ®å¤§äº512å­—èŠ‚ï¼Œé‚£ä¹ˆè¦å†™å…¥çš„æ‰‡åŒºè‚¯å®šä¸æ­¢ä¸€ä¸ªï¼Œè¿™æ˜¯å°±æ¶‰åŠåˆ°ç›˜ç‰‡çš„è½¬åŠ¨ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ‰‡åŒºï¼Œå‡è®¾ç°åœ¨éœ€è¦å†™å…¥ä¸¤ä¸ªæ‰‡åŒºAå’ŒBï¼Œå¦‚æœæ‰‡åŒºAå†™å…¥æˆåŠŸï¼Œä½†æ‰‡åŒºBå¤±è´¥ï¼Œé‚£ä¹ˆä¼šå‡ºç°éåŸå­æ€§çš„å†™å…¥ ï¼Œè€Œå¦‚æœæ¯æ¬¡åªå†™å…¥å’Œæ‰‡åŒºå¤§å°ä¸€æ ·äºŒç‚¹512å­—èŠ‚ï¼Œé‚£ä¹ˆæ¯æ¬¡çš„å†™å…¥éƒ½æ˜¯åŸå­æ€§çš„</p>
</blockquote>
<h5 id="1-8redo-log-file"><a href="#1-8redo-log-file" class="headerlink" title="1.8redo log file"></a>1.8redo log file</h5><p>1.ç›¸å…³å‚æ•°è®¾ç½®</p>
<ul>
<li>innodb_log_group_home_dir:æŒ‡å®šredo logæ–‡ä»¶ç»„æ‰€åœ¨çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º./ï¼Œè¡¨ç¤ºåœ¨æ•°æ®åº“çš„æ•°æ®ç›®å½•ä¸‹ï¼ŒMySQLçš„é»˜è®¤æ•°æ®ç›®å½•(var/lib/mysql)ä¸‹é»˜è®¤æœ‰ä¸¤ä¸ªåä¸ºib_logfile0å’Œib_logfile1çš„æ–‡ä»¶ï¼Œlog bufferä¸­çš„æ—¥å¿—é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯åˆ·æ–°åˆ°è¿™ä¸¤ä¸ªç£ç›˜æ–‡ä»¶ä¸­ï¼Œæ­¤redoæ—¥å¿—æ–‡ä»¶çš„ä½ç½®å¯ä»¥ä¿®æ”¹ã€‚</li>
<li>innodb_log_files_in_group:æŒ‡åredo log fileçš„ä¸ªæ•°ï¼Œå‘½åæ–¹å¼å¦‚ï¼šib_logfile0,iblogfile1â€¦iblogfilenã€‚é»˜è®¤2ä¸ªï¼Œæœ€å¤§100ä¸ªã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;show variables like &#x27;innodb_log_files_in_group&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1651153649950.png" alt="1651153649950" loading="lazy"></p>
<ul>
<li>innodb_flush_log_at_trx_commit:æ§åˆ¶redo logåˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œé»˜è®¤ä¸º1</li>
<li>innodb_log_file_size:å•ä¸ªredo logæ–‡ä»¶è®¾ç½®å¤§å°ï¼Œé»˜è®¤å€¼48Mï¼Œæœ€å¤§å€¼512G.æœ€å¤§å€¼æŒ‡çš„æ˜¯redo logç³»åˆ—æ–‡ä»¶ä¹‹å’Œï¼Œ(å³innodb_log_files_group*innodb_log_file_sizeä¸èƒ½å¤§äº512G)<img src="/2022/04/22/MySQL/1651153842808.png" alt="1651153842808" loading="lazy"></li>
</ul>
<p>æ ¹æ®ä¸šåŠ¡ä¿®æ”¹å…¶å¤§å°ï¼Œä»¥ä¾¿å®¹çº³è¾ƒå¤§çš„äº‹åŠ¡ã€‚ç¼–è¾‘my.cnfæ–‡ä»¶å¹¶é‡å¯æ•°æ®åº“ç”Ÿæ•ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2022/04/22/MySQL/1651153977055.png" alt="1651153977055" loading="lazy"></p>
<blockquote>
<p>åœ¨æ•°æ®åº“å®ä¾‹æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“åŠ å¤§redo logç»„æ•°å’Œå¤§å°ã€‚ä½†ä¹Ÿä¸æ¨èredo logè®¾ç½®è¿‡å¤§ï¼Œåœ¨mysqlå´©æºƒæ¢å¤æ—¶ä¼šé‡æ–°æ‰§è¡Œredoæ—¥å¿—ä¸­çš„è®°å½•</p>
</blockquote>
<p>2.æ—¥å¿—æ–‡ä»¶ç»„<img src="/2022/04/22/MySQL/1651154063137.png" alt="1651154063137" loading="lazy"></p>
<p>æ€»å…±çš„redoæ—¥å¿—æ–‡ä»¶å¤§å°å…¶å®å°±æ˜¯ï¼š innodb_log_file_size Ã— innodb_log_files_in_group ã€‚ </p>
<p>é‡‡ç”¨å¾ªç¯ä½¿ç”¨çš„æ–¹å¼å‘redoæ—¥å¿—æ–‡ä»¶ç»„é‡Œå†™æ•°æ®çš„è¯ï¼Œä¼šå¯¼è‡´åå†™å…¥çš„redoæ—¥å¿—è¦†ç›–æ‰å‰è¾¹å†™çš„redoæ—¥å¿—ï¼Ÿå½“ç„¶ï¼æ‰€ä»¥InnoDBçš„è®¾è®¡è€…æå‡ºäº†checkpointçš„æ¦‚å¿µã€‚ </p>
<p>3.checkpoint</p>
<p>åœ¨æ•´ä¸ªæ—¥å¿—æ–‡ä»¶ç»„æœ‰ä¸¤ä¸ªé‡è¦å±æ€§ï¼š</p>
<p>write posï¼šå½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»</p>
<p>checkpointï¼šå½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åç§»</p>
<p>æ¯æ¬¡åˆ·ç›˜redo logè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ç»„ä¸­ï¼Œwrite posä½ç½®å°±ä¼šåç§»æ›´æ–°ã€‚æ¯æ¬¡mysqlåŠ è½½æ—¥å¿—æ–‡ä»¶ç»„æ¢å¤æ•°æ®æ—¶ï¼Œä¼šæ¸…ç©ºåŠ è½½è¿‡çš„redo logè®°å½•ï¼Œå¹¶æŠŠcheckpointåç§»æ›´æ–°ã€‚write poså’Œcheckpointä¹‹é—´ç©ºç€çš„éƒ¨åˆ†å¯ä»¥ç”¨æ¥å†™å…¥æ–°çš„redo logè®°å½•</p>
<p><img src="/2022/04/22/MySQL/1651154092511.png" alt="1651154092511" loading="lazy"></p>
<p>å¦‚æœ write pos è¿½ä¸Š checkpoint ï¼Œè¡¨ç¤º<strong>æ—¥å¿—æ–‡ä»¶ç»„</strong>æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„ redo logè®°å½•ï¼ŒMySQL å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚</p>
<p><img src="/2022/04/22/MySQL/1651154127091.png" alt="1651154127091" loading="lazy"></p>
<h5 id="1-9redo-logå°ç»“"><a href="#1-9redo-logå°ç»“" class="headerlink" title="1.9redo logå°ç»“"></a>1.9redo logå°ç»“</h5><p>InnoDBçš„æ›´æ–°æ“ä½œé‡‡ç”¨çš„æ˜¯Write Ahead Log(<strong>é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–</strong>)ç­–ç•¥ï¼Œå³å…ˆå†™æ—¥å¿—ï¼Œå†å†™å…¥ç£ç›˜<img src="/2022/04/22/MySQL/1651155157883.png" alt="1651155157883" loading="lazy"></p>
<h4 id="Undoæ—¥å¿—"><a href="#Undoæ—¥å¿—" class="headerlink" title="Undoæ—¥å¿—"></a>Undoæ—¥å¿—</h4><p>redo logæ˜¯äº‹åŠ¡æŒä¹…æ€§çš„ä¿è¯ï¼Œundo logæ˜¯äº‹åŠ¡åŸå­æ€§çš„ä¿è¯ã€‚åœ¨äº‹åŠ¡ä¸­ æ›´æ–°æ•°æ® çš„ å‰ç½®æ“ä½œ å…¶å®æ˜¯è¦å…ˆå†™å…¥ä¸€ä¸ª undo log ã€‚ </p>
<h5 id="1-å¦‚ä½•ç†è§£Undoæ—¥å¿—"><a href="#1-å¦‚ä½•ç†è§£Undoæ—¥å¿—" class="headerlink" title="1.å¦‚ä½•ç†è§£Undoæ—¥å¿—"></a>1.å¦‚ä½•ç†è§£Undoæ—¥å¿—</h5><p>äº‹åŠ¡éœ€è¦ä¿è¯åŸå­æ€§ï¼›ä¹Ÿå°±æ˜¯äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆä»€ä¹ˆä¹Ÿä¸åšã€‚ä½†æœ‰æ—¶å€™äº‹åŠ¡æ‰§è¡Œåˆ°ä¸€åŠä¼šå‡ºç°ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°å„ç§é”™è¯¯ï¼Œæ¯”å¦‚æœåŠ¡å™¨æœ¬èº«é”™è¯¯ã€æ“ä½œç³»ç»Ÿé”™è¯¯ï¼Œç”šè‡³æ–­ç”µå¯¼è‡´çš„é”™è¯¯</li>
<li>ç¨‹åºå‘˜åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ‰‹åŠ¨è¾“å…¥ROLLBACKè¯­å¥ç»“æŸå½“å‰äº‹åŠ¡</li>
</ul>
<p>ä»¥ä¸Šæƒ…å†µå‡ºç°ï¼Œå°±éœ€è¦æŠŠæ•°æ®æ”¹å›åŸæ¥çš„æ ·å­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºå›æ»šï¼Œè¿™æ ·å°±é€ æˆä¸€ä¸ªå‡è±¡ï¼šè¿™ä¸ªäº‹åŠ¡çœ‹èµ·æ¥ä»€ä¹ˆéƒ½æ²¡åšï¼Œæ‰€ä»¥ç¬¦åˆåŸå­æ€§è¦æ±‚ã€‚</p>
<p>æ¯å½“å¯¹ä¸€æ¡è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œï¼ˆè¿™é‡Œçš„æ”¹åŠ¨æ˜¯æŒ‡insertã€deleteã€updateï¼‰ï¼Œéƒ½éœ€è¦â€ç•™ä¸€æ‰‹â€œâ€“æŠŠå›æ»šæ—¶æ‰€éœ€çš„ä¸œè¥¿è®°å½•ä¸‹æ¥ã€‚æ¯”å¦‚ï¼š<img src="/2022/04/22/MySQL/1651157169184.png" alt="1651157169184" loading="lazy"></p>
<p>MySQLæŠŠè¿™äº›ä¸ºäº†å›æ»šè€Œè®°å½•çš„è¿™äº›å†…å®¹ç§°ä¹‹ä¸ºæ’¤é”€æ—¥å¿—æˆ–è€…å›æ»šæ—¥å¿—ï¼ŒæŸ¥è¯¢æ“ä½œå¹¶ä¸ä¼šä¿®æ”¹ä»»ä½•è®°å½•ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æ“ä½œæ—¶ï¼Œå¹¶ä¸éœ€è¦ç›¸åº”çš„undoæ—¥å¿—ã€‚</p>
<p>æ­¤å¤–ï¼Œundo logä¼šäº§ç”Ÿredo logï¼Œä¹Ÿå°±æ˜¯undo logçš„äº§ç”Ÿä¼´éšç€redo logçš„äº§ç”Ÿï¼Œè¿™æ˜¯å› ä¸ºundo logä¹Ÿéœ€è¦æŒä¹…æ€§ä¿æŠ¤</p>
<h5 id="2-Undoæ—¥å¿—çš„ä½œç”¨"><a href="#2-Undoæ—¥å¿—çš„ä½œç”¨" class="headerlink" title="2.Undoæ—¥å¿—çš„ä½œç”¨"></a>2.Undoæ—¥å¿—çš„ä½œç”¨</h5><p>ä½œç”¨1ï¼šå›æ»šæ•°æ®<img src="/2022/04/22/MySQL/1651157557490.png" alt="1651157557490" loading="lazy"></p>
<p>ä½œç”¨2ï¼šMVCC<img src="/2022/04/22/MySQL/1651157569892.png" alt="1651157569892" loading="lazy"></p>
<h5 id="3-undoçš„å­˜å‚¨ç»“æ„"><a href="#3-undoçš„å­˜å‚¨ç»“æ„" class="headerlink" title="3.undoçš„å­˜å‚¨ç»“æ„"></a>3.undoçš„å­˜å‚¨ç»“æ„</h5><p>3.1å›æ»šæ®µä¸undoé¡µ</p>
<p>InnoDBå¯¹undo logçš„ç®¡ç†é‡‡ç”¨æ®µçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ å›æ»šæ®µï¼ˆrollback segmentï¼‰ ã€‚æ¯ä¸ªå›æ»šæ®µè®°å½•äº†1024 ä¸ª undo log segment ï¼Œè€Œåœ¨æ¯ä¸ªundo log segmentæ®µä¸­è¿›è¡Œ undoé¡µ çš„ç”³è¯·ã€‚ </p>
<ul>
<li>åœ¨ InnoDB1.1ç‰ˆæœ¬ä¹‹å‰ ï¼ˆä¸åŒ…æ‹¬1.1ç‰ˆæœ¬ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªrollback segmentï¼Œå› æ­¤æ”¯æŒåŒæ—¶åœ¨çº¿çš„äº‹åŠ¡é™åˆ¶ä¸º 1024 ã€‚è™½ç„¶å¯¹ç»å¤§å¤šæ•°çš„åº”ç”¨æ¥è¯´éƒ½å·²ç»å¤Ÿç”¨ã€‚ </li>
<li>ä»1.1ç‰ˆæœ¬å¼€å§‹InnoDBæ”¯æŒæœ€å¤§ 128ä¸ªrollback segment ï¼Œæ•…å…¶æ”¯æŒåŒæ—¶åœ¨çº¿çš„äº‹åŠ¡é™åˆ¶æé«˜åˆ°äº† 128*1024 ã€‚</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651157708035.png" alt="1651157708035" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651217991131.png" alt="1651217991131" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651218067477.png" alt="1651218067477" loading="lazy"></p>
<p>3.2å›æ»šæ®µä¸äº‹åŠ¡</p>
<p>â€‹    1.æ¯ä¸ªäº‹åŠ¡åªä¼šä½¿ç”¨ä¸€ä¸ªå›æ»šæ®µï¼Œä¸€ä¸ªå›æ»šæ®µåœ¨åŒä¸€æ—¶åˆ»å¯èƒ½ä¼šæœåŠ¡äºå¤šä¸ªäº‹åŠ¡ã€‚ </p>
<ol start="2">
<li>å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œä¼šåˆ¶å®šä¸€ä¸ªå›æ»šæ®µï¼Œåœ¨äº‹åŠ¡è¿›è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼ŒåŸå§‹çš„æ•° </li>
</ol>
<p>æ®ä¼šè¢«å¤åˆ¶åˆ°å›æ»šæ®µã€‚ </p>
<ol start="3">
<li><p>åœ¨å›æ»šæ®µä¸­ï¼Œäº‹åŠ¡ä¼šä¸æ–­å¡«å……ç›˜åŒºï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæˆ–æ‰€æœ‰çš„ç©ºé—´è¢«ç”¨å®Œã€‚å¦‚æœå½“å‰çš„ç›˜åŒºä¸å¤Ÿç”¨ï¼Œäº‹åŠ¡ä¼šåœ¨æ®µä¸­è¯·æ±‚æ‰©å±•ä¸‹ä¸€ä¸ªç›˜åŒºï¼Œå¦‚æœæ‰€æœ‰å·²åˆ†é…çš„ç›˜åŒºéƒ½è¢«ç”¨å®Œï¼Œäº‹åŠ¡ä¼šè¦†ç›–æœ€åˆçš„ç›˜ åŒºæˆ–è€…åœ¨å›æ»šæ®µå…è®¸çš„æƒ…å†µä¸‹æ‰©å±•æ–°çš„ç›˜åŒºæ¥ä½¿ç”¨ã€‚ </p>
</li>
<li><p>å›æ»šæ®µå­˜åœ¨äºundoè¡¨ç©ºé—´ä¸­ï¼Œåœ¨æ•°æ®åº“ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªundoè¡¨ç©ºé—´ï¼Œä½†åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ä¸ªundoè¡¨ç©ºé—´ã€‚ </p>
</li>
<li><p>å½“äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šåšä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…ï¼š </p>
</li>
</ol>
<ul>
<li>å°†undo logæ”¾å…¥åˆ—è¡¨ä¸­ï¼Œä»¥ä¾›ä¹‹åçš„purgeæ“ä½œ </li>
<li>åˆ¤æ–­undo logæ‰€åœ¨çš„é¡µæ˜¯å¦å¯ä»¥é‡ç”¨ï¼Œè‹¥å¯ä»¥åˆ†é…ç»™ä¸‹ä¸ªäº‹åŠ¡ä½¿ç”¨ </li>
</ul>
<p>3.3å›æ»šæ®µä¸­çš„æ•°æ®åˆ†ç±»</p>
<ol>
<li><p>æœªæäº¤çš„å›æ»šæ•°æ®(uncommitted undo information) </p>
</li>
<li><p>å·²ç»æäº¤ä½†æœªè¿‡æœŸçš„å›æ»šæ•°æ®(committed undo information) </p>
</li>
<li><p>äº‹åŠ¡å·²ç»æäº¤å¹¶è¿‡æœŸçš„æ•°æ®(expired undo information) </p>
</li>
</ol>
<h5 id="4undoçš„ç±»å‹"><a href="#4undoçš„ç±»å‹" class="headerlink" title="4undoçš„ç±»å‹"></a>4undoçš„ç±»å‹</h5><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œundo logåˆ†ä¸ºï¼š </p>
<ul>
<li>insert undo log </li>
<li>update undo log </li>
</ul>
<h5 id="5-undo-logçš„å£°æ˜å‘¨æœŸ"><a href="#5-undo-logçš„å£°æ˜å‘¨æœŸ" class="headerlink" title="5.undo logçš„å£°æ˜å‘¨æœŸ"></a>5.undo logçš„å£°æ˜å‘¨æœŸ</h5><p>5.1ç®€è¦ç”Ÿæˆè¿‡ç¨‹</p>
<p>åªæœ‰Buffer Poolçš„æµç¨‹ï¼š<img src="/2022/04/22/MySQL/1651157886841.png" alt="1651157886841" loading="lazy"></p>
<p>æœ‰äº†Redo logå’ŒUndo logä¹‹åï¼š<img src="/2022/04/22/MySQL/1651157909096.png" alt="1651157909096" loading="lazy"></p>
<p>5.2è¯¦ç»†ç”Ÿæˆè¿‡ç¨‹<img src="/2022/04/22/MySQL/1651157929374.png" alt="1651157929374" loading="lazy"></p>
<p>å½“æˆ‘ä»¬æ‰§è¡Œinsertæ—¶ï¼š</p>
<blockquote>
<p>begin; </p>
<p>INSERT INTO user (name) VALUES (â€œtomâ€);</p>
</blockquote>
<p><img src="/2022/04/22/MySQL/1651157994414.png" alt="1651157994414" loading="lazy"></p>
<p>å½“æ‰§è¡Œupdateæ—¶ï¼š<img src="/2022/04/22/MySQL/1651158015821.png" alt="1651158015821" loading="lazy"></p>
<blockquote>
<p>UPDATE user SET id=2 WHERE id=1;</p>
</blockquote>
<p><img src="/2022/04/22/MySQL/1651158032322.png" alt="1651158032322" loading="lazy"></p>
<p>5.3undo logå¦‚ä½•å›æ»š</p>
<p>ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå‡è®¾æ‰§è¡Œrollbackï¼Œé‚£ä¹ˆå¯¹åº”çš„æµç¨‹åº”è¯¥æ˜¯è¿™æ ·ï¼š </p>
<ol>
<li><p>é€šè¿‡undo no=3çš„æ—¥å¿—æŠŠid=2çš„æ•°æ®åˆ é™¤ </p>
</li>
<li><p>é€šè¿‡undo no=2çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®çš„deletemarkè¿˜åŸæˆ0 </p>
</li>
<li><p>é€šè¿‡undo no=1çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®çš„nameè¿˜åŸæˆTom </p>
</li>
<li><p>é€šè¿‡undo no=0çš„æ—¥å¿—æŠŠid=1çš„æ•°æ®åˆ é™¤</p>
</li>
</ol>
<p>5.4undo logçš„åˆ é™¤</p>
<ul>
<li>é’ˆå¯¹äºinsert undo log </li>
</ul>
<p>å› ä¸ºinsertæ“ä½œçš„è®°å½•ï¼Œåªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚æ•…è¯¥undo logå¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ï¼Œä¸éœ€è¦è¿›è¡Œpurgeæ“ä½œã€‚ </p>
<ul>
<li>é’ˆå¯¹äºupdate undo log </li>
</ul>
<p>è¯¥undo logå¯èƒ½éœ€è¦æä¾›MVCCæœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥undo logé“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤ã€‚ </p>
<h5 id="6å°ç»“"><a href="#6å°ç»“" class="headerlink" title="6å°ç»“"></a>6å°ç»“</h5><p><img src="/2022/04/22/MySQL/1651158117353.png" alt="1651158117353" loading="lazy"></p>
<p>undo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯¹äº‹ç‰©å›æ»šæ—¶ï¼Œåªæ˜¯å°†æ•°æ®åº“é€»è¾‘åœ°æ¢å¤åˆ°åŸæ¥çš„æ ·å­</p>
<p>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œundo logä¸æ˜¯redo logçš„é€†è¿‡ç¨‹</p>
<h3 id="å…¶ä»–æ•°æ®åº“æ—¥å¿—"><a href="#å…¶ä»–æ•°æ®åº“æ—¥å¿—" class="headerlink" title="å…¶ä»–æ•°æ®åº“æ—¥å¿—"></a>å…¶ä»–æ•°æ®åº“æ—¥å¿—</h3><p>MySQLå®˜ç½‘æ—¥å¿—åœ°å€ï¼šâ€œ<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/server-logs.html%E2%80%9D">https://dev.mysql.com/doc/refman/8.0/en/server-logs.htmlâ€</a></p>
<h4 id="1-MySQLæ”¯æŒçš„æ—¥å¿—"><a href="#1-MySQLæ”¯æŒçš„æ—¥å¿—" class="headerlink" title="1.MySQLæ”¯æŒçš„æ—¥å¿—"></a>1.MySQLæ”¯æŒçš„æ—¥å¿—</h4><h5 id="1-1æ—¥å¿—ç±»å‹"><a href="#1-1æ—¥å¿—ç±»å‹" class="headerlink" title="1.1æ—¥å¿—ç±»å‹"></a>1.1æ—¥å¿—ç±»å‹</h5><p>MySQLæœ‰ä¸åŒç±»å‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨ä¸åŒç±»å‹çš„æ—¥å¿—ï¼Œåˆ†ä¸º<strong>äºŒè¿›åˆ¶æ—¥å¿—</strong>ã€<strong>é”™è¯¯æ—¥å¿—</strong>ã€<strong>é€šç”¨æŸ¥è¯¢æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„4ç§ã€‚MySQL8åˆæ–°å¢äº†ï¼š</strong>ä¸­ç»§æ—¥å¿—å’Œæ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—**ã€‚ä½¿ç”¨è¿™äº›æ—¥å¿—æ–‡ä»¶å¯ä»¥æŸ¥çœ‹MySQLå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<p>è¿™6ç±»æ—¥å¿—åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡long_query_timeçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œæ–¹ä¾¿å¯¹æŸ¥è¯¢ä¼˜åŒ–</li>
<li>é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰è¿æ¥çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ï¼Œä»¥åŠè¿æ¥å‘é€ç»™æœåŠ¡å™¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œå¯¹æˆ‘ä»¬å¤åŸæ“ä½œçš„å®é™…åœºæ™¯ã€å‘ç°é—®é¢˜ï¼Œç”šè‡³æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„å®¡è®¡éƒ½æœ‰å¾ˆå¤§å¸®åŠ©</li>
<li>é”™è¯¯æ—¥å¿—ï¼šè®°å½•MySQLæœåŠ¡çš„å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢MySQLæœåŠ¡æ—¶å‡ºç°çš„é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬äº†è§£æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œä»è€Œå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤</li>
<li>äºŒè¿›åˆ¶æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰æ›´æ”¹æ•°æ®çš„è¯­å¥ï¼Œå¯ä»¥ç”¨äºä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œä»¥åŠæœåŠ¡å™¨é‡åˆ°æ•…éšœæ—¶æ•°æ®çš„æ— æŸå¤±æ¢å¤</li>
<li>ä¸­ç»§æ—¥å¿—ï¼šç”¨äºä¸»ä»æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œä»æœåŠ¡å™¨ç”¨æ¥å­˜æ”¾ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶å†…å®¹çš„ä¸€ä¸ªä¸­é—´æ–‡ä»¶ã€‚ä»æœåŠ¡å™¨é€šè¿‡è¯»å–ä¸­ç»§æ—¥å¿—çš„å†…å®¹ï¼Œæ¥åŒæ­¥ä¸»æœåŠ¡å™¨ä¸Šçš„æ“ä½œã€‚</li>
<li>æ•°æ®å®šä¹‰è¯­å¥æ—¥å¿—ï¼šè®°å½•æ•°æ®å®šä¹‰è¯­å¥æ‰§è¡Œçš„å…ƒæ•°æ®æ“ä½œ</li>
</ul>
<p>é™¤äºŒè¿›åˆ¶æ—¥å¿—å¤–ï¼Œå…¶ä»–æ—¥å¿—éƒ½æ˜¯<strong>æ–‡æœ¬æ–‡ä»¶</strong>ã€‚é»˜è®¤æƒ…å†µï¼Œæ‰€æœ‰æ—¥å¿—æ–‡ä»¶åˆ›å»ºäº<strong>MySQLæ•°æ®ç›®å½•</strong>ä¸­</p>
<h5 id="1-2æ—¥å¿—çš„å¼Šç«¯"><a href="#1-2æ—¥å¿—çš„å¼Šç«¯" class="headerlink" title="1.2æ—¥å¿—çš„å¼Šç«¯"></a>1.2æ—¥å¿—çš„å¼Šç«¯</h5><ul>
<li>æ—¥å¿—åŠŸèƒ½ä¼š<strong>é™ä½MySQLæ•°æ®åº“çš„æ€§èƒ½</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸ¥è¯¢éå¸¸é¢‘ç¹çš„MySQLæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¼€å¯äº†é€šç”¨æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLæ•°æ®åº“ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´è®°å½•æ—¥å¿—</li>
<li>æ—¥å¿—ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚å¯¹äºç”¨æˆ·é‡éå¸¸å¤§ã€æ“ä½œéå¸¸é¢‘ç¹çš„æ•°æ®åº“ï¼Œæ—¥å¿—æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è®¾ç½®æ¯”æ•°æ®åº“æ–‡ä»¶éœ€è¦çš„å­˜å‚¨ç©ºé—´è¿˜è¦å¤§</li>
</ul>
<h4 id="2-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log"><a href="#2-é€šç”¨æŸ¥è¯¢æ—¥å¿—-general-query-log" class="headerlink" title="2.é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)"></a>2.é€šç”¨æŸ¥è¯¢æ—¥å¿—(general query log)</h4><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—ç”¨æ¥<strong>è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ</strong>ï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­MySQLæœåŠ¡ã€æ‰€æœ‰ç”¨æˆ·çš„è¿æ¥å¼€å§‹æ—¶é—´å’Œæˆªæ­¢æ—¶é—´ã€å‘ç»™MySQLæ•°æ®åº“æœåŠ¡å™¨çš„æ‰€æœ‰SQLæŒ‡ä»¤ç­‰ã€‚å½“æˆ‘ä»¬çš„æ•°æ®å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œ<strong>å¼€å¯é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œè¿˜åŸæ“ä½œæ—¶çš„å…·ä½“åœºæ™¯</strong>ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡†ç¡®å®šä½é—®é¢˜ã€‚</p>
<h5 id="2-1é—®é¢˜åœºæ™¯"><a href="#2-1é—®é¢˜åœºæ™¯" class="headerlink" title="2.1é—®é¢˜åœºæ™¯"></a>2.1é—®é¢˜åœºæ™¯<img src="/2022/04/22/MySQL/1652081406202.png" alt="1652081406202" loading="lazy"></h5><h5 id="2-2æŸ¥çœ‹å½“å‰çŠ¶æ€"><a href="#2-2æŸ¥çœ‹å½“å‰çŠ¶æ€" class="headerlink" title="2.2æŸ¥çœ‹å½“å‰çŠ¶æ€"></a>2.2æŸ¥çœ‹å½“å‰çŠ¶æ€<img src="/2022/04/22/MySQL/1652081470079.png" alt="1652081470079" loading="lazy"></h5><p>è¯´æ˜1ï¼šç³»ç»Ÿå˜é‡general_logçš„å€¼æ˜¯OFFï¼Œå³é€šç”¨æŸ¥è¯¢æ—¥å¿—å¤„äºå…³é—­çŠ¶æ€ã€‚åœ¨MySQLä¸­ï¼Œè¿™ä¸ªå‚æ•°çš„<strong>é»˜è®¤å€¼æ˜¯å…³é—­çš„</strong>ã€‚å› ä¸ºä¸€æ—¦å¼€å¯è®°å½•é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼ŒMySQLä¼šè®°å½•æ‰€æœ‰çš„è¿æ¥èµ·æ­¢å’Œç›¸å…³çš„sqlæ“ä½œï¼Œè¿™æ ·ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºå¹¶ä¸”å ç”¨ç£ç›˜ç©ºé—´ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹å˜é‡çš„å€¼ï¼Œåœ¨<strong>éœ€è¦çš„æ—¶å€™å¼€å¯æ—¥å¿—ã€‚</strong></p>
<p>è¯´æ˜2ï¼šé€šç”¨æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„åç§°æ˜¯atguigu01.logã€‚å­˜å‚¨è·¯å¾„æ˜¯var/lib/mysql/ï¼Œé»˜è®¤ä¹Ÿæ˜¯æ•°æ®è·¯å¾„ï¼Œè¿™æ ·æˆ‘ä»¬çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æŸ¥çœ‹é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„å†…å®¹ã€‚</p>
<h5 id="2-3å¯åŠ¨æ—¥å¿—"><a href="#2-3å¯åŠ¨æ—¥å¿—" class="headerlink" title="2.3å¯åŠ¨æ—¥å¿—"></a>2.3å¯åŠ¨æ—¥å¿—</h5><p><strong>æ–¹å¼1ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p>
<p>ä¿®æ”¹my.cnfæˆ–è€…my.inié…ç½®æ–‡ä»¶æ¥è®¾ç½®ã€‚åœ¨mysqlç»„ä¸‹åŠ å…¥logé€‰é¡¹ï¼Œå¹¶é‡å¯MySQLæœåŠ¡ã€‚æ ¼å¼å¦‚ä¸‹</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="literal">ON</span></span><br><span class="line"><span class="attr">general_log_file</span>=[path[filename]] <span class="comment">#æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è·¯å¾„,filenameä¸ºæ—¥å¿—æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æŒ‡å®šç›®å½•å’Œæ–‡ä»¶åï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—é»˜è®¤å­˜å‚¨åœ¨MySQLæ•°æ®ç›®å½•ä¸­çš„hostname.logæ–‡ä»¶ä¸­ï¼Œhostnameè¡¨ç¤ºä¸»æœºåã€‚</p>
<p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL general_log=on;  #å¼€å¯é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br><span class="line">SET GLOBAL general_log_file=&#x27;path/filename&#x27;;  #è®¾ç½®æ—¥å¿—æ–‡ä»¶ä½ç½®</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ï¼Œå…³é—­æ“ä½œSQLå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL general_log=off;  #å…³é—­é€šç”¨æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è®¾ç½®åçš„æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;general_log%&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="2-4æŸ¥çœ‹æ—¥å¿—"><a href="#2-4æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="2.4æŸ¥çœ‹æ—¥å¿—"></a>2.4æŸ¥çœ‹æ—¥å¿—</h5><p>é€šç”¨æŸ¥è¯¢æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚æ¯å°MySQLæœåŠ¡å™¨çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—å†…å®¹æ˜¯ä¸åŒçš„ã€‚</p>
<ul>
<li>åœ¨windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨</li>
<li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨viå·¥å…·æˆ–è€…geditå·¥å…·æŸ¥çœ‹</li>
<li>åœ¨Mac osxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨æˆ–è€…viç­‰å·¥å…·æŸ¥çœ‹</li>
</ul>
<p>ä»**SHOW VARIABLES LIKE â€˜general_log%â€™;**ç»“æœä¸­å¯ä»¥çœ‹åˆ°é€šç”¨æŸ¥è¯¢æ—¥å¿—çš„è®¾ç½®</p>
<p>é€šè¿‡é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥äº†è§£ç”¨æˆ·å¯¹MySQLè¿›è¡Œçš„æ“ä½œã€‚æ¯”å¦‚MySQLå¯åŠ¨ä¿¡æ¯å’Œç”¨æˆ·rootè¿æ¥æœåŠ¡å™¨å’Œæ‰§è¡ŒæŸ¥è¯¢è¡¨çš„è®°å½•ã€‚<img src="/2022/04/22/MySQL/1652082843720.png" alt="1652082843720" loading="lazy"></p>
<p>é€šç”¨æŸ¥è¯¢æ—¥å¿—é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…é™¤çš„çœ‹åˆ°ï¼Œä»€ä¹ˆæ—¶å€™å¼€å¯äº†æ–°çš„å®¢æˆ·ç«¯ç™»å½•æ•°æ®åº“ï¼Œç™»å½•ä¹‹ååšäº†ä»€ä¹ˆï¼Œé’ˆå¯¹çš„æ˜¯å“ªä¸ªæ•°æ®è¡¨ç­‰ä¿¡æ¯ã€‚</p>
<h5 id="2-5åœæ­¢æ—¥å¿—"><a href="#2-5åœæ­¢æ—¥å¿—" class="headerlink" title="2.5åœæ­¢æ—¥å¿—"></a>2.5åœæ­¢æ—¥å¿—</h5><p><strong>æ–¹å¼ä¸€ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p>
<p>ä¿®æ”¹my.cnfæˆ–è€…my.iniæ–‡ä»¶ï¼ŒæŠŠ[mysqld]ç»„ä¸‹çš„general_logå€¼è®¾ç½®ä¸ºOFFæˆ–è€…æŠŠgeneral_logä¸€é¡¹æ³¨é‡Šæ‰ã€‚</p>
<p>ä¸¾ä¾‹1ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">general_log</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹2ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#general_log=ON</span></span><br></pre></td></tr></table></figure>

<p><strong>æ–¹å¼2ï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p>
<p>ä½¿ç”¨SETå‘½ä»¤åœæ­¢MySQLé€šç”¨æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL general_log=off;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹é€šç”¨æ—¥å¿—åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;general_log%&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="2-6åˆ é™¤-åˆ·æ–°æ—¥å¿—"><a href="#2-6åˆ é™¤-åˆ·æ–°æ—¥å¿—" class="headerlink" title="2.6åˆ é™¤/åˆ·æ–°æ—¥å¿—"></a>2.6åˆ é™¤/åˆ·æ–°æ—¥å¿—</h5><p>å¦‚æœæ•°æ®çš„ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œé‚£ä¹ˆé€šç”¨æŸ¥è¯¢æ—¥å¿—ä¼šå ç”¨æœåŠ¡å™¨éå¸¸å¤§çš„ç£ç›˜ç©ºé—´ã€‚æ•°æ®ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å¾ˆé•¿æ—¶é—´ä¹‹å‰çš„æŸ¥è¯¢æ—¥å¿—ï¼Œä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜ç©ºé—´ã€‚</p>
<p><strong>æ‰‹åŠ¨åˆ é™¤æ–‡ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLE LIKE &#x27;general_log%&#x27;;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œé€šç”¨æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•é»˜è®¤ä¸ºMySQLæ•°æ®ç›®å½•ã€‚åœ¨è¯¥ç›®å½•ä¸‹æ‰‹åŠ¨åˆ é™¤é€šç”¨æŸ¥è¯¢æ—¥å¿—atguigu01.logã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”ŸæˆæŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ã€‚åˆ·æ–°MySQLSæ•°æ®ç›®å½•ï¼Œå‘ç°åˆ›å»ºäº†æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚å‰æä¸€å®šè¦å¼€å¯é€šç”¨æ—¥å¿—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¸Œæœ›å¤‡ä»½æ—§çš„é€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼Œå°±å¿…é¡»å…ˆå°†æ—§çš„æ—¥å¿—æ–‡ä»¶å¤åˆ¶å‡ºæ¥æˆ–è€…æ”¹åï¼Œç„¶åæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚æ­£ç¡®æµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd mysqld-data-directory  #è¾“å…¥è‡ªå·±çš„é€šç”¨æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">mv mysql.general.log mysql.general.log.old  #æŒ‡åæ—§çš„æ–‡ä»¶åä»¥åŠæ–°çš„æ–‡ä»¶å</span><br><span class="line">mysqladmin -uroot -p flush-logs  </span><br></pre></td></tr></table></figure>

<h4 id="3-é”™è¯¯æ—¥å¿—ï¼ˆerror-logï¼‰"><a href="#3-é”™è¯¯æ—¥å¿—ï¼ˆerror-logï¼‰" class="headerlink" title="3.é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰"></a>3.é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰</h4><p>é”™è¯¯æ—¥å¿—è®°å½•äº†MySQL<strong>æœåŠ¡å™¨å¯åŠ¨ã€åœæ­¢è¿è¡Œæ—¶é—´ï¼Œä»¥åŠç³»ç»Ÿå¯åŠ¨ã€è¿è¡Œå’Œåœæ­¢è¿‡ç¨‹ä¸­çš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬é”™è¯¯ã€è­¦å‘Šå’Œæç¤º</strong>ç­‰ã€‚</p>
<p>é€šè¿‡é”™è¯¯æ—¥å¿—å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œä¾¿äºåŠæ—¶å‘ç°æ•…éšœã€ä¿®å¤æ•…éšœã€‚å¦‚æœMySQLæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œé”™è¯¯æ—¥å¿—æ˜¯å‘ç°é—®é¢˜ã€è§£å†³æ•…éšœçš„é¦–é€‰ã€‚</p>
<h5 id="3-1å¯åŠ¨æ—¥å¿—"><a href="#3-1å¯åŠ¨æ—¥å¿—" class="headerlink" title="3.1å¯åŠ¨æ—¥å¿—"></a>3.1å¯åŠ¨æ—¥å¿—</h5><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œé”™è¯¯æ—¥å¿—åŠŸèƒ½æ˜¯é»˜è®¤å¼€å¯çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯æ—¥å¿—<strong>æ— æ³•è¢«ç¦æ­¢</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—å­˜å‚¨åœ¨MySQLæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ï¼Œåç§°é»˜è®¤mysqld.logï¼ˆLinuxç³»ç»Ÿï¼‰æˆ–è€…hostname.errï¼ˆmaxç³»ç»Ÿï¼‰ã€‚å¦‚æœéœ€è¦ç»‘å®šæ–‡ä»¶åï¼Œåˆ™éœ€è¦åœ¨my.iniæˆ–è€…my.cnfä¸­åšå¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">log-error</span>=[path/[filename]]  <span class="comment">#pathä¸ºæ—¥å¿—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œfilenameä¸ºæ—¥å¿—æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®é¡¹åï¼Œéœ€è¦é‡å¯MySQLæœåŠ¡ä»¥ç”Ÿæ•ˆ</p>
<h5 id="3-2æŸ¥çœ‹æ—¥å¿—"><a href="#3-2æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="3.2æŸ¥çœ‹æ—¥å¿—"></a>3.2æŸ¥çœ‹æ—¥å¿—</h5><p>MySQLé”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶å½¢å¼å­˜å‚¨çš„ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥æŸ¥çœ‹ã€‚</p>
<p>æŸ¥è¯¢é”™è¯¯æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼š<img src="/2022/04/22/MySQL/1652086149005.png" alt="1652086149005" loading="lazy"></p>
<p>æ‰§è¡Œç»“æœä¸­å¯ä»¥çœ‹åˆ°é”™è¯¯æ—¥å¿—æ–‡ä»¶æ˜¯mysqld.logï¼Œåœ¨é»˜è®¤çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹é”™è¯¯æ—¥å¿—çš„å†…å®¹<img src="/2022/04/22/MySQL/1652086201026.png" alt="1652086201026" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•äº†æœåŠ¡å™¨å¯åŠ¨çš„æ—¶é—´ï¼Œä»¥åŠå­˜å‚¨å¼•æ“InnoDBå¯åŠ¨å’Œåœæ­¢æ—¶é—´ç­‰ï¼Œæˆ‘ä»¬åœ¨åšåˆå§‹åŒ–æ—¶ç”Ÿæˆçš„æ•°æ®åº“åˆå§‹å¯†ç ä¹Ÿæ˜¯è®°å½•åœ¨error.log</p>
<h5 id="3-3åˆ é™¤-åˆ·æ–°æ—¥å¿—"><a href="#3-3åˆ é™¤-åˆ·æ–°æ—¥å¿—" class="headerlink" title="3.3åˆ é™¤/åˆ·æ–°æ—¥å¿—"></a>3.3åˆ é™¤/åˆ·æ–°æ—¥å¿—</h5><p>å¯¹äºå¾ˆä¹…ä»¥å‰çš„é”™è¯¯æ—¥å¿—ï¼Œæ•°æ®åº“ç®¡ç†å‘˜æŸ¥çœ‹è¿™äº›é”™è¯¯æ—¥å¿—çš„å¯èƒ½æ€§ä¸å¤§ï¼Œå¯ä»¥å°†è¿™äº›é”™è¯¯æ—¥å¿—åˆ é™¤ï¼Œä»¥ä¿è¯MySQLæœåŠ¡å™¨ä¸Šçš„<strong>ç¡¬ç›˜ç©ºé—´</strong>ã€‚MySQLçš„é”™è¯¯æ—¥å¿—æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼ä¸€ï¼‰ï¼šåˆ é™¤æ“ä½œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /var/lib/mysql/mysqld.log</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿è¡ŒçŠ¶æ€ä¸‹åˆ é™¤é”™è¯¯æ—¥å¿—æ–‡ä»¶åï¼ŒMySQLå¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶</p>
</li>
<li><p>ç¬¬ä¸€æ­¥ï¼ˆæ–¹å¼äºŒï¼‰ï¼šé‡å‘½åæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/log/mysqld.log /var/log/mysqld.log.old</span><br></pre></td></tr></table></figure></li>
<li><p>ç¬¬äºŒæ­¥ï¼šé‡å»ºæ—¥å¿—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½ä¼šæŠ¥é”™ï¼š<img src="/2022/04/22/MySQL/1652086806953.png" alt="1652086806953" loading="lazy"></p>
<p>å®˜ç½‘æç¤ºï¼š<img src="/2022/04/22/MySQL/1652086850681.png" alt="1652086850681" loading="lazy"></p>
<p>è¡¥å……æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install -omysql -gmysql -m0644 /dev/null /var/log/mysqld.log</span><br></pre></td></tr></table></figure>

<p>flush-logsæŒ‡ä»¤æ“ä½œï¼š</p>
<ul>
<li>MySQL5.5.7ä»¥å‰çš„ç‰ˆæœ¬ï¼Œflush-logså°†é”™è¯¯æ—¥å¿—æ–‡ä»¶é‡å‘½åä¸ºfilename.err_oldï¼Œå¹¶åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶</li>
<li>ä»MySQL5.5.7å¼€å§‹ï¼Œflush-logåªæ˜¯é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸åšæ—¥å¿—å¤‡ä»½å’Œåˆ›å»ºçš„æ“ä½œ</li>
<li>å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒMySQLå¯åŠ¨æˆ–æ‰§è¡Œflush-logsæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚é‡æ–°åˆ›å»ºé”™è¯¯æ—¥å¿—ï¼Œå¤§å°ä¸º0å­—èŠ‚ã€‚</li>
</ul>
</li>
</ul>
<h5 id="3-4MySQL8-0æ–°ç‰¹æ€§"><a href="#3-4MySQL8-0æ–°ç‰¹æ€§" class="headerlink" title="3.4MySQL8.0æ–°ç‰¹æ€§"></a>3.4MySQL8.0æ–°ç‰¹æ€§</h5><p>MySQL8.0é‡Œå¯¹é”™è¯¯æ—¥å¿—çš„æ”¹è¿›ã€‚MySQL8.0çš„é”™è¯¯æ—¥å¿—å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…¨æ–°çš„æ—¥å¿—ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬é‡Œï¼Œæ¥å—äº†æ¥è‡ªç¤¾åŒºçš„å¹¿æ³›æ‰¹è¯„æ„è§ï¼Œåœ¨è¿™äº›æ„è§å’Œå»ºè®®çš„åŸºç¡€ä¸Šç”Ÿæˆäº†æ–°çš„æ—¥å¿—ã€‚<img src="/2022/04/22/MySQL/1652087407447.png" alt="1652087407447" loading="lazy"></p>
<blockquote>
<p>å°ç»“ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜ä¸éœ€è¦æŸ¥çœ‹é”™è¯¯ã€‚ä½†æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥ä»é”™è¯¯æ—¥å¿—ä¸­æ‰¾åˆ°å‘ç”Ÿå¼‚å¸¸çš„æ—¶é—´ã€åŸå› ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯æ¥è§£å†³å¼‚å¸¸</p>
</blockquote>
<h4 id="4-äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin-logï¼‰"><a href="#4-äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin-logï¼‰" class="headerlink" title="4.äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰"></a>4.äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰</h4><p>binlogå¯ä»¥è¯´æ˜¯MySQLæ¯”è¾ƒé‡è¦çš„æ—¥å¿—ï¼Œåœ¨æ—¥å¸¸å¼€å‘åŠè¿ç»´ä¸­ï¼Œéƒ½ä¼šé‡åˆ°ã€‚</p>
<p>binlogå³binary logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå«åšå˜æ›´æ—¥å¿—ï¼ˆupdate logï¼‰ã€‚å®ƒè®°å½•äº†æ•°æ®åº“æ‰€æœ‰æ‰§è¡Œçš„DDLå’ŒDMLç­‰æ•°æ®åº“æ›´æ–°äº‹ä»¶çš„è¯­å¥ä½†æ˜¯ä¸åŒ…å«æ²¡æœ‰ä¿®æ”¹ä»»ä½•æ•°æ®çš„è¯­å¥ï¼ˆå¦‚æ•°æ®æŸ¥è¯¢è¯­å¥slectã€showç­‰ï¼‰</p>
<p>å®ƒä»¥<strong>äº‹ä»¶å½¢å¼</strong>è®°å½•å¹¶ä¿å­˜åœ¨<strong>äºŒè¿›åˆ¶æ–‡ä»¶</strong>ä¸­ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥å†ç°æ•°æ®æ›´æ–°æ“ä½œçš„å…¨è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>å¦‚æœæƒ³è¦è®°å½•æ‰€æœ‰è¯­å¥ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†è¯†åˆ«æœ‰é—®é¢˜çš„æŸ¥è¯¢ï¼‰ï¼Œéœ€è¦ä½¿ç”¨é€šç”¨æŸ¥è¯¢æ—¥å¿—</p>
</blockquote>
<p>binlogä¸»è¦åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ä¸€æ˜¯ç”¨äº<strong>æ•°æ®æ¢å¤</strong>ï¼Œå¦‚æœMySQLæ•°æ®åº“æ„å¤–åœæ­¢ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶æ¥æŸ¥çœ‹ç”¨æˆ·æ‰§è¡Œäº†å“ªäº›æ“ä½œï¼Œå¯¹æ•°æ®åº“æœåŠ¡å™¨æ–‡ä»¶åšäº†å“ªäº›ä¿®æ”¹ï¼Œç„¶åæ ¹æ®äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•æ¥æ¢å¤æ•°æ®åº“æœåŠ¡å™¨</li>
<li>è€Œæ˜¯ç”¨äº<strong>æ•°æ®å¤åˆ¶</strong>ï¼Œç”±äºæ—¥å¿—çš„å»¶ç»­æ€§å’Œæ—¶æ•ˆæ€§ï¼ŒmasteræŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™slavesæ¥è¾¾åˆ°master-slavesæ•°æ®ä¸€è‡´çš„ç›®çš„</li>
</ul>
<p>å¯ä»¥è¯´Mysqlæ•°æ®åº“çš„<strong>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</strong>éƒ½ç¦»ä¸å¼€binlogï¼Œéœ€è¦ä¾é binlogæ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><img src="/2022/04/22/MySQL/1652169004023.png" alt="1652169004023" loading="lazy"></p>
<h5 id="4-1æŸ¥çœ‹é»˜è®¤æƒ…å†µ"><a href="#4-1æŸ¥çœ‹é»˜è®¤æƒ…å†µ" class="headerlink" title="4.1æŸ¥çœ‹é»˜è®¤æƒ…å†µ"></a>4.1æŸ¥çœ‹é»˜è®¤æƒ…å†µ</h5><p>æŸ¥çœ‹è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¦å¼€å¯ï¼šåœ¨MySQL8ä¸­é»˜è®¤æƒ…å†µä¸‹ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ—¶å¼€å¯çš„<img src="/2022/04/22/MySQL/1652169192227.png" alt="1652169192227" loading="lazy"></p>
<p><strong>log_bin_basename</strong>:æ˜¯binlogæ—¥å¿—çš„åŸºæœ¬æ–‡ä»¶åï¼Œåé¢ä¼šè¿½åŠ æ ‡è¯†æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªæ–‡ä»¶</p>
<p><strong>log_bin_index</strong>:æ˜¯binlogæ–‡ä»¶çš„ç´¢å¼•æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç®¡ç†äº†æ‰€æœ‰çš„binlogæ–‡ä»¶çš„ç›®å½•</p>
<p><strong>log_bin_trust_function_creators</strong>:é™åˆ¶å­˜å‚¨è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ç”¨äºä¸»ä»å¤åˆ¶ï¼Œè€Œå­˜å‚¨å‡½æ•°æœ‰å¯èƒ½å¯¼è‡´ä¸»ä»çš„æ•°æ®ä¸ä¸€è‡´ã€‚æ‰€ä»¥å½“å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åï¼Œéœ€è¦é™åˆ¶å­˜å‚¨å‡½æ•°çš„åˆ›å»ºã€ä¿®æ”¹ã€è°ƒç”¨</p>
<p><strong>log_bin_use_v1_row_events</strong>:æ­¤åªè¯»å˜é‡å·²æœ‰å¼ƒç”¨ã€‚ONè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬1äºŒè¿›åˆ¶æ—¥å¿—è¡Œï¼ŒOFFè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬2äºŒè¿›åˆ¶æ—¥å¿—è¡Œ(MySQL5.6çš„é»˜è®¤å€¼ä¸º2)</p>
<h5 id="4-2æ—¥å¿—å‚æ•°è®¾ç½®"><a href="#4-2æ—¥å¿—å‚æ•°è®¾ç½®" class="headerlink" title="4.2æ—¥å¿—å‚æ•°è®¾ç½®"></a>4.2æ—¥å¿—å‚æ•°è®¾ç½®</h5><p><strong>æ–¹å¼ä¸€ï¼šæ°¸ä¹…æ€§æ–¹å¼</strong></p>
<p>ä¿®æ”¹MySQLçš„my.cnfæˆ–my.iniæ–‡ä»¶å¯ä»¥è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„ç›¸å…³å‚æ•°ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"><span class="attr">log-bin</span>=atguigu-bin</span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="number">600</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="number">100</span>m</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æç¤ºï¼š</p>
<ul>
<li>log-bin=mysql-bin #æ‰“å¼€æ—¥å¿—(ä¸»æœºéœ€è¦æ‰“å¼€)ï¼Œè¿™ä¸ªmysql-binä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥åŠ ä¸Šè·¯å¾„ï¼Œå¦‚ï¼š/home/www/mysql_bin_log/mysql-bin</li>
<li>binlog_expire_logs_seconds:æ­¤å‚æ•°æ§åˆ¶äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤2592000 30å¤©â€“14400 4å°æ—¶ï¼›86400 1å¤©ï¼›259200 3å¤©</li>
<li>max_binlog_size:æ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ï¼Œå½“å‰æ—¥å¿—æ–‡ä»¶å¤§å°è¶…è¿‡æ­¤å˜é‡æ—¶ï¼Œæ‰§è¡Œåˆ‡æ¢åŠ¨ä½œã€‚æ­¤å‚æ•°çš„<strong>æœ€å¤§å’Œé»˜è®¤å€¼æ˜¯1GB</strong>ï¼Œè¯¥è®¾ç½®<strong>å¹¶ä¸èƒ½ä¸¥æ ¼æ§åˆ¶Binlogçš„å¤§å°</strong>ï¼Œå°¤å…¶æ˜¯Binlogæ¥è¿‘æœ€å¤§å€¼è€Œåˆé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„äº‹åŠ¡æ—¶ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„å®Œæ•´æ€§ï¼Œå¯èƒ½ä¸åšåˆ‡æ¢æ—¥å¿—çš„åŠ¨ä½œï¼Œåªèƒ½å°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰SQLéƒ½è®°å½•è¿›å½“å‰æ—¥å¿—ï¼ŒçŸ¥é“äº‹åŠ¡ç»“æŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¯é‡‡å–é»˜è®¤å€¼</li>
</ul>
</blockquote>
<p>é‡æ–°å¯åŠ¨MySQLæœåŠ¡ï¼ŒæŸ¥è¯¢äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯ï¼Œæ‰§è¡Œç»“æœï¼š<img src="/2022/04/22/MySQL/1652170474789.png" alt="1652170474789" loading="lazy"></p>
<p><strong>è®¾ç½®å¸¦æ–‡ä»¶å¤¹çš„bin-logæ—¥å¿—å­˜æ”¾è®°å½•</strong></p>
<p>å¦‚æœæƒ³æ”¹å˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•å’Œåç§°ï¼Œå¯ä»¥å¯¹my.cnfæˆ–my.iniä¸­çš„log_binå‚æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">&quot;/var/lib/mysqld/binlog/atguigu-bin&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ–°å»ºçš„æ–‡ä»¶å¤¹éœ€è¦ä½¿ç”¨mysqlç”¨æˆ·ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R -v mysql:mysql binlog </span><br></pre></td></tr></table></figure>

<p>é‡å¯MySQLæœåŠ¡å™¨åï¼Œæ–°çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å°†å‡ºç°åœ¨/var/lib/mysql/binlog/æ–‡ä»¶å¤¹ä¸‹é¢<img src="/2022/04/22/MySQL/1652170745354.png" alt="1652170745354" loading="lazy"></p>
<blockquote>
<p>æç¤º</p>
<p><strong>æ•°æ®åº“æ–‡ä»¶æœ€å¥½ä¸è¦ä¸æ—¥å¿—æ–‡ä»¶æ”¾åœ¨åŒä¸€ç£ç›˜ä¸Š</strong>è¿™æ ·ï¼Œå½“æ•°æ®åº“æ–‡ä»¶æ‰€åœ¨ç£ç›˜å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ—¥å¿—æ–‡ä»¶æ¢å¤æ•°æ®</p>
</blockquote>
<p><strong>æ–¹å¼äºŒï¼šä¸´æ—¶æ€§æ–¹å¼</strong></p>
<p>å¦‚æœä¸å¸Œæœ›é€šè¿‡ä¿®æ”¹æ–‡ä»¶å¹¶é‡å¯çš„æ–¹å¼è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„è¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨mysql8ä¸­åªæœ‰ä¼šè¯çº§åˆ«çš„è®¾ç½®ï¼Œæ²¡æœ‰äº†globalçº§åˆ«çš„è®¾ç½®<img src="/2022/04/22/MySQL/1652173036069.png" alt="1652173036069" loading="lazy"></p>
<h5 id="4-3æŸ¥çœ‹æ—¥å¿—"><a href="#4-3æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="4.3æŸ¥çœ‹æ—¥å¿—"></a>4.3æŸ¥çœ‹æ—¥å¿—</h5><p>å½“MySQLåˆ›å»ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ï¼Œä»¥â€œ.indexâ€ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªä»¥â€œfilenameâ€ä¸ºåç§°ã€ä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶ã€‚</p>
<p>MySQLæœåŠ¡é‡å¯ä¸€æ¬¡ï¼Œä»¥â€œ.000001â€ä¸ºåç¼€çš„æ–‡ä»¶å°±ä¼šå¢åŠ ä¸€ä¸ªï¼Œå¹¶ä¸”åç¼€åæŒ‰1é€’å¢ã€‚å³æ—¥å¿—æ–‡ä»¶çš„ä¸ªæ•°ä¸MySQLæœåŠ¡å¯åŠ¨çš„æ¬¡æ•°ç›¸åŒã€‚å¦‚æœæ—¥å¿—é•¿åº¦è¶…è¿‡äº†max_binlog_sizeçš„ä¸Šé™(é»˜è®¤å€¼1GB)ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>æŸ¥çœ‹å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨åŠå¤§å°ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652173276644.png" alt="1652173276644" loading="lazy"></p>
<p>æ‰€æœ‰å¯¹æ•°æ®åº“çš„ä¿®æ”¹éƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚ä½†binlogæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ï¼Œæƒ³è¦æ›´ç›´è§‚çš„è§‚æµ‹å°±è¦å€ŸåŠ©mysqlbinlogå‘½ä»¤å·¥å…·ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼Œå†æŸ¥çœ‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œä¸€æ¡sqlè¯­å¥ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update student set name=&#x27;å¼ ä¸‰_back&#x27; where id=1;</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹æŸ¥çœ‹binlog<img src="/2022/04/22/MySQL/1652173558534.png" alt="1652173558534" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652173592799.png" alt="1652173592799" loading="lazy"></p>
<p>æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—ä¸­è®°å½•äº†ç”¨æˆ·çš„ä¸€äº›æ“ä½œï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°å…·ä½“çš„SQLè¯­å¥ï¼Œè¿™æ˜¯å› ä¸ºbinlogå…³é”®å­—åé¢çš„å†…å®¹æ˜¯ç»è¿‡ç¼–ç åçš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚<img src="/2022/04/22/MySQL/1652173669364.png" alt="1652173669364" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652173708240.png" alt="1652173708240" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652173731122.png" alt="1652173731122" loading="lazy"></p>
<p>å‰é¢çš„å‘½ä»¤åŒæ—¶æ˜¾ç¤ºbinlogæ ¼å¼çš„è¯­å¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸æ˜¾ç¤ºå®ƒ<img src="/2022/04/22/MySQL/1652173783442.png" alt="1652173783442" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652173794633.png" alt="1652173794633" loading="lazy"></p>
<p>å…³äºmysqlbinlogå·¥å…·çš„ä½¿ç”¨æŠ€å·§è¿˜æœ‰å¾ˆå¤šï¼Œ<img src="/2022/04/22/MySQL/1652173831831.png" alt="1652173831831" loading="lazy"></p>
<p>ä¸Šé¢è¿™ç§åŠæ³•è¯»å–å‡ºbinlogæ—¥å¿—çš„å…¨æ–‡å†…å®¹æ¯”è¾ƒå¤šï¼Œä¸å®¹æ˜“åˆ†è¾¨æŸ¥çœ‹åˆ°posç‚¹ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯æ–¹ä¾¿æŸ¥è¯¢çš„å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events [IN &#x27;log_name&#x27;] [FROM pos] [LIMIT [offset,] row_count];</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652173949806.png" alt="1652173949806" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652174650001.png" alt="1652174650001" loading="lazy"></p>
<p>ä¸€ä¸ªupdateè¯­å¥åŒ…å«å¦‚ä¸‹äº‹ä»¶ï¼š</p>
<ul>
<li>Queryäº‹ä»¶è´Ÿè´£å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼ˆBEGINï¼‰</li>
<li>Table_mapäº‹ä»¶ è´Ÿè´£æ˜ å°„éœ€è¦çš„è¡¨</li>
<li>Update_rowsäº‹ä»¶ è´Ÿè´£å†™å…¥æ•°æ®</li>
<li>Xidäº‹ä»¶ è´Ÿè´£ç»“æŸäº‹åŠ¡</li>
</ul>
<p>ä¸Šé¢è®²çš„éƒ½ä½¿åŸºäºbinlogçš„é»˜è®¤æ ¼å¼ï¼Œbinlogæ ¼å¼æŸ¥çœ‹</p>
<p><img src="/2022/04/22/MySQL/1652174882766.png" alt="1652174882766" loading="lazy"></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œbinlogè¿˜æœ‰2ç§æ ¼å¼ï¼Œåˆ†åˆ«æ˜¯srarementå’ŒMixed</p>
<ul>
<li><p>Statement</p>
<p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ï¼Œä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½</p>
</li>
<li><p>Row</p>
<p><img src="/2022/04/22/MySQL/1652174991719.png" alt="1652174991719" loading="lazy"></p>
</li>
<li><p>Mixed</p>
<p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementå’ŒRowçš„ç»“åˆ</p>
</li>
</ul>
<h5 id="4-4ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®"><a href="#4-4ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®" class="headerlink" title="4.4ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®"></a>4.4ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®</h5><p>å¦‚æœMySQLæœåŠ¡å™¨å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ï¼Œåœ¨æ•°æ®åº“å‡ºç°æ„å¤–ä¸¢å¤±æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MySQLbinlogå·¥å…·ä»æŒ‡å®šæ—¶é—´ç‚¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœ€åä¸€æ¬¡å¤‡ä»½ï¼‰ç›´åˆ°ç°åœ¨ï¼Œæˆ–å¦ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹çš„æ—¥å¿—ä¸­æ¢å¤æ•°æ®ã€‚</p>
<p>mysqlbinlogæ¢å¤æ•°æ®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog ã€optionã€‘ filename|mysql -uuser -ppass</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è¿™æ ·ç†è§£ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤æ¥è¯»å–filenameä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨mysqlå‘½ä»¤å°†è¿™äº›å†…å®¹æ¢å¤åˆ°æ•°æ®åº“</p>
<ul>
<li>filenameï¼šæ˜¯æ—¥å¿—æ–‡ä»¶å</li>
<li>optionï¼šå¯é€‰é¡¹ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸¤å¯¹optionå‚æ•°æ˜¯â€“start-dateã€â€“stop-dateå’Œâ€“start-positionã€â€“stop-positionã€‚<ul>
<li>â€“start-dateå’Œ-stop-dateï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®åº“çš„èµ·å§‹æ—¶é—´ç‚¹å’Œç»“æŸæ—¶é—´ç‚¹</li>
<li>â€“start-positionå’Œâ€“stop-positionï¼šå¯ä»¥æŒ‡å®šæ¢å¤æ•°æ®çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨mysqlbinlogå‘½ä»¤è¿›è¡Œæ¢å¤æ“ä½œæ—¶ï¼Œå¿…é¡»æ˜¯ç¼–å·å°çš„å…ˆæ¢å¤ï¼Œä¾‹å¦‚atguigu-bin.000001å¿…é¡»åœ¨atguigu-bin.000002ä¹‹å‰</p>
</blockquote>
<h5 id="4-5åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—"><a href="#4-5åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="4.5åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—"></a>4.5åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—</h5><p>MySQLçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é…ç½®è‡ªåŠ¨åˆ é™¤ï¼ŒåŒæ—¶MySQLä¹Ÿæä¾›äº†å®‰å…¨çš„æ‰‹åŠ¨åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚PURGE MASTER LOGSåªèƒ½åˆ é™¤æŒ‡å®šéƒ¨åˆ†çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼ŒREST MASTERåˆ é™¤æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<p><strong>1.PURGE MASTER LOGSï¼šåˆ é™¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶</strong></p>
<p>PURGE MASTER LOGSè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PURGE &#123;MASTER | BINARY&#125; LOGS TO &#x27;æŒ‡å®šæ—¥å¿—æ–‡ä»¶å&#x27;</span><br><span class="line">PURGE &#123;MASTER | BINARY&#125; LOGS BEFORE &#x27;æŒ‡å®šæ—¥æœŸ&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸¾ä¾‹</strong>ï¼šä½¿ç”¨PURGE MASTER LOGSè¯­å¥åˆ é™¤åˆ›å»ºæ—¶é—´æ¯”binlog.000005æ—©çš„æ‰€æœ‰æ—¥å¿—</p>
<p>ï¼ˆ1ï¼‰å¤šæ¬¡é‡æ–°å¯åŠ¨MySQLæœåŠ¡ï¼Œä¾¿äºç”Ÿæˆå¤šä¸ªæ—¥å¿—æ–‡ä»¶ã€‚ç„¶åç”¨SHOWè¯­å¥æ˜¾ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINARY LOGS</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ‰§è¡ŒPURGE BINARY LOGSè¯­å¥åˆ é™¤åˆ›å»ºæ—¶é—´æ¯”binlog.000005æ—©çš„æ‰€æœ‰æ—¥å¿—</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PURGE BINARY LOGS TO &quot;binlog.000005&quot;;</span><br></pre></td></tr></table></figure>

<p>(3) æ˜¾ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINARY LOGS</span><br></pre></td></tr></table></figure>

<p>æ¯”binlog.000005æ—©çš„æ‰€æœ‰æ—¥å¿—æ–‡ä»¶å¤šå·²ç»è¢«åˆ é™¤äº†ã€‚</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>ä½¿ç”¨PURGE MASTER LOGSè¯­å¥åˆ é™¤2020å¹´10æœˆ25æ—¥å‰åˆ›å»ºçš„æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ã€‚</p>
<p>ï¼ˆ1ï¼‰æ˜¾ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINARY LOGS</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ‰§è¡Œmysqlbinlogå‘½ä»¤æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶binlog.000005çš„å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults &quot;/var/lib/mysql/binlog/atguigu.000005&quot;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰ä½¿ç”¨PURGE MASTER LOGSè¯­å¥åˆ é™¤2022.01.05å‰åˆ›å»ºçš„æ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PURGE MASTER LOGS brfore &quot;20220105&quot;;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰æ˜¾ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINARY LOGS;</span><br></pre></td></tr></table></figure>

<p>20220105å‰çš„éƒ½è¢«åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ²¡æœ‰åˆ é™¤ï¼Œå› ä¸ºå½“å‰å†ç”¨ï¼Œè¿˜æœªè®°å½•æœ€åçš„æ—¶é—´ï¼Œæ‰€ä»¥æ²¡æœ‰åˆ é™¤</p>
<p><strong>2.RESET MASTER:åˆ é™¤æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong></p>
<p>ä½¿ç”¨RESET MASTERè¯­å¥åˆ é™¤æ‰€æœ‰çš„binlogæ—¥å¿—ã€‚MySQLä¼šé‡æ–°åˆ›å»ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ–°çš„æ—¥å¿—æ–‡ä»¶æ‰©å±•åå°†é‡æ–°ä»000001å¼€å§‹ç¼–å·ã€‚<strong>æ…ç”¨ï¼</strong></p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>ä½¿ç”¨RESET MASTERè¯­å¥åˆ é™¤æ‰€æœ‰æ—¥å¿—æ–‡ä»¶</p>
<p>ï¼ˆ1ï¼‰é‡å¯MySQLæœåŠ¡å™¨è‹¥å¹²æ¬¡ï¼Œæ‰§è¡ŒSHOWè¯­å¥æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINARY LOGS</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ‰§è¡ŒRESET MASTERè¯­å¥ï¼Œåˆ é™¤æ‰€æœ‰æ—¥å¿—æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RESET MASTER;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®Œè¯¥è¯­å¥åï¼ŒåŸæ¥çš„æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—å·²ç»å…¨éƒ¨è¢«åˆ é™¤ã€‚</p>
<h5 id="4-6å…¶ä»–åœºæ™¯"><a href="#4-6å…¶ä»–åœºæ™¯" class="headerlink" title="4.6å…¶ä»–åœºæ™¯"></a>4.6å…¶ä»–åœºæ™¯</h5><p>äºŒè¿›åˆ¶æ—¥å¿—å¯ä»¥é€šè¿‡æ•°æ®åº“çš„<strong>å…¨é‡å¤‡ä»½</strong>å’ŒäºŒè¿›åˆ¶ä¸­ä¿å­˜çš„<strong>å¢é‡ä¿¡æ¯</strong>å®Œæˆæ•°æ®åº“çš„<strong>æ— æŸå¤±æ¢å¤</strong>ã€‚ä½†æ˜¯ï¼Œå¦‚æœé‡åˆ°æ•°æ®é‡å¤§ã€æ•°æ®åº“å’Œæ•°æ®è¡¨å¾ˆå¤šï¼ˆæ¯”å¦‚åˆ†åº“åˆ†è¡¨çš„åº”ç”¨ï¼‰çš„åœºæ™¯ï¼Œç”¨äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œæ•°æ®æ¢å¤ï¼Œæ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œå› ä¸ºèµ·æ­¢ä½ç½®ä¸å®¹æ˜“ç®¡ç†ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•æ˜¯é…ç½®<strong>ä¸»ä»æ•°æ®åº“æœåŠ¡å™¨</strong>ï¼Œç”šè‡³æ˜¯ä¸€ä¸»å¤šä»çš„æ¶æ„ï¼ŒæŠŠäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å†…å®¹é€šè¿‡ä¸­ç»§æ—¥å¿—ï¼ŒåŒæ­¥å¤§ä»æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…æ•°æ®åº“æ•…éšœå¯¼è‡´çš„æ•°æ®å¼‚å¸¸ç­‰é—®é¢˜</p>
<h4 id="5-ï¼ˆé‡ç‚¹ï¼‰å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog"><a href="#5-ï¼ˆé‡ç‚¹ï¼‰å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—-binlog" class="headerlink" title="5.ï¼ˆé‡ç‚¹ï¼‰å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)"></a>5.ï¼ˆé‡ç‚¹ï¼‰å†è°ˆäºŒè¿›åˆ¶æ—¥å¿—(binlog)</h4><h5 id="5-1å†™å…¥æœºåˆ¶"><a href="#5-1å†™å…¥æœºåˆ¶" class="headerlink" title="5.1å†™å…¥æœºåˆ¶"></a>5.1å†™å…¥æœºåˆ¶</h5><p>binlogçš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™é“binlogæ–‡ä»¶ä¸­ã€‚å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„çš„binlogä¸èƒ½æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå¿«å†…å­˜ä½œä¸ºbinlog cacheã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>binlog_cache_size</strong>å‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹binlog cacheå¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆSwapï¼‰ã€‚binlogæ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652342298513.png" alt="1652342298513" loading="lazy"></p>
<blockquote>
<ul>
<li>ä¸Šå›¾çš„writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«</li>
<li>ä¸Šå›¾çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ</li>
</ul>
</blockquote>
<p>writeå’Œfsyncçš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•°<strong>syn_binlog</strong>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯0ã€‚ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œfsyncã€‚è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯åŠå…¶å®•æœºï¼Œpage cacheé‡Œçš„binlogä¼šä¸¢å¤±ã€‚å¦‚ä¸‹å›¾ï¼š<img src="/2022/04/22/MySQL/1652342452791.png" alt="1652342452791" loading="lazy"></p>
<p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šfsyncï¼Œå°±å¦‚åŒ<strong>redo logåˆ·ç›˜ç­–ç•¥ä¸€æ ·</strong>ã€‚æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸ºNï¼ˆN&gt;1ï¼‰ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚<img src="/2022/04/22/MySQL/1652342593186.png" alt="1652342593186" loading="lazy"></p>
<p>åœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p>
<h5 id="5-2binlogä¸redologå¯¹æ¯”"><a href="#5-2binlogä¸redologå¯¹æ¯”" class="headerlink" title="5.2binlogä¸redologå¯¹æ¯”"></a>5.2binlogä¸redologå¯¹æ¯”</h5><ul>
<li>redo log æ˜¯<strong>ç‰©ç†æ—¥å¿—</strong>ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äºInnoDBå­˜å‚¨å¼•æ“å±‚äº§ç”Ÿçš„</li>
<li>bin log æ˜¯<strong>é€»è¾‘æ—¥å¿—</strong>ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™IDä¸º2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1â€ï¼Œå±äºMySQL Serverå±‚</li>
<li>redoæ˜¯å¾ªç¯å†™å…¥ï¼Œå…¨éƒ¨å†™æ»¡å°±ä»å¤´å¼€å§‹</li>
<li>binlogæ˜¯è¿½åŠ å†™ï¼Œå†™æ»¡åˆ™åˆ›å»ºæ–°æ–‡ä»¶å†™å…¥</li>
<li>è™½ç„¶ä»–ä»¬éƒ½å±äºæŒä¹…åŒ–ç‰¹å¾ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚<ul>
<li>redo log è®©InnoDBå­˜å‚¨å¼•æ“æ‹¥æœ‰äº†æ•°æ®å´©æºƒæ¢å¤èƒ½åŠ›</li>
<li>bin log ä¿è¯äº†MySQLé›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
</ul>
<h5 id="5-3ä¸¤é˜¶æ®µæäº¤"><a href="#5-3ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="5.3ä¸¤é˜¶æ®µæäº¤"></a>5.3ä¸¤é˜¶æ®µæäº¤</h5><p><img src="/2022/04/22/MySQL/1652344319600.png" alt="1652344319600" loading="lazy"></p>
<p>åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•redo logä¸binlogä¸¤å—æ—¥å¿—ï¼Œä»¥äº‹åŠ¡ä¸ºåŸºæœ¬å•ä½ï¼Œredo logåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œbinglogåªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥redo logä¸binlogçš„<strong>å†™å…¥æ—¶æœº</strong>ä¸ä¸€æ ·</p>
<p><img src="/2022/04/22/MySQL/1652344953665.png" alt="1652344953665" loading="lazy"></p>
<p><strong>redo logä¸binlogä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<p>ä»¥updateè¯­å¥ä¸ºä¾‹ï¼Œå‡è®¾id=2çš„è®°å½•ï¼Œå­—æ®µcå€¼æ˜¯0ï¼ŒæŠŠå­—æ®µcå€¼æ›´æ–°æˆ1ï¼ŒSQLè¯­å¥ä¸ºupdate T set c=1 where id=2.</p>
<p>å‡è®¾æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œredo logæ—¥å¿—åï¼Œbinlogæ—¥å¿—å†™æœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ<img src="/2022/04/22/MySQL/1652345215447.png" alt="1652345215447" loading="lazy"></p>
<p>ç”±äºbinlogæ²¡å†™å®Œå‡ºç°å¼‚å¸¸ï¼Œè¿™æ—¶å€™binlogé‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•ã€‚å› æ­¤ï¼Œä¹‹åç”¨binlogæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±ä¼šå‡å°‘è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œcå€¼æ˜¯0ï¼Œè€ŒåŸåº“å› ä¸ºredo logæ—¥å¿—æ¢å¤è¿™ä¸€è¡Œæ˜¯1ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ã€‚<img src="/2022/04/22/MySQL/1652345400446.png" alt="1652345400446" loading="lazy"></p>
<p>ä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>æ–¹æ¡ˆã€‚åŸç†å¾ˆç®€å•ï¼Œå°†redo logçš„å†™å…¥æ‹†æˆä¸¤ä¸ªæ­¥éª¤<strong>prepare</strong>å’Œ<strong>commit</strong>ï¼Œè¿™å°±æ˜¯<strong>ä¸¤é˜¶æ®µæäº¤</strong><img src="/2022/04/22/MySQL/1652345657788.png" alt="1652345657788" loading="lazy"></p>
<p>ä½¿ç”¨<strong>ä¸¤é˜¶æ®µæäº¤</strong>åï¼Œå†™å…¥binlogæ—¶å‘ç°å¼‚å¸¸ä¹Ÿä¸ä¼šç”±å½±å“ï¼Œå› ä¸ºMySQLæ ¹æ®redo logæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°redo logè¿˜å¤„äºprepareé˜¶æ®µï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”binglogæ—¥å¿—ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚<img src="/2022/04/22/MySQL/1652345739133.png" alt="1652345739133" loading="lazy"></p>
<p>å¦ä¸€ä¸ªåœºæ™¯ï¼Œredo logè®¾ç½®commité˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šä¸ä¼šå›æ»šäº‹åŠ¡ï¼Ÿ<img src="/2022/04/22/MySQL/1652345887656.png" alt="1652345887656" loading="lazy"></p>
<p>å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œä»–ä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶redo logæ˜¯å¤„äºprepareé˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡idæ‰¾åˆ°å¯¹åº”çš„binglogæ—¥å¿—ï¼Œæ‰€ä»¥MySQLè®¤ä¸ºæ˜¯å®Œæ•´çš„ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚</p>
<h4 id="6-ä¸­ç»§æ—¥å¿—"><a href="#6-ä¸­ç»§æ—¥å¿—" class="headerlink" title="6.ä¸­ç»§æ—¥å¿—"></a>6.ä¸­ç»§æ—¥å¿—</h4><h5 id="6-1ä»‹ç»"><a href="#6-1ä»‹ç»" class="headerlink" title="6.1ä»‹ç»"></a>6.1ä»‹ç»</h5><p><strong>ä¸­ç»§æ—¥å¿—åªåœ¨ä¸»ä»æœåŠ¡å™¨æ¶æ„çš„ä»æœåŠ¡å™¨ä¸Šå­˜åœ¨ã€‚</strong>ä»æœåŠ¡å™¨ä¸ºäº†ä¸ä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œè¦ä»ä¸»æœåŠ¡å™¨è¯»å–äºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠè¯»å–åˆ°çš„ä¿¡æ¯å†™å…¥<strong>æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶</strong>ä¸­ï¼Œè¿™ä¸ªä»æœåŠ¡å™¨æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶å«<strong>ä¸­ç»§æ—¥å¿—</strong>ã€‚ç„¶åï¼Œä»æœåŠ¡å™¨è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶æ ¹æ®ä¸­ç»§æ—¥å¿—çš„å†…å®¹å¯¹ä»æœåŠ¡å™¨çš„æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œå®Œæˆä»æœåŠ¡å™¨çš„<strong>æ•°æ®åŒæ­¥</strong>ã€‚</p>
<p>æ­å»ºå¥½åä¸»ä»æœåŠ¡å™¨ä¹‹åï¼Œä¸­ç»§æ—¥å¿—é»˜è®¤ä¼šä¿å­˜åœ¨ä»æœåŠ¡å™¨çš„æ•°æ®ç›®å½•ä¸‹ã€‚</p>
<p>æ–‡ä»¶åçš„æ ¼å¼æ˜¯ï¼š<strong>ä»æœåŠ¡å™¨å -relay-bin.åºå·</strong>ã€‚ä¸­ç»§æ—¥å¿—è¿˜æœ‰ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼š<strong>ä»æœåŠ¡å™¨å -relay-bin.index</strong>ï¼Œç”¨æ¥å®šä½å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸­çº§æ—¥å¿—ã€‚</p>
<h5 id="6-2æŸ¥çœ‹ä¸­ç»§æ—¥å¿—"><a href="#6-2æŸ¥çœ‹ä¸­ç»§æ—¥å¿—" class="headerlink" title="6.2æŸ¥çœ‹ä¸­ç»§æ—¥å¿—"></a>6.2æŸ¥çœ‹ä¸­ç»§æ—¥å¿—</h5><p>ä¸­ç»§æ—¥å¿—ä¸äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ç›¸åŒï¼Œå¯ä»¥ç”¨mysqlbinlogå·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚ä¸‹é¢æ˜¯ä¸­ç»§æ—¥å¿—çš„ä¸€ä¸ªç‰‡æ®µï¼š<img src="/2022/04/22/MySQL/1652346900849.png" alt="1652346900849" loading="lazy"></p>
<p>è¿™ä¸€æ®µçš„æ„æ€æ˜¯ï¼Œä¸»æœåŠ¡å™¨ï¼ˆâ€œserver id 1â€ï¼‰å¯¹è¡¨atguigu.testè¿›è¡Œäº†2æ­¥æ“ä½œï¼š<img src="/2022/04/22/MySQL/1652346954347.png" alt="1652346954347" loading="lazy"></p>
<h5 id="6-3æ¢å¤çš„å…¸å‹é”™è¯¯"><a href="#6-3æ¢å¤çš„å…¸å‹é”™è¯¯" class="headerlink" title="6.3æ¢å¤çš„å…¸å‹é”™è¯¯"></a>6.3æ¢å¤çš„å…¸å‹é”™è¯¯</h5><p>å¦‚æœä»æœåŠ¡å™¨å®•æœºï¼Œæœ‰çš„æ—¶å€™ä¸ºäº†ç³»ç»Ÿæ¢å¤ï¼Œè¦é‡è£…ç³»ç»Ÿï¼Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´ä½ çš„<strong>æœåŠ¡å™¨åç§°ä¸ä¹‹å‰ä¸åŒ</strong>ã€‚è€Œä¸­ç»§æ—¥å¿—é‡Œæ˜¯<strong>åŒ…å«ä»æœåŠ¡å™¨å</strong>çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å¯¼è‡´æ¢å¤ä»æœåŠ¡å™¨æ—¶ï¼Œæ— æ³•ä»å®•æœºå‰çš„ä¸­ç»§æ—¥å¿—é‡Œè¯»å–æ•°æ®ï¼Œä»¥ä¸ºæ˜¯æ—¥å¿—æ–‡ä»¶æŸåäº†ï¼Œå…¶å®æ˜¯åç§°ä¸å¯¹äº†ã€‚</p>
<p>è§£å†³åŠæ³•ï¼ŒæŠŠä»æœåŠ¡å™¨çš„åç§°æ”¹å›ä¹‹å‰çš„åç§°ã€‚</p>
<h2 id="å°é”"><a href="#å°é”" class="headerlink" title="å°é”"></a>å°é”</h2><p><strong>äº‹åŠ¡çš„éš”ç¦»æ€§ç”±é”æ¥å®ç°</strong></p>
<blockquote>
<p>é”çš„ç²’åº¦</p>
</blockquote>
<p>MySQLæä¾›äº†ä¸¤ç§é”ï¼šè¡Œçº§é”å’Œè¡¨çº§é”ã€‚</p>
<p>é€‰æ‹©æ—¶ï¼Œåº”å°½é‡åªé”éœ€è¦ä¿®æ”¹çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„èµ„æºï¼Œé”å®šçš„æ•°é‡è¶Šå°‘ï¼Œå¹¶å‘åº¦è¶Šé«˜ï¼Œå‘ç”Ÿé”çš„äº‰ç”¨è¶Šå°‘ã€‚</p>
<p>ä½†æ˜¯åŠ é”éœ€è¦æ¶ˆè€—èµ„æºï¼Œæ‰€å¾—å„ç§æ“ä½œï¼ˆåŒ…æ‹¬è·å–é”ã€é‡Šæ”¾é”ä»¥åŠæ£€æŸ¥é”çš„çŠ¶ä½“ï¼‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼Œå› æ­¤é”çš„ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿå¼€é”€è¶Šå¤§ã€‚åœ¨é€‰æ‹©æ—¶éœ€è¦åœ¨é”å¼€é”€å’Œå¹¶å‘ç¨‹åº¦é—´åšæƒè¡¡ ã€‚</p>
<h3 id="é”ç±»å‹"><a href="#é”ç±»å‹" class="headerlink" title="é”ç±»å‹"></a>é”ç±»å‹</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/SnailMann/article/details/88353099">https://blog.csdn.net/SnailMann/article/details/88353099</a></p>
<hr>
<p>1.è¯»å†™é”</p>
<ul>
<li>äº’æ–¥é”ï¼Œç®€å†™ä¸ºXé”ï¼Œåˆç§°å†™é”</li>
<li>å…±äº«é”ï¼Œç®€å†™ä¸ºSé”ï¼Œåˆç§°è¯»é”</li>
</ul>
<p>è§„å®šï¼š</p>
<ul>
<li>ä¸€ä¸ªäº‹ç‰©å¯¹æ•°æ®AåŠ äº†Xé”ï¼Œå°±å¯ä»¥å¯¹æ•°æ®Aè¿›è¡Œè¯»å–å’Œæ›´æ–°ï¼ŒåŠ é”æœŸé—´ä¸èƒ½å¯¹AåŠ ä»»ä½•é”</li>
<li>ä¸€ä¸ªäº‹ç‰©å¯¹æ•°æ®å¯¹è±¡AåŠ äº†Sé”ï¼Œå¯ä»¥å¯¹Aè¿›è¡Œè¯»å–æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œæ›´æ–°ï¼ŒåŠ é”æœŸé—´å…¶ä»–äº‹ç‰©å¯ä»¥å¯¹æ•°æ®å¯¹è±¡AåŠ Sé”ï¼Œä½†ä¸èƒ½åŠ Xé”</li>
</ul>
<p> <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231333532333737372e706e67.png" alt="img" loading="lazy"> </p>
<p>2.æ„å‘é”</p>
<p>ä½¿ç”¨æ„å‘é”ï¼Œå¯ä»¥æ›´å®¹æ˜“çš„æ”¯æŒå¤šç²’åº¦å°é”ã€‚</p>
<p> åœ¨å­˜åœ¨è¡Œçº§é”å’Œè¡¨çº§é”çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œå°±éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A æˆ–è€…è¡¨ A ä¸­çš„ä»»æ„ä¸€è¡ŒåŠ äº†é”ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹è¡¨ A çš„æ¯ä¸€è¡Œéƒ½æ£€æµ‹ä¸€æ¬¡ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚ </p>
<p>æ„å‘é”åœ¨åŸæ¥çš„X/Sé”åŸºç¡€ä¸Šå¼•å…¥äº†IS/IXé”ï¼Œä¸¤è€…éƒ½æ˜¯è¡¨é”ï¼Œè¡¨ç¤ºï¼š</p>
<ul>
<li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ S é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”æˆ–è€…æ›´å¼ºçš„é”ï¼›</li>
<li>ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ X é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚</li>
</ul>
<p>é€šè¿‡å¼•å…¥æ„å‘é”ï¼Œäº‹ç‰©Tæƒ³è¦å¯¹è¡¨AåŠ Xé”ï¼Œåªéœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äº‹ç‰©å¯¹è¡¨AåŠ äº†X/IX/S/ISé”ï¼Œå¦‚æœåŠ äº†å°±è¡¨ç¤ºæœ‰å…¶ä»–äº‹ç‰©æ­£åœ¨ä½¿ç”¨è¡¨æˆ–è¡¨ä¸­çš„ä¸€è¡Œï¼Œå› æ­¤äº‹ç‰©TåŠ é”å¤±è´¥</p>
<p> <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373231343434323638372e706e67.png" alt="img" loading="lazy"> </p>
<ul>
<li>ä»»æ„ IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬åªè¡¨ç¤ºæƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè€Œä¸æ˜¯çœŸæ­£åŠ é”ï¼›</li>
<li>è¿™é‡Œå…¼å®¹å…³ç³»é’ˆå¯¹çš„æ˜¯è¡¨çº§é”ï¼Œè€Œè¡¨çº§çš„ IX é”å’Œè¡Œçº§çš„ X é”å…¼å®¹ï¼Œä¸¤ä¸ªäº‹åŠ¡å¯ä»¥å¯¹ä¸¤ä¸ªæ•°æ®è¡ŒåŠ  X é”ã€‚ï¼ˆäº‹åŠ¡ T1 æƒ³è¦å¯¹æ•°æ®è¡Œ R1 åŠ  X é”ï¼Œäº‹åŠ¡ T2 æƒ³è¦å¯¹åŒä¸€ä¸ªè¡¨çš„æ•°æ®è¡Œ R2 åŠ  X é”ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½éœ€è¦å¯¹è¯¥è¡¨åŠ  IX é”ï¼Œä½†æ˜¯ IX é”æ˜¯å…¼å®¹çš„ï¼Œå¹¶ä¸” IX é”ä¸è¡Œçº§çš„ X é”ä¹Ÿæ˜¯å…¼å®¹çš„ï¼Œå› æ­¤ä¸¤ä¸ªäº‹åŠ¡éƒ½èƒ½åŠ é”æˆåŠŸï¼Œå¯¹åŒä¸€ä¸ªè¡¨ä¸­çš„ä¸¤ä¸ªæ•°æ®è¡Œåšä¿®æ”¹ã€‚ï¼‰</li>
</ul>
<p>3.InnoDBå­˜å‚¨å¼•æ“è¡Œé”çš„ä¸‰ç§å®ç°</p>
<p>record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”</p>
<p>gap lockï¼šé—´æ­‡é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</p>
<p>next-key lockï¼šrecord lock+gapé”å®šä¸€ä¸ªèŒƒå›´åŒ…æ‹¬è®°å½•æœ¬èº«</p>
<p>4.ä¹è§‚é”å’Œæ‚²è§‚é”</p>
<p>å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰çš„é”ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³</p>
<p>æ‚²è§‚é”ï¼šæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ŒæŒä¸€ç§æ¶ˆææ€åº¦ï¼Œé»˜è®¤æ•°æ®è¢«è®¿é—®æ—¶ï¼Œä¼šå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥åœ¨å¤„ç†æ•°æ®æ•´ä¸ªè¿‡ç¨‹åŠ é”çŠ¶æ€</p>
<p>ä¹è§‚é”ï¼šä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œå¹¶å‘ç¯å¢ƒä¸­å§‹ç»ˆè®¤ä¸ºå¯¹æ•°æ®çš„æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªï¼Œåœ¨å¯¹äº‹ç‰©æ›´æ–°æäº¤æ—¶ï¼Œæ‰åˆ¤æ–­æ˜¯å¦å‘ç”Ÿå†²çª</p>
<p>5.è¡Œé”ã€è¡¨é”ä¸é¡µé”</p>
<ul>
<li>è¡¨çº§é”å®šï¼šMySQLä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§ï¼Œè¡¨ç¤ºå¯¹å½“å‰è¡¨åŠ é”</li>
<li>é¡µçº§é”å®š ï¼šMySQLä¸­é”ç²’åº¦ä»‹äºè¡Œçº§é”å’Œè¡¨çº§é”ä¹‹é—´çš„ä¸€ç§é”</li>
<li>è¡Œçº§é”ï¼šMySQLä¸­é”ç²’åº¦æœ€å°çš„ä¸€ç§ï¼Œ</li>
</ul>
<h3 id="å°é”åè®®"><a href="#å°é”åè®®" class="headerlink" title="å°é”åè®®"></a>å°é”åè®®</h3><blockquote>
<p>ä¸‰çº§é”åè®®</p>
</blockquote>
<p>1.ä¸€çº§å°é”åè®®</p>
<p>äº‹ç‰©Tæƒ³è¦ä¿®æ”¹æ•°æ®Aæ—¶å¿…é¡»åŠ Xé”ï¼ŒçŸ¥é“Tç»“æŸæ‰é‡Šæ”¾é”ã€‚</p>
<p>å¯ä»¥è§£å†³ä¸¢å¤±ä¿®æ”¹çš„é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½æœ‰åŒæ—¶ä¸¤ä¸ªäº‹ç‰©å¯¹åŒä¸€ä¸ªæ•°æ®ä¿®æ”¹ <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232303434303435312e706e67.png" alt="img" loading="lazy"> </p>
<p>2.äºŒçº§å°é”åè®®</p>
<p>åœ¨ä¸€çº§åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ®Aæ—¶å¿…é¡»åŠ Sé”ï¼Œè¯»å–å®Œé©¬ä¸Šé‡Šæ”¾ã€‚</p>
<p>å¯ä»¥è§£å†³è„è¯»é—®é¢˜ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹ç‰©åœ¨å¯¹æ•°æ®Aä¿®æ”¹ï¼Œæ ¹æ®ä¸€çº§åè®®ä¼šåŠ Xé”ï¼Œå‘¢ä¹ˆå°±ä¸èƒ½åŠ Sé”ï¼Œä¹Ÿå°±ä¸ä¼šè¯»å…¥æ•°æ®ã€‚ <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232303833313834332e706e67.png" alt="img" loading="lazy"> </p>
<p>3.ä¸‰çº§å°é”åè®®</p>
<p>åœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚ä¸€ä¸ªäº‹ç‰©è¯»å–æ•°æ®Aæ—¶åŠ Sé”ï¼ŒçŸ¥é“äº‹ç‰©ç»“æŸæ‰é‡Šæ”¾é”ã€‚å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå› ä¸ºè¯»Aæ—¶ï¼Œå…¶ä»–äº‹ç‰©ä¸èƒ½ä¿®æ”¹æ•°æ®A <img src="/2022/04/22/MySQL/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f696d6167652d32303139313230373232313331333831392e706e67.png" alt="img" loading="lazy"> </p>
<blockquote>
<p>ä¸¤ç«¯é”åè®®</p>
</blockquote>
<p>åŠ é”å’Œè§£é”åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¿›è¡Œã€‚</p>
<p>å¯ä¸²è¡ŒåŒ–è°ƒåº¦æ˜¯æŒ‡ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç»“æœä¸æŸä¸ªä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡ç»“æœç›¸åŒã€‚ä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šå‡ºç°å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>äº‹åŠ¡éµå¾ªä¸¤æ®µé”åè®®æ˜¯ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ã€‚ä¾‹å¦‚ä»¥ä¸‹æ“ä½œæ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œå®ƒæ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock-x(A)...lock-s(B)...lock-s(C)...unlock(A)...unlock(C)...unlock(B)</span><br></pre></td></tr></table></figure>

<p> ä½†ä¸æ˜¯å¿…è¦æ¡ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹æ“ä½œä¸æ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œä½†å®ƒè¿˜æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock-x(A)...unlock(A)...lock-s(B)...unlock(B)...lock-s(C)...unlock(C)</span><br></pre></td></tr></table></figure>

<h3 id="MySQLéšå¼ä¸æ˜¾ç¤ºé”å®š"><a href="#MySQLéšå¼ä¸æ˜¾ç¤ºé”å®š" class="headerlink" title="MySQLéšå¼ä¸æ˜¾ç¤ºé”å®š"></a>MySQLéšå¼ä¸æ˜¾ç¤ºé”å®š</h3><p>MySQL çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ä¸¤æ®µé”åè®®ï¼Œä¼šæ ¹æ®éš”ç¦»çº§åˆ«åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åŠ é”ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é”éƒ½æ˜¯åœ¨åŒä¸€æ—¶åˆ»è¢«é‡Šæ”¾ï¼Œè¿™è¢«ç§°ä¸ºéšå¼é”å®šã€‚</p>
<p>InnoDB ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„è¯­å¥è¿›è¡Œæ˜¾ç¤ºé”å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... LOCK In SHARE MODE;</span><br><span class="line">SELECT ... FOR UPDATE;</span><br></pre></td></tr></table></figure>

<h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h3><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ä¸€äº›æ•æ„Ÿçš„æ•°æ®ï¼Œéœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åœ¨ä»»ä½•æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚ä¸ºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦å¯¹ <strong>å¹¶å‘æ“ä½œè¿›è¡Œæ§åˆ¶</strong> ï¼Œå› æ­¤äº§ç”Ÿäº† é” ã€‚åŒæ—¶ é”æœºåˆ¶ ä¹Ÿä¸ºå®ç°MySQL çš„å„ä¸ªéš”ç¦»çº§åˆ«æä¾›äº†ä¿è¯ã€‚ é”å†²çª ä¹Ÿæ˜¯å½±å“æ•°æ®åº“ å¹¶å‘è®¿é—®æ€§èƒ½ çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æ‰€ä»¥é”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p>
<h3 id="2-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"><a href="#2-MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•" class="headerlink" title="2.MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"></a>2.MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•</h3><h4 id="2-1è¯»-è¯»æƒ…å†µ"><a href="#2-1è¯»-è¯»æƒ…å†µ" class="headerlink" title="2.1è¯»-è¯»æƒ…å†µ"></a>2.1è¯»-è¯»æƒ…å†µ</h4><p>è¯»-è¯»æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§è¯»å–ç›¸åŒè®°å½•ã€‚è¯»å–æ“ä½œæœ¬èº«ä¸ä¼šå¯¹è®°å½•æœ‰ä»»ä½•å½±å“ï¼Œæ‰€ä»¥å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿ</p>
<h4 id="2-2å†™-å†™æƒ…å†µ"><a href="#2-2å†™-å†™æƒ…å†µ" class="headerlink" title="2.2å†™-å†™æƒ…å†µ"></a>2.2å†™-å†™æƒ…å†µ</h4><p>å³å¹¶å‘äº‹åŠ¡ç›¸ç»§å¯¹ç›¸åŒè®°å½•åšå‡ºæ”¹åŠ¨ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿ <strong>è„å†™</strong> çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸è¿™ç§é—®é¢˜çš„å‘ç”Ÿã€‚æ‰€ä»¥åœ¨å¤šä¸ªæœªæäº¤äº‹åŠ¡ç›¸ç»§å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œéœ€è¦è®©å®ƒä»¬ <strong>æ’é˜Ÿæ‰§è¡Œ</strong> ï¼Œè¿™ä¸ªæ’é˜Ÿçš„è¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡ <strong>é”</strong> æ¥å®ç°çš„ã€‚è¿™ä¸ªæ‰€è°“ çš„é”å…¶å®æ˜¯ä¸€ä¸ª <strong>å†…å­˜ä¸­çš„ç»“æ„</strong> ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰æœ¬æ¥æ˜¯æ²¡æœ‰é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹æ˜¯æ²¡æœ‰ <strong>é”ç»“æ„</strong> å’Œè®°å½•è¿›è¡Œå…³è”çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1651307939016.png" alt="1651307939016" loading="lazy"></p>
<p>å½“ä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šçœ‹çœ‹å†…å­˜ä¸­æœ‰æ²¡æœ‰ä¸è¿™æ¡è®°å½•å…³è”çš„ <strong>é”ç»“æ„</strong> ï¼Œå½“æ²¡æœ‰çš„æ—¶å€™ å°±ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª <strong>é”ç»“æ„</strong> ä¸ä¹‹å…³è”ã€‚æ¯”å¦‚ï¼Œäº‹åŠ¡ T1 è¦å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨ï¼Œå°±éœ€è¦ç”Ÿæˆä¸€ä¸ª <strong>é”ç»“æ„</strong> ä¸ä¹‹å…³è”ï¼š<img src="/2022/04/22/MySQL/1651307988699.png" alt="1651307988699" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651307996814.png" alt="1651307996814" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651308003294.png" alt="1651308003294" loading="lazy"></p>
<p>å°ç»“å‡ ç§è¯´æ³•ï¼š</p>
<ul>
<li><p>ä¸åŠ é” </p>
<p>æ„æ€å°±æ˜¯ä¸éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„ é”ç»“æ„ ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œæ“ä½œã€‚ </p>
</li>
<li><p>è·å–é”æˆåŠŸï¼Œæˆ–è€…åŠ é”æˆåŠŸ </p>
<p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„ é”ç»“æ„ ï¼Œè€Œä¸”é”ç»“æ„çš„ is_waiting å±æ€§ä¸º false ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚ </p>
</li>
<li><p>è·å–é”å¤±è´¥ï¼Œæˆ–è€…åŠ é”å¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰è·å–åˆ°é”</p>
<p>æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„ é”ç»“æ„ ï¼Œä¸è¿‡é”ç»“æ„çš„ is_waiting å±æ€§ä¸º true ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ </p>
<p>éœ€è¦ç­‰å¾…ï¼Œä¸å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚ </p>
</li>
</ul>
<h4 id="2-3è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"><a href="#2-3è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ" class="headerlink" title="2.3è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"></a>2.3è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ</h4><p>è¯»-å†™æˆ–å†™-è¯»ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œæ”¹åŠ¨æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿè„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»çš„é—®é¢˜ã€‚</p>
<p>å„ä¸ªæ•°æ®åº“å‚å•†å¯¹ SQLæ ‡å‡† çš„æ”¯æŒéƒ½å¯èƒ½ä¸ä¸€æ ·ã€‚æ¯”å¦‚MySQLåœ¨ REPEATABLE READ éš”ç¦»çº§åˆ«ä¸Šå°±å·²ç»è§£å†³äº† å¹»è¯» é—®é¢˜ã€‚</p>
<h4 id="2-4å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#2-4å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2.4å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"></a>2.4å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</h4><p>å¦‚ä½•è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜å‘¢</p>
<ul>
<li><p>æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œåˆ©ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ï¼Œå†™æ“ä½œè¿›è¡ŒåŠ é”</p>
<p>æ‰€è°“<strong>MVCC</strong>ï¼Œå°±æ˜¯ç”Ÿæˆä¸€ä¸ª<strong>ReadView</strong>ï¼Œé€šè¿‡ReadViewæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ç‰ˆæœ¬(å†å²ç‰ˆæœ¬ç”±<strong>undoæ—¥å¿—</strong>æ„å»º)ã€‚æŸ¥è¯¢è¯­å¥åªèƒ½<strong>è¯»</strong>åˆ°åœ¨ReadViewå‰<strong>å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹</strong>ï¼Œåœ¨æœªæäº¤æˆ–æ‰å¼€å¯çš„äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹æ˜¯çœ‹ä¸åˆ°çš„ã€‚è€Œ<strong>å†™æ“ä½œæ˜¯é’ˆå¯¹æœ€æ–°ç‰ˆæœ¬çš„è®°å½•</strong>ï¼Œè¯»è®°å½•çš„å†å²ç‰ˆæœ¬å’Œæ”¹è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å¹¶ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯MVCCè¯»-å†™ä¸å†²çª</p>
<blockquote>
<p>æ™®é€šçš„SELECTè¯­å¥åœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨åˆ°MVCCè¯»å–è®°å½•ã€‚</p>
<ul>
<li>åœ¨READ COMMITEDéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼ŒReadViewçš„å­˜åœ¨æœ¬èº«å°±ä¿è¯äº†äº‹åŠ¡ä¸å¯è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹ï¼Œä¹Ÿå°±é¿å…äº†è„è¯»ç°è±¡</li>
<li>åœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ‰ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„SELECTæ“ä½œéƒ½ä¼šå¤ç”¨è¿™ä¸ªreadviewï¼Œè¿™æ ·å°±é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜</li>
</ul>
</blockquote>
<p><strong>mvccèƒ½å¦è§£å†³å¹»è¯»ï¼Ÿ</strong></p>
</li>
<li><p>æ–¹æ¡ˆäºŒï¼šè¯»å†™æ“ä½œéƒ½é‡‡ç”¨åŠ é”</p>
<p>å¦‚æœä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸å…è®¸è¯»å–è®°å½•çš„æ—§ç‰ˆæœ¬ï¼Œè€Œæ˜¯æ¯æ¬¡å¿…é¡»å»è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼Œåœ¨é“¶è¡Œå­˜æ¬¾çš„äº‹åŠ¡ä¸­ï¼Œéœ€è¦å…ˆæŠŠè´¦æˆ·çš„ä½™é¢è¯»å‡ºæ¥ï¼Œç„¶åå°†å…¶åŠ ä¸Šæœ¬æ¬¡å­˜æ¬¾çš„æ•°é¢ï¼Œæœ€åå†™åˆ°æ•°æ®åº“ã€‚åœ¨å°†è´¦æˆ·ä½™é¢è¯»å–å‡ºæ¥åï¼Œå°±ä¸æƒ³è®©å…¶ä»–äº‹åŠ¡è®¿é—®è¯¥ä½™é¢ï¼Œç›´åˆ°æœ¬æ¬¡å­˜æ¬¾äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå…¶ä»–äº‹åŠ¡æ‰å¯ä»¥è®¿é—®åˆ°è´¦æˆ·ä½™é¢ã€‚è¿™æ ·åœ¨è¯»å–è®°å½•çš„æ—¶å€™å°±éœ€è¦å¯¹å…¶è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¿™æ ·ä¹Ÿå°±æ„å‘³ç€è¯»æ“ä½œå’Œå†™æ“ä½œä¹Ÿåƒå†™-å†™æ“ä½œä¸€æ ·æ’é˜Ÿæ‰§è¡Œ</p>
<p><strong>è„è¯»</strong>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡å†™çš„è®°å½•ï¼Œå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡åœ¨å†™è®°å½•çš„æ—¶å€™å°±ç»™è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡å°±æ— æ³•è¯»åˆ°è¯¥è®°å½•ï¼Œä¹Ÿå°±å°±æ²¡æœ‰è„è¯»é—®é¢˜</p>
<p><strong>ä¸å¯é‡å¤è¯»</strong>çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡å…ˆè¯»å–åˆ°æŸä¸€è®°å½•ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å¯¹è¯¥ç±»è®°å½•ä¿®æ”¹å¹¶æäº¤åï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–ä¼šè·å¾—ä¸åŒçš„å€¼ï¼Œå¦‚æœåœ¨å½“å‰äº‹åŠ¡è¯»å–è®°å½•æ—¶å°±ç»™è¯¥è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡å°±æ— æ³•ä¿®æ”¹è¯¥è®°å½•ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»ã€‚</p>
<p>å¹»è¯»çš„äº§ç”Ÿæ˜¯å› ä¸ºå½“å‰äº‹åŠ¡è¯»å–äº†ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œç„¶åå¦å¤–çš„äº‹åŠ¡å‘è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°çš„è®°å½•ï¼Œå½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶å‘ç°äº†æ–°æ’å…¥çš„æ–°çºªå½•ã€‚é‡‡ç”¨åŠ é”çš„æ–¹å¼è§£å†³å¹»è¯»é—®é¢˜å°±æœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºå½“å‰äº‹åŠ¡ç¬¬ä¸€æ¬¡è¯»å–è®°å½•æ—¶å¹»å½±è®°å½•å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¯»å–çš„æ—¶å€™åŠ é”ä¸çŸ¥é“ç»™è°åŠ </p>
</li>
<li><p>å°ç»“å¯¹æ¯”ï¼š</p>
<ul>
<li>é‡‡ç”¨MVCCæ–¹å¼ï¼Œè¯»-å†™æ“ä½œå½¼æ­¤å¹¶ä¸å†²çª</li>
<li>é‡‡ç”¨åŠ é”æ–¹å¼ï¼Œè¯»-å†™æ“ä½œå½¼æ­¤éœ€è¦æ’é˜Ÿæ‰§è¡Œï¼Œå½±å“æ€§èƒ½</li>
</ul>
</li>
</ul>
<h3 id="3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»"><a href="#3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»" class="headerlink" title="3.é”çš„ä¸åŒè§’åº¦åˆ†ç±»"></a>3.é”çš„ä¸åŒè§’åº¦åˆ†ç±»</h3><p>é”çš„åˆ†ç±»å›¾ï¼Œå¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651320185635.png" alt="1651320185635" loading="lazy"></p>
<h4 id="3-1ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†-è¯»é”ã€å†™é”"><a href="#3-1ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†-è¯»é”ã€å†™é”" class="headerlink" title="3.1ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†:è¯»é”ã€å†™é”"></a>3.1ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†:è¯»é”ã€å†™é”</h4><p>å¯¹äºæ•°æ®åº“ä¸­å¹¶å‘äº‹åŠ¡çš„è¯»-è¯»æƒ…å†µå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äºè¯»-å†™ã€å†™-å†™æˆ–å†™-è¯»è¿™äº›æƒ…å†µå¯èƒ½ä¼šå¼•èµ·ä¸€äº›é—®é¢˜ã€‚éœ€è¦ä½¿ç”¨MVCCæˆ–åŠ é”æ–¹å¼æ¥è§£å†³ã€‚åœ¨ä½¿ç”¨åŠ é”æ–¹å¼è§£å†³æ—¶ï¼Œç”±äºæ—¢è¦å…è®¸è¯»-è¯»æƒ…å†µä¸å—å½±å“ï¼Œåˆè¦ä½¿å†™-å†™ã€è¯»-å†™æˆ–å†™-è¯»æƒ…å†µä¸­çš„æ“ä½œç›¸äº’é˜»å¡ï¼Œæ‰€ä»¥MySQLå®ç°äº†ä¸€ä¸ªç”±ä¸¤ç§ç±»å‹çš„é”ç»„æˆçš„é”ç³»ç»Ÿæ¥è§£å†³ã€‚è¿™ä¸¤ç§ç±»å‹çš„é”é€šå¸¸ç§°ä¸ºå…±äº«é”ã€æ’ä»–é”ï¼Œä¹Ÿå«è¯»é”å’Œå†™é”</p>
<ul>
<li>è¯»é”ï¼šä¹Ÿç§°ä¸ºå…±äº«é”ã€è‹±æ–‡ç”¨Sè¡¨ç¤ºã€‚é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡ã€‚</li>
<li>å†™é”:ä¹Ÿç§°ä¸ºæ’ä»–é”ã€è‹±æ–‡ç”¨Xè¡¨ç¤ºã€‚å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æŒ¡å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´å†…åªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æº</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºInnoDbå¼•æ“æ¥è¯´ï¼Œè¯»é”å’Œå†™é”å¯ä»¥åŠ åœ¨è¡¨ä¸Šä¹Ÿå¯ä»¥åŠ åœ¨è¡Œä¸Š</strong></p>
<p>ä¸¾ä¾‹ï¼ˆè¡Œçº§è¯»å†™é”ï¼‰ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡T1å·²ç»è·å¾—æŸä¸ªè¡Œrçš„è¯»é”ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªäº‹åŠ¡æ˜¯å¯ä»¥å»è·å¾—è¿™ä¸ªè¡Œrçš„è¯»é”çš„ï¼Œå› ä¸ºè¯»æ“ä½œå¹¶æ²¡æœ‰æ”¹å˜è¡Œrçš„æ•°æ®ï¼Œä½†æ˜¯T3äº‹åŠ¡æƒ³è·å¾—è¡Œrçš„å†™é”ï¼Œåˆ™å¿…é¡»ç­‰åˆ°1 2ä¸¤ä¸ªäº‹åŠ¡é‡Šæ”¾æ‰rä¸Šçš„è¯»é”<img src="/2022/04/22/MySQL/1651393998025.png" alt="1651393998025" loading="lazy"></p>
<p><strong>1.é”å®šè¯»</strong></p>
<p>åœ¨é‡‡ç”¨åŠ é”æ–¹å¼è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜æ—¶ï¼Œè¯»å–ä¸€æ¡è®°å½•æ—¶éœ€è¦è·å¾—è¯¥è¡Œè®°å½•çš„Sé”ï¼Œå…¶å®ä¸ä¸¥è°¨ï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨è¯»å–è®°å½•æ—¶è·å–è®°å½•çš„Xé”ã€‚æ¥ç¦æ­¢åˆ«çš„äº‹åŠ¡è¯»è¯»å†™è¯¥è®°å½•ï¼Œä¸ºæ­¤MySQLæå‡ºäº†ä¸¤ç§ç‰¹æ®Šçš„SELECTè¯­å¥æ ¼å¼ï¼š</p>
<ul>
<li><p>å¯¹è¯»å–è®°å½•åŠ Sé”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... LOCK IN SHARE MODE;</span><br><span class="line">#æˆ–</span><br><span class="line">SELECT ... FOR SHARE;#(8.0æ–°å¢)</span><br></pre></td></tr></table></figure>

<p>åœ¨æ™®é€šçš„SELECTè¯­å¥åè¾¹åŠ LOCK IN SHARE MODEï¼Œå¦‚æœå¯¹è¯»å–è®°å½•åŠ Xé”ï¼šå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œåˆ°äº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå®ƒä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ Sé”ï¼Œè¿™æ ·å…è®¸åˆ«çš„äº‹ç‰©jç»§ç»­è·å–è¿™äº›è®°å½•çš„Sé”ï¼Œä½†ä¸èƒ½è·å–è®°å½•çš„Xé”ã€‚å¦‚æœåˆ«çš„äº‹ç‰©æƒ³è·å¾—è®°å½•çš„Xé”ï¼Œå°±ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡æäº¤åå°†è¿™äº›è®°å½•ä¸Šçš„Sé”é‡Šæ”¾æ‰</p>
</li>
<li><p>å¯¹è¯»å–è®°å½•åŠ Xé”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... FOR UPDATE;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ™®é€šçš„SELECTè¯­å¥ååŠ FOR UPDATEï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ‰§è¡Œåˆ°è¯¥è¯­å¥ï¼Œé‚£ä¹ˆä¼šä¸ºè¯»å–åˆ°çš„è®°å½•åŠ Xé”ï¼Œè¿™æ ·åŠä¸å…è®¸åˆ«çš„äº‹ç‰©è·å–è¿™äº›è®°å½•çš„Sé”ï¼Œä¹Ÿä¸å…è®¸åˆ«çš„äº‹ç‰©è·å–Xé”</p>
</li>
</ul>
<p><strong>MySQL8.0æ–°ç‰¹æ€§</strong></p>
<p>åœ¨5.7åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒSELECTâ€¦FOR UPDATEï¼Œå¦‚æœè·å–ä¸åˆ°é”ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°<strong>innodb_lock_wait_timeout</strong>è¶…æ—¶ã€‚åœ¨8.0ç‰ˆæœ¬ä¸­ï¼ŒSELECT..FOR UPDATEï¼ŒSELECTâ€¦FOR SHAREæ·»åŠ çš„NOWAIT SKIP LOCKEDè¯­æ³•ï¼Œè·³è¿‡é”ç­‰å¾…ï¼Œæˆ–è€…è·³è¿‡é”å®šã€‚</p>
<ul>
<li>é€šè¿‡æ·»åŠ NOWAITã€SKIP LOCKEDè¯­æ³•ï¼Œèƒ½å¤Ÿç«‹å³è¿”å›ã€‚å¦‚æœæŸ¥è¯¢çš„è¡Œå·²ç»åŠ é”ï¼š<ul>
<li>é‚£ä¹ˆNOWAITä¼šç«‹å³æŠ¥é”™è¿”å›</li>
<li>è€ŒSKIP LOCKEDä¹Ÿä¼šç«‹å³è¿”å›ï¼ŒçŸ¥è¯†è¿”å›ç»“æœä¸­ä¸åŒ…å«é”å®šçš„è¡Œ</li>
</ul>
</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651395019178.png" alt="1651395019178" loading="lazy"></p>
<p><strong>2.å†™æ“ä½œ</strong></p>
<p>å¹³å¸¸é”ç”¨åˆ°çš„å†™æ“ä½œæ— éæ˜¯DELETEã€UPDATEã€INSERTä¸‰ç§ï¼š</p>
<ul>
<li><p>DELETEï¼š</p>
<p>å¯¹ä¸€æ¡è®°å½•åšDELETEæ“ä½œçš„è¿‡ç¨‹å…¶å®æ˜¯ç°åœ¨B+æ ‘å®šä½åˆ°è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œç„¶åè·å–è¿™æ¡è®°å½•çš„Xé”ï¼Œåœ¨æ‰§è¡Œdelete markæ“ä½œã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…åˆ é™¤è®°å½•åœ¨B+æ ‘ä¸­ä½ç½®çš„è¿‡ç¨‹çœ‹æˆä¸€ä¸ªè·å–Xé”çš„é”å®šè¯»</p>
</li>
<li><p>UPDATE:åœ¨å¯¹ä¸€æ¡è®°å½•åšUPDATEæ“ä½œæ—¶åˆ†ä¸ºä¸‰ç§æƒ…å†µ</p>
<ul>
<li><strong>æƒ…å†µ1ï¼š</strong>æœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åæœªå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨B+æ ‘ä¸­å®šä½åˆ°è¿™ä¸ªè®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„Xé”ï¼Œæœ€ååœ¨åŸçºªå½•çš„ä½ç½®è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+æ ‘ä¸­çš„ä½ç½®çš„è¿‡ç¨‹çœ‹ä½œè·å–Xé”çš„é”å®šè¯»</li>
<li><strong>æƒ…å†µ2ï¼š</strong>æœªä¿®æ”¹è¯¥è®°å½•çš„é”®å€¼ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªè¢«æ›´æ–°çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´åœ¨ä¿®æ”¹å‰åå‘ç”Ÿå˜åŒ–ã€‚åˆ™å…ˆåœ¨B+æ ‘ä¸­å®šä½åˆ°è¿™ä¸ªè®°å½•çš„ä½ç½®ï¼Œç„¶åå†è·å–ä¸€ä¸‹è®°å½•çš„Xé”ï¼Œå°†è¯¥è®°å½•å½»åº•åˆ æ‰(æŠŠè®°å½•å½»åº•ç§»å…¥åƒåœ¾é“¾è¡¨)ï¼Œæœ€åå†æ’å…¥ä¸€æ¡æ–°çºªå½•ã€‚è¿™ä¸ªå®šä½å¾…ä¿®æ”¹è®°å½•åœ¨B+æ ‘ç§ä½ç½®çš„è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€ä¸ªè·å–Xé”çš„é”å®šè¯»ï¼Œæ–°æ’å…¥çš„è®°å½•ç”±INSERTæ“ä½œæä¾›éšå¼é”ä¿æŠ¤ã€‚</li>
<li><strong>æƒ…å†µ3ï¼š</strong>ä¿®æ”¹äº†è¯¥è®°å½•çš„é”®å€¼ï¼Œåˆ™ç›¸å½“äºåœ¨åŸçºªå½•ä¸Šåšäº†DELETEæ“ä½œä¹‹åå†æ¥ä¸€æ¬¡INSERTæ“ä½œï¼ŒåŠ é”æ“ä½œæŒ‰ç…§DELETEå’ŒINSERTçš„è§„åˆ™è¿›è¡Œ</li>
</ul>
</li>
<li><p>INSERT:</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°æ’å…¥ä¸€æ¡è®°å½•çš„æ“ä½œå¹¶ä¸åŠ é”ï¼Œé€šè¿‡ä¸€ç§å«éšå¼é”çš„ç»“æ„æ¥ä¿æŠ¤è¿™æ¡æ–°æ’å…¥çš„è®°å½•åœ¨æœ¬äº‹ç‰©æäº¤å‰ä¸è¢«åˆ«çš„äº‹ç‰©è®¿é—®ã€‚</p>
</li>
</ul>
<h4 id="3-2ä»æ•°æ®æ“ä½œçš„ç²’åº¦ä¸Šåˆ’åˆ†ï¼šè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”"><a href="#3-2ä»æ•°æ®æ“ä½œçš„ç²’åº¦ä¸Šåˆ’åˆ†ï¼šè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”" class="headerlink" title="3.2ä»æ•°æ®æ“ä½œçš„ç²’åº¦ä¸Šåˆ’åˆ†ï¼šè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”"></a>3.2ä»æ•°æ®æ“ä½œçš„ç²’åº¦ä¸Šåˆ’åˆ†ï¼šè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”</h4><p>ä¸ºäº†å°½å¯èƒ½æé«˜æ•°æ®åº“çš„å¹¶å‘åº¦ï¼Œæ¯æ¬¡é”å®šçš„æ•°æ®èŒƒå›´è¶Šå°è¶Šå¥½ï¼Œç†è®ºä¸Šæ¯æ¬¡åªé”å®šå½“å‰æ“ä½œçš„æ•°æ®çš„æ–¹æ¡ˆä¼šå¾—åˆ°æœ€å¤§çš„å¹¶å‘åº¦ï¼Œä½†æ˜¯ç®¡ç†é”æ˜¯<strong>å¾ˆè€—èµ„æº</strong>çš„äº‹ï¼ˆæ¶‰åŠè·å–ã€æ£€æŸ¥ã€é‡Šæ”¾é”ç­‰åŠ¨ä½œï¼‰ã€‚å› æ­¤æ•°æ®åº“ç³»ç»Ÿéœ€è¦åœ¨<strong>é«˜å¹¶å‘å“åº”å’Œç³»ç»Ÿæ€§èƒ½</strong>ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†<strong>é”ç²’åº¦</strong>çš„æ¦‚å¿µã€‚</p>
<p>å¯¹ä¸€æ¡è®°å½•åŠ é”å½±å“çš„åªæ˜¯è¿™æ¡è®°å½•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç»†ï¼Œå…¶å®ä¸€ä¸ªäº‹åŠ¡ä¹Ÿå¯ä»¥åœ¨è¡¨ä¸ŠåŠ é”ï¼Œç§°ä¹‹ä¸ºè¡¨é”ï¼Œå¯¹ä¸€ä¸ªè¡¨åŠ é”å½±å“çš„ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨çš„è®°å½•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªé”çš„ç²’åº¦æ¯”è¾ƒç²—ï¼Œé”çš„ç²’åº¦ä¸»è¦åˆ†ä¸ºè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”</p>
<h5 id="1-è¡¨é”ï¼ˆTable-Lockï¼‰"><a href="#1-è¡¨é”ï¼ˆTable-Lockï¼‰" class="headerlink" title="1.è¡¨é”ï¼ˆTable Lockï¼‰"></a>1.è¡¨é”ï¼ˆTable Lockï¼‰</h5><p>è¯¥é”ä¼šé”å®šæ•´å¼ è¡¨ï¼Œå®ƒæ˜¯MySQLæœ€åŸºæœ¬çš„é”ç­–ç•¥ï¼Œå¹¶ä¸ä¾èµ–å­˜å‚¨å¼•æ“ï¼Œå¹¶ä¸”è¡¨é”æ˜¯å¼€é”€æœ€å°çš„ç­–ç•¥ï¼ˆå› ä¸ºç²’åº¦æ¯”è¾ƒå¤§ï¼‰ï¼Œç”±äºè¡¨çº§é”ä¸€æ¬¡ä¼šå°†æ•´å¼ è¡¨é”ä½ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„é¿å…æ­»é”é—®é¢˜ã€‚å½“ç„¶é”ç²’åº¦çš„å¢å¤§å¸¦æ¥çš„è´Ÿé¢å½±å“å°±æ˜¯å‡ºç°é”èµ„æºç«äº‰çš„æ¦‚ç‡ä¹Ÿä¼šå¢å¤§ï¼Œå¯¼è‡´å¹¶å‘ç‡é™ä½</p>
<p>1.è¡¨çº§çš„Sé”ã€Xé”</p>
<p>åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„Sé”æˆ–Xé”çš„ã€‚åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚ALTER TABLEã€DROP TABLEè¿™ç±»çš„DDLè¯­å¥æ—¶ï¼Œå…¶ä»–äº‹ç‰©å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ã€‚åŒç†ï¼ŒæŸä¸ªäº‹ç‰©ç§å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡ŒDDLè¯­å¥ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨serverå±‚ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸ºå…ƒæ•°æ®é”ç»“æ„æ¥å®ç°çš„</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§åˆ«çš„ Sé” å’Œ Xé” ã€‚åªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´ å´© æºƒæ¢å¤ è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚æ¯”å¦‚ï¼Œåœ¨ç³»ç»Ÿå˜é‡ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶ï¼Œ æ‰‹åŠ¨ è·å–InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨t çš„ Sé” æˆ–è€… Xé” å¯ä»¥è¿™ä¹ˆå†™ï¼š </p>
<ul>
<li>LOCK TABLES t READ ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ Sé” ã€‚ </li>
<li>LOCK TABLES t WRITE ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ Xé” ã€‚ </li>
</ul>
<p>ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ä¸Šä½¿ç”¨ LOCK TABLES è¿™æ ·çš„æ‰‹åŠ¨é”è¡¨è¯­å¥ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæä¾›ä»€ä¹ˆé¢å¤–çš„ä¿æŠ¤ï¼Œåªæ˜¯ä¼šé™ä½å¹¶å‘èƒ½åŠ›è€Œå·²ã€‚InnoDBçš„å‰å®³ä¹‹å¤„è¿˜æ˜¯å®ç°äº†æ›´ç»†ç²’åº¦çš„ è¡Œé” ï¼Œå…³äºInnoDBè¡¨çº§åˆ«çš„ Sé” å’Œ Xé” å¤§å®¶äº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ </p>
<p>MyISAMåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹ä¹‹å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ å†™é”ã€‚InnoDB<strong>å­˜å‚¨å¼•æ“ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„è¯»é”æˆ–å†™é”</strong></p>
<p>MySQLçš„è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šï¼ˆä»¥MyISAMè¡¨è¿›è¡Œæ“ä½œçš„æ¼”ç¤ºï¼‰ </p>
<ul>
<li>æ ‡è®°å…±äº«é”</li>
<li>è¡¨ç‹¬å å†™é”<img src="/2022/04/22/MySQL/1651415857990.png" alt="1651415857990" loading="lazy"></li>
</ul>
<p>2.æ„å‘é”</p>
<p>InnoDBæ”¯æŒå¤šç²’åº¦é”ï¼Œå…è®¸è¡Œçº§é”å’Œè¡¨çº§é”å…±äº«ï¼Œè€Œæ„å‘é”å°±æ˜¯å…¶ä¸­ä¸€ç§è¡¨é”ã€‚</p>
<ol>
<li>æ„å‘é”çš„å­˜åœ¨æ˜¯ä¸ºäº†åè°ƒè¡Œé”å’Œè¡¨é”çš„å…³ç³»ï¼Œæ”¯æŒå¤šç²’åº¦ï¼ˆè¡¨é”ä¸è¡Œé”ï¼‰çš„é”å¹¶å­˜</li>
<li>æ„å‘é”æ˜¯ä¸€ç§ä¸ä¸è¡Œçº§é”å†²çªçš„è¡¨çº§é”</li>
<li>è¡¨æ˜â€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸäº›è¡ŒæŒæœ‰äº†é”æˆ–è¯¥äº‹åŠ¡å‡†å¤‡å»æŒæœ‰é”â€</li>
</ol>
<p>æ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><p>æ„å‘å…±äº«é”:äº‹ç‰©æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«é”ï¼ˆSé”ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE;</span><br></pre></td></tr></table></figure></li>
<li><p>æ„å‘æ’ä»–é”:äº‹ç‰©æœ‰æ„å‘å¯¹è¡¨ä¸­æŸäº›è¡ŒåŠ æ’ä»–é”ï¼ˆXé”ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE;</span><br></pre></td></tr></table></figure>

<p>å³ï¼šæ„å‘é”æ˜¯ç”±<strong>å­˜å‚¨å¼•æ“ è‡ªå·±ç»´æŠ¤çš„</strong> ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰InooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œ <strong>æ‰€åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é” ã€‚</strong></p>
</li>
</ul>
<p><strong>æ„å‘é”è§£å†³çš„é—®é¢˜</strong></p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œåˆ†åˆ«æ˜¯T1å’ŒT2ï¼Œå…¶ä¸­T2è¯•å›¾åœ¨è¯¥è¡¨çº§åˆ«ä¸Šåº”ç”¨å…±äº«æˆ–æ’ä»–é”ï¼Œå¦‚æœæ²¡æœ‰æ„å‘é”çš„å­˜åœ¨ï¼Œé‚£ä¹ˆT2å°±éœ€è¦å»æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œæ˜¯å¦å­˜åœ¨é”ï¼Œå¦‚æœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šäº«å—åˆ°ç”±T1æ§åˆ¶çš„è¡¨çº§åˆ«æ„å‘é”çš„é˜»å¡ã€‚T2é”å®šè¯¥è¡¨å‰ä¸å¿…æ£€æŸ¥å„ä¸ªé¡µæˆ–è¡Œé”ï¼Œåªéœ€è¦æ£€æŸ¥è¯¥è¡¨çš„æ„å‘é”ã€‚</p>
<p>åœ¨æ•°æ®è¡¨åœºæ™¯ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ç»™æŸä¸€è¡Œæ•°æ®åŠ ä¸Šäº†æ’ä»–é”ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨    ç»™æ›´å¤§ä¸€çº§çš„ç©ºé—´ï¼Œæ¯”å¦‚æ•°æ®é¡µæˆ–æ•°æ®è¡¨åŠ ä¸Šæ„å‘é”ï¼Œå‘Šè¯‰å…¶ä»–äººè¿™ä¸ªæ•°æ®é¡µæˆ–æ•°æ®è¡¨å·²ç»æœ‰å…¶ä»–äººä¸Šè¿‡æ’ä»–é”ï¼Œè¿™æ ·å½“å…¶ä»–äººæƒ³è¦è·å–æ•°æ®è¡¨æ’ä»–é”æ—¶ï¼Œåªéœ€è¦äº†è§£æ˜¯å¦æœ‰äººå·²ç»è·å–äº†è¿™ä¸ªæ•°æ®è¡¨çš„æ„å‘æ’ä»–é”å³å¯</p>
<ul>
<li>å¦‚æœäº‹åŠ¡æƒ³è¦è·å–æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„å…±äº«é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸ŠåŠ æ„å‘å…±äº«é”</li>
<li>å¦‚æœäº‹åŠ¡æƒ³è¦è·å–æ•°æ®è¡¨ä¸­æŸäº›è®°å½•çš„æ’ä»–é”ï¼Œå°±éœ€è¦åœ¨æ•°æ®è¡¨ä¸ŠåŠ æ„å‘æ’ä»–é”</li>
</ul>
<p><strong>æ„å‘é”çš„å¹¶å‘æ€§</strong></p>
<p>æ„å‘é”ä¸ä¼šä¸è¡Œçº§é”çš„å…±äº«/æ’ä»–é”äº’æ–¥ã€‚æ­£å› å¦‚æ­¤ï¼Œæ„å‘é”å¹¶ä¸ä¼šå½±å“åˆ°å¤šä¸ªäº‹åŠ¡å¯¹ä¸åŒæ•°æ®è¡ŒåŠ æ’ä»–é”æ—¶çš„å¹¶å‘æ€§</p>
<p>ä»ä¸Šé¢ä¾‹å­å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š</p>
<ol>
<li>InnoDBæ”¯æŒå¤šç²’åº¦é”ï¼Œç‰¹å®šåœºæ™¯ä¸‹ï¼Œè¡Œçº§é”å¯ä»¥ä¸è¡¨çº§é”å…±å­˜</li>
<li>æ„å‘é”ä¹‹é—´å¹¶ä¸äº’æ–¥ï¼Œï¼Œä½†é™¤äº†ISä¸Så…¼å®¹å¤–ï¼Œæ„å‘é”ä¼šä¸å…±äº«é”/æ’ä»–é”äº’æ–¥</li>
<li>IXã€ISæ˜¯è¡¨çº§é”ï¼Œä¸ä¼šä¸è¡Œçº§çš„Xï¼ŒSé”å‘ç”Ÿå†²çªï¼Œåªä¼šä¸è¡¨çº§çš„Sã€Xé”å‘ç”Ÿå†²çª</li>
<li>æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº†è¡Œé”å’Œè¡¨é”å…±å­˜ä¸”æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§çš„è¦æ±‚</li>
</ol>
<p>3.è‡ªå¢é”ï¼ˆAUTO-INCé”ï¼‰</p>
<p>åœ¨ä½¿ç”¨MySQLè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºè¡¨çš„æŸä¸ªåˆ—æ·»åŠ AUTO_INCREMENTå±æ€§ã€‚ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `teacher` ( `id` int NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿™ä¸ªè¡¨çš„idå­—æ®µå£°æ˜äº†AUTO_INCREMENTï¼Œæ„å‘³ç€åœ¨ä¹¦å†™æ’å…¥è¯­å¥æ—¶ä¸éœ€è¦ä¸ºå…¶èµ‹å€¼ï¼ŒSQLè¯­å¥ä¿®æ”¹ å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `teacher` (name) VALUES (&#x27;zhangsan&#x27;), (&#x27;lisi&#x27;);</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¾¹çš„æ’å…¥è¯­å¥å¹¶æ²¡æœ‰ä¸ºidåˆ—æ˜¾ç¤ºèµ‹å€¼ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®ƒé™„ä¸Šé€’å¢çš„å€¼ï¼Œç»“æœå¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651481620005.png" alt="1651481620005" loading="lazy"></p>
<p>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„ä¸Šé¢æ’å…¥æ•°æ®åªæ˜¯ä¸€ç§ç®€å•çš„æ’å…¥æ¨¡å¼ï¼Œæ‰€æœ‰æ’å…¥æ•°æ®çš„æ–¹å¼æ€»å…±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ </p>
<p>â€œ Simple inserts â€ï¼Œâ€œ Bulk inserts â€å’Œâ€œ Mixed-mode inserts â€ã€‚ </p>
<p><strong>1. â€œSimple insertsâ€</strong> <strong>ï¼ˆç®€å•æ’å…¥ï¼‰</strong> </p>
<p>å¯ä»¥ é¢„å…ˆç¡®å®šè¦æ’å…¥çš„è¡Œæ•° ï¼ˆå½“è¯­å¥è¢«åˆå§‹å¤„ç†æ—¶ï¼‰çš„è¯­å¥ã€‚åŒ…æ‹¬æ²¡æœ‰åµŒå¥—å­æŸ¥è¯¢çš„å•è¡Œå’Œå¤šè¡Œ INSERTâ€¦VALUES() å’Œ REPLACE è¯­å¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­å°±å±äºè¯¥ç±»æ’å…¥ï¼Œå·²ç»ç¡®å®šè¦æ’å…¥çš„è¡Œæ•°ã€‚ </p>
<p><strong>2. â€œBulk insertsâ€</strong> <strong>ï¼ˆæ‰¹é‡æ’å…¥ï¼‰</strong> </p>
<p>äº‹å…ˆä¸çŸ¥é“è¦æ’å…¥çš„è¡Œæ•° ï¼ˆå’Œæ‰€éœ€è‡ªåŠ¨é€’å¢å€¼çš„æ•°é‡ï¼‰çš„è¯­å¥ã€‚æ¯”å¦‚ INSERT â€¦ SELECT ï¼Œ REPLACE â€¦ SELECT å’Œ LOAD DATA è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬çº¯INSERTã€‚ InnoDBåœ¨æ¯å¤„ç†ä¸€è¡Œï¼Œä¸ºAUTO_INCREMENTåˆ— åˆ†é…ä¸€ä¸ªæ–°å€¼ã€‚ </p>
<p><strong>3. â€œMixed-mode insertsâ€</strong> <strong>ï¼ˆæ··åˆæ¨¡å¼æ’å…¥ï¼‰</strong> </p>
<p>è¿™äº›æ˜¯â€œSimple insertsâ€è¯­å¥ä½†æ˜¯æŒ‡å®šéƒ¨åˆ†æ–°è¡Œçš„è‡ªåŠ¨é€’å¢å€¼ã€‚ä¾‹å¦‚ INSERT INTO teacher (id,name) VALUES (1,â€™aâ€™), (NULL,â€™bâ€™), (5,â€™câ€™), (NULL,â€™dâ€™); åªæ˜¯æŒ‡å®šäº†éƒ¨åˆ†idçš„å€¼ã€‚å¦ä¸€ç§ç±»å‹çš„â€œæ·· åˆæ¨¡å¼æ’å…¥â€æ˜¯ INSERT â€¦ ON DUPLICATE KEY UPDATE ã€‚ </p>
<p>innodb_autoinc_lock_modeæœ‰ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸ä¸åŒé”å®šæ¨¡å¼ï¼š </p>
<p>ï¼ˆ1ï¼‰innodb_autoinc_lock_mode = 0(â€œä¼ ç»Ÿâ€é”å®šæ¨¡å¼) </p>
<p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»å‹çš„insertè¯­å¥éƒ½ä¼šè·å¾—ä¸€ä¸ªç‰¹æ®Šçš„è¡¨çº§AUTO-INCé”ï¼Œç”¨äºæ’å…¥å…·æœ‰ AUTO_INCREMENTåˆ—çš„è¡¨ã€‚è¿™ç§æ¨¡å¼å…¶å®å°±å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³æ¯å½“æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª è¡¨çº§é”(AUTO-INCé”)ï¼Œä½¿å¾—è¯­å¥ä¸­ç”Ÿæˆçš„auto_incrementä¸ºé¡ºåºï¼Œä¸”åœ¨binlogä¸­é‡æ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯ masterä¸slaveä¸­æ•°æ®çš„auto_incrementæ˜¯ç›¸åŒçš„ã€‚å› ä¸ºæ˜¯è¡¨çº§é”ï¼Œå½“åœ¨åŒä¸€æ—¶é—´å¤šä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œinsertçš„ æ—¶å€™ï¼Œå¯¹äºAUTO-INCé”çš„äº‰å¤ºä¼š é™åˆ¶å¹¶å‘ èƒ½åŠ›ã€‚ </p>
<p>ï¼ˆ2ï¼‰innodb_autoinc_lock_mode = 1(â€œè¿ç»­â€é”å®šæ¨¡å¼) </p>
<p>åœ¨ MySQL 8.0 ä¹‹å‰ï¼Œè¿ç»­é”å®šæ¨¡å¼æ˜¯ é»˜è®¤ çš„ã€‚ </p>
<p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œâ€œbulk insertsâ€ä»ç„¶ä½¿ç”¨AUTO-INCè¡¨çº§é”ï¼Œå¹¶ä¿æŒåˆ°è¯­å¥ç»“æŸã€‚è¿™é€‚ç”¨äºæ‰€æœ‰INSERT â€¦ SELECTï¼ŒREPLACE â€¦ SELECTå’ŒLOAD DATAè¯­å¥ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¯­å¥å¯ä»¥æŒæœ‰AUTO-INCé”ã€‚ </p>
<p>å¯¹äºâ€œSimple insertsâ€ï¼ˆè¦æ’å…¥çš„è¡Œæ•°äº‹å…ˆå·²çŸ¥ï¼‰ï¼Œåˆ™é€šè¿‡åœ¨ mutexï¼ˆè½»é‡é”ï¼‰ çš„æ§åˆ¶ä¸‹è·å¾—æ‰€éœ€æ•°é‡çš„è‡ªåŠ¨é€’å¢å€¼æ¥é¿å…è¡¨çº§AUTO-INCé”ï¼Œ å®ƒåªåœ¨åˆ†é…è¿‡ç¨‹çš„æŒç»­æ—¶é—´å†…ä¿æŒï¼Œè€Œä¸æ˜¯ç›´åˆ°è¯­å¥å®Œæˆã€‚ä¸ä½¿ç”¨ è¡¨çº§AUTO-INCé”ï¼Œé™¤éAUTO-INCé”ç”±å¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒã€‚å¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒAUTO-INCé”ï¼Œåˆ™â€œSimple insertsâ€ç­‰å¾…AUTO-INCé”ï¼Œå¦‚åŒå®ƒæ˜¯ä¸€ä¸ªâ€œbulk insertsâ€ã€‚ </p>
<p>ï¼ˆ3ï¼‰innodb_autoinc_lock_mode = 2(â€œäº¤é”™â€é”å®šæ¨¡å¼) </p>
<p>ä» MySQL 8.0 å¼€å§‹ï¼Œäº¤é”™é”æ¨¡å¼æ˜¯ é»˜è®¤ è®¾ç½®ã€‚ </p>
<p>åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨é€’å¢å€¼ ä¿è¯ åœ¨æ‰€æœ‰å¹¶å‘æ‰§è¡Œçš„æ‰€æœ‰ç±»å‹çš„insertè¯­å¥ä¸­æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ã€‚ä½† æ˜¯ï¼Œç”±äºå¤šä¸ªè¯­å¥å¯ä»¥åŒæ—¶ç”Ÿæˆæ•°å­—ï¼ˆå³ï¼Œè·¨è¯­å¥äº¤å‰ç¼–å·ï¼‰ï¼Œ<strong>ä¸ºä»»ä½•ç»™å®šè¯­å¥æ’å…¥çš„è¡Œç”Ÿæˆçš„å€¼å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚</strong> </p>
<p><strong>â‘£ å…ƒæ•°æ®é”ï¼ˆ<strong><strong>MDL</strong></strong>é”ï¼‰</strong> MySQL5.5å¼•å…¥äº†meta data lockï¼Œç®€ç§°MDLé”ï¼Œå±äºè¡¨é”èŒƒç•´ã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ª è¡¨ç»“æ„åšå˜æ›´ ï¼Œå¢åŠ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚ </p>
<p>å› æ­¤ï¼Œ<strong>å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ </strong> <strong>MDL****è¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ </strong> <strong>MDL</strong> <strong>å†™é”ã€‚</strong></p>
<h5 id="2-InnoDBè¡Œé”"><a href="#2-InnoDBè¡Œé”" class="headerlink" title="2.InnoDBè¡Œé”"></a>2.InnoDBè¡Œé”</h5><p>è¡Œé”ä¹Ÿç§°ä¸ºè®°å½•é”ï¼Œå°±æ˜¯é”ä½æŸä¸€è¡Œã€‚mysqlæœåŠ¡å±‚å¹¶æ²¡æœ‰å®ç°è¡Œé”æœºåˆ¶ï¼Œè¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šé”å®šç²’åº¦å°ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡ä½ï¼Œå¯ä»¥å®ç°çš„å¹¶å‘åº¦é«˜</p>
<p><strong>ç¼ºç‚¹</strong>å¯¹äºé”çš„å¼€é”€æ¯”è¾ƒå¤§ï¼ŒåŠ é”ä¼šæ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°æ­»é”</p>
<p><strong>1.è®°å½•é”ï¼ˆrecord lockï¼‰</strong></p>
<p>è®°å½•é”ä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š LOCK_REC_NOT_GAP ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªè®°å½•é”çš„ç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºã€‚ä»…ä»…æ˜¯é”ä½äº†idå€¼ä¸º8çš„è®°å½•ï¼Œå¯¹å‘¨å›´çš„æ•°æ®æ²¡æœ‰å½±å“ã€‚<img src="/2022/04/22/MySQL/1651481862505.png" alt="1651481862505" loading="lazy"></p>
<p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651481874818.png" alt="1651481874818" loading="lazy"></p>
<p>è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†ï¼Œç§°ä¹‹ä¸ºSå‹è®°å½•é”å’ŒXå‹è®°å½•é”ã€‚</p>
<ul>
<li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”</li>
<li>å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ã€‚</li>
</ul>
<p><strong>2.é—´æ­‡é”ï¼ˆGap Locksï¼‰</strong></p>
<p>MySQL åœ¨ REPEATABLE READ éš”ç¦»çº§åˆ«ä¸‹æ˜¯<strong>å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„</strong>ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨ MVCC æ–¹æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ åŠ é” æ–¹æ¡ˆè§£å†³ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰ä¸ªå¤§é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯» å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº› å¹»å½±è®°å½• åŠ ä¸Š è®°å½•é” ã€‚InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º Gap Locks çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š LOCK_GAP ï¼Œæˆ‘ä»¬å¯ä»¥ç®€ç§°ä¸º gapé” ã€‚æ¯”å¦‚ï¼ŒæŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªgapé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚<img src="/2022/04/22/MySQL/1651482155999.png" alt="1651482155999" loading="lazy"></p>
<p>å›¾ä¸­idå€¼ä¸º8çš„è®°å½•åŠ äº†gapé”ï¼Œæ„å‘³ç€ä¸å…è®¸åˆ«çš„äº‹ç‰©åœ¨idå€¼ä¸º8çš„è®°å½•å‰è¾¹çš„é—´æ­‡æ’å…¥æ–°çºªå½•ï¼Œå…¶å®å°±æ˜¯idlieçš„å€¼(3ï¼Œ8)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•æ—¶ä¸å…è®¸ç«‹å³æ’å…¥ã€‚æ¯”å¦‚ï¼Œæœ‰å¦å¤–ä¸€ä¸ªäº‹ç‰©æƒ³å†æ’å…¥ä¸€æ¡idå€¼ä¸º4çš„æ–°çºªå½•ï¼Œä»–å®šä½åˆ°è¯¥æ¡æ–°çºªå½•çš„ä¸‹ä¸€æ¡çš„idå€¼ä¸º8ï¼Œè€Œè¿™æ¡è®°å½•ä¸Šåˆæœ‰ä¸€ä¸ªgapé”ï¼Œæ‰€ä»¥å°±ä¼šé˜»å¡æ’å…¥æ“ä½œï¼ŒçŸ¥é“æ‹¥æœ‰è¿™ä¸ªgapé”çš„äº‹ç‰©æäº¤ä¹‹åï¼Œidåˆ—çš„å€¼åœ¨åŒºé—´ï¼ˆ3ï¼Œ8ï¼‰ä¸­çš„æ–°çºªå½•æ‰å¯ä»¥è¢«æ’å…¥ã€‚</p>
<p><strong>gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„</strong></p>
<p><strong>3.ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰</strong></p>
<p>æœ‰æ—¶å€™æˆ‘ä»¬æ—¢æƒ³é”ä½æŸæ¡è®°å½•ï¼Œåˆæƒ³é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„é—´æ­‡æ’å…¥æ–°çºªå½•ï¼Œæ‰€ä»¥InnoDBå°±æå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸ºNext-Key Locksçš„é”ã€‚å®˜æ–¹ç§°ä¹‹ä¸ºLOCK_ORDINARYï¼Œç®€ç§°ä¸º Next-Key é”ã€‚Next-Key Locksæ˜¯å­˜åœ¨å­˜å‚¨å¼•æ“innodbã€äº‹åŠ¡çº§åˆ«åœ¨å¯é‡å¤è¯»çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“é”ï¼ŒInnoDBé»˜è®¤å°±æ˜¯Next-Key Locksã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">begin; select * from student where id &lt;=8 and id &gt; 3 for update;</span><br></pre></td></tr></table></figure>

<p><strong>4.æ’å…¥æ„å‘é”ï¼ˆinsert Intention Locksï¼‰</strong></p>
<p>æˆ‘ä»¬è¯´ä¸€ä¸ªäº‹åŠ¡åœ¨ æ’å…¥ ä¸€æ¡è®°å½•æ—¶éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ’å…¥ä½ç½®æ˜¯ä¸æ˜¯è¢«åˆ«çš„äº‹åŠ¡åŠ äº† gapé” ï¼ˆ next-keyé”ä¹ŸåŒ…å« gapé” ï¼‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æ‹¥æœ‰ gapé” çš„é‚£ä¸ªäº‹åŠ¡æäº¤ã€‚ä½†æ˜¯<strong>InnoDBè§„å®šäº‹åŠ¡åœ¨ç­‰å¾…çš„æ—¶å€™ä¹Ÿéœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªé”ç»“æ„</strong>ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ª é—´éš™ ä¸­ æ’å…¥ æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨åœ¨ç­‰å¾…ã€‚InnoDBå°±æŠŠè¿™ç§ç±»å‹çš„é”å‘½åä¸º Insert Intention Locks ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼šLOCK_INSERT_INTENTION ï¼Œæˆ‘ä»¬ç§°ä¸º æ’å…¥æ„å‘é” ã€‚æ’å…¥æ„å‘é”æ˜¯ä¸€ç§ Gapé” ï¼Œä¸æ˜¯æ„å‘é”ï¼Œåœ¨insertæ“ä½œæ—¶äº§ç”Ÿã€‚ </p>
<p>æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é” ã€‚ </p>
<p>äº‹å®ä¸Š<strong>æ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é”ã€‚</strong> </p>
<h5 id="3-é¡µé”"><a href="#3-é¡µé”" class="headerlink" title="3.é¡µé”"></a>3.é¡µé”</h5><p>é¡µé”å°±æ˜¯åœ¨ é¡µçš„ç²’åº¦ ä¸Šè¿›è¡Œé”å®šï¼Œé”å®šçš„æ•°æ®èµ„æºæ¯”è¡Œé”è¦å¤šï¼Œå› ä¸ºä¸€ä¸ªé¡µä¸­å¯ä»¥æœ‰å¤šä¸ªè¡Œè®°å½•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨é¡µé”çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®æµªè´¹çš„ç°è±¡ï¼Œä½†è¿™æ ·çš„æµªè´¹æœ€å¤šä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µä¸Šçš„æ•°æ®è¡Œã€‚<strong>é¡µé”çš„å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</strong> </p>
<p>æ¯ä¸ªå±‚çº§çš„é”æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé”ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œ é”ç©ºé—´çš„å¤§å°æ˜¯æœ‰é™çš„ ã€‚å½“æŸä¸ªå±‚çº§çš„é”æ•°é‡ è¶…è¿‡äº†è¿™ä¸ªå±‚çº§çš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ ã€‚é”å‡çº§å°±æ˜¯ç”¨æ›´å¤§ç²’åº¦çš„é”æ›¿ä»£å¤šä¸ªæ›´å°ç²’åº¦çš„é”ï¼Œæ¯”å¦‚InnoDB ä¸­è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å ç”¨çš„é”ç©ºé—´é™ä½äº†ï¼Œä½†åŒæ—¶æ•°æ®çš„å¹¶å‘åº¦ä¹Ÿä¸‹é™äº†ã€‚</p>
<h4 id="3-3ä»å¯¹é”çš„æ€åº¦åˆ’åˆ†ï¼šä¹è§‚é”ã€æ‚²è§‚é”"><a href="#3-3ä»å¯¹é”çš„æ€åº¦åˆ’åˆ†ï¼šä¹è§‚é”ã€æ‚²è§‚é”" class="headerlink" title="3.3ä»å¯¹é”çš„æ€åº¦åˆ’åˆ†ï¼šä¹è§‚é”ã€æ‚²è§‚é”"></a>3.3ä»å¯¹é”çš„æ€åº¦åˆ’åˆ†ï¼šä¹è§‚é”ã€æ‚²è§‚é”</h4><p>ä»å¯¹å¾…é”çš„æ€åº¦æ¥çœ‹é”çš„è¯ï¼Œå¯ä»¥å°†é”åˆ†æˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»åå­—ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸¤ç§é”æ˜¯ä¸¤ç§çœ‹å¾…<strong>æ•°æ®å¹¶å‘çš„æ€ç»´æ–¹å¼</strong> ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å’Œæ‚²è§‚é”å¹¶ä¸æ˜¯é”ï¼Œè€Œæ˜¯é”çš„ <strong>è®¾è®¡æ€æƒ³</strong> ã€‚ </p>
<h5 id="1-æ‚²è§‚é”"><a href="#1-æ‚²è§‚é”" class="headerlink" title="1.æ‚²è§‚é”"></a>1.æ‚²è§‚é”</h5><p>æ‚²è§‚é”æ˜¯ä¸€ç§æ€æƒ³ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œå¯¹æ•°æ®è¢«å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œä¼šé€šè¿‡æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶æ¥å®ç°ï¼Œä»è€Œä¿è¯æ•°æ®æ“ä½œçš„æ’å®ƒæ€§ã€‚ </p>
<p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š é˜»å¡ ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ï¼‰ã€‚æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é˜»å¡æŒ‚èµ·ã€‚Javaä¸­ <strong>synchronized</strong> å’Œ <strong>ReentrantLock</strong> ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p>
<p><strong>ç§’æ€æ¡ˆä¾‹1ï¼š</strong></p>
<p>å•†å“ç§’æ€è¿‡ç¨‹ä¸­ï¼Œåº“å­˜æ•°é‡çš„å‡å°‘ï¼Œé¿å…å‡ºç°è¶…å–çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå•†å“è¡¨ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸ºquantityæ ‡è¯†å½“å‰è¯¥å•†å“çš„åº“å­˜é‡ã€‚å‡è®¾å•†å“ä¸ºåä¸ºmate40ï¼Œidä¸º1001ï¼Œ quantityä¸º100ä¸ªï¼Œå¦‚æœä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ç¬¬ä¸€æ­¥ï¼šæŸ¥å‡ºå•†å“åº“å­˜</span><br><span class="line">select quantity from items where id = 1001;</span><br><span class="line">#ç¬¬äºŒæ­¥ï¼šå¦‚æœåº“å­˜å¤§äº0ï¼Œåˆ™æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿäº§è®¢å•</span><br><span class="line">insert into orders(item_id) values(1001);</span><br><span class="line">#ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å•†å“çš„åº“å­˜ï¼Œnumè¡¨ç¤ºè´­ä¹°æ•°é‡</span><br><span class="line">update items set quantity = quantity-num where id = 1001;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™çš„è¯ï¼Œåœ¨å¹¶å‘é‡å°çš„å…¬å¸æ²¡æœ‰å¤§çš„é—®é¢˜ï¼Œä½†å¦‚æœåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜<img src="/2022/04/22/MySQL/1651741342257.png" alt="1651741342257" loading="lazy"></p>
<p>å…¶ä¸­çº¿ç¨‹Bæ­¤æ—¶å·²ç»ä¸‹å•å¹¶ä¸”å‡å®Œåº“å­˜ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹Aä¾ç„¶æ‰§è¡Œstep3ï¼Œå°±é€ æˆäº†è¶…å–ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨æ‚²è§‚é”å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå•†å“ä¿¡æ¯ä»æŸ¥è¯¢å‡ºæ¥åˆ°ä¿®æ”¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªç”Ÿæˆè®¢å•è¿‡ç¨‹ï¼Œä½¿ç”¨æ‚²è§‚é”çš„åŸç†å°±æ˜¯ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢itemsä¿¡æ¯åæŠŠå½“å‰æ•°æ®é”å®šï¼ŒçŸ¥é“ä¿®æ”¹å®Œæ¯•åå†è§£é”ã€‚é‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ•°æ®è¢«é”å®šäº†ï¼Œå°±ä¸ä¼šå‡ºç°ç¬¬ä¸‰è€…æ¥å¯¹å…¶ä¿®æ”¹ã€‚è€Œè¿™æ ·åšæ˜¯éœ€è¦å°†æ‰§è¡Œçš„sqlè¯­å¥æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå¦åˆ™è¾¾ä¸åˆ°é”å®šæ•°æ®è¡Œçš„ç›®çš„ã€‚</p>
<p>ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢å•†å“åº“å­˜</span><br><span class="line">select quantity from items where id = 1001 for update;</span><br><span class="line">#ç¬¬äºŒæ­¥ï¼šå¦‚æœåº“å­˜å¤§äº0ï¼Œåˆ™æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿäº§è®¢å•</span><br><span class="line">insert into orders(item_id) values(1001);</span><br><span class="line">#ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å•†å“åº“å­˜ï¼Œnumè¡¨ç¤ºè´­ä¹°æ•°é‡</span><br><span class="line">update items set quantity = quantity - num where id = 1001;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1651741901928.png" alt="1651741901928" loading="lazy"></p>
<h5 id="2-ä¹è§‚é”"><a href="#2-ä¹è§‚é”" class="headerlink" title="2.ä¹è§‚é”"></a>2.ä¹è§‚é”</h5><p>ä¹è§‚é”è®¤ä¸ºå¯¹åŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿï¼Œå±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<strong>ä¸é‡‡ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºæ¥å®ç°</strong>ã€‚åœ¨ç¨‹åºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ ç‰ˆæœ¬å·æœºåˆ¶ æˆ–è€… CASæœºåˆ¶ å®ç°ã€‚<strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ã€‚åœ¨Javaä¸­ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼šCASå®ç°çš„ã€‚ </p>
<p><strong>1.ä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶</strong></p>
<p>åœ¨è¡¨ä¸­è®¾è®¡ä¸€ä¸ª ç‰ˆæœ¬å­—æ®µ version ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œä¼šè·å– version å­—æ®µçš„å–å€¼ã€‚ç„¶åå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ UPDATE â€¦ SET version=version+1 WHERE version=version ã€‚æ­¤æ—¶å¦‚æœå·²ç»æœ‰äº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œäº†æ›´æ”¹ï¼Œä¿®æ”¹å°±ä¸ä¼šæˆåŠŸã€‚</p>
<p><strong>2.ä¹è§‚é”çš„æ—¶é—´æˆ³æœºåˆ¶</strong></p>
<p>æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æœºåˆ¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å’Œæ›´æ–°ä¹‹å‰å–å¾—çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸€è‡´åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚ </p>
<p>ä½ èƒ½çœ‹åˆ°ä¹è§‚é”å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•°æ®å¹¶å‘æ“ä½œçš„æƒé™ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ç»™æ•°æ®è¡Œå¢åŠ ä¸€ä¸ªæˆ³ï¼ˆç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼‰ï¼Œä»è€Œè¯æ˜å½“å‰æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦æœ€æ–°ã€‚</p>
<p><strong>ç§’æ€æ¡ˆä¾‹2</strong>ï¼š</p>
<p>ä¾ç„¶ä½¿ç”¨ä¸Šé¢ç§’æ€çš„æ¡ˆä¾‹ï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ç¬¬ä¸€æ­¥ï¼ŒæŸ¥å‡ºå•†å“åº“å­˜</span><br><span class="line">select quantity from items where id = 1001;</span><br><span class="line">#ç¬¬äºŒæ­¥ï¼šå¦‚æœåº“å­˜å¤§äº0ï¼Œåˆ™æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿäº§è®¢å•</span><br><span class="line">insert into orders(item_id) values(1001);</span><br><span class="line">#ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å•†å“çš„åº“å­˜ï¼Œnumè¡¨ç¤ºè´­ä¹°æ•°é‡</span><br><span class="line">update items set quantity = quantity-num,version=version+1 where id = 1001 and version = #(version)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœæ•°æ®è¡¨æ˜¯è¯»å†™åˆ†ç¦»çš„è¡¨ï¼Œå½“masterrè¡¨ä¸­å†™å…¥çš„æ•°æ®æ²¡æœ‰åŠæ—¶åŒæ­¥åˆ°slaveè¡¨ä¸­æ—¶ï¼Œä¼šé€ æˆæ›´æ–°ä¸€ç›´å¤±è´¥çš„é—®é¢˜ã€‚æ­¤æ—¶éœ€è¦å¼ºåˆ¶è¯»å–masterè¡¨ä¸­çš„æ•°æ®ï¼ˆå³å°†selectè¯­å¥æ”¾åˆ°äº‹åŠ¡ä¸­å³å¯ï¼Œè¿™æ—¶å€™æŸ¥è¯¢çš„å°±æ˜¯masterä¸»åº“äº†ï¼‰</p>
<p>å¦‚æœæˆ‘ä»¬å¯¹åŒä¸€æ¡æ•°æ®è¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½åªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ›´æ–°æˆåŠŸï¼Œåœ¨ä¸šåŠ¡æ„ŸçŸ¥ä¸Šé¢å°±æœ‰å¤§é‡çš„å¤±è´¥æ“ä½œã€‚æŠŠä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ç¬¬ä¸€æ­¥ï¼šæŸ¥å‡ºå•†å“åº“å­˜</span><br><span class="line">select quantity from items where id = 1001;</span><br><span class="line">#ç¬¬äºŒæ­¥ï¼šå¦‚æœåº“å­˜å¤§äº0ï¼Œåˆ™æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿäº§è®¢å•</span><br><span class="line">insert into orders(item_id) values(1001);</span><br><span class="line">#ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å•†å“çš„åº“å­˜ï¼Œnumè¡¨ç¤ºè´­ä¹°æ•°é‡</span><br><span class="line">update items set quantity = quantity - num where id = 100 and quantity-num&gt;0;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šä½¿æ¯æ¬¡ä¿®æ”¹éƒ½èƒ½æˆåŠŸï¼Œè€Œä¸”æˆ‘ä¸ä¼šå‡ºç°è¶…å–çš„ç°è±¡ã€‚</p>
<h5 id="3-ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯"><a href="#3-ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="3.ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯"></a>3.ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</h5><ol>
<li><p>ä¹è§‚é” é€‚åˆ è¯»æ“ä½œå¤š çš„åœºæ™¯ï¼Œç›¸å¯¹æ¥è¯´å†™çš„æ“ä½œæ¯”è¾ƒå°‘ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äº ç¨‹åºå®ç° ï¼Œ ä¸å­˜åœ¨æ­»é”é—®é¢˜ï¼Œä¸è¿‡é€‚ç”¨åœºæ™¯ä¹Ÿä¼šç›¸å¯¹ä¹è§‚ï¼Œå› ä¸ºå®ƒé˜»æ­¢ä¸äº†é™¤äº†ç¨‹åºä»¥å¤–çš„æ•°æ®åº“æ“ä½œã€‚ </p>
</li>
<li><p>æ‚²è§‚é” é€‚åˆ å†™æ“ä½œå¤š çš„åœºæ™¯ï¼Œå› ä¸ºå†™çš„æ“ä½œå…·æœ‰ æ’å®ƒæ€§ ã€‚é‡‡ç”¨æ‚²è§‚é”çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚é¢é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®çš„æ“ä½œæƒé™ï¼Œé˜²æ­¢ è¯» - å†™ å’Œ å†™ - å†™ çš„å†²çªã€‚ </p>
</li>
</ol>
<h4 id="3-4æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼šæ˜¾ç¤ºé”ã€éšå¼é”"><a href="#3-4æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼šæ˜¾ç¤ºé”ã€éšå¼é”" class="headerlink" title="3.4æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼šæ˜¾ç¤ºé”ã€éšå¼é”"></a>3.4æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼šæ˜¾ç¤ºé”ã€éšå¼é”</h4><h5 id="1-éšå¼é”"><a href="#1-éšå¼é”" class="headerlink" title="1.éšå¼é”"></a>1.éšå¼é”</h5><ul>
<li><strong>æƒ…æ™¯ä¸€ï¼š</strong>å¯¹äºèšç°‡ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ‰ä¸€ä¸ª trx_id éšè—åˆ—ï¼Œè¯¥éšè—åˆ—è®°å½•ç€æœ€åæ”¹åŠ¨è¯¥è®°å½•çš„ äº‹åŠ¡ id ã€‚é‚£ä¹ˆå¦‚æœåœ¨å½“å‰äº‹åŠ¡ä¸­æ–°æ’å…¥ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•åï¼Œè¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„çš„å°±æ˜¯ å½“å‰äº‹åŠ¡çš„ äº‹åŠ¡id ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ­¤æ—¶æƒ³å¯¹è¯¥è®°å½•æ·»åŠ  Sé” æˆ–è€… Xé” æ—¶ï¼Œé¦–å…ˆä¼šçœ‹ä¸€ä¸‹è¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„äº‹åŠ¡æ˜¯å¦æ˜¯å½“å‰çš„æ´»è·ƒäº‹åŠ¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¸®åŠ©å½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ª X é” ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ false ï¼‰ï¼Œç„¶åè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ (ä¹Ÿå°±æ˜¯ä¸ºè‡ªå·±ä¹Ÿåˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ true ï¼‰ã€‚ </li>
<li><strong>æƒ…æ™¯äºŒï¼š</strong>å¯¹äºäºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ trx_id éšè—åˆ—ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•é¡µé¢çš„ Page Header éƒ¨åˆ†æœ‰ä¸€ä¸ª PAGE_MAX_TRX_ID å±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å¯¹è¯¥é¡µé¢åšæ”¹åŠ¨çš„æœ€å¤§çš„ äº‹åŠ¡id ï¼Œå¦‚ æœ PAGE_MAX_TRX_ID å±æ€§å€¼å°äºå½“å‰æœ€å°çš„æ´»è·ƒ äº‹åŠ¡id ï¼Œé‚£ä¹ˆè¯´æ˜å¯¹è¯¥é¡µé¢åšä¿®æ”¹çš„äº‹åŠ¡éƒ½å·² ç»æäº¤äº†ï¼Œå¦åˆ™å°±éœ€è¦åœ¨é¡µé¢ä¸­å®šä½åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå›è¡¨æ‰¾åˆ°å®ƒå¯¹åº”çš„èšç°‡ç´¢å¼•è®° å½•ï¼Œç„¶åå†é‡å¤ æƒ…æ™¯ä¸€ çš„åšæ³•ã€‚ </li>
</ul>
<p>session1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; insert INTO student VALUES(34,&quot;å‘¨å…«&quot;,&quot;äºŒç­&quot;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>session2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; select * from student lock in share mode; #æ‰§è¡Œå®Œï¼Œå½“å‰äº‹åŠ¡è¢«é˜»å¡</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸‹è¿°è¯­å¥ï¼Œè¾“å‡ºç»“æœï¼š<img src="/2022/04/22/MySQL/1651483798762.png" alt="1651483798762" loading="lazy"></p>
<p>éšå¼é”çš„é€»è¾‘è¿‡ç¨‹å¦‚ä¸‹ï¼š </p>
<p>A. InnoDBçš„æ¯æ¡è®°å½•ä¸­éƒ½ä¸€ä¸ªéšå«çš„trx_idå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå­˜åœ¨äºèšç°‡ç´¢å¼•çš„B+Treeä¸­ã€‚ </p>
<p>B. åœ¨æ“ä½œä¸€æ¡è®°å½•å‰ï¼Œé¦–å…ˆæ ¹æ®è®°å½•ä¸­çš„trx_idæ£€æŸ¥è¯¥äº‹åŠ¡æ˜¯å¦æ˜¯æ´»åŠ¨çš„äº‹åŠ¡(æœªæäº¤æˆ–å›æ»š)ã€‚å¦‚æœæ˜¯æ´»åŠ¨çš„äº‹åŠ¡ï¼Œé¦–å…ˆå°† éšå¼é” è½¬æ¢ä¸º æ˜¾å¼é” (å°±æ˜¯ä¸ºè¯¥äº‹åŠ¡æ·»åŠ ä¸€ä¸ªé”)ã€‚ </p>
<p>C. æ£€æŸ¥æ˜¯å¦æœ‰é”å†²çªï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ›å»ºé”ï¼Œå¹¶è®¾ç½®ä¸ºwaitingçŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰å†²çªä¸åŠ é”ï¼Œè·³åˆ°Eã€‚ </p>
<p>D. ç­‰å¾…åŠ é”æˆåŠŸï¼Œè¢«å”¤é†’ï¼Œæˆ–è€…è¶…æ—¶ã€‚ </p>
<p>E. å†™æ•°æ®ï¼Œå¹¶å°†è‡ªå·±çš„trx_idå†™å…¥trx_idå­—æ®µã€‚</p>
<h5 id="2-æ˜¾ç¤ºé”"><a href="#2-æ˜¾ç¤ºé”" class="headerlink" title="2.æ˜¾ç¤ºé”"></a>2.æ˜¾ç¤ºé”</h5><p>é€šè¿‡ç‰¹å®šçš„è¯­å¥è¿›è¡ŒåŠ é”ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¾ç¤ºåŠ é”ï¼Œä¾‹å¦‚ï¼š </p>
<p>æ˜¾ç¤ºåŠ å…±äº«é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select .... lock in share mode</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºæ’ä»–é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select .... for update</span><br></pre></td></tr></table></figure>

<h4 id="3-5å…¶ä»–é”ä¹‹ï¼šå…¨å±€é”"><a href="#3-5å…¶ä»–é”ä¹‹ï¼šå…¨å±€é”" class="headerlink" title="3.5å…¶ä»–é”ä¹‹ï¼šå…¨å±€é”"></a>3.5å…¶ä»–é”ä¹‹ï¼šå…¨å±€é”</h4><p>å…¨å±€é”å°±æ˜¯å¯¹ æ•´ä¸ªæ•°æ®åº“å®ä¾‹ åŠ é”ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äº åªè¯»çŠ¶æ€ çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚å…¨å±€é”çš„å…¸å‹ä½¿ç”¨ åœºæ™¯ æ˜¯ï¼šåš å…¨åº“é€»è¾‘å¤‡ä»½ ã€‚ </p>
<p>å…¨å±€é”çš„å‘½ä»¤ï¼š</p>
<blockquote>
<p>Flush tables with read lock</p>
</blockquote>
<h4 id="3-6å…¶ä»–é”ä¹‹ï¼šæ­»é”"><a href="#3-6å…¶ä»–é”ä¹‹ï¼šæ­»é”" class="headerlink" title="3.6å…¶ä»–é”ä¹‹ï¼šæ­»é”"></a>3.6å…¶ä»–é”ä¹‹ï¼šæ­»é”</h4><blockquote>
<p>æ¦‚å¿µ</p>
</blockquote>
<p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯ã€‚æ­» </p>
<p>é”ç¤ºä¾‹ï¼š <img src="/2022/04/22/MySQL/1651497441083.png" alt="1651497441083" loading="lazy"></p>
<p>è¿™æ—¶å€™ï¼Œäº‹åŠ¡1åœ¨ç­‰å¾…äº‹åŠ¡2é‡Šæ”¾id=2çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡2åœ¨ç­‰å¾…äº‹åŠ¡1é‡Šæ”¾id=1çš„è¡Œé”ã€‚ äº‹åŠ¡1å’Œäº‹åŠ¡2åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ ä¸¤ç§ç­–ç•¥ ï¼š</p>
<ul>
<li>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeout æ¥è®¾ç½®ã€‚ </li>
<li>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼ˆå°†æŒæœ‰æœ€å°‘è¡Œçº§æ’ä»–é”çš„äº‹åŠ¡è¿›è¡Œå›æ»šï¼‰ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸ºon ï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚ </li>
</ul>
<p><strong>ç¬¬äºŒç§ç­–ç•¥çš„æˆæœ¬åˆ†æ</strong></p>
<p>æ–¹æ³•ä¸€ï¼š<strong>å¦‚æœä½ ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥æŠŠæ­»é”æ£€æµ‹å…³æ‰ã€‚</strong>ä½†æ˜¯è¿™ç§æ“ä½œæœ¬èº«å¸¦æœ‰ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºä¸šåŠ¡æ¶‰åŠçš„æ—¶å€™ä¸€èˆ¬ä¸ä¼šæŠŠæ­»é”å½“ä½œä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œæ¯•ç«Ÿå‡ºç°äº†æ­»é”ï¼Œå°±å›æ»šï¼Œç„¶åé€šè¿‡ä¸šåŠ¡é‡è¯•ä¸€èˆ¬å°±æ²¡é—®é¢˜ï¼Œè¿™æ˜¯<strong>ä¸šåŠ¡æ— æŸ</strong>çš„ã€‚è€Œå…³æ‰æ­»é”æ£€æµ‹æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡è¶…æ—¶ï¼Œè¿™æ˜¯<strong>ä¸šåŠ¡æœ‰æŸ</strong>ã€‚</p>
<p>æ–¹æ³•äºŒï¼šæ§åˆ¶å¹¶å‘åº¦ã€‚å¦‚æœå¹¶å‘èƒ½å¤Ÿæ§åˆ¶ä½ï¼Œæ¯”å¦‚åŒä¸€è¡ŒåŒæ—¶æœ€å¤šåªæœ‰10ä¸ªçº¿ç¨‹åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p>
<blockquote>
<p>äº§ç”Ÿæ­»é”æ¡ä»¶</p>
</blockquote>
<ol>
<li>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šäº‹åŠ¡</li>
<li>æ¯ä¸ªäº‹åŠ¡éƒ½å·²ç»æŒæœ‰é”å¹¶ä¸”ç”³è¯·æ–°çš„é”</li>
<li>é”èµ„æºåŒæ—¶åªèƒ½è¢«åŒä¸€ä¸ªäº‹åŠ¡æŒæœ‰æˆ–è€…ä¸å…¼å®¹</li>
<li>äº‹åŠ¡ä¹‹é—´å› ä¸ºæŒæœ‰é”å’Œç”³è¯·é”å¯¼è‡´å½¼æ­¤å¾ªç¯ç­‰å¾…</li>
</ol>
<p><strong>æ­»é”çš„å…³é”®åœ¨äºä¸¤ä¸ª(æˆ–ä»¥ä¸Š)çš„sessionåŠ é”é¡ºåºä¸ä¸€è‡´</strong></p>
<blockquote>
<p>å¦‚ä½•å¤„ç†æ­»é”</p>
</blockquote>
<p><strong>æ–¹å¼ä¸€</strong>ç­‰å¾…ï¼ŒçŸ¥é“è¶…æ—¶(innodb_lock_wait_timeout=50s).</p>
<p>å³å½“ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…æ—¶ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡ç­‰å¾…æ—¶é—´è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œå°±å°†å…¶å›æ»šï¼Œå¦å¤–äº‹åŠ¡ç»§ç»­è¿›è¡Œã€‚è¿™ç§æ–¹æ³•ç®€å•æœ‰æ•ˆï¼Œåœ¨innodbä¸­ï¼Œå‚æ•°innodb_lock_wait_timeoputç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p>
<p>ç¼ºç‚¹ï¼šå¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„</p>
<p>é‚£å°±å°†æ­¤å€¼ä¿®æ”¹çŸ­ä¸€äº›ï¼Œæ¯”å¦‚1sï¼Œ0.1sæ˜¯å¦åˆé€‚ï¼Ÿä¸åˆé€‚ï¼Œå®¹æ˜“è¯¯ä¼¤åˆ°æ™®é€šé”çš„ç­‰å¾…</p>
<p><strong>æ–¹å¼äºŒ</strong>ä½¿ç”¨æ­»é”æ£€æµ‹è¿›è¡Œæ­»é”å¤„ç†ã€‚</p>
<p>æ–¹å¼ä¸€æ£€æµ‹æ­»é”å¤ªè¿‡è¢«åŠ¨ï¼Œinnodbè¿˜æä¾›äº†wait-for graphç®—æ³•æ¥ä¸»åŠ¨è¿›è¡Œæ­»é”æ£€æµ‹ï¼Œæ¯å½“åŠ é”è¯·æ±‚æ— æ³•ç«‹å³æ»¡è¶³éœ€è¦å¹¶è¿›å…¥ç­‰å¾…æ—¶ï¼Œwait-for graphç®—æ³•å°±ä¼šè¢«å‡ºå‘ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§è¾ƒä¸ºä¸»åŠ¨çš„æ­»é”æ£€æµ‹æœºåˆ¶ï¼Œè¦æ±‚æ•°æ®åº“ä¿å­˜é”çš„ä¿¡æ¯é“¾è¡¨å’Œäº‹åŠ¡ç­‰å¾…é“¾è¡¨ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚<img src="/2022/04/22/MySQL/1651758403654.png" alt="1651758403654" loading="lazy"></p>
<p>åŸºäºè¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå¯ä»¥ç»˜åˆ¶wait-for graphï¼ˆç­‰å¾…å›¾ï¼‰<img src="/2022/04/22/MySQL/1651758478245.png" alt="1651758478245" loading="lazy"></p>
<p><strong>æ­»é”æ£€æµ‹çš„åŸç†æ˜¯æ„å»ºä¸€ä¸ªä»¥äº‹åŠ¡ä¸ºé¡¶ç‚¹ï¼Œé”ä¸ºè¾¹çš„æœ‰å‘å›¾ï¼Œåˆ¤æ–­æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼Œå­˜åœ¨å³æœ‰æ­»é”</strong></p>
<p>ä¸€æ—¦æ£€æµ‹åˆ°å›è·¯ã€æœ‰æ­»é”ï¼Œè¿™æ—¶å€™InnoDBå­˜å‚¨å¼•æ“ä¼šé€‰æ‹©å›æ»š<strong>undoé‡æœ€å°çš„äº‹åŠ¡</strong>ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼ˆinnodb_deadlock_detect=onè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼‰</p>
<p>ç¼ºç‚¹ï¼šæ¯ä¸ªæ–°çš„è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å¦‚æœ100å¹¶å‘çº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œæ„å‘³ç€è¦æ£€æµ‹100*100=1ä¸‡æ¬¡ï¼Œ1ä¸‡ä¸ªçº¿ç¨‹å°±ä¼šæœ‰1åƒä¸‡æ¬¡æ£€æµ‹ã€‚</p>
<p><strong>å¦‚ä½•è§£å†³ï¼Ÿ</strong></p>
<ul>
<li>æ–¹å¼1ï¼šå…³é—­æ­»é”æ£€æµ‹ï¼Œä½†æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡æœ‰æŸ</li>
<li>æ–¹å¼2ï¼šæ§åˆ¶å¹¶å‘è®¿é—®çš„æ•°é‡ã€‚æ¯”å¦‚åœ¨ä¸­é—´ä»¶ä¸­å®ç°ç›¸å¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿï¼Œè¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œ</li>
</ul>
<p><strong>è¿›ä¸€æ­¥çš„æ€è€ƒ</strong></p>
<p>å¯ä»¥è€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªã€‚æ¯”å¦‚ï¼Œè¿é”è¶…å¸‚æ€»é¢çš„è®°å½•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åˆ°å¤šæ¡è®°å½•ä¸Šã€‚è´¦æˆ·æ€»é¢ç­‰äºè¿™å¤šä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚</p>
<blockquote>
<p>å¦‚ä½•é¿å…æ­»é”</p>
</blockquote>
<ul>
<li>åˆç†è®¾è®¡ç´¢å¼•ï¼Œä½¿ä¸šåŠ¡å®šä½æ›´å°‘çš„è¡Œï¼Œå‡å°‘é”å†²çª</li>
<li>è°ƒæ•´ä¸šåŠ¡é€»è¾‘sqlæ‰§è¡Œé¡ºåºï¼Œé¿å…upadte/deleteé•¿æ—¶é—´æŒæœ‰é”çš„sqlåœ¨äº‹åŠ¡å‰é¢ã€‚</li>
<li>é¿å…å¤§äº‹åŠ¡ï¼Œå°½é‡å°†å¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡æ¥å¤„ç†ï¼Œå°äº‹åŠ¡ç¼©çŸ­é”å®šèµ„æºçš„æ—¶é—´ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡å‡å°ã€‚</li>
<li>åœ¨å¹¶å‘åº¦é«˜çš„ç³»ç»Ÿä¸­ï¼Œä¸è¦æ˜¾ç¤ºåŠ é”ï¼Œç‰¹åˆ«æ˜¯åœ¨äº‹åŠ¡é‡Œæ˜¾ç¤ºåŠ é”ã€‚å¦‚electâ€¦for updateè¯­å¥ï¼Œå¦‚æœæ˜¯åœ¨äº‹åŠ¡é‡Œè¿è¡Œäº†start transactionæˆ–è®¾ç½®äº†autocommitç­‰äº0ï¼Œé‚£ä¹ˆå°±ä¼šé”å®šæ‰€æŸ¥æ‰¾åˆ°çš„è®°å½•ã€‚</li>
<li>é™ä½éš”ç¦»çº§åˆ«ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œå°†éš”ç¦»çº§åˆ«è°ƒä½ä¹Ÿæ˜¯è¾ƒå¥½é€‰æ‹©ï¼Œæ¯”å¦‚å°†éš”ç¦»çº§åˆ«ä»RRè°ƒæ•´ä¸ºRCï¼Œå¯ä»¥é¿å…æ‰å¾ˆå¤šå› ä¸ºgapé”é€ æˆçš„æ­»é”</li>
</ul>
<h3 id="4-é”çš„å†…å­˜ç»“æ„"><a href="#4-é”çš„å†…å­˜ç»“æ„" class="headerlink" title="4.é”çš„å†…å­˜ç»“æ„"></a>4.é”çš„å†…å­˜ç»“æ„</h3><p>InnoDBå­˜å‚¨å¼•æ“ä¸­çš„é”ç»“æ„å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651497979915.png" alt="1651497979915" loading="lazy"></p>
<p>ç»“æ„åˆ†æï¼š</p>
<ol>
<li>é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯ ï¼š </li>
</ol>
<p>ä¸è®ºæ˜¯ è¡¨é” è¿˜æ˜¯ è¡Œé” ï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ï¼Œå“ªä¸ªäº‹åŠ¡ç”Ÿæˆäº†è¿™ä¸ª é”ç»“æ„ ï¼Œè¿™é‡Œå°±è®°å½•è¿™ä¸ª äº‹åŠ¡çš„ä¿¡æ¯ã€‚ </p>
<p>æ­¤ é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯ åœ¨å†…å­˜ç»“æ„ä¸­åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯” æ–¹è¯´äº‹åŠ¡idç­‰ã€‚ </p>
<ol start="2">
<li>ç´¢å¼•ä¿¡æ¯ ï¼š </li>
</ol>
<p>å¯¹äº è¡Œé” æ¥è¯´ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ </p>
<ol start="3">
<li>è¡¨é”ï¼è¡Œé”ä¿¡æ¯ ï¼š </li>
</ol>
<p>è¡¨é”ç»“æ„ å’Œ è¡Œé”ç»“æ„ åœ¨è¿™ä¸ªä½ç½®çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼š</p>
<ul>
<li><p>è¡¨é”</p>
<p>è®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–ä¿¡æ¯</p>
</li>
<li><p>è¡Œé”</p>
<p>è®°è½½äº†ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><p>Space IDï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´</p>
</li>
<li><p>Page Numberï¼šè®°å½•æ‰€åœ¨é¡µå·</p>
</li>
<li><p>n_bitsï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒçš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œç»“æ„çš„æœ«å°¾æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ªn_bitså±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½</p>
<blockquote>
<p>n_bitsçš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•åä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„</p>
</blockquote>
</li>
</ul>
<p> 4.type_modeï¼š</p>
</li>
</ul>
<p>è¿™æ˜¯ä¸€ä¸ª32ä½çš„æ•°ï¼Œè¢«åˆ†æˆlock_modeã€lock_typeã€rec_lock_typeä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1651498396421.png" alt="1651498396421" loading="lazy"></p>
<ul>
<li>é”çš„æ¨¡å¼(lock_mode)ï¼Œå ç”¨ä½4ä½ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹ï¼š<ul>
<li>LOCK_IS ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ ISé” ã€‚</li>
<li>LOCK_IX ï¼ˆåè¿›åˆ¶çš„ 1 ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ IXé” ã€‚ </li>
<li>LOCK_S ï¼ˆåè¿›åˆ¶çš„ 2 ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯ Sé” ã€‚ </li>
<li>LOCK_X ï¼ˆåè¿›åˆ¶çš„ 3 ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯ Xé” ã€‚ </li>
<li>LOCK_AUTO_INC ï¼ˆåè¿›åˆ¶çš„ 4 ï¼‰ï¼šè¡¨ç¤º AUTO-INCé” ã€‚ </li>
</ul>
</li>
</ul>
<p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒLOCK_ISã€LOCK_IXã€LOCK_WUTO_INCéƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_Så’ŒLOCK_Xæ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”</p>
<ul>
<li>é”çš„ç±»å‹ï¼ˆlock_typeï¼‰,å ç”¨ç¬¬5-8ä½ï¼Œä¸è¿‡ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ï¼›<ul>
<li>LOCK_TABLE(åè¿›åˆ¶çš„16)ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬5ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é”</li>
<li>LOCK_REC ï¼ˆåè¿›åˆ¶çš„ 32 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬6ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é”ã€‚</li>
</ul>
</li>
<li>è¡Œçš„å…·ä½“ç±»å‹ï¼ˆrec_lock_typeï¼‰ï¼Œä½¿ç”¨å…¶ä½™çš„ä½æ¥è¡¨ç¤ºã€‚åªæœ‰åœ¨lock_typeçš„å€¼ä¸ºLOCK_RECæ—¶ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šç±»å‹ï¼š<ul>
<li>LOCK_ORDINARY ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤º next-keyé” ã€‚ </li>
<li>LOCK_GAP ï¼ˆåè¿›åˆ¶çš„ 512 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬10ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤º gapé” ã€‚ </li>
<li>LOCK_REC_NOT_GAP ï¼ˆåè¿›åˆ¶çš„ 1024 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬11ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ­£ç» è®°å½•é” ã€‚</li>
<li>LOCK_INSERT_INTENTION ï¼ˆåè¿›åˆ¶çš„ 2048 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚å…¶ä»–çš„ç±»å‹ï¼šè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„ç±»å‹æˆ‘ä»¬å°±ä¸å¤šè¯´äº†ã€‚ </li>
</ul>
</li>
<li>is_waiting å±æ€§å‘¢ï¼ŸåŸºäºå†…å­˜ç©ºé—´çš„èŠ‚çœï¼Œæ‰€ä»¥æŠŠ is_waiting å±æ€§æ”¾åˆ°äº† type_mode è¿™ä¸ª32ä½çš„æ•°å­—ä¸­ï¼š<ul>
<li>LOCK_WAIT ï¼ˆåè¿›åˆ¶çš„ 256 ï¼‰ ï¼šå½“ç¬¬9ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤º is_waiting ä¸º true ï¼Œä¹Ÿ å°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼›å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤º is_waiting ä¸º false ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸã€‚ </li>
</ul>
</li>
</ul>
<p>5.å…¶ä»–ä¿¡æ¯ï¼š</p>
<p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§é”ç»“æ„è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ã€‚ </p>
<p>6.ä¸€å †æ¯”ç‰¹ä½ï¼š</p>
<p>å¦‚æœæ˜¯ è¡Œé”ç»“æ„ çš„è¯ï¼Œåœ¨è¯¥ç»“æ„æœ«å°¾è¿˜æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„ n_bits å±æ€§ è¡¨ç¤ºçš„ã€‚InnoDBæ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨ è®°å½•å¤´ä¿¡æ¯ ä¸­éƒ½åŒ…å«ä¸€ä¸ª heap_no å±æ€§ï¼Œä¼ªè®°å½• Infimum çš„ heap_no å€¼ä¸º 0 ï¼Œ Supremum çš„ heap_no å€¼ä¸º 1 ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ heap_no å€¼å°±å¢1ã€‚ é”ç»“ æ„ æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª heap_no ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ åˆ°é¡µå†…çš„ä¸€æ¡è®°å½•ã€‚</p>
<h3 id="5-ã€é”ç›‘æ§"><a href="#5-ã€é”ç›‘æ§" class="headerlink" title="5.ã€é”ç›‘æ§"></a>5.ã€é”ç›‘æ§</h3><p>å…³äºMySQLé”çš„ç›‘æ§ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡æ£€æŸ¥ InnoDB_row_lock ç­‰çŠ¶æ€å˜é‡æ¥åˆ†æç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ </p>
<p><img src="/2022/04/22/MySQL/1651499248866.png" alt="1651499248866" loading="lazy"></p>
<p>å¯¹å„ä¸ªçŠ¶æ€é‡çš„è¯´æ˜å¦‚ä¸‹ï¼š </p>
<ul>
<li>Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ï¼› </li>
<li><strong>Innodb_row_lock_time</strong> ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰ </li>
<li><strong>Innodb_row_lock_time_avg ï¼š</strong>æ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰ </li>
<li>Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ï¼› </li>
<li><strong>Innodb_row_lock_waits</strong> ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°ï¼›ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰</li>
</ul>
<p>å¯¹äºè¿™5ä¸ªå˜é‡ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ä¸Šé¢ä¸‰ä¸ªï¼ˆåŠ ç²—ï¼‰</p>
<p><strong>å…¶ä»–ç›‘æ§æ–¹æ³•ï¼š</strong></p>
<p>MySQLæŠŠäº‹åŠ¡å’Œé”çš„ä¿¡æ¯è®°å½•åœ¨äº† information_schema åº“ä¸­ï¼Œæ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯ INNODB_TRX ã€ INNODB_LOCKS å’Œ INNODB_LOCK_WAITS ã€‚ </p>
<p>MySQL5.7åŠä¹‹å‰ ï¼Œå¯ä»¥é€šè¿‡information_schema.INNODB_LOCKSæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œä½†åªèƒ½çœ‹åˆ°é˜»å¡äº‹åŠ¡çš„é”ï¼›å¦‚æœäº‹åŠ¡å¹¶æœªè¢«é˜»å¡ï¼Œåˆ™åœ¨è¯¥è¡¨ä¸­çœ‹ä¸åˆ°è¯¥äº‹åŠ¡çš„é”æƒ…å†µã€‚ </p>
<p>MySQL8.0åˆ é™¤äº†information_schema.INNODB_LOCKSï¼Œæ·»åŠ äº† performance_schema.data_locks ï¼Œå¯ä»¥é€šè¿‡performance_schema.data_locksæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œå’ŒMySQL5.7åŠä¹‹å‰ä¸åŒï¼Œperformance_schema.data_locksä¸ä½†å¯ä»¥çœ‹åˆ°é˜»å¡è¯¥äº‹åŠ¡çš„é”ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¥äº‹åŠ¡æ‰€æŒæœ‰çš„é”ã€‚åŒæ—¶ï¼Œinformation_schema.INNODB_LOCK_WAITSä¹Ÿè¢« performance_schema.data_lock_waits æ‰€ä»£æ›¿ã€‚</p>
<p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä»è¿™ä¸‰å¼ è¡¨æ”¶é›†çš„ä¿¡æ¯ï¼›é”ç­‰å¾…åœºæ™¯ï¼Œä¾ç„¶ä½¿ç”¨è®°å½•é”ä¸­çš„æ¡ˆä¾‹ï¼Œå½“äº‹åŠ¡2è¿›è¡Œç­‰å¾…æ—¶ï¼ŒæŸ¥è¯¢æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰æŸ¥è¯¢æ­£åœ¨è¢«é”é˜»å¡çš„sqlè¯­å¥ã€‚ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM information_schema.INNODB_TRX\G;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æŸ¥è¯¢é”ç­‰å¾…æƒ…å†µ<img src="/2022/04/22/MySQL/1651558597258.png" alt="1651558597258" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651558603939.png" alt="1651558603939" loading="lazy"></p>
<p>ï¼ˆ3ï¼‰æŸ¥è¯¢é”çš„æƒ…å†µ</p>
<p><img src="/2022/04/22/MySQL/1651558638351.png" alt="1651558638351" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651558648806.png" alt="1651558648806" loading="lazy"></p>
<p>ä»é”çš„æƒ…å†µå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«è·å–äº†IXé”ï¼Œæˆ‘ä»¬ä»æ„å‘é”ç« èŠ‚å¯ä»¥çŸ¥é“ï¼ŒIXé”äº’ç›¸æ—¶å…¼å®¹çš„ã€‚æ‰€ä»¥è¿™é‡Œä¸ä¼šç­‰å¾…ï¼Œä½†æ˜¯äº‹åŠ¡1åŒæ ·æŒæœ‰Xé”ï¼Œæ­¤æ—¶äº‹åŠ¡2ä¹Ÿè¦å»åŒä¸€è¡Œè®°å½•è·å–Xé”ï¼Œä»–ä»¬ä¹‹é—´ä¸å…¼å®¹ï¼Œå¯¼è‡´ç­‰å¾…çš„æƒ…å†µå‘ç”Ÿã€‚</p>
<h3 id="6-é—´æ­‡é”åŠ é”è§„åˆ™ï¼ˆ11æ¡ˆä¾‹ï¼‰"><a href="#6-é—´æ­‡é”åŠ é”è§„åˆ™ï¼ˆ11æ¡ˆä¾‹ï¼‰" class="headerlink" title="6.é—´æ­‡é”åŠ é”è§„åˆ™ï¼ˆ11æ¡ˆä¾‹ï¼‰"></a>6.é—´æ­‡é”åŠ é”è§„åˆ™ï¼ˆ11æ¡ˆä¾‹ï¼‰</h3><p>é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ï¼š </p>
<p>next-key lock å®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ï¼Œå¦‚æœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ« (read-committed) çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†ã€‚è€Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹é—´éš™é”å°±æ²¡æœ‰äº†ï¼Œä¸ºäº†è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠbinlog æ ¼å¼è®¾ç½®ä¸º row ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¸å¤šå…¬å¸çš„é…ç½®ä¸ºï¼šè¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=rowã€‚ä¸šåŠ¡ä¸éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯ï¼Œè¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ã€‚</p>
<p>next-key lockçš„åŠ é”è§„åˆ™ï¼ŒåŒ…å«ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€</p>
<p>1.åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockã€‚å‰å¼€åé—­åŒºé—´</p>
<p>2.åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ä»»ä½•è¾…åŠ©ç´¢å¼•ä¸Šçš„é”ï¼Œæˆ–è€…éç´¢å¼•åˆ—ä¸Šçš„é”ï¼Œæœ€ç»ˆéƒ½è¦å›æº¯åˆ°ä¸»é”®ä¸Šï¼Œåœ¨ä¸»é”®ä¸Šä¹Ÿè¦åŠ ä¸€æŠŠé”</p>
<p>3.ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lockä¼šé€€åŒ–ä¸ºè¡Œé”ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœInnoDBæ‰«æçš„æ˜¯ä¸€ä¸ªä¸»é”®æˆ–è€…ä¸€ä¸ªå”¯ä¸€ç´¢å¼•çš„è¯ï¼Œåªä¼šé‡‡ç”¨è¡Œé”æ–¹å¼åŠ é”ã€‚</p>
<p>4.ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šï¼ˆä¸ä¸€å®šæ˜¯å”¯ä¸€ç´¢å¼•ï¼‰çš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†çš„æ—¶å€™ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶æ—¶ï¼Œnext-key locké€€åŒ–ä¸ºé—´æ­‡é”</p>
<p>5.ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</p>
<p>ä»¥è¡¨testä¸ºä¾‹ï¼Œå»ºè¡¨è¯­å¥åŠåˆå§‹åŒ–å¦‚ä¸‹ï¼šidä¸ºä¸»é”®ç´¢å¼•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `test` (</span><br><span class="line">`id` int(11) NOT NULL,</span><br><span class="line">`col1` int(11) DEFAULT NULL,</span><br><span class="line">`col2` int(11) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (`id`),</span><br><span class="line">KEY `c` (`c`)</span><br><span class="line">) ENGINE=InnoDB;</span><br><span class="line">insert into test values(0,0,0),(5,5,5),</span><br><span class="line">(10,10,10),(15,15,15),(20,20,20),(25,25,25);</span><br></pre></td></tr></table></figure>

<h4 id="æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´æ­‡é”"><a href="#æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´æ­‡é”" class="headerlink" title="æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´æ­‡é”"></a>æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´æ­‡é”<img src="/2022/04/22/MySQL/1651559606567.png" alt="1651559606567" loading="lazy"></h4><p>ç”±äºè¡¨testä¸­æ²¡æœ‰id=7çš„è®°å½•ï¼Œæ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼ŒsessionAåŠ é”èŒƒå›´å°±æ˜¯(5,10]ï¼›åŒæ—¶æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢(id=7)ï¼Œè€Œid=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œnext-key lcoké€€åŒ–æˆé—´æ­‡é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”èŒƒå›´æ˜¯(5,10)</p>
<h4 id="æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”"><a href="#æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”" class="headerlink" title="æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”"></a>æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”<img src="/2022/04/22/MySQL/1651560453447.png" alt="1651560453447" loading="lazy"></h4><p>è¿™é‡ŒsessionAè¦ç»™ç´¢å¼•col1ä¸Šcol1=5çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚</p>
<p>1.æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œå·¦å¼€æœ‰é—­ï¼Œ5æ˜¯é—­ä¸Šçš„ï¼Œå› æ­¤ä¼šç»™(0,5]åŠ ä¸Šnext-key lock</p>
<p>2.è¦æ³¨æ„cæ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—®æ¬¡è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½åœä¸‹çš„ï¼ˆå¯èƒ½æœ‰col1=5çš„å…¶ä»–è®°å½•ï¼‰ï¼Œéœ€è¦ç»§ç»­å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„å¯¹è±¡éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™(5ï¼Œ10]åŠ ä¸Šnext-key lock</p>
<p>3.ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ–2ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªä¸æ»¡è¶³col1=5è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´æ­‡é”(5,10)ã€‚</p>
<p>4.æ ¹æ®åŸåˆ™2ï¼Œåªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•æ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆsessionBå¯ä»¥å®Œæˆçš„åŸå› </p>
<p>ä½†sessionCè¦æ’å…¥ä¸€ä¸ªï¼ˆ7ï¼Œ7ï¼Œ7ï¼‰çš„è®°å½•ï¼Œå°±ä¼šè¢«sessionAçš„é—´æ­‡é”ï¼ˆ5ï¼Œ10ï¼‰é”ä½ï¼Œè¿™ä¸ªä¾‹å­è¯´æ˜é”åŠ è½½ç´¢å¼•ä¸Šçš„ã€‚</p>
<p>æ‰§è¡Œfor updateæ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºæ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ä¸ä¼šè®¿é—®ä¸»é”®ç´¢å¼•ï¼Œä¸ä¼šç»™ä¸»é”®ç´¢å¼•åŠ é”</p>
<h4 id="æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”"><a href="#æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”" class="headerlink" title="æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”"></a>æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</h4><p>ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰å€¼æŸ¥è¯¢çš„ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„è¯­å¥ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=10 for update</span><br><span class="line">select * from test where id&gt;=10 and id&lt;11 for update;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤æ¡è¯­å¥è‚¯å®šç­‰ä»·ï¼Œä½†ä»–ä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·<img src="/2022/04/22/MySQL/1651561526629.png" alt="1651561526629" loading="lazy"></p>
<p>1.å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªid=10çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯next-key lock(5,10]ï¼Œä½†æ ¹æ®ä¼˜åŒ–1ï¼Œä¸»é”®idä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº†id=10è¿™ä¸€æ¡çš„è¡Œé”ã€‚</p>
<p>2.å®ƒæ˜¯èŒƒå›´æŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢å°±å¾€åç»§ç»­æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°id=15è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤éœ€è¦åŠ next-key lcok(10,15].</p>
<p>sessionAè¿™æ—¶å€™é”ä¸Šçš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé”id=10å’Œnext-key lcok(10,15]ã€‚<strong>é¦–æ¬¡sessionAå®šä½æŸ¥æ‰¾id=10çš„è¡Œæ—¶ï¼Œæ˜¯å½“ä½œç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ°id=15æ—¶ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­</strong></p>
<h4 id="æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”"><a href="#æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”" class="headerlink" title="æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”"></a>æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”</h4><p>ä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„ where éƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µ c ï¼Œå®ƒæ˜¯æ™®é€šç´¢å¼• </p>
<p>è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ · <img src="/2022/04/22/MySQL/1651561876661.png" alt="1651561876661" loading="lazy"></p>
<p>åœ¨ç¬¬ä¸€æ¬¡ç”¨col1=10å®šä½è®°å½•æ—¶ï¼Œç´¢å¼•cä¸ŠåŠ äº†(5,10]è¿™ä¸ªnext-key lockåï¼Œç”±äºç´¢å¼•col1æ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ã€‚å› æ­¤æœ€ç»ˆsessionAåŠ çš„é”æ˜¯ï¼Œç´¢å¼•cä¸Šçš„(5,10]å’Œ(10,15]è¿™ä¸¤ä¸ªnext-key lock</p>
<p>è¿™é‡Œéœ€è¦æ‰«æåˆ°col1=15æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ã€‚å› ä¸ºInnoDBè¦æ‰«æåˆ°col1=15ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚</p>
<h4 id="æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢-bug"><a href="#æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢-bug" class="headerlink" title="æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ bug"></a>æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ bug</h4><p><img src="/2022/04/22/MySQL/1651562209398.png" alt="1651562209398" loading="lazy"></p>
<p>session A æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™ 1 çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼• id ä¸ŠåªåŠ  (10,15] è¿™ä¸ª next-key lock ï¼Œå¹¶ä¸”å› ä¸º id æ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ° id=15 è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚ </p>
<p>ä½†æ˜¯å®ç°ä¸Šï¼Œ InnoDB ä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯ id=20 ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼• id ä¸Šçš„ (15,20] è¿™ä¸ª next-key lock ä¹Ÿä¼šè¢«é”ä¸Šã€‚ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½ id=20 è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ° id=15 ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚ </p>
<h4 id="æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨â€œç­‰å€¼â€çš„ä¾‹å­"><a href="#æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨â€œç­‰å€¼â€çš„ä¾‹å­" class="headerlink" title="æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨â€œç­‰å€¼â€çš„ä¾‹å­"></a>æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨â€œç­‰å€¼â€çš„ä¾‹å­</h4><p>è¿™é‡Œï¼Œæˆ‘ç»™è¡¨ t æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼šinsert into t values(30,10,30);ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è¡¨é‡Œé¢æœ‰ä¸¤ä¸ªc=10çš„è¡Œ </p>
<p><strong>ä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼</strong> <strong>id</strong> <strong>æ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯</strong> <strong>10</strong> <strong>å’Œ</strong> <strong>30</strong> <strong>ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ª****c=10</strong> <strong>çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚</strong></p>
<p><img src="/2022/04/22/MySQL/1651562471166.png" alt="1651562471166" loading="lazy">è¿™æ¬¡æˆ‘ä»¬ç”¨ delete è¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œ delete è¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿ select â€¦ for update æ˜¯ç±»ä¼¼çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ª â€œ åŸåˆ™ â€ ã€ä¸¤ä¸ª â€œ ä¼˜åŒ– â€ å’Œä¸€ä¸ª â€œbugâ€ ã€‚ </p>
<p>è¿™æ—¶ï¼Œ session A åœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ª col1=10 çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™ 1 ï¼Œè¿™é‡ŒåŠ çš„æ˜¯ (col1=5,id=5) åˆ° (col1=10,id=10) è¿™ä¸ª next-key lock ã€‚ </p>
<p>ç”±äºcæ˜¯æ™®é€šç´¢å¼•ï¼Œæ‰€ä»¥ç»§ç»­å‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ° (col1=15,id=15) è¿™ä¸€è¡Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ– 2 ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ (col1=10,id=10) åˆ° (col1=15,id=15) çš„é—´éš™é”ã€‚<img src="/2022/04/22/MySQL/1651562707743.png" alt="1651562707743" loading="lazy"></p>
<p>è¿™ä¸ª delete è¯­å¥åœ¨ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸Šé¢å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (col1=5,id=5) å’Œ (col1=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”</p>
<h4 id="æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”"><a href="#æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”" class="headerlink" title="æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”"></a>æ¡ˆä¾‹ä¸ƒï¼šlimitè¯­å¥åŠ é”</h4><p><img src="/2022/04/22/MySQL/1651562819770.png" alt="1651562819770" loading="lazy"></p>
<p>session A çš„ delete è¯­å¥åŠ äº† limit 2 ã€‚ä½ çŸ¥é“è¡¨ t é‡Œ c=10 çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ  limit 2 ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯åŠ é”æ•ˆæœå´ä¸ä¸€æ ·</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„ delete è¯­å¥æ˜ç¡®åŠ äº† limit 2 çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ° (col1=10, id=30) è¿™ä¸€è¡Œä¹‹åï¼Œ </p>
<p>æ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œç´¢å¼• col1 ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆcol1=5,id=5)åˆ°ï¼ˆcol1=10,id=30) è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/2022/04/22/MySQL/1651562846169.png" alt="1651562846169" loading="lazy"></p>
<p>è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œåœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™è®¡é‡åŠ limit</p>
<p>è¿™æ ·ä¸ä»…<strong>å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥ç¼©å°åŠ é”èŒƒå›´</strong></p>
<h4 id="æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­"><a href="#æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­" class="headerlink" title="æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­"></a>æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­</h4><p><img src="/2022/04/22/MySQL/1651562944756.png" alt="1651562944756" loading="lazy"></p>
<p>1.sessionAå¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ lock in share modeï¼Œåœ¨ç´¢å¼•ä¸ŠåŠ äº†next-key lock(5,10]å’Œé—´æ­‡é”(10,15)(ç´¢å¼•å‘å³éå†é€€åŒ–ä¸ºé—´æ­‡é”)</p>
<p>2.session B çš„ update è¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼• c ä¸ŠåŠ  next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼› å®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  col1=10 çš„è¡Œé”ï¼Œå› ä¸ºsessionAä¸Šå·²ç»ç»™è¿™è¡ŒåŠ ä¸Šäº†è¯»é”ï¼Œæ­¤æ—¶ç”³è¯·æ­»é”æ—¶ä¼šè¢«é˜»å¡ </p>
<p>3.ç„¶å session A è¦å†æ’å…¥ (8,8,8) è¿™ä¸€è¡Œï¼Œè¢« session B çš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼Œ InnoDB è®©session B å›æ»š</p>
<h4 id="æ¡ˆä¾‹ä¹ï¼šorder-byç´¢å¼•æ’åºçš„é—´æ­‡é”1"><a href="#æ¡ˆä¾‹ä¹ï¼šorder-byç´¢å¼•æ’åºçš„é—´æ­‡é”1" class="headerlink" title="æ¡ˆä¾‹ä¹ï¼šorder byç´¢å¼•æ’åºçš„é—´æ­‡é”1"></a>æ¡ˆä¾‹ä¹ï¼šorder byç´¢å¼•æ’åºçš„é—´æ­‡é”1</h4><p>å¦‚ä¸‹é¢ä¸€æ¡è¯­å¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">begin;</span><br><span class="line">select * from test where id&gt;9 and id&lt;12 order by id desc for update;</span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾ä¸ºè¿™ä¸ªè¡¨çš„ç´¢å¼•idçš„ç¤ºæ„å›¾<img src="/2022/04/22/MySQL/1651563249209.png" alt="1651563249209" loading="lazy"></p>
<ol>
<li>é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯order by id descï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ°â€œç¬¬ä¸€ä¸ªid&lt;12çš„å€¼â€</li>
<li>è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ°id=12çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆæ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº†ï¼ˆ10ï¼Œ15ï¼‰è¿™ä¸ªé—´éš™ï¼ˆid=15ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥next-key locké€€åŒ–ä¸ºé—´éš™é”ï¼ˆ10ï¼Œ15ï¼‰ï¼‰</li>
<li>ç„¶åå‘å·¦éå†ï¼Œåœ¨è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ°id=5è¿™ä¸€è¡Œï¼Œåˆå› ä¸ºåŒºé—´æ˜¯å·¦é—­å³å¼€çš„ï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock(,5]ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹æ³•å®šä½è®°å½•çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ç­‰å€¼æŸ¥è¯¢</li>
</ol>
<h4 id="æ¡ˆä¾‹åï¼šorder-byç´¢å¼•æ’åºçš„é—´éš™é”2"><a href="#æ¡ˆä¾‹åï¼šorder-byç´¢å¼•æ’åºçš„é—´éš™é”2" class="headerlink" title="æ¡ˆä¾‹åï¼šorder byç´¢å¼•æ’åºçš„é—´éš™é”2"></a>æ¡ˆä¾‹åï¼šorder byç´¢å¼•æ’åºçš„é—´éš™é”2</h4><p><img src="/2022/04/22/MySQL/1651827877071.png" alt="1651827877071" loading="lazy"></p>
<p>1.ç”±äºæ˜¯order by col1 descï¼Œç¬¬ä¸€ä¸ªå®šä½çš„æ˜¯col1ä¸Šæœ€å³è¾¹çš„col1=20çš„è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼š</p>
<p>å·¦å¼€å³é—­åŒºé—´ï¼Œé¦–å…ˆåŠ ä¸Š next-key lock (15,20] ã€‚ å‘å³éå†ï¼Œcol1=25ä¸æ»¡è¶³æ¡ä»¶ï¼Œé€€åŒ–ä¸ºé—´éš™é” æ‰€ä»¥ä¼šåŠ ä¸Šé—´éš™é”(20,25) å’Œ next-key lock (15,20] ã€‚</p>
<p>2.åœ¨ç´¢å¼• col1 ä¸Šå‘å·¦éå†ï¼Œè¦æ‰«æåˆ° col1=10 æ‰åœä¸‹æ¥ã€‚åŒæ—¶åˆå› ä¸ºå·¦å¼€å³é—­åŒºé—´ï¼Œæ‰€ä»¥ next-keylock ä¼šåŠ åˆ° (5,10] ï¼Œè¿™æ­£æ˜¯é˜»å¡session B çš„ insert è¯­å¥çš„åŸå› ã€‚</p>
<p>3.åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œ col1=20 ã€ col1=15 ã€ col1=10 è¿™ä¸‰è¡Œéƒ½å­˜åœ¨å€¼ï¼Œç”±äºæ˜¯ select * ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸»é”®id ä¸ŠåŠ ä¸‰ä¸ªè¡Œé”ã€‚ å› æ­¤ï¼Œ session A çš„ select è¯­å¥é”çš„èŒƒå›´å°±æ˜¯ï¼š</p>
<ol>
<li><p>ç´¢å¼• col1 ä¸Š (5, 25) ï¼› </p>
</li>
<li><p>ä¸»é”®ç´¢å¼•ä¸Š id=15 ã€ 20 ä¸¤ä¸ªè¡Œé”ã€‚ </p>
</li>
</ol>
<h4 id="æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤"><a href="#æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤" class="headerlink" title="æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤"></a>æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤</h4><p><img src="/2022/04/22/MySQL/1651828065888.png" alt="1651828065888" loading="lazy"></p>
<p>æ³¨æ„ï¼šæ ¹æ® col1&gt;5 æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯ col1=10 ï¼Œå› æ­¤ä¸ä¼šåŠ  (0,5] è¿™ä¸ª next-key lock ã€‚ </p>
<p>session A çš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼• col1 ä¸Šçš„ (5,10] ã€ (10,15] ã€ (15,20] ã€ (20,25] å’Œ(25,supremum] ã€‚ </p>
<p>ä¹‹å session B çš„ç¬¬ä¸€ä¸ª update è¯­å¥ï¼Œè¦æŠŠ col1=5 æ”¹æˆ col1=1 ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š </p>
<ol>
<li><p>æ’å…¥ (col1=1, id=5) è¿™ä¸ªè®°å½•ï¼› </p>
</li>
<li><p>åˆ é™¤ (col1=5, id=5) è¿™ä¸ªè®°å½•ã€‚ </p>
</li>
</ol>
<p>é€šè¿‡è¿™ä¸ªæ“ä½œï¼Œ session A çš„åŠ é”èŒƒå›´å˜æˆäº†å›¾ 7 æ‰€ç¤ºçš„æ ·å­ï¼š<img src="/2022/04/22/MySQL/1651828226607.png" alt="1651828226607" loading="lazy"></p>
<p>æ¥ä¸‹æ¥ session B è¦æ‰§è¡Œ update t set col1 = 5 where col1 = 1 è¿™ä¸ªè¯­å¥äº†ï¼Œä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥ï¼š </p>
<ol>
<li><p>æ’å…¥ (col1=5, id=5) è¿™ä¸ªè®°å½•ï¼› </p>
</li>
<li><p>åˆ é™¤ (col1=1, id=5) è¿™ä¸ªè®°å½•ã€‚ ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„ (1,10) ä¸­æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±è¢«å µä½äº†ã€‚</p>
</li>
</ol>
<h2 id="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"><a href="#å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶" class="headerlink" title="å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"></a>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h2><h3 id="1-å‰ææ¦‚è¦"><a href="#1-å‰ææ¦‚è¦" class="headerlink" title="1.å‰ææ¦‚è¦"></a>1.å‰ææ¦‚è¦</h3><h4 id="1-ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯MVCCï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯MVCCï¼Ÿ</h4><p>MVCCï¼ˆMulti-Version Consurrency Controllerï¼‰ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚é¡¾åæ€ä¹‰ï¼ŒMVCCæ˜¯é€šè¿‡æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç®¡ç†æ¥å®ç°æ•°æ®åº“çš„<strong>å¹¶å‘æ§åˆ¶</strong>è¿™é¡¹æŠ€æœ¯ä½¿å¾—åœ¨InnoDBçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œä¸€è‡´æ€§è¯»æ“ä½œæœ‰äº†ä¿è¯ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸€äº›æ­£åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œï¼Œå¹¶ä¸”å¯ä»¥è¢«æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œè¿™æ ·æŸ¥è¯¢çš„æ—¶å€™å°±ä¸ç”¨ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾é”ã€‚</p>
<blockquote>
<p>MVCCåœ¨InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å¤„ç†è¯»-å†™å†²çªï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°ä¸åŠ é”ï¼Œéé˜»å¡å¹¶å‘è¯»</p>
</blockquote>
<h4 id="2-å½“å‰è¯»å’Œå¿«ç…§è¯»"><a href="#2-å½“å‰è¯»å’Œå¿«ç…§è¯»" class="headerlink" title="2.å½“å‰è¯»å’Œå¿«ç…§è¯»"></a>2.å½“å‰è¯»å’Œå¿«ç…§è¯»</h4><ul>
<li>MVCCå¯ä»¥åšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿå¯ä»¥<strong>ä¸åŠ é”ã€éé˜»å¡è¯»</strong>ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„æ˜¯<strong>å¿«ç…§è¯»</strong>ï¼Œè€Œä¸æ˜¯<strong>å½“å‰è¯»</strong>ã€‚å½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°ï¼Œè€ŒMVCCæ˜¯é‡‡ç”¨ä¹è§‚é”æ€æƒ³çš„ä¸€ç§æ–¹å¼ã€‚</li>
</ul>
<h5 id="2-1å¿«ç…§è¯»"><a href="#2-1å¿«ç…§è¯»" class="headerlink" title="2.1å¿«ç…§è¯»"></a>2.1å¿«ç…§è¯»</h5><p>å¿«ç…§è¯»åˆå«ä¸€è‡´æ€§è¯»ï¼Œè¯»å–çš„æ˜¯å¿«ç…§æ•°æ®ã€‚<strong>ä¸åŠ é”çš„ç®€å•çš„SELECTéƒ½å±äºå¿«ç…§è¯»</strong>ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM player WHERE ...</span><br></pre></td></tr></table></figure>

<p>ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºMVCCï¼Œä»–åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé¿å…åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ã€‚</p>
<p>æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰å†å²ç‰ˆæœ¬ã€‚</p>
<p>å¿«ç…§è¯»çš„<strong>å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«</strong>ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–ä¸ºå½“å‰è¯»ã€‚</p>
<h5 id="2-2å½“å‰è¯»"><a href="#2-2å½“å‰è¯»" class="headerlink" title="2.2å½“å‰è¯»"></a>2.2å½“å‰è¯»</h5><p>å½“å‰è¯»è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆæœ€æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®ï¼‰ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰äº‹åŠ¡ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚åŠ é”çš„SELECTï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM student LOCK IN SHARE MODE;#å…±äº«é”</span><br><span class="line">SELECT * FROM student FOR UPDATE;#æ’ä»–é”</span><br><span class="line">SELECT * INTO student VALUES...;#æ’ä»–é”</span><br><span class="line">SELECT * FROM srudent WHERE ...;#æ’ä»–é”</span><br><span class="line">UPDATE student SET ...;#æ’ä»–é”</span><br></pre></td></tr></table></figure>

<h4 id="3-å½“å‰è¯»ã€å¿«ç…§è¯»å’ŒMVCCCçš„å…³ç³»"><a href="#3-å½“å‰è¯»ã€å¿«ç…§è¯»å’ŒMVCCCçš„å…³ç³»" class="headerlink" title="3.å½“å‰è¯»ã€å¿«ç…§è¯»å’ŒMVCCCçš„å…³ç³»"></a>3.å½“å‰è¯»ã€å¿«ç…§è¯»å’ŒMVCCCçš„å…³ç³»</h4><ul>
<li>MVCCå¹¶å‘æ§åˆ¶æ˜¯<strong>ç»´æŒä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çª</strong>çš„æ¦‚å¿µï¼Œåªæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶éå®ç°</li>
<li>å› ä¸ºMVCCåªæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œè¦å®ç°è¿™ä¸ªæ¦‚å¿µï¼ŒMySQLå°±éœ€è¦æä¾›å…·ä½“çš„åŠŸèƒ½å»å®ç°å®ƒï¼Œ<strong>å¿«ç…§è¯»å°±æ˜¯MySQLå®ç°MVCCç†æƒ³æ¨¡å‹çš„å…¶ä¸­ä¸€ä¸ªéé˜»å¡è¯»åŠŸèƒ½</strong>ã€‚è€Œå½“å‰è¯»å°±æ˜¯æ‚²è§‚é”çš„å…·ä½“åŠŸèƒ½å®ç°</li>
<li>è¦è¯´çš„å†ç»†è‡´ä¸€äº›ï¼Œå¿«ç…§è¯»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå†æ·±å…¥ç ”ç©¶ï¼ŒMVCCæ¨¡å‹åœ¨MySQLä¸­çš„å…·ä½“å®ç°æ˜¯ç”±<strong>3ä¸ªéšå¼å­—æ®µã€unoæ—¥å¿—ã€read Viewç­‰å»å®Œæˆçš„</strong>ã€‚</li>
</ul>
<h3 id="2-MVCCèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå¥½å¤„ï¼Ÿ"><a href="#2-MVCCèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå¥½å¤„ï¼Ÿ" class="headerlink" title="2.MVCCèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå¥½å¤„ï¼Ÿ"></a>2.MVCCèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå¥½å¤„ï¼Ÿ</h3><p><strong>æ•°æ®åº“å¹¶å‘åœºæ™¯åˆ†ä¸‰ç§ï¼Œåˆ†åˆ«ä¸ºï¼š</strong></p>
<ul>
<li>è¯»-è¯»ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å¹¶å‘æ§åˆ¶</li>
<li>è¯»-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šé€ æˆäº‹åŠ¡éš”ç¦»æ€§é—®é¢˜ï¼Œå¯èƒ½é‡åˆ°è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»</li>
<li>å†™-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ›´æ–°ä¸¢å¤±é—®é¢˜ã€‚</li>
</ul>
<p><strong>å¸¦æ¥çš„å¥½å¤„ï¼š</strong></p>
<p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ˜¯ä¸€ç§ç”¨æ¥è§£å†³è¯»-å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“å¿«ç…§ã€‚æ‰€ä»¥MVCCå¯ä»¥ä¸ºæ•°æ®åº“è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>åœ¨å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åšåˆ°åœ¨è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œï¼Œæé«˜äº†æ•°æ®åº“å¹¶å‘è¯»å†™çš„æ€§èƒ½</li>
<li>åŒæ—¶è¿˜å¯ä»¥è§£å†³è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜</li>
</ul>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å½¢æˆä¸¤ä¸ªç»„åˆï¼š</p>
<ul>
<li><p>MVCC+æ‚²è§‚é”</p>
<p>MVCCè§£å†³è¯»å†™å†²çªï¼Œæ‚²è§‚é”è§£å†³å†™å†™å†²çª</p>
</li>
<li><p>MVCC+ä¹è§‚é”</p>
<p>MVCCè§£å†³è¯»å†™å†²çªï¼Œä¹è§‚é”è§£å†³å†™å†™å†²çª</p>
</li>
</ul>
<h3 id="3-MVCCå®ç°åŸç†"><a href="#3-MVCCå®ç°åŸç†" class="headerlink" title="3.MVCCå®ç°åŸç†"></a>3.MVCCå®ç°åŸç†</h3><h4 id="3-1å‰æçŸ¥è¯†"><a href="#3-1å‰æçŸ¥è¯†" class="headerlink" title="3.1å‰æçŸ¥è¯†"></a>3.1å‰æçŸ¥è¯†</h4><h5 id="1-å†è°ˆéš”ç¦»çº§åˆ«"><a href="#1-å†è°ˆéš”ç¦»çº§åˆ«" class="headerlink" title="1.å†è°ˆéš”ç¦»çº§åˆ«"></a>1.å†è°ˆéš”ç¦»çº§åˆ«</h5><p>äº‹åŠ¡ç”±å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œå¯èƒ½å­˜åœ¨3ç§å¹¶å‘é—®é¢˜ï¼š<img src="/2022/04/22/MySQL/1651886095147.png" alt="1651886095147" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1651886137530.png" alt="1651886137530" loading="lazy"></p>
<h5 id="2-éšè—å­—æ®µã€undo-logç‰ˆæœ¬é“¾"><a href="#2-éšè—å­—æ®µã€undo-logç‰ˆæœ¬é“¾" class="headerlink" title="2.éšè—å­—æ®µã€undo logç‰ˆæœ¬é“¾"></a>2.éšè—å­—æ®µã€undo logç‰ˆæœ¬é“¾</h5><blockquote>
<p>éšå¼å­—æ®µ</p>
</blockquote>
<p>æ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„DB_TRX_ID,DB_ROLL_PTR,DB_ROW_IDç­‰å­—æ®µ</p>
<ul>
<li><p>DB_TRX_ID</p>
<p>6 byteï¼Œæœ€è¿‘ä¿®æ”¹ï¼ˆä¿®æ”¹/æ’å…¥ï¼‰äº‹åŠ¡IDï¼šè®°å½•åˆ›å»ºè¿™æ¡è®°å½•/æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID</p>
</li>
<li><p>DB_ROLL_PTR</p>
<p>7 byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆå­˜å‚¨åœ¨rollback segmenté‡Œï¼‰</p>
</li>
<li><p>DB_ROW_ID</p>
<p>6 byteï¼Œéšå«çš„è‡ªå¢IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šè‡ªåŠ¨ä»¥DB_ROW_IDäº§ç”Ÿä¸€ä¸ªèšç°‡ç´¢å¼•</p>
</li>
<li><p>å®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªåˆ é™¤flagéšè—å­—æ®µï¼Œæ—¢è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº†ã€‚</p>
</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651886935823.png" alt="1651886935823" loading="lazy"></p>
<p>å¦‚ä¸Šå›¾ï¼ŒDB_ROW_IDæ˜¯æ•°æ®åº“é»˜è®¤ä¸ºè¯¥è®°å½•ç”Ÿæˆçš„å”¯ä¸€ä¸»é”®ï¼ŒDB_TRX_IDæ˜¯å½“å‰æ“ä½œè¯¥è®°å½•çš„äº‹åŠ¡IDï¼Œè€ŒDB_ROLL_PTRæ˜¯ä¸€ä¸ªå›æ»šæŒ‡é’ˆï¼Œç”¨äºé…åˆundoæ—¥å¿—ï¼ŒæŒ‡å‘å½“å‰è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>undoæ—¥å¿—</p>
</blockquote>
<p>undo logä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><p>insert undo log</p>
<p>ä»£è¡¨äº‹åŠ¡åœ¨insertæ–°çºªå½•æ—¶äº§ç”Ÿçš„undo logï¼Œåªåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥ç«‹å³è¢«ä¸¢å¼ƒ</p>
</li>
<li><p>update undo log</p>
<p>äº‹åŠ¡åœ¨è¿›è¡Œupdateæˆ–deleteæ—¶äº§ç”Ÿçš„undo logï¼›ä¸ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼›æ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰åœ¨å¿«ç…§è¯»æˆ–äº‹åŠ¡å›æ»šä¸æ¶‰åŠè¯¥æ—¥å¿—æ—¶ï¼Œå¯¹åº”çš„æ—¥å¿—æ‰ä¼šè¢«purgeçº¿ç¨‹ç»Ÿä¸€æ¸…é™¤</p>
</li>
</ul>
<blockquote>
<p>purge</p>
<ul>
<li>ä»å‰é¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†å®ç° InnoDB çš„ MVCC æœºåˆ¶ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œéƒ½åªæ˜¯è®¾ç½®ä¸€ä¸‹è€è®°å½•çš„ deleted_bit ï¼Œå¹¶ä¸çœŸæ­£å°†è¿‡æ—¶çš„è®°å½•åˆ é™¤ã€‚</li>
<li>ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒInnoDB æœ‰ä¸“é—¨çš„ purge çº¿ç¨‹æ¥æ¸…ç† deleted_bit ä¸º true çš„è®°å½•ã€‚ä¸ºäº†ä¸å½±å“ MVCC çš„æ­£å¸¸å·¥ä½œï¼Œpurge çº¿ç¨‹è‡ªå·±ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªread viewï¼ˆè¿™ä¸ª read view ç›¸å½“äºç³»ç»Ÿä¸­æœ€è€æ´»è·ƒäº‹åŠ¡çš„ read view ï¼‰;å¦‚æœæŸä¸ªè®°å½•çš„ deleted_bit ä¸º true ï¼Œå¹¶ä¸” DB_TRX_ID ç›¸å¯¹äº purge çº¿ç¨‹çš„ read view å¯è§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•ä¸€å®šæ˜¯å¯ä»¥è¢«å®‰å…¨æ¸…é™¤çš„ã€‚</li>
</ul>
</blockquote>
<p>å¯¹MVCCæœ‰å¸®åŠ©çš„å®è´¨æ˜¯update undo logï¼Œundo logå®é™…ä¸Šå­˜åœ¨<strong>rollback segment</strong>ä¸­æ—§çºªå½•é“¾ï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1.<strong>æ¯”å¦‚ä¸€ä¸ªæœ‰ä¸ªäº‹åŠ¡æ’å…¥ persion è¡¨æ’å…¥äº†ä¸€æ¡æ–°è®°å½•ï¼Œè®°å½•å¦‚ä¸‹ï¼Œ<code>name</code> ä¸º Jerry , <code>age</code> ä¸º 24 å²ï¼Œ<code>éšå¼ä¸»é”®</code>æ˜¯ 1ï¼Œ<code>äº‹åŠ¡ ID</code>å’Œ<code>å›æ»šæŒ‡é’ˆ</code>ï¼Œæˆ‘ä»¬å‡è®¾ä¸º NULL</strong> </p>
<p><img src="/2022/04/22/MySQL/1651888551880.png" alt="1651888551880" loading="lazy"></p>
<p>2.<strong>ç°åœ¨æ¥äº†ä¸€ä¸ª<code>äº‹åŠ¡ 1</code>å¯¹è¯¥è®°å½•çš„ <code>name</code> åšå‡ºäº†ä¿®æ”¹ï¼Œæ”¹ä¸º Tom</strong> ã€‚</p>
<ul>
<li>åœ¨äº‹åŠ¡1ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆå¯¹è¯¥è¡ŒåŠ æ’ä»–é”</li>
<li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°undo logä¸­ï¼Œä½œä¸ºæ—§çºªå½•ï¼Œå³åœ¨undo logä¸­æœ‰å½“å‰è¡Œçš„å‰¯æœ¬</li>
<li>æ‹·è´å®Œåï¼Œä¿®æ”¹æ”¹è¡Œçš„nameä¸ºTomï¼Œå¹¶ä¸”éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰äº‹åŠ¡1çš„IDï¼Œé»˜è®¤ä»1å¼€å§‹ï¼Œä¹‹åé€’å¢ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘æ‹·è´åˆ°undo logçš„å‰¯æœ¬è®°å½•ï¼Œå³è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬æ˜¯å®ƒ</li>
<li>äº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾é”</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651888559444.png" alt="1651888559444" loading="lazy"></p>
<p>3**.åˆæ¥äº†ä¸ªäº‹åŠ¡2ä¿®æ”¹personè¡¨çš„åŒä¸€ä¸ªè®°å½•ï¼Œå°†ageä¿®æ”¹ä¸º30å²**</p>
<ul>
<li>åœ¨äº‹åŠ¡2ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¹Ÿä¸ºè¯¥è¡ŒåŠ é”</li>
<li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ°undo logä¸­ï¼Œä½œä¸ºæ—§çºªå½•ï¼Œå‘ç°è¯¥è¡Œè®°å½•å·²æœ‰undo logäº†ï¼Œé‚£ä¹ˆæœ€æ–°çš„æ—§æ•°æ®ä½œä¸ºé“¾è¡¨çš„è¡¨å¤´ï¼Œæ’åœ¨è¯¥è¡Œè®°å½•çš„undo logæœ€å‰é¢</li>
<li>ä¿®æ”¹è¯¥è¡Œè®°å½•ageä¸º30ï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡IDä¸ºå½“å‰äº‹åŠ¡2çš„IDï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘åˆšåˆšæ‹·è´åˆ°undo logçš„å‰¯æœ¬è®°å½•</li>
<li>äº‹åŠ¡æäº¤ï¼Œé‡Šæ”¾é”</li>
</ul>
<p><img src="/2022/04/22/MySQL/1651890657023.png" alt="1651890657023" loading="lazy"></p>
<p>ä»ä¸Šé¢ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸åŒäº‹åŠ¡æˆ–è€…ç›¸åŒäº‹åŠ¡çš„å¯¹åŒä¸€è®°å½•çš„ä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„undo logæˆä¸ºä¸€æ¡è®°å½•ç‰ˆæœ¬çº¿æ€§è¡¨ï¼Œå³é“¾è¡¨ï¼Œundo logçš„é“¾è¡¨é¦–éƒ¨å°±æ˜¯æœ€æ–°çš„æ—§çºªå½•ï¼Œé“¾è¡¨å°¾éƒ¨å°±æ˜¯æœ€æ—©çš„æ—§çºªå½•</p>
<h4 id="3-2å®ç°åŸç†ä¹‹ReadView"><a href="#3-2å®ç°åŸç†ä¹‹ReadView" class="headerlink" title="3.2å®ç°åŸç†ä¹‹ReadView"></a>3.2å®ç°åŸç†ä¹‹ReadView</h4><p>MVCCçš„å®ç°ä¾èµ–äºï¼šéšè—å­—æ®µã€undo logã€readview</p>
<hr>
<h5 id="ä»€ä¹ˆæ˜¯ReadView"><a href="#ä»€ä¹ˆæ˜¯ReadView" class="headerlink" title="ä»€ä¹ˆæ˜¯ReadView"></a>ä»€ä¹ˆæ˜¯ReadView</h5><p>readviewå°±æ˜¯äº‹åŠ¡è¿›è¡Œå¿«ç…§è¯»æ“ä½œçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„è¯»è§†å›¾ï¼ˆReadViewï¼‰ï¼Œåœ¨è¯¥äº‹åŠ¡æ‰§è¡Œåˆ°å¿«ç…§è¯»é‚£ä¸€åˆ»ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ•°æ®åº“å½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤å½“å‰æ´»è·ƒçš„äº‹åŠ¡çš„IDï¼ˆå½“æ¯ä¸ªäº‹åŠ¡å¼€å¯æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªIDï¼Œè¿™ä¸ªIDæ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥æœ€æ–°çš„äº‹åŠ¡ï¼ŒIDå€¼æœ€å¤§ï¼‰</p>
<p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº†ReadViewæ˜¯ç”¨æ¥åšå¯è¿›è¡Œåˆ¤æ–­çš„ï¼Œå³å½“æˆ‘ä»¬æŸä¸ªäº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ã€‚ä¸ºè¯¥è®°å½•åˆ›å»ºä¸€ä¸ªç³»ç»Ÿçš„ReadViewè¯»è§†å›¾ï¼Œå°†å…¶ä½œä¸ºåˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå³å¯èƒ½æ˜¯æœ€æ–°çš„ä¹Ÿå¯èƒ½æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®ã€‚</p>
<h5 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h5><p>ä½¿ç”¨READ UNCOMMITEDï¼ˆè¯»æœªæäº¤ï¼‰éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–æœ€æ–°ç‰ˆæœ¬</p>
<p>ä½¿ç”¨SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼ŒInnoDBè§„å®šä½¿ç”¨åŠ é”æ–¹å¼è®¿é—®è®°å½•</p>
<p>ä½¿ç”¨READ COMMITEDï¼ˆè¯»æäº¤ï¼‰å’ŒREPREATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œéƒ½å¿…é¡»ä¿è¯è¯»åˆ°å·²æäº¤äº†çš„äº‹åŠ¡ä¿®æ”¹è¿‡çš„è®°å½•ã€‚å‡å¦‚å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»ä¿®æ”¹äº†è®°å½•ä½†å°šæœªæäº¤ï¼Œæ˜¯ä¸èƒ½è¯»å–åˆ°æœ€æ–°ç‰ˆæœ¬çš„è®°å½•çš„ï¼Œ<strong>æ ¸å¿ƒé—®é¢˜åœ¨äºéœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬é“¾ä¸­å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰äº‹åŠ¡å¯è§çš„è¿™æ˜¯ReadViewä¸»è¦è§£å†³çš„é—®é¢˜</strong></p>
<p><strong>ReadView</strong>éµå¾ªä¸€ä¸ªå¯è¿›è¡Œç®—æ³•ï¼Œä¸»è¦æ˜¯å°†<strong>è¦è¢«ä¿®æ”¹çš„æ•°æ®</strong>çš„æœ€æ–°è®°å½•ä¸­çš„DB_TRX_IDï¼ˆå³å½“å‰äº‹åŠ¡IDï¼‰å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡çš„IDå¯¹æ¯”ï¼ˆç”±ReadViewç»´æŠ¤ï¼‰ï¼Œå¦‚æœDB_TRX_IDè·ŸRead Viewçš„å±æ€§åšäº†æ¯”è¾ƒï¼Œä¸ç¬¦åˆå¯è§æ€§ï¼Œé‚£å°±é€šè¿‡DB_ROLL_PTRå›æ»šæŒ‡é’ˆå»å–å‡ºundo logä¸­çš„DB_TRX_IDå†æ¯”è¾ƒï¼Œæ—¢éå†é“¾è¡¨çš„DB_TRX_IDï¼ˆä»é“¾è¡¨é¦–åˆ°é“¾è¡¨å°¾ï¼Œå³ä»æœ€è¿‘ä¸€æ¬¡æŸ¥èµ·ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„DB_TRX_IDï¼Œé‚£ä¹ˆ<strong>è¿™ä¸ªDB_TRX_IDæ‰€åœ¨è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°è€ç‰ˆæœ¬</strong></p>
<p>ReadViewä¸­ä¸»è¦åŒ…å«4ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼š</p>
<ol>
<li><p><strong>creator_trx_id</strong>ï¼Œåˆ›å»ºè¿™ä¸ªRead Viewçš„äº‹åŠ¡IDã€‚</p>
</li>
<li><p><strong>trx_ids</strong>ï¼Œè¡¨ç¤ºåœ¨ç”ŸæˆRead Viewæ—¶ï¼Œå½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡idåˆ—è¡¨</p>
</li>
<li><p>up_limit_idï¼Œæ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ID</p>
</li>
<li><p>low_limit_idï¼Œè¡¨ç¤ºç”ŸæˆReadViewæ—¶ç³»ç»Ÿä¸­ä¸‹ä¸€ä¸ªäº‹åŠ¡åº”è¯¥åˆ†é…äº‹åŠ¡IDï¼Œä¹Ÿå°±æ˜¯ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼+1ã€‚low_lmit_idæ˜¯ç³»ç»Ÿæœ€å¤§çš„äº‹åŠ¡IDå€¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç³»ç»Ÿä¸­çš„äº‹åŠ¡IDï¼Œéœ€è¦åŒºåˆ«äºæ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡IDã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šlow_limit_idå¹¶ä¸æ˜¯trx_idsæœ€å¤§å€¼ï¼Œäº‹åŠ¡idæ˜¯é€’å¢åˆ†é…çš„æ¯”å¦‚ï¼Œç°åœ¨æœ‰idä¸º1ï¼Œ2ï¼Œ3è¿™ä¸‰ä¸ªäº‹åŠ¡ï¼Œä¹‹åidä¸º3çš„äº‹åŠ¡æäº¤äº†ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„äº‹åŠ¡åœ¨ç”ŸæˆReadViewæ—¶ï¼Œtrx_idså°±åŒ…æ‹¬1å’Œ2ï¼Œup_limit_idçš„å€¼å°±æ˜¯1ï¼Œlow_limit_idçš„å€¼å°±æ˜¯4.</p>
</blockquote>
</li>
</ol>
<h5 id="ReadViewçš„è§„åˆ™"><a href="#ReadViewçš„è§„åˆ™" class="headerlink" title="ReadViewçš„è§„åˆ™"></a>ReadViewçš„è§„åˆ™</h5><p>æœ‰äº†è¿™ä¸ªReadViewï¼Œè¿™æ ·åœ¨è®¿é—®æŸæ¡è®°å½•æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§ä¸‹è¾¹çš„æ­¥éª¤åˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§</p>
<ul>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬ çš„<strong>DB_TRX_ID</strong>å€¼ä¸ReadViewä¸­çš„<strong>creator_limit_id</strong>å€¼ç›¸åŒï¼Œæ„å‘³ç€å½“å‰äº‹åŠ¡åœ¨è®¿é—®ä»–è‡ªå·±ä¿®æ”¹è¿‡çš„è®°å½•ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡çœ‹è§</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<strong>DB_TRX_ID&lt;up_limit_id</strong>,è¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥å½“å‰ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<strong>DB_TRX_ID&gt;=low_limit_id</strong>è¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ç”ŸæˆReadViewåæ‰å¼€å¯ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯è¢«å½“å‰äº‹åŠ¡è®¿é—®</li>
<li>å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„<strong>DB_TRX_IDçš„å€¼åœ¨up_limit_idå’Œlow_limit_idä¹‹é—´</strong>å°±éœ€è¦åˆ¤æ–­DB_TRX_IDæ˜¯å¦åœ¨trx_idsåˆ—è¡¨ä¸­ï¼›<ul>
<li>å¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ´»è·ƒï¼Œè¯¥ç‰ˆæœ¬ä¸å¯è®¿é—®</li>
<li>å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»æäº¤ï¼Œè¯¥ç‰ˆæœ¬å‘¢å¯ä»¥è®¿é—®</li>
</ul>
</li>
</ul>
<h4 id="3-3æ•´ä½“æµç¨‹"><a href="#3-3æ•´ä½“æµç¨‹" class="headerlink" title="3.3æ•´ä½“æµç¨‹"></a>3.3æ•´ä½“æµç¨‹</h4><p>å½“æˆ‘ä»¬æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼Œç³»ç»Ÿé€šè¿‡MVCCæŸ¥æ‰¾æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆè·å–äº‹åŠ¡è‡ªå·±çš„äº‹åŠ¡ID</li>
<li>è·å–ReadView</li>
<li>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ReadViewä¸­äº‹åŠ¡çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒ</li>
<li>å¦‚æœä¸ç¬¦åˆReadViewè°·è§„åˆ™ï¼Œå°±éœ€è¦ä»undo logä¸­è·å–å†å²å¿«ç…§</li>
<li>æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®</li>
</ol>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­</p>
</blockquote>
<ul>
<li><p>å½“äº‹åŠ¡ 2å¯¹æŸè¡Œæ•°æ®æ‰§è¡Œäº†å¿«ç…§è¯»ï¼Œæ•°æ®åº“ä¸ºè¯¥è¡Œæ•°æ®ç”Ÿæˆä¸€ä¸ªRead Viewè¯»è§†å›¾ï¼Œå‡è®¾å½“å‰äº‹åŠ¡ ID ä¸º 2ï¼Œæ­¤æ—¶è¿˜æœ‰äº‹åŠ¡1å’Œäº‹åŠ¡3åœ¨æ´»è·ƒä¸­ï¼Œäº‹åŠ¡ 4åœ¨äº‹åŠ¡ 2å¿«ç…§è¯»å‰ä¸€åˆ»æäº¤æ›´æ–°äº†ï¼Œæ‰€ä»¥ Read View è®°å½•äº†ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡ 1ï¼Œ3 çš„ IDï¼Œç»´æŠ¤åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸Šï¼Œå‡è®¾æˆ‘ä»¬ç§°ä¸ºtrx_ids<img src="/2022/04/22/MySQL/1651908943761.png" alt="1651908943761" loading="lazy"></p>
</li>
<li><p>Read Viewä¸ä»…ä»…ä¼šé€šè¿‡ä¸€ä¸ªåˆ—è¡¨trx_idsæ¥ç»´æŠ¤äº‹åŠ¡2æ‰§è¡Œå¿«ç…§è¯»é‚£åˆ»ç³»ç»Ÿæ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡IDï¼Œè¿˜æœ‰ä¸¤ä¸ªå±æ€§up_limit_id(trx_idsä¸­äº‹åŠ¡IDæœ€å°çš„ID)ï¼Œlow_limit_id(å¿«ç…§è¯»æ—¶åˆ»ç³»ç»Ÿä¸‹ä¸€ä¸ªå°šæœªåˆ†é…çš„äº‹åŠ¡IDï¼Œä¹Ÿå°±æ˜¯ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼+1)æ‰€ä»¥è¿™é‡Œup_limit_idæ˜¯1ï¼Œlow_limit_idæ˜¯4+1=5ï¼Œtrx_idsçš„å€¼æ˜¯1ï¼Œ3ï¼ŒReadViewå¦‚å›¾ï¼š<img src="/2022/04/22/MySQL/1651909261231.png" alt="1651909261231" loading="lazy"></p>
</li>
<li><p>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåªæœ‰<strong>äº‹åŠ¡4</strong>ä¿®æ”¹è¿‡è¯¥è¡Œè®°å½•ï¼Œå¹¶åœ¨äº‹åŠ¡2æ‰§è¡Œå¿«ç…§è¯»å‰ï¼Œå°±æäº¤äº‹åŠ¡ã€‚æ‰€ä»¥å½“å‰è¯¥è¡Œæ•°æ®çš„undo logå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šæˆ‘ä»¬çš„äº‹åŠ¡2åœ¨å¿«ç…§è¯»è¯¥è¡Œè®°å½•çš„æ—¶å€™ï¼Œå°±ä¼šæ‹¿è¯¥è¡Œè®°å½•çš„<strong>DB_TRX_ID</strong>å»è·Ÿ<strong>up_limit_id,low_limit_id</strong>å’Œ<strong>æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨ï¼ˆtrx_idsï¼‰</strong>è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­å½“å‰äº‹åŠ¡2èƒ½çœ‹åˆ°è¯¥è®°å½•çš„ç‰ˆæœ¬æ˜¯å“ªä¸ª<img src="/2022/04/22/MySQL/1651911811794.png" alt="1651911811794" loading="lazy"></p>
</li>
<li><p>æ‰€ä»¥å…ˆæ‹¿è¯¥è®°å½• DB_TRX_ID å­—æ®µè®°å½•çš„äº‹åŠ¡ ID 4 å»è·Ÿ Read View çš„ up_limit_id æ¯”è¾ƒï¼Œçœ‹ 4 æ˜¯å¦å°äº up_limit_id( 1 )ï¼Œæ‰€ä»¥ä¸ç¬¦åˆæ¡ä»¶ï¼Œç»§ç»­åˆ¤æ–­ 4 æ˜¯å¦å¤§äºç­‰äº low_limit_id( 5 )ï¼Œä¹Ÿä¸ç¬¦åˆæ¡ä»¶ï¼Œæœ€ååˆ¤æ–­ 4 æ˜¯å¦å¤„äº trx_list ä¸­çš„æ´»è·ƒäº‹åŠ¡, æœ€åå‘ç°äº‹åŠ¡ ID ä¸º 4 çš„äº‹åŠ¡ä¸åœ¨å½“å‰æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­, ç¬¦åˆå¯è§æ€§æ¡ä»¶ï¼Œæ‰€ä»¥äº‹åŠ¡ 4ä¿®æ”¹åæäº¤çš„æœ€æ–°ç»“æœå¯¹äº‹åŠ¡ 2 å¿«ç…§è¯»æ—¶æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥äº‹åŠ¡ 2 èƒ½è¯»åˆ°çš„æœ€æ–°æ•°æ®è®°å½•æ˜¯äº‹åŠ¡4æ‰€æäº¤çš„ç‰ˆæœ¬ï¼Œè€Œäº‹åŠ¡4æäº¤çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å…¨å±€è§’åº¦ä¸Šæœ€æ–°çš„ç‰ˆæœ¬<img src="/2022/04/22/MySQL/1651911900429.png" alt="1651911900429" loading="lazy"></p>
</li>
</ul>
<blockquote>
<p>æ­£æ˜¯ç”±äºReadViewç”Ÿæˆçš„æ—¶æœºä¸åŒï¼Œä»è€Œé€ æˆRC,RRçº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœä¸åŒ</p>
</blockquote>
<p>åœ¨éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤ï¼ˆRead Committedï¼‰æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ¯ä¸€æ¬¡ SELECT æŸ¥è¯¢éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ Read Viewã€‚</p>
<p><img src="/2022/04/22/MySQL/1651912021363.png" alt="1651912021363" loading="lazy"></p>
<p><strong>æ³¨æ„ï¼Œæ­¤æ—¶åŒæ ·çš„æŸ¥è¯¢è¯­å¥éƒ½ä¼šé‡æ–°è·å–ä¸€æ¬¡ReadViewï¼Œè¿™æ—¶å¦‚æœReadViewä¸åŒï¼Œå°±å¯èƒ½äº§ç”Ÿä¸å¯é‡å¤åº¦æˆ–å¹»è¯»æƒ…å†µ</strong></p>
<hr>
<p>å½“éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»çš„æ—¶å€™ï¼Œå°±é¿å…äº†ä¸å¯é‡å¤è¯»ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªäº‹åŠ¡åªåœ¨ç¬¬ä¸€æ¬¡ SELECT çš„æ—¶å€™ä¼š </p>
<p>è·å–ä¸€æ¬¡ Read Viewï¼Œè€Œåé¢æ‰€æœ‰çš„ SELECT éƒ½ä¼šå¤ç”¨è¿™ä¸ª Read Viewï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š <img src="/2022/04/22/MySQL/1651912164535.png" alt="1651912164535" loading="lazy"></p>
<h3 id="4-ä¸¾ä¾‹è¯´æ˜"><a href="#4-ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="4.ä¸¾ä¾‹è¯´æ˜"></a>4.ä¸¾ä¾‹è¯´æ˜</h3><h4 id="4-1READ-COMITEDéš”ç¦»çº§åˆ«"><a href="#4-1READ-COMITEDéš”ç¦»çº§åˆ«" class="headerlink" title="4.1READ COMITEDéš”ç¦»çº§åˆ«"></a>4.1READ COMITEDéš”ç¦»çº§åˆ«</h4><p>READ COMMITED:æ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ªReadView</p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ª<strong>äº‹åŠ¡id</strong>åˆ†åˆ«ä¸º10ã€20çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼š<img src="/2022/04/22/MySQL/1651912356028.png" alt="1651912356028" loading="lazy"></p>
<p>æ­¤åˆ»ï¼Œè¡¨studentä¸­idä¸º1çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1651912394286.png" alt="1651912394286" loading="lazy"></p>
<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨READ COMMITEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š<img src="/2022/04/22/MySQL/1651912445005.png" alt="1651912445005" loading="lazy"></p>
<p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ<strong>äº‹åŠ¡id</strong>ä¸º10çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651912521199.png" alt="1651912521199" loading="lazy"></p>
<p>ç„¶åå†åˆ°äº‹åŠ¡idä¸º20çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨studentä¸­idä¸º1çš„è®°å½•ï¼š<img src="/2022/04/22/MySQL/1651912610232.png" alt="1651912610232" loading="lazy"></p>
<p>åˆºå®¢ï¼Œè¡¨studentä¸­idä¸º1çš„è®°å½•çš„ç‰ˆæœ¬é“¾å°±é•¿æˆè¿™æ ·ï¼š<img src="/2022/04/22/MySQL/1651912651986.png" alt="1651912651986" loading="lazy"></p>
<p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨ READ COMMITTED éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª id ä¸º 1 çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1651912669153.png" alt="1651912669153" loading="lazy"></p>
<h4 id="4-2REPEATABLE-READéš”ç¦»çº§åˆ«"><a href="#4-2REPEATABLE-READéš”ç¦»çº§åˆ«" class="headerlink" title="4.2REPEATABLE READéš”ç¦»çº§åˆ«"></a>4.2REPEATABLE READéš”ç¦»çº§åˆ«</h4><p>ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢å°±ä¸ä¼šé‡å¤ç”Ÿæˆäº†ã€‚</p>
<p>æ¯”å¦‚ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ªäº‹åŠ¡idåˆ†åˆ«ä¸º10ã€20çš„äº‹åŠ¡åœ¨æ‰§è¡Œï¼š<img src="/2022/04/22/MySQL/1651912961466.png" alt="1651912961466" loading="lazy"></p>
<p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•å¾—åˆ°çš„ç‰ˆæœ¬é“¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š<img src="/2022/04/22/MySQL/1651912972253.png" alt="1651912972253" loading="lazy"></p>
<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½¿ç”¨ REPEATABLE READ éš”ç¦»çº§åˆ«çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œï¼š <img src="/2022/04/22/MySQL/1651912982025.png" alt="1651912982025" loading="lazy"></p>
<p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠ äº‹åŠ¡id ä¸º 10 çš„äº‹åŠ¡æäº¤ä¸€ä¸‹ï¼Œå°±åƒè¿™æ ·ï¼š <img src="/2022/04/22/MySQL/1651912991132.png" alt="1651912991132" loading="lazy"></p>
<p>ç„¶åå†åˆ° äº‹åŠ¡id ä¸º 20 çš„äº‹åŠ¡ä¸­æ›´æ–°ä¸€ä¸‹è¡¨ student ä¸­ id ä¸º 1 çš„è®°å½•ï¼š <img src="/2022/04/22/MySQL/1651913001481.png" alt="1651913001481" loading="lazy"></p>
<p>æ­¤åˆ»ï¼Œè¡¨student ä¸­ id ä¸º 1 çš„è®°å½•çš„ç‰ˆæœ¬é“¾é•¿è¿™æ ·ï¼š <img src="/2022/04/22/MySQL/1651913014989.png" alt="1651913014989" loading="lazy"></p>
<p>ç„¶åå†åˆ°åˆšæ‰ä½¿ç”¨ REPEATABLE READ éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ä¸­ç»§ç»­æŸ¥æ‰¾è¿™ä¸ª id ä¸º 1 çš„è®°å½•ï¼Œå¦‚ä¸‹ï¼š <img src="/2022/04/22/MySQL/1651913025657.png" alt="1651913025657" loading="lazy"></p>
<h3 id="5-å¦‚ä½•è§£å†³å¹»è¯»"><a href="#5-å¦‚ä½•è§£å†³å¹»è¯»" class="headerlink" title="5.å¦‚ä½•è§£å†³å¹»è¯»"></a>5.å¦‚ä½•è§£å†³å¹»è¯»</h3><p>å‡è®¾ç°åœ¨è¡¨studentä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œæ•°æ®å†…å®¹ä¸­ï¼Œä¸»é”®id=1ï¼Œéšè—çš„DB_TRX_ID=10ï¼Œå®ƒçš„undo logå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<img src="/2022/04/22/MySQL/1651913181475.png" alt="1651913181475" loading="lazy"></p>
<p>å‡è®¾ç°åœ¨æœ‰äº‹åŠ¡Aå’Œäº‹åŠ¡Bå¹¶å‘æ‰§è¡Œï¼Œäº‹åŠ¡Açš„äº‹åŠ¡idä¸º20ï¼Œäº‹åŠ¡Bçš„äº‹åŠ¡idä¸º30ã€‚</p>
<p>æ­¥éª¤1ï¼šäº‹åŠ¡ A å¼€å§‹ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢çš„ SQL è¯­å¥å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student where id &gt;= 1;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¼€å§‹æŸ¥è¯¢ä¹‹å‰ï¼ŒMySQL ä¼šä¸ºäº‹åŠ¡ A äº§ç”Ÿä¸€ä¸ª ReadViewï¼Œæ­¤æ—¶ ReadView çš„å†…å®¹å¦‚ä¸‹ï¼š trx_ids= [20,30] ï¼Œ up_limit_id=20 ï¼Œ low_limit_id=31 ï¼Œ creator_trx_id=20 ã€‚ </p>
<p>ç”±äºæ­¤æ—¶è¡¨ student ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œä¸”ç¬¦åˆ where id&gt;=1 æ¡ä»¶ï¼Œå› æ­¤ä¼šæŸ¥è¯¢å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œå‘ç°è¯¥è¡Œæ•°æ®çš„trx_id=10ï¼Œå°äºäº‹åŠ¡ A çš„ ReadView é‡Œ up_limit_idï¼Œè¿™è¡¨ç¤ºè¿™æ¡æ•°æ®æ˜¯äº‹åŠ¡ A å¼€å¯ä¹‹å‰ï¼Œå…¶ä»–äº‹åŠ¡å°±å·²ç»æäº¤äº†çš„æ•°æ®ï¼Œå› æ­¤äº‹åŠ¡ A å¯ä»¥è¯»å–åˆ°ã€‚ </p>
<p>ç»“è®ºï¼šäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œèƒ½è¯»å–åˆ°ä¸€æ¡æ•°æ®ï¼Œid=1ã€‚ </p>
<p>æ­¥éª¤2ï¼šæ¥ç€äº‹åŠ¡ B(trx_id=30)ï¼Œå¾€è¡¨ student ä¸­æ–°æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œå¹¶æäº¤äº‹åŠ¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into student(id,name) values(2,&#x27;æå››&#x27;);</span><br><span class="line">insert into student(id,name) values(3,&#x27;ç‹äº”&#x27;);</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è¡¨student ä¸­å°±æœ‰ä¸‰æ¡æ•°æ®äº†ï¼Œå¯¹åº”çš„ undo å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š <img src="/2022/04/22/MySQL/1651913282692.png" alt="1651913282692" loading="lazy"></p>
<p>æ­¥éª¤3ï¼šæ¥ç€äº‹åŠ¡ A å¼€å¯ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæ ¹æ®å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„è§„åˆ™ï¼Œæ­¤æ—¶äº‹åŠ¡ A å¹¶ä¸ä¼šå†é‡æ–°ç”Ÿæˆ ReadViewã€‚æ­¤æ—¶è¡¨ student ä¸­çš„ 3 æ¡æ•°æ®éƒ½æ»¡è¶³ where id&gt;=1 çš„æ¡ä»¶ï¼Œå› æ­¤ä¼šå…ˆæŸ¥å‡ºæ¥ã€‚ç„¶åæ ¹æ® ReadView æœºåˆ¶ï¼Œåˆ¤æ–­æ¯æ¡æ•°æ®æ˜¯ä¸æ˜¯éƒ½å¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚ </p>
<p>1ï¼‰é¦–å…ˆ id=1 çš„è¿™æ¡æ•°æ®ï¼Œå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¯ä»¥è¢«äº‹åŠ¡ A çœ‹åˆ°ã€‚ </p>
<p>2ï¼‰ç„¶åæ˜¯ id=2 çš„æ•°æ®ï¼Œå®ƒçš„ trx_id=30ï¼Œæ­¤æ—¶äº‹åŠ¡ A å‘ç°ï¼Œè¿™ä¸ªå€¼å¤„äº up_limit_id å’Œ low_limit_id ä¹‹ é—´ï¼Œå› æ­¤è¿˜éœ€è¦å†åˆ¤æ–­ 30 æ˜¯å¦å¤„äº trx_ids æ•°ç»„å†…ã€‚ç”±äºäº‹åŠ¡ A çš„ trx_ids=[20,30]ï¼Œå› æ­¤åœ¨æ•°ç»„å†…ï¼Œè¿™è¡¨ ç¤º id=2 çš„è¿™æ¡æ•°æ®æ˜¯ä¸äº‹åŠ¡ A åœ¨åŒä¸€æ—¶åˆ»å¯åŠ¨çš„å…¶ä»–äº‹åŠ¡æäº¤çš„ï¼Œæ‰€ä»¥è¿™æ¡æ•°æ®ä¸èƒ½è®©äº‹åŠ¡ A çœ‹åˆ°ã€‚ </p>
<p>3ï¼‰åŒç†ï¼Œid=3 çš„è¿™æ¡æ•°æ®ï¼Œtrx_id ä¹Ÿä¸º 30ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«äº‹åŠ¡ A çœ‹è§ã€‚</p>
<p><img src="/2022/04/22/MySQL/1651913320851.png" alt="1651913320851" loading="lazy"></p>
<p>ç»“è®ºï¼šæœ€ç»ˆäº‹åŠ¡ A çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œåªèƒ½æŸ¥è¯¢å‡º id=1 çš„è¿™æ¡æ•°æ®ã€‚è¿™å’Œäº‹åŠ¡ A çš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€æ · çš„ï¼Œå› æ­¤æ²¡æœ‰å‡ºç°å¹»è¯»ç°è±¡ï¼Œæ‰€ä»¥è¯´åœ¨ MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚ </p>
<h3 id="6-MVCCç›¸å…³é—®é¢˜"><a href="#6-MVCCç›¸å…³é—®é¢˜" class="headerlink" title="6.MVCCç›¸å…³é—®é¢˜"></a>6.MVCCç›¸å…³é—®é¢˜</h3><h4 id="RRå¦‚ä½•åœ¨RCåŸºç¡€ä¸Šè§£å†³ä¸å¯é‡å¤è¯»ï¼Ÿ"><a href="#RRå¦‚ä½•åœ¨RCåŸºç¡€ä¸Šè§£å†³ä¸å¯é‡å¤è¯»ï¼Ÿ" class="headerlink" title="RRå¦‚ä½•åœ¨RCåŸºç¡€ä¸Šè§£å†³ä¸å¯é‡å¤è¯»ï¼Ÿ"></a>RRå¦‚ä½•åœ¨RCåŸºç¡€ä¸Šè§£å†³ä¸å¯é‡å¤è¯»ï¼Ÿ</h4><p><strong>å½“å‰è¯»å’Œå¿«ç…§è¯»åœ¨RRçº§åˆ«ä¸‹çš„åŒºåˆ«</strong></p>
<p>è¡¨1ï¼š<img src="/2022/04/22/MySQL/1651913686382.png" alt="1651913686382" loading="lazy"></p>
<p>åœ¨ä¸Šè¡¨çš„é¡ºåºä¸‹ï¼Œäº‹åŠ¡Bçš„åœ¨äº‹åŠ¡Aæäº¤ä¿®æ”¹åçš„å¿«ç…§è¯»æ˜¯æ—§ç‰ˆæœ¬æ•°æ®ï¼Œè€Œå½“å‰è¯»æ˜¯å®æ—¶æ–°æ•°æ®400</p>
<p>è¡¨2ï¼š<img src="/2022/04/22/MySQL/1651913783543.png" alt="1651913783543" loading="lazy"></p>
<p>è€Œåœ¨<strong>è¡¨2</strong>è¿™é‡Œçš„é¡ºåºä¸­ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aæäº¤åçš„å¿«ç…§è¯»å’Œå½“å‰è¯»éƒ½æ˜¯å®æ—¶çš„æ–°æ•°æ®400ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>è¿™é‡Œä¸ä¸Šè¡¨çš„å”¯ä¸€åŒºåˆ«ä»…ä»…æ˜¯<code>è¡¨ 1</code>çš„äº‹åŠ¡ B åœ¨äº‹åŠ¡ A ä¿®æ”¹é‡‘é¢å‰<code>å¿«ç…§è¯»</code>è¿‡ä¸€æ¬¡é‡‘é¢æ•°æ®ï¼Œè€Œ<code>è¡¨ 2</code>çš„äº‹åŠ¡Båœ¨äº‹åŠ¡Aä¿®æ”¹é‡‘é¢å‰æ²¡æœ‰è¿›è¡Œè¿‡å¿«ç…§è¯»ã€‚</li>
</ul>
<p><strong>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº‹åŠ¡ä¸­å¿«ç…§è¯»çš„ç»“æœæ˜¯éå¸¸ä¾èµ–è¯¥äº‹åŠ¡é¦–æ¬¡å‡ºç°å¿«ç…§è¯»çš„åœ°æ–¹ï¼Œå³æŸä¸ªäº‹åŠ¡ä¸­é¦–æ¬¡å‡ºç°å¿«ç…§è¯»çš„åœ°æ–¹éå¸¸å…³é”®ï¼Œå®ƒæœ‰å†³å®šè¯¥äº‹åŠ¡åç»­å¿«ç…§è¯»ç»“æœçš„èƒ½åŠ›</strong></p>
<p><strong>æˆ‘ä»¬è¿™é‡Œæµ‹è¯•çš„æ˜¯<code>æ›´æ–°</code>ï¼ŒåŒæ—¶<code>åˆ é™¤</code>å’Œ<code>æ›´æ–°</code>ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœäº‹åŠ¡Bçš„å¿«ç…§è¯»æ˜¯åœ¨äº‹åŠ¡Aæ“ä½œä¹‹åè¿›è¡Œçš„ï¼Œäº‹åŠ¡Bçš„å¿«ç…§è¯»ä¹Ÿæ˜¯èƒ½è¯»å–åˆ°æœ€æ–°çš„æ•°æ®çš„</strong></p>
<h4 id="RCã€RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#RCã€RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="RCã€RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>RCã€RRçº§åˆ«ä¸‹çš„InnoDBå¿«ç…§è¯»æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h4><p> æ­£æ˜¯ <code>Read View</code> ç”Ÿæˆæ—¶æœºçš„ä¸åŒï¼Œä»è€Œé€ æˆ RC , RR çº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœçš„ä¸åŒ </p>
<ul>
<li>åœ¨ RR çº§åˆ«ä¸‹çš„æŸä¸ªäº‹åŠ¡çš„å¯¹æŸæ¡è®°å½•çš„ç¬¬ä¸€æ¬¡å¿«ç…§è¯»ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§åŠ Read View, å°†å½“å‰ç³»ç»Ÿæ´»è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•èµ·æ¥ï¼Œæ­¤ååœ¨è°ƒç”¨å¿«ç…§è¯»çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª Read Viewï¼Œæ‰€ä»¥åªè¦å½“å‰äº‹åŠ¡åœ¨å…¶ä»–äº‹åŠ¡æäº¤æ›´æ–°ä¹‹å‰ä½¿ç”¨è¿‡å¿«ç…§è¯»ï¼Œé‚£ä¹ˆä¹‹åçš„å¿«ç…§è¯»ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ª Read Viewï¼Œæ‰€ä»¥å¯¹ä¹‹åçš„ä¿®æ”¹ä¸å¯è§ï¼›</li>
<li>å³ RR çº§åˆ«ä¸‹ï¼Œå¿«ç…§è¯»ç”Ÿæˆ Read View æ—¶ï¼ŒRead View ä¼šè®°å½•æ­¤æ—¶æ‰€æœ‰å…¶ä»–æ´»åŠ¨äº‹åŠ¡çš„å¿«ç…§ï¼Œè¿™äº›äº‹åŠ¡çš„ä¿®æ”¹å¯¹äºå½“å‰äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è€Œæ—©äºRead Viewåˆ›å»ºçš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å‡æ˜¯å¯è§</li>
<li>è€Œåœ¨ RC çº§åˆ«ä¸‹çš„ï¼Œäº‹åŠ¡ä¸­ï¼Œæ¯æ¬¡å¿«ç…§è¯»éƒ½ä¼šæ–°ç”Ÿæˆä¸€ä¸ªå¿«ç…§å’Œ Read View , è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ RC çº§åˆ«ä¸‹çš„äº‹åŠ¡ä¸­å¯ä»¥çœ‹åˆ°åˆ«çš„äº‹åŠ¡æäº¤çš„æ›´æ–°çš„åŸå› </li>
</ul>
<p>æ€»ä¹‹åœ¨RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯æ¯ä¸ªå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆå¹¶è·å–æœ€æ–°çš„Read Viewï¼›è€Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåˆ™æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ç¬¬ä¸€ä¸ªå¿«ç…§è¯»æ‰ä¼šåˆ›å»ºRead Viewï¼Œä¹‹åçš„å¿«ç…§è¯»è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªRead View</p>
<h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7.æ€»ç»“"></a>7.æ€»ç»“</h3><p>è¿™é‡Œä»‹ç»äº†<strong>MVCC</strong>åœ¨<strong>READ COMMITTEDã€REPEATABLE READ</strong>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«çš„äº‹åŠ¡åœ¨æ‰§è¡Œå¿«ç…§è¯»æ“ä½œæ—¶è®¿é—®è®°å½•çš„ç‰ˆæœ¬é“¾çš„è¿‡ç¨‹ã€‚è¿™æ ·ä½¿ä¸åŒäº‹ç‰©çš„<strong>è¯»-å†™ã€å†™-è¯»</strong>æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>æ ¸å¿ƒç‚¹åœ¨äºReadViewçš„åŸç†ï¼ŒREAD COMMITEDã€REPEATABLE READè¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„ä¸€ä¸ªå¾ˆå¤§ä¸åŒå°±æ˜¯ReadViewçš„ç”Ÿæˆæ—¶æœºä¸åŒï¼š</p>
<ul>
<li>READ COMMITEDåœ¨æ¯ä¸€æ¬¡è¿›è¡Œæ™®é€šselectæ“ä½œå‰éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadView</li>
<li>REPEATABLE READåªåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ™®é€šselectæ“ä½œå‰ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„æŸ¥è¯¢æ“ä½œéƒ½é‡å¤ä½¿ç”¨è¿™ä¸ªReadViewå°±å¥½äº†</li>
</ul>
<h2 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h2><h3 id="1-æ¦‚è¿°-1"><a href="#1-æ¦‚è¿°-1" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h3><h4 id="1-1å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›"><a href="#1-1å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›" class="headerlink" title="1.1å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›"></a>1.1å¦‚ä½•æå‡æ•°æ®åº“å¹¶å‘èƒ½åŠ›</h4><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†Redisä½œä¸ºç¼“å­˜ä¸MySQLé…åˆæ¥ä½¿ç”¨ï¼Œå½“æœ‰è¯·æ±‚çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä»ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœä¸å­˜åœ¨å†è®¿é—®æ•°æ®åº“ï¼Œè¿™æ ·å°±<strong>æå‡äº†è¯»å–çš„æ•ˆç‡</strong>ï¼Œä¹Ÿå‡å°‘äº†å¯¹åç«¯æ•°æ®åº“çš„<strong>è®¿é—®å‹åŠ›</strong>ã€‚Redisçš„ç¼“å­˜æ¶æ„æ˜¯<strong>é«˜å¹¶å‘æ¶æ„</strong>ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚<img src="/2022/04/22/MySQL/1652348444218.png" alt="1652348444218" loading="lazy"></p>
<p>æ­¤å¤–ï¼Œä¸€èˆ¬åº”ç”¨å¯¹æ•°æ®åº“è€Œè¨€éƒ½æ˜¯â€œ<strong>è¯»å¤šå†™å°‘</strong>â€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹æ•°æ®åº“è¯»å–å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯é‡‡ç”¨æ•°æ®åº“é›†ç¾¤çš„æ–¹æ¡ˆï¼Œåš<strong>ä¸»ä»æ¶æ„</strong>ã€è¿›è¡Œ<strong>è¯»å†™åˆ†ç¦»</strong>ï¼Œè¿™æ ·åŒæ ·å¯ä»¥æå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œä¸»ä»æ¶æ„çš„è®¾ç½®ï¼Œæ¯•ç«Ÿè®¾ç½®æ¶æ„æœ¬èº«æ˜¯æœ‰æˆæœ¬çš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çš„ç›®çš„åœ¨äºæå‡æ•°æ®åº“é«˜å¹¶å‘è®¿é—®çš„æ•ˆç‡ï¼Œé‚£ä¹ˆé¦–å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•<strong>ä¼˜åŒ–SQLå’Œç´¢å¼•</strong>ï¼Œè¿™ç§æ–¹å¼ç®€å•æœ‰æ•ˆï¼›å…¶æ¬¡æ‰æ˜¯é‡‡ç”¨<strong>ç¼“å­˜çš„ç­–ç•¥</strong>ï¼Œæ¯”å¦‚ä½¿ç”¨Rediså°†çƒ­ç‚¹æ•°æ®ä¿å­˜åœ¨å†…å­˜æ•°æ®åº“ä¸­ï¼Œæå‡è¯»å–çš„æ•ˆç‡ï¼›æœ€åæ‰æ˜¯å¯¹æ•°æ®åº“é‡‡ç”¨<strong>ä¸»ä»æ¶æ„</strong>ï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</p>
<p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å’Œç»´æŠ¤çš„æˆæœ¬ç”±ä½åˆ°é«˜ã€‚</p>
<h4 id="1-2ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#1-2ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="1.2ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a>1.2ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h4><p>ä¸»ä»åŒæ­¥è®¾è®¡ä¸ä»…å¯ä»¥æé«˜æ•°æ®åº“çš„ååé‡ï¼Œè¿˜æœ‰ä»¥ä¸‹3ä¸ªæ–¹é¢çš„ä½œç”¨</p>
<p><strong>ç¬¬ä¸€ä¸ªä½œç”¨ï¼šè¯»å†™åˆ†ç¦»</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»ä»å¤åˆ¶çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œç„¶åé€šè¿‡è¯»å†™åˆ†ç¦»æé«˜æ•°æ®åº“å¹¶å‘å¤„ç†èƒ½åŠ›<img src="/2022/04/22/MySQL/1652429016082.png" alt="1652429016082" loading="lazy"></p>
<p>å…¶ä¸­ä¸€ä¸ªæ˜¯Masterä¸»åº“ï¼Œè´Ÿè´£å†™å…¥æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå†™åº“ã€‚</p>
<p>å…¶ä»–éƒ½æ˜¯Slaveä»åº“ï¼Œè´Ÿè´£è¯»å–æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼šè¯»åº“ã€‚</p>
<p>å½“ä¸»åº“æ›´æ–°æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ•°æ®å¤åˆ¶åˆ°ä»åº“ä¸­ï¼Œè€Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è¯»æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»ä»åº“ä¸­è¯»å–ã€‚é¢å¯¹â€œè¯»å¤šå†™å°‘â€çš„éœ€æ±‚ï¼Œé‡‡ç”¨è¯»å†™åˆ†ç¦»çš„æ–¹å¼ï¼Œå¯ä»¥å®ç°<strong>æ›´é«˜çš„å¹¶å‘è®¿é—®</strong>ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½å¯¹ä»æœåŠ¡å™¨è¿›è¡Œ<strong>è´Ÿè½½å‡è¡¡</strong>ï¼Œè®©ä¸åŒçš„å»è¯·æ±‚æŒ‰ç…§ç­–ç•¥å‡åŒ€åœ°åˆ†å‘åˆ°ä¸åŒçš„ä»æœåŠ¡å™¨ä¸Šï¼Œè®©<strong>è¯»å–æ›´é¡ºç•…</strong>ã€‚è¯»å–é¡ºç•…çš„å¦ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯<strong>å‡å°‘äº†è¡¨é”</strong>çš„å½±å“ï¼Œæ¯”å¦‚æˆ‘ä»¬è®©ä¸»åº“è´Ÿè´£å†™ï¼Œå½“ä¸»åº“å‡ºç°å†™é”çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“ä»åº“è¿›è¡ŒSELECTçš„è¯»å–ã€‚</p>
<p><strong>ç¬¬2ä¸ªä½œç”¨å°±æ˜¯æ•°æ®å¤‡ä»½</strong>ã€‚æˆ‘ä»¬é€šè¿‡ä¸»ä»å¤åˆ¶å°†ä¸»åº“ä¸Šçš„æ•°æ®å¤åˆ¶åˆ°äº†ä»åº“ä¸Šï¼Œç›¸å½“äºæ˜¯ä¸€ç§<strong>çƒ­å¤‡ä»½æœºåˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸»åº“æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹è¿›è¡Œçš„å¤‡ä»½ï¼Œä¸ä¼šå½±å“åˆ°æœåŠ¡ã€‚</p>
<p><strong>ç¬¬3ä¸ªä½œç”¨å°±æ˜¯é«˜å¯ç”¨æ€§</strong>ã€‚æ•°æ®å¤‡ä»½å®é™…ä¸Šæ˜¯ä¸€ç§å†—ä½™çš„æœºåˆ¶ï¼Œé€šè¿‡è¿™ç§å†—ä½™çš„æ–¹å¼å¯ä»¥æ¢å–æ•°æ®åº“çš„é«˜å¯ç”¨æ€§ï¼Œä¹Ÿå°±æ˜¯å½“æœåŠ¡å™¨å‡ºç°<strong>æ•…éšœæˆ–å®•æœº</strong>çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œä¿è¯æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚</p>
<p>å…³äºé«˜å¯ç”¨æ€§çš„ç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡æ ‡è¡¡é‡ï¼Œå³æ­£å¸¸å¯ç”¨æ—¶é—´/å…¨å¹´æ—¶é—´ï¼Œæ¯”å¦‚è¦è¾¾åˆ°å…¨å¹´99.999%çš„æ—¶é—´éƒ½å¯ç”¨ï¼Œå°±æ„å‘³ç€ç³»ç»Ÿåœ¨ä¸€å¹´ä¸­çš„ä¸å¯ç”¨æ—¶é—´ä¸å¾—è¶…è¿‡<img src="/2022/04/22/MySQL/1652430305898.png" alt="1652430305898" style="zoom: 67%;" loading="lazy">åˆ†é’Ÿï¼ˆå«ç³»ç»Ÿå´©æºƒæ—¶é—´ã€æ—¥å¸¸ç»´æŠ¤æ“ä½œå¯¼è‡´çš„åœæœºæ—¶é—´ç­‰ï¼‰ï¼Œå…¶ä»–æ—¶é—´éƒ½éœ€è¦ä¿æŒå¯ç”¨çŠ¶æ€ã€‚</p>
<p>å®é™…ä¸Šï¼Œæ›´é«˜çš„é«˜å¯ç”¨æ€§ï¼Œæ„å‘³ç€éœ€è¦ä»˜å‡ºæ›´é«˜çš„æˆæœ¬ä»£ä»·ã€‚åœ¨ç°å®ä¸­æˆ‘ä»¬éœ€è¦ç»“åˆä¸šåŠ¡éœ€æ±‚å’Œæˆæœ¬æ¥è¿›è¡Œé€‰æ‹©ã€‚</p>
<h3 id="2-ä¸»ä»å¤åˆ¶çš„åŸç†"><a href="#2-ä¸»ä»å¤åˆ¶çš„åŸç†" class="headerlink" title="2.ä¸»ä»å¤åˆ¶çš„åŸç†"></a>2.ä¸»ä»å¤åˆ¶çš„åŸç†</h3><p><strong>Slave</strong>ä¼šä»<strong>Master</strong>è¯»å–<strong>binlog</strong>æ¥è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p>
<h4 id="2-1åŸç†å‰–æ"><a href="#2-1åŸç†å‰–æ" class="headerlink" title="2.1åŸç†å‰–æ"></a>2.1åŸç†å‰–æ</h4><p><strong>ä¸‰ä¸ªçº¿ç¨‹</strong></p>
<p>å®é™…ä¸Šä¸»ä»åŒæ­¥çš„åŸç†å°±æ˜¯åŸºäºbinlogè¿›è¡Œæ•°æ®åŒå¸ƒçš„ã€‚åœ¨ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¼šåŸºäº<strong>3ä¸ªçº¿ç¨‹</strong>æ¥æ“ä½œï¼Œä¸€ä¸ªä¸»åº“çº¿ç¨‹ï¼Œä¸¤ä¸ªä»åº“çº¿ç¨‹ã€‚<img src="/2022/04/22/MySQL/1652431025956.png" alt="1652431025956" loading="lazy"></p>
<p><strong>äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹ï¼ˆBinlog dump threadï¼‰</strong>æ˜¯ä¸€ä¸ªä¸»åº“çº¿ç¨‹ã€‚å½“ä»åº“çº¿ç¨‹è¿æ¥çš„æ—¶å€™ï¼Œä¸»åº“å¯ä»¥å°†äºŒè¿›åˆ¶æ—¥å¿—å‘ç»™ä»åº“ï¼Œå½“ä¸»åº“è¯»å–äº‹ä»¶ï¼ˆEventï¼‰çš„æ—¶å€™ï¼Œä¼šåœ¨Binlogä¸Š<strong>åŠ é”</strong>ï¼Œè¯»å–å®Œæˆä¹‹åï¼Œå†å°†é”é‡Šæ”¾æ‰ã€‚</p>
<p><strong>ä»åº“I/Oçº¿ç¨‹</strong>ä¼šè¿æ¥åˆ°ä¸»åº“ï¼Œå‘ä¸»åº“å‘é€è¯·æ±‚æ›´æ–°Binlogã€‚è¿™æ—¶ä»åº“çš„I/Oçº¿ç¨‹å°±å¯ä»¥è¯»å–åˆ°ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—è½¬å‚¨çº¿ç¨‹å‘é€çš„Binlogæ›´æ–°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‹·è´åˆ°æœ¬åœ°çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ã€‚</p>
<p><strong>ä»åº“SQLçº¿ç¨‹</strong>ä¼šè¯»å–ä»åº“ä¸­çš„ä¸­ç»§æ—¥å¿—ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†ä»åº“çš„æ•°æ®äºä¸»åº“ä¿æŒåŒæ­¥ã€‚</p>
<p><img src="/2022/04/22/MySQL/1652431463999.png" alt="1652431463999" loading="lazy"></p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>ä¸æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„MySQLéƒ½é»˜è®¤å¼€å¯æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚åœ¨è¿›è¡ŒåŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ£€æŸ¥æœåŠ¡æ˜¯å¦å·²ç»å¼€å¯äº†äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p>
<p>é™¤éç‰¹æ®ŠæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ä»æœåŠ¡å™¨ä¼šæ‰§è¡Œæ‰€æœ‰ä¸»æœåŠ¡å™¨ä¸­ä¿å­˜çš„äº‹ä»¶ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œä½¿ä»æœåŠ¡å™¨æ‰§è¡Œç‰¹å®šçš„äº‹ä»¶ã€‚</p>
</blockquote>
<p><strong>å¤åˆ¶ä¸‰æ­¥éª¤</strong></p>
<p>æ­¥éª¤1ï¼š<strong>Maste</strong>rå°†å†™æ“ä½œè®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼Œè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼ˆbinary log eventsï¼‰</p>
<p>æ­¥éª¤2ï¼š<strong>Slave</strong>å°†<strong>Master</strong>çš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰</p>
<p>æ­¥éª¤3ï¼š<strong>Slave</strong>é‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ï¼ŒMySQLå¤åˆ¶æ˜¯å¼‚æ­¥çš„ä¸”ä¸²è¡ŒåŒ–çš„ï¼Œè€Œä¸”é‡å¯åä»åŠ å…¥ç‚¹å¼€å§‹å¤åˆ¶ã€‚</p>
<p><strong>å¤åˆ¶çš„é—®é¢˜</strong></p>
<p>å¤åˆ¶çš„æœ€å¤§é—®é¢˜ï¼š<strong>å»¶æ—¶</strong></p>
<h4 id="2-2å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"><a href="#2-2å¤åˆ¶çš„åŸºæœ¬åŸåˆ™" class="headerlink" title="2.2å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"></a>2.2å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</h4><ul>
<li>æ¯ä¸ª<strong>Slave</strong>hiåªæœ‰ä¸€ä¸ª<strong>Master</strong></li>
<li>æ¯ä¸ª<strong>Slave</strong>åªæœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li>
<li>æ¯ä¸ª<strong>Master</strong>å¯ä»¥æœ‰å¤šä¸ª<strong>Slave</strong></li>
</ul>
<h3 id="3-ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º"><a href="#3-ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º" class="headerlink" title="3.ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º"></a>3.ä¸€ä¸»ä¸€ä»æ¶æ„æ­å»º</h3><p>ä¸€å°ä¸»æœºç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œä¸€å°ä»æœåŠ¡å™¨ç”¨æ¥å¤„ç†æ‰€æœ‰è¯»è¯·æ±‚ï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652462253464.png" alt="1652462253464" loading="lazy"></p>
<h4 id="3-1å‡†å¤‡å·¥ä½œ"><a href="#3-1å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.1å‡†å¤‡å·¥ä½œ"></a>3.1å‡†å¤‡å·¥ä½œ</h4><p>1.å‡†å¤‡2å°centosè™šæ‹Ÿæœº</p>
<p>2.æ¯å°è™šæ‹Ÿæœºä¸Šéœ€è¦å®‰è£…å·MySQL</p>
<p>è¯´æ˜ï¼šå‰é¢è®²è¿‡å¦‚ä½•å…‹éš†ä¸€å°CentOSã€‚å¯ä»¥é€šè¿‡åœ¨ä¸€å°CentOSä¸Šå®‰è£…MySQLï¼Œè¿›è€Œé€šè¿‡å…‹éš†æ–¹å¼å¤åˆ¶å‡ºä¸€å°åŒ…å«MySQLçš„è™šæ‹Ÿæœº</p>
<p>æ³¨æ„ï¼šå…‹éš†æ–¹å¼éœ€è¦ä¿®æ”¹æ–°å…‹éš†å‡ºçš„ä¸»æœºçš„ï¼šMACåœ°å€ã€hostnameã€IPåœ°å€ã€UUID</p>
<p>æ­¤å¤–ï¼Œå…‹éš†æ–¹å¼ç”Ÿæˆçš„è™šæ‹Ÿæœºï¼ˆåŒ…å«MySQL Severï¼‰ï¼Œåˆ™å…‹éš†çš„è™šæ‹ŸæœºMySQL Severçš„UUIDç›¸åŒï¼Œå¿…ä¿®ä¿®æ”¹ï¼Œå¦åˆ™åœ¨æœ‰äº›åœºæ™¯ä¼šæŠ¥é”™ã€‚æ¯”å¦‚ï¼Œshow slave status\Gï¼Œåˆ™åŒ…å¦‚ä¸‹é”™è¯¯ï¼š<img src="/2022/04/22/MySQL/1652443319986.png" alt="1652443319986" loading="lazy"></p>
<p>ä¿®æ”¹MySQL Severçš„UUIDæ–¹å¼ï¼š</p>
<p><img src="/2022/04/22/MySQL/1652443344519.png" alt="1652443344519" loading="lazy"></p>
<h4 id="3-2ä¸»æœºé…ç½®æ–‡ä»¶"><a href="#3-2ä¸»æœºé…ç½®æ–‡ä»¶" class="headerlink" title="3.2ä¸»æœºé…ç½®æ–‡ä»¶"></a>3.2ä¸»æœºé…ç½®æ–‡ä»¶</h4><p>å»ºè®®mysqlç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œï¼Œä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨[mysqld]èŠ‚ç‚¹ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p>
<p>å…·ä½“å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å¿…é€‰</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ŒæŒ‡åè·¯å¾„ï¼Œæ¯”å¦‚ï¼šè‡ªå·±æœ¬åœ°çš„è·¯å¾„/log/mysqlbin</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">atguigu-bin</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¯é€‰</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¯é€‰]0ï¼ˆé»˜è®¤ï¼‰è¡¨ç¤ºè¯»å†™ï¼ˆè¯»å†™ï¼‰ã€1è¡¨ç¤ºåªè¯»ï¼ˆä»æœºï¼‰</span></span><br><span class="line"><span class="attr">read-only</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#è®¾ç½®å•ä¸ªæ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ—¶é•¿ï¼Œå•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="attr">binlog_expire_logs_seconds</span>=<span class="string">6000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#æ§åˆ¶å•ä¸ªäºŒè¿›åˆ¶æ—¥å¿—å¤§å°ã€‚æ­¤å‚æ•°çš„æœ€å¤§å€¼å’Œé»˜è®¤å€¼æ˜¯1GB</span></span><br><span class="line"><span class="attr">max_binlog_size</span>=<span class="string">200M</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“</span></span><br><span class="line"><span class="attr">binlog-ignore-db</span>=<span class="string">test</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ï¼Œé»˜è®¤å…¨éƒ¨è®°å½•ã€‚æ¯”å¦‚:binlog-do-db=atguigu_master_slave</span></span><br><span class="line"><span class="attr">binlog</span>=<span class="string">do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#[å¯é€‰]è®¾ç½®binglogæ ¼å¼</span></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">STATEMENT</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>å…ˆæ­å»ºå®Œä¸»ä»å¤åˆ¶ï¼Œå†åˆ›å»ºæ•°æ®åº“</p>
<p>MySQLä¸»ä»å¤åˆ¶èµ·å§‹æ—¶ï¼Œä»æœºä¸ç»§æ‰¿ä¸»æœºæ•°æ®</p>
</blockquote>
</li>
</ul>
<p><strong>binlogæ ¼å¼è®¾ç½®ï¼š</strong></p>
<p>æ ¼å¼1ï¼š<strong>STATEMENTæ¨¡å¼</strong>ï¼ˆåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replicationï¼ŒSBR)ï¼‰</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format-STATEMENT</span></span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ°binglogä¸­ï¼Œè¿™æ˜¯é»˜è®¤binglogæ ¼å¼ã€‚</p>
<ul>
<li><p>SBRçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å†å²æ‚ ä¹…ï¼ŒæŠ€æœ¯æˆç†Ÿ</li>
<li>ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–</li>
<li>binlogä¸­åŒ…å«äº†æ‰€æœ‰æ•°æ®åº“æ›´æ”¹ä¿¡æ¯ï¼Œå¯ä»¥æ®æ­¤æ¥å®¡æ ¸æ•°æ®åº“çš„å®‰å…¨ç­‰æƒ…å†µ</li>
<li>binlogå¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼Œè€Œä¸ä»…ä»…ç”¨äºå¤åˆ¶</li>
<li>ä¸»ä»å¤åˆ¶å¯ä»¥ä¸ä¸€æ ·ï¼Œä»æœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥æ¯”ä¸»æœåŠ¡å™¨ç‰ˆæœ¬é«˜</li>
</ul>
</li>
<li><p>SBRçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸æ˜¯æ‰€æœ‰çš„UPDATEè¯­å¥éƒ½èƒ½è¢«å¤åˆ¶ï¼Œå°¤å…¶åŒ…å«ä¸ç¡®å®šçš„æ“ä½œçš„æ—¶å€™</li>
</ul>
</li>
<li><p>ä½¿ç”¨ä»¥ä¸‹å‡½æ•°çš„è¯­å¥ä¹Ÿæ— æ³•è¢«å¤åˆ¶ï¼šLOAD_FILE()ã€UUID()ã€USER()ã€FOUND_ROWS()ã€SYSDATE()(é™¤éå¯åŠ¨æ—¶å¯ç”¨äº†â€“sysdate-is-nowé€‰é¡¹)</p>
<ul>
<li>INSERTâ€”SELECTä¼šäº§ç”Ÿæ¯”RBRæ›´å¤šçš„è¡Œçº§é”</li>
<li>å¤åˆ¶éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼ˆWHEREè¯­å¥ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ï¼‰çš„UPDATEæ—¶ï¼Œéœ€è¦æ¯”RBRè¯·æ±‚æ›´å¤šçš„è¡Œçº§é”</li>
<li>å¯¹äºæœ‰AUTO_INSERTå­—æ®µçš„InnoDBè¡¨è€Œè¨€ï¼ŒINSERTè¯­å¥ä¼šé˜»å¡å…¶ä»–INSERTè¯­å¥</li>
<li>å¯¹äºä¸€äº›å¤æ‚çš„è¯­å¥ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šçš„è€—èµ„æºæƒ…å†µä¼šæ›´ä¸¥é‡ï¼Œè€ŒRBRæ¨¡å¼ä¸‹ï¼Œåªä¼šå¯¹é‚£ä¸ªå‘ç”Ÿå˜åŒ–çš„è®°å½•äº§ç”Ÿå½±å“</li>
<li>æ‰§è¡Œå¤æ‚è¯­å¥å¦‚æœå‡ºé”™çš„è¯ï¼Œä¼šæ¶ˆè€—æ›´å¤šèµ„æº</li>
<li>æ•°æ®è¡¨å¿…é¡»å‡ ä¹å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´æ‰è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å¤åˆ¶å‡ºé”™</li>
</ul>
</li>
</ul>
<p>æ ¼å¼2ï¼š<strong>ROWæ¨¡å¼ï¼ˆåŸºäºè¡Œçš„å¤åˆ¶(row-based replicationï¼ŒRBR)ï¼‰</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">ROW</span></span><br></pre></td></tr></table></figure>

<p>5.1.5ç‰ˆæœ¬çš„MySQLæ‰å¼€å§‹æ”¯æŒï¼Œä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·å­<img src="/2022/04/22/MySQL/1652450290525.png" alt="1652450290525" loading="lazy"></p>
<p>æ ¼å¼3ï¼š<strong>MIXEDæ¨¡å¼ï¼ˆæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replicatino,MBR)ï¼‰</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=<span class="string">MIXED</span></span><br></pre></td></tr></table></figure>

<p>ä»5.1.8ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLæä¾›äº†Mixedæ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯Statementä¸Rowçš„ç»“åˆã€‚</p>
<p>åœ¨Mixedæ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨statementæ ¼å¼ä¿å­˜binlogï¼Œå¦‚ä¸€äº›å‡½æ•°ï¼Œstatementæ— æ³•å®Œæˆå¤åˆ¶çš„æ“ä½œï¼Œåˆ™é‡‡ç”¨rowæ ¼å¼ä¿å­˜binlogã€‚</p>
<p>MySQLä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„sqlè¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨statementå’Œrowä¹‹é—´é€‰æ‹©ä¸€ç§ã€‚</p>
<h4 id="3-3-ä»æœºé…ç½®æ–‡ä»¶"><a href="#3-3-ä»æœºé…ç½®æ–‡ä»¶" class="headerlink" title="3.3.ä»æœºé…ç½®æ–‡ä»¶"></a>3.3.ä»æœºé…ç½®æ–‡ä»¶</h4><p>è¦æ±‚ä¸»ä»æ‰€æœ‰é…ç½®é¡¹éƒ½é…ç½®åœ¨my.cnfçš„[mysqld]æ ä½ä¸‹ï¼Œä¸”éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p>
<ul>
<li><p>å¿…é€‰</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¯é€‰</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[å¯é€‰]å¯ç”¨ä¸­ç»§æ—¥å¿—</span></span><br><span class="line"><span class="attr">relay-log</span>=<span class="string">mysql-relay</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯åå°mysqlæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸»ä»æœºéƒ½å…³é—­é˜²ç«å¢™</p>
<p>service iptables stop #CentOS 6</p>
<p>systemctl stop firewalld.service #CentOS 7</p>
</blockquote>
</li>
</ul>
<h4 id="3-4ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ"><a href="#3-4ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ" class="headerlink" title="3.4ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ"></a>3.4ä¸»æœºï¼šå»ºç«‹è´¦æˆ·å¹¶æˆæƒ</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨ä¸»æœºMySQLé‡Œæ‰§è¡Œæˆæƒä¸»ä»å¤åˆ¶çš„å‘½ä»¤</span></span><br><span class="line"><span class="attr">GRANT</span> <span class="string">REPLICATION SLAVE ON *.* TO &#x27;slave1&#x27;@â€˜ä»æœºå™¨æ•°æ®åº“IPâ€™ IDENTIFIED BY &#x27;abc123&#x27;;#5.5,5.7</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä½¿ç”¨çš„æ˜¯MySQL8ï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å»ºç«‹è´¦æˆ·ï¼Œå¹¶æˆæƒslaveï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">CREATE</span> <span class="string">USER &#x27;slave1&#x27;@â€˜%â€™ IDENTIFIED BY &#x27;123456&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">GRANT</span> <span class="string">REPLICATION SLAVE ON *.* TO &#x27;slave1&#x27;@â€˜%â€™;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#æ­¤è¯­å¥å¿…é¡»ä¹‹å¿ƒï¼Œå¦åˆ™è§ä¸‹é¢</span></span><br><span class="line"><span class="attr">ALTER</span> <span class="string">USER &#x27;slave1&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">flush</span> <span class="string">privileges;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šåœ¨ä»æœºæ‰§è¡Œshow slave staus\Gæ—¶æŠ¥é”™ï¼š</p>
</blockquote>
<p><img src="/2022/04/22/MySQL/1652495493057.png" alt="1652495493057" loading="lazy"></p>
<p>æŸ¥è¯¢Masterçš„çŠ¶æ€ï¼Œå¹¶è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652495571131.png" alt="1652495571131" loading="lazy"></p>
<ul>
<li>è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šæ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸å†æ“ä½œä¸»æœåŠ¡å™¨MySQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</p>
</blockquote>
<h4 id="3-5ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº"><a href="#3-5ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº" class="headerlink" title="3.5ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº"></a>3.5ä»æœºï¼šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</h4><p>æ­¥éª¤1ï¼šä»æœºä¸Šå¤åˆ¶ä¸»æœºçš„å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER T0</span><br><span class="line">MASTER_HOST=&#x27;ä¸»æœºçš„IPåœ°å€&#x27;,</span><br><span class="line">MASTER_USER=&#x27;ä¸»æœºç”¨æˆ·å&#x27;,</span><br><span class="line">MASTER_PASSWORD-&#x27;ä¸»æœºç”¨æˆ·åçš„å¯†ç &#x27;,</span><br><span class="line">MASTER_LOG_FILE=&#x27;MYSQL-BIN.å…·ä½“æ•°å­—&#x27;,</span><br><span class="line">MASTER_LOG_POS=&#x27;å…·ä½“å€¼&#x27;;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER T0</span><br><span class="line">MASTER_HOST=&#x27;192.168.1.150&#x27;,MASTER_USER=&#x27;slave1&#x27;,MASTER_PASSWORD=&#x27;123456&#x27;,MASTER_LOG_FILE=&#x27;atguigu-bin.000007&#x27;,MASTER_LOG_POS=&#x27;154&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652495968713.png" alt="1652495968713" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652496020652.png" alt="1652496020652" loading="lazy"></p>
<p>æ­¥éª¤2ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å¯åŠ¨slzveåŒæ­¥</span><br><span class="line">START SLAVE;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652496079386.png" alt="1652496079386" loading="lazy"></p>
<p>å¦‚æœæŠ¥é”™ï¼š<img src="/2022/04/22/MySQL/1652496104951.png" alt="1652496104951" loading="lazy"></p>
<p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œåˆ é™¤ä¹‹å‰çš„relay_logä¿¡æ¯ï¼Œç„¶åé‡æ–°æ‰§è¡ŒCHANGE MASTER TOâ€¦â€¦è¯­å¥å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; reset slave; #åˆ é™¤slaveæ•°æ®åº“çš„relaylogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯ç”¨æ–°çš„relaylogæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW SLAVE STATUS\G;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/22/MySQL/1652496322341.png" alt="1652496322341" loading="lazy"></p>
<blockquote>
<p>ä¸Šé¢è¿ä¸ªå‚æ•°éƒ½æ˜¯YESï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸ</p>
</blockquote>
<p>æ˜¾ç¤ºå¦‚ä¸‹ï¼Œè¯´æ˜ä¸æ­£ç¡®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.ç½‘ç»œä¸åŒ</span><br><span class="line">2.è´¦æˆ·å¯†ç é”™è¯¯</span><br><span class="line">3.é˜²ç«å¢™</span><br><span class="line">4.mysqlé…ç½®æ–‡ä»¶é—®é¢˜</span><br><span class="line">5.è¿æ¥æœåŠ¡å™¨æ—¶è¯­æ³•</span><br><span class="line">6.ä¸»æœåŠ¡å™¨mysqlæƒé™</span><br></pre></td></tr></table></figure>

<h4 id="3-6æµ‹è¯•"><a href="#3-6æµ‹è¯•" class="headerlink" title="3.6æµ‹è¯•"></a>3.6æµ‹è¯•</h4><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€insertè®°å½•ï¼Œä»æœºå¤åˆ¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE atguigu_master_slave;</span><br><span class="line">CREATE TABLE mytbl(id IND,NAME VARCHAR(16));</span><br><span class="line">INSERT INTO mytbl VALUES(1,&#x27;zhang3&#x27;);</span><br><span class="line">INSERT INTO mytbl VALUES(2,@@hostname);</span><br></pre></td></tr></table></figure>



<h4 id="3-7åœæ­¢ä¸»ä»åŒæ­¥"><a href="#3-7åœæ­¢ä¸»ä»åŒæ­¥" class="headerlink" title="3.7åœæ­¢ä¸»ä»åŒæ­¥"></a>3.7åœæ­¢ä¸»ä»åŒæ­¥</h4><ul>
<li><p>åœæ­¢ä¸»ä»åŒæ­¥å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚ä½•é‡æ–°é…ç½®ä¸»ä»</p>
<p>å¦‚æœåœæ­¢ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½ï¼Œå†ä½¿ç”¨éœ€è¦é‡æ–°é…ç½®ä¸»ä»ã€‚å¦åˆ™ä¼šæŠ¥é”™ï¼š<img src="/2022/04/22/MySQL/1652496673385.png" alt="1652496673385" loading="lazy"></p>
</li>
</ul>
<p>å†é‡æ–°é…ç½®ä¸»ä»ï¼Œéœ€è¦åœ¨ä»æœºä¸Šæ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">reset master;#åˆ é™¤Masterç§æ‰€æœ‰çš„binlogæ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="3-8åç»­"><a href="#3-8åç»­" class="headerlink" title="3.8åç»­"></a>3.8åç»­</h4><p><strong>æ­å»ºä¸»ä»å¤åˆ¶ï¼šåŒä¸»åŒä»</strong></p>
<p>ä¸€ä¸ªä¸»æœºm1ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœºs1å’Œå¦ä¸€ä¸ªä¸»æœºm2è¿˜æœ‰å®ƒçš„ä»æœºs2è´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ã€‚å½“m1ä¸»æœºå®•æœºåï¼Œm2ä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼Œm1ã€m2äº’ä¸ºå¤‡æœº    ã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š<img src="/2022/04/22/MySQL/1652497523655.png" alt="1652497523655" loading="lazy"></p>
<h3 id="4-åŒæ­¥æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜"><a href="#4-åŒæ­¥æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜" class="headerlink" title="4.åŒæ­¥æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜"></a>4.åŒæ­¥æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</h3><p><strong>ä¸»ä»åŒæ­¥çš„è¦æ±‚ï¼š</strong></p>
<ul>
<li>è¯»åº“å’Œå†™åº“çš„æ•°æ®ä¸€è‡´ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰</li>
<li>å†™æ•°æ®å¿…é¡»å†™åˆ°å†™åº“</li>
<li>è¯»æ•°æ®å¿…é¡»åˆ°è¯»åº“ï¼ˆä¸ä¸€å®šï¼‰</li>
</ul>
<h4 id="4-1ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜"><a href="#4-1ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜" class="headerlink" title="4.1ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜"></a>4.1ç†è§£ä¸»ä»å»¶è¿Ÿé—®é¢˜</h4><p>è¿›è¡Œä¸»ä»åŒæ­¥çš„å†…å®¹çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿›è¡Œ<strong>ç½‘ç»œä¼ è¾“</strong>çš„è¿‡ç¨‹ä¸­å°±ä¸€å®šä¼šå­˜åœ¨<strong>ä¸»ä»å»¶è¿Ÿ</strong>ï¼ˆæ¯”å¦‚500msï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆç”¨æˆ·åœ¨ä»åº“ä¸Šè¯»å–çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸»ä»åŒæ­¥ä¸­çš„<strong>æ•°æ®ä¸ä¸€è‡´æ€§</strong>é—®é¢˜</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>å¯¼è‡´ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p>
<ul>
<li>ä¸»åº“Aæ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥binlogï¼Œè¿™ä¸ªæ—¶åˆ»ä¸ºT1</li>
<li>ä¹‹åä¼ ç»™ä»åº“Bï¼Œä»åº“Bæ¥æ”¶å®Œè¿™ä¸ªbinlogçš„æ—¶åˆ»è®°ä¸ºT2</li>
<li>ä»åº“Bæ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡çš„æ—¶åˆ»è®°ä¸ºT3</li>
</ul>
<h4 id="4-2ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› "><a href="#4-2ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› " class="headerlink" title="4.2ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› "></a>4.2ä¸»ä»å»¶è¿Ÿé—®é¢˜åŸå› </h4><p>åœ¨ç½‘ç»œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™ä»åº“æ‰€éœ€çš„æ—¶é—´å¾ˆçŸ­ï¼Œå³T2-T1çš„å€¼éå¸¸å°ã€‚å³ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„<strong>ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œbinlogå’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®</strong></p>
<p><strong>ä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œä»åº“æ¶ˆè´¹ä¸­ç»§æ—¥å¿—(relay log)çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§binogçš„é€Ÿåº¦è¦æ…¢</strong>ã€‚é€ æˆåŸå› ï¼š</p>
<ol>
<li>ä»åº“çš„æœºå™¨æ€§èƒ½æ¯”ä¸»åº“è¦å·®</li>
<li>ä»åº“çš„å‹åŠ›å¤§</li>
<li>å¤§äº‹åŠ¡çš„æ‰§è¡Œ</li>
</ol>
<p>ä¸¾ä¾‹1ï¼šä¸€æ¬¡æ€§ç”¨deleteè¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®</p>
<p>ç»“è®ºï¼šåç»­å†åˆ é™¤çš„æ—¶å€™ï¼Œè¦æ§åˆ¶æ¯ä¸ªäº‹åŠ¡çš„åˆ é™¤çš„æ•°æ®é‡ï¼Œåˆ†æˆå¤šæ¬¡åˆ é™¤</p>
<p>ä¸¾ä¾‹2ï¼šä¸€æ¬¡æ€§ç”¨insertâ€¦selectæ’å…¥å¤ªå¤šæ•°æ® </p>
<p>ä¸¾ä¾‹3ï¼šå¤§è¡¨DDL</p>
<p>æ¯”å¦‚åœ¨ä¸»åº“å¯¹ä¸€å¼ 500Wçš„è¡¨æ·»åŠ ä¸€ä¸ªå­—æ®µè€—è´¹äº†10åˆ†é’Ÿï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹ä¸Šä¹Ÿä¼šè€—è´¹10åˆ†é’Ÿ</p>
<h4 id="4-3å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ"><a href="#4-3å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ" class="headerlink" title="4.3å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ"></a>4.3å¦‚ä½•å‡å°‘ä¸»ä»å»¶è¿Ÿ</h4><p>è‹¥æƒ³è¦å‡å°‘ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„åŠæ³•ï¼š</p>
<ol>
<li>é™ä½å¤šçº¿ç¨‹å¤§äº‹åŠ¡å¹¶å‘çš„æ¦‚ç‡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘</li>
<li>ä¼˜åŒ–SQLï¼Œé¿å…æ…¢SQLï¼Œ<strong>å‡å°‘æ‰¹é‡æ“ä½œ</strong>ï¼Œå»ºè®®å†™è„šæœ¬ä»¥update-sleepè¿™æ ·çš„å½¢å¼å®Œæˆã€‚</li>
<li><strong>æé«˜ä»åº“æœºå™¨çš„é…ç½®</strong>ï¼Œå‡å°‘ä¸»åº“å†™binlogå’Œä»åº“è¯»binlogçš„æ•ˆç‡å·®</li>
<li>å°½é‡é‡‡ç”¨<strong>çŸ­çš„é“¾è·¯</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“æœåŠ¡å™¨çš„ä¸¾ä¾‹å°½é‡è¦çŸ­ï¼Œæå‡ç«¯å£å¸¦å®½ï¼Œå‡å°‘binlogä¼ è¾“çš„ç½‘ç»œå»¶æ—¶</li>
<li>å®æ—¶æ€§è¦æ±‚çš„ä¸šåŠ¡è¯»å¼ºåˆ¶èµ°ä¸»åº“ï¼Œä»åº“åªåšå¤‡åº“ï¼Œå¤‡ä»½ã€‚</li>
</ol>
<h4 id="4-4å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜"><a href="#4-4å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="4.4å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜"></a>4.4å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜</h4><p>å¦‚æœæ“ä½œçš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå¯¹æ•°æ®è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹è®°å½•åŠ å†™é”ï¼Œè¿™æ ·åœ¨è¯»å–çš„æ—¶å€™å°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä½†è¿™æ—¶ä»åº“çš„ä½œç”¨å°±æ˜¯ <strong>å¤‡ä»½</strong> ï¼Œå¹¶æ²¡æœ‰èµ·åˆ° <strong>è¯»å†™åˆ†ç¦»</strong> ï¼Œ<strong>åˆ†æ‹…ä¸»åº“è¯»å‹åŠ›</strong> çš„ä½œç”¨ã€‚ <img src="/2022/04/22/MySQL/1652498741807.png" alt="1652498741807" loading="lazy"></p>
<p>è¯»å†™åˆ†ç¦»æƒ…å†µä¸‹ï¼Œè§£å†³ä¸»ä»åŒæ­¥ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå°±æ˜¯è§£å†³ä¸»ä»ä¹‹é—´<strong>æ•°æ®å¤åˆ¶æ–¹å¼</strong>çš„é—®é¢˜ï¼Œå¦‚æœæŒ‰ç…§æ•°æ®ä¸€è‡´æ€§<strong>ä»å¼±åˆ°å¼º</strong>æ¥è¿›è¡Œåˆ’åˆ†ï¼Œæœ‰ä»¥ä¸‹3ç§å¤åˆ¶æ–¹å¼ã€‚</p>
<p><strong>æ–¹æ³•1ï¼šå¼‚æ­¥å¤åˆ¶</strong></p>
<p>å¼‚æ­¥æ¨¡å¼å°±æ˜¯å®¢æˆ·ç«¯æäº¤COMMOTä¹‹åä¸éœ€è¦ç­‰ä»åº“è¿”å›ç»“æœï¼Œè€Œæ˜¯ç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ä¸ä¼šå½±å“ä¸»åº“å†™çš„æ•ˆç‡ï¼Œä½†å¯èƒ½ä¼šå­˜åœ¨ä¸»åº“å®•æœºï¼Œè€Œbinlogè¿˜æ²¡æœ‰åŒæ­¥åˆ°ä»åº“çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶çš„ä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´ã€‚è¿™æ—¶å€™ä»ä»åº“ç§é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°ä¸»ï¼Œé‚£ä¹ˆæ–°ä¸»æœºåˆ™å¯èƒ½ç¼ºå°‘åŸæ¥ä¸»æœåŠ¡å™¨ç§å·²æäº¤çš„äº‹åŠ¡ã€‚æ‰€ä»¥ï¼Œè¿™ç§å¤åˆ¶æ¨¡å¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§æ˜¯æœ€å¼±çš„<img src="/2022/04/22/MySQL/1652515436179.png" alt="1652515436179" loading="lazy"></p>
<p><strong>æ–¹æ³•2ï¼šåŠåŒæ­¥å¤åˆ¶</strong></p>
<p>MySQL5.5ç‰ˆæœ¬ä¹‹åå¼€å§‹æ”¯æŒåŠåŒæ­¥å¤åˆ¶çš„æ–¹å¼ã€‚åŸç†å°±æ˜¯å®¢æˆ·ç«¯æäº¤commitä¹‹åä¸ç›´æ¥å°†ç»“æœè¿”å›å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ç­‰å¾…è‡³å°‘æœ‰ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°äº†binlogï¼Œå¹¶ä¸”å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ï¼Œå†è¿”å›å®¢æˆ·ç«¯ã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æé«˜äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“ç„¶ç›¸æ¯”äºå¼‚æ­¥å¤åˆ¶æ¥è¯´ï¼Œè‡³å°‘å¤šå¢åŠ äº†äº†ä¸€ä¸ªç½‘ç»œè¿æ¥çš„å»¶è¿Ÿï¼Œé™ä½äº†ä¸»åº“å†™çš„æ•ˆç‡ã€‚</p>
<p>åœ¨MySQL5.7ç‰ˆæœ¬ä¸­è¿˜å¢åŠ äº†ä¸€ä¸ªrpl_semi_sync_master_wait_for_slave_countå‚æ•°ï¼Œå¯ä»¥å¯¹åº”ç­”çš„ä»åº“æ•°é‡è¿›è¡Œæ§åˆ¶ï¼Œé»˜è®¤ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´ä¹‹è¦æœ‰1å’Œä»åº“è¿›è¡Œäº†å“åº”ï¼Œå°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœå°†è¿™ä¸ªå‚æ•°è°ƒå¤§ï¼Œå¯ä»¥æå‡æ•°æ®ä¸€è‡´æ€§çš„å¼ºåº¦ï¼Œä½†ä¹Ÿä¼šå¢åŠ ä¸»åº“ç­‰å¾…ä»åº“å“åº”çš„æ—¶é—´ã€‚<img src="/2022/04/22/MySQL/1652516168388.png" alt="1652516168388" loading="lazy"></p>
<p><strong>æ–¹æ³•3ï¼šç»„å¤åˆ¶</strong></p>
<p>å¼‚æ­¥å¤åˆ¶å’ŒåŠåŒæ­¥å¤åˆ¶éƒ½æ— æ³•æœ€ç»ˆä¿è¯æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼ŒåŠåŒæ­¥å¤åˆ¶æ˜¯é€šè¿‡åˆ¤æ–­ä»åº“å“åº”çš„ä¸ªæ•°æ¥å†³å®šæ˜¯å¦è¿”å›å®¢æˆ·ç«¯ï¼Œè™½ç„¶æ•°æ®ä¸€è‡´æ€§ç›¸æ¯”ä¸å¼‚æ­¥å¤åˆ¶æœ‰æå‡ï¼Œä½†ä»ç„¶æ— æ³•æ»¡è¶³å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘é¢é¢†åŸŸã€‚MGRå¾ˆå¥½åœ°å¼¥è¡¥äº†è¿™ä¸¤ç§å¤åˆ¶æ¨¡å¼åœ°ä¸è¶³ã€‚</p>
<p>ç»„å¤åˆ¶æŠ€æœ¯ï¼Œç®€ç§°MGRï¼ˆMySQL Group Replicationï¼‰ã€‚æ˜¯MySQL5.7.17ç‰ˆæœ¬ä¸­æ¨å‡ºçš„ä¸€ç§æ–°çš„æ•°æ®å¤åˆ¶æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯æ˜¯åŸºäºPaxosåè®®çš„çŠ¶æ€æœºå¤åˆ¶ã€‚</p>
<p><strong>MGRæ˜¯å¦‚ä½•å·¥ä½œçš„</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬å°†å¤šä¸ªèŠ‚ç‚¹å…±åŒç»„æˆä¸€ä¸ªå¤åˆ¶ç»„ï¼Œ<strong>åœ¨ æ‰§è¡Œè¯»å†™ï¼ˆRWï¼‰äº‹åŠ¡</strong> çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ä¸€è‡´æ€§åè®®å±‚ ï¼ˆConsensus å±‚ï¼‰çš„åŒæ„ï¼Œä¹Ÿå°±æ˜¯è¯»å†™äº‹åŠ¡æƒ³è¦è¿›è¡Œæäº¤ï¼Œå¿…é¡»è¦ç»è¿‡ç»„é‡Œâ€œå¤§å¤šæ•°äººâ€ï¼ˆå¯¹åº” Node èŠ‚ ç‚¹ï¼‰çš„åŒæ„ï¼Œå¤§å¤šæ•°æŒ‡çš„æ˜¯åŒæ„çš„èŠ‚ç‚¹æ•°é‡éœ€è¦å¤§äº ï¼ˆN/2+1ï¼‰ï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œæäº¤ï¼Œè€Œä¸æ˜¯åŸå‘èµ· æ–¹ä¸€ä¸ªè¯´äº†ç®—ã€‚è€Œé’ˆå¯¹ åªè¯»ï¼ˆROï¼‰äº‹åŠ¡ åˆ™ä¸éœ€è¦ç»è¿‡ç»„å†…åŒæ„ï¼Œç›´æ¥ COMMIT å³å¯ã€‚ </p>
<p>åœ¨ä¸€ä¸ªå¤åˆ¶ç»„å†…æœ‰å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå®ƒä»¬å„è‡ªç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”åœ¨ä¸€è‡´æ€§åè®®å±‚å®ç°äº†åŸå­æ¶ˆæ¯å’Œå…¨å±€æœ‰åºæ¶ˆæ¯ï¼Œä»è€Œä¿è¯ç»„å†…æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p><img src="/2022/04/22/MySQL/1652516682376.png" alt="1652516682376" loading="lazy"></p>
<p>MGR å°† MySQL å¸¦å…¥äº†æ•°æ®å¼ºä¸€è‡´æ€§çš„æ—¶ä»£ï¼Œæ˜¯ä¸€ä¸ªåˆ’æ—¶ä»£çš„åˆ›æ–°ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„åŸå› å°±æ˜¯MGR æ˜¯åŸºäº Paxos åè®®çš„ã€‚Paxos ç®—æ³•æ˜¯ç”± 2013 å¹´çš„å›¾çµå¥–è·å¾—è€… Leslie Lamport äº 1990 å¹´æå‡ºçš„ï¼Œæœ‰å…³è¿™ä¸ªç®—æ³•çš„å†³ç­–æœºåˆ¶å¯ä»¥æœä¸€ä¸‹ã€‚äº‹å®ä¸Šï¼ŒPaxos ç®—æ³•æå‡ºæ¥ä¹‹åå°±ä½œä¸º åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³• è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚ Apache çš„ ZooKeeper ä¹Ÿæ˜¯åŸºäº Paxos å®ç°çš„ã€‚</p>
<h3 id="5-çŸ¥è¯†å»¶ä¼¸"><a href="#5-çŸ¥è¯†å»¶ä¼¸" class="headerlink" title="5.çŸ¥è¯†å»¶ä¼¸"></a>5.çŸ¥è¯†å»¶ä¼¸</h3><p>åœ¨ä¸»ä»æ¶æ„çš„é…ç½®ä¸­ï¼Œå¦‚æœæƒ³è¦é‡‡å–è¯»å†™åˆ†ç¦»çš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–å†™ç¨‹åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶æ¥å®ç°ã€‚</p>
<ul>
<li>è‡ªå·±ç¼–å†™ç¨‹åºçš„å¥½å¤„å°±åœ¨äºæ¯”è¾ƒè‡ªä¸»ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ¤æ–­å“ªäº›æŸ¥è¯¢åœ¨ä»åº“ä¸Šæ¥æ‰§è¡Œï¼Œé’ˆå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å“ªäº›æŸ¥è¯¢å¯ä»¥åœ¨ä¸»åº“ä¸Šæ‰§è¡Œã€‚åŒæ—¶ï¼Œç¨‹åºç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œå‡å°‘äº†ä¸­é—´ä»¶å±‚ï¼Œç›¸å½“äºå‡å°‘äº†æ€§èƒ½æŸè€—ã€‚</li>
<li>é‡‡ç”¨ä¸­é—´ä»¶çš„æ–¹æ³•æœ‰å¾ˆæ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œ åŠŸèƒ½å¼ºå¤§ ï¼Œ ä½¿ç”¨ç®€å• ã€‚ä½†å› ä¸ºåœ¨å®¢æˆ·ç«¯å’Œæ•°æ®åº“ä¹‹é—´å¢åŠ äº†ä¸­é—´ä»¶å±‚ä¼šæœ‰ä¸€äº› æ€§èƒ½æŸè€— ï¼ŒåŒæ—¶å•†ä¸šä¸­é—´ä»¶ä¹Ÿæ˜¯æœ‰ä½¿ç”¨æˆæœ¬çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡å–ä¸€äº›ä¼˜ç§€çš„å¼€æºå·¥å…·ã€‚ <img src="/2022/04/22/MySQL/1652516907424.png" alt="1652516907424" loading="lazy"></li>
</ul>
<p>â‘  Cobar å±äºé˜¿é‡ŒB2Bäº‹ä¸šç¾¤ï¼Œå§‹äº2008å¹´ï¼Œåœ¨é˜¿é‡Œæœå½¹3å¹´å¤šï¼Œæ¥ç®¡3000+ä¸ªMySQLæ•°æ®åº“çš„schema,é›†ç¾¤æ—¥å¤„ç†åœ¨çº¿SQLè¯·æ±‚50äº¿æ¬¡ä»¥ä¸Šã€‚ç”±äºCobarå‘èµ·äººçš„ç¦»èŒï¼ŒCobaråœæ­¢ç»´æŠ¤ã€‚ </p>
<p>â‘¡ Mycat æ˜¯å¼€æºç¤¾åŒºåœ¨é˜¿é‡ŒcobaråŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè§£å†³äº†cobarå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„åŠŸèƒ½åœ¨å…¶ä¸­ã€‚é’å‡ºäºè“è€Œèƒœäºè“ã€‚â‘¢ OneProxy åŸºäºMySQLå®˜æ–¹çš„proxyæ€æƒ³åˆ©ç”¨cè¯­è¨€è¿›è¡Œå¼€å‘çš„ï¼ŒOneProxyæ˜¯ä¸€æ¬¾å•†ä¸š æ”¶è´¹ çš„ä¸­ é—´ä»¶ã€‚èˆå¼ƒäº†ä¸€äº›åŠŸèƒ½ï¼Œä¸“æ³¨åœ¨ æ€§èƒ½å’Œç¨³å®šæ€§ä¸Š ã€‚ </p>
<p>â‘£ kingshard ç”±å°å›¢é˜Ÿç”¨goè¯­è¨€å¼€å‘ï¼Œè¿˜éœ€è¦å‘å±•ï¼Œéœ€è¦ä¸æ–­å®Œå–„ã€‚ </p>
<p>â‘¤ Vitess æ˜¯Youtubeç”Ÿäº§åœ¨ä½¿ç”¨ï¼Œæ¶æ„å¾ˆå¤æ‚ã€‚ä¸æ”¯æŒMySQLåŸç”Ÿåè®®ï¼Œä½¿ç”¨ éœ€è¦å¤§é‡æ”¹é€ æˆ æœ¬ ã€‚ </p>
<p>â‘¥ Atlas æ˜¯360å›¢é˜ŸåŸºäºmysql proxyæ”¹å†™ï¼ŒåŠŸèƒ½è¿˜éœ€å®Œå–„ï¼Œé«˜å¹¶å‘ä¸‹ä¸ç¨³å®šã€‚ </p>
<p>â‘¦ MaxScale æ˜¯mariadbï¼ˆMySQLåŸä½œè€…ç»´æŠ¤çš„ä¸€ä¸ªç‰ˆæœ¬ï¼‰ ç ”å‘çš„ä¸­é—´ä»¶ </p>
<p>â‘§ MySQLRoute æ˜¯MySQLå®˜æ–¹Oracleå…¬å¸å‘å¸ƒçš„ä¸­é—´ä»¶ </p>
<p><img src="/2022/04/22/MySQL/1652516948614.png" alt="1652516948614" loading="lazy"></p>
<p><img src="/2022/04/22/MySQL/1652516956893.png" alt="1652516956893" loading="lazy"></p>
<p>ä¸»å¤‡åˆ‡æ¢ï¼š<img src="/2022/04/22/MySQL/1652516971520.png" alt="1652516971520" loading="lazy"></p>
<ul>
<li>ä¸»åŠ¨åˆ‡æ¢</li>
<li>è¢«åŠ¨åˆ‡æ¢</li>
<li>å¦‚ä½•åˆ¤æ–­ä¸»åº“å‡ºé—®é¢˜äº†ï¼Ÿå¦‚ä½•è§£å†³è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</li>
</ul>
<h2 id="æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤"><a href="#æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤"></a>æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</h2><p>åœ¨ä»»ä½•æ•°æ®åº“ç¯å¢ƒä¸­ï¼Œæ€»ä¼šæœ‰ä¸ç¡®å®šçš„æ„å¤–æƒ…å†µå‘ç”Ÿï¼Œæ¯”å¦‚æ–­ç”µã€è®¡ç®—æœºå„ç§åº”å°†æ•…éšœã€äººä¸ºç ´åã€ç®¡ç†å‘˜å¤±è¯¯æ“ä½œç­‰æ˜¯ä¸å¯é¿å…åœ°ï¼Œè¿™äº›æƒ…å†µä¼šå¯¼è‡´<strong>æ•°æ®çš„ä¸¢å¤±ã€æœåŠ¡å™¨ç˜«ç—ª</strong>ç­‰åæœã€‚å­˜åœ¨å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šå‡ºç°ä¸»ä»æœåŠ¡å™¨ä¹‹é—´åœ°<strong>æ•°æ®åŒæ­¥é—®é¢˜</strong></p>
<p>ä¸ºäº†æœ‰æ•ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå¹¶å°†æŸå¤±é™åˆ°æœ€ä½ï¼Œåº”å®šæœŸå¯¹MySQLæ•°æ®åº“æœåŠ¡å™¨åšå¤‡ä»½ã€‚</p>
<h3 id="1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½"><a href="#1-ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½" class="headerlink" title="1.ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½"></a>1.ç‰©ç†å¤‡ä»½ä¸é€»è¾‘å¤‡ä»½</h3><p><strong>ç‰©ç†å¤‡ä»½</strong>ï¼šå¤‡ä»½æ•°æ®æ–‡ä»¶ï¼Œè½¬å‚¨æ•°æ®åº“ç‰©ç†æ–‡ä»¶åˆ°æŸä¸€ç›®å½•ã€‚ç‰©ç†å¤‡ä»½æ¢å¤é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†å ç”¨ç©ºé—´æ¯” è¾ƒå¤§ï¼ŒMySQLä¸­å¯ä»¥ç”¨ xtrabackup å·¥å…·æ¥è¿›è¡Œç‰©ç†å¤‡ä»½ã€‚ </p>
<p><strong>é€»è¾‘å¤‡ä»½</strong>ï¼šå¯¹æ•°æ®åº“å¯¹è±¡åˆ©ç”¨å·¥å…·è¿›è¡Œå¯¼å‡ºå·¥ä½œï¼Œæ±‡æ€»å…¥å¤‡ä»½æ–‡ä»¶å†…ã€‚é€»è¾‘å¤‡ä»½æ¢å¤é€Ÿåº¦æ…¢ï¼Œä½†å ç”¨ç©º é—´å°ï¼Œæ›´çµæ´»ã€‚MySQL ä¸­å¸¸ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·ä¸º mysqldump ã€‚é€»è¾‘å¤‡ä»½å°±æ˜¯ å¤‡ä»½sqlè¯­å¥ ï¼Œåœ¨æ¢å¤çš„æ—¶å€™æ‰§è¡Œå¤‡ä»½çš„sqlè¯­å¥å®ç°æ•°æ®åº“æ•°æ®çš„é‡ç°ã€‚</p>
<h3 id="2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½"><a href="#2-mysqldumpå®ç°é€»è¾‘å¤‡ä»½" class="headerlink" title="2.mysqldumpå®ç°é€»è¾‘å¤‡ä»½"></a>2.mysqldumpå®ç°é€»è¾‘å¤‡ä»½</h3><p>mysqldæ˜¯MySQLæä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ•°æ®åº“å¤‡ä»½å·¥å…·</p>
<p>2.1å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.jpg"><img loading="lazy" src="/images/alipay.jpg" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wechatpay.png"><img loading="lazy" src="/images/wechatpay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>ç¿”ä»”</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://example.com/2022/04/22/MySQL/" title="MySQL">http://example.com/2022/04/22/MySQL/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2022/04/25/%E5%89%8D%E7%BC%80%E4%B8%8E%E8%B4%AA%E5%BF%83/" rel="prev" title="å‰ç¼€ä¸è´ªå¿ƒ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">å‰ç¼€ä¸è´ªå¿ƒ</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/04/18/JVM/" rel="next" title="JVM"><span class="post-nav-text">JVM</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2022 </span><span class="with-love" id="animate" title="äº‘æ¸¸å›çš„èµåŠ©è€…ä»¬"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> ç¿”ä»”</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.2</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.8.11</span></div><div class="live-time"><span>æœ¬åšå®¢å·²è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2022-04-10T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>